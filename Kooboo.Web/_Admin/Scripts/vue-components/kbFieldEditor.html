<div>
    <kb-dialog ref="dialog">
        <kb-dialog-header :close-handle="closeHandle"
                          :title="Kooboo.text.component.fieldEditor.title"></kb-dialog-header>
        <kb-dialog-content>
            <div>
                <kb-tabs ref="kbTabs" :display-names="displayNames" :active.sync="tabIndex">
                    <kb-container>
                        <template #content>
                            <kb-form :model="d_data">
                                <kb-form-item
                                        :class="{'has-error':!validateModel.name.valid}"
                                        v-kb-tooltip:right.manual.error="validateModel.name.msg">
                                    <label class="col-md-3 control-label">{{Kooboo.text.common.name}}</label>
                                    <div class="col-md-9" >
                                        <div class="input-group" >
                                            <input v-if="isNewField"
                                                   v-model="d_data.name"
                                                   type="text" class="form-control key">

                                            <p v-else class="form-control-static key"
                                               style="word-break: break-word;">{{d_data.name}}</p>
                                            <template v-if="options.modifiedField">
                                            <span class="input-group-addon">
                                            <div class="checkbox">
                                                <label>
                                                    <input type="checkbox"
                                                           v-model="d_data[options.modifiedField]">
                                                    {{options.modifiedFieldText || ''}}
                                                </label>
                                            </div>
                                        </span>
                                                </span>
                                            </template>
                                        </div>
                                    </div>
                                </kb-form-item>
                                <kb-form-item
                                >
                                    <label class="col-md-3 control-label">{{ Kooboo.text.common.displayName}}</label>
                                    <div class="col-md-9">
                                        <input v-model="d_data.displayName"
                                               type="text" class="form-control key">
                                    </div>
                                </kb-form-item>
                                <kb-form-item
                                >
                                    <div class="col-md-9 col-md-offset-3">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" :checked="d_data.editable"><span>{{Kooboo.text.component.fieldEditor.userEditable}}</span>
                                            </label>
                                        </div>
                                    </div>
                                </kb-form-item>
                                <kb-form-item
                                >
                                    <label class="col-md-3 control-label">{{Kooboo.text.component.fieldEditor.controlType}}</label>
                                    <div class="col-md-9">
                                        <select class="form-control" v-model="d_data.controlType">
                                            <option v-for="(item , index) in _controlTypes" :value="item.value">
                                                {{item.displayName}}
                                            </option>
                                        </select>
                                    </div>
                                </kb-form-item>
                                <kb-form-item
                                        v-if="['selection', 'checkbox', 'radiobox', 'fixedspec'].includes(d_data.controlType.toLowerCase())">
                                    <label class="col-md-3 control-label"
                                           data-bind="text: Kooboo.text.component.fieldEditor.Options"></label>
                                    <div class="col-md-9">
                                        <div class="input-groups" id="selection-options">

                                        <div v-for="(item,index) in d_data.selectionOptions" class="input-group"
                                             :class="{'has-error':!validateModel.selectionOptions[index].key.valid || !validateModel.selectionOptions[index].value.valid}">
                                                <input v-model="item.key"
                                                        type="text" class="form-control key input-small"
                                                       :placeholder="Kooboo.text.common.displayName"
                                                       data-container="#selection-options"
                                                       v-kb-tooltip:left.manual.error="validateModel.selectionOptions[index].key.msg"/>
                                                <span class="input-group-addon">:</span>
                                                <input v-model="item.value"
                                                        type="text" class="form-control value input-small"
                                                       :placeholder="Kooboo.text.common.value"
                                                       />
                                                <span class="input-group-btn"><a
                                                        @click="removeOption($event, index)"
                                                        href="javascript:;" class="btn btn-default"
                                                        ><i
                                                        class="fa fa-minus"
                                                        data-container="#selection-options"
                                                        v-kb-tooltip:right.manual.error="validateModel.selectionOptions[index].value.msg"></i></a></span>
                                            </div>
                                        </div>
                                        <div>
                                            <div>
                                                <a @click="addOption"
                                                    href="javascript:;" class="btn dark"><i
                                                        class="fa fa-plus"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </kb-form-item>
                                <kb-form-item v-if="['mediafile', 'file'].includes(d_data.controlType.toLowerCase())">
                                    <div class="col-md-9 col-md-offset-3">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" v-model="d_data.multipleValue" :disabled="isNewField">
                                                <span>{{Kooboo.text.component.fieldEditor.enableMultiple}}</span>
                                            </label>
                                        </div>
                                    </div>
                                </kb-form-item>
                            </kb-form>
                            <kb-container v-if="options.showPreviewPanel" tag='div'
                                          :v-nodes="$refs.dialog.$slots.preview"
                                          class="panel panel-default margin-top-20"></kb-container>
                        </template>
                    </kb-container>
                    <kb-container>
                        <template #content>
                            <kb-form :model="d_data" >
                                <kb-form-item
                                >
                                    <label class="control-label col-md-3">{{Kooboo.text.component.fieldEditor.tooltip}}</label>
                                    <div class="col-md-9">
                                        <input type="text" v-model="d_data.tooltip" class="form-control">
                                    </div>
                                </kb-form-item>
                                <kb-form-item
                                >
                                    <div class="col-md-9 col-md-offset-3">
                                        <div class="checkbox">
                                            <label>
                                                <input type="checkbox" v-model="d_data.multipleLanguage">
                                                <span>{{Kooboo.text.component.fieldEditor.enableMultilingual}}</span>
                                            </label>
                                        </div>
                                    </div>
                                </kb-form-item>

                            </kb-form>
                            <kb-container v-if="options.showPreviewPanel" tag='div'
                                          :v-nodes="$refs.dialog.$slots.preview"
                                          class="panel panel-default margin-top-20"></kb-container>
                        </template>
                    </kb-container>
                    <kb-container>
                        <template #content>
                            <kb-field-validation :data="d_data"></kb-field-validation>
                        </template>
                    </kb-container>


                </kb-tabs>
            </div>
        </kb-dialog-content>
        <kb-dialog-footer>
            <button class="btn green" @click="onModalSave">Save</button>
            <button class="btn gray" data-bind="click: onHide">Cancel</button>
        </kb-dialog-footer>
        <template #preview>
            <div class="panel-heading">
                <h6 class="panel-title">{{Kooboo.text.common.preview}}</h6>
            </div>
            <div class="panel-body form-horizontal">
                <div class="form-group">
                    <label class="control-label col-md-3">{{d_data.displayName || d_data.name}}</label>
                    <div class="col-md-9">
                        <img :src="getControlTypeByValue(d_data.controlType).preview" style="max-width: 100%;">
                        <span class="help-block">{{d_data.tooltip}}</span>
                    </div>
                </div>
            </div>
        </template>

    </kb-dialog>
</div>

