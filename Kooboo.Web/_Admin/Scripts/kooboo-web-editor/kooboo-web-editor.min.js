/******/ (function(modules) { // webpackBootstrap
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {}
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, __webpack_require__);
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, { enumerable: true, get: getter });
/******/ 		}
/******/ 	};
/******/
/******/ 	// define __esModule on exports
/******/ 	__webpack_require__.r = function(exports) {
/******/ 		if(typeof Symbol !== 'undefined' && Symbol.toStringTag) {
/******/ 			Object.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });
/******/ 		}
/******/ 		Object.defineProperty(exports, '__esModule', { value: true });
/******/ 	};
/******/
/******/ 	// create a fake namespace object
/******/ 	// mode & 1: value is a module id, require it
/******/ 	// mode & 2: merge all properties of value into the ns
/******/ 	// mode & 4: return value when already ns object
/******/ 	// mode & 8|1: behave like require
/******/ 	__webpack_require__.t = function(value, mode) {
/******/ 		if(mode & 1) value = __webpack_require__(value);
/******/ 		if(mode & 8) return value;
/******/ 		if((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;
/******/ 		var ns = Object.create(null);
/******/ 		__webpack_require__.r(ns);
/******/ 		Object.defineProperty(ns, 'default', { enumerable: true, value: value });
/******/ 		if(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));
/******/ 		return ns;
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/
/******/ 	// Load entry module and return exports
/******/ 	return __webpack_require__(__webpack_require__.s = "./src/index.ts");
/******/ })
/************************************************************************/
/******/ ({

/***/ "./node_modules/@simonwep/pickr/dist/pickr.min.js":
/*!********************************************************!*\
  !*** ./node_modules/@simonwep/pickr/dist/pickr.min.js ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n!function (t, e) {  true ? module.exports = e() : undefined; }(window, function () { return function (t) { var e = {}; function o(n) { if (e[n])\r\n    return e[n].exports; var i = e[n] = { i: n, l: !1, exports: {} }; return t[n].call(i.exports, i, i.exports, o), i.l = !0, i.exports; } return o.m = t, o.c = e, o.d = function (t, e, n) { o.o(t, e) || Object.defineProperty(t, e, { enumerable: !0, get: n }); }, o.r = function (t) { \"undefined\" != typeof Symbol && Symbol.toStringTag && Object.defineProperty(t, Symbol.toStringTag, { value: \"Module\" }), Object.defineProperty(t, \"__esModule\", { value: !0 }); }, o.t = function (t, e) { if (1 & e && (t = o(t)), 8 & e)\r\n    return t; if (4 & e && \"object\" == typeof t && t && t.__esModule)\r\n    return t; var n = Object.create(null); if (o.r(n), Object.defineProperty(n, \"default\", { enumerable: !0, value: t }), 2 & e && \"string\" != typeof t)\r\n    for (var i in t)\r\n        o.d(n, i, function (e) { return t[e]; }.bind(null, i)); return n; }, o.n = function (t) { var e = t && t.__esModule ? function () { return t.default; } : function () { return t; }; return o.d(e, \"a\", e), e; }, o.o = function (t, e) { return Object.prototype.hasOwnProperty.call(t, e); }, o.p = \"\", o(o.s = 0); }([function (t, e, o) {\r\n        \"use strict\";\r\n        o.r(e);\r\n        var n = {};\r\n        function i(t, e) { var o = Object.keys(t); return Object.getOwnPropertySymbols && o.push.apply(o, Object.getOwnPropertySymbols(t)), e && (o = o.filter(function (e) { return Object.getOwnPropertyDescriptor(t, e).enumerable; })), o; }\r\n        function r(t) { for (var e = 1; e < arguments.length; e++) {\r\n            var o = null != arguments[e] ? arguments[e] : {};\r\n            e % 2 ? i(o, !0).forEach(function (e) { s(t, e, o[e]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(t, Object.getOwnPropertyDescriptors(o)) : i(o).forEach(function (e) { Object.defineProperty(t, e, Object.getOwnPropertyDescriptor(o, e)); });\r\n        } return t; }\r\n        function s(t, e, o) { return e in t ? Object.defineProperty(t, e, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : t[e] = o, t; }\r\n        o.r(n), o.d(n, \"on\", function () { return c; }), o.d(n, \"off\", function () { return a; }), o.d(n, \"createElementFromString\", function () { return p; }), o.d(n, \"removeAttribute\", function () { return u; }), o.d(n, \"createFromTemplate\", function () { return h; }), o.d(n, \"eventPath\", function () { return d; }), o.d(n, \"adjustableInputNumbers\", function () { return f; });\r\n        const c = l.bind(null, \"addEventListener\"), a = l.bind(null, \"removeEventListener\");\r\n        function l(t, e, o, n, i = {}) { e instanceof HTMLCollection || e instanceof NodeList ? e = Array.from(e) : Array.isArray(e) || (e = [e]), Array.isArray(o) || (o = [o]); for (const s of e)\r\n            for (const e of o)\r\n                s[t](e, n, r({ capture: !1 }, i)); return Array.prototype.slice.call(arguments, 1); }\r\n        function p(t) { const e = document.createElement(\"div\"); return e.innerHTML = t.trim(), e.firstElementChild; }\r\n        function u(t, e) { const o = t.getAttribute(e); return t.removeAttribute(e), o; }\r\n        function h(t) { return function t(e, o = {}) { const n = u(e, \":obj\"), i = u(e, \":ref\"), r = n ? o[n] = {} : o; i && (o[i] = e); for (const o of Array.from(e.children)) {\r\n            const e = u(o, \":arr\"), n = t(o, e ? {} : r);\r\n            e && (r[e] || (r[e] = [])).push(Object.keys(n).length ? n : o);\r\n        } return o; }(p(t)); }\r\n        function d(t) { let e = t.path || t.composedPath && t.composedPath(); if (e)\r\n            return e; let o = t.target.parentElement; for (e = [t.target, o]; o = o.parentElement;)\r\n            e.push(o); return e.push(document, window), e; }\r\n        function f(t, e = (t => t)) { function o(o) { const n = [.001, .01, .1][Number(o.shiftKey || 2 * o.ctrlKey)] * (o.deltaY < 0 ? 1 : -1); let i = 0, r = t.selectionStart; t.value = t.value.replace(/[\\d.]+/g, (t, o) => o <= r && o + t.length >= r ? (r = o, e(Number(t), n, i)) : (i++, t)), t.focus(), t.setSelectionRange(r, r), o.preventDefault(), t.dispatchEvent(new Event(\"input\")); } c(t, \"focus\", () => c(window, \"wheel\", o, { passive: !1 })), c(t, \"blur\", () => a(window, \"wheel\", o)); }\r\n        const { min: m, max: v, floor: b, round: y } = Math;\r\n        function g(t, e, o) { e /= 100, o /= 100; let n = b(t = t / 360 * 6), i = t - n, r = o * (1 - e), s = o * (1 - i * e), c = o * (1 - (1 - i) * e), a = n % 6; return [255 * [o, s, r, r, c, o][a], 255 * [c, o, o, s, r, r][a], 255 * [r, r, c, o, o, s][a]]; }\r\n        function _(t, e, o) { let n = (2 - (e /= 100)) * (o /= 100) / 2; return 0 !== n && (e = 1 === n ? 0 : n < .5 ? e * o / (2 * n) : e * o / (2 - 2 * n)), [t, 100 * e, 100 * n]; }\r\n        function w(t, e, o) { let n, i, r; const s = m(t /= 255, e /= 255, o /= 255), c = v(t, e, o), a = c - s; if (0 === a)\r\n            n = i = 0;\r\n        else {\r\n            i = a / c;\r\n            let r = ((c - t) / 6 + a / 2) / a, s = ((c - e) / 6 + a / 2) / a, l = ((c - o) / 6 + a / 2) / a;\r\n            t === c ? n = l - s : e === c ? n = 1 / 3 + r - l : o === c && (n = 2 / 3 + s - r), n < 0 ? n += 1 : n > 1 && (n -= 1);\r\n        } return [360 * n, 100 * i, 100 * (r = c)]; }\r\n        function C(t, e, o, n) { return e /= 100, o /= 100, [...w(255 * (1 - m(1, (t /= 100) * (1 - (n /= 100)) + n)), 255 * (1 - m(1, e * (1 - n) + n)), 255 * (1 - m(1, o * (1 - n) + n)))]; }\r\n        function A(t, e, o) { return e /= 100, [t, 2 * (e *= (o /= 100) < .5 ? o : 1 - o) / (o + e) * 100, 100 * (o + e)]; }\r\n        function k(t) { return w(...t.match(/.{2}/g).map(t => parseInt(t, 16))); }\r\n        function O(t) { t = t.match(/^[a-zA-Z]+$/) ? function (t) { if (\"black\" === t.toLowerCase())\r\n            return \"#000000\"; const e = document.createElement(\"canvas\").getContext(\"2d\"); return e.fillStyle = t, \"#000000\" === e.fillStyle ? null : e.fillStyle; }(t) : t; const e = { cmyk: /^cmyk[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)/i, rgba: /^((rgba)|rgb)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]*?([\\d.]+|$)/i, hsla: /^((hsla)|hsl)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]*?([\\d.]+|$)/i, hsva: /^((hsva)|hsv)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]+([\\d.]+)[\\D]*?([\\d.]+|$)/i, hexa: /^#?(([\\dA-Fa-f]{3,4})|([\\dA-Fa-f]{6})|([\\dA-Fa-f]{8}))$/i }, o = t => t.map(t => /^(|\\d+)\\.\\d+|\\d+$/.test(t) ? Number(t) : void 0); let n; t: for (const i in e) {\r\n            if (!(n = e[i].exec(t)))\r\n                continue;\r\n            const r = !!n[2];\r\n            switch (i) {\r\n                case \"cmyk\": {\r\n                    let [, t, e, r, s] = o(n);\r\n                    if (t > 100 || e > 100 || r > 100 || s > 100)\r\n                        break t;\r\n                    return { values: C(t, e, r, s), type: i };\r\n                }\r\n                case \"rgba\": {\r\n                    let [, , , t, e, s, c] = o(n);\r\n                    if (t > 255 || e > 255 || s > 255 || c < 0 || c > 1 || r === !c)\r\n                        break t;\r\n                    return { values: [...w(t, e, s), c], a: c, type: i };\r\n                }\r\n                case \"hexa\": {\r\n                    let [, t] = n;\r\n                    4 !== t.length && 3 !== t.length || (t = t.split(\"\").map(t => t + t).join(\"\"));\r\n                    const e = t.substring(0, 6);\r\n                    let o = t.substring(6);\r\n                    return o = o ? parseInt(o, 16) / 255 : void 0, { values: [...k(e), o], a: o, type: i };\r\n                }\r\n                case \"hsla\": {\r\n                    let [, , , t, e, s, c] = o(n);\r\n                    if (t > 360 || e > 100 || s > 100 || c < 0 || c > 1 || r === !c)\r\n                        break t;\r\n                    return { values: [...A(t, e, s), c], a: c, type: i };\r\n                }\r\n                case \"hsva\": {\r\n                    let [, , , t, e, s, c] = o(n);\r\n                    if (t > 360 || e > 100 || s > 100 || c < 0 || c > 1 || r === !c)\r\n                        break t;\r\n                    return { values: [t, e, s, c], a: c, type: i };\r\n                }\r\n            }\r\n        } return { values: null, type: null }; }\r\n        function S(t = 0, e = 0, o = 0, n = 1) { const i = (t, e) => (o = -1) => e(~o ? t.map(t => Number(t.toFixed(o))) : t), r = { h: t, s: e, v: o, a: n, toHSVA() { const t = [r.h, r.s, r.v, r.a]; return t.toString = i(t, t => \"hsva(\".concat(t[0], \", \").concat(t[1], \"%, \").concat(t[2], \"%, \").concat(r.a, \")\")), t; }, toHSLA() { const t = [..._(r.h, r.s, r.v), r.a]; return t.toString = i(t, t => \"hsla(\".concat(t[0], \", \").concat(t[1], \"%, \").concat(t[2], \"%, \").concat(r.a, \")\")), t; }, toRGBA() { const t = [...g(r.h, r.s, r.v), r.a]; return t.toString = i(t, t => \"rgba(\".concat(t[0], \", \").concat(t[1], \", \").concat(t[2], \", \").concat(r.a, \")\")), t; }, toCMYK() { const t = function (t, e, o) { const n = g(t, e, o), i = n[0] / 255, r = n[1] / 255, s = n[2] / 255; let c, a, l, p; return [100 * (a = 1 === (c = m(1 - i, 1 - r, 1 - s)) ? 0 : (1 - i - c) / (1 - c)), 100 * (l = 1 === c ? 0 : (1 - r - c) / (1 - c)), 100 * (p = 1 === c ? 0 : (1 - s - c) / (1 - c)), 100 * c]; }(r.h, r.s, r.v); return t.toString = i(t, t => \"cmyk(\".concat(t[0], \"%, \").concat(t[1], \"%, \").concat(t[2], \"%, \").concat(t[3], \"%)\")), t; }, toHEXA() { const t = function (t, e, o) { return g(t, e, o).map(t => y(t).toString(16).padStart(2, \"0\")); }(r.h, r.s, r.v), e = r.a >= 1 ? \"\" : Number((255 * r.a).toFixed(0)).toString(16).toUpperCase().padStart(2, \"0\"); return e && t.push(e), t.toString = () => \"#\".concat(t.join(\"\").toUpperCase()), t; }, clone: () => S(r.h, r.s, r.v, r.a) }; return r; }\r\n        const j = t => Math.max(Math.min(t, 1), 0);\r\n        function P(t) { const e = { options: Object.assign({ lock: null, onchange: () => 0, onstop: () => 0 }, t), _tapstart(t) { c(document, [\"mouseup\", \"touchend\", \"touchcancel\"], e._tapstop), c(document, [\"mousemove\", \"touchmove\"], e._tapmove), t.preventDefault(), e._tapmove(t); }, _tapmove(t) { const { options: { lock: n }, cache: i } = e, { element: r, wrapper: s } = o, c = s.getBoundingClientRect(); let a = 0, l = 0; if (t) {\r\n                const e = t && t.touches && t.touches[0];\r\n                a = t ? (e || t).clientX : 0, l = t ? (e || t).clientY : 0, a < c.left ? a = c.left : a > c.left + c.width && (a = c.left + c.width), l < c.top ? l = c.top : l > c.top + c.height && (l = c.top + c.height), a -= c.left, l -= c.top;\r\n            }\r\n            else\r\n                i && (a = i.x * c.width, l = i.y * c.height); \"h\" !== n && (r.style.left = \"calc(\".concat(a / c.width * 100, \"% - \").concat(r.offsetWidth / 2, \"px)\")), \"v\" !== n && (r.style.top = \"calc(\".concat(l / c.height * 100, \"% - \").concat(r.offsetHeight / 2, \"px)\")), e.cache = { x: a / c.width, y: l / c.height }; const p = j(a / s.offsetWidth), u = j(l / s.offsetHeight); switch (n) {\r\n                case \"v\": return o.onchange(p);\r\n                case \"h\": return o.onchange(u);\r\n                default: return o.onchange(p, u);\r\n            } }, _tapstop() { e.options.onstop(), a(document, [\"mouseup\", \"touchend\", \"touchcancel\"], e._tapstop), a(document, [\"mousemove\", \"touchmove\"], e._tapmove); }, trigger() { e._tapmove(); }, update(t = 0, o = 0) { const { left: n, top: i, width: r, height: s } = e.options.wrapper.getBoundingClientRect(); \"h\" === e.options.lock && (o = t), e._tapmove({ clientX: n + r * t, clientY: i + s * o }); }, destroy() { const { options: t, _tapstart: o } = e; a([t.wrapper, t.element], \"mousedown\", o), a([t.wrapper, t.element], \"touchstart\", o, { passive: !1 }); } }, { options: o, _tapstart: n } = e; return c([o.wrapper, o.element], \"mousedown\", n), c([o.wrapper, o.element], \"touchstart\", n, { passive: !1 }), e; }\r\n        function L(t = {}) { t = Object.assign({ onchange: () => 0, className: \"\", elements: [] }, t); const e = c(t.elements, \"click\", e => { t.elements.forEach(o => o.classList[e.target === o ? \"add\" : \"remove\"](t.className)), t.onchange(e); }); return { destroy: () => a(...e) }; }\r\n        function x({ el: t, reference: e, padding: o = 8 }) { const n = { start: \"sme\", middle: \"mse\", end: \"ems\" }, i = { top: \"tbrl\", right: \"rltb\", bottom: \"btrl\", left: \"lrbt\" }, r = ((t = {}) => (e, o = t[e]) => { if (o)\r\n            return o; const [n, i = \"middle\"] = e.split(\"-\"), r = \"top\" === n || \"bottom\" === n; return t[e] = { position: n, variant: i, isVertical: r }; })(); return { update(s) { const { position: c, variant: a, isVertical: l } = r(s), p = e.getBoundingClientRect(), u = t.getBoundingClientRect(), h = t => t ? { t: p.top - u.height - o, b: p.bottom + o } : { r: p.right + o, l: p.left - u.width - o }, d = t => t ? { s: p.left + p.width - u.width, m: -u.width / 2 + (p.left + p.width / 2), e: p.left } : { s: p.bottom - u.height, m: p.bottom - p.height / 2 - u.height / 2, e: p.bottom - p.height }, f = {}; function m(e, o, n) { const i = \"top\" === n, r = i ? u.height : u.width, s = window[i ? \"innerHeight\" : \"innerWidth\"]; for (const i of e) {\r\n                const e = o[i], c = f[n] = \"\".concat(e, \"px\");\r\n                if (e > 0 && e + r < s)\r\n                    return t.style[n] = c, !0;\r\n            } return !1; } for (const t of [l, !l]) {\r\n                const e = m(i[c], h(t), t ? \"top\" : \"left\"), o = m(n[a], d(t), t ? \"left\" : \"top\");\r\n                if (e && o)\r\n                    return;\r\n            } t.style.left = f.left, t.style.top = f.top; } }; }\r\n        var E = ({ components: t, strings: e, useAsButton: o, inline: n, appClass: i, theme: r, lockOpacity: s }) => { const c = t => t ? \"\" : 'style=\"display:none\" hidden', a = h('\\n      <div :ref=\"root\" class=\"pickr\">\\n\\n        '.concat(o ? \"\" : '<button type=\"button\" :ref=\"button\" class=\"pcr-button\"></button>', '\\n\\n        <div :ref=\"app\" class=\"pcr-app ').concat(i || \"\", '\" data-theme=\"').concat(r, '\" ').concat(n ? 'style=\"position: unset\"' : \"\", '>\\n          <div class=\"pcr-selection\" ').concat(c(t.palette), '>\\n            <div :obj=\"preview\" class=\"pcr-color-preview\" ').concat(c(t.preview), '>\\n              <button type=\"button\" :ref=\"lastColor\" class=\"pcr-last-color\"></button>\\n              <div :ref=\"currentColor\" class=\"pcr-current-color\"></div>\\n            </div>\\n\\n            <div :obj=\"palette\" class=\"pcr-color-palette\">\\n              <div :ref=\"picker\" class=\"pcr-picker\"></div>\\n              <div :ref=\"palette\" class=\"pcr-palette\"></div>\\n            </div>\\n\\n            <div :obj=\"hue\" class=\"pcr-color-chooser\" ').concat(c(t.hue), '>\\n              <div :ref=\"picker\" class=\"pcr-picker\"></div>\\n              <div :ref=\"slider\" class=\"pcr-hue pcr-slider\"></div>\\n            </div>\\n\\n            <div :obj=\"opacity\" class=\"pcr-color-opacity\" ').concat(c(t.opacity), '>\\n              <div :ref=\"picker\" class=\"pcr-picker\"></div>\\n              <div :ref=\"slider\" class=\"pcr-opacity pcr-slider\"></div>\\n            </div>\\n          </div>\\n\\n          <div class=\"pcr-swatches ').concat(t.palette ? \"\" : \" pcr-last\", '\" :ref=\"swatches\"></div> \\n\\n          <div :obj=\"interaction\" class=\"pcr-interaction\" ').concat(c(Object.keys(t.interaction).length), '>\\n            <input :ref=\"result\" class=\"pcr-result\" type=\"text\" spellcheck=\"false\" ').concat(c(t.interaction.input), '>\\n\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"HEXA\" value=\"').concat(s ? \"HEX\" : \"HEXA\", '\" type=\"button\" ').concat(c(t.interaction.hex), '>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"RGBA\" value=\"').concat(s ? \"RGB\" : \"RGBA\", '\" type=\"button\" ').concat(c(t.interaction.rgba), '>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"HSLA\" value=\"').concat(s ? \"HSL\" : \"HSLA\", '\" type=\"button\" ').concat(c(t.interaction.hsla), '>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"HSVA\" value=\"').concat(s ? \"HSV\" : \"HSVA\", '\" type=\"button\" ').concat(c(t.interaction.hsva), '>\\n            <input :arr=\"options\" class=\"pcr-type\" data-type=\"CMYK\" value=\"CMYK\" type=\"button\" ').concat(c(t.interaction.cmyk), '>\\n\\n            <input :ref=\"save\" class=\"pcr-save\" value=\"').concat(e.save || \"Save\", '\" type=\"button\" ').concat(c(t.interaction.save), '>\\n            <input :ref=\"cancel\" class=\"pcr-clear\" value=\"').concat(e.cancel || \"Cancel\", '\" type=\"button\" ').concat(c(t.interaction.cancel), '>\\n            <input :ref=\"clear\" class=\"pcr-clear\" value=\"').concat(e.clear || \"Clear\", '\" type=\"button\" ').concat(c(t.interaction.clear), \">\\n          </div>\\n        </div>\\n      </div>\\n    \")), l = a.interaction; return l.options.find(t => !t.hidden && !t.classList.add(\"active\")), l.type = () => l.options.find(t => t.classList.contains(\"active\")), a; };\r\n        function B(t, e, o) { return e in t ? Object.defineProperty(t, e, { value: o, enumerable: !0, configurable: !0, writable: !0 }) : t[e] = o, t; }\r\n        class R {\r\n            constructor(t) { B(this, \"_initializingActive\", !0), B(this, \"_recalc\", !0), B(this, \"_color\", S()), B(this, \"_lastColor\", S()), B(this, \"_swatchColors\", []), B(this, \"_eventListener\", { init: [], save: [], hide: [], show: [], clear: [], change: [], changestop: [], cancel: [], swatchselect: [] }), this.options = t = Object.assign({ appClass: null, theme: \"classic\", useAsButton: !1, disabled: !1, comparison: !0, closeOnScroll: !1, outputPrecision: 0, lockOpacity: !1, autoReposition: !0, components: { interaction: {} }, strings: {}, swatches: null, inline: !1, sliders: null, default: \"#42445a\", defaultRepresentation: null, position: \"bottom-middle\", adjustableNumbers: !0, showAlways: !1, closeWithKey: \"Escape\" }, t); const { swatches: e, inline: o, components: n, theme: i, sliders: r, lockOpacity: s } = t; [\"nano\", \"monolith\"].includes(i) && !r && (t.sliders = \"h\"), n.interaction || (n.interaction = {}); const { preview: c, opacity: a, hue: l, palette: p } = n; n.opacity = !s && a, n.palette = p || c || a || l, o && (t.showAlways = !0), this._preBuild(), this._buildComponents(), this._bindEvents(), this._finalBuild(), e && e.length && e.forEach(t => this.addSwatch(t)), this._nanopop = x({ reference: this._root.button, el: this._root.app }); const { app: u } = this._root, h = this; requestAnimationFrame(function e() { if (!u.offsetWidth && u.parentElement !== document.body)\r\n                return requestAnimationFrame(e); h.setColor(t.default), h._rePositioningPicker(), t.defaultRepresentation && (h._representation = t.defaultRepresentation, h.setColorRepresentation(h._representation)), t.showAlways && h.show(), h._initializingActive = !1, h._emit(\"init\"); }); }\r\n            _preBuild() { const t = this.options; \"string\" == typeof t.el && (t.el = t.el.split(/>>/g).reduce((t, e, o, n) => (t = t.querySelector(e), o < n.length - 1 ? t.shadowRoot : t), document)), this._root = E(t), t.useAsButton && (this._root.button = t.el), document.body.appendChild(this._root.root); }\r\n            _finalBuild() { const t = this.options, e = this._root; if (document.body.removeChild(e.root), t.inline) {\r\n                const o = t.el.parentElement;\r\n                t.el.nextSibling ? o.insertBefore(e.app, t.el.nextSibling) : o.appendChild(e.app);\r\n            }\r\n            else\r\n                document.body.appendChild(e.app); t.useAsButton ? t.inline && t.el.remove() : t.el.parentNode.replaceChild(e.root, t.el), t.disabled && this.disable(), t.comparison || (e.button.style.transition = \"none\", t.useAsButton || (e.preview.lastColor.style.transition = \"none\")), this.hide(); }\r\n            _buildComponents() { const t = this, e = this.options.components, o = (t.options.sliders || \"v\").repeat(2), [n, i] = o.match(/^[vh]+$/g) ? o : [], r = { palette: P({ element: t._root.palette.picker, wrapper: t._root.palette.palette, onstop: () => t._emit(\"changestop\", t), onchange(o, n) { if (!e.palette)\r\n                        return; const { _color: i, _root: r, options: s } = t; t._recalc && (i.s = 100 * o, i.v = 100 - 100 * n, i.v < 0 && (i.v = 0), t._updateOutput()); let c = i.toRGBA().toString(0); this.element.style.background = c, this.wrapper.style.background = \"\\n                        linear-gradient(to top, rgba(0, 0, 0, \".concat(i.a, \"), transparent),\\n                        linear-gradient(to left, hsla(\").concat(i.h, \", 100%, 50%, \").concat(i.a, \"), rgba(255, 255, 255, \").concat(i.a, \"))\\n                    \"), s.comparison || (r.button.style.color = c, s.useAsButton || (r.preview.lastColor.style.color = c)), r.preview.currentColor.style.color = c, t.options.comparison || r.button.classList.remove(\"clear\"); } }), hue: P({ lock: \"v\" === i ? \"h\" : \"v\", element: t._root.hue.picker, wrapper: t._root.hue.slider, onstop: () => t._emit(\"changestop\", t), onchange(o) { e.hue && e.palette && (t._recalc && (t._color.h = 360 * o), this.element.style.backgroundColor = \"hsl(\".concat(t._color.h, \", 100%, 50%)\"), r.palette.trigger()); } }), opacity: P({ lock: \"v\" === n ? \"h\" : \"v\", element: t._root.opacity.picker, wrapper: t._root.opacity.slider, onstop: () => t._emit(\"changestop\", t), onchange(o) { e.opacity && e.palette && (t._recalc && (t._color.a = Math.round(100 * o) / 100), this.element.style.background = \"rgba(0, 0, 0, \".concat(t._color.a, \")\"), r.palette.trigger()); } }), selectable: L({ elements: t._root.interaction.options, className: \"active\", onchange(e) { t._representation = e.target.getAttribute(\"data-type\").toUpperCase(), t._recalc && t._updateOutput(); } }) }; this._components = r; }\r\n            _bindEvents() { const { _root: t, options: e } = this, o = [c(t.interaction.clear, \"click\", () => this._clearColor()), c([t.interaction.cancel, t.preview.lastColor], \"click\", () => { this._emit(\"cancel\", this), this.setHSVA(...this._lastColor.toHSVA(), !0); }), c(t.interaction.save, \"click\", () => { !this.applyColor() && !e.showAlways && this.hide(); }), c(t.interaction.result, [\"keyup\", \"input\"], t => { this.setColor(t.target.value, !0) && !this._initializingActive && this._emit(\"change\", this._color), t.stopImmediatePropagation(); }), c(t.interaction.result, [\"focus\", \"blur\"], t => { this._recalc = \"blur\" === t.type, this._recalc && this._updateOutput(); }), c([t.palette.palette, t.palette.picker, t.hue.slider, t.hue.picker, t.opacity.slider, t.opacity.picker], [\"mousedown\", \"touchstart\"], () => this._recalc = !0)]; if (!e.showAlways) {\r\n                const n = e.closeWithKey;\r\n                o.push(c(t.button, \"click\", () => this.isOpen() ? this.hide() : this.show()), c(document, \"keyup\", t => this.isOpen() && (t.key === n || t.code === n) && this.hide()), c(document, [\"touchstart\", \"mousedown\"], e => { this.isOpen() && !d(e).some(e => e === t.app || e === t.button) && this.hide(); }, { capture: !0 }));\r\n            } if (e.adjustableNumbers) {\r\n                const e = { rgba: [255, 255, 255, 1], hsva: [360, 100, 100, 1], hsla: [360, 100, 100, 1], cmyk: [100, 100, 100, 100] };\r\n                f(t.interaction.result, (t, o, n) => { const i = e[this.getColorRepresentation().toLowerCase()]; if (i) {\r\n                    const e = i[n], r = t + (e >= 100 ? 1e3 * o : o);\r\n                    return r <= 0 ? 0 : Number((r < e ? r : e).toPrecision(3));\r\n                } return t; });\r\n            } if (e.autoReposition && !e.inline) {\r\n                let t = null;\r\n                const n = this;\r\n                o.push(c(window, [\"scroll\", \"resize\"], () => { n.isOpen() && (e.closeOnScroll && n.hide(), null === t ? (t = setTimeout(() => t = null, 100), requestAnimationFrame(function e() { n._rePositioningPicker(), null !== t && requestAnimationFrame(e); })) : (clearTimeout(t), t = setTimeout(() => t = null, 100))); }, { capture: !0 }));\r\n            } this._eventBindings = o; }\r\n            _rePositioningPicker() { const { options: t } = this; if (!t.inline) {\r\n                const { app: e } = this._root;\r\n                matchMedia(\"(max-width: 576px)\").matches ? Object.assign(e.style, { margin: \"auto\", height: \"\".concat(e.getBoundingClientRect().height, \"px\"), top: 0, bottom: 0, left: 0, right: 0 }) : (Object.assign(e.style, { margin: null, right: null, top: null, bottom: null, left: null, height: null }), this._nanopop.update(t.position));\r\n            } }\r\n            _updateOutput() { const { _root: t, _color: e, options: o } = this; if (t.interaction.type()) {\r\n                const n = \"to\".concat(t.interaction.type().getAttribute(\"data-type\"));\r\n                t.interaction.result.value = \"function\" == typeof e[n] ? e[n]().toString(o.outputPrecision) : \"\";\r\n            } !this._initializingActive && this._recalc && this._emit(\"change\", e); }\r\n            _clearColor(t = !1) { const { _root: e, options: o } = this; o.useAsButton || (e.button.style.color = \"rgba(0, 0, 0, 0.15)\"), e.button.classList.add(\"clear\"), o.showAlways || this.hide(), this._initializingActive || t || (this._emit(\"save\", null), this._emit(\"clear\", this)); }\r\n            _parseLocalColor(t) { const { values: e, type: o, a: n } = O(t), { lockOpacity: i } = this.options, r = void 0 !== n && 1 !== n; return e && 3 === e.length && (e[3] = void 0), { values: !e || i && r ? null : e, type: o }; }\r\n            _emit(t, ...e) { this._eventListener[t].forEach(t => t(...e, this)); }\r\n            on(t, e) { return \"function\" == typeof e && \"string\" == typeof t && t in this._eventListener && this._eventListener[t].push(e), this; }\r\n            off(t, e) { const o = this._eventListener[t]; if (o) {\r\n                const t = o.indexOf(e);\r\n                ~t && o.splice(t, 1);\r\n            } return this; }\r\n            addSwatch(t) { const { values: e } = this._parseLocalColor(t); if (e) {\r\n                const { _swatchColors: t, _root: o } = this, n = S(...e), i = p('<button type=\"button\" style=\"color: '.concat(n.toRGBA().toString(0), '\"/>'));\r\n                return o.swatches.appendChild(i), t.push({ element: i, hsvaColorObject: n }), this._eventBindings.push(c(i, \"click\", () => { this.setHSVA(...n.toHSVA(), !0), this._emit(\"swatchselect\", n), this._emit(\"change\", n); })), !0;\r\n            } return !1; }\r\n            removeSwatch(t) { const e = this._swatchColors[t]; if (e) {\r\n                const { element: o } = e;\r\n                return this._root.swatches.removeChild(o), this._swatchColors.splice(t, 1), !0;\r\n            } return !1; }\r\n            applyColor(t = !1) { const { preview: e, button: o } = this._root, n = this._color.toRGBA().toString(); e.lastColor.style.color = n, this.options.useAsButton || (o.style.color = n), o.classList.remove(\"clear\"), this._lastColor = this._color.clone(), this._initializingActive || t || this._emit(\"save\", this._color); }\r\n            destroy() { this._eventBindings.forEach(t => a(...t)), Object.keys(this._components).forEach(t => this._components[t].destroy()); }\r\n            destroyAndRemove() { this.destroy(); const { root: t, app: e } = this._root; t.parentElement && t.parentElement.removeChild(t), e.parentElement.removeChild(e), Object.keys(this).forEach(t => this[t] = null); }\r\n            hide() { return this.options.inline || (this._root.app.classList.remove(\"visible\"), this._emit(\"hide\", this)), this; }\r\n            show() { return this.options.disabled || (this._root.app.classList.add(\"visible\"), this._rePositioningPicker(), this._emit(\"show\", this)), this; }\r\n            isOpen() { return this._root.app.classList.contains(\"visible\"); }\r\n            setHSVA(t = 360, e = 0, o = 0, n = 1, i = !1) { const r = this._recalc; if (this._recalc = !1, t < 0 || t > 360 || e < 0 || e > 100 || o < 0 || o > 100 || n < 0 || n > 1)\r\n                return !1; this._color = S(t, e, o, n); const { hue: s, opacity: c, palette: a } = this._components; return s.update(t / 360), c.update(n), a.update(e / 100, 1 - o / 100), i || this.applyColor(), r && this._updateOutput(), this._recalc = r, !0; }\r\n            setColor(t, e = !1) { if (null === t)\r\n                return this._clearColor(e), !0; const { values: o, type: n } = this._parseLocalColor(t); if (o) {\r\n                const t = n.toUpperCase(), { options: i } = this._root.interaction, r = i.find(e => e.getAttribute(\"data-type\") === t);\r\n                if (r && !r.hidden)\r\n                    for (const t of i)\r\n                        t.classList[t === r ? \"add\" : \"remove\"](\"active\");\r\n                return this.setColorRepresentation(t), this.setHSVA(...o, e);\r\n            } return !1; }\r\n            setColorRepresentation(t) { return t = t.toUpperCase(), !!this._root.interaction.options.find(e => e.getAttribute(\"data-type\").startsWith(t) && !e.click()); }\r\n            getColorRepresentation() { return this._representation; }\r\n            getColor() { return this._color; }\r\n            getRoot() { return this._root; }\r\n            disable() { return this.hide(), this.options.disabled = !0, this._root.button.classList.add(\"disabled\"), this; }\r\n            enable() { return this.options.disabled = !1, this._root.button.classList.remove(\"disabled\"), this; }\r\n        }\r\n        R.utils = n, R.libs = { HSVaColor: S, Moveable: P, Nanopop: x, Selectable: L }, R.create = t => new R(t), R.version = \"1.2.7\";\r\n        e.default = R;\r\n    }]).default; });\r\n\n\n//# sourceURL=webpack:///./node_modules/@simonwep/pickr/dist/pickr.min.js?");

/***/ }),

/***/ "./node_modules/@simonwep/pickr/dist/themes/nano.min.css":
/*!***************************************************************!*\
  !*** ./node_modules/@simonwep/pickr/dist/themes/nano.min.css ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("\nvar content = __webpack_require__(/*! !../../../../css-loader/dist/cjs.js!./nano.min.css */ \"./node_modules/css-loader/dist/cjs.js!./node_modules/@simonwep/pickr/dist/themes/nano.min.css\");\n\nif(typeof content === 'string') content = [[module.i, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = __webpack_require__(/*! ../../../../style-loader/lib/addStyles.js */ \"./node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(false) {}\n\n//# sourceURL=webpack:///./node_modules/@simonwep/pickr/dist/themes/nano.min.css?");

/***/ }),

/***/ "./node_modules/@webcomponents/shadydom/shadydom.min.js":
/*!**************************************************************!*\
  !*** ./node_modules/@webcomponents/shadydom/shadydom.min.js ***!
  \**************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("/* WEBPACK VAR INJECTION */(function(global) {\r\n(function () {\r\n    'use strict';\r\n    var m;\r\n    function aa(a) { var b = 0; return function () { return b < a.length ? { done: !1, value: a[b++] } : { done: !0 }; }; }\r\n    function ba(a) { var b = \"undefined\" != typeof Symbol && Symbol.iterator && a[Symbol.iterator]; return b ? b.call(a) : { next: aa(a) }; }\r\n    function ca(a) { for (var b, c = []; !(b = a.next()).done;)\r\n        c.push(b.value); return c; }\r\n    var da = \"undefined\" != typeof window && window === this ? this : \"undefined\" != typeof global && null != global ? global : this;\r\n    function n(a, b) { return { index: a, o: [], v: b }; }\r\n    function ea(a, b, c, d) {\r\n        var e = 0, f = 0, g = 0, h = 0, l = Math.min(b - e, d - f);\r\n        if (0 == e && 0 == f)\r\n            a: {\r\n                for (g = 0; g < l; g++)\r\n                    if (a[g] !== c[g])\r\n                        break a;\r\n                g = l;\r\n            }\r\n        if (b == a.length && d == c.length) {\r\n            h = a.length;\r\n            for (var k = c.length, p = 0; p < l - g && fa(a[--h], c[--k]);)\r\n                p++;\r\n            h = p;\r\n        }\r\n        e += g;\r\n        f += g;\r\n        b -= h;\r\n        d -= h;\r\n        if (0 == b - e && 0 == d - f)\r\n            return [];\r\n        if (e == b) {\r\n            for (b = n(e, 0); f < d;)\r\n                b.o.push(c[f++]);\r\n            return [b];\r\n        }\r\n        if (f == d)\r\n            return [n(e, b - e)];\r\n        l = e;\r\n        g = f;\r\n        d = d - g + 1;\r\n        h = b - l + 1;\r\n        b = Array(d);\r\n        for (k = 0; k < d; k++)\r\n            b[k] = Array(h), b[k][0] = k;\r\n        for (k = 0; k < h; k++)\r\n            b[0][k] = k;\r\n        for (k = 1; k < d; k++)\r\n            for (p = 1; p < h; p++)\r\n                if (a[l + p - 1] === c[g + k - 1])\r\n                    b[k][p] =\r\n                        b[k - 1][p - 1];\r\n                else {\r\n                    var w = b[k - 1][p] + 1, K = b[k][p - 1] + 1;\r\n                    b[k][p] = w < K ? w : K;\r\n                }\r\n        l = b.length - 1;\r\n        g = b[0].length - 1;\r\n        d = b[l][g];\r\n        for (a = []; 0 < l || 0 < g;)\r\n            0 == l ? (a.push(2), g--) : 0 == g ? (a.push(3), l--) : (h = b[l - 1][g - 1], k = b[l - 1][g], p = b[l][g - 1], w = k < p ? k < h ? k : h : p < h ? p : h, w == h ? (h == d ? a.push(0) : (a.push(1), d = h), l--, g--) : w == k ? (a.push(3), l--, d = k) : (a.push(2), g--, d = p));\r\n        a.reverse();\r\n        b = void 0;\r\n        l = [];\r\n        for (g = 0; g < a.length; g++)\r\n            switch (a[g]) {\r\n                case 0:\r\n                    b && (l.push(b), b = void 0);\r\n                    e++;\r\n                    f++;\r\n                    break;\r\n                case 1:\r\n                    b || (b = n(e, 0));\r\n                    b.v++;\r\n                    e++;\r\n                    b.o.push(c[f]);\r\n                    f++;\r\n                    break;\r\n                case 2:\r\n                    b || (b = n(e, 0));\r\n                    b.v++;\r\n                    e++;\r\n                    break;\r\n                case 3: b || (b = n(e, 0)), b.o.push(c[f]), f++;\r\n            }\r\n        b && l.push(b);\r\n        return l;\r\n    }\r\n    function fa(a, b) { return a === b; }\r\n    ;\r\n    function ha() { }\r\n    ha.prototype.toJSON = function () { return {}; };\r\n    function q(a) { a.__shady || (a.__shady = new ha); return a.__shady; }\r\n    function r(a) { return a && a.__shady; }\r\n    ;\r\n    var t = window.ShadyDOM || {};\r\n    t.U = !(!Element.prototype.attachShadow || !Node.prototype.getRootNode);\r\n    var ia = Object.getOwnPropertyDescriptor(Node.prototype, \"firstChild\");\r\n    t.f = !!(ia && ia.configurable && ia.get);\r\n    t.F = t.force || !t.U;\r\n    t.g = t.noPatch || !1;\r\n    t.J = t.preferPerformance;\r\n    var ja = navigator.userAgent.match(\"Trident\");\r\n    t.L = ja;\r\n    function u(a) { return (a = r(a)) && void 0 !== a.firstChild; }\r\n    function v(a) { return \"ShadyRoot\" === a.R; }\r\n    function ka(a) { return (a = (a = r(a)) && a.root) && la(a); }\r\n    var x = Element.prototype, ma = x.matches || x.matchesSelector || x.mozMatchesSelector || x.msMatchesSelector || x.oMatchesSelector || x.webkitMatchesSelector, na = document.createTextNode(\"\"), oa = 0, pa = [];\r\n    (new MutationObserver(function () { for (; pa.length;)\r\n        try {\r\n            pa.shift()();\r\n        }\r\n        catch (a) {\r\n            throw na.textContent = oa++, a;\r\n        } })).observe(na, { characterData: !0 });\r\n    function qa(a) { pa.push(a); na.textContent = oa++; }\r\n    var ra = !!document.contains;\r\n    function sa(a, b) { for (; b;) {\r\n        if (b == a)\r\n            return !0;\r\n        b = b.__shady_parentNode;\r\n    } return !1; }\r\n    function ta(a) { for (var b = a.length - 1; 0 <= b; b--) {\r\n        var c = a[b], d = c.getAttribute(\"id\") || c.getAttribute(\"name\");\r\n        d && \"length\" !== d && isNaN(d) && (a[d] = c);\r\n    } a.item = function (b) { return a[b]; }; a.namedItem = function (b) { if (\"length\" !== b && isNaN(b) && a[b])\r\n        return a[b]; for (var c = ba(a), d = c.next(); !d.done; d = c.next())\r\n        if (d = d.value, (d.getAttribute(\"id\") || d.getAttribute(\"name\")) == b)\r\n            return d; return null; }; return a; }\r\n    function va(a) { var b = []; for (a = a.__shady_native_firstChild; a; a = a.__shady_native_nextSibling)\r\n        b.push(a); return b; }\r\n    function wa(a) { var b = []; for (a = a.__shady_firstChild; a; a = a.__shady_nextSibling)\r\n        b.push(a); return b; }\r\n    function y(a, b, c, d) { c = void 0 === c ? \"\" : c; for (var e in b) {\r\n        var f = b[e];\r\n        if (!(d && 0 <= d.indexOf(e))) {\r\n            f.configurable = !0;\r\n            var g = c + e;\r\n            if (f.value)\r\n                a[g] = f.value;\r\n            else\r\n                try {\r\n                    Object.defineProperty(a, g, f);\r\n                }\r\n                catch (h) { }\r\n        }\r\n    } }\r\n    function z(a) { var b = {}; Object.getOwnPropertyNames(a).forEach(function (c) { b[c] = Object.getOwnPropertyDescriptor(a, c); }); return b; }\r\n    ;\r\n    var A = [], xa;\r\n    function ya(a) { xa || (xa = !0, qa(B)); A.push(a); }\r\n    function B() { xa = !1; for (var a = !!A.length; A.length;)\r\n        A.shift()(); return a; }\r\n    B.list = A;\r\n    var C = z({ get childNodes() { return this.__shady_childNodes; }, get firstChild() { return this.__shady_firstChild; }, get lastChild() { return this.__shady_lastChild; }, get childElementCount() { return this.__shady_childElementCount; }, get children() { return this.__shady_children; }, get firstElementChild() { return this.__shady_firstElementChild; }, get lastElementChild() { return this.__shady_lastElementChild; }, get shadowRoot() { return this.__shady_shadowRoot; } }), D = z({ get textContent() { return this.__shady_textContent; }, set textContent(a) {\r\n            this.__shady_textContent =\r\n                a;\r\n        }, get innerHTML() { return this.__shady_innerHTML; }, set innerHTML(a) { return this.__shady_innerHTML = a; } }), E = z({ get parentElement() { return this.__shady_parentElement; }, get parentNode() { return this.__shady_parentNode; }, get nextSibling() { return this.__shady_nextSibling; }, get previousSibling() { return this.__shady_previousSibling; }, get nextElementSibling() { return this.__shady_nextElementSibling; }, get previousElementSibling() { return this.__shady_previousElementSibling; }, get className() { return this.__shady_className; },\r\n        set className(a) { return this.__shady_className = a; } }), za;\r\n    for (za in C)\r\n        C[za].enumerable = !1;\r\n    for (var Aa in D)\r\n        D[Aa].enumerable = !1;\r\n    for (var Ba in E)\r\n        E[Ba].enumerable = !1;\r\n    var Ca = t.f || t.g, Da = Ca ? function () { } : function (a) { var b = q(a); b.N || (b.N = !0, y(a, E)); }, Ea = Ca ? function () { } : function (a) { var b = q(a); b.M || (b.M = !0, y(a, C), window.customElements && !t.g || y(a, D)); };\r\n    function Fa(a, b, c, d) { Da(a); d = d || null; var e = q(a), f = d ? q(d) : null; e.previousSibling = d ? f.previousSibling : b.__shady_lastChild; if (f = r(e.previousSibling))\r\n        f.nextSibling = a; if (f = r(e.nextSibling = d))\r\n        f.previousSibling = a; e.parentNode = b; d ? d === c.firstChild && (c.firstChild = a) : (c.lastChild = a, c.firstChild || (c.firstChild = a)); c.childNodes = null; }\r\n    function Ga(a, b, c) { Ea(b); var d = q(b); void 0 !== d.firstChild && (d.childNodes = null); if (a.nodeType === Node.DOCUMENT_FRAGMENT_NODE)\r\n        for (a = a.__shady_native_firstChild; a; a = a.__shady_native_nextSibling)\r\n            Fa(a, b, d, c);\r\n    else\r\n        Fa(a, b, d, c); }\r\n    function Ha(a, b) { var c = q(a); b = q(b); a === b.firstChild && (b.firstChild = c.nextSibling); a === b.lastChild && (b.lastChild = c.previousSibling); a = c.previousSibling; var d = c.nextSibling; a && (q(a).nextSibling = d); d && (q(d).previousSibling = a); c.parentNode = c.previousSibling = c.nextSibling = void 0; void 0 !== b.childNodes && (b.childNodes = null); }\r\n    function F(a, b) { var c = q(a); if (b || void 0 === c.firstChild) {\r\n        c.childNodes = null;\r\n        var d = c.firstChild = a.__shady_native_firstChild;\r\n        c.lastChild = a.__shady_native_lastChild;\r\n        Ea(a);\r\n        c = d;\r\n        for (d = void 0; c; c = c.__shady_native_nextSibling) {\r\n            var e = q(c);\r\n            e.parentNode = b || a;\r\n            e.nextSibling = c.__shady_native_nextSibling;\r\n            e.previousSibling = d || null;\r\n            d = c;\r\n            Da(c);\r\n        }\r\n    } }\r\n    ;\r\n    var Ia = window.document, Ja = t.J, Ka = Object.getOwnPropertyDescriptor(Node.prototype, \"isConnected\"), La = Ka && Ka.get;\r\n    function Ma(a) { for (var b; b = a.__shady_firstChild;)\r\n        a.__shady_removeChild(b); }\r\n    function Na(a) { var b = r(a); if (b && void 0 !== b.A)\r\n        for (b = a.__shady_firstChild; b; b = b.__shady_nextSibling)\r\n            Na(b); if (a = r(a))\r\n        a.A = void 0; }\r\n    function Oa(a) { var b = a; a && \"slot\" === a.localName && (b = (b = (b = r(a)) && b.l) && b.length ? b[0] : Oa(a.__shady_nextSibling)); return b; }\r\n    function Pa(a, b, c) { if (a = (a = r(a)) && a.m)\r\n        b && a.addedNodes.push(b), c && a.removedNodes.push(c), Qa(a); }\r\n    var L = z({ get parentNode() { var a = r(this); a = a && a.parentNode; return void 0 !== a ? a : this.__shady_native_parentNode; }, get firstChild() { var a = r(this); a = a && a.firstChild; return void 0 !== a ? a : this.__shady_native_firstChild; }, get lastChild() { var a = r(this); a = a && a.lastChild; return void 0 !== a ? a : this.__shady_native_lastChild; }, get nextSibling() { var a = r(this); a = a && a.nextSibling; return void 0 !== a ? a : this.__shady_native_nextSibling; }, get previousSibling() { var a = r(this); a = a && a.previousSibling; return void 0 !== a ? a : this.__shady_native_previousSibling; },\r\n        get childNodes() { if (u(this)) {\r\n            var a = r(this);\r\n            if (!a.childNodes) {\r\n                a.childNodes = [];\r\n                for (var b = this.__shady_firstChild; b; b = b.__shady_nextSibling)\r\n                    a.childNodes.push(b);\r\n            }\r\n            var c = a.childNodes;\r\n        }\r\n        else\r\n            c = this.__shady_native_childNodes; c.item = function (a) { return c[a]; }; return c; }, get parentElement() { var a = r(this); (a = a && a.parentNode) && a.nodeType !== Node.ELEMENT_NODE && (a = null); return void 0 !== a ? a : this.__shady_native_parentElement; }, get isConnected() {\r\n            if (La && La.call(this))\r\n                return !0;\r\n            if (this.nodeType == Node.DOCUMENT_FRAGMENT_NODE)\r\n                return !1;\r\n            var a = this.ownerDocument;\r\n            if (ra) {\r\n                if (a.__shady_native_contains(this))\r\n                    return !0;\r\n            }\r\n            else if (a.documentElement && a.documentElement.__shady_native_contains(this))\r\n                return !0;\r\n            for (a = this; a && !(a instanceof Document);)\r\n                a = a.__shady_parentNode || (v(a) ? a.host : void 0);\r\n            return !!(a && a instanceof Document);\r\n        }, get textContent() { if (u(this)) {\r\n            for (var a = [], b = this.__shady_firstChild; b; b = b.__shady_nextSibling)\r\n                b.nodeType !== Node.COMMENT_NODE && a.push(b.__shady_textContent);\r\n            return a.join(\"\");\r\n        } return this.__shady_native_textContent; }, set textContent(a) {\r\n            if (\"undefined\" ===\r\n                typeof a || null === a)\r\n                a = \"\";\r\n            switch (this.nodeType) {\r\n                case Node.ELEMENT_NODE:\r\n                case Node.DOCUMENT_FRAGMENT_NODE:\r\n                    if (!u(this) && t.f) {\r\n                        var b = this.__shady_firstChild;\r\n                        (b != this.__shady_lastChild || b && b.nodeType != Node.TEXT_NODE) && Ma(this);\r\n                        this.__shady_native_textContent = a;\r\n                    }\r\n                    else\r\n                        Ma(this), (0 < a.length || this.nodeType === Node.ELEMENT_NODE) && this.__shady_insertBefore(document.createTextNode(a));\r\n                    break;\r\n                default: this.nodeValue = a;\r\n            }\r\n        }, insertBefore: function (a, b) {\r\n            if (this.ownerDocument !== Ia && a.ownerDocument !== Ia)\r\n                return this.__shady_native_insertBefore(a, b), a;\r\n            if (a === this)\r\n                throw Error(\"Failed to execute 'appendChild' on 'Node': The new child element contains the parent.\");\r\n            if (b) {\r\n                var c = r(b);\r\n                c = c && c.parentNode;\r\n                if (void 0 !== c && c !== this || void 0 === c && b.__shady_native_parentNode !== this)\r\n                    throw Error(\"Failed to execute 'insertBefore' on 'Node': The node before which the new node is to be inserted is not a child of this node.\");\r\n            }\r\n            if (b === a)\r\n                return a;\r\n            var d = [], e = (c = G(this)) ? c.host.localName : H(this), f = a.__shady_parentNode;\r\n            if (f) {\r\n                var g = H(a);\r\n                var h = !!c || !G(a) || Ja && void 0 !==\r\n                    this.__noInsertionPoint;\r\n                f.__shady_removeChild(a, h);\r\n            }\r\n            f = !0;\r\n            var l = (!Ja || void 0 === a.__noInsertionPoint && void 0 === this.__noInsertionPoint) && !Ra(a, e), k = c && !a.__noInsertionPoint && (!Ja || a.nodeType === Node.DOCUMENT_FRAGMENT_NODE);\r\n            if (k || l)\r\n                l && (g = g || H(a)), Sa(a, function (a) { k && \"slot\" === a.localName && d.push(a); if (l) {\r\n                    var b = g;\r\n                    I() && (b && Ta(a, b), (b = I()) && b.scopeNode(a, e));\r\n                } });\r\n            d.length && (Ua(c), c.c.push.apply(c.c, d instanceof Array ? d : ca(ba(d))), J(c));\r\n            u(this) && (Ga(a, this, b), c = r(this), ka(this) ? (J(c.root), f = !1) : c.root && (f = !1));\r\n            f ? (c = v(this) ? this.host : this, b ? (b = Oa(b), c.__shady_native_insertBefore(a, b)) : c.__shady_native_appendChild(a)) : a.ownerDocument !== this.ownerDocument && this.ownerDocument.adoptNode(a);\r\n            Pa(this, a);\r\n            return a;\r\n        }, appendChild: function (a) { if (this != a || !v(a))\r\n            return this.__shady_insertBefore(a); }, removeChild: function (a, b) {\r\n            b = void 0 === b ? !1 : b;\r\n            if (this.ownerDocument !== Ia)\r\n                return this.__shady_native_removeChild(a);\r\n            if (a.__shady_parentNode !== this)\r\n                throw Error(\"The node to be removed is not a child of this node: \" + a);\r\n            var c = G(a), d = c && Va(c, a), e = r(this);\r\n            if (u(this) && (Ha(a, this), ka(this))) {\r\n                J(e.root);\r\n                var f = !0;\r\n            }\r\n            if (I() && !b && c && a.nodeType !== Node.TEXT_NODE) {\r\n                var g = H(a);\r\n                Sa(a, function (a) { Ta(a, g); });\r\n            }\r\n            Na(a);\r\n            c && ((b = this && \"slot\" === this.localName) && (f = !0), (d || b) && J(c));\r\n            f || (f = v(this) ? this.host : this, (!e.root && \"slot\" !== a.localName || f === a.__shady_native_parentNode) && f.__shady_native_removeChild(a));\r\n            Pa(this, null, a);\r\n            return a;\r\n        }, replaceChild: function (a, b) { this.__shady_insertBefore(a, b); this.__shady_removeChild(b); return a; }, cloneNode: function (a) {\r\n            if (\"template\" ==\r\n                this.localName)\r\n                return this.__shady_native_cloneNode(a);\r\n            var b = this.__shady_native_cloneNode(!1);\r\n            if (a && b.nodeType !== Node.ATTRIBUTE_NODE) {\r\n                a = this.__shady_firstChild;\r\n                for (var c; a; a = a.__shady_nextSibling)\r\n                    c = a.__shady_cloneNode(!0), b.__shady_appendChild(c);\r\n            }\r\n            return b;\r\n        }, getRootNode: function (a) { if (this && this.nodeType) {\r\n            var b = q(this), c = b.A;\r\n            void 0 === c && (v(this) ? (c = this, b.A = c) : (c = (c = this.__shady_parentNode) ? c.__shady_getRootNode(a) : this, document.documentElement.__shady_native_contains(this) && (b.A = c)));\r\n            return c;\r\n        } }, contains: function (a) {\r\n            return sa(this, a);\r\n        } });\r\n    function Wa(a, b, c) { var d = []; Xa(a, b, c, d); return d; }\r\n    function Xa(a, b, c, d) { for (a = a.__shady_firstChild; a; a = a.__shady_nextSibling) {\r\n        var e;\r\n        if (e = a.nodeType === Node.ELEMENT_NODE) {\r\n            e = a;\r\n            var f = b, g = c, h = d, l = f(e);\r\n            l && h.push(e);\r\n            g && g(l) ? e = l : (Xa(e, f, g, h), e = void 0);\r\n        }\r\n        if (e)\r\n            break;\r\n    } }\r\n    var M = z({ get firstElementChild() { var a = r(this); if (a && void 0 !== a.firstChild) {\r\n            for (a = this.__shady_firstChild; a && a.nodeType !== Node.ELEMENT_NODE;)\r\n                a = a.__shady_nextSibling;\r\n            return a;\r\n        } return this.__shady_native_firstElementChild; }, get lastElementChild() { var a = r(this); if (a && void 0 !== a.lastChild) {\r\n            for (a = this.__shady_lastChild; a && a.nodeType !== Node.ELEMENT_NODE;)\r\n                a = a.__shady_previousSibling;\r\n            return a;\r\n        } return this.__shady_native_lastElementChild; }, get children() {\r\n            return u(this) ? ta(Array.prototype.filter.call(wa(this), function (a) { return a.nodeType === Node.ELEMENT_NODE; })) : this.__shady_native_children;\r\n        }, get childElementCount() { var a = this.__shady_children; return a ? a.length : 0; } }), Ya = z({ querySelector: function (a) { return Wa(this, function (b) { return ma.call(b, a); }, function (a) { return !!a; })[0] || null; }, querySelectorAll: function (a, b) {\r\n            if (b) {\r\n                b = Array.prototype.slice.call(this.__shady_native_querySelectorAll(a));\r\n                var c = this.__shady_getRootNode();\r\n                return b.filter(function (a) { return a.__shady_getRootNode() == c; });\r\n            }\r\n            return Wa(this, function (b) {\r\n                return ma.call(b, a);\r\n            });\r\n        } }), Za = t.J && !t.g ? Object.assign({}, M) : M;\r\n    Object.assign(M, Ya);\r\n    var $a = z({ getElementById: function (a) { return \"\" === a ? null : Wa(this, function (b) { return b.id == a; }, function (a) { return !!a; })[0] || null; } });\r\n    var ab = z({ get activeElement() { var a = t.f ? document.__shady_native_activeElement : document.activeElement; if (!a || !a.nodeType)\r\n            return null; var b = !!v(this); if (!(this === document || b && this.host !== a && this.host.__shady_native_contains(a)))\r\n            return null; for (b = G(a); b && b !== this;)\r\n            a = b.host, b = G(a); return this === document ? b ? null : a : b === this ? a : null; } });\r\n    var bb = /[&\\u00A0\"]/g, cb = /[&\\u00A0<>]/g;\r\n    function db(a) { switch (a) {\r\n        case \"&\": return \"&amp;\";\r\n        case \"<\": return \"&lt;\";\r\n        case \">\": return \"&gt;\";\r\n        case '\"': return \"&quot;\";\r\n        case \"\\u00a0\": return \"&nbsp;\";\r\n    } }\r\n    function eb(a) { for (var b = {}, c = 0; c < a.length; c++)\r\n        b[a[c]] = !0; return b; }\r\n    var fb = eb(\"area base br col command embed hr img input keygen link meta param source track wbr\".split(\" \")), gb = eb(\"style script xmp iframe noembed noframes plaintext noscript\".split(\" \"));\r\n    function hb(a, b) {\r\n        \"template\" === a.localName && (a = a.content);\r\n        for (var c = \"\", d = b ? b(a) : a.childNodes, e = 0, f = d.length, g = void 0; e < f && (g = d[e]); e++) {\r\n            a: {\r\n                var h = g;\r\n                var l = a, k = b;\r\n                switch (h.nodeType) {\r\n                    case Node.ELEMENT_NODE:\r\n                        l = h.localName;\r\n                        for (var p = \"<\" + l, w = h.attributes, K = 0, ua; ua = w[K]; K++)\r\n                            p += \" \" + ua.name + '=\"' + ua.value.replace(bb, db) + '\"';\r\n                        p += \">\";\r\n                        h = fb[l] ? p : p + hb(h, k) + \"</\" + l + \">\";\r\n                        break a;\r\n                    case Node.TEXT_NODE:\r\n                        h = h.data;\r\n                        h = l && gb[l.localName] ? h : h.replace(cb, db);\r\n                        break a;\r\n                    case Node.COMMENT_NODE:\r\n                        h = \"\\x3c!--\" + h.data + \"--\\x3e\";\r\n                        break a;\r\n                    default: throw window.console.error(h),\r\n                        Error(\"not implemented\");\r\n                }\r\n            }\r\n            c += h;\r\n        }\r\n        return c;\r\n    }\r\n    ;\r\n    var ib = document.implementation.createHTMLDocument(\"inert\"), jb = z({ get innerHTML() { return u(this) ? hb(\"template\" === this.localName ? this.content : this, wa) : this.__shady_native_innerHTML; }, set innerHTML(a) { if (\"template\" === this.localName)\r\n            this.__shady_native_innerHTML = a;\r\n        else {\r\n            Ma(this);\r\n            var b = this.localName || \"div\";\r\n            b = this.namespaceURI && this.namespaceURI !== ib.namespaceURI ? ib.createElementNS(this.namespaceURI, b) : ib.createElement(b);\r\n            for (t.f ? b.__shady_native_innerHTML = a : b.innerHTML = a; a = b.__shady_firstChild;)\r\n                this.__shady_insertBefore(a);\r\n        } } });\r\n    var kb = z({ addEventListener: function (a, b, c) { \"object\" !== typeof c && (c = { capture: !!c }); c.i = c.i || this; this.host.__shady_addEventListener(a, b, c); }, removeEventListener: function (a, b, c) { \"object\" !== typeof c && (c = { capture: !!c }); c.i = c.i || this; this.host.__shady_removeEventListener(a, b, c); } });\r\n    function lb(a, b) { y(a, kb, b); y(a, ab, b); y(a, jb, b); y(a, M, b); t.g && !b ? (y(a, L, b), y(a, $a, b)) : t.f || (y(a, E), y(a, C), y(a, D)); }\r\n    ;\r\n    var mb = {}, N = t.deferConnectionCallbacks && \"loading\" === document.readyState, O;\r\n    function nb(a) { var b = []; do\r\n        b.unshift(a);\r\n    while (a = a.__shady_parentNode); return b; }\r\n    function P(a, b, c) { if (a !== mb)\r\n        throw new TypeError(\"Illegal constructor\"); this.a = null; ob(this, b, c); }\r\n    function ob(a, b, c) { a.R = \"ShadyRoot\"; a.host = b; a.mode = c && c.mode; F(a.host); b = q(a.host); b.root = a; b.V = \"closed\" !== a.mode ? a : null; b = q(a); b.firstChild = b.lastChild = b.parentNode = b.nextSibling = b.previousSibling = null; if (t.preferPerformance)\r\n        for (; b = a.host.__shady_native_firstChild;)\r\n            a.host.__shady_native_removeChild(b);\r\n    else\r\n        J(a); }\r\n    function J(a) { a.j || (a.j = !0, ya(function () { return Q(a); })); }\r\n    function Q(a) { var b; if (b = a.j) {\r\n        for (var c; a;)\r\n            a: {\r\n                a.j && (c = a), b = a;\r\n                a = b.host.__shady_getRootNode();\r\n                if (v(a) && (b = r(b.host)) && 0 < b.u)\r\n                    break a;\r\n                a = void 0;\r\n            }\r\n        b = c;\r\n    } (c = b) && c._renderSelf(); }\r\n    P.prototype._renderSelf = function () {\r\n        var a = N;\r\n        N = !0;\r\n        this.j = !1;\r\n        if (this.a) {\r\n            R(this);\r\n            for (var b = 0, c; b < this.a.length; b++) {\r\n                c = this.a[b];\r\n                var d = r(c), e = d.assignedNodes;\r\n                d.assignedNodes = [];\r\n                d.l = [];\r\n                if (d.H = e)\r\n                    for (d = 0; d < e.length; d++) {\r\n                        var f = r(e[d]);\r\n                        f.C = f.assignedSlot;\r\n                        f.assignedSlot === c && (f.assignedSlot = null);\r\n                    }\r\n            }\r\n            for (b = this.host.__shady_firstChild; b; b = b.__shady_nextSibling)\r\n                pb(this, b);\r\n            for (b = 0; b < this.a.length; b++) {\r\n                c = this.a[b];\r\n                e = r(c);\r\n                if (!e.assignedNodes.length)\r\n                    for (d = c.__shady_firstChild; d; d = d.__shady_nextSibling)\r\n                        pb(this, d, c);\r\n                (d = (d = r(c.__shady_parentNode)) && d.root) && (la(d) || d.j) && d._renderSelf();\r\n                qb(this, e.l, e.assignedNodes);\r\n                if (d = e.H) {\r\n                    for (f = 0; f < d.length; f++)\r\n                        r(d[f]).C = null;\r\n                    e.H = null;\r\n                    d.length > e.assignedNodes.length && (e.D = !0);\r\n                }\r\n                e.D && (e.D = !1, rb(this, c));\r\n            }\r\n            c = this.a;\r\n            b = [];\r\n            for (e = 0; e < c.length; e++)\r\n                d = c[e].__shady_parentNode, (f = r(d)) && f.root || !(0 > b.indexOf(d)) || b.push(d);\r\n            for (c = 0; c < b.length; c++) {\r\n                f = b[c];\r\n                e = f === this ? this.host : f;\r\n                d = [];\r\n                for (f = f.__shady_firstChild; f; f = f.__shady_nextSibling)\r\n                    if (\"slot\" == f.localName)\r\n                        for (var g = r(f).l, h = 0; h < g.length; h++)\r\n                            d.push(g[h]);\r\n                    else\r\n                        d.push(f);\r\n                f = va(e);\r\n                g = ea(d, d.length, f, f.length);\r\n                for (var l = h = 0, k = void 0; h < g.length && (k = g[h]); h++) {\r\n                    for (var p = 0, w = void 0; p < k.o.length && (w = k.o[p]); p++)\r\n                        w.__shady_native_parentNode === e && e.__shady_native_removeChild(w), f.splice(k.index + l, 1);\r\n                    l -= k.v;\r\n                }\r\n                l = 0;\r\n                for (k = void 0; l < g.length && (k = g[l]); l++)\r\n                    for (h = f[k.index], p = k.index; p < k.index + k.v; p++)\r\n                        w = d[p], e.__shady_native_insertBefore(w, h), f.splice(p, 0, w);\r\n            }\r\n        }\r\n        if (!t.preferPerformance && !this.G)\r\n            for (b = this.host.__shady_firstChild; b; b = b.__shady_nextSibling)\r\n                c = r(b), b.__shady_native_parentNode !==\r\n                    this.host || \"slot\" !== b.localName && c.assignedSlot || this.host.__shady_native_removeChild(b);\r\n        this.G = !0;\r\n        N = a;\r\n        O && O();\r\n    };\r\n    function pb(a, b, c) { var d = q(b), e = d.C; d.C = null; c || (c = (a = a.b[b.__shady_slot || \"__catchall\"]) && a[0]); c ? (q(c).assignedNodes.push(b), d.assignedSlot = c) : d.assignedSlot = void 0; e !== d.assignedSlot && d.assignedSlot && (q(d.assignedSlot).D = !0); }\r\n    function qb(a, b, c) { for (var d = 0, e = void 0; d < c.length && (e = c[d]); d++)\r\n        if (\"slot\" == e.localName) {\r\n            var f = r(e).assignedNodes;\r\n            f && f.length && qb(a, b, f);\r\n        }\r\n        else\r\n            b.push(c[d]); }\r\n    function rb(a, b) { b.__shady_native_dispatchEvent(new Event(\"slotchange\")); b = r(b); b.assignedSlot && rb(a, b.assignedSlot); }\r\n    function Ua(a) { a.c = a.c || []; a.a = a.a || []; a.b = a.b || {}; }\r\n    function R(a) { if (a.c && a.c.length) {\r\n        for (var b = a.c, c, d = 0; d < b.length; d++) {\r\n            var e = b[d];\r\n            F(e);\r\n            var f = e.__shady_parentNode;\r\n            F(f);\r\n            f = r(f);\r\n            f.u = (f.u || 0) + 1;\r\n            f = sb(e);\r\n            a.b[f] ? (c = c || {}, c[f] = !0, a.b[f].push(e)) : a.b[f] = [e];\r\n            a.a.push(e);\r\n        }\r\n        if (c)\r\n            for (var g in c)\r\n                a.b[g] = tb(a.b[g]);\r\n        a.c = [];\r\n    } }\r\n    function sb(a) { var b = a.name || a.getAttribute(\"name\") || \"__catchall\"; return a.O = b; }\r\n    function tb(a) { return a.sort(function (a, c) { a = nb(a); for (var b = nb(c), e = 0; e < a.length; e++) {\r\n        c = a[e];\r\n        var f = b[e];\r\n        if (c !== f)\r\n            return a = wa(c.__shady_parentNode), a.indexOf(c) - a.indexOf(f);\r\n    } }); }\r\n    function Va(a, b) { if (a.a) {\r\n        R(a);\r\n        var c = a.b, d;\r\n        for (d in c)\r\n            for (var e = c[d], f = 0; f < e.length; f++) {\r\n                var g = e[f];\r\n                if (sa(b, g)) {\r\n                    e.splice(f, 1);\r\n                    var h = a.a.indexOf(g);\r\n                    0 <= h && (a.a.splice(h, 1), (h = r(g.__shady_parentNode)) && h.u && h.u--);\r\n                    f--;\r\n                    g = r(g);\r\n                    if (h = g.l)\r\n                        for (var l = 0; l < h.length; l++) {\r\n                            var k = h[l], p = k.__shady_native_parentNode;\r\n                            p && p.__shady_native_removeChild(k);\r\n                        }\r\n                    g.l = [];\r\n                    g.assignedNodes = [];\r\n                    h = !0;\r\n                }\r\n            }\r\n        return h;\r\n    } }\r\n    function la(a) { R(a); return !(!a.a || !a.a.length); }\r\n    (function (a) {\r\n        a.__proto__ = DocumentFragment.prototype;\r\n        lb(a, \"__shady_\");\r\n        lb(a);\r\n        Object.defineProperties(a, { nodeType: { value: Node.DOCUMENT_FRAGMENT_NODE, configurable: !0 }, nodeName: { value: \"#document-fragment\", configurable: !0 }, nodeValue: { value: null, configurable: !0 } });\r\n        [\"localName\", \"namespaceURI\", \"prefix\"].forEach(function (b) { Object.defineProperty(a, b, { value: void 0, configurable: !0 }); });\r\n        [\"ownerDocument\", \"baseURI\", \"isConnected\"].forEach(function (b) {\r\n            Object.defineProperty(a, b, { get: function () { return this.host[b]; },\r\n                configurable: !0 });\r\n        });\r\n    })(P.prototype);\r\n    if (window.customElements && t.F && !t.preferPerformance) {\r\n        var S = new Map;\r\n        O = function () { var a = []; S.forEach(function (b, c) { a.push([c, b]); }); S.clear(); for (var b = 0; b < a.length; b++) {\r\n            var c = a[b][0];\r\n            a[b][1] ? c.__shadydom_connectedCallback() : c.__shadydom_disconnectedCallback();\r\n        } };\r\n        N && document.addEventListener(\"readystatechange\", function () { N = !1; O(); }, { once: !0 });\r\n        var ub = function (a, b, c) {\r\n            var d = 0, e = \"__isConnected\" + d++;\r\n            if (b || c)\r\n                a.prototype.connectedCallback = a.prototype.__shadydom_connectedCallback = function () {\r\n                    N ? S.set(this, !0) : this[e] ||\r\n                        (this[e] = !0, b && b.call(this));\r\n                }, a.prototype.disconnectedCallback = a.prototype.__shadydom_disconnectedCallback = function () { N ? this.isConnected || S.set(this, !1) : this[e] && (this[e] = !1, c && c.call(this)); };\r\n            return a;\r\n        }, vb = window.customElements.define, wb = function (a, b) { var c = b.prototype.connectedCallback, d = b.prototype.disconnectedCallback; vb.call(window.customElements, a, ub(b, c, d)); b.prototype.connectedCallback = c; b.prototype.disconnectedCallback = d; };\r\n        window.customElements.define = wb;\r\n        Object.defineProperty(window.CustomElementRegistry.prototype, \"define\", { value: wb, configurable: !0 });\r\n    }\r\n    function G(a) { a = a.__shady_getRootNode(); if (v(a))\r\n        return a; }\r\n    ;\r\n    function xb() { this.a = !1; this.addedNodes = []; this.removedNodes = []; this.w = new Set; }\r\n    function Qa(a) { a.a || (a.a = !0, qa(function () { a.flush(); })); }\r\n    xb.prototype.flush = function () { if (this.a) {\r\n        this.a = !1;\r\n        var a = this.takeRecords();\r\n        a.length && this.w.forEach(function (b) { b(a); });\r\n    } };\r\n    xb.prototype.takeRecords = function () { if (this.addedNodes.length || this.removedNodes.length) {\r\n        var a = [{ addedNodes: this.addedNodes, removedNodes: this.removedNodes }];\r\n        this.addedNodes = [];\r\n        this.removedNodes = [];\r\n        return a;\r\n    } return []; };\r\n    function yb(a, b) { var c = q(a); c.m || (c.m = new xb); c.m.w.add(b); var d = c.m; return { P: b, T: d, S: a, takeRecords: function () { return d.takeRecords(); } }; }\r\n    function zb(a) { var b = a && a.T; b && (b.w.delete(a.P), b.w.size || (q(a.S).m = null)); }\r\n    function Ab(a, b) { var c = b.getRootNode(); return a.map(function (a) { var b = c === a.target.getRootNode(); if (b && a.addedNodes) {\r\n        if (b = Array.from(a.addedNodes).filter(function (a) { return c === a.getRootNode(); }), b.length)\r\n            return a = Object.create(a), Object.defineProperty(a, \"addedNodes\", { value: b, configurable: !0 }), a;\r\n    }\r\n    else if (b)\r\n        return a; }).filter(function (a) { return a; }); }\r\n    ;\r\n    var T = \"__eventWrappers\" + Date.now(), Bb = function () { var a = Object.getOwnPropertyDescriptor(Event.prototype, \"composed\"); return a ? function (b) { return a.get.call(b); } : null; }(), Cb = function () { function a() { } var b = !1, c = { get capture() { b = !0; } }; window.addEventListener(\"test\", a, c); window.removeEventListener(\"test\", a, c); return b; }();\r\n    function Db(a) { if (a && \"object\" === typeof a) {\r\n        var b = !!a.capture;\r\n        var c = !!a.once;\r\n        var d = !!a.passive;\r\n        var e = a.i;\r\n    }\r\n    else\r\n        b = !!a, d = c = !1; return { K: e, capture: b, once: c, passive: d, I: Cb ? a : b }; }\r\n    var Eb = { blur: !0, focus: !0, focusin: !0, focusout: !0, click: !0, dblclick: !0, mousedown: !0, mouseenter: !0, mouseleave: !0, mousemove: !0, mouseout: !0, mouseover: !0, mouseup: !0, wheel: !0, beforeinput: !0, input: !0, keydown: !0, keyup: !0, compositionstart: !0, compositionupdate: !0, compositionend: !0, touchstart: !0, touchend: !0, touchmove: !0, touchcancel: !0, pointerover: !0, pointerenter: !0, pointerdown: !0, pointermove: !0, pointerup: !0, pointercancel: !0, pointerout: !0, pointerleave: !0, gotpointercapture: !0, lostpointercapture: !0, dragstart: !0,\r\n        drag: !0, dragenter: !0, dragleave: !0, dragover: !0, drop: !0, dragend: !0, DOMActivate: !0, DOMFocusIn: !0, DOMFocusOut: !0, keypress: !0 }, Fb = { DOMAttrModified: !0, DOMAttributeNameChanged: !0, DOMCharacterDataModified: !0, DOMElementNameChanged: !0, DOMNodeInserted: !0, DOMNodeInsertedIntoDocument: !0, DOMNodeRemoved: !0, DOMNodeRemovedFromDocument: !0, DOMSubtreeModified: !0 };\r\n    function Gb(a) { return a instanceof Node ? a.__shady_getRootNode() : a; }\r\n    function Hb(a, b) { var c = [], d = a; for (a = Gb(a); d;)\r\n        c.push(d), d.__shady_assignedSlot ? d = d.__shady_assignedSlot : d.nodeType === Node.DOCUMENT_FRAGMENT_NODE && d.host && (b || d !== a) ? d = d.host : d = d.__shady_parentNode; c[c.length - 1] === document && c.push(window); return c; }\r\n    function Ib(a) { a.__composedPath || (a.__composedPath = Hb(a.target, !0)); return a.__composedPath; }\r\n    function Jb(a, b) { if (!v)\r\n        return a; a = Hb(a, !0); for (var c = 0, d, e = void 0, f, g = void 0; c < b.length; c++)\r\n        if (d = b[c], f = Gb(d), f !== e && (g = a.indexOf(f), e = f), !v(f) || -1 < g)\r\n            return d; }\r\n    function Kb(a) { function b(b, d) { b = new a(b, d); b.__composed = d && !!d.composed; return b; } b.__proto__ = a; b.prototype = a.prototype; return b; }\r\n    var Lb = { focus: !0, blur: !0 };\r\n    function Mb(a) { return a.__target !== a.target || a.__relatedTarget !== a.relatedTarget; }\r\n    function Nb(a, b, c) { if (c = b.__handlers && b.__handlers[a.type] && b.__handlers[a.type][c])\r\n        for (var d = 0, e; (e = c[d]) && (!Mb(a) || a.target !== a.relatedTarget) && (e.call(b, a), !a.__immediatePropagationStopped); d++)\r\n            ; }\r\n    function Ob(a) { var b = a.composedPath(); Object.defineProperty(a, \"currentTarget\", { get: function () { return d; }, configurable: !0 }); for (var c = b.length - 1; 0 <= c; c--) {\r\n        var d = b[c];\r\n        Nb(a, d, \"capture\");\r\n        if (a.B)\r\n            return;\r\n    } Object.defineProperty(a, \"eventPhase\", { get: function () { return Event.AT_TARGET; } }); var e; for (c = 0; c < b.length; c++) {\r\n        d = b[c];\r\n        var f = r(d);\r\n        f = f && f.root;\r\n        if (0 === c || f && f === e)\r\n            if (Nb(a, d, \"bubble\"), d !== window && (e = d.__shady_getRootNode()), a.B)\r\n                break;\r\n    } }\r\n    function Pb(a, b, c, d, e, f) { for (var g = 0; g < a.length; g++) {\r\n        var h = a[g], l = h.type, k = h.capture, p = h.once, w = h.passive;\r\n        if (b === h.node && c === l && d === k && e === p && f === w)\r\n            return g;\r\n    } return -1; }\r\n    function Qb(a, b, c) {\r\n        var d = Db(c), e = d.capture, f = d.once, g = d.passive, h = d.K;\r\n        d = d.I;\r\n        if (b) {\r\n            var l = typeof b;\r\n            if (\"function\" === l || \"object\" === l)\r\n                if (\"object\" !== l || b.handleEvent && \"function\" === typeof b.handleEvent) {\r\n                    if (Fb[a])\r\n                        return this.__shady_native_addEventListener(a, b, d);\r\n                    var k = h || this;\r\n                    if (h = b[T]) {\r\n                        if (-1 < Pb(h, k, a, e, f, g))\r\n                            return;\r\n                    }\r\n                    else\r\n                        b[T] = [];\r\n                    h = function (d) {\r\n                        f && this.__shady_removeEventListener(a, b, c);\r\n                        d.__target || Rb(d);\r\n                        if (k !== this) {\r\n                            var e = Object.getOwnPropertyDescriptor(d, \"currentTarget\");\r\n                            Object.defineProperty(d, \"currentTarget\", { get: function () { return k; }, configurable: !0 });\r\n                        }\r\n                        d.__previousCurrentTarget = d.currentTarget;\r\n                        if (!v(k) && \"slot\" !== k.localName || -1 != d.composedPath().indexOf(k))\r\n                            if (d.composed || -1 < d.composedPath().indexOf(k))\r\n                                if (Mb(d) && d.target === d.relatedTarget)\r\n                                    d.eventPhase === Event.BUBBLING_PHASE && d.stopImmediatePropagation();\r\n                                else if (d.eventPhase === Event.CAPTURING_PHASE || d.bubbles || d.target === k || k instanceof Window) {\r\n                                    var g = \"function\" === l ? b.call(k, d) : b.handleEvent && b.handleEvent(d);\r\n                                    k !== this && (e ? (Object.defineProperty(d, \"currentTarget\", e), e = null) : delete d.currentTarget);\r\n                                    return g;\r\n                                }\r\n                    };\r\n                    b[T].push({ node: k, type: a, capture: e, once: f, passive: g, W: h });\r\n                    Lb[a] ? (this.__handlers = this.__handlers || {}, this.__handlers[a] = this.__handlers[a] || { capture: [], bubble: [] }, this.__handlers[a][e ? \"capture\" : \"bubble\"].push(h)) : this.__shady_native_addEventListener(a, h, d);\r\n                }\r\n        }\r\n    }\r\n    function Sb(a, b, c) { if (b) {\r\n        var d = Db(c);\r\n        c = d.capture;\r\n        var e = d.once, f = d.passive, g = d.K;\r\n        d = d.I;\r\n        if (Fb[a])\r\n            return this.__shady_native_removeEventListener(a, b, d);\r\n        var h = g || this;\r\n        g = void 0;\r\n        var l = null;\r\n        try {\r\n            l = b[T];\r\n        }\r\n        catch (k) { }\r\n        l && (e = Pb(l, h, a, c, e, f), -1 < e && (g = l.splice(e, 1)[0].W, l.length || (b[T] = void 0)));\r\n        this.__shady_native_removeEventListener(a, g || b, d);\r\n        g && Lb[a] && this.__handlers && this.__handlers[a] && (a = this.__handlers[a][c ? \"capture\" : \"bubble\"], b = a.indexOf(g), -1 < b && a.splice(b, 1));\r\n    } }\r\n    function Tb() { for (var a in Lb)\r\n        window.__shady_native_addEventListener(a, function (a) { a.__target || (Rb(a), Ob(a)); }, !0); }\r\n    var Ub = z({ get composed() { void 0 === this.__composed && (Bb ? this.__composed = \"focusin\" === this.type || \"focusout\" === this.type || Bb(this) : !1 !== this.isTrusted && (this.__composed = Eb[this.type])); return this.__composed || !1; }, composedPath: function () { this.__composedPath || (this.__composedPath = Hb(this.__target, this.composed)); return this.__composedPath; }, get target() { return Jb(this.currentTarget || this.__previousCurrentTarget, this.composedPath()); }, get relatedTarget() {\r\n            if (!this.__relatedTarget)\r\n                return null;\r\n            this.__relatedTargetComposedPath ||\r\n                (this.__relatedTargetComposedPath = Hb(this.__relatedTarget, !0));\r\n            return Jb(this.currentTarget || this.__previousCurrentTarget, this.__relatedTargetComposedPath);\r\n        }, stopPropagation: function () { Event.prototype.stopPropagation.call(this); this.B = !0; }, stopImmediatePropagation: function () { Event.prototype.stopImmediatePropagation.call(this); this.B = this.__immediatePropagationStopped = !0; } });\r\n    function Rb(a) { a.__target = a.target; a.__relatedTarget = a.relatedTarget; if (t.f) {\r\n        var b = Object.getPrototypeOf(a);\r\n        if (!Object.hasOwnProperty(b, \"__shady_patchedProto\")) {\r\n            var c = Object.create(b);\r\n            c.__shady_sourceProto = b;\r\n            y(c, Ub);\r\n            b.__shady_patchedProto = c;\r\n        }\r\n        a.__proto__ = b.__shady_patchedProto;\r\n    }\r\n    else\r\n        y(a, Ub); }\r\n    var Vb = Kb(Event), Wb = Kb(CustomEvent), Xb = Kb(MouseEvent);\r\n    function Yb() { if (!Bb && Object.getOwnPropertyDescriptor(Event.prototype, \"isTrusted\")) {\r\n        var a = function () { var a = new MouseEvent(\"click\", { bubbles: !0, cancelable: !0, composed: !0 }); this.__shady_dispatchEvent(a); };\r\n        Element.prototype.click ? Element.prototype.click = a : HTMLElement.prototype.click && (HTMLElement.prototype.click = a);\r\n    } }\r\n    var Zb = Object.getOwnPropertyNames(Document.prototype).filter(function (a) { return \"on\" === a.substring(0, 2); });\r\n    var $b = t.f, ac = { querySelector: function (a) { return this.__shady_native_querySelector(a); }, querySelectorAll: function (a) { return this.__shady_native_querySelectorAll(a); } }, bc = {};\r\n    function cc(a) { bc[a] = function (b) { return b[\"__shady_native_\" + a]; }; }\r\n    function U(a, b) { y(a, b, \"__shady_native_\"); for (var c in b)\r\n        cc(c); }\r\n    function V(a, b) { b = void 0 === b ? [] : b; for (var c = 0; c < b.length; c++) {\r\n        var d = b[c], e = Object.getOwnPropertyDescriptor(a, d);\r\n        e && (Object.defineProperty(a, \"__shady_native_\" + d, e), e.value ? ac[d] || (ac[d] = e.value) : cc(d));\r\n    } }\r\n    var W = document.createTreeWalker(document, NodeFilter.SHOW_ALL, null, !1), X = document.createTreeWalker(document, NodeFilter.SHOW_ELEMENT, null, !1), dc = document.implementation.createHTMLDocument(\"inert\");\r\n    function ec(a) { for (var b; b = a.__shady_native_firstChild;)\r\n        a.__shady_native_removeChild(b); }\r\n    var fc = [\"firstElementChild\", \"lastElementChild\", \"children\", \"childElementCount\"], gc = [\"querySelector\", \"querySelectorAll\"];\r\n    function hc() {\r\n        var a = [\"dispatchEvent\", \"addEventListener\", \"removeEventListener\"];\r\n        window.EventTarget ? V(window.EventTarget.prototype, a) : (V(Node.prototype, a), V(Window.prototype, a));\r\n        $b ? V(Node.prototype, \"parentNode firstChild lastChild previousSibling nextSibling childNodes parentElement textContent\".split(\" \")) : U(Node.prototype, { parentNode: { get: function () { W.currentNode = this; return W.parentNode(); } }, firstChild: { get: function () { W.currentNode = this; return W.firstChild(); } }, lastChild: { get: function () {\r\n                    W.currentNode =\r\n                        this;\r\n                    return W.lastChild();\r\n                } }, previousSibling: { get: function () { W.currentNode = this; return W.previousSibling(); } }, nextSibling: { get: function () { W.currentNode = this; return W.nextSibling(); } }, childNodes: { get: function () { var a = []; W.currentNode = this; for (var c = W.firstChild(); c;)\r\n                    a.push(c), c = W.nextSibling(); return a; } }, parentElement: { get: function () { X.currentNode = this; return X.parentNode(); } }, textContent: { get: function () {\r\n                    switch (this.nodeType) {\r\n                        case Node.ELEMENT_NODE:\r\n                        case Node.DOCUMENT_FRAGMENT_NODE:\r\n                            for (var a = document.createTreeWalker(this, NodeFilter.SHOW_TEXT, null, !1), c = \"\", d; d = a.nextNode();)\r\n                                c += d.nodeValue;\r\n                            return c;\r\n                        default: return this.nodeValue;\r\n                    }\r\n                }, set: function (a) { if (\"undefined\" === typeof a || null === a)\r\n                    a = \"\"; switch (this.nodeType) {\r\n                    case Node.ELEMENT_NODE:\r\n                    case Node.DOCUMENT_FRAGMENT_NODE:\r\n                        ec(this);\r\n                        (0 < a.length || this.nodeType === Node.ELEMENT_NODE) && this.__shady_native_insertBefore(document.createTextNode(a), void 0);\r\n                        break;\r\n                    default: this.nodeValue = a;\r\n                } } } });\r\n        V(Node.prototype, \"appendChild insertBefore removeChild replaceChild cloneNode contains\".split(\" \"));\r\n        V(HTMLElement.prototype, [\"parentElement\", \"contains\"]);\r\n        a = { firstElementChild: { get: function () { X.currentNode = this; return X.firstChild(); } }, lastElementChild: { get: function () { X.currentNode = this; return X.lastChild(); } }, children: { get: function () { var a = []; X.currentNode = this; for (var c = X.firstChild(); c;)\r\n                    a.push(c), c = X.nextSibling(); return ta(a); } }, childElementCount: { get: function () { return this.children ? this.children.length : 0; } } };\r\n        $b ? (V(Element.prototype, fc), V(Element.prototype, [\"previousElementSibling\", \"nextElementSibling\",\r\n            \"innerHTML\", \"className\"]), V(HTMLElement.prototype, [\"children\", \"innerHTML\", \"className\"])) : (U(Element.prototype, a), U(Element.prototype, { previousElementSibling: { get: function () { X.currentNode = this; return X.previousSibling(); } }, nextElementSibling: { get: function () { X.currentNode = this; return X.nextSibling(); } }, innerHTML: { get: function () { return hb(this, va); }, set: function (a) {\r\n                    var b = \"template\" === this.localName ? this.content : this;\r\n                    ec(b);\r\n                    var d = this.localName || \"div\";\r\n                    d = this.namespaceURI && this.namespaceURI !== dc.namespaceURI ?\r\n                        dc.createElementNS(this.namespaceURI, d) : dc.createElement(d);\r\n                    d.innerHTML = a;\r\n                    for (a = \"template\" === this.localName ? d.content : d; d = a.__shady_native_firstChild;)\r\n                        b.__shady_native_insertBefore(d, void 0);\r\n                } }, className: { get: function () { return this.getAttribute(\"class\") || \"\"; }, set: function (a) { this.setAttribute(\"class\", a); } } }));\r\n        V(Element.prototype, \"setAttribute getAttribute hasAttribute removeAttribute focus blur\".split(\" \"));\r\n        V(Element.prototype, gc);\r\n        V(HTMLElement.prototype, [\"focus\", \"blur\"]);\r\n        window.HTMLTemplateElement &&\r\n            V(window.HTMLTemplateElement.prototype, [\"innerHTML\"]);\r\n        $b ? V(DocumentFragment.prototype, fc) : U(DocumentFragment.prototype, a);\r\n        V(DocumentFragment.prototype, gc);\r\n        $b ? (V(Document.prototype, fc), V(Document.prototype, [\"activeElement\"])) : U(Document.prototype, a);\r\n        V(Document.prototype, [\"importNode\", \"getElementById\"]);\r\n        V(Document.prototype, gc);\r\n    }\r\n    ;\r\n    var ic = z({ dispatchEvent: function (a) { B(); return this.__shady_native_dispatchEvent(a); }, addEventListener: Qb, removeEventListener: Sb });\r\n    var jc = z({ get assignedSlot() { var a = this.__shady_parentNode; (a = a && a.__shady_shadowRoot) && Q(a); return (a = r(this)) && a.assignedSlot || null; } });\r\n    var kc = null;\r\n    function I() { kc || (kc = window.ShadyCSS && window.ShadyCSS.ScopingShim); return kc || null; }\r\n    function Ta(a, b) { var c = I(); c && c.unscopeNode(a, b); }\r\n    function Ra(a, b) { var c = I(); if (!c)\r\n        return !0; if (a.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\r\n        c = !0;\r\n        for (a = a.__shady_firstChild; a; a = a.__shady_nextSibling)\r\n            c = c && Ra(a, b);\r\n        return c;\r\n    } return a.nodeType !== Node.ELEMENT_NODE ? !0 : c.currentScopeForNode(a) === b; }\r\n    function H(a) { if (a.nodeType !== Node.ELEMENT_NODE)\r\n        return \"\"; var b = I(); return b ? b.currentScopeForNode(a) : \"\"; }\r\n    function Sa(a, b) { if (a)\r\n        for (a.nodeType === Node.ELEMENT_NODE && b(a), a = a.__shady_firstChild; a; a = a.__shady_nextSibling)\r\n            a.nodeType === Node.ELEMENT_NODE && Sa(a, b); }\r\n    ;\r\n    var lc = window.document;\r\n    function mc(a, b) { if (\"slot\" === b)\r\n        a = a.__shady_parentNode, ka(a) && J(r(a).root);\r\n    else if (\"slot\" === a.localName && \"name\" === b && (b = G(a))) {\r\n        if (b.a) {\r\n            R(b);\r\n            var c = a.O, d = sb(a);\r\n            if (d !== c) {\r\n                c = b.b[c];\r\n                var e = c.indexOf(a);\r\n                0 <= e && c.splice(e, 1);\r\n                c = b.b[d] || (b.b[d] = []);\r\n                c.push(a);\r\n                1 < c.length && (b.b[d] = tb(c));\r\n            }\r\n        }\r\n        J(b);\r\n    } }\r\n    var nc = z({ get previousElementSibling() { var a = r(this); if (a && void 0 !== a.previousSibling) {\r\n            for (a = this.__shady_previousSibling; a && a.nodeType !== Node.ELEMENT_NODE;)\r\n                a = a.__shady_previousSibling;\r\n            return a;\r\n        } return this.__shady_native_previousElementSibling; }, get nextElementSibling() { var a = r(this); if (a && void 0 !== a.nextSibling) {\r\n            for (a = this.__shady_nextSibling; a && a.nodeType !== Node.ELEMENT_NODE;)\r\n                a = a.__shady_nextSibling;\r\n            return a;\r\n        } return this.__shady_native_nextElementSibling; }, get slot() { return this.getAttribute(\"slot\"); },\r\n        set slot(a) { this.__shady_setAttribute(\"slot\", a); }, get shadowRoot() { var a = r(this); return a && a.V || null; }, get className() { return this.getAttribute(\"class\") || \"\"; }, set className(a) { this.__shady_setAttribute(\"class\", a); }, setAttribute: function (a, b) { if (this.ownerDocument !== lc)\r\n            this.__shady_native_setAttribute(a, b);\r\n        else {\r\n            var c;\r\n            (c = I()) && \"class\" === a ? (c.setElementClass(this, b), c = !0) : c = !1;\r\n            c || (this.__shady_native_setAttribute(a, b), mc(this, a));\r\n        } }, removeAttribute: function (a) {\r\n            this.__shady_native_removeAttribute(a);\r\n            mc(this, a);\r\n        }, attachShadow: function (a) { if (!this)\r\n            throw Error(\"Must provide a host.\"); if (!a)\r\n            throw Error(\"Not enough arguments.\"); if (a.shadyUpgradeFragment && !t.L) {\r\n            var b = a.shadyUpgradeFragment;\r\n            b.__proto__ = ShadowRoot.prototype;\r\n            ob(b, this, a);\r\n            F(b, b);\r\n            a = b.__noInsertionPoint ? null : b.querySelectorAll(\"slot\");\r\n            b.__noInsertionPoint = void 0;\r\n            if (a && a.length) {\r\n                var c = b;\r\n                Ua(c);\r\n                c.c.push.apply(c.c, a instanceof Array ? a : ca(ba(a)));\r\n                J(b);\r\n            }\r\n            b.host.__shady_native_appendChild(b);\r\n        }\r\n        else\r\n            b = new P(mb, this, a); return b; } });\r\n    var oc = z({ blur: function () { var a = r(this); (a = (a = a && a.root) && a.activeElement) ? a.__shady_blur() : this.__shady_native_blur(); } });\r\n    Zb.forEach(function (a) { oc[a] = { set: function (b) { var c = q(this), d = a.substring(2); c.h || (c.h = {}); c.h[a] && this.removeEventListener(d, c.h[a]); this.__shady_addEventListener(d, b); c.h[a] = b; }, get: function () { var b = r(this); return b && b.h && b.h[a]; }, configurable: !0 }; });\r\n    var pc = z({ assignedNodes: function (a) { if (\"slot\" === this.localName) {\r\n            var b = this.__shady_getRootNode();\r\n            b && v(b) && Q(b);\r\n            return (b = r(this)) ? (a && a.flatten ? b.l : b.assignedNodes) || [] : [];\r\n        } }, addEventListener: function (a, b, c) { if (\"slot\" !== this.localName || \"slotchange\" === a)\r\n            Qb.call(this, a, b, c);\r\n        else {\r\n            \"object\" !== typeof c && (c = { capture: !!c });\r\n            var d = this.__shady_parentNode;\r\n            if (!d)\r\n                throw Error(\"ShadyDOM cannot attach event to slot unless it has a `parentNode`\");\r\n            c.i = this;\r\n            d.__shady_addEventListener(a, b, c);\r\n        } }, removeEventListener: function (a, b, c) { if (\"slot\" !== this.localName || \"slotchange\" === a)\r\n            Sb.call(this, a, b, c);\r\n        else {\r\n            \"object\" !== typeof c && (c = { capture: !!c });\r\n            var d = this.__shady_parentNode;\r\n            if (!d)\r\n                throw Error(\"ShadyDOM cannot attach event to slot unless it has a `parentNode`\");\r\n            c.i = this;\r\n            d.__shady_removeEventListener(a, b, c);\r\n        } } });\r\n    var qc = window.document, rc = z({ importNode: function (a, b) { if (a.ownerDocument !== qc || \"template\" === a.localName)\r\n            return this.__shady_native_importNode(a, b); var c = this.__shady_native_importNode(a, !1); if (b)\r\n            for (a = a.__shady_firstChild; a; a = a.__shady_nextSibling)\r\n                b = this.__shady_importNode(a, !0), c.__shady_appendChild(b); return c; } });\r\n    var sc = z({ addEventListener: Qb.bind(window), removeEventListener: Sb.bind(window) });\r\n    var Y = {};\r\n    Object.getOwnPropertyDescriptor(HTMLElement.prototype, \"parentElement\") && (Y.parentElement = L.parentElement);\r\n    Object.getOwnPropertyDescriptor(HTMLElement.prototype, \"contains\") && (Y.contains = L.contains);\r\n    Object.getOwnPropertyDescriptor(HTMLElement.prototype, \"children\") && (Y.children = M.children);\r\n    Object.getOwnPropertyDescriptor(HTMLElement.prototype, \"innerHTML\") && (Y.innerHTML = jb.innerHTML);\r\n    Object.getOwnPropertyDescriptor(HTMLElement.prototype, \"className\") && (Y.className = nc.className);\r\n    var tc = { EventTarget: [ic], Node: [L, window.EventTarget ? null : ic], Text: [jc], Element: [nc, M, jc, !t.f || \"innerHTML\" in Element.prototype ? jb : null, window.HTMLSlotElement ? null : pc], HTMLElement: [oc, Y], HTMLSlotElement: [pc], DocumentFragment: [Za, $a], Document: [rc, Za, $a, ab], Window: [sc] }, uc = t.f ? null : [\"innerHTML\", \"textContent\"];\r\n    function vc(a) { var b = a ? null : uc, c = {}, d; for (d in tc)\r\n        c.s = window[d] && window[d].prototype, tc[d].forEach(function (c) { return function (d) { return c.s && d && y(c.s, d, a, b); }; }(c)), c = { s: c.s }; }\r\n    ;\r\n    function Z(a) { this.node = a; }\r\n    m = Z.prototype;\r\n    m.addEventListener = function (a, b, c) { return this.node.__shady_addEventListener(a, b, c); };\r\n    m.removeEventListener = function (a, b, c) { return this.node.__shady_removeEventListener(a, b, c); };\r\n    m.appendChild = function (a) { return this.node.__shady_appendChild(a); };\r\n    m.insertBefore = function (a, b) { return this.node.__shady_insertBefore(a, b); };\r\n    m.removeChild = function (a) { return this.node.__shady_removeChild(a); };\r\n    m.replaceChild = function (a, b) { return this.node.__shady_replaceChild(a, b); };\r\n    m.cloneNode = function (a) { return this.node.__shady_cloneNode(a); };\r\n    m.getRootNode = function (a) { return this.node.__shady_getRootNode(a); };\r\n    m.contains = function (a) { return this.node.__shady_contains(a); };\r\n    m.dispatchEvent = function (a) { return this.node.__shady_dispatchEvent(a); };\r\n    m.setAttribute = function (a, b) { this.node.__shady_setAttribute(a, b); };\r\n    m.getAttribute = function (a) { return this.node.__shady_native_getAttribute(a); };\r\n    m.removeAttribute = function (a) { this.node.__shady_removeAttribute(a); };\r\n    m.attachShadow = function (a) { return this.node.__shady_attachShadow(a); };\r\n    m.focus = function () { this.node.__shady_native_focus(); };\r\n    m.blur = function () { this.node.__shady_blur(); };\r\n    m.importNode = function (a, b) { if (this.node.nodeType === Node.DOCUMENT_NODE)\r\n        return this.node.__shady_importNode(a, b); };\r\n    m.getElementById = function (a) { if (this.node.nodeType === Node.DOCUMENT_NODE)\r\n        return this.node.__shady_getElementById(a); };\r\n    m.querySelector = function (a) { return this.node.__shady_querySelector(a); };\r\n    m.querySelectorAll = function (a, b) { return this.node.__shady_querySelectorAll(a, b); };\r\n    m.assignedNodes = function (a) { if (\"slot\" === this.node.localName)\r\n        return this.node.__shady_assignedNodes(a); };\r\n    da.Object.defineProperties(Z.prototype, { activeElement: { configurable: !0, enumerable: !0, get: function () { if (v(this.node) || this.node.nodeType === Node.DOCUMENT_NODE)\r\n                return this.node.__shady_activeElement; } }, _activeElement: { configurable: !0, enumerable: !0, get: function () { return this.activeElement; } }, host: { configurable: !0, enumerable: !0, get: function () { if (v(this.node))\r\n                return this.node.host; } }, parentNode: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_parentNode; } }, firstChild: { configurable: !0,\r\n            enumerable: !0, get: function () { return this.node.__shady_firstChild; } }, lastChild: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_lastChild; } }, nextSibling: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_nextSibling; } }, previousSibling: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_previousSibling; } }, childNodes: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_childNodes; } }, parentElement: { configurable: !0, enumerable: !0,\r\n            get: function () { return this.node.__shady_parentElement; } }, firstElementChild: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_firstElementChild; } }, lastElementChild: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_lastElementChild; } }, nextElementSibling: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_nextElementSibling; } }, previousElementSibling: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_previousElementSibling; } },\r\n        children: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_children; } }, childElementCount: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_childElementCount; } }, shadowRoot: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_shadowRoot; } }, assignedSlot: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_assignedSlot; } }, isConnected: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_isConnected; } }, innerHTML: { configurable: !0,\r\n            enumerable: !0, get: function () { return this.node.__shady_innerHTML; }, set: function (a) { this.node.__shady_innerHTML = a; } }, textContent: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_textContent; }, set: function (a) { this.node.__shady_textContent = a; } }, slot: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_slot; }, set: function (a) { this.node.__shady_slot = a; } }, className: { configurable: !0, enumerable: !0, get: function () { return this.node.__shady_className; }, set: function (a) {\r\n                return this.node.__shady_className =\r\n                    a;\r\n            } } });\r\n    Zb.forEach(function (a) { Object.defineProperty(Z.prototype, a, { get: function () { return this.node[\"__shady_\" + a]; }, set: function (b) { this.node[\"__shady_\" + a] = b; }, configurable: !0 }); });\r\n    var wc = new WeakMap;\r\n    function xc(a) { if (v(a) || a instanceof Z)\r\n        return a; var b = wc.get(a); b || (b = new Z(a), wc.set(a, b)); return b; }\r\n    ;\r\n    t.F && (window.ShadyDOM = { inUse: t.F, patch: function (a) { Ea(a); Da(a); return a; }, isShadyRoot: v, enqueue: ya, flush: B, flushInitial: function (a) { !a.G && a.j && Q(a); }, settings: t, filterMutations: Ab, observeChildren: yb, unobserveChildren: zb, deferConnectionCallbacks: t.deferConnectionCallbacks, preferPerformance: t.preferPerformance, handlesDynamicScoping: !0, wrap: t.g ? xc : function (a) { return a; }, Wrapper: Z, composedPath: Ib, noPatch: t.g, nativeMethods: ac, nativeTree: bc }, hc(), vc(\"__shady_\"), Object.defineProperty(document, \"_activeElement\", ab.activeElement), y(Window.prototype, sc, \"__shady_\"), t.g || (vc(), Yb()), Tb(), window.Event = Vb, window.CustomEvent = Wb, window.MouseEvent = Xb, window.ShadowRoot = P);\r\n}).call(this);\r\n\n/* WEBPACK VAR INJECTION */}.call(this, __webpack_require__(/*! ./../../webpack/buildin/global.js */ \"./node_modules/webpack/buildin/global.js\")))\n\n//# sourceURL=webpack:///./node_modules/@webcomponents/shadydom/shadydom.min.js?");

/***/ }),

/***/ "./node_modules/color-name/index.js":
/*!******************************************!*\
  !*** ./node_modules/color-name/index.js ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nmodule.exports = {\r\n    \"aliceblue\": [240, 248, 255],\r\n    \"antiquewhite\": [250, 235, 215],\r\n    \"aqua\": [0, 255, 255],\r\n    \"aquamarine\": [127, 255, 212],\r\n    \"azure\": [240, 255, 255],\r\n    \"beige\": [245, 245, 220],\r\n    \"bisque\": [255, 228, 196],\r\n    \"black\": [0, 0, 0],\r\n    \"blanchedalmond\": [255, 235, 205],\r\n    \"blue\": [0, 0, 255],\r\n    \"blueviolet\": [138, 43, 226],\r\n    \"brown\": [165, 42, 42],\r\n    \"burlywood\": [222, 184, 135],\r\n    \"cadetblue\": [95, 158, 160],\r\n    \"chartreuse\": [127, 255, 0],\r\n    \"chocolate\": [210, 105, 30],\r\n    \"coral\": [255, 127, 80],\r\n    \"cornflowerblue\": [100, 149, 237],\r\n    \"cornsilk\": [255, 248, 220],\r\n    \"crimson\": [220, 20, 60],\r\n    \"cyan\": [0, 255, 255],\r\n    \"darkblue\": [0, 0, 139],\r\n    \"darkcyan\": [0, 139, 139],\r\n    \"darkgoldenrod\": [184, 134, 11],\r\n    \"darkgray\": [169, 169, 169],\r\n    \"darkgreen\": [0, 100, 0],\r\n    \"darkgrey\": [169, 169, 169],\r\n    \"darkkhaki\": [189, 183, 107],\r\n    \"darkmagenta\": [139, 0, 139],\r\n    \"darkolivegreen\": [85, 107, 47],\r\n    \"darkorange\": [255, 140, 0],\r\n    \"darkorchid\": [153, 50, 204],\r\n    \"darkred\": [139, 0, 0],\r\n    \"darksalmon\": [233, 150, 122],\r\n    \"darkseagreen\": [143, 188, 143],\r\n    \"darkslateblue\": [72, 61, 139],\r\n    \"darkslategray\": [47, 79, 79],\r\n    \"darkslategrey\": [47, 79, 79],\r\n    \"darkturquoise\": [0, 206, 209],\r\n    \"darkviolet\": [148, 0, 211],\r\n    \"deeppink\": [255, 20, 147],\r\n    \"deepskyblue\": [0, 191, 255],\r\n    \"dimgray\": [105, 105, 105],\r\n    \"dimgrey\": [105, 105, 105],\r\n    \"dodgerblue\": [30, 144, 255],\r\n    \"firebrick\": [178, 34, 34],\r\n    \"floralwhite\": [255, 250, 240],\r\n    \"forestgreen\": [34, 139, 34],\r\n    \"fuchsia\": [255, 0, 255],\r\n    \"gainsboro\": [220, 220, 220],\r\n    \"ghostwhite\": [248, 248, 255],\r\n    \"gold\": [255, 215, 0],\r\n    \"goldenrod\": [218, 165, 32],\r\n    \"gray\": [128, 128, 128],\r\n    \"green\": [0, 128, 0],\r\n    \"greenyellow\": [173, 255, 47],\r\n    \"grey\": [128, 128, 128],\r\n    \"honeydew\": [240, 255, 240],\r\n    \"hotpink\": [255, 105, 180],\r\n    \"indianred\": [205, 92, 92],\r\n    \"indigo\": [75, 0, 130],\r\n    \"ivory\": [255, 255, 240],\r\n    \"khaki\": [240, 230, 140],\r\n    \"lavender\": [230, 230, 250],\r\n    \"lavenderblush\": [255, 240, 245],\r\n    \"lawngreen\": [124, 252, 0],\r\n    \"lemonchiffon\": [255, 250, 205],\r\n    \"lightblue\": [173, 216, 230],\r\n    \"lightcoral\": [240, 128, 128],\r\n    \"lightcyan\": [224, 255, 255],\r\n    \"lightgoldenrodyellow\": [250, 250, 210],\r\n    \"lightgray\": [211, 211, 211],\r\n    \"lightgreen\": [144, 238, 144],\r\n    \"lightgrey\": [211, 211, 211],\r\n    \"lightpink\": [255, 182, 193],\r\n    \"lightsalmon\": [255, 160, 122],\r\n    \"lightseagreen\": [32, 178, 170],\r\n    \"lightskyblue\": [135, 206, 250],\r\n    \"lightslategray\": [119, 136, 153],\r\n    \"lightslategrey\": [119, 136, 153],\r\n    \"lightsteelblue\": [176, 196, 222],\r\n    \"lightyellow\": [255, 255, 224],\r\n    \"lime\": [0, 255, 0],\r\n    \"limegreen\": [50, 205, 50],\r\n    \"linen\": [250, 240, 230],\r\n    \"magenta\": [255, 0, 255],\r\n    \"maroon\": [128, 0, 0],\r\n    \"mediumaquamarine\": [102, 205, 170],\r\n    \"mediumblue\": [0, 0, 205],\r\n    \"mediumorchid\": [186, 85, 211],\r\n    \"mediumpurple\": [147, 112, 219],\r\n    \"mediumseagreen\": [60, 179, 113],\r\n    \"mediumslateblue\": [123, 104, 238],\r\n    \"mediumspringgreen\": [0, 250, 154],\r\n    \"mediumturquoise\": [72, 209, 204],\r\n    \"mediumvioletred\": [199, 21, 133],\r\n    \"midnightblue\": [25, 25, 112],\r\n    \"mintcream\": [245, 255, 250],\r\n    \"mistyrose\": [255, 228, 225],\r\n    \"moccasin\": [255, 228, 181],\r\n    \"navajowhite\": [255, 222, 173],\r\n    \"navy\": [0, 0, 128],\r\n    \"oldlace\": [253, 245, 230],\r\n    \"olive\": [128, 128, 0],\r\n    \"olivedrab\": [107, 142, 35],\r\n    \"orange\": [255, 165, 0],\r\n    \"orangered\": [255, 69, 0],\r\n    \"orchid\": [218, 112, 214],\r\n    \"palegoldenrod\": [238, 232, 170],\r\n    \"palegreen\": [152, 251, 152],\r\n    \"paleturquoise\": [175, 238, 238],\r\n    \"palevioletred\": [219, 112, 147],\r\n    \"papayawhip\": [255, 239, 213],\r\n    \"peachpuff\": [255, 218, 185],\r\n    \"peru\": [205, 133, 63],\r\n    \"pink\": [255, 192, 203],\r\n    \"plum\": [221, 160, 221],\r\n    \"powderblue\": [176, 224, 230],\r\n    \"purple\": [128, 0, 128],\r\n    \"rebeccapurple\": [102, 51, 153],\r\n    \"red\": [255, 0, 0],\r\n    \"rosybrown\": [188, 143, 143],\r\n    \"royalblue\": [65, 105, 225],\r\n    \"saddlebrown\": [139, 69, 19],\r\n    \"salmon\": [250, 128, 114],\r\n    \"sandybrown\": [244, 164, 96],\r\n    \"seagreen\": [46, 139, 87],\r\n    \"seashell\": [255, 245, 238],\r\n    \"sienna\": [160, 82, 45],\r\n    \"silver\": [192, 192, 192],\r\n    \"skyblue\": [135, 206, 235],\r\n    \"slateblue\": [106, 90, 205],\r\n    \"slategray\": [112, 128, 144],\r\n    \"slategrey\": [112, 128, 144],\r\n    \"snow\": [255, 250, 250],\r\n    \"springgreen\": [0, 255, 127],\r\n    \"steelblue\": [70, 130, 180],\r\n    \"tan\": [210, 180, 140],\r\n    \"teal\": [0, 128, 128],\r\n    \"thistle\": [216, 191, 216],\r\n    \"tomato\": [255, 99, 71],\r\n    \"turquoise\": [64, 224, 208],\r\n    \"violet\": [238, 130, 238],\r\n    \"wheat\": [245, 222, 179],\r\n    \"white\": [255, 255, 255],\r\n    \"whitesmoke\": [245, 245, 245],\r\n    \"yellow\": [255, 255, 0],\r\n    \"yellowgreen\": [154, 205, 50]\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/color-name/index.js?");

/***/ }),

/***/ "./node_modules/color-string/index.js":
/*!********************************************!*\
  !*** ./node_modules/color-string/index.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar colorNames = __webpack_require__(/*! color-name */ \"./node_modules/color-name/index.js\");\r\nvar swizzle = __webpack_require__(/*! simple-swizzle */ \"./node_modules/simple-swizzle/index.js\");\r\nvar reverseNames = {};\r\nfor (var name in colorNames) {\r\n    if (colorNames.hasOwnProperty(name)) {\r\n        reverseNames[colorNames[name]] = name;\r\n    }\r\n}\r\nvar cs = module.exports = {\r\n    to: {},\r\n    get: {}\r\n};\r\ncs.get = function (string) {\r\n    var prefix = string.substring(0, 3).toLowerCase();\r\n    var val;\r\n    var model;\r\n    switch (prefix) {\r\n        case 'hsl':\r\n            val = cs.get.hsl(string);\r\n            model = 'hsl';\r\n            break;\r\n        case 'hwb':\r\n            val = cs.get.hwb(string);\r\n            model = 'hwb';\r\n            break;\r\n        default:\r\n            val = cs.get.rgb(string);\r\n            model = 'rgb';\r\n            break;\r\n    }\r\n    if (!val) {\r\n        return null;\r\n    }\r\n    return { model: model, value: val };\r\n};\r\ncs.get.rgb = function (string) {\r\n    if (!string) {\r\n        return null;\r\n    }\r\n    var abbr = /^#([a-f0-9]{3,4})$/i;\r\n    var hex = /^#([a-f0-9]{6})([a-f0-9]{2})?$/i;\r\n    var rgba = /^rgba?\\(\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*,\\s*([+-]?\\d+)\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\r\n    var per = /^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,\\s*([+-]?[\\d\\.]+)\\%\\s*,\\s*([+-]?[\\d\\.]+)\\%\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\r\n    var keyword = /(\\D+)/;\r\n    var rgb = [0, 0, 0, 1];\r\n    var match;\r\n    var i;\r\n    var hexAlpha;\r\n    if (match = string.match(hex)) {\r\n        hexAlpha = match[2];\r\n        match = match[1];\r\n        for (i = 0; i < 3; i++) {\r\n            var i2 = i * 2;\r\n            rgb[i] = parseInt(match.slice(i2, i2 + 2), 16);\r\n        }\r\n        if (hexAlpha) {\r\n            rgb[3] = Math.round((parseInt(hexAlpha, 16) / 255) * 100) / 100;\r\n        }\r\n    }\r\n    else if (match = string.match(abbr)) {\r\n        match = match[1];\r\n        hexAlpha = match[3];\r\n        for (i = 0; i < 3; i++) {\r\n            rgb[i] = parseInt(match[i] + match[i], 16);\r\n        }\r\n        if (hexAlpha) {\r\n            rgb[3] = Math.round((parseInt(hexAlpha + hexAlpha, 16) / 255) * 100) / 100;\r\n        }\r\n    }\r\n    else if (match = string.match(rgba)) {\r\n        for (i = 0; i < 3; i++) {\r\n            rgb[i] = parseInt(match[i + 1], 0);\r\n        }\r\n        if (match[4]) {\r\n            rgb[3] = parseFloat(match[4]);\r\n        }\r\n    }\r\n    else if (match = string.match(per)) {\r\n        for (i = 0; i < 3; i++) {\r\n            rgb[i] = Math.round(parseFloat(match[i + 1]) * 2.55);\r\n        }\r\n        if (match[4]) {\r\n            rgb[3] = parseFloat(match[4]);\r\n        }\r\n    }\r\n    else if (match = string.match(keyword)) {\r\n        if (match[1] === 'transparent') {\r\n            return [0, 0, 0, 0];\r\n        }\r\n        rgb = colorNames[match[1]];\r\n        if (!rgb) {\r\n            return null;\r\n        }\r\n        rgb[3] = 1;\r\n        return rgb;\r\n    }\r\n    else {\r\n        return null;\r\n    }\r\n    for (i = 0; i < 3; i++) {\r\n        rgb[i] = clamp(rgb[i], 0, 255);\r\n    }\r\n    rgb[3] = clamp(rgb[3], 0, 1);\r\n    return rgb;\r\n};\r\ncs.get.hsl = function (string) {\r\n    if (!string) {\r\n        return null;\r\n    }\r\n    var hsl = /^hsla?\\(\\s*([+-]?(?:\\d*\\.)?\\d+)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\r\n    var match = string.match(hsl);\r\n    if (match) {\r\n        var alpha = parseFloat(match[4]);\r\n        var h = (parseFloat(match[1]) + 360) % 360;\r\n        var s = clamp(parseFloat(match[2]), 0, 100);\r\n        var l = clamp(parseFloat(match[3]), 0, 100);\r\n        var a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\r\n        return [h, s, l, a];\r\n    }\r\n    return null;\r\n};\r\ncs.get.hwb = function (string) {\r\n    if (!string) {\r\n        return null;\r\n    }\r\n    var hwb = /^hwb\\(\\s*([+-]?\\d*[\\.]?\\d+)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?[\\d\\.]+)\\s*)?\\)$/;\r\n    var match = string.match(hwb);\r\n    if (match) {\r\n        var alpha = parseFloat(match[4]);\r\n        var h = ((parseFloat(match[1]) % 360) + 360) % 360;\r\n        var w = clamp(parseFloat(match[2]), 0, 100);\r\n        var b = clamp(parseFloat(match[3]), 0, 100);\r\n        var a = clamp(isNaN(alpha) ? 1 : alpha, 0, 1);\r\n        return [h, w, b, a];\r\n    }\r\n    return null;\r\n};\r\ncs.to.hex = function () {\r\n    var rgba = swizzle(arguments);\r\n    return ('#' +\r\n        hexDouble(rgba[0]) +\r\n        hexDouble(rgba[1]) +\r\n        hexDouble(rgba[2]) +\r\n        (rgba[3] < 1\r\n            ? (hexDouble(Math.round(rgba[3] * 255)))\r\n            : ''));\r\n};\r\ncs.to.rgb = function () {\r\n    var rgba = swizzle(arguments);\r\n    return rgba.length < 4 || rgba[3] === 1\r\n        ? 'rgb(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ')'\r\n        : 'rgba(' + Math.round(rgba[0]) + ', ' + Math.round(rgba[1]) + ', ' + Math.round(rgba[2]) + ', ' + rgba[3] + ')';\r\n};\r\ncs.to.rgb.percent = function () {\r\n    var rgba = swizzle(arguments);\r\n    var r = Math.round(rgba[0] / 255 * 100);\r\n    var g = Math.round(rgba[1] / 255 * 100);\r\n    var b = Math.round(rgba[2] / 255 * 100);\r\n    return rgba.length < 4 || rgba[3] === 1\r\n        ? 'rgb(' + r + '%, ' + g + '%, ' + b + '%)'\r\n        : 'rgba(' + r + '%, ' + g + '%, ' + b + '%, ' + rgba[3] + ')';\r\n};\r\ncs.to.hsl = function () {\r\n    var hsla = swizzle(arguments);\r\n    return hsla.length < 4 || hsla[3] === 1\r\n        ? 'hsl(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%)'\r\n        : 'hsla(' + hsla[0] + ', ' + hsla[1] + '%, ' + hsla[2] + '%, ' + hsla[3] + ')';\r\n};\r\ncs.to.hwb = function () {\r\n    var hwba = swizzle(arguments);\r\n    var a = '';\r\n    if (hwba.length >= 4 && hwba[3] !== 1) {\r\n        a = ', ' + hwba[3];\r\n    }\r\n    return 'hwb(' + hwba[0] + ', ' + hwba[1] + '%, ' + hwba[2] + '%' + a + ')';\r\n};\r\ncs.to.keyword = function (rgb) {\r\n    return reverseNames[rgb.slice(0, 3)];\r\n};\r\nfunction clamp(num, min, max) {\r\n    return Math.min(Math.max(min, num), max);\r\n}\r\nfunction hexDouble(num) {\r\n    var str = num.toString(16).toUpperCase();\r\n    return (str.length < 2) ? '0' + str : str;\r\n}\r\n\n\n//# sourceURL=webpack:///./node_modules/color-string/index.js?");

/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js!./node_modules/@simonwep/pickr/dist/themes/nano.min.css":
/*!*****************************************************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./node_modules/@simonwep/pickr/dist/themes/nano.min.css ***!
  \*****************************************************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("exports = module.exports = __webpack_require__(/*! ../../../../css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.i, \"/*! Pickr 1.2.7 MIT | https://github.com/Simonwep/pickr */.pickr{position:relative;overflow:visible;transform:translateY(0)}.pickr *{box-sizing:border-box}.pickr .pcr-button{position:relative;height:2em;width:2em;padding:.5em;cursor:pointer;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;border-radius:.15em;background:url('data:image/svg+xml;utf8, <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 50 50\\\" stroke=\\\"%2342445A\\\" stroke-width=\\\"5px\\\" stroke-linecap=\\\"round\\\"><path d=\\\"M45,45L5,5\\\"></path><path d=\\\"M45,5L5,45\\\"></path></svg>') no-repeat 50%;background-size:0;transition:all .3s}.pickr .pcr-button:before{background:url('data:image/svg+xml;utf8, <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 2 2\\\"><path fill=\\\"white\\\" d=\\\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\\\"/><path fill=\\\"gray\\\" d=\\\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\\\"/></svg>');background-size:.5em;z-index:-1;z-index:auto}.pickr .pcr-button:after,.pickr .pcr-button:before{position:absolute;content:\\\"\\\";top:0;left:0;width:100%;height:100%;border-radius:.15em}.pickr .pcr-button:after{transition:background .3s;background:currentColor}.pickr .pcr-button.clear{background-size:70%}.pickr .pcr-button.clear:before{opacity:0}.pickr .pcr-button.clear:focus{box-shadow:0 0 0 1px #f1f3f4,0 0 0 3px currentColor}.pickr .pcr-button.disabled{cursor:not-allowed}.pcr-app button,.pcr-app input,.pickr button,.pickr input{outline:none;border:none;-webkit-appearance:none}.pcr-app button:focus,.pcr-app input:focus,.pickr button:focus,.pickr input:focus{box-shadow:0 0 0 1px #f1f3f4,0 0 0 3px currentColor}.pcr-app[data-theme=nano]{position:fixed;display:flex;flex-direction:column;z-index:10000;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,sans-serif;box-shadow:0 .15em 1.5em 0 rgba(0,0,0,.1),0 0 1em 0 rgba(0,0,0,.03);width:14.25em;max-width:95vw;border-radius:.1em;background:#fff;opacity:0;visibility:hidden;transition:opacity .3s,visibility 0s .3s;left:0;top:0}.pcr-app[data-theme=nano].visible{transition:opacity .3s;visibility:visible;opacity:1}.pcr-app[data-theme=nano] .pcr-swatches{display:grid;align-items:center;grid-template-columns:repeat(auto-fit,1.75em);margin-top:.6em;padding:0 .6em}.pcr-app[data-theme=nano] .pcr-swatches.pcr-last{margin:0}.pcr-app[data-theme=nano] .pcr-swatches>button{font-size:1em;position:relative;width:calc(1.75em - 5px);height:calc(1.75em - 5px);border-radius:.15em;cursor:pointer;margin:2.5px;transition:all .15s;overflow:hidden;background:transparent;z-index:1}.pcr-app[data-theme=nano] .pcr-swatches>button:before{position:absolute;content:\\\"\\\";top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml;utf8, <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 2 2\\\"><path fill=\\\"white\\\" d=\\\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\\\"/><path fill=\\\"gray\\\" d=\\\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\\\"/></svg>');background-size:6px;border-radius:.15em;z-index:-1}.pcr-app[data-theme=nano] .pcr-swatches>button:after{content:\\\"\\\";position:absolute;top:0;left:0;width:100%;height:100%;background:currentColor;border:1px solid rgba(0,0,0,.05);border-radius:.15em;box-sizing:border-box}.pcr-app[data-theme=nano] .pcr-swatches>button:hover{filter:brightness(1.05)}.pcr-app[data-theme=nano] .pcr-interaction{display:flex;flex-wrap:wrap;align-items:center;margin:0 -.2em;padding:0 .6em .6em}.pcr-app[data-theme=nano] .pcr-interaction>*{margin:0 .2em}.pcr-app[data-theme=nano] .pcr-interaction input{letter-spacing:.07em;font-size:.75em;text-align:center;cursor:pointer;color:#75797e;background:#f1f3f4;border-radius:.15em;transition:all .15s;padding:.45em .5em;margin-top:.6em}.pcr-app[data-theme=nano] .pcr-interaction input:hover{filter:brightness(.975)}.pcr-app[data-theme=nano] .pcr-interaction input:focus{box-shadow:0 0 0 1px #f1f3f4,0 0 0 3px rgba(66,133,244,.75)}.pcr-app[data-theme=nano] .pcr-interaction .pcr-result{color:#75797e;text-align:left;flex:1 1 8em;min-width:8em;transition:all .2s;border-radius:.15em;background:#f1f3f4;cursor:text}.pcr-app[data-theme=nano] .pcr-interaction .pcr-result::selection{background:#4285f4;color:#fff}.pcr-app[data-theme=nano] .pcr-interaction .pcr-type.active{color:#fff;background:#4285f4}.pcr-app[data-theme=nano] .pcr-interaction .pcr-clear,.pcr-app[data-theme=nano] .pcr-interaction .pcr-save{width:auto;color:#fff}.pcr-app[data-theme=nano] .pcr-interaction .pcr-clear:hover,.pcr-app[data-theme=nano] .pcr-interaction .pcr-save:hover{filter:brightness(.925)}.pcr-app[data-theme=nano] .pcr-interaction .pcr-save{background:#4285f4}.pcr-app[data-theme=nano] .pcr-interaction .pcr-clear{background:#f44250}.pcr-app[data-theme=nano] .pcr-interaction .pcr-clear:focus{box-shadow:0 0 0 1px #f1f3f4,0 0 0 3px rgba(244,66,80,.75)}.pcr-app[data-theme=nano] .pcr-selection{display:grid;grid-gap:.6em;grid-template-columns:1fr 4fr;grid-template-rows:5fr auto auto;align-items:center;height:10.5em;width:100%;align-self:flex-start}.pcr-app[data-theme=nano] .pcr-selection .pcr-picker{position:absolute;height:18px;width:18px;border:2px solid #fff;border-radius:100%;user-select:none}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview{grid-area:2/1/4/1;height:100%;width:100%;display:flex;flex-direction:row;justify-content:center;margin-left:.6em}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview .pcr-last-color{display:none}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview .pcr-current-color{position:relative;background:currentColor;width:2em;height:2em;border-radius:50em;overflow:hidden}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-preview .pcr-current-color:before{position:absolute;content:\\\"\\\";top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml;utf8, <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 2 2\\\"><path fill=\\\"white\\\" d=\\\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\\\"/><path fill=\\\"gray\\\" d=\\\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\\\"/></svg>');background-size:.5em;border-radius:.15em;z-index:-1}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette{position:relative;user-select:none;display:flex;flex-direction:column;cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser:active,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity:active,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette:active{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette{grid-area:1/1/2/3;width:100%;height:100%;z-index:1}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette .pcr-palette{border-radius:.15em;width:100%;height:100%}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-palette .pcr-palette:before{position:absolute;content:\\\"\\\";top:0;left:0;width:100%;height:100%;background:url('data:image/svg+xml;utf8, <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 2 2\\\"><path fill=\\\"white\\\" d=\\\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\\\"/><path fill=\\\"gray\\\" d=\\\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\\\"/></svg>');background-size:.5em;border-radius:.15em;z-index:-1}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser{grid-area:2/2/2/2}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity{grid-area:3/2/3/2}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity{height:.5em;margin:0 .6em}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser .pcr-picker,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity .pcr-picker{top:50%;transform:translateY(-50%)}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser .pcr-slider,.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity .pcr-slider{flex-grow:1;border-radius:50em}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-chooser .pcr-slider{background:linear-gradient(90deg,red,#ff0,#0f0,#0ff,#00f,#f0f,red)}.pcr-app[data-theme=nano] .pcr-selection .pcr-color-opacity .pcr-slider{background:linear-gradient(90deg,transparent,#000),url('data:image/svg+xml;utf8, <svg xmlns=\\\"http://www.w3.org/2000/svg\\\" viewBox=\\\"0 0 2 2\\\"><path fill=\\\"white\\\" d=\\\"M1,0H2V1H1V0ZM0,1H1V2H0V1Z\\\"/><path fill=\\\"gray\\\" d=\\\"M0,0H1V1H0V0ZM1,1H2V2H1V1Z\\\"/></svg>');background-size:100%,.25em}\", \"\"]);\n\n\n//# sourceURL=webpack:///./node_modules/@simonwep/pickr/dist/themes/nano.min.css?./node_modules/css-loader/dist/cjs.js");

/***/ }),

/***/ "./node_modules/css-loader/dist/cjs.js!./src/assets/kb-style.css":
/*!***********************************************************************!*\
  !*** ./node_modules/css-loader/dist/cjs.js!./src/assets/kb-style.css ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("exports = module.exports = __webpack_require__(/*! ../../node_modules/css-loader/dist/runtime/api.js */ \"./node_modules/css-loader/dist/runtime/api.js\")(false);\n// Module\nexports.push([module.i, \"/* kb_web_editor */\\r\\n.kb_web_editor_div {\\r\\n  font-family: \\\"Segoe UI\\\", Tahoma, Geneva, Verdana, sans-serif;\\r\\n  font-size: 14px;\\r\\n  color: #5f5f5f;\\r\\n  border: none;\\r\\n  outline: none;\\r\\n  display: block;\\r\\n  position: static;\\r\\n  background-color: rgba(255, 255, 255, 0);\\r\\n  font-weight: 400;\\r\\n}\\r\\n\\r\\n.kb_web_editor_input {\\r\\n  border-radius: 3px;\\r\\n  line-height: 24px;\\r\\n  padding: 5px 4.75px;\\r\\n  color: #5f5f5f;\\r\\n  border: 1px solid #ccc;\\r\\n  font-size: 16px;\\r\\n  box-sizing: border-box;\\r\\n  height: 36px;\\r\\n  box-shadow: none;\\r\\n  font-family: \\\"Segoe UI\\\", Tahoma, Geneva, Verdana, sans-serif;\\r\\n}\\r\\n\\r\\n.kb_web_editor_input:focus {\\r\\n  outline: #207ab7 1px solid;\\r\\n}\\r\\n\\r\\n.kb_web_editor_label_input {\\r\\n  display: inline-block;\\r\\n  width: 100%;\\r\\n  height: 36px;\\r\\n  position: relative;\\r\\n  margin: 3px 0;\\r\\n}\\r\\n\\r\\n.kb_web_editor_label_input > .kb_web_editor_div:nth-child(1) {\\r\\n  display: inline-block;\\r\\n  position: absolute;\\r\\n  left: 0;\\r\\n  line-height: 36px;\\r\\n  text-align: right;\\r\\n  padding-right: 5px;\\r\\n  width: 80px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_label_input > .kb_web_editor_div:nth-child(2) {\\r\\n  display: inline-block;\\r\\n  position: absolute;\\r\\n  left: 85px;\\r\\n  right: 0;\\r\\n  top: 0;\\r\\n  bottom: 0;\\r\\n}\\r\\n\\r\\n.kb_web_editor_label_input > .kb_web_editor_div:nth-child(2) > input {\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n}\\r\\n\\r\\n.kb_web_editor_btn {\\r\\n  font-weight: 700;\\r\\n  border-radius: 3px;\\r\\n  font-size: 14px;\\r\\n  line-height: 24px;\\r\\n  margin: 4px;\\r\\n  padding: 4px 16px;\\r\\n  outline: none;\\r\\n  background-color: #f0f0f0;\\r\\n  border: none;\\r\\n  display: inline-flex;\\r\\n  cursor: pointer;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n}\\r\\n\\r\\n.kb_web_editor_radio_input {\\r\\n  width: 100%;\\r\\n  line-height: 24px;\\r\\n  padding: 5px 4.75px;\\r\\n  font-size: 16px;\\r\\n  word-wrap: break-word;\\r\\n  display: flex;\\r\\n  margin: 0;\\r\\n  cursor: pointer;\\r\\n  border-bottom: 1px rgb(238, 238, 238) solid;\\r\\n}\\r\\n\\r\\n.kb_web_editor_radio_input:hover {\\r\\n  background-color: #e3e3e3;\\r\\n}\\r\\n\\r\\n.kb_web_editor_radio_input > .kb_web_editor_div {\\r\\n  line-height: 36px;\\r\\n  font-size: 16px;\\r\\n  display: inline-block;\\r\\n}\\r\\n\\r\\n.kb_web_editor_radio_input > input {\\r\\n  margin: 0 5px;\\r\\n  pointer-events: none;\\r\\n  position: static;\\r\\n  opacity: 1;\\r\\n}\\r\\n\\r\\n.kb_web_editor_btn:hover {\\r\\n  background-color: #e3e3e3;\\r\\n}\\r\\n\\r\\n.kb_web_editor_btn_primary {\\r\\n  background-color: #207ab7;\\r\\n  color: #fff;\\r\\n}\\r\\n\\r\\n.kb_web_editor_btn_primary:hover {\\r\\n  background-color: #1c6ca1;\\r\\n}\\r\\n\\r\\n.kb_action_bar_btn {\\r\\n  height: 60px;\\r\\n  width: 60px;\\r\\n  border-radius: 50%;\\r\\n  background-color: #fff;\\r\\n  opacity: 0.9;\\r\\n  box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);\\r\\n  position: relative;\\r\\n  margin-bottom: 10px;\\r\\n  background-position: center;\\r\\n  background-repeat: no-repeat;\\r\\n  background-size: 30px 30px;\\r\\n}\\r\\n\\r\\n.kb_action_bar_btn:hover {\\r\\n  background-color: #eee;\\r\\n}\\r\\n\\r\\n.kb_web_editor_menu {\\r\\n  position: absolute;\\r\\n  width: 150px;\\r\\n  min-height: 50px;\\r\\n  border-radius: 3px;\\r\\n  font-size: 12px;\\r\\n  opacity: 0.9;\\r\\n  overflow: hidden;\\r\\n  box-shadow: 0 0 3px #ddd;\\r\\n  background-color: #fff;\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n.kb_web_editor_menu_title {\\r\\n  padding: 5px 10px;\\r\\n  color: #fff;\\r\\n  background-color: rgb(2, 154, 214);\\r\\n}\\r\\n\\r\\n.kb_web_editor_menu_title > .kb_web_editor_div {\\r\\n  background-position: center;\\r\\n  background-repeat: no-repeat;\\r\\n  background-size: contain;\\r\\n  height: 18px;\\r\\n  width: 18px;\\r\\n  float: right;\\r\\n  margin-left: 8px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_menu_item {\\r\\n  padding: 5px 10px;\\r\\n  border-bottom: 1px solid #eee;\\r\\n  cursor: default;\\r\\n  font-size: 12px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_menu_item:hover {\\r\\n  background-color: #eee;\\r\\n}\\r\\n\\r\\n.kb_web_editor_iframe {\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  border: none;\\r\\n}\\r\\n\\r\\n.kb_web_editor_image_preview {\\r\\n  outline: 5px solid #eee;\\r\\n  margin: 5px;\\r\\n  height: 300px;\\r\\n  width: 400px;\\r\\n  position: relative;\\r\\n}\\r\\n\\r\\n.kb_web_editor_image_preview > :nth-child(1) {\\r\\n  width: 100%;\\r\\n  height: 100%;\\r\\n  background-position: center;\\r\\n  background-repeat: no-repeat;\\r\\n  background-size: contain;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.kb_web_editor_image_preview > .kb_web_editor_btn {\\r\\n  position: absolute;\\r\\n  bottom: 0;\\r\\n  right: 0;\\r\\n  opacity: 0.8;\\r\\n  background-color: #eee;\\r\\n  border-radius: 24px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_image_preview > .kb_web_editor_btn :hover {\\r\\n  background-color: #fff;\\r\\n}\\r\\n\\r\\n.kb_web_editor_modal {\\r\\n  background-color: rgba(255, 255, 255, 0.3);\\r\\n  position: fixed;\\r\\n  top: 0;\\r\\n  bottom: 0;\\r\\n  left: 0;\\r\\n  right: 0;\\r\\n  overflow-y: auto;\\r\\n}\\r\\n\\r\\n.kb_web_editor_modal_window {\\r\\n  background-color: #fff;\\r\\n  border: 1px solid #eee;\\r\\n  border-radius: 3px;\\r\\n  box-shadow: 0 0 10px 1px rgba(34, 47, 62, 0.15);\\r\\n  width: 60%;\\r\\n  position: relative;\\r\\n  margin: 40px auto;\\r\\n}\\r\\n\\r\\n.kb_web_editor_modal_body {\\r\\n  padding: 0 16px;\\r\\n  max-height: 80%;\\r\\n  overflow: auto;\\r\\n}\\r\\n\\r\\n.kb_web_editor_modal_footer {\\r\\n  border-top: 1px solid #eee;\\r\\n  text-align: right;\\r\\n  padding: 15px 25px;\\r\\n  margin-top: 10px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_modal_header {\\r\\n  font-size: 20px;\\r\\n  font-weight: 400;\\r\\n  line-height: 1.3;\\r\\n  font-style: normal;\\r\\n  padding: 25px 25px 15px 25px;\\r\\n  cursor: move;\\r\\n  position: relative;\\r\\n}\\r\\n.kb_web_editor_modal_header > .kb_web_editor_div {\\r\\n  position: absolute;\\r\\n  background-repeat: no-repeat;\\r\\n  right: 15px;\\r\\n  top: 15px;\\r\\n  height: 20px;\\r\\n  width: 20px;\\r\\n  border-radius: 10px;\\r\\n  cursor: pointer;\\r\\n}\\r\\n\\r\\n.kb_web_editor_global_link_editor_item {\\r\\n  border-bottom: 1px solid #eee;\\r\\n  position: relative;\\r\\n}\\r\\n\\r\\n.kb_web_editor_global_link_editor_item > .kb_web_editor_div {\\r\\n  word-break: break-all;\\r\\n  font-size: 16px;\\r\\n  line-height: 40px;\\r\\n  min-height: 40px;\\r\\n  padding-right: 80px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_global_link_editor_item > .kb_web_editor_btn {\\r\\n  border-radius: 24px;\\r\\n  position: absolute;\\r\\n  right: 0;\\r\\n  top: 0;\\r\\n}\\r\\n\\r\\n.kb_web_editor_element_nav_bar {\\r\\n  position: fixed;\\r\\n  display: inline;\\r\\n  top: 10px;\\r\\n  right: 25px;\\r\\n  background-color: #5f5f5f;\\r\\n  color: #fff;\\r\\n  opacity: 0.7;\\r\\n  padding: 5px;\\r\\n  border-radius: 5px;\\r\\n  display: none;\\r\\n  cursor: move;\\r\\n}\\r\\n\\r\\n.kb_web_editor_element_nav_bar > .kb_web_editor_div {\\r\\n  color: #fff;\\r\\n  display: inline-block;\\r\\n  padding: 0 5px;\\r\\n  cursor: pointer;\\r\\n  border-radius: 5px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_action_bar_notice {\\r\\n  background-color: red;\\r\\n  width: 20px;\\r\\n  height: 20px;\\r\\n  border-radius: 10px;\\r\\n  position: absolute;\\r\\n  top: 0;\\r\\n  left: 0;\\r\\n  color: #fff;\\r\\n  font-size: 15px;\\r\\n  text-align: center;\\r\\n  line-height: 20px;\\r\\n  opacity: 0.8;\\r\\n  visibility: hidden;\\r\\n}\\r\\n\\r\\n.kb_web_editor_shade_close_btn {\\r\\n  position: fixed;\\r\\n  top: 25px;\\r\\n  right: 25px;\\r\\n  height: 30px;\\r\\n  width: 30px;\\r\\n  background-position: center;\\r\\n  background-repeat: no-repeat;\\r\\n  background-size: contain;\\r\\n  display: none;\\r\\n}\\r\\n\\r\\n.kb_web_editor_checkobx_input {\\r\\n  display: flex;\\r\\n  align-items: center;\\r\\n}\\r\\n\\r\\n.kb_web_editor_color_picker {\\r\\n  display: inline-flex;\\r\\n  align-items: center;\\r\\n}\\r\\n.kb_web_editor_color_picker > * {\\r\\n  padding-right: 5px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_coloreditor_item{\\r\\n  display: flex;\\r\\n  justify-content: flex-end;\\r\\n  padding: 10px 20px;\\r\\n}\\r\\n\\r\\n.kb_web_editor_coloreditor_item_check{\\r\\n  display: flex;\\r\\n  justify-content: center;\\r\\n  align-items: center;\\r\\n  width: 25%;\\r\\n}\\r\\n\\r\\n.kb_web_editor_coloreditor_item_check>*{\\r\\n  margin: 0px;\\r\\n}\", \"\"]);\n\n\n//# sourceURL=webpack:///./src/assets/kb-style.css?./node_modules/css-loader/dist/cjs.js");

/***/ }),

/***/ "./node_modules/css-loader/dist/runtime/api.js":
/*!*****************************************************!*\
  !*** ./node_modules/css-loader/dist/runtime/api.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nmodule.exports = function (useSourceMap) {\r\n    var list = [];\r\n    list.toString = function toString() {\r\n        return this.map(function (item) {\r\n            var content = cssWithMappingToString(item, useSourceMap);\r\n            if (item[2]) {\r\n                return \"@media \".concat(item[2], \"{\").concat(content, \"}\");\r\n            }\r\n            return content;\r\n        }).join('');\r\n    };\r\n    list.i = function (modules, mediaQuery) {\r\n        if (typeof modules === 'string') {\r\n            modules = [[null, modules, '']];\r\n        }\r\n        var alreadyImportedModules = {};\r\n        for (var i = 0; i < this.length; i++) {\r\n            var id = this[i][0];\r\n            if (id != null) {\r\n                alreadyImportedModules[id] = true;\r\n            }\r\n        }\r\n        for (var _i = 0; _i < modules.length; _i++) {\r\n            var item = modules[_i];\r\n            if (item[0] == null || !alreadyImportedModules[item[0]]) {\r\n                if (mediaQuery && !item[2]) {\r\n                    item[2] = mediaQuery;\r\n                }\r\n                else if (mediaQuery) {\r\n                    item[2] = \"(\".concat(item[2], \") and (\").concat(mediaQuery, \")\");\r\n                }\r\n                list.push(item);\r\n            }\r\n        }\r\n    };\r\n    return list;\r\n};\r\nfunction cssWithMappingToString(item, useSourceMap) {\r\n    var content = item[1] || '';\r\n    var cssMapping = item[3];\r\n    if (!cssMapping) {\r\n        return content;\r\n    }\r\n    if (useSourceMap && typeof btoa === 'function') {\r\n        var sourceMapping = toComment(cssMapping);\r\n        var sourceURLs = cssMapping.sources.map(function (source) {\r\n            return \"/*# sourceURL=\".concat(cssMapping.sourceRoot).concat(source, \" */\");\r\n        });\r\n        return [content].concat(sourceURLs).concat([sourceMapping]).join('\\n');\r\n    }\r\n    return [content].join('\\n');\r\n}\r\nfunction toComment(sourceMap) {\r\n    var base64 = btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap))));\r\n    var data = \"sourceMappingURL=data:application/json;charset=utf-8;base64,\".concat(base64);\r\n    return \"/*# \".concat(data, \" */\");\r\n}\r\n\n\n//# sourceURL=webpack:///./node_modules/css-loader/dist/runtime/api.js?");

/***/ }),

/***/ "./node_modules/decode-uri-component/index.js":
/*!****************************************************!*\
  !*** ./node_modules/decode-uri-component/index.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar token = '%[a-f0-9]{2}';\r\nvar singleMatcher = new RegExp(token, 'gi');\r\nvar multiMatcher = new RegExp('(' + token + ')+', 'gi');\r\nfunction decodeComponents(components, split) {\r\n    try {\r\n        return decodeURIComponent(components.join(''));\r\n    }\r\n    catch (err) {\r\n    }\r\n    if (components.length === 1) {\r\n        return components;\r\n    }\r\n    split = split || 1;\r\n    var left = components.slice(0, split);\r\n    var right = components.slice(split);\r\n    return Array.prototype.concat.call([], decodeComponents(left), decodeComponents(right));\r\n}\r\nfunction decode(input) {\r\n    try {\r\n        return decodeURIComponent(input);\r\n    }\r\n    catch (err) {\r\n        var tokens = input.match(singleMatcher);\r\n        for (var i = 1; i < tokens.length; i++) {\r\n            input = decodeComponents(tokens, i).join('');\r\n            tokens = input.match(singleMatcher);\r\n        }\r\n        return input;\r\n    }\r\n}\r\nfunction customDecodeURIComponent(input) {\r\n    var replaceMap = {\r\n        '%FE%FF': '\\uFFFD\\uFFFD',\r\n        '%FF%FE': '\\uFFFD\\uFFFD'\r\n    };\r\n    var match = multiMatcher.exec(input);\r\n    while (match) {\r\n        try {\r\n            replaceMap[match[0]] = decodeURIComponent(match[0]);\r\n        }\r\n        catch (err) {\r\n            var result = decode(match[0]);\r\n            if (result !== match[0]) {\r\n                replaceMap[match[0]] = result;\r\n            }\r\n        }\r\n        match = multiMatcher.exec(input);\r\n    }\r\n    replaceMap['%C2'] = '\\uFFFD';\r\n    var entries = Object.keys(replaceMap);\r\n    for (var i = 0; i < entries.length; i++) {\r\n        var key = entries[i];\r\n        input = input.replace(new RegExp(key, 'g'), replaceMap[key]);\r\n    }\r\n    return input;\r\n}\r\nmodule.exports = function (encodedURI) {\r\n    if (typeof encodedURI !== 'string') {\r\n        throw new TypeError('Expected `encodedURI` to be of type `string`, got `' + typeof encodedURI + '`');\r\n    }\r\n    try {\r\n        encodedURI = encodedURI.replace(/\\+/g, ' ');\r\n        return decodeURIComponent(encodedURI);\r\n    }\r\n    catch (err) {\r\n        return customDecodeURIComponent(encodedURI);\r\n    }\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/decode-uri-component/index.js?");

/***/ }),

/***/ "./node_modules/query-string/index.js":
/*!********************************************!*\
  !*** ./node_modules/query-string/index.js ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nconst strictUriEncode = __webpack_require__(/*! strict-uri-encode */ \"./node_modules/strict-uri-encode/index.js\");\r\nconst decodeComponent = __webpack_require__(/*! decode-uri-component */ \"./node_modules/decode-uri-component/index.js\");\r\nconst splitOnFirst = __webpack_require__(/*! split-on-first */ \"./node_modules/split-on-first/index.js\");\r\nfunction encoderForArrayFormat(options) {\r\n    switch (options.arrayFormat) {\r\n        case 'index':\r\n            return key => (result, value) => {\r\n                const index = result.length;\r\n                if (value === undefined) {\r\n                    return result;\r\n                }\r\n                if (value === null) {\r\n                    return [...result, [encode(key, options), '[', index, ']'].join('')];\r\n                }\r\n                return [\r\n                    ...result,\r\n                    [encode(key, options), '[', encode(index, options), ']=', encode(value, options)].join('')\r\n                ];\r\n            };\r\n        case 'bracket':\r\n            return key => (result, value) => {\r\n                if (value === undefined) {\r\n                    return result;\r\n                }\r\n                if (value === null) {\r\n                    return [...result, [encode(key, options), '[]'].join('')];\r\n                }\r\n                return [...result, [encode(key, options), '[]=', encode(value, options)].join('')];\r\n            };\r\n        case 'comma':\r\n            return key => (result, value, index) => {\r\n                if (value === null || value === undefined || value.length === 0) {\r\n                    return result;\r\n                }\r\n                if (index === 0) {\r\n                    return [[encode(key, options), '=', encode(value, options)].join('')];\r\n                }\r\n                return [[result, encode(value, options)].join(',')];\r\n            };\r\n        default:\r\n            return key => (result, value) => {\r\n                if (value === undefined) {\r\n                    return result;\r\n                }\r\n                if (value === null) {\r\n                    return [...result, encode(key, options)];\r\n                }\r\n                return [...result, [encode(key, options), '=', encode(value, options)].join('')];\r\n            };\r\n    }\r\n}\r\nfunction parserForArrayFormat(options) {\r\n    let result;\r\n    switch (options.arrayFormat) {\r\n        case 'index':\r\n            return (key, value, accumulator) => {\r\n                result = /\\[(\\d*)\\]$/.exec(key);\r\n                key = key.replace(/\\[\\d*\\]$/, '');\r\n                if (!result) {\r\n                    accumulator[key] = value;\r\n                    return;\r\n                }\r\n                if (accumulator[key] === undefined) {\r\n                    accumulator[key] = {};\r\n                }\r\n                accumulator[key][result[1]] = value;\r\n            };\r\n        case 'bracket':\r\n            return (key, value, accumulator) => {\r\n                result = /(\\[\\])$/.exec(key);\r\n                key = key.replace(/\\[\\]$/, '');\r\n                if (!result) {\r\n                    accumulator[key] = value;\r\n                    return;\r\n                }\r\n                if (accumulator[key] === undefined) {\r\n                    accumulator[key] = [value];\r\n                    return;\r\n                }\r\n                accumulator[key] = [].concat(accumulator[key], value);\r\n            };\r\n        case 'comma':\r\n            return (key, value, accumulator) => {\r\n                const isArray = typeof value === 'string' && value.split('').indexOf(',') > -1;\r\n                const newValue = isArray ? value.split(',') : value;\r\n                accumulator[key] = newValue;\r\n            };\r\n        default:\r\n            return (key, value, accumulator) => {\r\n                if (accumulator[key] === undefined) {\r\n                    accumulator[key] = value;\r\n                    return;\r\n                }\r\n                accumulator[key] = [].concat(accumulator[key], value);\r\n            };\r\n    }\r\n}\r\nfunction encode(value, options) {\r\n    if (options.encode) {\r\n        return options.strict ? strictUriEncode(value) : encodeURIComponent(value);\r\n    }\r\n    return value;\r\n}\r\nfunction decode(value, options) {\r\n    if (options.decode) {\r\n        return decodeComponent(value);\r\n    }\r\n    return value;\r\n}\r\nfunction keysSorter(input) {\r\n    if (Array.isArray(input)) {\r\n        return input.sort();\r\n    }\r\n    if (typeof input === 'object') {\r\n        return keysSorter(Object.keys(input))\r\n            .sort((a, b) => Number(a) - Number(b))\r\n            .map(key => input[key]);\r\n    }\r\n    return input;\r\n}\r\nfunction removeHash(input) {\r\n    const hashStart = input.indexOf('#');\r\n    if (hashStart !== -1) {\r\n        input = input.slice(0, hashStart);\r\n    }\r\n    return input;\r\n}\r\nfunction extract(input) {\r\n    input = removeHash(input);\r\n    const queryStart = input.indexOf('?');\r\n    if (queryStart === -1) {\r\n        return '';\r\n    }\r\n    return input.slice(queryStart + 1);\r\n}\r\nfunction parse(input, options) {\r\n    options = Object.assign({\r\n        decode: true,\r\n        sort: true,\r\n        arrayFormat: 'none',\r\n        parseNumbers: false\r\n    }, options);\r\n    const formatter = parserForArrayFormat(options);\r\n    const ret = Object.create(null);\r\n    if (typeof input !== 'string') {\r\n        return ret;\r\n    }\r\n    input = input.trim().replace(/^[?#&]/, '');\r\n    if (!input) {\r\n        return ret;\r\n    }\r\n    for (const param of input.split('&')) {\r\n        let [key, value] = splitOnFirst(param.replace(/\\+/g, ' '), '=');\r\n        value = value === undefined ? null : decode(value, options);\r\n        if (options.parseNumbers && !Number.isNaN(Number(value))) {\r\n            value = Number(value);\r\n        }\r\n        formatter(decode(key, options), value, ret);\r\n    }\r\n    if (options.sort === false) {\r\n        return ret;\r\n    }\r\n    return (options.sort === true ? Object.keys(ret).sort() : Object.keys(ret).sort(options.sort)).reduce((result, key) => {\r\n        const value = ret[key];\r\n        if (Boolean(value) && typeof value === 'object' && !Array.isArray(value)) {\r\n            result[key] = keysSorter(value);\r\n        }\r\n        else {\r\n            result[key] = value;\r\n        }\r\n        return result;\r\n    }, Object.create(null));\r\n}\r\nexports.extract = extract;\r\nexports.parse = parse;\r\nexports.stringify = (object, options) => {\r\n    if (!object) {\r\n        return '';\r\n    }\r\n    options = Object.assign({\r\n        encode: true,\r\n        strict: true,\r\n        arrayFormat: 'none'\r\n    }, options);\r\n    const formatter = encoderForArrayFormat(options);\r\n    const keys = Object.keys(object);\r\n    if (options.sort !== false) {\r\n        keys.sort(options.sort);\r\n    }\r\n    return keys.map(key => {\r\n        const value = object[key];\r\n        if (value === undefined) {\r\n            return '';\r\n        }\r\n        if (value === null) {\r\n            return encode(key, options);\r\n        }\r\n        if (Array.isArray(value)) {\r\n            return value\r\n                .reduce(formatter(key), [])\r\n                .join('&');\r\n        }\r\n        return encode(key, options) + '=' + encode(value, options);\r\n    }).filter(x => x.length > 0).join('&');\r\n};\r\nexports.parseUrl = (input, options) => {\r\n    return {\r\n        url: removeHash(input).split('?')[0] || '',\r\n        query: parse(extract(input), options)\r\n    };\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/query-string/index.js?");

/***/ }),

/***/ "./node_modules/simple-swizzle/index.js":
/*!**********************************************!*\
  !*** ./node_modules/simple-swizzle/index.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar isArrayish = __webpack_require__(/*! is-arrayish */ \"./node_modules/simple-swizzle/node_modules/is-arrayish/index.js\");\r\nvar concat = Array.prototype.concat;\r\nvar slice = Array.prototype.slice;\r\nvar swizzle = module.exports = function swizzle(args) {\r\n    var results = [];\r\n    for (var i = 0, len = args.length; i < len; i++) {\r\n        var arg = args[i];\r\n        if (isArrayish(arg)) {\r\n            results = concat.call(results, slice.call(arg));\r\n        }\r\n        else {\r\n            results.push(arg);\r\n        }\r\n    }\r\n    return results;\r\n};\r\nswizzle.wrap = function (fn) {\r\n    return function () {\r\n        return fn(swizzle(arguments));\r\n    };\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/simple-swizzle/index.js?");

/***/ }),

/***/ "./node_modules/simple-swizzle/node_modules/is-arrayish/index.js":
/*!***********************************************************************!*\
  !*** ./node_modules/simple-swizzle/node_modules/is-arrayish/index.js ***!
  \***********************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nmodule.exports = function isArrayish(obj) {\r\n    if (!obj || typeof obj === 'string') {\r\n        return false;\r\n    }\r\n    return obj instanceof Array || Array.isArray(obj) ||\r\n        (obj.length >= 0 && (obj.splice instanceof Function ||\r\n            (Object.getOwnPropertyDescriptor(obj, (obj.length - 1)) && obj.constructor.name !== 'String')));\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/simple-swizzle/node_modules/is-arrayish/index.js?");

/***/ }),

/***/ "./node_modules/split-on-first/index.js":
/*!**********************************************!*\
  !*** ./node_modules/split-on-first/index.js ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nmodule.exports = (string, separator) => {\r\n    if (!(typeof string === 'string' && typeof separator === 'string')) {\r\n        throw new TypeError('Expected the arguments to be of type `string`');\r\n    }\r\n    if (separator === '') {\r\n        return [string];\r\n    }\r\n    const separatorIndex = string.indexOf(separator);\r\n    if (separatorIndex === -1) {\r\n        return [string];\r\n    }\r\n    return [\r\n        string.slice(0, separatorIndex),\r\n        string.slice(separatorIndex + separator.length)\r\n    ];\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/split-on-first/index.js?");

/***/ }),

/***/ "./node_modules/strict-uri-encode/index.js":
/*!*************************************************!*\
  !*** ./node_modules/strict-uri-encode/index.js ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nmodule.exports = str => encodeURIComponent(str).replace(/[!'()*]/g, x => `%${x.charCodeAt(0).toString(16).toUpperCase()}`);\r\n\n\n//# sourceURL=webpack:///./node_modules/strict-uri-encode/index.js?");

/***/ }),

/***/ "./node_modules/style-loader/lib/addStyles.js":
/*!****************************************************!*\
  !*** ./node_modules/style-loader/lib/addStyles.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("/*\n\tMIT License http://www.opensource.org/licenses/mit-license.php\n\tAuthor Tobias Koppers @sokra\n*/\n\nvar stylesInDom = {};\n\nvar\tmemoize = function (fn) {\n\tvar memo;\n\n\treturn function () {\n\t\tif (typeof memo === \"undefined\") memo = fn.apply(this, arguments);\n\t\treturn memo;\n\t};\n};\n\nvar isOldIE = memoize(function () {\n\t// Test for IE <= 9 as proposed by Browserhacks\n\t// @see http://browserhacks.com/#hack-e71d8692f65334173fee715c222cb805\n\t// Tests for existence of standard globals is to allow style-loader\n\t// to operate correctly into non-standard environments\n\t// @see https://github.com/webpack-contrib/style-loader/issues/177\n\treturn window && document && document.all && !window.atob;\n});\n\nvar getTarget = function (target, parent) {\n  if (parent){\n    return parent.querySelector(target);\n  }\n  return document.querySelector(target);\n};\n\nvar getElement = (function (fn) {\n\tvar memo = {};\n\n\treturn function(target, parent) {\n                // If passing function in options, then use it for resolve \"head\" element.\n                // Useful for Shadow Root style i.e\n                // {\n                //   insertInto: function () { return document.querySelector(\"#foo\").shadowRoot }\n                // }\n                if (typeof target === 'function') {\n                        return target();\n                }\n                if (typeof memo[target] === \"undefined\") {\n\t\t\tvar styleTarget = getTarget.call(this, target, parent);\n\t\t\t// Special case to return head of iframe instead of iframe itself\n\t\t\tif (window.HTMLIFrameElement && styleTarget instanceof window.HTMLIFrameElement) {\n\t\t\t\ttry {\n\t\t\t\t\t// This will throw an exception if access to iframe is blocked\n\t\t\t\t\t// due to cross-origin restrictions\n\t\t\t\t\tstyleTarget = styleTarget.contentDocument.head;\n\t\t\t\t} catch(e) {\n\t\t\t\t\tstyleTarget = null;\n\t\t\t\t}\n\t\t\t}\n\t\t\tmemo[target] = styleTarget;\n\t\t}\n\t\treturn memo[target]\n\t};\n})();\n\nvar singleton = null;\nvar\tsingletonCounter = 0;\nvar\tstylesInsertedAtTop = [];\n\nvar\tfixUrls = __webpack_require__(/*! ./urls */ \"./node_modules/style-loader/lib/urls.js\");\n\nmodule.exports = function(list, options) {\n\tif (typeof DEBUG !== \"undefined\" && DEBUG) {\n\t\tif (typeof document !== \"object\") throw new Error(\"The style-loader cannot be used in a non-browser environment\");\n\t}\n\n\toptions = options || {};\n\n\toptions.attrs = typeof options.attrs === \"object\" ? options.attrs : {};\n\n\t// Force single-tag solution on IE6-9, which has a hard limit on the # of <style>\n\t// tags it will allow on a page\n\tif (!options.singleton && typeof options.singleton !== \"boolean\") options.singleton = isOldIE();\n\n\t// By default, add <style> tags to the <head> element\n        if (!options.insertInto) options.insertInto = \"head\";\n\n\t// By default, add <style> tags to the bottom of the target\n\tif (!options.insertAt) options.insertAt = \"bottom\";\n\n\tvar styles = listToStyles(list, options);\n\n\taddStylesToDom(styles, options);\n\n\treturn function update (newList) {\n\t\tvar mayRemove = [];\n\n\t\tfor (var i = 0; i < styles.length; i++) {\n\t\t\tvar item = styles[i];\n\t\t\tvar domStyle = stylesInDom[item.id];\n\n\t\t\tdomStyle.refs--;\n\t\t\tmayRemove.push(domStyle);\n\t\t}\n\n\t\tif(newList) {\n\t\t\tvar newStyles = listToStyles(newList, options);\n\t\t\taddStylesToDom(newStyles, options);\n\t\t}\n\n\t\tfor (var i = 0; i < mayRemove.length; i++) {\n\t\t\tvar domStyle = mayRemove[i];\n\n\t\t\tif(domStyle.refs === 0) {\n\t\t\t\tfor (var j = 0; j < domStyle.parts.length; j++) domStyle.parts[j]();\n\n\t\t\t\tdelete stylesInDom[domStyle.id];\n\t\t\t}\n\t\t}\n\t};\n};\n\nfunction addStylesToDom (styles, options) {\n\tfor (var i = 0; i < styles.length; i++) {\n\t\tvar item = styles[i];\n\t\tvar domStyle = stylesInDom[item.id];\n\n\t\tif(domStyle) {\n\t\t\tdomStyle.refs++;\n\n\t\t\tfor(var j = 0; j < domStyle.parts.length; j++) {\n\t\t\t\tdomStyle.parts[j](item.parts[j]);\n\t\t\t}\n\n\t\t\tfor(; j < item.parts.length; j++) {\n\t\t\t\tdomStyle.parts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\t\t} else {\n\t\t\tvar parts = [];\n\n\t\t\tfor(var j = 0; j < item.parts.length; j++) {\n\t\t\t\tparts.push(addStyle(item.parts[j], options));\n\t\t\t}\n\n\t\t\tstylesInDom[item.id] = {id: item.id, refs: 1, parts: parts};\n\t\t}\n\t}\n}\n\nfunction listToStyles (list, options) {\n\tvar styles = [];\n\tvar newStyles = {};\n\n\tfor (var i = 0; i < list.length; i++) {\n\t\tvar item = list[i];\n\t\tvar id = options.base ? item[0] + options.base : item[0];\n\t\tvar css = item[1];\n\t\tvar media = item[2];\n\t\tvar sourceMap = item[3];\n\t\tvar part = {css: css, media: media, sourceMap: sourceMap};\n\n\t\tif(!newStyles[id]) styles.push(newStyles[id] = {id: id, parts: [part]});\n\t\telse newStyles[id].parts.push(part);\n\t}\n\n\treturn styles;\n}\n\nfunction insertStyleElement (options, style) {\n\tvar target = getElement(options.insertInto)\n\n\tif (!target) {\n\t\tthrow new Error(\"Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.\");\n\t}\n\n\tvar lastStyleElementInsertedAtTop = stylesInsertedAtTop[stylesInsertedAtTop.length - 1];\n\n\tif (options.insertAt === \"top\") {\n\t\tif (!lastStyleElementInsertedAtTop) {\n\t\t\ttarget.insertBefore(style, target.firstChild);\n\t\t} else if (lastStyleElementInsertedAtTop.nextSibling) {\n\t\t\ttarget.insertBefore(style, lastStyleElementInsertedAtTop.nextSibling);\n\t\t} else {\n\t\t\ttarget.appendChild(style);\n\t\t}\n\t\tstylesInsertedAtTop.push(style);\n\t} else if (options.insertAt === \"bottom\") {\n\t\ttarget.appendChild(style);\n\t} else if (typeof options.insertAt === \"object\" && options.insertAt.before) {\n\t\tvar nextSibling = getElement(options.insertAt.before, target);\n\t\ttarget.insertBefore(style, nextSibling);\n\t} else {\n\t\tthrow new Error(\"[Style Loader]\\n\\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\\n Must be 'top', 'bottom', or Object.\\n (https://github.com/webpack-contrib/style-loader#insertat)\\n\");\n\t}\n}\n\nfunction removeStyleElement (style) {\n\tif (style.parentNode === null) return false;\n\tstyle.parentNode.removeChild(style);\n\n\tvar idx = stylesInsertedAtTop.indexOf(style);\n\tif(idx >= 0) {\n\t\tstylesInsertedAtTop.splice(idx, 1);\n\t}\n}\n\nfunction createStyleElement (options) {\n\tvar style = document.createElement(\"style\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\n\tif(options.attrs.nonce === undefined) {\n\t\tvar nonce = getNonce();\n\t\tif (nonce) {\n\t\t\toptions.attrs.nonce = nonce;\n\t\t}\n\t}\n\n\taddAttrs(style, options.attrs);\n\tinsertStyleElement(options, style);\n\n\treturn style;\n}\n\nfunction createLinkElement (options) {\n\tvar link = document.createElement(\"link\");\n\n\tif(options.attrs.type === undefined) {\n\t\toptions.attrs.type = \"text/css\";\n\t}\n\toptions.attrs.rel = \"stylesheet\";\n\n\taddAttrs(link, options.attrs);\n\tinsertStyleElement(options, link);\n\n\treturn link;\n}\n\nfunction addAttrs (el, attrs) {\n\tObject.keys(attrs).forEach(function (key) {\n\t\tel.setAttribute(key, attrs[key]);\n\t});\n}\n\nfunction getNonce() {\n\tif (false) {}\n\n\treturn __webpack_require__.nc;\n}\n\nfunction addStyle (obj, options) {\n\tvar style, update, remove, result;\n\n\t// If a transform function was defined, run it on the css\n\tif (options.transform && obj.css) {\n\t    result = typeof options.transform === 'function'\n\t\t ? options.transform(obj.css) \n\t\t : options.transform.default(obj.css);\n\n\t    if (result) {\n\t    \t// If transform returns a value, use that instead of the original css.\n\t    \t// This allows running runtime transformations on the css.\n\t    \tobj.css = result;\n\t    } else {\n\t    \t// If the transform function returns a falsy value, don't add this css.\n\t    \t// This allows conditional loading of css\n\t    \treturn function() {\n\t    \t\t// noop\n\t    \t};\n\t    }\n\t}\n\n\tif (options.singleton) {\n\t\tvar styleIndex = singletonCounter++;\n\n\t\tstyle = singleton || (singleton = createStyleElement(options));\n\n\t\tupdate = applyToSingletonTag.bind(null, style, styleIndex, false);\n\t\tremove = applyToSingletonTag.bind(null, style, styleIndex, true);\n\n\t} else if (\n\t\tobj.sourceMap &&\n\t\ttypeof URL === \"function\" &&\n\t\ttypeof URL.createObjectURL === \"function\" &&\n\t\ttypeof URL.revokeObjectURL === \"function\" &&\n\t\ttypeof Blob === \"function\" &&\n\t\ttypeof btoa === \"function\"\n\t) {\n\t\tstyle = createLinkElement(options);\n\t\tupdate = updateLink.bind(null, style, options);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\n\t\t\tif(style.href) URL.revokeObjectURL(style.href);\n\t\t};\n\t} else {\n\t\tstyle = createStyleElement(options);\n\t\tupdate = applyToTag.bind(null, style);\n\t\tremove = function () {\n\t\t\tremoveStyleElement(style);\n\t\t};\n\t}\n\n\tupdate(obj);\n\n\treturn function updateStyle (newObj) {\n\t\tif (newObj) {\n\t\t\tif (\n\t\t\t\tnewObj.css === obj.css &&\n\t\t\t\tnewObj.media === obj.media &&\n\t\t\t\tnewObj.sourceMap === obj.sourceMap\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tupdate(obj = newObj);\n\t\t} else {\n\t\t\tremove();\n\t\t}\n\t};\n}\n\nvar replaceText = (function () {\n\tvar textStore = [];\n\n\treturn function (index, replacement) {\n\t\ttextStore[index] = replacement;\n\n\t\treturn textStore.filter(Boolean).join('\\n');\n\t};\n})();\n\nfunction applyToSingletonTag (style, index, remove, obj) {\n\tvar css = remove ? \"\" : obj.css;\n\n\tif (style.styleSheet) {\n\t\tstyle.styleSheet.cssText = replaceText(index, css);\n\t} else {\n\t\tvar cssNode = document.createTextNode(css);\n\t\tvar childNodes = style.childNodes;\n\n\t\tif (childNodes[index]) style.removeChild(childNodes[index]);\n\n\t\tif (childNodes.length) {\n\t\t\tstyle.insertBefore(cssNode, childNodes[index]);\n\t\t} else {\n\t\t\tstyle.appendChild(cssNode);\n\t\t}\n\t}\n}\n\nfunction applyToTag (style, obj) {\n\tvar css = obj.css;\n\tvar media = obj.media;\n\n\tif(media) {\n\t\tstyle.setAttribute(\"media\", media)\n\t}\n\n\tif(style.styleSheet) {\n\t\tstyle.styleSheet.cssText = css;\n\t} else {\n\t\twhile(style.firstChild) {\n\t\t\tstyle.removeChild(style.firstChild);\n\t\t}\n\n\t\tstyle.appendChild(document.createTextNode(css));\n\t}\n}\n\nfunction updateLink (link, options, obj) {\n\tvar css = obj.css;\n\tvar sourceMap = obj.sourceMap;\n\n\t/*\n\t\tIf convertToAbsoluteUrls isn't defined, but sourcemaps are enabled\n\t\tand there is no publicPath defined then lets turn convertToAbsoluteUrls\n\t\ton by default.  Otherwise default to the convertToAbsoluteUrls option\n\t\tdirectly\n\t*/\n\tvar autoFixUrls = options.convertToAbsoluteUrls === undefined && sourceMap;\n\n\tif (options.convertToAbsoluteUrls || autoFixUrls) {\n\t\tcss = fixUrls(css);\n\t}\n\n\tif (sourceMap) {\n\t\t// http://stackoverflow.com/a/26603875\n\t\tcss += \"\\n/*# sourceMappingURL=data:application/json;base64,\" + btoa(unescape(encodeURIComponent(JSON.stringify(sourceMap)))) + \" */\";\n\t}\n\n\tvar blob = new Blob([css], { type: \"text/css\" });\n\n\tvar oldSrc = link.href;\n\n\tlink.href = URL.createObjectURL(blob);\n\n\tif(oldSrc) URL.revokeObjectURL(oldSrc);\n}\n\n\n//# sourceURL=webpack:///./node_modules/style-loader/lib/addStyles.js?");

/***/ }),

/***/ "./node_modules/style-loader/lib/urls.js":
/*!***********************************************!*\
  !*** ./node_modules/style-loader/lib/urls.js ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nmodule.exports = function (css) {\r\n    var location = typeof window !== \"undefined\" && window.location;\r\n    if (!location) {\r\n        throw new Error(\"fixUrls requires window.location\");\r\n    }\r\n    if (!css || typeof css !== \"string\") {\r\n        return css;\r\n    }\r\n    var baseUrl = location.protocol + \"//\" + location.host;\r\n    var currentDir = baseUrl + location.pathname.replace(/\\/[^\\/]*$/, \"/\");\r\n    var fixedCss = css.replace(/url\\s*\\(((?:[^)(]|\\((?:[^)(]+|\\([^)(]*\\))*\\))*)\\)/gi, function (fullMatch, origUrl) {\r\n        var unquotedOrigUrl = origUrl\r\n            .trim()\r\n            .replace(/^\"(.*)\"$/, function (o, $1) { return $1; })\r\n            .replace(/^'(.*)'$/, function (o, $1) { return $1; });\r\n        if (/^(#|data:|http:\\/\\/|https:\\/\\/|file:\\/\\/\\/|\\s*$)/i.test(unquotedOrigUrl)) {\r\n            return fullMatch;\r\n        }\r\n        var newUrl;\r\n        if (unquotedOrigUrl.indexOf(\"//\") === 0) {\r\n            newUrl = unquotedOrigUrl;\r\n        }\r\n        else if (unquotedOrigUrl.indexOf(\"/\") === 0) {\r\n            newUrl = baseUrl + unquotedOrigUrl;\r\n        }\r\n        else {\r\n            newUrl = currentDir + unquotedOrigUrl.replace(/^\\.\\//, \"\");\r\n        }\r\n        return \"url(\" + JSON.stringify(newUrl) + \")\";\r\n    });\r\n    return fixedCss;\r\n};\r\n\n\n//# sourceURL=webpack:///./node_modules/style-loader/lib/urls.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/image/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/image/index.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/image/plugin.js\");\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/plugins/image/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/image/plugin.js":
/*!******************************************************!*\
  !*** ./node_modules/tinymce/plugins/image/plugin.js ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n    var image = (function (domGlobals) {\r\n        'use strict';\r\n        var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\r\n        var noop = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n        };\r\n        var constant = function (value) {\r\n            return function () {\r\n                return value;\r\n            };\r\n        };\r\n        var identity = function (x) {\r\n            return x;\r\n        };\r\n        var die = function (msg) {\r\n            return function () {\r\n                throw new Error(msg);\r\n            };\r\n        };\r\n        var never = constant(false);\r\n        var always = constant(true);\r\n        var never$1 = never;\r\n        var always$1 = always;\r\n        var none = function () {\r\n            return NONE;\r\n        };\r\n        var NONE = function () {\r\n            var eq = function (o) {\r\n                return o.isNone();\r\n            };\r\n            var call = function (thunk) {\r\n                return thunk();\r\n            };\r\n            var id = function (n) {\r\n                return n;\r\n            };\r\n            var noop = function () {\r\n            };\r\n            var nul = function () {\r\n                return null;\r\n            };\r\n            var undef = function () {\r\n                return undefined;\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return n();\r\n                },\r\n                is: never$1,\r\n                isSome: never$1,\r\n                isNone: always$1,\r\n                getOr: id,\r\n                getOrThunk: call,\r\n                getOrDie: function (msg) {\r\n                    throw new Error(msg || 'error: getOrDie called on none.');\r\n                },\r\n                getOrNull: nul,\r\n                getOrUndefined: undef,\r\n                or: id,\r\n                orThunk: call,\r\n                map: none,\r\n                ap: none,\r\n                each: noop,\r\n                bind: none,\r\n                flatten: none,\r\n                exists: never$1,\r\n                forall: always$1,\r\n                filter: none,\r\n                equals: eq,\r\n                equals_: eq,\r\n                toArray: function () {\r\n                    return [];\r\n                },\r\n                toString: constant('none()')\r\n            };\r\n            if (Object.freeze)\r\n                Object.freeze(me);\r\n            return me;\r\n        }();\r\n        var some = function (a) {\r\n            var constant_a = function () {\r\n                return a;\r\n            };\r\n            var self = function () {\r\n                return me;\r\n            };\r\n            var map = function (f) {\r\n                return some(f(a));\r\n            };\r\n            var bind = function (f) {\r\n                return f(a);\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return s(a);\r\n                },\r\n                is: function (v) {\r\n                    return a === v;\r\n                },\r\n                isSome: always$1,\r\n                isNone: never$1,\r\n                getOr: constant_a,\r\n                getOrThunk: constant_a,\r\n                getOrDie: constant_a,\r\n                getOrNull: constant_a,\r\n                getOrUndefined: constant_a,\r\n                or: self,\r\n                orThunk: self,\r\n                map: map,\r\n                ap: function (optfab) {\r\n                    return optfab.fold(none, function (fab) {\r\n                        return some(fab(a));\r\n                    });\r\n                },\r\n                each: function (f) {\r\n                    f(a);\r\n                },\r\n                bind: bind,\r\n                flatten: constant_a,\r\n                exists: bind,\r\n                forall: bind,\r\n                filter: function (f) {\r\n                    return f(a) ? me : NONE;\r\n                },\r\n                equals: function (o) {\r\n                    return o.is(a);\r\n                },\r\n                equals_: function (o, elementEq) {\r\n                    return o.fold(never$1, function (b) {\r\n                        return elementEq(a, b);\r\n                    });\r\n                },\r\n                toArray: function () {\r\n                    return [a];\r\n                },\r\n                toString: function () {\r\n                    return 'some(' + a + ')';\r\n                }\r\n            };\r\n            return me;\r\n        };\r\n        var from = function (value) {\r\n            return value === null || value === undefined ? NONE : some(value);\r\n        };\r\n        var Option = {\r\n            some: some,\r\n            none: none,\r\n            from: from\r\n        };\r\n        var typeOf = function (x) {\r\n            if (x === null)\r\n                return 'null';\r\n            var t = typeof x;\r\n            if (t === 'object' && Array.prototype.isPrototypeOf(x))\r\n                return 'array';\r\n            if (t === 'object' && String.prototype.isPrototypeOf(x))\r\n                return 'string';\r\n            return t;\r\n        };\r\n        var isType = function (type) {\r\n            return function (value) {\r\n                return typeOf(value) === type;\r\n            };\r\n        };\r\n        var isString = isType('string');\r\n        var isObject = isType('object');\r\n        var isFunction = isType('function');\r\n        var each = function (xs, f) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                f(x, i, xs);\r\n            }\r\n        };\r\n        var find = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    return Option.some(x);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var push = Array.prototype.push;\r\n        var flatten = function (xs) {\r\n            var r = [];\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (!Array.prototype.isPrototypeOf(xs[i]))\r\n                    throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\r\n                push.apply(r, xs[i]);\r\n            }\r\n            return r;\r\n        };\r\n        var slice = Array.prototype.slice;\r\n        var head = function (xs) {\r\n            return xs.length === 0 ? Option.none() : Option.some(xs[0]);\r\n        };\r\n        var from$1 = isFunction(Array.from) ? Array.from : function (x) {\r\n            return slice.call(x);\r\n        };\r\n        var __assign = function () {\r\n            __assign = Object.assign || function __assign(t) {\r\n                for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                    s = arguments[i];\r\n                    for (var p in s)\r\n                        if (Object.prototype.hasOwnProperty.call(s, p))\r\n                            t[p] = s[p];\r\n                }\r\n                return t;\r\n            };\r\n            return __assign.apply(this, arguments);\r\n        };\r\n        var nu = function (baseFn) {\r\n            var data = Option.none();\r\n            var callbacks = [];\r\n            var map = function (f) {\r\n                return nu(function (nCallback) {\r\n                    get(function (data) {\r\n                        nCallback(f(data));\r\n                    });\r\n                });\r\n            };\r\n            var get = function (nCallback) {\r\n                if (isReady())\r\n                    call(nCallback);\r\n                else\r\n                    callbacks.push(nCallback);\r\n            };\r\n            var set = function (x) {\r\n                data = Option.some(x);\r\n                run(callbacks);\r\n                callbacks = [];\r\n            };\r\n            var isReady = function () {\r\n                return data.isSome();\r\n            };\r\n            var run = function (cbs) {\r\n                each(cbs, call);\r\n            };\r\n            var call = function (cb) {\r\n                data.each(function (x) {\r\n                    domGlobals.setTimeout(function () {\r\n                        cb(x);\r\n                    }, 0);\r\n                });\r\n            };\r\n            baseFn(set);\r\n            return {\r\n                get: get,\r\n                map: map,\r\n                isReady: isReady\r\n            };\r\n        };\r\n        var pure = function (a) {\r\n            return nu(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var LazyValue = {\r\n            nu: nu,\r\n            pure: pure\r\n        };\r\n        var bounce = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var me = this;\r\n                domGlobals.setTimeout(function () {\r\n                    f.apply(me, args);\r\n                }, 0);\r\n            };\r\n        };\r\n        var nu$1 = function (baseFn) {\r\n            var get = function (callback) {\r\n                baseFn(bounce(callback));\r\n            };\r\n            var map = function (fab) {\r\n                return nu$1(function (callback) {\r\n                    get(function (a) {\r\n                        var value = fab(a);\r\n                        callback(value);\r\n                    });\r\n                });\r\n            };\r\n            var bind = function (aFutureB) {\r\n                return nu$1(function (callback) {\r\n                    get(function (a) {\r\n                        aFutureB(a).get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var anonBind = function (futureB) {\r\n                return nu$1(function (callback) {\r\n                    get(function (a) {\r\n                        futureB.get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var toLazy = function () {\r\n                return LazyValue.nu(get);\r\n            };\r\n            var toCached = function () {\r\n                var cache = null;\r\n                return nu$1(function (callback) {\r\n                    if (cache === null) {\r\n                        cache = toLazy();\r\n                    }\r\n                    cache.get(callback);\r\n                });\r\n            };\r\n            return {\r\n                map: map,\r\n                bind: bind,\r\n                anonBind: anonBind,\r\n                toLazy: toLazy,\r\n                toCached: toCached,\r\n                get: get\r\n            };\r\n        };\r\n        var pure$1 = function (a) {\r\n            return nu$1(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var Future = {\r\n            nu: nu$1,\r\n            pure: pure$1\r\n        };\r\n        var value = function (o) {\r\n            var is = function (v) {\r\n                return o === v;\r\n            };\r\n            var or = function (opt) {\r\n                return value(o);\r\n            };\r\n            var orThunk = function (f) {\r\n                return value(o);\r\n            };\r\n            var map = function (f) {\r\n                return value(f(o));\r\n            };\r\n            var mapError = function (f) {\r\n                return value(o);\r\n            };\r\n            var each = function (f) {\r\n                f(o);\r\n            };\r\n            var bind = function (f) {\r\n                return f(o);\r\n            };\r\n            var fold = function (_, onValue) {\r\n                return onValue(o);\r\n            };\r\n            var exists = function (f) {\r\n                return f(o);\r\n            };\r\n            var forall = function (f) {\r\n                return f(o);\r\n            };\r\n            var toOption = function () {\r\n                return Option.some(o);\r\n            };\r\n            return {\r\n                is: is,\r\n                isValue: always,\r\n                isError: never,\r\n                getOr: constant(o),\r\n                getOrThunk: constant(o),\r\n                getOrDie: constant(o),\r\n                or: or,\r\n                orThunk: orThunk,\r\n                fold: fold,\r\n                map: map,\r\n                mapError: mapError,\r\n                each: each,\r\n                bind: bind,\r\n                exists: exists,\r\n                forall: forall,\r\n                toOption: toOption\r\n            };\r\n        };\r\n        var error = function (message) {\r\n            var getOrThunk = function (f) {\r\n                return f();\r\n            };\r\n            var getOrDie = function () {\r\n                return die(String(message))();\r\n            };\r\n            var or = function (opt) {\r\n                return opt;\r\n            };\r\n            var orThunk = function (f) {\r\n                return f();\r\n            };\r\n            var map = function (f) {\r\n                return error(message);\r\n            };\r\n            var mapError = function (f) {\r\n                return error(f(message));\r\n            };\r\n            var bind = function (f) {\r\n                return error(message);\r\n            };\r\n            var fold = function (onError, _) {\r\n                return onError(message);\r\n            };\r\n            return {\r\n                is: never,\r\n                isValue: never,\r\n                isError: always,\r\n                getOr: identity,\r\n                getOrThunk: getOrThunk,\r\n                getOrDie: getOrDie,\r\n                or: or,\r\n                orThunk: orThunk,\r\n                fold: fold,\r\n                map: map,\r\n                mapError: mapError,\r\n                each: noop,\r\n                bind: bind,\r\n                exists: never,\r\n                forall: always,\r\n                toOption: Option.none\r\n            };\r\n        };\r\n        var fromOption = function (opt, err) {\r\n            return opt.fold(function () {\r\n                return error(err);\r\n            }, value);\r\n        };\r\n        var Result = {\r\n            value: value,\r\n            error: error,\r\n            fromOption: fromOption\r\n        };\r\n        var wrap = function (delegate) {\r\n            var toCached = function () {\r\n                return wrap(delegate.toCached());\r\n            };\r\n            var bindFuture = function (f) {\r\n                return wrap(delegate.bind(function (resA) {\r\n                    return resA.fold(function (err) {\r\n                        return Future.pure(Result.error(err));\r\n                    }, function (a) {\r\n                        return f(a);\r\n                    });\r\n                }));\r\n            };\r\n            var bindResult = function (f) {\r\n                return wrap(delegate.map(function (resA) {\r\n                    return resA.bind(f);\r\n                }));\r\n            };\r\n            var mapResult = function (f) {\r\n                return wrap(delegate.map(function (resA) {\r\n                    return resA.map(f);\r\n                }));\r\n            };\r\n            var mapError = function (f) {\r\n                return wrap(delegate.map(function (resA) {\r\n                    return resA.mapError(f);\r\n                }));\r\n            };\r\n            var foldResult = function (whenError, whenValue) {\r\n                return delegate.map(function (res) {\r\n                    return res.fold(whenError, whenValue);\r\n                });\r\n            };\r\n            var withTimeout = function (timeout, errorThunk) {\r\n                return wrap(Future.nu(function (callback) {\r\n                    var timedOut = false;\r\n                    var timer = domGlobals.setTimeout(function () {\r\n                        timedOut = true;\r\n                        callback(Result.error(errorThunk()));\r\n                    }, timeout);\r\n                    delegate.get(function (result) {\r\n                        if (!timedOut) {\r\n                            domGlobals.clearTimeout(timer);\r\n                            callback(result);\r\n                        }\r\n                    });\r\n                }));\r\n            };\r\n            return __assign({}, delegate, {\r\n                toCached: toCached,\r\n                bindFuture: bindFuture,\r\n                bindResult: bindResult,\r\n                mapResult: mapResult,\r\n                mapError: mapError,\r\n                foldResult: foldResult,\r\n                withTimeout: withTimeout\r\n            });\r\n        };\r\n        var nu$2 = function (worker) {\r\n            return wrap(Future.nu(worker));\r\n        };\r\n        var value$1 = function (value) {\r\n            return wrap(Future.pure(Result.value(value)));\r\n        };\r\n        var error$1 = function (error) {\r\n            return wrap(Future.pure(Result.error(error)));\r\n        };\r\n        var fromResult = function (result) {\r\n            return wrap(Future.pure(result));\r\n        };\r\n        var fromFuture = function (future) {\r\n            return wrap(future.map(Result.value));\r\n        };\r\n        var fromPromise = function (promise) {\r\n            return nu$2(function (completer) {\r\n                promise.then(function (value) {\r\n                    completer(Result.value(value));\r\n                }, function (error) {\r\n                    completer(Result.error(error));\r\n                });\r\n            });\r\n        };\r\n        var FutureResult = {\r\n            nu: nu$2,\r\n            wrap: wrap,\r\n            pure: value$1,\r\n            value: value$1,\r\n            error: error$1,\r\n            fromResult: fromResult,\r\n            fromFuture: fromFuture,\r\n            fromPromise: fromPromise\r\n        };\r\n        var hasOwnProperty = Object.prototype.hasOwnProperty;\r\n        var shallow = function (old, nu) {\r\n            return nu;\r\n        };\r\n        var deep = function (old, nu) {\r\n            var bothObjects = isObject(old) && isObject(nu);\r\n            return bothObjects ? deepMerge(old, nu) : nu;\r\n        };\r\n        var baseMerge = function (merger) {\r\n            return function () {\r\n                var objects = new Array(arguments.length);\r\n                for (var i = 0; i < objects.length; i++)\r\n                    objects[i] = arguments[i];\r\n                if (objects.length === 0)\r\n                    throw new Error('Can\\'t merge zero objects');\r\n                var ret = {};\r\n                for (var j = 0; j < objects.length; j++) {\r\n                    var curObject = objects[j];\r\n                    for (var key in curObject)\r\n                        if (hasOwnProperty.call(curObject, key)) {\r\n                            ret[key] = merger(ret[key], curObject[key]);\r\n                        }\r\n                }\r\n                return ret;\r\n            };\r\n        };\r\n        var deepMerge = baseMerge(deep);\r\n        var merge = baseMerge(shallow);\r\n        var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\r\n        var path = function (parts, scope) {\r\n            var o = scope !== undefined && scope !== null ? scope : Global;\r\n            for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i)\r\n                o = o[parts[i]];\r\n            return o;\r\n        };\r\n        var resolve = function (p, scope) {\r\n            var parts = p.split('.');\r\n            return path(parts, scope);\r\n        };\r\n        var unsafe = function (name, scope) {\r\n            return resolve(name, scope);\r\n        };\r\n        var getOrDie = function (name, scope) {\r\n            var actual = unsafe(name, scope);\r\n            if (actual === undefined || actual === null)\r\n                throw name + ' not available on this browser';\r\n            return actual;\r\n        };\r\n        var Global$1 = { getOrDie: getOrDie };\r\n        var url = function () {\r\n            return Global$1.getOrDie('URL');\r\n        };\r\n        var createObjectURL = function (blob) {\r\n            return url().createObjectURL(blob);\r\n        };\r\n        var revokeObjectURL = function (u) {\r\n            url().revokeObjectURL(u);\r\n        };\r\n        var URL = {\r\n            createObjectURL: createObjectURL,\r\n            revokeObjectURL: revokeObjectURL\r\n        };\r\n        var makeItems = function (info) {\r\n            var imageUrl = {\r\n                name: 'src',\r\n                type: 'urlinput',\r\n                filetype: 'image',\r\n                label: 'Source'\r\n            };\r\n            var imageList = info.imageList.map(function (items) {\r\n                return {\r\n                    name: 'images',\r\n                    type: 'selectbox',\r\n                    label: 'Image list',\r\n                    items: items\r\n                };\r\n            });\r\n            var imageDescription = {\r\n                name: 'alt',\r\n                type: 'input',\r\n                label: 'Image description'\r\n            };\r\n            var imageTitle = {\r\n                name: 'title',\r\n                type: 'input',\r\n                label: 'Image title'\r\n            };\r\n            var imageDimensions = {\r\n                name: 'dimensions',\r\n                type: 'sizeinput'\r\n            };\r\n            var classList = info.classList.map(function (items) {\r\n                return {\r\n                    name: 'classes',\r\n                    type: 'selectbox',\r\n                    label: 'Class',\r\n                    items: items\r\n                };\r\n            });\r\n            var caption = {\r\n                type: 'label',\r\n                label: 'Caption',\r\n                items: [{\r\n                        type: 'checkbox',\r\n                        name: 'caption',\r\n                        label: 'Show caption'\r\n                    }]\r\n            };\r\n            return flatten([\r\n                [imageUrl],\r\n                imageList.toArray(),\r\n                info.hasDescription ? [imageDescription] : [],\r\n                info.hasImageTitle ? [imageTitle] : [],\r\n                info.hasDimensions ? [imageDimensions] : [],\r\n                [{\r\n                        type: 'grid',\r\n                        columns: 2,\r\n                        items: flatten([\r\n                            classList.toArray(),\r\n                            info.hasImageCaption ? [caption] : []\r\n                        ])\r\n                    }]\r\n            ]);\r\n        };\r\n        var makeTab = function (info) {\r\n            return {\r\n                title: 'General',\r\n                items: makeItems(info)\r\n            };\r\n        };\r\n        var MainTab = {\r\n            makeTab: makeTab,\r\n            makeItems: makeItems\r\n        };\r\n        function FileReader() {\r\n            var f = Global$1.getOrDie('FileReader');\r\n            return new f();\r\n        }\r\n        var global$1 = tinymce.util.Tools.resolve('tinymce.util.Promise');\r\n        var global$2 = tinymce.util.Tools.resolve('tinymce.util.XHR');\r\n        var hasDimensions = function (editor) {\r\n            return editor.getParam('image_dimensions', true, 'boolean');\r\n        };\r\n        var hasAdvTab = function (editor) {\r\n            return editor.getParam('image_advtab', false, 'boolean');\r\n        };\r\n        var hasUploadTab = function (editor) {\r\n            return editor.getParam('image_uploadtab', true, 'boolean');\r\n        };\r\n        var getPrependUrl = function (editor) {\r\n            return editor.getParam('image_prepend_url', '', 'string');\r\n        };\r\n        var getClassList = function (editor) {\r\n            return editor.getParam('image_class_list');\r\n        };\r\n        var hasDescription = function (editor) {\r\n            return editor.getParam('image_description', true, 'boolean');\r\n        };\r\n        var hasImageTitle = function (editor) {\r\n            return editor.getParam('image_title', false, 'boolean');\r\n        };\r\n        var hasImageCaption = function (editor) {\r\n            return editor.getParam('image_caption', false, 'boolean');\r\n        };\r\n        var getImageList = function (editor) {\r\n            return editor.getParam('image_list', false);\r\n        };\r\n        var hasUploadUrl = function (editor) {\r\n            return !!getUploadUrl(editor);\r\n        };\r\n        var hasUploadHandler = function (editor) {\r\n            return !!getUploadHandler(editor);\r\n        };\r\n        var getUploadUrl = function (editor) {\r\n            return editor.getParam('images_upload_url', '', 'string');\r\n        };\r\n        var getUploadHandler = function (editor) {\r\n            return editor.getParam('images_upload_handler', undefined, 'function');\r\n        };\r\n        var getUploadBasePath = function (editor) {\r\n            return editor.getParam('images_upload_base_path', undefined, 'string');\r\n        };\r\n        var getUploadCredentials = function (editor) {\r\n            return editor.getParam('images_upload_credentials', false, 'boolean');\r\n        };\r\n        var Settings = {\r\n            hasDimensions: hasDimensions,\r\n            hasUploadTab: hasUploadTab,\r\n            hasAdvTab: hasAdvTab,\r\n            getPrependUrl: getPrependUrl,\r\n            getClassList: getClassList,\r\n            hasDescription: hasDescription,\r\n            hasImageTitle: hasImageTitle,\r\n            hasImageCaption: hasImageCaption,\r\n            getImageList: getImageList,\r\n            hasUploadUrl: hasUploadUrl,\r\n            hasUploadHandler: hasUploadHandler,\r\n            getUploadUrl: getUploadUrl,\r\n            getUploadHandler: getUploadHandler,\r\n            getUploadBasePath: getUploadBasePath,\r\n            getUploadCredentials: getUploadCredentials\r\n        };\r\n        var parseIntAndGetMax = function (val1, val2) {\r\n            return Math.max(parseInt(val1, 10), parseInt(val2, 10));\r\n        };\r\n        var getImageSize = function (url, callback) {\r\n            var img = domGlobals.document.createElement('img');\r\n            var done = function (dimensions) {\r\n                if (img.parentNode) {\r\n                    img.parentNode.removeChild(img);\r\n                }\r\n                callback(dimensions);\r\n            };\r\n            img.onload = function () {\r\n                var width = parseIntAndGetMax(img.width, img.clientWidth);\r\n                var height = parseIntAndGetMax(img.height, img.clientHeight);\r\n                var dimensions = {\r\n                    width: width,\r\n                    height: height\r\n                };\r\n                done(Result.value(dimensions));\r\n            };\r\n            img.onerror = function () {\r\n                done(Result.error('Failed to get image dimensions for: ' + url));\r\n            };\r\n            var style = img.style;\r\n            style.visibility = 'hidden';\r\n            style.position = 'fixed';\r\n            style.bottom = style.left = '0px';\r\n            style.width = style.height = 'auto';\r\n            domGlobals.document.body.appendChild(img);\r\n            img.src = url;\r\n        };\r\n        var removePixelSuffix = function (value) {\r\n            if (value) {\r\n                value = value.replace(/px$/, '');\r\n            }\r\n            return value;\r\n        };\r\n        var addPixelSuffix = function (value) {\r\n            if (value.length > 0 && /^[0-9]+$/.test(value)) {\r\n                value += 'px';\r\n            }\r\n            return value;\r\n        };\r\n        var mergeMargins = function (css) {\r\n            if (css.margin) {\r\n                var splitMargin = String(css.margin).split(' ');\r\n                switch (splitMargin.length) {\r\n                    case 1:\r\n                        css['margin-top'] = css['margin-top'] || splitMargin[0];\r\n                        css['margin-right'] = css['margin-right'] || splitMargin[0];\r\n                        css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\r\n                        css['margin-left'] = css['margin-left'] || splitMargin[0];\r\n                        break;\r\n                    case 2:\r\n                        css['margin-top'] = css['margin-top'] || splitMargin[0];\r\n                        css['margin-right'] = css['margin-right'] || splitMargin[1];\r\n                        css['margin-bottom'] = css['margin-bottom'] || splitMargin[0];\r\n                        css['margin-left'] = css['margin-left'] || splitMargin[1];\r\n                        break;\r\n                    case 3:\r\n                        css['margin-top'] = css['margin-top'] || splitMargin[0];\r\n                        css['margin-right'] = css['margin-right'] || splitMargin[1];\r\n                        css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\r\n                        css['margin-left'] = css['margin-left'] || splitMargin[1];\r\n                        break;\r\n                    case 4:\r\n                        css['margin-top'] = css['margin-top'] || splitMargin[0];\r\n                        css['margin-right'] = css['margin-right'] || splitMargin[1];\r\n                        css['margin-bottom'] = css['margin-bottom'] || splitMargin[2];\r\n                        css['margin-left'] = css['margin-left'] || splitMargin[3];\r\n                }\r\n                delete css.margin;\r\n            }\r\n            return css;\r\n        };\r\n        var createImageList = function (editor, callback) {\r\n            var imageList = Settings.getImageList(editor);\r\n            if (typeof imageList === 'string') {\r\n                global$2.send({\r\n                    url: imageList,\r\n                    success: function (text) {\r\n                        callback(JSON.parse(text));\r\n                    }\r\n                });\r\n            }\r\n            else if (typeof imageList === 'function') {\r\n                imageList(callback);\r\n            }\r\n            else {\r\n                callback(imageList);\r\n            }\r\n        };\r\n        var waitLoadImage = function (editor, data, imgElm) {\r\n            var selectImage = function () {\r\n                imgElm.onload = imgElm.onerror = null;\r\n                if (editor.selection) {\r\n                    editor.selection.select(imgElm);\r\n                    editor.nodeChanged();\r\n                }\r\n            };\r\n            imgElm.onload = function () {\r\n                if (!data.width && !data.height && Settings.hasDimensions(editor)) {\r\n                    editor.dom.setAttribs(imgElm, {\r\n                        width: String(imgElm.clientWidth),\r\n                        height: String(imgElm.clientHeight)\r\n                    });\r\n                }\r\n                selectImage();\r\n            };\r\n            imgElm.onerror = selectImage;\r\n        };\r\n        var blobToDataUri = function (blob) {\r\n            return new global$1(function (resolve, reject) {\r\n                var reader = FileReader();\r\n                reader.onload = function () {\r\n                    resolve(reader.result);\r\n                };\r\n                reader.onerror = function () {\r\n                    reject(reader.error.message);\r\n                };\r\n                reader.readAsDataURL(blob);\r\n            });\r\n        };\r\n        var isPlaceholderImage = function (imgElm) {\r\n            return imgElm.nodeName === 'IMG' && (imgElm.hasAttribute('data-mce-object') || imgElm.hasAttribute('data-mce-placeholder'));\r\n        };\r\n        var Utils = {\r\n            getImageSize: getImageSize,\r\n            removePixelSuffix: removePixelSuffix,\r\n            addPixelSuffix: addPixelSuffix,\r\n            mergeMargins: mergeMargins,\r\n            createImageList: createImageList,\r\n            waitLoadImage: waitLoadImage,\r\n            blobToDataUri: blobToDataUri,\r\n            isPlaceholderImage: isPlaceholderImage\r\n        };\r\n        var global$3 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\r\n        var DOM = global$3.DOM;\r\n        var getHspace = function (image) {\r\n            if (image.style.marginLeft && image.style.marginRight && image.style.marginLeft === image.style.marginRight) {\r\n                return Utils.removePixelSuffix(image.style.marginLeft);\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        };\r\n        var getVspace = function (image) {\r\n            if (image.style.marginTop && image.style.marginBottom && image.style.marginTop === image.style.marginBottom) {\r\n                return Utils.removePixelSuffix(image.style.marginTop);\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        };\r\n        var getBorder = function (image) {\r\n            if (image.style.borderWidth) {\r\n                return Utils.removePixelSuffix(image.style.borderWidth);\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        };\r\n        var getAttrib = function (image, name) {\r\n            if (image.hasAttribute(name)) {\r\n                return image.getAttribute(name);\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        };\r\n        var getStyle = function (image, name) {\r\n            return image.style[name] ? image.style[name] : '';\r\n        };\r\n        var hasCaption = function (image) {\r\n            return image.parentNode !== null && image.parentNode.nodeName === 'FIGURE';\r\n        };\r\n        var setAttrib = function (image, name, value) {\r\n            image.setAttribute(name, value);\r\n        };\r\n        var wrapInFigure = function (image) {\r\n            var figureElm = DOM.create('figure', { class: 'image' });\r\n            DOM.insertAfter(figureElm, image);\r\n            figureElm.appendChild(image);\r\n            figureElm.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));\r\n            figureElm.contentEditable = 'false';\r\n        };\r\n        var removeFigure = function (image) {\r\n            var figureElm = image.parentNode;\r\n            DOM.insertAfter(image, figureElm);\r\n            DOM.remove(figureElm);\r\n        };\r\n        var toggleCaption = function (image) {\r\n            if (hasCaption(image)) {\r\n                removeFigure(image);\r\n            }\r\n            else {\r\n                wrapInFigure(image);\r\n            }\r\n        };\r\n        var normalizeStyle = function (image, normalizeCss) {\r\n            var attrValue = image.getAttribute('style');\r\n            var value = normalizeCss(attrValue !== null ? attrValue : '');\r\n            if (value.length > 0) {\r\n                image.setAttribute('style', value);\r\n                image.setAttribute('data-mce-style', value);\r\n            }\r\n            else {\r\n                image.removeAttribute('style');\r\n            }\r\n        };\r\n        var setSize = function (name, normalizeCss) {\r\n            return function (image, name, value) {\r\n                if (image.style[name]) {\r\n                    image.style[name] = Utils.addPixelSuffix(value);\r\n                    normalizeStyle(image, normalizeCss);\r\n                }\r\n                else {\r\n                    setAttrib(image, name, value);\r\n                }\r\n            };\r\n        };\r\n        var getSize = function (image, name) {\r\n            if (image.style[name]) {\r\n                return Utils.removePixelSuffix(image.style[name]);\r\n            }\r\n            else {\r\n                return getAttrib(image, name);\r\n            }\r\n        };\r\n        var setHspace = function (image, value) {\r\n            var pxValue = Utils.addPixelSuffix(value);\r\n            image.style.marginLeft = pxValue;\r\n            image.style.marginRight = pxValue;\r\n        };\r\n        var setVspace = function (image, value) {\r\n            var pxValue = Utils.addPixelSuffix(value);\r\n            image.style.marginTop = pxValue;\r\n            image.style.marginBottom = pxValue;\r\n        };\r\n        var setBorder = function (image, value) {\r\n            var pxValue = Utils.addPixelSuffix(value);\r\n            image.style.borderWidth = pxValue;\r\n        };\r\n        var setBorderStyle = function (image, value) {\r\n            image.style.borderStyle = value;\r\n        };\r\n        var getBorderStyle = function (image) {\r\n            return getStyle(image, 'borderStyle');\r\n        };\r\n        var isFigure = function (elm) {\r\n            return elm.nodeName === 'FIGURE';\r\n        };\r\n        var isImage = function (elm) {\r\n            return elm.nodeName === 'IMG';\r\n        };\r\n        var defaultData = function () {\r\n            return {\r\n                src: '',\r\n                alt: '',\r\n                title: '',\r\n                width: '',\r\n                height: '',\r\n                class: '',\r\n                style: '',\r\n                caption: false,\r\n                hspace: '',\r\n                vspace: '',\r\n                border: '',\r\n                borderStyle: ''\r\n            };\r\n        };\r\n        var getStyleValue = function (normalizeCss, data) {\r\n            var image = domGlobals.document.createElement('img');\r\n            setAttrib(image, 'style', data.style);\r\n            if (getHspace(image) || data.hspace !== '') {\r\n                setHspace(image, data.hspace);\r\n            }\r\n            if (getVspace(image) || data.vspace !== '') {\r\n                setVspace(image, data.vspace);\r\n            }\r\n            if (getBorder(image) || data.border !== '') {\r\n                setBorder(image, data.border);\r\n            }\r\n            if (getBorderStyle(image) || data.borderStyle !== '') {\r\n                setBorderStyle(image, data.borderStyle);\r\n            }\r\n            return normalizeCss(image.getAttribute('style'));\r\n        };\r\n        var create = function (normalizeCss, data) {\r\n            var image = domGlobals.document.createElement('img');\r\n            write(normalizeCss, merge(data, { caption: false }), image);\r\n            setAttrib(image, 'alt', data.alt);\r\n            if (data.caption) {\r\n                var figure = DOM.create('figure', { class: 'image' });\r\n                figure.appendChild(image);\r\n                figure.appendChild(DOM.create('figcaption', { contentEditable: 'true' }, 'Caption'));\r\n                figure.contentEditable = 'false';\r\n                return figure;\r\n            }\r\n            else {\r\n                return image;\r\n            }\r\n        };\r\n        var read = function (normalizeCss, image) {\r\n            return {\r\n                src: getAttrib(image, 'src'),\r\n                alt: getAttrib(image, 'alt'),\r\n                title: getAttrib(image, 'title'),\r\n                width: getSize(image, 'width'),\r\n                height: getSize(image, 'height'),\r\n                class: getAttrib(image, 'class'),\r\n                style: normalizeCss(getAttrib(image, 'style')),\r\n                caption: hasCaption(image),\r\n                hspace: getHspace(image),\r\n                vspace: getVspace(image),\r\n                border: getBorder(image),\r\n                borderStyle: getStyle(image, 'borderStyle')\r\n            };\r\n        };\r\n        var updateProp = function (image, oldData, newData, name, set) {\r\n            if (newData[name] !== oldData[name]) {\r\n                set(image, name, newData[name]);\r\n            }\r\n        };\r\n        var normalized = function (set, normalizeCss) {\r\n            return function (image, name, value) {\r\n                set(image, value);\r\n                normalizeStyle(image, normalizeCss);\r\n            };\r\n        };\r\n        var write = function (normalizeCss, newData, image) {\r\n            var oldData = read(normalizeCss, image);\r\n            updateProp(image, oldData, newData, 'caption', function (image, _name, _value) {\r\n                return toggleCaption(image);\r\n            });\r\n            updateProp(image, oldData, newData, 'src', setAttrib);\r\n            updateProp(image, oldData, newData, 'alt', setAttrib);\r\n            updateProp(image, oldData, newData, 'title', setAttrib);\r\n            updateProp(image, oldData, newData, 'width', setSize('width', normalizeCss));\r\n            updateProp(image, oldData, newData, 'height', setSize('height', normalizeCss));\r\n            updateProp(image, oldData, newData, 'class', setAttrib);\r\n            updateProp(image, oldData, newData, 'style', normalized(function (image, value) {\r\n                return setAttrib(image, 'style', value);\r\n            }, normalizeCss));\r\n            updateProp(image, oldData, newData, 'hspace', normalized(setHspace, normalizeCss));\r\n            updateProp(image, oldData, newData, 'vspace', normalized(setVspace, normalizeCss));\r\n            updateProp(image, oldData, newData, 'border', normalized(setBorder, normalizeCss));\r\n            updateProp(image, oldData, newData, 'borderStyle', normalized(setBorderStyle, normalizeCss));\r\n        };\r\n        var normalizeCss = function (editor, cssText) {\r\n            var css = editor.dom.styles.parse(cssText);\r\n            var mergedCss = Utils.mergeMargins(css);\r\n            var compressed = editor.dom.styles.parse(editor.dom.styles.serialize(mergedCss));\r\n            return editor.dom.styles.serialize(compressed);\r\n        };\r\n        var getSelectedImage = function (editor) {\r\n            var imgElm = editor.selection.getNode();\r\n            var figureElm = editor.dom.getParent(imgElm, 'figure.image');\r\n            if (figureElm) {\r\n                return editor.dom.select('img', figureElm)[0];\r\n            }\r\n            if (imgElm && (imgElm.nodeName !== 'IMG' || Utils.isPlaceholderImage(imgElm))) {\r\n                return null;\r\n            }\r\n            return imgElm;\r\n        };\r\n        var splitTextBlock = function (editor, figure) {\r\n            var dom = editor.dom;\r\n            var textBlock = dom.getParent(figure.parentNode, function (node) {\r\n                return editor.schema.getTextBlockElements()[node.nodeName];\r\n            }, editor.getBody());\r\n            if (textBlock) {\r\n                return dom.split(textBlock, figure);\r\n            }\r\n            else {\r\n                return figure;\r\n            }\r\n        };\r\n        var readImageDataFromSelection = function (editor) {\r\n            var image = getSelectedImage(editor);\r\n            return image ? read(function (css) {\r\n                return normalizeCss(editor, css);\r\n            }, image) : defaultData();\r\n        };\r\n        var insertImageAtCaret = function (editor, data) {\r\n            var elm = create(function (css) {\r\n                return normalizeCss(editor, css);\r\n            }, data);\r\n            editor.dom.setAttrib(elm, 'data-mce-id', '__mcenew');\r\n            editor.focus();\r\n            editor.selection.setContent(elm.outerHTML);\r\n            var insertedElm = editor.dom.select('*[data-mce-id=\"__mcenew\"]')[0];\r\n            editor.dom.setAttrib(insertedElm, 'data-mce-id', null);\r\n            if (isFigure(insertedElm)) {\r\n                var figure = splitTextBlock(editor, insertedElm);\r\n                editor.selection.select(figure);\r\n            }\r\n            else {\r\n                editor.selection.select(insertedElm);\r\n            }\r\n        };\r\n        var syncSrcAttr = function (editor, image) {\r\n            editor.dom.setAttrib(image, 'src', image.getAttribute('src'));\r\n        };\r\n        var deleteImage = function (editor, image) {\r\n            if (image) {\r\n                var elm = editor.dom.is(image.parentNode, 'figure.image') ? image.parentNode : image;\r\n                editor.dom.remove(elm);\r\n                editor.focus();\r\n                editor.nodeChanged();\r\n                if (editor.dom.isEmpty(editor.getBody())) {\r\n                    editor.setContent('');\r\n                    editor.selection.setCursorLocation();\r\n                }\r\n            }\r\n        };\r\n        var writeImageDataToSelection = function (editor, data) {\r\n            var image = getSelectedImage(editor);\r\n            write(function (css) {\r\n                return normalizeCss(editor, css);\r\n            }, data, image);\r\n            syncSrcAttr(editor, image);\r\n            if (isFigure(image.parentNode)) {\r\n                var figure = image.parentNode;\r\n                splitTextBlock(editor, figure);\r\n                editor.selection.select(image.parentNode);\r\n            }\r\n            else {\r\n                editor.selection.select(image);\r\n                Utils.waitLoadImage(editor, data, image);\r\n            }\r\n        };\r\n        var insertOrUpdateImage = function (editor, data) {\r\n            var image = getSelectedImage(editor);\r\n            if (image) {\r\n                if (data.src) {\r\n                    writeImageDataToSelection(editor, data);\r\n                }\r\n                else {\r\n                    deleteImage(editor, image);\r\n                }\r\n            }\r\n            else if (data.src) {\r\n                insertImageAtCaret(editor, data);\r\n            }\r\n        };\r\n        var findMap = function (arr, f) {\r\n            for (var i = 0; i < arr.length; i++) {\r\n                var r = f(arr[i], i);\r\n                if (r.isSome()) {\r\n                    return r;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var global$4 = tinymce.util.Tools.resolve('tinymce.util.Tools');\r\n        var getValue = function (item) {\r\n            return isString(item.value) ? item.value : '';\r\n        };\r\n        var sanitizeList = function (list, extractValue) {\r\n            var out = [];\r\n            global$4.each(list, function (item) {\r\n                var text = isString(item.text) ? item.text : isString(item.title) ? item.title : '';\r\n                if (item.menu !== undefined) {\r\n                    var items = sanitizeList(item.menu, extractValue);\r\n                    out.push({\r\n                        text: text,\r\n                        items: items\r\n                    });\r\n                }\r\n                else {\r\n                    var value = extractValue(item);\r\n                    out.push({\r\n                        text: text,\r\n                        value: value\r\n                    });\r\n                }\r\n            });\r\n            return out;\r\n        };\r\n        var sanitizer = function (extracter) {\r\n            if (extracter === void 0) {\r\n                extracter = getValue;\r\n            }\r\n            return function (list) {\r\n                if (list) {\r\n                    return Option.from(list).map(function (list) {\r\n                        return sanitizeList(list, extracter);\r\n                    });\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            };\r\n        };\r\n        var sanitize = function (list) {\r\n            return sanitizer(getValue)(list);\r\n        };\r\n        var isGroup = function (item) {\r\n            return Object.prototype.hasOwnProperty.call(item, 'items');\r\n        };\r\n        var findEntryDelegate = function (list, value) {\r\n            return findMap(list, function (item) {\r\n                if (isGroup(item)) {\r\n                    return findEntryDelegate(item.items, value);\r\n                }\r\n                else if (item.value === value) {\r\n                    return Option.some(item);\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            });\r\n        };\r\n        var findEntry = function (optList, value) {\r\n            return optList.bind(function (list) {\r\n                return findEntryDelegate(list, value);\r\n            });\r\n        };\r\n        var ListUtils = {\r\n            sanitizer: sanitizer,\r\n            sanitize: sanitize,\r\n            findEntry: findEntry\r\n        };\r\n        function XMLHttpRequest() {\r\n            var f = Global$1.getOrDie('XMLHttpRequest');\r\n            return new f();\r\n        }\r\n        var pathJoin = function (path1, path2) {\r\n            if (path1) {\r\n                return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\r\n            }\r\n            return path2;\r\n        };\r\n        function Uploader(settings) {\r\n            var defaultHandler = function (blobInfo, success, failure, progress) {\r\n                var xhr, formData;\r\n                xhr = XMLHttpRequest();\r\n                xhr.open('POST', settings.url);\r\n                xhr.withCredentials = settings.credentials;\r\n                xhr.upload.onprogress = function (e) {\r\n                    progress(e.loaded / e.total * 100);\r\n                };\r\n                xhr.onerror = function () {\r\n                    failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\r\n                };\r\n                xhr.onload = function () {\r\n                    var json;\r\n                    if (xhr.status < 200 || xhr.status >= 300) {\r\n                        failure('HTTP Error: ' + xhr.status);\r\n                        return;\r\n                    }\r\n                    json = JSON.parse(xhr.responseText);\r\n                    if (!json || typeof json.location !== 'string') {\r\n                        failure('Invalid JSON: ' + xhr.responseText);\r\n                        return;\r\n                    }\r\n                    success(pathJoin(settings.basePath, json.location));\r\n                };\r\n                formData = new domGlobals.FormData();\r\n                formData.append('file', blobInfo.blob(), blobInfo.filename());\r\n                xhr.send(formData);\r\n            };\r\n            var uploadBlob = function (blobInfo, handler) {\r\n                return new global$1(function (resolve, reject) {\r\n                    try {\r\n                        handler(blobInfo, resolve, reject, noop);\r\n                    }\r\n                    catch (ex) {\r\n                        reject(ex.message);\r\n                    }\r\n                });\r\n            };\r\n            var isDefaultHandler = function (handler) {\r\n                return handler === defaultHandler;\r\n            };\r\n            var upload = function (blobInfo) {\r\n                return !settings.url && isDefaultHandler(settings.handler) ? global$1.reject('Upload url missing from the settings.') : uploadBlob(blobInfo, settings.handler);\r\n            };\r\n            settings = global$4.extend({\r\n                credentials: false,\r\n                handler: defaultHandler\r\n            }, settings);\r\n            return { upload: upload };\r\n        }\r\n        var makeTab$1 = function (info) {\r\n            return {\r\n                title: 'Advanced',\r\n                items: [\r\n                    {\r\n                        type: 'input',\r\n                        label: 'Style',\r\n                        name: 'style'\r\n                    },\r\n                    {\r\n                        type: 'grid',\r\n                        columns: 2,\r\n                        items: [\r\n                            {\r\n                                type: 'input',\r\n                                label: 'Vertical space',\r\n                                name: 'vspace'\r\n                            },\r\n                            {\r\n                                type: 'input',\r\n                                label: 'Horizontal space',\r\n                                name: 'hspace'\r\n                            },\r\n                            {\r\n                                type: 'input',\r\n                                label: 'Border width',\r\n                                name: 'border'\r\n                            },\r\n                            {\r\n                                type: 'selectbox',\r\n                                name: 'borderstyle',\r\n                                label: 'Border style',\r\n                                items: [\r\n                                    {\r\n                                        text: 'Select...',\r\n                                        value: ''\r\n                                    },\r\n                                    {\r\n                                        text: 'Solid',\r\n                                        value: 'solid'\r\n                                    },\r\n                                    {\r\n                                        text: 'Dotted',\r\n                                        value: 'dotted'\r\n                                    },\r\n                                    {\r\n                                        text: 'Dashed',\r\n                                        value: 'dashed'\r\n                                    },\r\n                                    {\r\n                                        text: 'Double',\r\n                                        value: 'double'\r\n                                    },\r\n                                    {\r\n                                        text: 'Groove',\r\n                                        value: 'groove'\r\n                                    },\r\n                                    {\r\n                                        text: 'Ridge',\r\n                                        value: 'ridge'\r\n                                    },\r\n                                    {\r\n                                        text: 'Inset',\r\n                                        value: 'inset'\r\n                                    },\r\n                                    {\r\n                                        text: 'Outset',\r\n                                        value: 'outset'\r\n                                    },\r\n                                    {\r\n                                        text: 'None',\r\n                                        value: 'none'\r\n                                    },\r\n                                    {\r\n                                        text: 'Hidden',\r\n                                        value: 'hidden'\r\n                                    }\r\n                                ]\r\n                            }\r\n                        ]\r\n                    }\r\n                ]\r\n            };\r\n        };\r\n        var AdvTab = { makeTab: makeTab$1 };\r\n        var collect = function (editor) {\r\n            var urlListSanitizer = ListUtils.sanitizer(function (item) {\r\n                return editor.convertURL(item.value || item.url, 'src');\r\n            });\r\n            var futureImageList = Future.nu(function (completer) {\r\n                Utils.createImageList(editor, function (imageList) {\r\n                    completer(urlListSanitizer(imageList).map(function (items) {\r\n                        return flatten([\r\n                            [{\r\n                                    text: 'None',\r\n                                    value: ''\r\n                                }],\r\n                            items\r\n                        ]);\r\n                    }));\r\n                });\r\n            });\r\n            var classList = ListUtils.sanitize(Settings.getClassList(editor));\r\n            var hasAdvTab = Settings.hasAdvTab(editor);\r\n            var hasUploadTab = Settings.hasUploadTab(editor);\r\n            var hasUploadUrl = Settings.hasUploadUrl(editor);\r\n            var hasUploadHandler = Settings.hasUploadHandler(editor);\r\n            var image = readImageDataFromSelection(editor);\r\n            var hasDescription = Settings.hasDescription(editor);\r\n            var hasImageTitle = Settings.hasImageTitle(editor);\r\n            var hasDimensions = Settings.hasDimensions(editor);\r\n            var hasImageCaption = Settings.hasImageCaption(editor);\r\n            var url = Settings.getUploadUrl(editor);\r\n            var basePath = Settings.getUploadBasePath(editor);\r\n            var credentials = Settings.getUploadCredentials(editor);\r\n            var handler = Settings.getUploadHandler(editor);\r\n            var prependURL = Option.some(Settings.getPrependUrl(editor)).filter(function (preUrl) {\r\n                return isString(preUrl) && preUrl.length > 0;\r\n            });\r\n            return futureImageList.map(function (imageList) {\r\n                return {\r\n                    image: image,\r\n                    imageList: imageList,\r\n                    classList: classList,\r\n                    hasAdvTab: hasAdvTab,\r\n                    hasUploadTab: hasUploadTab,\r\n                    hasUploadUrl: hasUploadUrl,\r\n                    hasUploadHandler: hasUploadHandler,\r\n                    hasDescription: hasDescription,\r\n                    hasImageTitle: hasImageTitle,\r\n                    hasDimensions: hasDimensions,\r\n                    hasImageCaption: hasImageCaption,\r\n                    url: url,\r\n                    basePath: basePath,\r\n                    credentials: credentials,\r\n                    handler: handler,\r\n                    prependURL: prependURL\r\n                };\r\n            });\r\n        };\r\n        var makeTab$2 = function (info) {\r\n            var items = [{\r\n                    type: 'dropzone',\r\n                    name: 'fileinput'\r\n                }];\r\n            return {\r\n                title: 'Upload',\r\n                items: items\r\n            };\r\n        };\r\n        var UploadTab = { makeTab: makeTab$2 };\r\n        var createState = function (info) {\r\n            return {\r\n                prevImage: ListUtils.findEntry(info.imageList, info.image.src),\r\n                prevAlt: info.image.alt,\r\n                open: true\r\n            };\r\n        };\r\n        var fromImageData = function (image) {\r\n            return {\r\n                src: {\r\n                    value: image.src,\r\n                    meta: {}\r\n                },\r\n                images: image.src,\r\n                alt: image.alt,\r\n                title: image.title,\r\n                dimensions: {\r\n                    width: image.width,\r\n                    height: image.height\r\n                },\r\n                classes: image.class,\r\n                caption: image.caption,\r\n                style: image.style,\r\n                vspace: image.vspace,\r\n                border: image.border,\r\n                hspace: image.hspace,\r\n                borderstyle: image.borderStyle,\r\n                fileinput: []\r\n            };\r\n        };\r\n        var toImageData = function (data) {\r\n            return {\r\n                src: data.src.value,\r\n                alt: data.alt,\r\n                title: data.title,\r\n                width: data.dimensions.width,\r\n                height: data.dimensions.height,\r\n                class: data.classes,\r\n                style: data.style,\r\n                caption: data.caption,\r\n                hspace: data.hspace,\r\n                vspace: data.vspace,\r\n                border: data.border,\r\n                borderStyle: data.borderstyle\r\n            };\r\n        };\r\n        var addPrependUrl2 = function (info, srcURL) {\r\n            if (!/^(?:[a-zA-Z]+:)?\\/\\//.test(srcURL)) {\r\n                return info.prependURL.bind(function (prependUrl) {\r\n                    if (srcURL.substring(0, prependUrl.length) !== prependUrl) {\r\n                        return Option.some(prependUrl + srcURL);\r\n                    }\r\n                    return Option.none();\r\n                });\r\n            }\r\n            return Option.none();\r\n        };\r\n        var addPrependUrl = function (info, api) {\r\n            var data = api.getData();\r\n            addPrependUrl2(info, data.src.value).each(function (srcURL) {\r\n                api.setData({\r\n                    src: {\r\n                        value: srcURL,\r\n                        meta: data.src.meta\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var formFillFromMeta2 = function (info, data) {\r\n            var meta = data.src.meta;\r\n            if (meta !== undefined) {\r\n                var dataCopy_1 = deepMerge({}, data);\r\n                if (info.hasDescription && isString(meta.alt)) {\r\n                    dataCopy_1.alt = meta.alt;\r\n                }\r\n                if (info.hasImageTitle && isString(meta.title)) {\r\n                    dataCopy_1.title = meta.title;\r\n                }\r\n                if (info.hasDimensions) {\r\n                    if (isString(meta.width)) {\r\n                        dataCopy_1.dimensions.width = meta.width;\r\n                    }\r\n                    if (isString(meta.height)) {\r\n                        dataCopy_1.dimensions.height = meta.height;\r\n                    }\r\n                }\r\n                if (isString(meta.class)) {\r\n                    ListUtils.findEntry(info.classList, meta.class).each(function (entry) {\r\n                        dataCopy_1.classes = entry.value;\r\n                    });\r\n                }\r\n                if (info.hasAdvTab) {\r\n                    if (isString(meta.vspace)) {\r\n                        dataCopy_1.vspace = meta.vspace;\r\n                    }\r\n                    if (isString(meta.border)) {\r\n                        dataCopy_1.border = meta.border;\r\n                    }\r\n                    if (isString(meta.hspace)) {\r\n                        dataCopy_1.hspace = meta.hspace;\r\n                    }\r\n                    if (isString(meta.borderstyle)) {\r\n                        dataCopy_1.borderstyle = meta.borderstyle;\r\n                    }\r\n                }\r\n                return Option.some(dataCopy_1);\r\n            }\r\n            return Option.none();\r\n        };\r\n        var formFillFromMeta = function (info, api) {\r\n            formFillFromMeta2(info, api.getData()).each(function (data) {\r\n                return api.setData(data);\r\n            });\r\n        };\r\n        var calculateImageSize = function (helpers, info, state, api) {\r\n            var data = api.getData();\r\n            var url = data.src.value;\r\n            var meta = data.src.meta || {};\r\n            if (!meta.width && !meta.height && info.hasDimensions) {\r\n                helpers.imageSize(url).get(function (result) {\r\n                    result.each(function (size) {\r\n                        if (state.open) {\r\n                            api.setData({ dimensions: size });\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        var updateImagesDropdown = function (info, state, api) {\r\n            var data = api.getData();\r\n            var image = ListUtils.findEntry(info.imageList, data.src.value);\r\n            state.prevImage = image;\r\n            api.setData({\r\n                images: image.map(function (entry) {\r\n                    return entry.value;\r\n                }).getOr('')\r\n            });\r\n        };\r\n        var changeSrc = function (helpers, info, state, api) {\r\n            addPrependUrl(info, api);\r\n            formFillFromMeta(info, api);\r\n            calculateImageSize(helpers, info, state, api);\r\n            updateImagesDropdown(info, state, api);\r\n        };\r\n        var changeImages = function (helpers, info, state, api) {\r\n            var data = api.getData();\r\n            var image = ListUtils.findEntry(info.imageList, data.images);\r\n            image.each(function (img) {\r\n                var updateAlt = data.alt === '' || state.prevImage.map(function (image) {\r\n                    return image.text === data.alt;\r\n                }).getOr(false);\r\n                if (updateAlt) {\r\n                    if (img.value === '') {\r\n                        api.setData({\r\n                            src: img,\r\n                            alt: state.prevAlt\r\n                        });\r\n                    }\r\n                    else {\r\n                        api.setData({\r\n                            src: img,\r\n                            alt: img.text\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    api.setData({ src: img });\r\n                }\r\n            });\r\n            state.prevImage = image;\r\n            changeSrc(helpers, info, state, api);\r\n        };\r\n        var calcVSpace = function (css) {\r\n            var matchingTopBottom = css['margin-top'] && css['margin-bottom'] && css['margin-top'] === css['margin-bottom'];\r\n            return matchingTopBottom ? Utils.removePixelSuffix(String(css['margin-top'])) : '';\r\n        };\r\n        var calcHSpace = function (css) {\r\n            var matchingLeftRight = css['margin-right'] && css['margin-left'] && css['margin-right'] === css['margin-left'];\r\n            return matchingLeftRight ? Utils.removePixelSuffix(String(css['margin-right'])) : '';\r\n        };\r\n        var calcBorderWidth = function (css) {\r\n            return css['border-width'] ? Utils.removePixelSuffix(String(css['border-width'])) : '';\r\n        };\r\n        var calcBorderStyle = function (css) {\r\n            return css['border-style'] ? String(css['border-style']) : '';\r\n        };\r\n        var calcStyle = function (parseStyle, serializeStyle, css) {\r\n            return serializeStyle(parseStyle(serializeStyle(css)));\r\n        };\r\n        var changeStyle2 = function (parseStyle, serializeStyle, data) {\r\n            var css = Utils.mergeMargins(parseStyle(data.style));\r\n            var dataCopy = deepMerge({}, data);\r\n            dataCopy.vspace = calcVSpace(css);\r\n            dataCopy.hspace = calcHSpace(css);\r\n            dataCopy.border = calcBorderWidth(css);\r\n            dataCopy.borderstyle = calcBorderStyle(css);\r\n            dataCopy.style = calcStyle(parseStyle, serializeStyle, css);\r\n            return dataCopy;\r\n        };\r\n        var changeStyle = function (helpers, api) {\r\n            var data = api.getData();\r\n            var newData = changeStyle2(helpers.parseStyle, helpers.serializeStyle, data);\r\n            api.setData(newData);\r\n        };\r\n        var changeAStyle = function (helpers, info, api) {\r\n            var data = deepMerge(fromImageData(info.image), api.getData());\r\n            var style = getStyleValue(helpers.normalizeCss, toImageData(data));\r\n            api.setData({ style: style });\r\n        };\r\n        var changeFileInput = function (helpers, info, state, api) {\r\n            var data = api.getData();\r\n            api.block('Uploading image');\r\n            head(data.fileinput).fold(function () {\r\n                api.unblock();\r\n            }, function (file) {\r\n                var blobUri = URL.createObjectURL(file);\r\n                var uploader = Uploader({\r\n                    url: info.url,\r\n                    basePath: info.basePath,\r\n                    credentials: info.credentials,\r\n                    handler: info.handler\r\n                });\r\n                var finalize = function () {\r\n                    api.unblock();\r\n                    URL.revokeObjectURL(blobUri);\r\n                };\r\n                Utils.blobToDataUri(file).then(function (dataUrl) {\r\n                    var blobInfo = helpers.createBlobCache(file, blobUri, dataUrl);\r\n                    uploader.upload(blobInfo).then(function (url) {\r\n                        api.setData({\r\n                            src: {\r\n                                value: url,\r\n                                meta: {}\r\n                            }\r\n                        });\r\n                        api.showTab('General');\r\n                        changeSrc(helpers, info, state, api);\r\n                        finalize();\r\n                    }).catch(function (err) {\r\n                        finalize();\r\n                        helpers.alertErr(api, err);\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var changeHandler = function (helpers, info, state) {\r\n            return function (api, evt) {\r\n                if (evt.name === 'src') {\r\n                    changeSrc(helpers, info, state, api);\r\n                }\r\n                else if (evt.name === 'images') {\r\n                    changeImages(helpers, info, state, api);\r\n                }\r\n                else if (evt.name === 'alt') {\r\n                    state.prevAlt = api.getData().alt;\r\n                }\r\n                else if (evt.name === 'style') {\r\n                    changeStyle(helpers, api);\r\n                }\r\n                else if (evt.name === 'vspace' || evt.name === 'hspace' || evt.name === 'border' || evt.name === 'borderstyle') {\r\n                    changeAStyle(helpers, info, api);\r\n                }\r\n                else if (evt.name === 'fileinput') {\r\n                    changeFileInput(helpers, info, state, api);\r\n                }\r\n            };\r\n        };\r\n        var closeHandler = function (state) {\r\n            return function () {\r\n                state.open = false;\r\n            };\r\n        };\r\n        var makeDialogBody = function (info) {\r\n            if (info.hasAdvTab || info.hasUploadUrl || info.hasUploadHandler) {\r\n                var tabPanel = {\r\n                    type: 'tabpanel',\r\n                    tabs: flatten([\r\n                        [MainTab.makeTab(info)],\r\n                        info.hasAdvTab ? [AdvTab.makeTab(info)] : [],\r\n                        info.hasUploadTab && (info.hasUploadUrl || info.hasUploadHandler) ? [UploadTab.makeTab(info)] : []\r\n                    ])\r\n                };\r\n                return tabPanel;\r\n            }\r\n            else {\r\n                var panel = {\r\n                    type: 'panel',\r\n                    items: MainTab.makeItems(info)\r\n                };\r\n                return panel;\r\n            }\r\n        };\r\n        var makeDialog = function (helpers) {\r\n            return function (info) {\r\n                var state = createState(info);\r\n                return {\r\n                    title: 'Insert/Edit Image',\r\n                    size: 'normal',\r\n                    body: makeDialogBody(info),\r\n                    buttons: [\r\n                        {\r\n                            type: 'cancel',\r\n                            name: 'cancel',\r\n                            text: 'Cancel'\r\n                        },\r\n                        {\r\n                            type: 'submit',\r\n                            name: 'save',\r\n                            text: 'Save',\r\n                            primary: true\r\n                        }\r\n                    ],\r\n                    initialData: fromImageData(info.image),\r\n                    onSubmit: helpers.onSubmit(info),\r\n                    onChange: changeHandler(helpers, info, state),\r\n                    onClose: closeHandler(state)\r\n                };\r\n            };\r\n        };\r\n        var submitHandler = function (editor) {\r\n            return function (info) {\r\n                return function (api) {\r\n                    var data = deepMerge(fromImageData(info.image), api.getData());\r\n                    editor.undoManager.transact(function () {\r\n                        insertOrUpdateImage(editor, toImageData(data));\r\n                    });\r\n                    editor.editorUpload.uploadImagesAuto();\r\n                    api.close();\r\n                };\r\n            };\r\n        };\r\n        var imageSize = function (editor) {\r\n            return function (url) {\r\n                return FutureResult.nu(function (completer) {\r\n                    Utils.getImageSize(editor.documentBaseURI.toAbsolute(url), function (data) {\r\n                        var result = data.map(function (dimensions) {\r\n                            return {\r\n                                width: String(dimensions.width),\r\n                                height: String(dimensions.height)\r\n                            };\r\n                        });\r\n                        completer(result);\r\n                    });\r\n                });\r\n            };\r\n        };\r\n        var createBlobCache = function (editor) {\r\n            return function (file, blobUri, dataUrl) {\r\n                return editor.editorUpload.blobCache.create({\r\n                    blob: file,\r\n                    blobUri: blobUri,\r\n                    name: file.name ? file.name.replace(/\\.[^\\.]+$/, '') : null,\r\n                    base64: dataUrl.split(',')[1]\r\n                });\r\n            };\r\n        };\r\n        var alertErr = function (editor) {\r\n            return function (api, message) {\r\n                editor.windowManager.alert(message, api.close);\r\n            };\r\n        };\r\n        var normalizeCss$1 = function (editor) {\r\n            return function (cssText) {\r\n                return normalizeCss(editor, cssText);\r\n            };\r\n        };\r\n        var parseStyle = function (editor) {\r\n            return function (cssText) {\r\n                return editor.dom.parseStyle(cssText);\r\n            };\r\n        };\r\n        var serializeStyle = function (editor) {\r\n            return function (stylesArg, name) {\r\n                return editor.dom.serializeStyle(stylesArg, name);\r\n            };\r\n        };\r\n        var Dialog = function (editor) {\r\n            var helpers = {\r\n                onSubmit: submitHandler(editor),\r\n                imageSize: imageSize(editor),\r\n                createBlobCache: createBlobCache(editor),\r\n                alertErr: alertErr(editor),\r\n                normalizeCss: normalizeCss$1(editor),\r\n                parseStyle: parseStyle(editor),\r\n                serializeStyle: serializeStyle(editor)\r\n            };\r\n            var open = function () {\r\n                return collect(editor).map(makeDialog(helpers)).get(function (spec) {\r\n                    editor.windowManager.open(spec);\r\n                });\r\n            };\r\n            return { open: open };\r\n        };\r\n        var register = function (editor) {\r\n            editor.addCommand('mceImage', Dialog(editor).open);\r\n        };\r\n        var Commands = { register: register };\r\n        var hasImageClass = function (node) {\r\n            var className = node.attr('class');\r\n            return className && /\\bimage\\b/.test(className);\r\n        };\r\n        var toggleContentEditableState = function (state) {\r\n            return function (nodes) {\r\n                var i = nodes.length;\r\n                var toggleContentEditable = function (node) {\r\n                    node.attr('contenteditable', state ? 'true' : null);\r\n                };\r\n                while (i--) {\r\n                    var node = nodes[i];\r\n                    if (hasImageClass(node)) {\r\n                        node.attr('contenteditable', state ? 'false' : null);\r\n                        global$4.each(node.getAll('figcaption'), toggleContentEditable);\r\n                    }\r\n                }\r\n            };\r\n        };\r\n        var setup = function (editor) {\r\n            editor.on('PreInit', function () {\r\n                editor.parser.addNodeFilter('figure', toggleContentEditableState(true));\r\n                editor.serializer.addNodeFilter('figure', toggleContentEditableState(false));\r\n            });\r\n        };\r\n        var FilterContent = { setup: setup };\r\n        var fromHtml = function (html, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var div = doc.createElement('div');\r\n            div.innerHTML = html;\r\n            if (!div.hasChildNodes() || div.childNodes.length > 1) {\r\n                domGlobals.console.error('HTML does not have a single root node', html);\r\n                throw new Error('HTML must have a single root node');\r\n            }\r\n            return fromDom(div.childNodes[0]);\r\n        };\r\n        var fromTag = function (tag, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var node = doc.createElement(tag);\r\n            return fromDom(node);\r\n        };\r\n        var fromText = function (text, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var node = doc.createTextNode(text);\r\n            return fromDom(node);\r\n        };\r\n        var fromDom = function (node) {\r\n            if (node === null || node === undefined) {\r\n                throw new Error('Node cannot be null or undefined');\r\n            }\r\n            return { dom: constant(node) };\r\n        };\r\n        var fromPoint = function (docElm, x, y) {\r\n            var doc = docElm.dom();\r\n            return Option.from(doc.elementFromPoint(x, y)).map(fromDom);\r\n        };\r\n        var Element = {\r\n            fromHtml: fromHtml,\r\n            fromTag: fromTag,\r\n            fromText: fromText,\r\n            fromDom: fromDom,\r\n            fromPoint: fromPoint\r\n        };\r\n        var ATTRIBUTE = domGlobals.Node.ATTRIBUTE_NODE;\r\n        var CDATA_SECTION = domGlobals.Node.CDATA_SECTION_NODE;\r\n        var COMMENT = domGlobals.Node.COMMENT_NODE;\r\n        var DOCUMENT = domGlobals.Node.DOCUMENT_NODE;\r\n        var DOCUMENT_TYPE = domGlobals.Node.DOCUMENT_TYPE_NODE;\r\n        var DOCUMENT_FRAGMENT = domGlobals.Node.DOCUMENT_FRAGMENT_NODE;\r\n        var ELEMENT = domGlobals.Node.ELEMENT_NODE;\r\n        var TEXT = domGlobals.Node.TEXT_NODE;\r\n        var PROCESSING_INSTRUCTION = domGlobals.Node.PROCESSING_INSTRUCTION_NODE;\r\n        var ENTITY_REFERENCE = domGlobals.Node.ENTITY_REFERENCE_NODE;\r\n        var ENTITY = domGlobals.Node.ENTITY_NODE;\r\n        var NOTATION = domGlobals.Node.NOTATION_NODE;\r\n        var name = function (element) {\r\n            var r = element.dom().nodeName;\r\n            return r.toLowerCase();\r\n        };\r\n        var Immutable = function () {\r\n            var fields = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                fields[_i] = arguments[_i];\r\n            }\r\n            return function () {\r\n                var values = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    values[_i] = arguments[_i];\r\n                }\r\n                if (fields.length !== values.length) {\r\n                    throw new Error('Wrong number of arguments to struct. Expected \"[' + fields.length + ']\", got ' + values.length + ' arguments');\r\n                }\r\n                var struct = {};\r\n                each(fields, function (name, i) {\r\n                    struct[name] = constant(values[i]);\r\n                });\r\n                return struct;\r\n            };\r\n        };\r\n        var node = function () {\r\n            var f = Global$1.getOrDie('Node');\r\n            return f;\r\n        };\r\n        var compareDocumentPosition = function (a, b, match) {\r\n            return (a.compareDocumentPosition(b) & match) !== 0;\r\n        };\r\n        var documentPositionPreceding = function (a, b) {\r\n            return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_PRECEDING);\r\n        };\r\n        var documentPositionContainedBy = function (a, b) {\r\n            return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_CONTAINED_BY);\r\n        };\r\n        var Node = {\r\n            documentPositionPreceding: documentPositionPreceding,\r\n            documentPositionContainedBy: documentPositionContainedBy\r\n        };\r\n        var cached = function (f) {\r\n            var called = false;\r\n            var r;\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                if (!called) {\r\n                    called = true;\r\n                    r = f.apply(null, args);\r\n                }\r\n                return r;\r\n            };\r\n        };\r\n        var firstMatch = function (regexes, s) {\r\n            for (var i = 0; i < regexes.length; i++) {\r\n                var x = regexes[i];\r\n                if (x.test(s))\r\n                    return x;\r\n            }\r\n            return undefined;\r\n        };\r\n        var find$1 = function (regexes, agent) {\r\n            var r = firstMatch(regexes, agent);\r\n            if (!r)\r\n                return {\r\n                    major: 0,\r\n                    minor: 0\r\n                };\r\n            var group = function (i) {\r\n                return Number(agent.replace(r, '$' + i));\r\n            };\r\n            return nu$3(group(1), group(2));\r\n        };\r\n        var detect = function (versionRegexes, agent) {\r\n            var cleanedAgent = String(agent).toLowerCase();\r\n            if (versionRegexes.length === 0)\r\n                return unknown();\r\n            return find$1(versionRegexes, cleanedAgent);\r\n        };\r\n        var unknown = function () {\r\n            return nu$3(0, 0);\r\n        };\r\n        var nu$3 = function (major, minor) {\r\n            return {\r\n                major: major,\r\n                minor: minor\r\n            };\r\n        };\r\n        var Version = {\r\n            nu: nu$3,\r\n            detect: detect,\r\n            unknown: unknown\r\n        };\r\n        var edge = 'Edge';\r\n        var chrome = 'Chrome';\r\n        var ie = 'IE';\r\n        var opera = 'Opera';\r\n        var firefox = 'Firefox';\r\n        var safari = 'Safari';\r\n        var isBrowser = function (name, current) {\r\n            return function () {\r\n                return current === name;\r\n            };\r\n        };\r\n        var unknown$1 = function () {\r\n            return nu$4({\r\n                current: undefined,\r\n                version: Version.unknown()\r\n            });\r\n        };\r\n        var nu$4 = function (info) {\r\n            var current = info.current;\r\n            var version = info.version;\r\n            return {\r\n                current: current,\r\n                version: version,\r\n                isEdge: isBrowser(edge, current),\r\n                isChrome: isBrowser(chrome, current),\r\n                isIE: isBrowser(ie, current),\r\n                isOpera: isBrowser(opera, current),\r\n                isFirefox: isBrowser(firefox, current),\r\n                isSafari: isBrowser(safari, current)\r\n            };\r\n        };\r\n        var Browser = {\r\n            unknown: unknown$1,\r\n            nu: nu$4,\r\n            edge: constant(edge),\r\n            chrome: constant(chrome),\r\n            ie: constant(ie),\r\n            opera: constant(opera),\r\n            firefox: constant(firefox),\r\n            safari: constant(safari)\r\n        };\r\n        var windows = 'Windows';\r\n        var ios = 'iOS';\r\n        var android = 'Android';\r\n        var linux = 'Linux';\r\n        var osx = 'OSX';\r\n        var solaris = 'Solaris';\r\n        var freebsd = 'FreeBSD';\r\n        var isOS = function (name, current) {\r\n            return function () {\r\n                return current === name;\r\n            };\r\n        };\r\n        var unknown$2 = function () {\r\n            return nu$5({\r\n                current: undefined,\r\n                version: Version.unknown()\r\n            });\r\n        };\r\n        var nu$5 = function (info) {\r\n            var current = info.current;\r\n            var version = info.version;\r\n            return {\r\n                current: current,\r\n                version: version,\r\n                isWindows: isOS(windows, current),\r\n                isiOS: isOS(ios, current),\r\n                isAndroid: isOS(android, current),\r\n                isOSX: isOS(osx, current),\r\n                isLinux: isOS(linux, current),\r\n                isSolaris: isOS(solaris, current),\r\n                isFreeBSD: isOS(freebsd, current)\r\n            };\r\n        };\r\n        var OperatingSystem = {\r\n            unknown: unknown$2,\r\n            nu: nu$5,\r\n            windows: constant(windows),\r\n            ios: constant(ios),\r\n            android: constant(android),\r\n            linux: constant(linux),\r\n            osx: constant(osx),\r\n            solaris: constant(solaris),\r\n            freebsd: constant(freebsd)\r\n        };\r\n        var DeviceType = function (os, browser, userAgent) {\r\n            var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\r\n            var isiPhone = os.isiOS() && !isiPad;\r\n            var isAndroid3 = os.isAndroid() && os.version.major === 3;\r\n            var isAndroid4 = os.isAndroid() && os.version.major === 4;\r\n            var isTablet = isiPad || isAndroid3 || isAndroid4 && /mobile/i.test(userAgent) === true;\r\n            var isTouch = os.isiOS() || os.isAndroid();\r\n            var isPhone = isTouch && !isTablet;\r\n            var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\r\n            return {\r\n                isiPad: constant(isiPad),\r\n                isiPhone: constant(isiPhone),\r\n                isTablet: constant(isTablet),\r\n                isPhone: constant(isPhone),\r\n                isTouch: constant(isTouch),\r\n                isAndroid: os.isAndroid,\r\n                isiOS: os.isiOS,\r\n                isWebView: constant(iOSwebview)\r\n            };\r\n        };\r\n        var detect$1 = function (candidates, userAgent) {\r\n            var agent = String(userAgent).toLowerCase();\r\n            return find(candidates, function (candidate) {\r\n                return candidate.search(agent);\r\n            });\r\n        };\r\n        var detectBrowser = function (browsers, userAgent) {\r\n            return detect$1(browsers, userAgent).map(function (browser) {\r\n                var version = Version.detect(browser.versionRegexes, userAgent);\r\n                return {\r\n                    current: browser.name,\r\n                    version: version\r\n                };\r\n            });\r\n        };\r\n        var detectOs = function (oses, userAgent) {\r\n            return detect$1(oses, userAgent).map(function (os) {\r\n                var version = Version.detect(os.versionRegexes, userAgent);\r\n                return {\r\n                    current: os.name,\r\n                    version: version\r\n                };\r\n            });\r\n        };\r\n        var UaString = {\r\n            detectBrowser: detectBrowser,\r\n            detectOs: detectOs\r\n        };\r\n        var contains = function (str, substr) {\r\n            return str.indexOf(substr) !== -1;\r\n        };\r\n        var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\r\n        var checkContains = function (target) {\r\n            return function (uastring) {\r\n                return contains(uastring, target);\r\n            };\r\n        };\r\n        var browsers = [\r\n            {\r\n                name: 'Edge',\r\n                versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\r\n                search: function (uastring) {\r\n                    var monstrosity = contains(uastring, 'edge/') && contains(uastring, 'chrome') && contains(uastring, 'safari') && contains(uastring, 'applewebkit');\r\n                    return monstrosity;\r\n                }\r\n            },\r\n            {\r\n                name: 'Chrome',\r\n                versionRegexes: [\r\n                    /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\r\n                    normalVersionRegex\r\n                ],\r\n                search: function (uastring) {\r\n                    return contains(uastring, 'chrome') && !contains(uastring, 'chromeframe');\r\n                }\r\n            },\r\n            {\r\n                name: 'IE',\r\n                versionRegexes: [\r\n                    /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\r\n                    /.*?rv:([0-9]+)\\.([0-9]+).*/\r\n                ],\r\n                search: function (uastring) {\r\n                    return contains(uastring, 'msie') || contains(uastring, 'trident');\r\n                }\r\n            },\r\n            {\r\n                name: 'Opera',\r\n                versionRegexes: [\r\n                    normalVersionRegex,\r\n                    /.*?opera\\/([0-9]+)\\.([0-9]+).*/\r\n                ],\r\n                search: checkContains('opera')\r\n            },\r\n            {\r\n                name: 'Firefox',\r\n                versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\r\n                search: checkContains('firefox')\r\n            },\r\n            {\r\n                name: 'Safari',\r\n                versionRegexes: [\r\n                    normalVersionRegex,\r\n                    /.*?cpu os ([0-9]+)_([0-9]+).*/\r\n                ],\r\n                search: function (uastring) {\r\n                    return (contains(uastring, 'safari') || contains(uastring, 'mobile/')) && contains(uastring, 'applewebkit');\r\n                }\r\n            }\r\n        ];\r\n        var oses = [\r\n            {\r\n                name: 'Windows',\r\n                search: checkContains('win'),\r\n                versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'iOS',\r\n                search: function (uastring) {\r\n                    return contains(uastring, 'iphone') || contains(uastring, 'ipad');\r\n                },\r\n                versionRegexes: [\r\n                    /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\r\n                    /.*cpu os ([0-9]+)_([0-9]+).*/,\r\n                    /.*cpu iphone os ([0-9]+)_([0-9]+).*/\r\n                ]\r\n            },\r\n            {\r\n                name: 'Android',\r\n                search: checkContains('android'),\r\n                versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'OSX',\r\n                search: checkContains('os x'),\r\n                versionRegexes: [/.*?os\\ x\\ ?([0-9]+)_([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'Linux',\r\n                search: checkContains('linux'),\r\n                versionRegexes: []\r\n            },\r\n            {\r\n                name: 'Solaris',\r\n                search: checkContains('sunos'),\r\n                versionRegexes: []\r\n            },\r\n            {\r\n                name: 'FreeBSD',\r\n                search: checkContains('freebsd'),\r\n                versionRegexes: []\r\n            }\r\n        ];\r\n        var PlatformInfo = {\r\n            browsers: constant(browsers),\r\n            oses: constant(oses)\r\n        };\r\n        var detect$2 = function (userAgent) {\r\n            var browsers = PlatformInfo.browsers();\r\n            var oses = PlatformInfo.oses();\r\n            var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\r\n            var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\r\n            var deviceType = DeviceType(os, browser, userAgent);\r\n            return {\r\n                browser: browser,\r\n                os: os,\r\n                deviceType: deviceType\r\n            };\r\n        };\r\n        var PlatformDetection = { detect: detect$2 };\r\n        var detect$3 = cached(function () {\r\n            var userAgent = domGlobals.navigator.userAgent;\r\n            return PlatformDetection.detect(userAgent);\r\n        });\r\n        var PlatformDetection$1 = { detect: detect$3 };\r\n        var regularContains = function (e1, e2) {\r\n            var d1 = e1.dom();\r\n            var d2 = e2.dom();\r\n            return d1 === d2 ? false : d1.contains(d2);\r\n        };\r\n        var ieContains = function (e1, e2) {\r\n            return Node.documentPositionContainedBy(e1.dom(), e2.dom());\r\n        };\r\n        var browser = PlatformDetection$1.detect().browser;\r\n        var contains$1 = browser.isIE() ? ieContains : regularContains;\r\n        var parent = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.parentNode).map(Element.fromDom);\r\n        };\r\n        var spot = Immutable('element', 'offset');\r\n        var getRootElement = function (elm) {\r\n            return parent(elm).filter(function (parentElm) {\r\n                return name(parentElm) === 'figure';\r\n            }).getOr(elm);\r\n        };\r\n        var register$1 = function (editor) {\r\n            var makeContextMenuItem = function (node) {\r\n                return {\r\n                    text: 'Image',\r\n                    icon: 'image',\r\n                    onAction: function () {\r\n                        var rootElm = getRootElement(Element.fromDom(node));\r\n                        editor.selection.select(rootElm.dom());\r\n                        Dialog(editor).open();\r\n                    }\r\n                };\r\n            };\r\n            editor.ui.registry.addToggleButton('image', {\r\n                icon: 'image',\r\n                tooltip: 'Insert/edit image',\r\n                onAction: Dialog(editor).open,\r\n                onSetup: function (buttonApi) {\r\n                    return editor.selection.selectorChangedWithUnbind('img:not([data-mce-object],[data-mce-placeholder]),figure.image', buttonApi.setActive).unbind;\r\n                }\r\n            });\r\n            editor.ui.registry.addMenuItem('image', {\r\n                icon: 'image',\r\n                text: 'Image...',\r\n                onAction: Dialog(editor).open\r\n            });\r\n            editor.ui.registry.addContextMenu('image', {\r\n                update: function (element) {\r\n                    return isFigure(element) || isImage(element) && !Utils.isPlaceholderImage(element) ? [makeContextMenuItem(element)] : [];\r\n                }\r\n            });\r\n        };\r\n        var Buttons = { register: register$1 };\r\n        global.add('image', function (editor) {\r\n            FilterContent.setup(editor);\r\n            Buttons.register(editor);\r\n            Commands.register(editor);\r\n        });\r\n        function Plugin() {\r\n        }\r\n        return Plugin;\r\n    }(window));\r\n})();\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/plugins/image/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/index.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/link/plugin.js\");\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/plugins/link/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/link/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/link/plugin.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n    var link = (function (domGlobals) {\r\n        'use strict';\r\n        var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\r\n        var global$1 = tinymce.util.Tools.resolve('tinymce.util.VK');\r\n        var assumeExternalTargets = function (editorSettings) {\r\n            return typeof editorSettings.link_assume_external_targets === 'boolean' ? editorSettings.link_assume_external_targets : false;\r\n        };\r\n        var hasContextToolbar = function (editorSettings) {\r\n            return typeof editorSettings.link_context_toolbar === 'boolean' ? editorSettings.link_context_toolbar : false;\r\n        };\r\n        var getLinkList = function (editorSettings) {\r\n            return editorSettings.link_list;\r\n        };\r\n        var hasDefaultLinkTarget = function (editorSettings) {\r\n            return typeof editorSettings.default_link_target === 'string';\r\n        };\r\n        var useQuickLink = function (editorSettings) {\r\n            return editorSettings.link_quicklink === true;\r\n        };\r\n        var getDefaultLinkTarget = function (editorSettings) {\r\n            return editorSettings.default_link_target;\r\n        };\r\n        var getTargetList = function (editorSettings) {\r\n            return editorSettings.target_list;\r\n        };\r\n        var setTargetList = function (editor, list) {\r\n            editor.settings.target_list = list;\r\n        };\r\n        var shouldShowTargetList = function (editorSettings) {\r\n            return getTargetList(editorSettings) !== false;\r\n        };\r\n        var getRelList = function (editorSettings) {\r\n            return editorSettings.rel_list;\r\n        };\r\n        var hasRelList = function (editorSettings) {\r\n            return getRelList(editorSettings) !== undefined;\r\n        };\r\n        var getLinkClassList = function (editorSettings) {\r\n            return editorSettings.link_class_list;\r\n        };\r\n        var hasLinkClassList = function (editorSettings) {\r\n            return getLinkClassList(editorSettings) !== undefined;\r\n        };\r\n        var shouldShowLinkTitle = function (editorSettings) {\r\n            return editorSettings.link_title !== false;\r\n        };\r\n        var allowUnsafeLinkTarget = function (editorSettings) {\r\n            return typeof editorSettings.allow_unsafe_link_target === 'boolean' ? editorSettings.allow_unsafe_link_target : false;\r\n        };\r\n        var Settings = {\r\n            assumeExternalTargets: assumeExternalTargets,\r\n            hasContextToolbar: hasContextToolbar,\r\n            getLinkList: getLinkList,\r\n            hasDefaultLinkTarget: hasDefaultLinkTarget,\r\n            getDefaultLinkTarget: getDefaultLinkTarget,\r\n            getTargetList: getTargetList,\r\n            setTargetList: setTargetList,\r\n            shouldShowTargetList: shouldShowTargetList,\r\n            getRelList: getRelList,\r\n            hasRelList: hasRelList,\r\n            getLinkClassList: getLinkClassList,\r\n            hasLinkClassList: hasLinkClassList,\r\n            shouldShowLinkTitle: shouldShowLinkTitle,\r\n            allowUnsafeLinkTarget: allowUnsafeLinkTarget,\r\n            useQuickLink: useQuickLink\r\n        };\r\n        var global$2 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\r\n        var global$3 = tinymce.util.Tools.resolve('tinymce.Env');\r\n        var appendClickRemove = function (link, evt) {\r\n            domGlobals.document.body.appendChild(link);\r\n            link.dispatchEvent(evt);\r\n            domGlobals.document.body.removeChild(link);\r\n        };\r\n        var open = function (url) {\r\n            if (!global$3.ie || global$3.ie > 10) {\r\n                var link = domGlobals.document.createElement('a');\r\n                link.target = '_blank';\r\n                link.href = url;\r\n                link.rel = 'noreferrer noopener';\r\n                var evt = domGlobals.document.createEvent('MouseEvents');\r\n                evt.initMouseEvent('click', true, true, domGlobals.window, 0, 0, 0, 0, 0, false, false, false, false, 0, null);\r\n                appendClickRemove(link, evt);\r\n            }\r\n            else {\r\n                var win = domGlobals.window.open('', '_blank');\r\n                if (win) {\r\n                    win.opener = null;\r\n                    var doc = win.document;\r\n                    doc.open();\r\n                    doc.write('<meta http-equiv=\"refresh\" content=\"0; url=' + global$2.DOM.encode(url) + '\">');\r\n                    doc.close();\r\n                }\r\n            }\r\n        };\r\n        var OpenUrl = { open: open };\r\n        var noop = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n        };\r\n        var constant = function (value) {\r\n            return function () {\r\n                return value;\r\n            };\r\n        };\r\n        var never = constant(false);\r\n        var always = constant(true);\r\n        var never$1 = never;\r\n        var always$1 = always;\r\n        var none = function () {\r\n            return NONE;\r\n        };\r\n        var NONE = function () {\r\n            var eq = function (o) {\r\n                return o.isNone();\r\n            };\r\n            var call = function (thunk) {\r\n                return thunk();\r\n            };\r\n            var id = function (n) {\r\n                return n;\r\n            };\r\n            var noop = function () {\r\n            };\r\n            var nul = function () {\r\n                return null;\r\n            };\r\n            var undef = function () {\r\n                return undefined;\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return n();\r\n                },\r\n                is: never$1,\r\n                isSome: never$1,\r\n                isNone: always$1,\r\n                getOr: id,\r\n                getOrThunk: call,\r\n                getOrDie: function (msg) {\r\n                    throw new Error(msg || 'error: getOrDie called on none.');\r\n                },\r\n                getOrNull: nul,\r\n                getOrUndefined: undef,\r\n                or: id,\r\n                orThunk: call,\r\n                map: none,\r\n                ap: none,\r\n                each: noop,\r\n                bind: none,\r\n                flatten: none,\r\n                exists: never$1,\r\n                forall: always$1,\r\n                filter: none,\r\n                equals: eq,\r\n                equals_: eq,\r\n                toArray: function () {\r\n                    return [];\r\n                },\r\n                toString: constant('none()')\r\n            };\r\n            if (Object.freeze)\r\n                Object.freeze(me);\r\n            return me;\r\n        }();\r\n        var some = function (a) {\r\n            var constant_a = function () {\r\n                return a;\r\n            };\r\n            var self = function () {\r\n                return me;\r\n            };\r\n            var map = function (f) {\r\n                return some(f(a));\r\n            };\r\n            var bind = function (f) {\r\n                return f(a);\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return s(a);\r\n                },\r\n                is: function (v) {\r\n                    return a === v;\r\n                },\r\n                isSome: always$1,\r\n                isNone: never$1,\r\n                getOr: constant_a,\r\n                getOrThunk: constant_a,\r\n                getOrDie: constant_a,\r\n                getOrNull: constant_a,\r\n                getOrUndefined: constant_a,\r\n                or: self,\r\n                orThunk: self,\r\n                map: map,\r\n                ap: function (optfab) {\r\n                    return optfab.fold(none, function (fab) {\r\n                        return some(fab(a));\r\n                    });\r\n                },\r\n                each: function (f) {\r\n                    f(a);\r\n                },\r\n                bind: bind,\r\n                flatten: constant_a,\r\n                exists: bind,\r\n                forall: bind,\r\n                filter: function (f) {\r\n                    return f(a) ? me : NONE;\r\n                },\r\n                equals: function (o) {\r\n                    return o.is(a);\r\n                },\r\n                equals_: function (o, elementEq) {\r\n                    return o.fold(never$1, function (b) {\r\n                        return elementEq(a, b);\r\n                    });\r\n                },\r\n                toArray: function () {\r\n                    return [a];\r\n                },\r\n                toString: function () {\r\n                    return 'some(' + a + ')';\r\n                }\r\n            };\r\n            return me;\r\n        };\r\n        var from = function (value) {\r\n            return value === null || value === undefined ? NONE : some(value);\r\n        };\r\n        var Option = {\r\n            some: some,\r\n            none: none,\r\n            from: from\r\n        };\r\n        var typeOf = function (x) {\r\n            if (x === null)\r\n                return 'null';\r\n            var t = typeof x;\r\n            if (t === 'object' && Array.prototype.isPrototypeOf(x))\r\n                return 'array';\r\n            if (t === 'object' && String.prototype.isPrototypeOf(x))\r\n                return 'string';\r\n            return t;\r\n        };\r\n        var isType = function (type) {\r\n            return function (value) {\r\n                return typeOf(value) === type;\r\n            };\r\n        };\r\n        var isString = isType('string');\r\n        var isFunction = isType('function');\r\n        var rawIndexOf = function () {\r\n            var pIndexOf = Array.prototype.indexOf;\r\n            var fastIndex = function (xs, x) {\r\n                return pIndexOf.call(xs, x);\r\n            };\r\n            var slowIndex = function (xs, x) {\r\n                return slowIndexOf(xs, x);\r\n            };\r\n            return pIndexOf === undefined ? slowIndex : fastIndex;\r\n        }();\r\n        var contains = function (xs, x) {\r\n            return rawIndexOf(xs, x) > -1;\r\n        };\r\n        var map = function (xs, f) {\r\n            var len = xs.length;\r\n            var r = new Array(len);\r\n            for (var i = 0; i < len; i++) {\r\n                var x = xs[i];\r\n                r[i] = f(x, i, xs);\r\n            }\r\n            return r;\r\n        };\r\n        var each = function (xs, f) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                f(x, i, xs);\r\n            }\r\n        };\r\n        var foldl = function (xs, f, acc) {\r\n            each(xs, function (x) {\r\n                acc = f(acc, x);\r\n            });\r\n            return acc;\r\n        };\r\n        var slowIndexOf = function (xs, x) {\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (xs[i] === x) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var push = Array.prototype.push;\r\n        var flatten = function (xs) {\r\n            var r = [];\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (!Array.prototype.isPrototypeOf(xs[i]))\r\n                    throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\r\n                push.apply(r, xs[i]);\r\n            }\r\n            return r;\r\n        };\r\n        var bind = function (xs, f) {\r\n            var output = map(xs, f);\r\n            return flatten(output);\r\n        };\r\n        var slice = Array.prototype.slice;\r\n        var from$1 = isFunction(Array.from) ? Array.from : function (x) {\r\n            return slice.call(x);\r\n        };\r\n        var global$4 = tinymce.util.Tools.resolve('tinymce.util.Tools');\r\n        var getHref = function (elm) {\r\n            var href = elm.getAttribute('data-mce-href');\r\n            return href ? href : elm.getAttribute('href');\r\n        };\r\n        var applyRelTargetRules = function (rel, isUnsafe) {\r\n            var rules = ['noopener'];\r\n            var rels = rel ? rel.split(/\\s+/) : [];\r\n            var toString = function (rels) {\r\n                return global$4.trim(rels.sort().join(' '));\r\n            };\r\n            var addTargetRules = function (rels) {\r\n                rels = removeTargetRules(rels);\r\n                return rels.length > 0 ? rels.concat(rules) : rules;\r\n            };\r\n            var removeTargetRules = function (rels) {\r\n                return rels.filter(function (val) {\r\n                    return global$4.inArray(rules, val) === -1;\r\n                });\r\n            };\r\n            var newRels = isUnsafe ? addTargetRules(rels) : removeTargetRules(rels);\r\n            return newRels.length > 0 ? toString(newRels) : '';\r\n        };\r\n        var trimCaretContainers = function (text) {\r\n            return text.replace(/\\uFEFF/g, '');\r\n        };\r\n        var getAnchorElement = function (editor, selectedElm) {\r\n            selectedElm = selectedElm || editor.selection.getNode();\r\n            if (isImageFigure(selectedElm)) {\r\n                return editor.dom.select('a[href]', selectedElm)[0];\r\n            }\r\n            else {\r\n                return editor.dom.getParent(selectedElm, 'a[href]');\r\n            }\r\n        };\r\n        var getAnchorText = function (selection, anchorElm) {\r\n            var text = anchorElm ? anchorElm.innerText || anchorElm.textContent : selection.getContent({ format: 'text' });\r\n            return trimCaretContainers(text);\r\n        };\r\n        var isLink = function (elm) {\r\n            return elm && elm.nodeName === 'A' && !!elm.href;\r\n        };\r\n        var hasLinks = function (elements) {\r\n            return global$4.grep(elements, isLink).length > 0;\r\n        };\r\n        var isOnlyTextSelected = function (html) {\r\n            if (/</.test(html) && (!/^<a [^>]+>[^<]+<\\/a>$/.test(html) || html.indexOf('href=') === -1)) {\r\n                return false;\r\n            }\r\n            return true;\r\n        };\r\n        var isImageFigure = function (elm) {\r\n            return elm && elm.nodeName === 'FIGURE' && /\\bimage\\b/i.test(elm.className);\r\n        };\r\n        var getLinkAttrs = function (data) {\r\n            return foldl([\r\n                'title',\r\n                'rel',\r\n                'class',\r\n                'target'\r\n            ], function (acc, key) {\r\n                data[key].each(function (value) {\r\n                    acc[key] = value.length > 0 ? value : null;\r\n                });\r\n                return acc;\r\n            }, { href: data.href });\r\n        };\r\n        var updateLink = function (editor, anchorElm, text, linkAttrs) {\r\n            text.each(function (text) {\r\n                if (anchorElm.hasOwnProperty('innerText')) {\r\n                    anchorElm.innerText = text;\r\n                }\r\n                else {\r\n                    anchorElm.textContent = text;\r\n                }\r\n            });\r\n            editor.dom.setAttribs(anchorElm, linkAttrs);\r\n            editor.selection.select(anchorElm);\r\n        };\r\n        var createLink = function (editor, selectedElm, text, linkAttrs) {\r\n            if (isImageFigure(selectedElm)) {\r\n                linkImageFigure(editor, selectedElm, linkAttrs);\r\n            }\r\n            else {\r\n                text.fold(function () {\r\n                    editor.execCommand('mceInsertLink', false, linkAttrs);\r\n                }, function (text) {\r\n                    editor.insertContent(editor.dom.createHTML('a', linkAttrs, editor.dom.encode(text)));\r\n                });\r\n            }\r\n        };\r\n        var link = function (editor, attachState, data) {\r\n            editor.undoManager.transact(function () {\r\n                var selectedElm = editor.selection.getNode();\r\n                var anchorElm = getAnchorElement(editor, selectedElm);\r\n                var linkAttrs = getLinkAttrs(data);\r\n                if (!Settings.hasRelList(editor.settings) && Settings.allowUnsafeLinkTarget(editor.settings) === false) {\r\n                    var newRel = applyRelTargetRules(linkAttrs.rel, linkAttrs.target === '_blank');\r\n                    linkAttrs.rel = newRel ? newRel : null;\r\n                }\r\n                if (data.href === attachState.href) {\r\n                    attachState.attach();\r\n                }\r\n                if (anchorElm) {\r\n                    editor.focus();\r\n                    updateLink(editor, anchorElm, data.text, linkAttrs);\r\n                }\r\n                else {\r\n                    createLink(editor, selectedElm, data.text, linkAttrs);\r\n                }\r\n            });\r\n        };\r\n        var unlink = function (editor) {\r\n            editor.undoManager.transact(function () {\r\n                var node = editor.selection.getNode();\r\n                if (isImageFigure(node)) {\r\n                    unlinkImageFigure(editor, node);\r\n                }\r\n                else {\r\n                    var anchorElm = editor.dom.getParent(node, 'a[href]', editor.getBody());\r\n                    if (anchorElm) {\r\n                        editor.dom.remove(anchorElm, true);\r\n                    }\r\n                }\r\n                editor.focus();\r\n            });\r\n        };\r\n        var unlinkImageFigure = function (editor, fig) {\r\n            var img = editor.dom.select('img', fig)[0];\r\n            if (img) {\r\n                var a = editor.dom.getParents(img, 'a[href]', fig)[0];\r\n                if (a) {\r\n                    a.parentNode.insertBefore(img, a);\r\n                    editor.dom.remove(a);\r\n                }\r\n            }\r\n        };\r\n        var linkImageFigure = function (editor, fig, attrs) {\r\n            var img = editor.dom.select('img', fig)[0];\r\n            if (img) {\r\n                var a = editor.dom.create('a', attrs);\r\n                img.parentNode.insertBefore(a, img);\r\n                a.appendChild(img);\r\n            }\r\n        };\r\n        var Utils = {\r\n            link: link,\r\n            unlink: unlink,\r\n            isLink: isLink,\r\n            hasLinks: hasLinks,\r\n            getHref: getHref,\r\n            isOnlyTextSelected: isOnlyTextSelected,\r\n            getAnchorElement: getAnchorElement,\r\n            getAnchorText: getAnchorText,\r\n            applyRelTargetRules: applyRelTargetRules\r\n        };\r\n        var cat = function (arr) {\r\n            var r = [];\r\n            var push = function (x) {\r\n                r.push(x);\r\n            };\r\n            for (var i = 0; i < arr.length; i++) {\r\n                arr[i].each(push);\r\n            }\r\n            return r;\r\n        };\r\n        var findMap = function (arr, f) {\r\n            for (var i = 0; i < arr.length; i++) {\r\n                var r = f(arr[i], i);\r\n                if (r.isSome()) {\r\n                    return r;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var getValue = function (item) {\r\n            return isString(item.value) ? item.value : '';\r\n        };\r\n        var sanitizeList = function (list, extractValue) {\r\n            var out = [];\r\n            global$4.each(list, function (item) {\r\n                var text = isString(item.text) ? item.text : isString(item.title) ? item.title : '';\r\n                if (item.menu !== undefined)\r\n                    ;\r\n                else {\r\n                    var value = extractValue(item);\r\n                    out.push({\r\n                        text: text,\r\n                        value: value\r\n                    });\r\n                }\r\n            });\r\n            return out;\r\n        };\r\n        var sanitizeWith = function (extracter) {\r\n            if (extracter === void 0) {\r\n                extracter = getValue;\r\n            }\r\n            return function (list) {\r\n                return Option.from(list).map(function (list) {\r\n                    return sanitizeList(list, extracter);\r\n                });\r\n            };\r\n        };\r\n        var sanitize = function (list) {\r\n            return sanitizeWith(getValue)(list);\r\n        };\r\n        var createUi = function (name, label) {\r\n            return function (items) {\r\n                return {\r\n                    name: name,\r\n                    type: 'selectbox',\r\n                    label: label,\r\n                    items: items\r\n                };\r\n            };\r\n        };\r\n        var ListOptions = {\r\n            sanitize: sanitize,\r\n            sanitizeWith: sanitizeWith,\r\n            createUi: createUi,\r\n            getValue: getValue\r\n        };\r\n        var Cell = function (initial) {\r\n            var value = initial;\r\n            var get = function () {\r\n                return value;\r\n            };\r\n            var set = function (v) {\r\n                value = v;\r\n            };\r\n            var clone = function () {\r\n                return Cell(get());\r\n            };\r\n            return {\r\n                get: get,\r\n                set: set,\r\n                clone: clone\r\n            };\r\n        };\r\n        var findTextByValue = function (value, catalog) {\r\n            return findMap(catalog, function (item) {\r\n                return Option.some(item).filter(function (i) {\r\n                    return i.value === value;\r\n                });\r\n            });\r\n        };\r\n        var getDelta = function (persistentText, fieldName, catalog, data) {\r\n            var value = data[fieldName];\r\n            var hasPersistentText = persistentText.length > 0;\r\n            return value !== undefined ? findTextByValue(value, catalog).map(function (i) {\r\n                return {\r\n                    url: {\r\n                        value: i.value,\r\n                        meta: {\r\n                            text: hasPersistentText ? persistentText : i.text,\r\n                            attach: noop\r\n                        }\r\n                    },\r\n                    text: hasPersistentText ? persistentText : i.text\r\n                };\r\n            }) : Option.none();\r\n        };\r\n        var findCatalog = function (settings, fieldName) {\r\n            if (fieldName === 'link') {\r\n                return settings.catalogs.link;\r\n            }\r\n            else if (fieldName === 'anchor') {\r\n                return settings.catalogs.anchor;\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var init = function (initialData, linkSettings) {\r\n            var persistentText = Cell(initialData.text);\r\n            var onUrlChange = function (data) {\r\n                if (persistentText.get().length <= 0) {\r\n                    var urlText = data.url.meta.text !== undefined ? data.url.meta.text : data.url.value;\r\n                    return Option.some({ text: urlText });\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            };\r\n            var onCatalogChange = function (data, change) {\r\n                var catalog = findCatalog(linkSettings, change.name).getOr([]);\r\n                return getDelta(persistentText.get(), change.name, catalog, data);\r\n            };\r\n            var onChange = function (getData, change) {\r\n                if (change.name === 'url') {\r\n                    return onUrlChange(getData());\r\n                }\r\n                else if (contains([\r\n                    'anchor',\r\n                    'link'\r\n                ], change.name)) {\r\n                    return onCatalogChange(getData(), change);\r\n                }\r\n                else if (change.name === 'text') {\r\n                    persistentText.set(getData().text);\r\n                    return Option.none();\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            };\r\n            return { onChange: onChange };\r\n        };\r\n        var DialogChanges = {\r\n            init: init,\r\n            getDelta: getDelta\r\n        };\r\n        var __assign = function () {\r\n            __assign = Object.assign || function __assign(t) {\r\n                for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                    s = arguments[i];\r\n                    for (var p in s)\r\n                        if (Object.prototype.hasOwnProperty.call(s, p))\r\n                            t[p] = s[p];\r\n                }\r\n                return t;\r\n            };\r\n            return __assign.apply(this, arguments);\r\n        };\r\n        var nu = function (baseFn) {\r\n            var data = Option.none();\r\n            var callbacks = [];\r\n            var map = function (f) {\r\n                return nu(function (nCallback) {\r\n                    get(function (data) {\r\n                        nCallback(f(data));\r\n                    });\r\n                });\r\n            };\r\n            var get = function (nCallback) {\r\n                if (isReady())\r\n                    call(nCallback);\r\n                else\r\n                    callbacks.push(nCallback);\r\n            };\r\n            var set = function (x) {\r\n                data = Option.some(x);\r\n                run(callbacks);\r\n                callbacks = [];\r\n            };\r\n            var isReady = function () {\r\n                return data.isSome();\r\n            };\r\n            var run = function (cbs) {\r\n                each(cbs, call);\r\n            };\r\n            var call = function (cb) {\r\n                data.each(function (x) {\r\n                    domGlobals.setTimeout(function () {\r\n                        cb(x);\r\n                    }, 0);\r\n                });\r\n            };\r\n            baseFn(set);\r\n            return {\r\n                get: get,\r\n                map: map,\r\n                isReady: isReady\r\n            };\r\n        };\r\n        var pure = function (a) {\r\n            return nu(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var LazyValue = {\r\n            nu: nu,\r\n            pure: pure\r\n        };\r\n        var bounce = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var me = this;\r\n                domGlobals.setTimeout(function () {\r\n                    f.apply(me, args);\r\n                }, 0);\r\n            };\r\n        };\r\n        var nu$1 = function (baseFn) {\r\n            var get = function (callback) {\r\n                baseFn(bounce(callback));\r\n            };\r\n            var map = function (fab) {\r\n                return nu$1(function (callback) {\r\n                    get(function (a) {\r\n                        var value = fab(a);\r\n                        callback(value);\r\n                    });\r\n                });\r\n            };\r\n            var bind = function (aFutureB) {\r\n                return nu$1(function (callback) {\r\n                    get(function (a) {\r\n                        aFutureB(a).get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var anonBind = function (futureB) {\r\n                return nu$1(function (callback) {\r\n                    get(function (a) {\r\n                        futureB.get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var toLazy = function () {\r\n                return LazyValue.nu(get);\r\n            };\r\n            var toCached = function () {\r\n                var cache = null;\r\n                return nu$1(function (callback) {\r\n                    if (cache === null) {\r\n                        cache = toLazy();\r\n                    }\r\n                    cache.get(callback);\r\n                });\r\n            };\r\n            return {\r\n                map: map,\r\n                bind: bind,\r\n                anonBind: anonBind,\r\n                toLazy: toLazy,\r\n                toCached: toCached,\r\n                get: get\r\n            };\r\n        };\r\n        var pure$1 = function (a) {\r\n            return nu$1(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var Future = {\r\n            nu: nu$1,\r\n            pure: pure$1\r\n        };\r\n        var global$5 = tinymce.util.Tools.resolve('tinymce.util.Delay');\r\n        var delayedConfirm = function (editor, message, callback) {\r\n            var rng = editor.selection.getRng();\r\n            global$5.setEditorTimeout(editor, function () {\r\n                editor.windowManager.confirm(message, function (state) {\r\n                    editor.selection.setRng(rng);\r\n                    callback(state);\r\n                });\r\n            });\r\n        };\r\n        var tryEmailTransform = function (data) {\r\n            var url = data.href;\r\n            var suggestMailTo = url.indexOf('@') > 0 && url.indexOf('//') === -1 && url.indexOf('mailto:') === -1;\r\n            return suggestMailTo ? Option.some({\r\n                message: 'The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?',\r\n                preprocess: function (oldData) {\r\n                    return __assign({}, oldData, { href: 'mailto:' + url });\r\n                }\r\n            }) : Option.none();\r\n        };\r\n        var tryProtocolTransform = function (assumeExternalTargets) {\r\n            return function (data) {\r\n                var url = data.href;\r\n                var suggestProtocol = assumeExternalTargets === true && !/^\\w+:/i.test(url) || assumeExternalTargets === false && /^\\s*www[\\.|\\d\\.]/i.test(url);\r\n                return suggestProtocol ? Option.some({\r\n                    message: 'The URL you entered seems to be an external link. Do you want to add the required http:// prefix?',\r\n                    preprocess: function (oldData) {\r\n                        return __assign({}, oldData, { href: 'http://' + url });\r\n                    }\r\n                }) : Option.none();\r\n            };\r\n        };\r\n        var preprocess = function (editor, assumeExternalTargets, data) {\r\n            return findMap([\r\n                tryEmailTransform,\r\n                tryProtocolTransform(assumeExternalTargets)\r\n            ], function (f) {\r\n                return f(data);\r\n            }).fold(function () {\r\n                return Future.pure(data);\r\n            }, function (transform) {\r\n                return Future.nu(function (callback) {\r\n                    delayedConfirm(editor, transform.message, function (state) {\r\n                        domGlobals.console.log('state', state);\r\n                        callback(state ? transform.preprocess(data) : data);\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var DialogConfirms = { preprocess: preprocess };\r\n        var getAnchors = function (editor) {\r\n            var anchorNodes = editor.dom.select('a:not([href])');\r\n            var anchors = bind(anchorNodes, function (anchor) {\r\n                var id = anchor.name || anchor.id;\r\n                return id ? [{\r\n                        text: id,\r\n                        value: '#' + id\r\n                    }] : [];\r\n            });\r\n            return anchors.length > 0 ? Option.some([{\r\n                    text: 'None',\r\n                    value: ''\r\n                }].concat(anchors)) : Option.none();\r\n        };\r\n        var AnchorListOptions = { getAnchors: getAnchors };\r\n        var getClasses = function (editor) {\r\n            if (Settings.hasLinkClassList(editor.settings)) {\r\n                var list = Settings.getLinkClassList(editor.settings);\r\n                return ListOptions.sanitize(list);\r\n            }\r\n            return Option.none();\r\n        };\r\n        var ClassListOptions = { getClasses: getClasses };\r\n        var global$6 = tinymce.util.Tools.resolve('tinymce.util.XHR');\r\n        var parseJson = function (text) {\r\n            try {\r\n                return Option.some(JSON.parse(text));\r\n            }\r\n            catch (err) {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var getLinks = function (editor) {\r\n            var extractor = function (item) {\r\n                return editor.convertURL(item.value || item.url, 'href');\r\n            };\r\n            var linkList = Settings.getLinkList(editor.settings);\r\n            return Future.nu(function (callback) {\r\n                if (typeof linkList === 'string') {\r\n                    global$6.send({\r\n                        url: linkList,\r\n                        success: function (text) {\r\n                            return callback(parseJson(text));\r\n                        },\r\n                        error: function (_) {\r\n                            return callback(Option.none());\r\n                        }\r\n                    });\r\n                }\r\n                else if (typeof linkList === 'function') {\r\n                    linkList(function (output) {\r\n                        return callback(Option.some(output));\r\n                    });\r\n                }\r\n                else {\r\n                    callback(Option.from(linkList));\r\n                }\r\n            }).map(function (opt) {\r\n                return opt.bind(ListOptions.sanitizeWith(extractor));\r\n            });\r\n        };\r\n        var LinkListOptions = { getLinks: getLinks };\r\n        var getRels = function (editor, initialTarget) {\r\n            if (Settings.hasRelList(editor.settings)) {\r\n                var list = Settings.getRelList(editor.settings);\r\n                var isTargetBlank_1 = initialTarget.is('_blank');\r\n                var enforceSafe = Settings.allowUnsafeLinkTarget(editor.settings) === false;\r\n                var safeRelExtractor = function (item) {\r\n                    return Utils.applyRelTargetRules(ListOptions.getValue(item), isTargetBlank_1);\r\n                };\r\n                var sanitizer = enforceSafe ? ListOptions.sanitizeWith(safeRelExtractor) : ListOptions.sanitize;\r\n                return sanitizer(list);\r\n            }\r\n            return Option.none();\r\n        };\r\n        var RelOptions = { getRels: getRels };\r\n        var fallbacks = [\r\n            {\r\n                text: 'Current window',\r\n                value: ''\r\n            },\r\n            {\r\n                text: 'New window',\r\n                value: '_blank'\r\n            }\r\n        ];\r\n        var getTargets = function (editor) {\r\n            if (Settings.shouldShowTargetList(editor.settings)) {\r\n                var list = Settings.getTargetList(editor.settings);\r\n                return ListOptions.sanitize(list).orThunk(function () {\r\n                    return Option.some(fallbacks);\r\n                });\r\n            }\r\n            return Option.none();\r\n        };\r\n        var TargetOptions = { getTargets: getTargets };\r\n        var nonEmptyAttr = function (dom, elem, name) {\r\n            var val = dom.getAttrib(elem, name);\r\n            return val !== null && val.length > 0 ? Option.some(val) : Option.none();\r\n        };\r\n        var extractFromAnchor = function (editor, settings, anchor, selection) {\r\n            var dom = editor.dom;\r\n            var onlyText = Utils.isOnlyTextSelected(selection.getContent());\r\n            var text = onlyText ? Option.some(Utils.getAnchorText(selection, anchor)) : Option.none();\r\n            var url = anchor ? Option.some(dom.getAttrib(anchor, 'href')) : Option.none();\r\n            var target = anchor ? Option.from(dom.getAttrib(anchor, 'target')) : Option.none();\r\n            var rel = nonEmptyAttr(dom, anchor, 'rel');\r\n            var linkClass = nonEmptyAttr(dom, anchor, 'class');\r\n            var title = nonEmptyAttr(dom, anchor, 'title');\r\n            return {\r\n                url: url,\r\n                text: text,\r\n                title: title,\r\n                target: target,\r\n                rel: rel,\r\n                linkClass: linkClass\r\n            };\r\n        };\r\n        var collect = function (editor, settings, linkNode) {\r\n            return LinkListOptions.getLinks(editor).map(function (links) {\r\n                var anchor = extractFromAnchor(editor, settings, linkNode, editor.selection);\r\n                return {\r\n                    anchor: anchor,\r\n                    catalogs: {\r\n                        targets: TargetOptions.getTargets(editor),\r\n                        rels: RelOptions.getRels(editor, anchor.target),\r\n                        classes: ClassListOptions.getClasses(editor),\r\n                        anchor: AnchorListOptions.getAnchors(editor),\r\n                        link: links\r\n                    },\r\n                    optNode: Option.from(linkNode),\r\n                    flags: { titleEnabled: Settings.shouldShowLinkTitle(settings) }\r\n                };\r\n            });\r\n        };\r\n        var DialogInfo = { collect: collect };\r\n        var handleSubmit = function (editor, info, assumeExternalTargets) {\r\n            return function (api) {\r\n                var data = api.getData();\r\n                if (!data.url.value) {\r\n                    Utils.unlink(editor);\r\n                    api.close();\r\n                    return;\r\n                }\r\n                var getChangedValue = function (key) {\r\n                    return Option.from(data[key]).filter(function (value) {\r\n                        return !info.anchor[key].is(value);\r\n                    });\r\n                };\r\n                var changedData = {\r\n                    href: data.url.value,\r\n                    text: getChangedValue('text'),\r\n                    target: getChangedValue('target'),\r\n                    rel: getChangedValue('rel'),\r\n                    class: getChangedValue('linkClass'),\r\n                    title: getChangedValue('title')\r\n                };\r\n                var attachState = {\r\n                    href: data.url.value,\r\n                    attach: data.url.meta !== undefined && data.url.meta.attach ? data.url.meta.attach : function () {\r\n                    }\r\n                };\r\n                DialogConfirms.preprocess(editor, assumeExternalTargets, changedData).get(function (pData) {\r\n                    Utils.link(editor, attachState, pData);\r\n                });\r\n                api.close();\r\n            };\r\n        };\r\n        var collectData = function (editor) {\r\n            var settings = editor.settings;\r\n            var anchorNode = Utils.getAnchorElement(editor);\r\n            return DialogInfo.collect(editor, settings, anchorNode);\r\n        };\r\n        var getInitialData = function (info, defaultTarget) {\r\n            return {\r\n                url: {\r\n                    value: info.anchor.url.getOr(''),\r\n                    meta: {\r\n                        attach: function () {\r\n                        },\r\n                        text: info.anchor.url.fold(function () {\r\n                            return '';\r\n                        }, function () {\r\n                            return info.anchor.text.getOr('');\r\n                        }),\r\n                        original: { value: info.anchor.url.getOr('') }\r\n                    }\r\n                },\r\n                text: info.anchor.text.getOr(''),\r\n                title: info.anchor.title.getOr(''),\r\n                anchor: info.anchor.url.getOr(''),\r\n                link: info.anchor.url.getOr(''),\r\n                rel: info.anchor.rel.getOr(''),\r\n                target: info.anchor.target.or(defaultTarget).getOr(''),\r\n                linkClass: info.anchor.linkClass.getOr('')\r\n            };\r\n        };\r\n        var makeDialog = function (settings, onSubmit, editorSettings) {\r\n            var urlInput = [{\r\n                    name: 'url',\r\n                    type: 'urlinput',\r\n                    filetype: 'file',\r\n                    label: 'URL'\r\n                }];\r\n            var displayText = settings.anchor.text.map(function () {\r\n                return {\r\n                    name: 'text',\r\n                    type: 'input',\r\n                    label: 'Text to display'\r\n                };\r\n            }).toArray();\r\n            var titleText = settings.flags.titleEnabled ? [{\r\n                    name: 'title',\r\n                    type: 'input',\r\n                    label: 'Title'\r\n                }] : [];\r\n            var defaultTarget = Settings.hasDefaultLinkTarget(editorSettings) ? Option.some(Settings.getDefaultLinkTarget(editorSettings)) : Option.none();\r\n            var initialData = getInitialData(settings, defaultTarget);\r\n            var dialogDelta = DialogChanges.init(initialData, settings);\r\n            var catalogs = settings.catalogs;\r\n            var body = {\r\n                type: 'panel',\r\n                items: flatten([\r\n                    urlInput,\r\n                    displayText,\r\n                    titleText,\r\n                    cat([\r\n                        catalogs.anchor.map(ListOptions.createUi('anchor', 'Anchors')),\r\n                        catalogs.rels.map(ListOptions.createUi('rel', 'Rel')),\r\n                        catalogs.targets.map(ListOptions.createUi('target', 'Open link in...')),\r\n                        catalogs.link.map(ListOptions.createUi('link', 'Link list')),\r\n                        catalogs.classes.map(ListOptions.createUi('linkClass', 'Class'))\r\n                    ])\r\n                ])\r\n            };\r\n            return {\r\n                title: 'Insert/Edit Link',\r\n                size: 'normal',\r\n                body: body,\r\n                buttons: [\r\n                    {\r\n                        type: 'cancel',\r\n                        name: 'cancel',\r\n                        text: 'Cancel'\r\n                    },\r\n                    {\r\n                        type: 'submit',\r\n                        name: 'save',\r\n                        text: 'Save',\r\n                        primary: true\r\n                    }\r\n                ],\r\n                initialData: initialData,\r\n                onChange: function (api, _a) {\r\n                    var name = _a.name;\r\n                    dialogDelta.onChange(api.getData, { name: name }).each(function (newData) {\r\n                        api.setData(newData);\r\n                    });\r\n                },\r\n                onSubmit: onSubmit\r\n            };\r\n        };\r\n        var open$1 = function (editor) {\r\n            var data = collectData(editor);\r\n            data.map(function (info) {\r\n                var onSubmit = handleSubmit(editor, info, Settings.assumeExternalTargets(editor.settings));\r\n                return makeDialog(info, onSubmit, editor.settings);\r\n            }).get(function (spec) {\r\n                editor.windowManager.open(spec);\r\n            });\r\n        };\r\n        var Dialog = { open: open$1 };\r\n        var getLink = function (editor, elm) {\r\n            return editor.dom.getParent(elm, 'a[href]');\r\n        };\r\n        var getSelectedLink = function (editor) {\r\n            return getLink(editor, editor.selection.getStart());\r\n        };\r\n        var hasOnlyAltModifier = function (e) {\r\n            return e.altKey === true && e.shiftKey === false && e.ctrlKey === false && e.metaKey === false;\r\n        };\r\n        var gotoLink = function (editor, a) {\r\n            if (a) {\r\n                var href = Utils.getHref(a);\r\n                if (/^#/.test(href)) {\r\n                    var targetEl = editor.$(href);\r\n                    if (targetEl.length) {\r\n                        editor.selection.scrollIntoView(targetEl[0], true);\r\n                    }\r\n                }\r\n                else {\r\n                    OpenUrl.open(a.href);\r\n                }\r\n            }\r\n        };\r\n        var openDialog = function (editor) {\r\n            return function () {\r\n                Dialog.open(editor);\r\n            };\r\n        };\r\n        var gotoSelectedLink = function (editor) {\r\n            return function () {\r\n                gotoLink(editor, getSelectedLink(editor));\r\n            };\r\n        };\r\n        var leftClickedOnAHref = function (editor) {\r\n            return function (elm) {\r\n                var sel, rng, node;\r\n                if (Settings.hasContextToolbar(editor.settings) && Utils.isLink(elm)) {\r\n                    sel = editor.selection;\r\n                    rng = sel.getRng();\r\n                    node = rng.startContainer;\r\n                    if (node.nodeType === 3 && sel.isCollapsed() && rng.startOffset > 0 && rng.startOffset < node.data.length) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n        };\r\n        var setupGotoLinks = function (editor) {\r\n            editor.on('click', function (e) {\r\n                var link = getLink(editor, e.target);\r\n                if (link && global$1.metaKeyPressed(e)) {\r\n                    e.preventDefault();\r\n                    gotoLink(editor, link);\r\n                }\r\n            });\r\n            editor.on('keydown', function (e) {\r\n                var link = getSelectedLink(editor);\r\n                if (link && e.keyCode === 13 && hasOnlyAltModifier(e)) {\r\n                    e.preventDefault();\r\n                    gotoLink(editor, link);\r\n                }\r\n            });\r\n        };\r\n        var toggleActiveState = function (editor) {\r\n            return function (api) {\r\n                var nodeChangeHandler = function (e) {\r\n                    return api.setActive(!editor.readonly && !!Utils.getAnchorElement(editor, e.element));\r\n                };\r\n                editor.on('NodeChange', nodeChangeHandler);\r\n                return function () {\r\n                    return editor.off('NodeChange', nodeChangeHandler);\r\n                };\r\n            };\r\n        };\r\n        var toggleEnabledState = function (editor) {\r\n            return function (api) {\r\n                api.setDisabled(!Utils.hasLinks(editor.dom.getParents(editor.selection.getStart())));\r\n                var nodeChangeHandler = function (e) {\r\n                    return api.setDisabled(!Utils.hasLinks(e.parents));\r\n                };\r\n                editor.on('NodeChange', nodeChangeHandler);\r\n                return function () {\r\n                    return editor.off('NodeChange', nodeChangeHandler);\r\n                };\r\n            };\r\n        };\r\n        var Actions = {\r\n            openDialog: openDialog,\r\n            gotoSelectedLink: gotoSelectedLink,\r\n            leftClickedOnAHref: leftClickedOnAHref,\r\n            setupGotoLinks: setupGotoLinks,\r\n            toggleActiveState: toggleActiveState,\r\n            toggleEnabledState: toggleEnabledState\r\n        };\r\n        var register = function (editor) {\r\n            editor.addCommand('mceLink', function () {\r\n                if (Settings.useQuickLink(editor.settings)) {\r\n                    editor.fire('contexttoolbar-show', { toolbarKey: 'quicklink' });\r\n                }\r\n                else {\r\n                    Actions.openDialog(editor)();\r\n                }\r\n            });\r\n        };\r\n        var Commands = { register: register };\r\n        var setup = function (editor) {\r\n            editor.addShortcut('Meta+K', '', function () {\r\n                editor.execCommand('mceLink');\r\n            });\r\n        };\r\n        var Keyboard = { setup: setup };\r\n        var setupButtons = function (editor) {\r\n            editor.ui.registry.addToggleButton('link', {\r\n                icon: 'link',\r\n                tooltip: 'Insert/edit link',\r\n                onAction: Actions.openDialog(editor),\r\n                onSetup: Actions.toggleActiveState(editor)\r\n            });\r\n            editor.ui.registry.addButton('unlink', {\r\n                icon: 'unlink',\r\n                tooltip: 'Remove link',\r\n                onAction: function () {\r\n                    return Utils.unlink(editor);\r\n                },\r\n                onSetup: Actions.toggleEnabledState(editor)\r\n            });\r\n        };\r\n        var setupMenuItems = function (editor) {\r\n            editor.ui.registry.addMenuItem('openlink', {\r\n                text: 'Open link',\r\n                icon: 'new-tab',\r\n                onAction: Actions.gotoSelectedLink(editor),\r\n                onSetup: Actions.toggleEnabledState(editor)\r\n            });\r\n            editor.ui.registry.addMenuItem('link', {\r\n                icon: 'link',\r\n                text: 'Link...',\r\n                shortcut: 'Meta+K',\r\n                onAction: Actions.openDialog(editor)\r\n            });\r\n            editor.ui.registry.addMenuItem('unlink', {\r\n                icon: 'unlink',\r\n                text: 'Remove link',\r\n                onAction: function () {\r\n                    return Utils.unlink(editor);\r\n                },\r\n                onSetup: Actions.toggleEnabledState(editor)\r\n            });\r\n        };\r\n        var setupContextMenu = function (editor) {\r\n            var noLink = 'link';\r\n            var inLink = 'link unlink openlink';\r\n            editor.ui.registry.addContextMenu('link', {\r\n                update: function (element) {\r\n                    return Utils.hasLinks(editor.dom.getParents(element, 'a')) ? inLink : noLink;\r\n                }\r\n            });\r\n        };\r\n        var setupContextToolbars = function (editor) {\r\n            var collapseSelectionToEnd = function (editor) {\r\n                editor.selection.collapse(false);\r\n            };\r\n            var onSetupLink = function (buttonApi) {\r\n                var node = editor.selection.getNode();\r\n                buttonApi.setDisabled(!Utils.getAnchorElement(editor, node));\r\n                return function () {\r\n                };\r\n            };\r\n            editor.ui.registry.addContextForm('quicklink', {\r\n                launch: {\r\n                    type: 'contextformtogglebutton',\r\n                    icon: 'link',\r\n                    tooltip: 'Link',\r\n                    onSetup: Actions.toggleActiveState(editor)\r\n                },\r\n                label: 'Link',\r\n                predicate: function (node) {\r\n                    return !!Utils.getAnchorElement(editor, node) && Settings.hasContextToolbar(editor.settings);\r\n                },\r\n                initValue: function () {\r\n                    var elm = Utils.getAnchorElement(editor);\r\n                    return !!elm ? Utils.getHref(elm) : '';\r\n                },\r\n                commands: [\r\n                    {\r\n                        type: 'contextformtogglebutton',\r\n                        icon: 'link',\r\n                        tooltip: 'Link',\r\n                        primary: true,\r\n                        onSetup: function (buttonApi) {\r\n                            var node = editor.selection.getNode();\r\n                            buttonApi.setActive(!!Utils.getAnchorElement(editor, node));\r\n                            return Actions.toggleActiveState(editor)(buttonApi);\r\n                        },\r\n                        onAction: function (formApi) {\r\n                            var anchor = Utils.getAnchorElement(editor);\r\n                            var value = formApi.getValue();\r\n                            if (!anchor) {\r\n                                var attachState = {\r\n                                    href: value,\r\n                                    attach: function () {\r\n                                    }\r\n                                };\r\n                                var onlyText = Utils.isOnlyTextSelected(editor.selection.getContent());\r\n                                var text = onlyText ? Option.some(Utils.getAnchorText(editor.selection, anchor)).filter(function (t) {\r\n                                    return t.length > 0;\r\n                                }).or(Option.from(value)) : Option.none();\r\n                                Utils.link(editor, attachState, {\r\n                                    href: value,\r\n                                    text: text,\r\n                                    title: Option.none(),\r\n                                    rel: Option.none(),\r\n                                    target: Option.none(),\r\n                                    class: Option.none()\r\n                                });\r\n                                formApi.hide();\r\n                            }\r\n                            else {\r\n                                editor.dom.setAttrib(anchor, 'href', value);\r\n                                collapseSelectionToEnd(editor);\r\n                                formApi.hide();\r\n                            }\r\n                        }\r\n                    },\r\n                    {\r\n                        type: 'contextformbutton',\r\n                        icon: 'unlink',\r\n                        tooltip: 'Remove link',\r\n                        onSetup: onSetupLink,\r\n                        onAction: function (formApi) {\r\n                            Utils.unlink(editor);\r\n                            formApi.hide();\r\n                        }\r\n                    },\r\n                    {\r\n                        type: 'contextformbutton',\r\n                        icon: 'new-tab',\r\n                        tooltip: 'Open link',\r\n                        onSetup: onSetupLink,\r\n                        onAction: function (formApi) {\r\n                            Actions.gotoSelectedLink(editor)();\r\n                            formApi.hide();\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n        };\r\n        var Controls = {\r\n            setupButtons: setupButtons,\r\n            setupMenuItems: setupMenuItems,\r\n            setupContextMenu: setupContextMenu,\r\n            setupContextToolbars: setupContextToolbars\r\n        };\r\n        global.add('link', function (editor) {\r\n            Controls.setupButtons(editor);\r\n            Controls.setupMenuItems(editor);\r\n            Controls.setupContextMenu(editor);\r\n            Controls.setupContextToolbars(editor);\r\n            Actions.setupGotoLinks(editor);\r\n            Commands.register(editor);\r\n            Keyboard.setup(editor);\r\n        });\r\n        function Plugin() {\r\n        }\r\n        return Plugin;\r\n    }(window));\r\n})();\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/plugins/link/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/save/index.js":
/*!****************************************************!*\
  !*** ./node_modules/tinymce/plugins/save/index.js ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n__webpack_require__(/*! ./plugin.js */ \"./node_modules/tinymce/plugins/save/plugin.js\");\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/plugins/save/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/plugins/save/plugin.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/plugins/save/plugin.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n    var save = (function () {\r\n        'use strict';\r\n        var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\r\n        var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\r\n        var global$2 = tinymce.util.Tools.resolve('tinymce.util.Tools');\r\n        var enableWhenDirty = function (editor) {\r\n            return editor.getParam('save_enablewhendirty', true);\r\n        };\r\n        var hasOnSaveCallback = function (editor) {\r\n            return !!editor.getParam('save_onsavecallback');\r\n        };\r\n        var hasOnCancelCallback = function (editor) {\r\n            return !!editor.getParam('save_oncancelcallback');\r\n        };\r\n        var Settings = {\r\n            enableWhenDirty: enableWhenDirty,\r\n            hasOnSaveCallback: hasOnSaveCallback,\r\n            hasOnCancelCallback: hasOnCancelCallback\r\n        };\r\n        var displayErrorMessage = function (editor, message) {\r\n            editor.notificationManager.open({\r\n                text: message,\r\n                type: 'error'\r\n            });\r\n        };\r\n        var save = function (editor) {\r\n            var formObj;\r\n            formObj = global$1.DOM.getParent(editor.id, 'form');\r\n            if (Settings.enableWhenDirty(editor) && !editor.isDirty()) {\r\n                return;\r\n            }\r\n            editor.save();\r\n            if (Settings.hasOnSaveCallback(editor)) {\r\n                editor.execCallback('save_onsavecallback', editor);\r\n                editor.nodeChanged();\r\n                return;\r\n            }\r\n            if (formObj) {\r\n                editor.setDirty(false);\r\n                if (!formObj.onsubmit || formObj.onsubmit()) {\r\n                    if (typeof formObj.submit === 'function') {\r\n                        formObj.submit();\r\n                    }\r\n                    else {\r\n                        displayErrorMessage(editor, 'Error: Form submit field collision.');\r\n                    }\r\n                }\r\n                editor.nodeChanged();\r\n            }\r\n            else {\r\n                displayErrorMessage(editor, 'Error: No form element found.');\r\n            }\r\n        };\r\n        var cancel = function (editor) {\r\n            var h = global$2.trim(editor.startContent);\r\n            if (Settings.hasOnCancelCallback(editor)) {\r\n                editor.execCallback('save_oncancelcallback', editor);\r\n                return;\r\n            }\r\n            editor.resetContent(h);\r\n        };\r\n        var Actions = {\r\n            save: save,\r\n            cancel: cancel\r\n        };\r\n        var register = function (editor) {\r\n            editor.addCommand('mceSave', function () {\r\n                Actions.save(editor);\r\n            });\r\n            editor.addCommand('mceCancel', function () {\r\n                Actions.cancel(editor);\r\n            });\r\n        };\r\n        var Commands = { register: register };\r\n        var stateToggle = function (editor) {\r\n            return function (api) {\r\n                var handler = function () {\r\n                    api.setDisabled(Settings.enableWhenDirty(editor) && !editor.isDirty());\r\n                };\r\n                editor.on('NodeChange dirty', handler);\r\n                return function () {\r\n                    return editor.off('NodeChange dirty', handler);\r\n                };\r\n            };\r\n        };\r\n        var register$1 = function (editor) {\r\n            editor.ui.registry.addButton('save', {\r\n                icon: 'save',\r\n                tooltip: 'Save',\r\n                disabled: true,\r\n                onAction: function () {\r\n                    return editor.execCommand('mceSave');\r\n                },\r\n                onSetup: stateToggle(editor)\r\n            });\r\n            editor.ui.registry.addButton('cancel', {\r\n                icon: 'cancel',\r\n                tooltip: 'Cancel',\r\n                disabled: true,\r\n                onAction: function () {\r\n                    return editor.execCommand('mceCancel');\r\n                },\r\n                onSetup: stateToggle(editor)\r\n            });\r\n            editor.addShortcut('Meta+S', '', 'mceSave');\r\n        };\r\n        var Buttons = { register: register$1 };\r\n        global.add('save', function (editor) {\r\n            Buttons.register(editor);\r\n            Commands.register(editor);\r\n        });\r\n        function Plugin() {\r\n        }\r\n        return Plugin;\r\n    }());\r\n})();\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/plugins/save/plugin.js?");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/index.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/index.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n__webpack_require__(/*! ./theme.js */ \"./node_modules/tinymce/themes/silver/theme.js\");\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/themes/silver/index.js?");

/***/ }),

/***/ "./node_modules/tinymce/themes/silver/theme.js":
/*!*****************************************************!*\
  !*** ./node_modules/tinymce/themes/silver/theme.js ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n    var silver = (function (domGlobals) {\r\n        'use strict';\r\n        var noop = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n        };\r\n        var noarg = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return f();\r\n            };\r\n        };\r\n        var compose = function (fa, fb) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return fa(fb.apply(null, args));\r\n            };\r\n        };\r\n        var constant = function (value) {\r\n            return function () {\r\n                return value;\r\n            };\r\n        };\r\n        var identity = function (x) {\r\n            return x;\r\n        };\r\n        var tripleEquals = function (a, b) {\r\n            return a === b;\r\n        };\r\n        function curry(fn) {\r\n            var initialArgs = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                initialArgs[_i - 1] = arguments[_i];\r\n            }\r\n            return function () {\r\n                var restArgs = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    restArgs[_i] = arguments[_i];\r\n                }\r\n                var all = initialArgs.concat(restArgs);\r\n                return fn.apply(null, all);\r\n            };\r\n        }\r\n        var not = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return !f.apply(null, args);\r\n            };\r\n        };\r\n        var die = function (msg) {\r\n            return function () {\r\n                throw new Error(msg);\r\n            };\r\n        };\r\n        var apply = function (f) {\r\n            return f();\r\n        };\r\n        var call = function (f) {\r\n            f();\r\n        };\r\n        var never = constant(false);\r\n        var always = constant(true);\r\n        var Fun = Object.freeze({\r\n            noop: noop,\r\n            noarg: noarg,\r\n            compose: compose,\r\n            constant: constant,\r\n            identity: identity,\r\n            tripleEquals: tripleEquals,\r\n            curry: curry,\r\n            not: not,\r\n            die: die,\r\n            apply: apply,\r\n            call: call,\r\n            never: never,\r\n            always: always\r\n        });\r\n        var never$1 = never;\r\n        var always$1 = always;\r\n        var none = function () {\r\n            return NONE;\r\n        };\r\n        var NONE = function () {\r\n            var eq = function (o) {\r\n                return o.isNone();\r\n            };\r\n            var call = function (thunk) {\r\n                return thunk();\r\n            };\r\n            var id = function (n) {\r\n                return n;\r\n            };\r\n            var noop = function () {\r\n            };\r\n            var nul = function () {\r\n                return null;\r\n            };\r\n            var undef = function () {\r\n                return undefined;\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return n();\r\n                },\r\n                is: never$1,\r\n                isSome: never$1,\r\n                isNone: always$1,\r\n                getOr: id,\r\n                getOrThunk: call,\r\n                getOrDie: function (msg) {\r\n                    throw new Error(msg || 'error: getOrDie called on none.');\r\n                },\r\n                getOrNull: nul,\r\n                getOrUndefined: undef,\r\n                or: id,\r\n                orThunk: call,\r\n                map: none,\r\n                ap: none,\r\n                each: noop,\r\n                bind: none,\r\n                flatten: none,\r\n                exists: never$1,\r\n                forall: always$1,\r\n                filter: none,\r\n                equals: eq,\r\n                equals_: eq,\r\n                toArray: function () {\r\n                    return [];\r\n                },\r\n                toString: constant('none()')\r\n            };\r\n            if (Object.freeze)\r\n                Object.freeze(me);\r\n            return me;\r\n        }();\r\n        var some = function (a) {\r\n            var constant_a = function () {\r\n                return a;\r\n            };\r\n            var self = function () {\r\n                return me;\r\n            };\r\n            var map = function (f) {\r\n                return some(f(a));\r\n            };\r\n            var bind = function (f) {\r\n                return f(a);\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return s(a);\r\n                },\r\n                is: function (v) {\r\n                    return a === v;\r\n                },\r\n                isSome: always$1,\r\n                isNone: never$1,\r\n                getOr: constant_a,\r\n                getOrThunk: constant_a,\r\n                getOrDie: constant_a,\r\n                getOrNull: constant_a,\r\n                getOrUndefined: constant_a,\r\n                or: self,\r\n                orThunk: self,\r\n                map: map,\r\n                ap: function (optfab) {\r\n                    return optfab.fold(none, function (fab) {\r\n                        return some(fab(a));\r\n                    });\r\n                },\r\n                each: function (f) {\r\n                    f(a);\r\n                },\r\n                bind: bind,\r\n                flatten: constant_a,\r\n                exists: bind,\r\n                forall: bind,\r\n                filter: function (f) {\r\n                    return f(a) ? me : NONE;\r\n                },\r\n                equals: function (o) {\r\n                    return o.is(a);\r\n                },\r\n                equals_: function (o, elementEq) {\r\n                    return o.fold(never$1, function (b) {\r\n                        return elementEq(a, b);\r\n                    });\r\n                },\r\n                toArray: function () {\r\n                    return [a];\r\n                },\r\n                toString: function () {\r\n                    return 'some(' + a + ')';\r\n                }\r\n            };\r\n            return me;\r\n        };\r\n        var from = function (value) {\r\n            return value === null || value === undefined ? NONE : some(value);\r\n        };\r\n        var Option = {\r\n            some: some,\r\n            none: none,\r\n            from: from\r\n        };\r\n        var typeOf = function (x) {\r\n            if (x === null)\r\n                return 'null';\r\n            var t = typeof x;\r\n            if (t === 'object' && Array.prototype.isPrototypeOf(x))\r\n                return 'array';\r\n            if (t === 'object' && String.prototype.isPrototypeOf(x))\r\n                return 'string';\r\n            return t;\r\n        };\r\n        var isType = function (type) {\r\n            return function (value) {\r\n                return typeOf(value) === type;\r\n            };\r\n        };\r\n        var isString = isType('string');\r\n        var isObject = isType('object');\r\n        var isArray = isType('array');\r\n        var isNull = isType('null');\r\n        var isBoolean = isType('boolean');\r\n        var isUndefined = isType('undefined');\r\n        var isFunction = isType('function');\r\n        var isNumber = isType('number');\r\n        var Type = Object.freeze({\r\n            isString: isString,\r\n            isObject: isObject,\r\n            isArray: isArray,\r\n            isNull: isNull,\r\n            isBoolean: isBoolean,\r\n            isUndefined: isUndefined,\r\n            isFunction: isFunction,\r\n            isNumber: isNumber\r\n        });\r\n        var rawIndexOf = function () {\r\n            var pIndexOf = Array.prototype.indexOf;\r\n            var fastIndex = function (xs, x) {\r\n                return pIndexOf.call(xs, x);\r\n            };\r\n            var slowIndex = function (xs, x) {\r\n                return slowIndexOf(xs, x);\r\n            };\r\n            return pIndexOf === undefined ? slowIndex : fastIndex;\r\n        }();\r\n        var indexOf = function (xs, x) {\r\n            var r = rawIndexOf(xs, x);\r\n            return r === -1 ? Option.none() : Option.some(r);\r\n        };\r\n        var contains = function (xs, x) {\r\n            return rawIndexOf(xs, x) > -1;\r\n        };\r\n        var exists = function (xs, pred) {\r\n            return findIndex(xs, pred).isSome();\r\n        };\r\n        var range = function (num, f) {\r\n            var r = [];\r\n            for (var i = 0; i < num; i++) {\r\n                r.push(f(i));\r\n            }\r\n            return r;\r\n        };\r\n        var chunk = function (array, size) {\r\n            var r = [];\r\n            for (var i = 0; i < array.length; i += size) {\r\n                var s = array.slice(i, i + size);\r\n                r.push(s);\r\n            }\r\n            return r;\r\n        };\r\n        var map = function (xs, f) {\r\n            var len = xs.length;\r\n            var r = new Array(len);\r\n            for (var i = 0; i < len; i++) {\r\n                var x = xs[i];\r\n                r[i] = f(x, i, xs);\r\n            }\r\n            return r;\r\n        };\r\n        var each = function (xs, f) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                f(x, i, xs);\r\n            }\r\n        };\r\n        var eachr = function (xs, f) {\r\n            for (var i = xs.length - 1; i >= 0; i--) {\r\n                var x = xs[i];\r\n                f(x, i, xs);\r\n            }\r\n        };\r\n        var partition = function (xs, pred) {\r\n            var pass = [];\r\n            var fail = [];\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                var arr = pred(x, i, xs) ? pass : fail;\r\n                arr.push(x);\r\n            }\r\n            return {\r\n                pass: pass,\r\n                fail: fail\r\n            };\r\n        };\r\n        var filter = function (xs, pred) {\r\n            var r = [];\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    r.push(x);\r\n                }\r\n            }\r\n            return r;\r\n        };\r\n        var groupBy = function (xs, f) {\r\n            if (xs.length === 0) {\r\n                return [];\r\n            }\r\n            else {\r\n                var wasType = f(xs[0]);\r\n                var r = [];\r\n                var group = [];\r\n                for (var i = 0, len = xs.length; i < len; i++) {\r\n                    var x = xs[i];\r\n                    var type = f(x);\r\n                    if (type !== wasType) {\r\n                        r.push(group);\r\n                        group = [];\r\n                    }\r\n                    wasType = type;\r\n                    group.push(x);\r\n                }\r\n                if (group.length !== 0) {\r\n                    r.push(group);\r\n                }\r\n                return r;\r\n            }\r\n        };\r\n        var foldr = function (xs, f, acc) {\r\n            eachr(xs, function (x) {\r\n                acc = f(acc, x);\r\n            });\r\n            return acc;\r\n        };\r\n        var foldl = function (xs, f, acc) {\r\n            each(xs, function (x) {\r\n                acc = f(acc, x);\r\n            });\r\n            return acc;\r\n        };\r\n        var find = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    return Option.some(x);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var findIndex = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    return Option.some(i);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var slowIndexOf = function (xs, x) {\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (xs[i] === x) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var push = Array.prototype.push;\r\n        var flatten = function (xs) {\r\n            var r = [];\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (!Array.prototype.isPrototypeOf(xs[i]))\r\n                    throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\r\n                push.apply(r, xs[i]);\r\n            }\r\n            return r;\r\n        };\r\n        var bind = function (xs, f) {\r\n            var output = map(xs, f);\r\n            return flatten(output);\r\n        };\r\n        var forall = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs) !== true) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        var equal = function (a1, a2) {\r\n            return a1.length === a2.length && forall(a1, function (x, i) {\r\n                return x === a2[i];\r\n            });\r\n        };\r\n        var slice = Array.prototype.slice;\r\n        var reverse = function (xs) {\r\n            var r = slice.call(xs, 0);\r\n            r.reverse();\r\n            return r;\r\n        };\r\n        var difference = function (a1, a2) {\r\n            return filter(a1, function (x) {\r\n                return !contains(a2, x);\r\n            });\r\n        };\r\n        var mapToObject = function (xs, f) {\r\n            var r = {};\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                r[String(x)] = f(x, i);\r\n            }\r\n            return r;\r\n        };\r\n        var pure = function (x) {\r\n            return [x];\r\n        };\r\n        var sort = function (xs, comparator) {\r\n            var copy = slice.call(xs, 0);\r\n            copy.sort(comparator);\r\n            return copy;\r\n        };\r\n        var head = function (xs) {\r\n            return xs.length === 0 ? Option.none() : Option.some(xs[0]);\r\n        };\r\n        var last = function (xs) {\r\n            return xs.length === 0 ? Option.none() : Option.some(xs[xs.length - 1]);\r\n        };\r\n        var from$1 = isFunction(Array.from) ? Array.from : function (x) {\r\n            return slice.call(x);\r\n        };\r\n        var Arr = Object.freeze({\r\n            indexOf: indexOf,\r\n            contains: contains,\r\n            exists: exists,\r\n            range: range,\r\n            chunk: chunk,\r\n            map: map,\r\n            each: each,\r\n            eachr: eachr,\r\n            partition: partition,\r\n            filter: filter,\r\n            groupBy: groupBy,\r\n            foldr: foldr,\r\n            foldl: foldl,\r\n            find: find,\r\n            findIndex: findIndex,\r\n            flatten: flatten,\r\n            bind: bind,\r\n            forall: forall,\r\n            equal: equal,\r\n            reverse: reverse,\r\n            difference: difference,\r\n            mapToObject: mapToObject,\r\n            pure: pure,\r\n            sort: sort,\r\n            head: head,\r\n            last: last,\r\n            from: from$1\r\n        });\r\n        var keys = Object.keys;\r\n        var hasOwnProperty = Object.hasOwnProperty;\r\n        var each$1 = function (obj, f) {\r\n            var props = keys(obj);\r\n            for (var k = 0, len = props.length; k < len; k++) {\r\n                var i = props[k];\r\n                var x = obj[i];\r\n                f(x, i, obj);\r\n            }\r\n        };\r\n        var map$1 = function (obj, f) {\r\n            return tupleMap(obj, function (x, i, obj) {\r\n                return {\r\n                    k: i,\r\n                    v: f(x, i, obj)\r\n                };\r\n            });\r\n        };\r\n        var tupleMap = function (obj, f) {\r\n            var r = {};\r\n            each$1(obj, function (x, i) {\r\n                var tuple = f(x, i, obj);\r\n                r[tuple.k] = tuple.v;\r\n            });\r\n            return r;\r\n        };\r\n        var bifilter = function (obj, pred) {\r\n            var t = {};\r\n            var f = {};\r\n            each$1(obj, function (x, i) {\r\n                var branch = pred(x, i) ? t : f;\r\n                branch[i] = x;\r\n            });\r\n            return {\r\n                t: t,\r\n                f: f\r\n            };\r\n        };\r\n        var mapToArray = function (obj, f) {\r\n            var r = [];\r\n            each$1(obj, function (value, name) {\r\n                r.push(f(value, name));\r\n            });\r\n            return r;\r\n        };\r\n        var find$1 = function (obj, pred) {\r\n            var props = keys(obj);\r\n            for (var k = 0, len = props.length; k < len; k++) {\r\n                var i = props[k];\r\n                var x = obj[i];\r\n                if (pred(x, i, obj)) {\r\n                    return Option.some(x);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var values = function (obj) {\r\n            return mapToArray(obj, function (v) {\r\n                return v;\r\n            });\r\n        };\r\n        var size = function (obj) {\r\n            return keys(obj).length;\r\n        };\r\n        var get = function (obj, key) {\r\n            return has(obj, key) ? Option.from(obj[key]) : Option.none();\r\n        };\r\n        var has = function (obj, key) {\r\n            return hasOwnProperty.call(obj, key);\r\n        };\r\n        var Obj = Object.freeze({\r\n            keys: keys,\r\n            hasOwnProperty: hasOwnProperty,\r\n            each: each$1,\r\n            map: map$1,\r\n            tupleMap: tupleMap,\r\n            bifilter: bifilter,\r\n            mapToArray: mapToArray,\r\n            find: find$1,\r\n            values: values,\r\n            size: size,\r\n            get: get,\r\n            has: has\r\n        });\r\n        var narrow = function (obj, fields) {\r\n            var r = {};\r\n            each(fields, function (field) {\r\n                if (obj[field] !== undefined && has(obj, field)) {\r\n                    r[field] = obj[field];\r\n                }\r\n            });\r\n            return r;\r\n        };\r\n        var indexOnKey = function (array, key) {\r\n            var obj = {};\r\n            each(array, function (a) {\r\n                var keyValue = a[key];\r\n                obj[keyValue] = a;\r\n            });\r\n            return obj;\r\n        };\r\n        var exclude = function (obj, fields) {\r\n            var r = {};\r\n            each$1(obj, function (v, k) {\r\n                if (!contains(fields, k)) {\r\n                    r[k] = v;\r\n                }\r\n            });\r\n            return r;\r\n        };\r\n        var readOpt = function (key) {\r\n            return function (obj) {\r\n                return has(obj, key) ? Option.from(obj[key]) : Option.none();\r\n            };\r\n        };\r\n        var readOr = function (key, fallback) {\r\n            return function (obj) {\r\n                return has(obj, key) ? obj[key] : fallback;\r\n            };\r\n        };\r\n        var readOptFrom = function (obj, key) {\r\n            return readOpt(key)(obj);\r\n        };\r\n        var hasKey = function (obj, key) {\r\n            return has(obj, key) && obj[key] !== undefined && obj[key] !== null;\r\n        };\r\n        var wrap = function (key, value) {\r\n            var r = {};\r\n            r[key] = value;\r\n            return r;\r\n        };\r\n        var wrapAll = function (keyvalues) {\r\n            var r = {};\r\n            each(keyvalues, function (kv) {\r\n                r[kv.key] = kv.value;\r\n            });\r\n            return r;\r\n        };\r\n        var value = function (o) {\r\n            var is = function (v) {\r\n                return o === v;\r\n            };\r\n            var or = function (opt) {\r\n                return value(o);\r\n            };\r\n            var orThunk = function (f) {\r\n                return value(o);\r\n            };\r\n            var map = function (f) {\r\n                return value(f(o));\r\n            };\r\n            var mapError = function (f) {\r\n                return value(o);\r\n            };\r\n            var each = function (f) {\r\n                f(o);\r\n            };\r\n            var bind = function (f) {\r\n                return f(o);\r\n            };\r\n            var fold = function (_, onValue) {\r\n                return onValue(o);\r\n            };\r\n            var exists = function (f) {\r\n                return f(o);\r\n            };\r\n            var forall = function (f) {\r\n                return f(o);\r\n            };\r\n            var toOption = function () {\r\n                return Option.some(o);\r\n            };\r\n            return {\r\n                is: is,\r\n                isValue: always,\r\n                isError: never,\r\n                getOr: constant(o),\r\n                getOrThunk: constant(o),\r\n                getOrDie: constant(o),\r\n                or: or,\r\n                orThunk: orThunk,\r\n                fold: fold,\r\n                map: map,\r\n                mapError: mapError,\r\n                each: each,\r\n                bind: bind,\r\n                exists: exists,\r\n                forall: forall,\r\n                toOption: toOption\r\n            };\r\n        };\r\n        var error = function (message) {\r\n            var getOrThunk = function (f) {\r\n                return f();\r\n            };\r\n            var getOrDie = function () {\r\n                return die(String(message))();\r\n            };\r\n            var or = function (opt) {\r\n                return opt;\r\n            };\r\n            var orThunk = function (f) {\r\n                return f();\r\n            };\r\n            var map = function (f) {\r\n                return error(message);\r\n            };\r\n            var mapError = function (f) {\r\n                return error(f(message));\r\n            };\r\n            var bind = function (f) {\r\n                return error(message);\r\n            };\r\n            var fold = function (onError, _) {\r\n                return onError(message);\r\n            };\r\n            return {\r\n                is: never,\r\n                isValue: never,\r\n                isError: always,\r\n                getOr: identity,\r\n                getOrThunk: getOrThunk,\r\n                getOrDie: getOrDie,\r\n                or: or,\r\n                orThunk: orThunk,\r\n                fold: fold,\r\n                map: map,\r\n                mapError: mapError,\r\n                each: noop,\r\n                bind: bind,\r\n                exists: never,\r\n                forall: always,\r\n                toOption: Option.none\r\n            };\r\n        };\r\n        var fromOption = function (opt, err) {\r\n            return opt.fold(function () {\r\n                return error(err);\r\n            }, value);\r\n        };\r\n        var Result = {\r\n            value: value,\r\n            error: error,\r\n            fromOption: fromOption\r\n        };\r\n        var generate = function (cases) {\r\n            if (!isArray(cases)) {\r\n                throw new Error('cases must be an array');\r\n            }\r\n            if (cases.length === 0) {\r\n                throw new Error('there must be at least one case');\r\n            }\r\n            var constructors = [];\r\n            var adt = {};\r\n            each(cases, function (acase, count) {\r\n                var keys$1 = keys(acase);\r\n                if (keys$1.length !== 1) {\r\n                    throw new Error('one and only one name per case');\r\n                }\r\n                var key = keys$1[0];\r\n                var value = acase[key];\r\n                if (adt[key] !== undefined) {\r\n                    throw new Error('duplicate key detected:' + key);\r\n                }\r\n                else if (key === 'cata') {\r\n                    throw new Error('cannot have a case named cata (sorry)');\r\n                }\r\n                else if (!isArray(value)) {\r\n                    throw new Error('case arguments must be an array');\r\n                }\r\n                constructors.push(key);\r\n                adt[key] = function () {\r\n                    var argLength = arguments.length;\r\n                    if (argLength !== value.length) {\r\n                        throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\r\n                    }\r\n                    var args = new Array(argLength);\r\n                    for (var i = 0; i < args.length; i++)\r\n                        args[i] = arguments[i];\r\n                    var match = function (branches) {\r\n                        var branchKeys = keys(branches);\r\n                        if (constructors.length !== branchKeys.length) {\r\n                            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\r\n                        }\r\n                        var allReqd = forall(constructors, function (reqKey) {\r\n                            return contains(branchKeys, reqKey);\r\n                        });\r\n                        if (!allReqd)\r\n                            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\r\n                        return branches[key].apply(null, args);\r\n                    };\r\n                    return {\r\n                        fold: function () {\r\n                            if (arguments.length !== cases.length) {\r\n                                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\r\n                            }\r\n                            var target = arguments[count];\r\n                            return target.apply(null, args);\r\n                        },\r\n                        match: match,\r\n                        log: function (label) {\r\n                            domGlobals.console.log(label, {\r\n                                constructors: constructors,\r\n                                constructor: key,\r\n                                params: args\r\n                            });\r\n                        }\r\n                    };\r\n                };\r\n            });\r\n            return adt;\r\n        };\r\n        var Adt = { generate: generate };\r\n        var comparison = Adt.generate([\r\n            {\r\n                bothErrors: [\r\n                    'error1',\r\n                    'error2'\r\n                ]\r\n            },\r\n            {\r\n                firstError: [\r\n                    'error1',\r\n                    'value2'\r\n                ]\r\n            },\r\n            {\r\n                secondError: [\r\n                    'value1',\r\n                    'error2'\r\n                ]\r\n            },\r\n            {\r\n                bothValues: [\r\n                    'value1',\r\n                    'value2'\r\n                ]\r\n            }\r\n        ]);\r\n        var partition$1 = function (results) {\r\n            var errors = [];\r\n            var values = [];\r\n            each(results, function (result) {\r\n                result.fold(function (err) {\r\n                    errors.push(err);\r\n                }, function (value) {\r\n                    values.push(value);\r\n                });\r\n            });\r\n            return {\r\n                errors: errors,\r\n                values: values\r\n            };\r\n        };\r\n        var hasOwnProperty$1 = Object.prototype.hasOwnProperty;\r\n        var shallow = function (old, nu) {\r\n            return nu;\r\n        };\r\n        var deep = function (old, nu) {\r\n            var bothObjects = isObject(old) && isObject(nu);\r\n            return bothObjects ? deepMerge(old, nu) : nu;\r\n        };\r\n        var baseMerge = function (merger) {\r\n            return function () {\r\n                var objects = new Array(arguments.length);\r\n                for (var i = 0; i < objects.length; i++)\r\n                    objects[i] = arguments[i];\r\n                if (objects.length === 0)\r\n                    throw new Error('Can\\'t merge zero objects');\r\n                var ret = {};\r\n                for (var j = 0; j < objects.length; j++) {\r\n                    var curObject = objects[j];\r\n                    for (var key in curObject)\r\n                        if (hasOwnProperty$1.call(curObject, key)) {\r\n                            ret[key] = merger(ret[key], curObject[key]);\r\n                        }\r\n                }\r\n                return ret;\r\n            };\r\n        };\r\n        var deepMerge = baseMerge(deep);\r\n        var merge = baseMerge(shallow);\r\n        var narrow$1 = function (obj, fields) {\r\n            return narrow(obj, fields);\r\n        };\r\n        var exclude$1 = function (obj, fields) {\r\n            return exclude(obj, fields);\r\n        };\r\n        var readOpt$1 = function (key) {\r\n            return readOpt(key);\r\n        };\r\n        var readOr$1 = function (key, fallback) {\r\n            return readOr(key, fallback);\r\n        };\r\n        var readOptFrom$1 = function (obj, key) {\r\n            return readOptFrom(obj, key);\r\n        };\r\n        var wrap$1 = function (key, value) {\r\n            return wrap(key, value);\r\n        };\r\n        var wrapAll$1 = function (keyvalues) {\r\n            return wrapAll(keyvalues);\r\n        };\r\n        var indexOnKey$1 = function (array, key) {\r\n            return indexOnKey(array, key);\r\n        };\r\n        var mergeValues = function (values, base) {\r\n            return values.length === 0 ? Result.value(base) : Result.value(deepMerge(base, merge.apply(undefined, values)));\r\n        };\r\n        var mergeErrors = function (errors) {\r\n            return compose(Result.error, flatten)(errors);\r\n        };\r\n        var consolidate = function (objs, base) {\r\n            var partitions = partition$1(objs);\r\n            return partitions.errors.length > 0 ? mergeErrors(partitions.errors) : mergeValues(partitions.values, base);\r\n        };\r\n        var hasKey$1 = function (obj, key) {\r\n            return hasKey(obj, key);\r\n        };\r\n        var Objects = Object.freeze({\r\n            narrow: narrow$1,\r\n            exclude: exclude$1,\r\n            readOpt: readOpt$1,\r\n            readOr: readOr$1,\r\n            readOptFrom: readOptFrom$1,\r\n            wrap: wrap$1,\r\n            wrapAll: wrapAll$1,\r\n            indexOnKey: indexOnKey$1,\r\n            hasKey: hasKey$1,\r\n            consolidate: consolidate\r\n        });\r\n        var Cell = function (initial) {\r\n            var value = initial;\r\n            var get = function () {\r\n                return value;\r\n            };\r\n            var set = function (v) {\r\n                value = v;\r\n            };\r\n            var clone = function () {\r\n                return Cell(get());\r\n            };\r\n            return {\r\n                get: get,\r\n                set: set,\r\n                clone: clone\r\n            };\r\n        };\r\n        var cat = function (arr) {\r\n            var r = [];\r\n            var push = function (x) {\r\n                r.push(x);\r\n            };\r\n            for (var i = 0; i < arr.length; i++) {\r\n                arr[i].each(push);\r\n            }\r\n            return r;\r\n        };\r\n        var findMap = function (arr, f) {\r\n            for (var i = 0; i < arr.length; i++) {\r\n                var r = f(arr[i], i);\r\n                if (r.isSome()) {\r\n                    return r;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var liftN = function (arr, f) {\r\n            var r = [];\r\n            for (var i = 0; i < arr.length; i++) {\r\n                var x = arr[i];\r\n                if (x.isSome()) {\r\n                    r.push(x.getOrDie());\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            }\r\n            return Option.some(f.apply(null, r));\r\n        };\r\n        function lift() {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n            var f = args.pop();\r\n            return liftN(args, f);\r\n        }\r\n        var Options = Object.freeze({\r\n            cat: cat,\r\n            findMap: findMap,\r\n            liftN: liftN,\r\n            lift: lift\r\n        });\r\n        var touchstart = constant('touchstart');\r\n        var touchmove = constant('touchmove');\r\n        var touchend = constant('touchend');\r\n        var mousedown = constant('mousedown');\r\n        var mousemove = constant('mousemove');\r\n        var mouseout = constant('mouseout');\r\n        var mouseup = constant('mouseup');\r\n        var mouseover = constant('mouseover');\r\n        var focusin = constant('focusin');\r\n        var focusout = constant('focusout');\r\n        var keydown = constant('keydown');\r\n        var keyup = constant('keyup');\r\n        var input = constant('input');\r\n        var change = constant('change');\r\n        var click = constant('click');\r\n        var transitionend = constant('transitionend');\r\n        var selectstart = constant('selectstart');\r\n        var cached = function (f) {\r\n            var called = false;\r\n            var r;\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                if (!called) {\r\n                    called = true;\r\n                    r = f.apply(null, args);\r\n                }\r\n                return r;\r\n            };\r\n        };\r\n        var firstMatch = function (regexes, s) {\r\n            for (var i = 0; i < regexes.length; i++) {\r\n                var x = regexes[i];\r\n                if (x.test(s))\r\n                    return x;\r\n            }\r\n            return undefined;\r\n        };\r\n        var find$2 = function (regexes, agent) {\r\n            var r = firstMatch(regexes, agent);\r\n            if (!r)\r\n                return {\r\n                    major: 0,\r\n                    minor: 0\r\n                };\r\n            var group = function (i) {\r\n                return Number(agent.replace(r, '$' + i));\r\n            };\r\n            return nu(group(1), group(2));\r\n        };\r\n        var detect = function (versionRegexes, agent) {\r\n            var cleanedAgent = String(agent).toLowerCase();\r\n            if (versionRegexes.length === 0)\r\n                return unknown();\r\n            return find$2(versionRegexes, cleanedAgent);\r\n        };\r\n        var unknown = function () {\r\n            return nu(0, 0);\r\n        };\r\n        var nu = function (major, minor) {\r\n            return {\r\n                major: major,\r\n                minor: minor\r\n            };\r\n        };\r\n        var Version = {\r\n            nu: nu,\r\n            detect: detect,\r\n            unknown: unknown\r\n        };\r\n        var edge = 'Edge';\r\n        var chrome = 'Chrome';\r\n        var ie = 'IE';\r\n        var opera = 'Opera';\r\n        var firefox = 'Firefox';\r\n        var safari = 'Safari';\r\n        var isBrowser = function (name, current) {\r\n            return function () {\r\n                return current === name;\r\n            };\r\n        };\r\n        var unknown$1 = function () {\r\n            return nu$1({\r\n                current: undefined,\r\n                version: Version.unknown()\r\n            });\r\n        };\r\n        var nu$1 = function (info) {\r\n            var current = info.current;\r\n            var version = info.version;\r\n            return {\r\n                current: current,\r\n                version: version,\r\n                isEdge: isBrowser(edge, current),\r\n                isChrome: isBrowser(chrome, current),\r\n                isIE: isBrowser(ie, current),\r\n                isOpera: isBrowser(opera, current),\r\n                isFirefox: isBrowser(firefox, current),\r\n                isSafari: isBrowser(safari, current)\r\n            };\r\n        };\r\n        var Browser = {\r\n            unknown: unknown$1,\r\n            nu: nu$1,\r\n            edge: constant(edge),\r\n            chrome: constant(chrome),\r\n            ie: constant(ie),\r\n            opera: constant(opera),\r\n            firefox: constant(firefox),\r\n            safari: constant(safari)\r\n        };\r\n        var windows = 'Windows';\r\n        var ios = 'iOS';\r\n        var android = 'Android';\r\n        var linux = 'Linux';\r\n        var osx = 'OSX';\r\n        var solaris = 'Solaris';\r\n        var freebsd = 'FreeBSD';\r\n        var isOS = function (name, current) {\r\n            return function () {\r\n                return current === name;\r\n            };\r\n        };\r\n        var unknown$2 = function () {\r\n            return nu$2({\r\n                current: undefined,\r\n                version: Version.unknown()\r\n            });\r\n        };\r\n        var nu$2 = function (info) {\r\n            var current = info.current;\r\n            var version = info.version;\r\n            return {\r\n                current: current,\r\n                version: version,\r\n                isWindows: isOS(windows, current),\r\n                isiOS: isOS(ios, current),\r\n                isAndroid: isOS(android, current),\r\n                isOSX: isOS(osx, current),\r\n                isLinux: isOS(linux, current),\r\n                isSolaris: isOS(solaris, current),\r\n                isFreeBSD: isOS(freebsd, current)\r\n            };\r\n        };\r\n        var OperatingSystem = {\r\n            unknown: unknown$2,\r\n            nu: nu$2,\r\n            windows: constant(windows),\r\n            ios: constant(ios),\r\n            android: constant(android),\r\n            linux: constant(linux),\r\n            osx: constant(osx),\r\n            solaris: constant(solaris),\r\n            freebsd: constant(freebsd)\r\n        };\r\n        var DeviceType = function (os, browser, userAgent) {\r\n            var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\r\n            var isiPhone = os.isiOS() && !isiPad;\r\n            var isAndroid3 = os.isAndroid() && os.version.major === 3;\r\n            var isAndroid4 = os.isAndroid() && os.version.major === 4;\r\n            var isTablet = isiPad || isAndroid3 || isAndroid4 && /mobile/i.test(userAgent) === true;\r\n            var isTouch = os.isiOS() || os.isAndroid();\r\n            var isPhone = isTouch && !isTablet;\r\n            var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\r\n            return {\r\n                isiPad: constant(isiPad),\r\n                isiPhone: constant(isiPhone),\r\n                isTablet: constant(isTablet),\r\n                isPhone: constant(isPhone),\r\n                isTouch: constant(isTouch),\r\n                isAndroid: os.isAndroid,\r\n                isiOS: os.isiOS,\r\n                isWebView: constant(iOSwebview)\r\n            };\r\n        };\r\n        var detect$1 = function (candidates, userAgent) {\r\n            var agent = String(userAgent).toLowerCase();\r\n            return find(candidates, function (candidate) {\r\n                return candidate.search(agent);\r\n            });\r\n        };\r\n        var detectBrowser = function (browsers, userAgent) {\r\n            return detect$1(browsers, userAgent).map(function (browser) {\r\n                var version = Version.detect(browser.versionRegexes, userAgent);\r\n                return {\r\n                    current: browser.name,\r\n                    version: version\r\n                };\r\n            });\r\n        };\r\n        var detectOs = function (oses, userAgent) {\r\n            return detect$1(oses, userAgent).map(function (os) {\r\n                var version = Version.detect(os.versionRegexes, userAgent);\r\n                return {\r\n                    current: os.name,\r\n                    version: version\r\n                };\r\n            });\r\n        };\r\n        var UaString = {\r\n            detectBrowser: detectBrowser,\r\n            detectOs: detectOs\r\n        };\r\n        var checkRange = function (str, substr, start) {\r\n            if (substr === '')\r\n                return true;\r\n            if (str.length < substr.length)\r\n                return false;\r\n            var x = str.substr(start, start + substr.length);\r\n            return x === substr;\r\n        };\r\n        var contains$1 = function (str, substr) {\r\n            return str.indexOf(substr) !== -1;\r\n        };\r\n        var endsWith = function (str, suffix) {\r\n            return checkRange(str, suffix, str.length - suffix.length);\r\n        };\r\n        var trim = function (str) {\r\n            return str.replace(/^\\s+|\\s+$/g, '');\r\n        };\r\n        var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\r\n        var checkContains = function (target) {\r\n            return function (uastring) {\r\n                return contains$1(uastring, target);\r\n            };\r\n        };\r\n        var browsers = [\r\n            {\r\n                name: 'Edge',\r\n                versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\r\n                search: function (uastring) {\r\n                    var monstrosity = contains$1(uastring, 'edge/') && contains$1(uastring, 'chrome') && contains$1(uastring, 'safari') && contains$1(uastring, 'applewebkit');\r\n                    return monstrosity;\r\n                }\r\n            },\r\n            {\r\n                name: 'Chrome',\r\n                versionRegexes: [\r\n                    /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\r\n                    normalVersionRegex\r\n                ],\r\n                search: function (uastring) {\r\n                    return contains$1(uastring, 'chrome') && !contains$1(uastring, 'chromeframe');\r\n                }\r\n            },\r\n            {\r\n                name: 'IE',\r\n                versionRegexes: [\r\n                    /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\r\n                    /.*?rv:([0-9]+)\\.([0-9]+).*/\r\n                ],\r\n                search: function (uastring) {\r\n                    return contains$1(uastring, 'msie') || contains$1(uastring, 'trident');\r\n                }\r\n            },\r\n            {\r\n                name: 'Opera',\r\n                versionRegexes: [\r\n                    normalVersionRegex,\r\n                    /.*?opera\\/([0-9]+)\\.([0-9]+).*/\r\n                ],\r\n                search: checkContains('opera')\r\n            },\r\n            {\r\n                name: 'Firefox',\r\n                versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\r\n                search: checkContains('firefox')\r\n            },\r\n            {\r\n                name: 'Safari',\r\n                versionRegexes: [\r\n                    normalVersionRegex,\r\n                    /.*?cpu os ([0-9]+)_([0-9]+).*/\r\n                ],\r\n                search: function (uastring) {\r\n                    return (contains$1(uastring, 'safari') || contains$1(uastring, 'mobile/')) && contains$1(uastring, 'applewebkit');\r\n                }\r\n            }\r\n        ];\r\n        var oses = [\r\n            {\r\n                name: 'Windows',\r\n                search: checkContains('win'),\r\n                versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'iOS',\r\n                search: function (uastring) {\r\n                    return contains$1(uastring, 'iphone') || contains$1(uastring, 'ipad');\r\n                },\r\n                versionRegexes: [\r\n                    /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\r\n                    /.*cpu os ([0-9]+)_([0-9]+).*/,\r\n                    /.*cpu iphone os ([0-9]+)_([0-9]+).*/\r\n                ]\r\n            },\r\n            {\r\n                name: 'Android',\r\n                search: checkContains('android'),\r\n                versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'OSX',\r\n                search: checkContains('os x'),\r\n                versionRegexes: [/.*?os\\ x\\ ?([0-9]+)_([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'Linux',\r\n                search: checkContains('linux'),\r\n                versionRegexes: []\r\n            },\r\n            {\r\n                name: 'Solaris',\r\n                search: checkContains('sunos'),\r\n                versionRegexes: []\r\n            },\r\n            {\r\n                name: 'FreeBSD',\r\n                search: checkContains('freebsd'),\r\n                versionRegexes: []\r\n            }\r\n        ];\r\n        var PlatformInfo = {\r\n            browsers: constant(browsers),\r\n            oses: constant(oses)\r\n        };\r\n        var detect$2 = function (userAgent) {\r\n            var browsers = PlatformInfo.browsers();\r\n            var oses = PlatformInfo.oses();\r\n            var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\r\n            var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\r\n            var deviceType = DeviceType(os, browser, userAgent);\r\n            return {\r\n                browser: browser,\r\n                os: os,\r\n                deviceType: deviceType\r\n            };\r\n        };\r\n        var PlatformDetection = { detect: detect$2 };\r\n        var detect$3 = cached(function () {\r\n            var userAgent = domGlobals.navigator.userAgent;\r\n            return PlatformDetection.detect(userAgent);\r\n        });\r\n        var PlatformDetection$1 = { detect: detect$3 };\r\n        var alloy = { tap: constant('alloy.tap') };\r\n        var focus = constant('alloy.focus');\r\n        var postBlur = constant('alloy.blur.post');\r\n        var postPaste = constant('alloy.paste.post');\r\n        var receive = constant('alloy.receive');\r\n        var execute = constant('alloy.execute');\r\n        var focusItem = constant('alloy.focus.item');\r\n        var tap = alloy.tap;\r\n        var tapOrClick = PlatformDetection$1.detect().deviceType.isTouch() ? alloy.tap : click;\r\n        var longpress = constant('alloy.longpress');\r\n        var sandboxClose = constant('alloy.sandbox.close');\r\n        var typeaheadCancel = constant('alloy.typeahead.cancel');\r\n        var systemInit = constant('alloy.system.init');\r\n        var windowScroll = constant('alloy.system.scroll');\r\n        var windowResize = constant('alloy.system.resize');\r\n        var attachedToDom = constant('alloy.system.attached');\r\n        var detachedFromDom = constant('alloy.system.detached');\r\n        var dismissRequested = constant('alloy.system.dismissRequested');\r\n        var focusShifted = constant('alloy.focusmanager.shifted');\r\n        var slotVisibility = constant('alloy.slotcontainer.visibility');\r\n        var changeTab = constant('alloy.change.tab');\r\n        var dismissTab = constant('alloy.dismiss.tab');\r\n        var highlight = constant('alloy.highlight');\r\n        var dehighlight = constant('alloy.dehighlight');\r\n        var fromHtml = function (html, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var div = doc.createElement('div');\r\n            div.innerHTML = html;\r\n            if (!div.hasChildNodes() || div.childNodes.length > 1) {\r\n                domGlobals.console.error('HTML does not have a single root node', html);\r\n                throw new Error('HTML must have a single root node');\r\n            }\r\n            return fromDom(div.childNodes[0]);\r\n        };\r\n        var fromTag = function (tag, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var node = doc.createElement(tag);\r\n            return fromDom(node);\r\n        };\r\n        var fromText = function (text, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var node = doc.createTextNode(text);\r\n            return fromDom(node);\r\n        };\r\n        var fromDom = function (node) {\r\n            if (node === null || node === undefined) {\r\n                throw new Error('Node cannot be null or undefined');\r\n            }\r\n            return { dom: constant(node) };\r\n        };\r\n        var fromPoint = function (docElm, x, y) {\r\n            var doc = docElm.dom();\r\n            return Option.from(doc.elementFromPoint(x, y)).map(fromDom);\r\n        };\r\n        var Element = {\r\n            fromHtml: fromHtml,\r\n            fromTag: fromTag,\r\n            fromText: fromText,\r\n            fromDom: fromDom,\r\n            fromPoint: fromPoint\r\n        };\r\n        var Immutable = function () {\r\n            var fields = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                fields[_i] = arguments[_i];\r\n            }\r\n            return function () {\r\n                var values = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    values[_i] = arguments[_i];\r\n                }\r\n                if (fields.length !== values.length) {\r\n                    throw new Error('Wrong number of arguments to struct. Expected \"[' + fields.length + ']\", got ' + values.length + ' arguments');\r\n                }\r\n                var struct = {};\r\n                each(fields, function (name, i) {\r\n                    struct[name] = constant(values[i]);\r\n                });\r\n                return struct;\r\n            };\r\n        };\r\n        var sort$1 = function (arr) {\r\n            return arr.slice(0).sort();\r\n        };\r\n        var reqMessage = function (required, keys) {\r\n            throw new Error('All required keys (' + sort$1(required).join(', ') + ') were not specified. Specified keys were: ' + sort$1(keys).join(', ') + '.');\r\n        };\r\n        var unsuppMessage = function (unsupported) {\r\n            throw new Error('Unsupported keys for object: ' + sort$1(unsupported).join(', '));\r\n        };\r\n        var validateStrArr = function (label, array) {\r\n            if (!isArray(array))\r\n                throw new Error('The ' + label + ' fields must be an array. Was: ' + array + '.');\r\n            each(array, function (a) {\r\n                if (!isString(a))\r\n                    throw new Error('The value ' + a + ' in the ' + label + ' fields was not a string.');\r\n            });\r\n        };\r\n        var checkDupes = function (everything) {\r\n            var sorted = sort$1(everything);\r\n            var dupe = find(sorted, function (s, i) {\r\n                return i < sorted.length - 1 && s === sorted[i + 1];\r\n            });\r\n            dupe.each(function (d) {\r\n                throw new Error('The field: ' + d + ' occurs more than once in the combined fields: [' + sorted.join(', ') + '].');\r\n            });\r\n        };\r\n        var MixedBag = function (required, optional) {\r\n            var everything = required.concat(optional);\r\n            if (everything.length === 0)\r\n                throw new Error('You must specify at least one required or optional field.');\r\n            validateStrArr('required', required);\r\n            validateStrArr('optional', optional);\r\n            checkDupes(everything);\r\n            return function (obj) {\r\n                var keys$1 = keys(obj);\r\n                var allReqd = forall(required, function (req) {\r\n                    return contains(keys$1, req);\r\n                });\r\n                if (!allReqd)\r\n                    reqMessage(required, keys$1);\r\n                var unsupported = filter(keys$1, function (key) {\r\n                    return !contains(everything, key);\r\n                });\r\n                if (unsupported.length > 0)\r\n                    unsuppMessage(unsupported);\r\n                var r = {};\r\n                each(required, function (req) {\r\n                    r[req] = constant(obj[req]);\r\n                });\r\n                each(optional, function (opt) {\r\n                    r[opt] = constant(Object.prototype.hasOwnProperty.call(obj, opt) ? Option.some(obj[opt]) : Option.none());\r\n                });\r\n                return r;\r\n            };\r\n        };\r\n        var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\r\n        var path = function (parts, scope) {\r\n            var o = scope !== undefined && scope !== null ? scope : Global;\r\n            for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i)\r\n                o = o[parts[i]];\r\n            return o;\r\n        };\r\n        var resolve = function (p, scope) {\r\n            var parts = p.split('.');\r\n            return path(parts, scope);\r\n        };\r\n        var unsafe = function (name, scope) {\r\n            return resolve(name, scope);\r\n        };\r\n        var getOrDie = function (name, scope) {\r\n            var actual = unsafe(name, scope);\r\n            if (actual === undefined || actual === null)\r\n                throw name + ' not available on this browser';\r\n            return actual;\r\n        };\r\n        var Global$1 = { getOrDie: getOrDie };\r\n        var node = function () {\r\n            var f = Global$1.getOrDie('Node');\r\n            return f;\r\n        };\r\n        var compareDocumentPosition = function (a, b, match) {\r\n            return (a.compareDocumentPosition(b) & match) !== 0;\r\n        };\r\n        var documentPositionPreceding = function (a, b) {\r\n            return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_PRECEDING);\r\n        };\r\n        var documentPositionContainedBy = function (a, b) {\r\n            return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_CONTAINED_BY);\r\n        };\r\n        var Node = {\r\n            documentPositionPreceding: documentPositionPreceding,\r\n            documentPositionContainedBy: documentPositionContainedBy\r\n        };\r\n        var ATTRIBUTE = domGlobals.Node.ATTRIBUTE_NODE;\r\n        var CDATA_SECTION = domGlobals.Node.CDATA_SECTION_NODE;\r\n        var COMMENT = domGlobals.Node.COMMENT_NODE;\r\n        var DOCUMENT = domGlobals.Node.DOCUMENT_NODE;\r\n        var DOCUMENT_TYPE = domGlobals.Node.DOCUMENT_TYPE_NODE;\r\n        var DOCUMENT_FRAGMENT = domGlobals.Node.DOCUMENT_FRAGMENT_NODE;\r\n        var ELEMENT = domGlobals.Node.ELEMENT_NODE;\r\n        var TEXT = domGlobals.Node.TEXT_NODE;\r\n        var PROCESSING_INSTRUCTION = domGlobals.Node.PROCESSING_INSTRUCTION_NODE;\r\n        var ENTITY_REFERENCE = domGlobals.Node.ENTITY_REFERENCE_NODE;\r\n        var ENTITY = domGlobals.Node.ENTITY_NODE;\r\n        var NOTATION = domGlobals.Node.NOTATION_NODE;\r\n        var ELEMENT$1 = ELEMENT;\r\n        var DOCUMENT$1 = DOCUMENT;\r\n        var is = function (element, selector) {\r\n            var elem = element.dom();\r\n            if (elem.nodeType !== ELEMENT$1) {\r\n                return false;\r\n            }\r\n            else if (elem.matches !== undefined) {\r\n                return elem.matches(selector);\r\n            }\r\n            else if (elem.msMatchesSelector !== undefined) {\r\n                return elem.msMatchesSelector(selector);\r\n            }\r\n            else if (elem.webkitMatchesSelector !== undefined) {\r\n                return elem.webkitMatchesSelector(selector);\r\n            }\r\n            else if (elem.mozMatchesSelector !== undefined) {\r\n                return elem.mozMatchesSelector(selector);\r\n            }\r\n            else {\r\n                throw new Error('Browser lacks native selectors');\r\n            }\r\n        };\r\n        var bypassSelector = function (dom) {\r\n            return dom.nodeType !== ELEMENT$1 && dom.nodeType !== DOCUMENT$1 || dom.childElementCount === 0;\r\n        };\r\n        var all = function (selector, scope) {\r\n            var base = scope === undefined ? domGlobals.document : scope.dom();\r\n            return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), Element.fromDom);\r\n        };\r\n        var one = function (selector, scope) {\r\n            var base = scope === undefined ? domGlobals.document : scope.dom();\r\n            return bypassSelector(base) ? Option.none() : Option.from(base.querySelector(selector)).map(Element.fromDom);\r\n        };\r\n        var eq = function (e1, e2) {\r\n            return e1.dom() === e2.dom();\r\n        };\r\n        var regularContains = function (e1, e2) {\r\n            var d1 = e1.dom();\r\n            var d2 = e2.dom();\r\n            return d1 === d2 ? false : d1.contains(d2);\r\n        };\r\n        var ieContains = function (e1, e2) {\r\n            return Node.documentPositionContainedBy(e1.dom(), e2.dom());\r\n        };\r\n        var browser = PlatformDetection$1.detect().browser;\r\n        var contains$2 = browser.isIE() ? ieContains : regularContains;\r\n        var owner = function (element) {\r\n            return Element.fromDom(element.dom().ownerDocument);\r\n        };\r\n        var defaultView = function (element) {\r\n            var el = element.dom();\r\n            var defView = el.ownerDocument.defaultView;\r\n            return Element.fromDom(defView);\r\n        };\r\n        var parent = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.parentNode).map(Element.fromDom);\r\n        };\r\n        var parents = function (element, isRoot) {\r\n            var stop = isFunction(isRoot) ? isRoot : constant(false);\r\n            var dom = element.dom();\r\n            var ret = [];\r\n            while (dom.parentNode !== null && dom.parentNode !== undefined) {\r\n                var rawParent = dom.parentNode;\r\n                var p = Element.fromDom(rawParent);\r\n                ret.push(p);\r\n                if (stop(p) === true) {\r\n                    break;\r\n                }\r\n                else {\r\n                    dom = rawParent;\r\n                }\r\n            }\r\n            return ret;\r\n        };\r\n        var siblings = function (element) {\r\n            var filterSelf = function (elements) {\r\n                return filter(elements, function (x) {\r\n                    return !eq(element, x);\r\n                });\r\n            };\r\n            return parent(element).map(children).map(filterSelf).getOr([]);\r\n        };\r\n        var offsetParent = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.offsetParent).map(Element.fromDom);\r\n        };\r\n        var nextSibling = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.nextSibling).map(Element.fromDom);\r\n        };\r\n        var children = function (element) {\r\n            var dom = element.dom();\r\n            return map(dom.childNodes, Element.fromDom);\r\n        };\r\n        var child = function (element, index) {\r\n            var cs = element.dom().childNodes;\r\n            return Option.from(cs[index]).map(Element.fromDom);\r\n        };\r\n        var firstChild = function (element) {\r\n            return child(element, 0);\r\n        };\r\n        var spot = Immutable('element', 'offset');\r\n        var fromHtml$1 = function (html, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var div = doc.createElement('div');\r\n            div.innerHTML = html;\r\n            return children(Element.fromDom(div));\r\n        };\r\n        var before = function (marker, element) {\r\n            var parent$1 = parent(marker);\r\n            parent$1.each(function (v) {\r\n                v.dom().insertBefore(element.dom(), marker.dom());\r\n            });\r\n        };\r\n        var after = function (marker, element) {\r\n            var sibling = nextSibling(marker);\r\n            sibling.fold(function () {\r\n                var parent$1 = parent(marker);\r\n                parent$1.each(function (v) {\r\n                    append(v, element);\r\n                });\r\n            }, function (v) {\r\n                before(v, element);\r\n            });\r\n        };\r\n        var prepend = function (parent, element) {\r\n            var firstChild$1 = firstChild(parent);\r\n            firstChild$1.fold(function () {\r\n                append(parent, element);\r\n            }, function (v) {\r\n                parent.dom().insertBefore(element.dom(), v.dom());\r\n            });\r\n        };\r\n        var append = function (parent, element) {\r\n            parent.dom().appendChild(element.dom());\r\n        };\r\n        var appendAt = function (parent, element, index) {\r\n            child(parent, index).fold(function () {\r\n                append(parent, element);\r\n            }, function (v) {\r\n                before(v, element);\r\n            });\r\n        };\r\n        var append$1 = function (parent, elements) {\r\n            each(elements, function (x) {\r\n                append(parent, x);\r\n            });\r\n        };\r\n        var empty = function (element) {\r\n            element.dom().textContent = '';\r\n            each(children(element), function (rogue) {\r\n                remove(rogue);\r\n            });\r\n        };\r\n        var remove = function (element) {\r\n            var dom = element.dom();\r\n            if (dom.parentNode !== null) {\r\n                dom.parentNode.removeChild(dom);\r\n            }\r\n        };\r\n        var get$1 = function (element) {\r\n            return element.dom().innerHTML;\r\n        };\r\n        var set = function (element, content) {\r\n            var owner$1 = owner(element);\r\n            var docDom = owner$1.dom();\r\n            var fragment = Element.fromDom(docDom.createDocumentFragment());\r\n            var contentElements = fromHtml$1(content, docDom);\r\n            append$1(fragment, contentElements);\r\n            empty(element);\r\n            append(element, fragment);\r\n        };\r\n        var getOuter = function (element) {\r\n            var container = Element.fromTag('div');\r\n            var clone = Element.fromDom(element.dom().cloneNode(true));\r\n            append(container, clone);\r\n            return get$1(container);\r\n        };\r\n        var name = function (element) {\r\n            var r = element.dom().nodeName;\r\n            return r.toLowerCase();\r\n        };\r\n        var type = function (element) {\r\n            return element.dom().nodeType;\r\n        };\r\n        var value$1 = function (element) {\r\n            return element.dom().nodeValue;\r\n        };\r\n        var isType$1 = function (t) {\r\n            return function (element) {\r\n                return type(element) === t;\r\n            };\r\n        };\r\n        var isComment = function (element) {\r\n            return type(element) === COMMENT || name(element) === '#comment';\r\n        };\r\n        var isElement = isType$1(ELEMENT);\r\n        var isText = isType$1(TEXT);\r\n        var isDocument = isType$1(DOCUMENT);\r\n        var Node$1 = Object.freeze({\r\n            name: name,\r\n            type: type,\r\n            value: value$1,\r\n            isElement: isElement,\r\n            isText: isText,\r\n            isDocument: isDocument,\r\n            isComment: isComment\r\n        });\r\n        var rawSet = function (dom, key, value) {\r\n            if (isString(value) || isBoolean(value) || isNumber(value)) {\r\n                dom.setAttribute(key, value + '');\r\n            }\r\n            else {\r\n                domGlobals.console.error('Invalid call to Attr.set. Key ', key, ':: Value ', value, ':: Element ', dom);\r\n                throw new Error('Attribute value was not simple');\r\n            }\r\n        };\r\n        var set$1 = function (element, key, value) {\r\n            rawSet(element.dom(), key, value);\r\n        };\r\n        var setAll = function (element, attrs) {\r\n            var dom = element.dom();\r\n            each$1(attrs, function (v, k) {\r\n                rawSet(dom, k, v);\r\n            });\r\n        };\r\n        var get$2 = function (element, key) {\r\n            var v = element.dom().getAttribute(key);\r\n            return v === null ? undefined : v;\r\n        };\r\n        var has$1 = function (element, key) {\r\n            var dom = element.dom();\r\n            return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\r\n        };\r\n        var remove$1 = function (element, key) {\r\n            element.dom().removeAttribute(key);\r\n        };\r\n        var clone = function (original, isDeep) {\r\n            return Element.fromDom(original.dom().cloneNode(isDeep));\r\n        };\r\n        var shallow$1 = function (original) {\r\n            return clone(original, false);\r\n        };\r\n        var getHtml = function (element) {\r\n            var clone = shallow$1(element);\r\n            return getOuter(clone);\r\n        };\r\n        var element = function (elem) {\r\n            return getHtml(elem);\r\n        };\r\n        var unknown$3 = 'unknown';\r\n        var CHROME_INSPECTOR_GLOBAL = '__CHROME_INSPECTOR_CONNECTION_TO_ALLOY__';\r\n        var EventConfiguration;\r\n        (function (EventConfiguration) {\r\n            EventConfiguration[EventConfiguration['STOP'] = 0] = 'STOP';\r\n            EventConfiguration[EventConfiguration['NORMAL'] = 1] = 'NORMAL';\r\n            EventConfiguration[EventConfiguration['LOGGING'] = 2] = 'LOGGING';\r\n        }(EventConfiguration || (EventConfiguration = {})));\r\n        var eventConfig = Cell({});\r\n        var makeEventLogger = function (eventName, initialTarget) {\r\n            var sequence = [];\r\n            var startTime = new Date().getTime();\r\n            return {\r\n                logEventCut: function (name, target, purpose) {\r\n                    sequence.push({\r\n                        outcome: 'cut',\r\n                        target: target,\r\n                        purpose: purpose\r\n                    });\r\n                },\r\n                logEventStopped: function (name, target, purpose) {\r\n                    sequence.push({\r\n                        outcome: 'stopped',\r\n                        target: target,\r\n                        purpose: purpose\r\n                    });\r\n                },\r\n                logNoParent: function (name, target, purpose) {\r\n                    sequence.push({\r\n                        outcome: 'no-parent',\r\n                        target: target,\r\n                        purpose: purpose\r\n                    });\r\n                },\r\n                logEventNoHandlers: function (name, target) {\r\n                    sequence.push({\r\n                        outcome: 'no-handlers-left',\r\n                        target: target\r\n                    });\r\n                },\r\n                logEventResponse: function (name, target, purpose) {\r\n                    sequence.push({\r\n                        outcome: 'response',\r\n                        purpose: purpose,\r\n                        target: target\r\n                    });\r\n                },\r\n                write: function () {\r\n                    var finishTime = new Date().getTime();\r\n                    if (contains([\r\n                        'mousemove',\r\n                        'mouseover',\r\n                        'mouseout',\r\n                        systemInit()\r\n                    ], eventName)) {\r\n                        return;\r\n                    }\r\n                    domGlobals.console.log(eventName, {\r\n                        event: eventName,\r\n                        time: finishTime - startTime,\r\n                        target: initialTarget.dom(),\r\n                        sequence: map(sequence, function (s) {\r\n                            if (!contains([\r\n                                'cut',\r\n                                'stopped',\r\n                                'response'\r\n                            ], s.outcome)) {\r\n                                return s.outcome;\r\n                            }\r\n                            else {\r\n                                return '{' + s.purpose + '} ' + s.outcome + ' at (' + element(s.target) + ')';\r\n                            }\r\n                        })\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        var processEvent = function (eventName, initialTarget, f) {\r\n            var status = readOptFrom$1(eventConfig.get(), eventName).orThunk(function () {\r\n                var patterns = keys(eventConfig.get());\r\n                return findMap(patterns, function (p) {\r\n                    return eventName.indexOf(p) > -1 ? Option.some(eventConfig.get()[p]) : Option.none();\r\n                });\r\n            }).getOr(EventConfiguration.NORMAL);\r\n            switch (status) {\r\n                case EventConfiguration.NORMAL:\r\n                    return f(noLogger());\r\n                case EventConfiguration.LOGGING: {\r\n                    var logger = makeEventLogger(eventName, initialTarget);\r\n                    var output = f(logger);\r\n                    logger.write();\r\n                    return output;\r\n                }\r\n                case EventConfiguration.STOP:\r\n                    return true;\r\n            }\r\n        };\r\n        var path$1 = [\r\n            'alloy/data/Fields',\r\n            'alloy/debugging/Debugging'\r\n        ];\r\n        var getTrace = function () {\r\n            var err = new Error();\r\n            if (err.stack !== undefined) {\r\n                var lines = err.stack.split('\\n');\r\n                return find(lines, function (line) {\r\n                    return line.indexOf('alloy') > 0 && !exists(path$1, function (p) {\r\n                        return line.indexOf(p) > -1;\r\n                    });\r\n                }).getOr(unknown$3);\r\n            }\r\n            else {\r\n                return unknown$3;\r\n            }\r\n        };\r\n        var ignoreEvent = {\r\n            logEventCut: noop,\r\n            logEventStopped: noop,\r\n            logNoParent: noop,\r\n            logEventNoHandlers: noop,\r\n            logEventResponse: noop,\r\n            write: noop\r\n        };\r\n        var monitorEvent = function (eventName, initialTarget, f) {\r\n            return processEvent(eventName, initialTarget, f);\r\n        };\r\n        var inspectorInfo = function (comp) {\r\n            var go = function (c) {\r\n                var cSpec = c.spec();\r\n                return {\r\n                    '(original.spec)': cSpec,\r\n                    '(dom.ref)': c.element().dom(),\r\n                    '(element)': element(c.element()),\r\n                    '(initComponents)': map(cSpec.components !== undefined ? cSpec.components : [], go),\r\n                    '(components)': map(c.components(), go),\r\n                    '(bound.events)': mapToArray(c.events(), function (v, k) {\r\n                        return [k];\r\n                    }).join(', '),\r\n                    '(behaviours)': cSpec.behaviours !== undefined ? map$1(cSpec.behaviours, function (v, k) {\r\n                        return v === undefined ? '--revoked--' : {\r\n                            'config': v.configAsRaw(),\r\n                            'original-config': v.initialConfig,\r\n                            'state': c.readState(k)\r\n                        };\r\n                    }) : 'none'\r\n                };\r\n            };\r\n            return go(comp);\r\n        };\r\n        var getOrInitConnection = function () {\r\n            if (domGlobals.window[CHROME_INSPECTOR_GLOBAL] !== undefined) {\r\n                return domGlobals.window[CHROME_INSPECTOR_GLOBAL];\r\n            }\r\n            else {\r\n                var setEventStatus_1 = function (eventName, status) {\r\n                    var evs = eventConfig.get();\r\n                    evs[eventName] = status;\r\n                    eventConfig.set(evs);\r\n                };\r\n                domGlobals.window[CHROME_INSPECTOR_GLOBAL] = {\r\n                    systems: {},\r\n                    lookup: function (uid) {\r\n                        var systems = domGlobals.window[CHROME_INSPECTOR_GLOBAL].systems;\r\n                        var connections = keys(systems);\r\n                        return findMap(connections, function (conn) {\r\n                            var connGui = systems[conn];\r\n                            return connGui.getByUid(uid).toOption().map(function (comp) {\r\n                                return wrap$1(element(comp.element()), inspectorInfo(comp));\r\n                            });\r\n                        }).orThunk(function () {\r\n                            return Option.some({ error: 'Systems (' + connections.join(', ') + ') did not contain uid: ' + uid });\r\n                        });\r\n                    },\r\n                    events: {\r\n                        setToNormal: function (eventName) {\r\n                            setEventStatus_1(eventName, EventConfiguration.NORMAL);\r\n                        },\r\n                        setToLogging: function (eventName) {\r\n                            setEventStatus_1(eventName, EventConfiguration.LOGGING);\r\n                        },\r\n                        setToStop: function (eventName) {\r\n                            setEventStatus_1(eventName, EventConfiguration.STOP);\r\n                        }\r\n                    }\r\n                };\r\n                return domGlobals.window[CHROME_INSPECTOR_GLOBAL];\r\n            }\r\n        };\r\n        var registerInspector = function (name, gui) {\r\n            var connection = getOrInitConnection();\r\n            connection.systems[name] = gui;\r\n        };\r\n        var noLogger = constant(ignoreEvent);\r\n        var unique = 0;\r\n        var generate$1 = function (prefix) {\r\n            var date = new Date();\r\n            var time = date.getTime();\r\n            var random = Math.floor(Math.random() * 1000000000);\r\n            unique++;\r\n            return prefix + '_' + random + unique + String(time);\r\n        };\r\n        var global = tinymce.util.Tools.resolve('tinymce.ThemeManager');\r\n        var extendStatics = function (d, b) {\r\n            extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\r\n                d.__proto__ = b;\r\n            } || function (d, b) {\r\n                for (var p in b)\r\n                    if (b.hasOwnProperty(p))\r\n                        d[p] = b[p];\r\n            };\r\n            return extendStatics(d, b);\r\n        };\r\n        function __extends(d, b) {\r\n            extendStatics(d, b);\r\n            function __() {\r\n                this.constructor = d;\r\n            }\r\n            d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n        }\r\n        var __assign = function () {\r\n            __assign = Object.assign || function __assign(t) {\r\n                for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                    s = arguments[i];\r\n                    for (var p in s)\r\n                        if (Object.prototype.hasOwnProperty.call(s, p))\r\n                            t[p] = s[p];\r\n                }\r\n                return t;\r\n            };\r\n            return __assign.apply(this, arguments);\r\n        };\r\n        function __rest(s, e) {\r\n            var t = {};\r\n            for (var p in s)\r\n                if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n                    t[p] = s[p];\r\n            if (s != null && typeof Object.getOwnPropertySymbols === 'function')\r\n                for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++)\r\n                    if (e.indexOf(p[i]) < 0)\r\n                        t[p[i]] = s[p[i]];\r\n            return t;\r\n        }\r\n        function __decorate(decorators, target, key, desc) {\r\n            var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n            if (typeof Reflect === 'object' && typeof Reflect.decorate === 'function')\r\n                r = Reflect.decorate(decorators, target, key, desc);\r\n            else\r\n                for (var i = decorators.length - 1; i >= 0; i--)\r\n                    if (d = decorators[i])\r\n                        r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n            return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n        }\r\n        function __param(paramIndex, decorator) {\r\n            return function (target, key) {\r\n                decorator(target, key, paramIndex);\r\n            };\r\n        }\r\n        function __metadata(metadataKey, metadataValue) {\r\n            if (typeof Reflect === 'object' && typeof Reflect.metadata === 'function')\r\n                return Reflect.metadata(metadataKey, metadataValue);\r\n        }\r\n        function __awaiter(thisArg, _arguments, P, generator) {\r\n            return new (P || (P = Promise))(function (resolve, reject) {\r\n                function fulfilled(value) {\r\n                    try {\r\n                        step(generator.next(value));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\r\n                }\r\n                function rejected(value) {\r\n                    try {\r\n                        step(generator['throw'](value));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\r\n                }\r\n                function step(result) {\r\n                    result.done ? resolve(result.value) : new P(function (resolve) {\r\n                        resolve(result.value);\r\n                    }).then(fulfilled, rejected);\r\n                }\r\n                step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n            });\r\n        }\r\n        function __generator(thisArg, body) {\r\n            var _ = {\r\n                label: 0,\r\n                sent: function () {\r\n                    if (t[0] & 1)\r\n                        throw t[1];\r\n                    return t[1];\r\n                },\r\n                trys: [],\r\n                ops: []\r\n            }, f, y, t, g;\r\n            return g = {\r\n                next: verb(0),\r\n                'throw': verb(1),\r\n                'return': verb(2)\r\n            }, typeof Symbol === 'function' && (g[Symbol.iterator] = function () {\r\n                return this;\r\n            }), g;\r\n            function verb(n) {\r\n                return function (v) {\r\n                    return step([\r\n                        n,\r\n                        v\r\n                    ]);\r\n                };\r\n            }\r\n            function step(op) {\r\n                if (f)\r\n                    throw new TypeError('Generator is already executing.');\r\n                while (_)\r\n                    try {\r\n                        if (f = 1, y && (t = op[0] & 2 ? y['return'] : op[0] ? y['throw'] || ((t = y['return']) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done)\r\n                            return t;\r\n                        if (y = 0, t)\r\n                            op = [\r\n                                op[0] & 2,\r\n                                t.value\r\n                            ];\r\n                        switch (op[0]) {\r\n                            case 0:\r\n                            case 1:\r\n                                t = op;\r\n                                break;\r\n                            case 4:\r\n                                _.label++;\r\n                                return {\r\n                                    value: op[1],\r\n                                    done: false\r\n                                };\r\n                            case 5:\r\n                                _.label++;\r\n                                y = op[1];\r\n                                op = [0];\r\n                                continue;\r\n                            case 7:\r\n                                op = _.ops.pop();\r\n                                _.trys.pop();\r\n                                continue;\r\n                            default:\r\n                                if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\r\n                                    _ = 0;\r\n                                    continue;\r\n                                }\r\n                                if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\r\n                                    _.label = op[1];\r\n                                    break;\r\n                                }\r\n                                if (op[0] === 6 && _.label < t[1]) {\r\n                                    _.label = t[1];\r\n                                    t = op;\r\n                                    break;\r\n                                }\r\n                                if (t && _.label < t[2]) {\r\n                                    _.label = t[2];\r\n                                    _.ops.push(op);\r\n                                    break;\r\n                                }\r\n                                if (t[2])\r\n                                    _.ops.pop();\r\n                                _.trys.pop();\r\n                                continue;\r\n                        }\r\n                        op = body.call(thisArg, _);\r\n                    }\r\n                    catch (e) {\r\n                        op = [\r\n                            6,\r\n                            e\r\n                        ];\r\n                        y = 0;\r\n                    }\r\n                    finally {\r\n                        f = t = 0;\r\n                    }\r\n                if (op[0] & 5)\r\n                    throw op[1];\r\n                return {\r\n                    value: op[0] ? op[1] : void 0,\r\n                    done: true\r\n                };\r\n            }\r\n        }\r\n        function __exportStar(m, exports) {\r\n            for (var p in m)\r\n                if (!exports.hasOwnProperty(p))\r\n                    exports[p] = m[p];\r\n        }\r\n        function __values(o) {\r\n            var m = typeof Symbol === 'function' && o[Symbol.iterator], i = 0;\r\n            if (m)\r\n                return m.call(o);\r\n            return {\r\n                next: function () {\r\n                    if (o && i >= o.length)\r\n                        o = void 0;\r\n                    return {\r\n                        value: o && o[i++],\r\n                        done: !o\r\n                    };\r\n                }\r\n            };\r\n        }\r\n        function __read(o, n) {\r\n            var m = typeof Symbol === 'function' && o[Symbol.iterator];\r\n            if (!m)\r\n                return o;\r\n            var i = m.call(o), r, ar = [], e;\r\n            try {\r\n                while ((n === void 0 || n-- > 0) && !(r = i.next()).done)\r\n                    ar.push(r.value);\r\n            }\r\n            catch (error) {\r\n                e = { error: error };\r\n            }\r\n            finally {\r\n                try {\r\n                    if (r && !r.done && (m = i['return']))\r\n                        m.call(i);\r\n                }\r\n                finally {\r\n                    if (e)\r\n                        throw e.error;\r\n                }\r\n            }\r\n            return ar;\r\n        }\r\n        function __spread() {\r\n            for (var ar = [], i = 0; i < arguments.length; i++)\r\n                ar = ar.concat(__read(arguments[i]));\r\n            return ar;\r\n        }\r\n        function __await(v) {\r\n            return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n        }\r\n        function __asyncGenerator(thisArg, _arguments, generator) {\r\n            if (!Symbol.asyncIterator)\r\n                throw new TypeError('Symbol.asyncIterator is not defined.');\r\n            var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n            return i = {}, verb('next'), verb('throw'), verb('return'), i[Symbol.asyncIterator] = function () {\r\n                return this;\r\n            }, i;\r\n            function verb(n) {\r\n                if (g[n])\r\n                    i[n] = function (v) {\r\n                        return new Promise(function (a, b) {\r\n                            q.push([\r\n                                n,\r\n                                v,\r\n                                a,\r\n                                b\r\n                            ]) > 1 || resume(n, v);\r\n                        });\r\n                    };\r\n            }\r\n            function resume(n, v) {\r\n                try {\r\n                    step(g[n](v));\r\n                }\r\n                catch (e) {\r\n                    settle(q[0][3], e);\r\n                }\r\n            }\r\n            function step(r) {\r\n                r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);\r\n            }\r\n            function fulfill(value) {\r\n                resume('next', value);\r\n            }\r\n            function reject(value) {\r\n                resume('throw', value);\r\n            }\r\n            function settle(f, v) {\r\n                if (f(v), q.shift(), q.length)\r\n                    resume(q[0][0], q[0][1]);\r\n            }\r\n        }\r\n        function __asyncDelegator(o) {\r\n            var i, p;\r\n            return i = {}, verb('next'), verb('throw', function (e) {\r\n                throw e;\r\n            }), verb('return'), i[Symbol.iterator] = function () {\r\n                return this;\r\n            }, i;\r\n            function verb(n, f) {\r\n                i[n] = o[n] ? function (v) {\r\n                    return (p = !p) ? {\r\n                        value: __await(o[n](v)),\r\n                        done: n === 'return'\r\n                    } : f ? f(v) : v;\r\n                } : f;\r\n            }\r\n        }\r\n        function __asyncValues(o) {\r\n            if (!Symbol.asyncIterator)\r\n                throw new TypeError('Symbol.asyncIterator is not defined.');\r\n            var m = o[Symbol.asyncIterator], i;\r\n            return m ? m.call(o) : (o = typeof __values === 'function' ? __values(o) : o[Symbol.iterator](), i = {}, verb('next'), verb('throw'), verb('return'), i[Symbol.asyncIterator] = function () {\r\n                return this;\r\n            }, i);\r\n            function verb(n) {\r\n                i[n] = o[n] && function (v) {\r\n                    return new Promise(function (resolve, reject) {\r\n                        v = o[n](v), settle(resolve, reject, v.done, v.value);\r\n                    });\r\n                };\r\n            }\r\n            function settle(resolve, reject, d, v) {\r\n                Promise.resolve(v).then(function (v) {\r\n                    resolve({\r\n                        value: v,\r\n                        done: d\r\n                    });\r\n                }, reject);\r\n            }\r\n        }\r\n        function __makeTemplateObject(cooked, raw) {\r\n            if (Object.defineProperty) {\r\n                Object.defineProperty(cooked, 'raw', { value: raw });\r\n            }\r\n            else {\r\n                cooked.raw = raw;\r\n            }\r\n            return cooked;\r\n        }\r\n        function __importStar(mod) {\r\n            if (mod && mod.__esModule)\r\n                return mod;\r\n            var result = {};\r\n            if (mod != null)\r\n                for (var k in mod)\r\n                    if (Object.hasOwnProperty.call(mod, k))\r\n                        result[k] = mod[k];\r\n            result.default = mod;\r\n            return result;\r\n        }\r\n        function __importDefault(mod) {\r\n            return mod && mod.__esModule ? mod : { default: mod };\r\n        }\r\n        var tslib_1 = Object.freeze({\r\n            __extends: __extends,\r\n            get __assign() { return __assign; },\r\n            __rest: __rest,\r\n            __decorate: __decorate,\r\n            __param: __param,\r\n            __metadata: __metadata,\r\n            __awaiter: __awaiter,\r\n            __generator: __generator,\r\n            __exportStar: __exportStar,\r\n            __values: __values,\r\n            __read: __read,\r\n            __spread: __spread,\r\n            __await: __await,\r\n            __asyncGenerator: __asyncGenerator,\r\n            __asyncDelegator: __asyncDelegator,\r\n            __asyncValues: __asyncValues,\r\n            __makeTemplateObject: __makeTemplateObject,\r\n            __importStar: __importStar,\r\n            __importDefault: __importDefault\r\n        });\r\n        var adt = Adt.generate([\r\n            { strict: [] },\r\n            { defaultedThunk: ['fallbackThunk'] },\r\n            { asOption: [] },\r\n            { asDefaultedOptionThunk: ['fallbackThunk'] },\r\n            { mergeWithThunk: ['baseThunk'] }\r\n        ]);\r\n        var defaulted = function (fallback) {\r\n            return adt.defaultedThunk(constant(fallback));\r\n        };\r\n        var mergeWith = function (base) {\r\n            return adt.mergeWithThunk(constant(base));\r\n        };\r\n        var strict = adt.strict;\r\n        var asOption = adt.asOption;\r\n        var defaultedThunk = adt.defaultedThunk;\r\n        var mergeWithThunk = adt.mergeWithThunk;\r\n        var SimpleResultType;\r\n        (function (SimpleResultType) {\r\n            SimpleResultType[SimpleResultType['Error'] = 0] = 'Error';\r\n            SimpleResultType[SimpleResultType['Value'] = 1] = 'Value';\r\n        }(SimpleResultType || (SimpleResultType = {})));\r\n        var fold = function (res, onError, onValue) {\r\n            return res.stype === SimpleResultType.Error ? onError(res.serror) : onValue(res.svalue);\r\n        };\r\n        var partition$2 = function (results) {\r\n            var values = [];\r\n            var errors = [];\r\n            each(results, function (obj) {\r\n                fold(obj, function (err) {\r\n                    return errors.push(err);\r\n                }, function (val) {\r\n                    return values.push(val);\r\n                });\r\n            });\r\n            return {\r\n                values: values,\r\n                errors: errors\r\n            };\r\n        };\r\n        var mapError = function (res, f) {\r\n            if (res.stype === SimpleResultType.Error) {\r\n                return {\r\n                    stype: SimpleResultType.Error,\r\n                    serror: f(res.serror)\r\n                };\r\n            }\r\n            else {\r\n                return res;\r\n            }\r\n        };\r\n        var map$2 = function (res, f) {\r\n            if (res.stype === SimpleResultType.Value) {\r\n                return {\r\n                    stype: SimpleResultType.Value,\r\n                    svalue: f(res.svalue)\r\n                };\r\n            }\r\n            else {\r\n                return res;\r\n            }\r\n        };\r\n        var bind$1 = function (res, f) {\r\n            if (res.stype === SimpleResultType.Value) {\r\n                return f(res.svalue);\r\n            }\r\n            else {\r\n                return res;\r\n            }\r\n        };\r\n        var bindError = function (res, f) {\r\n            if (res.stype === SimpleResultType.Error) {\r\n                return f(res.serror);\r\n            }\r\n            else {\r\n                return res;\r\n            }\r\n        };\r\n        var svalue = function (v) {\r\n            return {\r\n                stype: SimpleResultType.Value,\r\n                svalue: v\r\n            };\r\n        };\r\n        var serror = function (e) {\r\n            return {\r\n                stype: SimpleResultType.Error,\r\n                serror: e\r\n            };\r\n        };\r\n        var toResult = function (res) {\r\n            return fold(res, Result.error, Result.value);\r\n        };\r\n        var fromResult = function (res) {\r\n            return res.fold(serror, svalue);\r\n        };\r\n        var SimpleResult = {\r\n            fromResult: fromResult,\r\n            toResult: toResult,\r\n            svalue: svalue,\r\n            partition: partition$2,\r\n            serror: serror,\r\n            bind: bind$1,\r\n            bindError: bindError,\r\n            map: map$2,\r\n            mapError: mapError,\r\n            fold: fold\r\n        };\r\n        var mergeValues$1 = function (values, base) {\r\n            return values.length > 0 ? SimpleResult.svalue(deepMerge(base, merge.apply(undefined, values))) : SimpleResult.svalue(base);\r\n        };\r\n        var mergeErrors$1 = function (errors) {\r\n            return compose(SimpleResult.serror, flatten)(errors);\r\n        };\r\n        var consolidateObj = function (objects, base) {\r\n            var partition = SimpleResult.partition(objects);\r\n            return partition.errors.length > 0 ? mergeErrors$1(partition.errors) : mergeValues$1(partition.values, base);\r\n        };\r\n        var consolidateArr = function (objects) {\r\n            var partitions = SimpleResult.partition(objects);\r\n            return partitions.errors.length > 0 ? mergeErrors$1(partitions.errors) : SimpleResult.svalue(partitions.values);\r\n        };\r\n        var ResultCombine = {\r\n            consolidateObj: consolidateObj,\r\n            consolidateArr: consolidateArr\r\n        };\r\n        var typeAdt = Adt.generate([\r\n            {\r\n                setOf: [\r\n                    'validator',\r\n                    'valueType'\r\n                ]\r\n            },\r\n            { arrOf: ['valueType'] },\r\n            { objOf: ['fields'] },\r\n            { itemOf: ['validator'] },\r\n            {\r\n                choiceOf: [\r\n                    'key',\r\n                    'branches'\r\n                ]\r\n            },\r\n            { thunk: ['description'] },\r\n            {\r\n                func: [\r\n                    'args',\r\n                    'outputSchema'\r\n                ]\r\n            }\r\n        ]);\r\n        var fieldAdt = Adt.generate([\r\n            {\r\n                field: [\r\n                    'name',\r\n                    'presence',\r\n                    'type'\r\n                ]\r\n            },\r\n            { state: ['name'] }\r\n        ]);\r\n        var json = function () {\r\n            return Global$1.getOrDie('JSON');\r\n        };\r\n        var parse = function (text) {\r\n            return json().parse(text);\r\n        };\r\n        var stringify = function (obj, replacer, space) {\r\n            return json().stringify(obj, replacer, space);\r\n        };\r\n        var Json = {\r\n            parse: parse,\r\n            stringify: stringify\r\n        };\r\n        var formatObj = function (input) {\r\n            return isObject(input) && keys(input).length > 100 ? ' removed due to size' : Json.stringify(input, null, 2);\r\n        };\r\n        var formatErrors = function (errors) {\r\n            var es = errors.length > 10 ? errors.slice(0, 10).concat([{\r\n                    path: [],\r\n                    getErrorInfo: function () {\r\n                        return '... (only showing first ten failures)';\r\n                    }\r\n                }]) : errors;\r\n            return map(es, function (e) {\r\n                return 'Failed path: (' + e.path.join(' > ') + ')\\n' + e.getErrorInfo();\r\n            });\r\n        };\r\n        var nu$3 = function (path, getErrorInfo) {\r\n            return SimpleResult.serror([{\r\n                    path: path,\r\n                    getErrorInfo: getErrorInfo\r\n                }]);\r\n        };\r\n        var missingStrict = function (path, key, obj) {\r\n            return nu$3(path, function () {\r\n                return 'Could not find valid *strict* value for \"' + key + '\" in ' + formatObj(obj);\r\n            });\r\n        };\r\n        var missingKey = function (path, key) {\r\n            return nu$3(path, function () {\r\n                return 'Choice schema did not contain choice key: \"' + key + '\"';\r\n            });\r\n        };\r\n        var missingBranch = function (path, branches, branch) {\r\n            return nu$3(path, function () {\r\n                return 'The chosen schema: \"' + branch + '\" did not exist in branches: ' + formatObj(branches);\r\n            });\r\n        };\r\n        var unsupportedFields = function (path, unsupported) {\r\n            return nu$3(path, function () {\r\n                return 'There are unsupported fields: [' + unsupported.join(', ') + '] specified';\r\n            });\r\n        };\r\n        var custom = function (path, err) {\r\n            return nu$3(path, function () {\r\n                return err;\r\n            });\r\n        };\r\n        var adt$1 = Adt.generate([\r\n            {\r\n                field: [\r\n                    'key',\r\n                    'okey',\r\n                    'presence',\r\n                    'prop'\r\n                ]\r\n            },\r\n            {\r\n                state: [\r\n                    'okey',\r\n                    'instantiator'\r\n                ]\r\n            }\r\n        ]);\r\n        var strictAccess = function (path, obj, key) {\r\n            return readOptFrom(obj, key).fold(function () {\r\n                return missingStrict(path, key, obj);\r\n            }, SimpleResult.svalue);\r\n        };\r\n        var fallbackAccess = function (obj, key, fallbackThunk) {\r\n            var v = readOptFrom(obj, key).fold(function () {\r\n                return fallbackThunk(obj);\r\n            }, identity);\r\n            return SimpleResult.svalue(v);\r\n        };\r\n        var optionAccess = function (obj, key) {\r\n            return SimpleResult.svalue(readOptFrom(obj, key));\r\n        };\r\n        var optionDefaultedAccess = function (obj, key, fallback) {\r\n            var opt = readOptFrom(obj, key).map(function (val) {\r\n                return val === true ? fallback(obj) : val;\r\n            });\r\n            return SimpleResult.svalue(opt);\r\n        };\r\n        var cExtractOne = function (path, obj, field, strength) {\r\n            return field.fold(function (key, okey, presence, prop) {\r\n                var bundle = function (av) {\r\n                    var result = prop.extract(path.concat([key]), strength, av);\r\n                    return SimpleResult.map(result, function (res) {\r\n                        return wrap(okey, strength(res));\r\n                    });\r\n                };\r\n                var bundleAsOption = function (optValue) {\r\n                    return optValue.fold(function () {\r\n                        var outcome = wrap(okey, strength(Option.none()));\r\n                        return SimpleResult.svalue(outcome);\r\n                    }, function (ov) {\r\n                        var result = prop.extract(path.concat([key]), strength, ov);\r\n                        return SimpleResult.map(result, function (res) {\r\n                            return wrap(okey, strength(Option.some(res)));\r\n                        });\r\n                    });\r\n                };\r\n                return function () {\r\n                    return presence.fold(function () {\r\n                        return SimpleResult.bind(strictAccess(path, obj, key), bundle);\r\n                    }, function (fallbackThunk) {\r\n                        return SimpleResult.bind(fallbackAccess(obj, key, fallbackThunk), bundle);\r\n                    }, function () {\r\n                        return SimpleResult.bind(optionAccess(obj, key), bundleAsOption);\r\n                    }, function (fallbackThunk) {\r\n                        return SimpleResult.bind(optionDefaultedAccess(obj, key, fallbackThunk), bundleAsOption);\r\n                    }, function (baseThunk) {\r\n                        var base = baseThunk(obj);\r\n                        var result = SimpleResult.map(fallbackAccess(obj, key, constant({})), function (v) {\r\n                            return deepMerge(base, v);\r\n                        });\r\n                        return SimpleResult.bind(result, bundle);\r\n                    });\r\n                }();\r\n            }, function (okey, instantiator) {\r\n                var state = instantiator(obj);\r\n                return SimpleResult.svalue(wrap(okey, strength(state)));\r\n            });\r\n        };\r\n        var cExtract = function (path, obj, fields, strength) {\r\n            var results = map(fields, function (field) {\r\n                return cExtractOne(path, obj, field, strength);\r\n            });\r\n            return ResultCombine.consolidateObj(results, {});\r\n        };\r\n        var value$2 = function (validator) {\r\n            var extract = function (path, strength, val) {\r\n                return SimpleResult.bindError(validator(val, strength), function (err) {\r\n                    return custom(path, err);\r\n                });\r\n            };\r\n            var toString = function () {\r\n                return 'val';\r\n            };\r\n            var toDsl = function () {\r\n                return typeAdt.itemOf(validator);\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: toString,\r\n                toDsl: toDsl\r\n            };\r\n        };\r\n        var getSetKeys = function (obj) {\r\n            var keys$1 = keys(obj);\r\n            return filter(keys$1, function (k) {\r\n                return hasKey$1(obj, k);\r\n            });\r\n        };\r\n        var objOfOnly = function (fields) {\r\n            var delegate = objOf(fields);\r\n            var fieldNames = foldr(fields, function (acc, f) {\r\n                return f.fold(function (key) {\r\n                    return deepMerge(acc, wrap$1(key, true));\r\n                }, constant(acc));\r\n            }, {});\r\n            var extract = function (path, strength, o) {\r\n                var keys = isBoolean(o) ? [] : getSetKeys(o);\r\n                var extra = filter(keys, function (k) {\r\n                    return !hasKey$1(fieldNames, k);\r\n                });\r\n                return extra.length === 0 ? delegate.extract(path, strength, o) : unsupportedFields(path, extra);\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: delegate.toString,\r\n                toDsl: delegate.toDsl\r\n            };\r\n        };\r\n        var objOf = function (fields) {\r\n            var extract = function (path, strength, o) {\r\n                return cExtract(path, o, fields, strength);\r\n            };\r\n            var toString = function () {\r\n                var fieldStrings = map(fields, function (field) {\r\n                    return field.fold(function (key, okey, presence, prop) {\r\n                        return key + ' -> ' + prop.toString();\r\n                    }, function (okey, instantiator) {\r\n                        return 'state(' + okey + ')';\r\n                    });\r\n                });\r\n                return 'obj{\\n' + fieldStrings.join('\\n') + '}';\r\n            };\r\n            var toDsl = function () {\r\n                return typeAdt.objOf(map(fields, function (f) {\r\n                    return f.fold(function (key, okey, presence, prop) {\r\n                        return fieldAdt.field(key, presence, prop);\r\n                    }, function (okey, instantiator) {\r\n                        return fieldAdt.state(okey);\r\n                    });\r\n                }));\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: toString,\r\n                toDsl: toDsl\r\n            };\r\n        };\r\n        var arrOf = function (prop) {\r\n            var extract = function (path, strength, array) {\r\n                var results = map(array, function (a, i) {\r\n                    return prop.extract(path.concat(['[' + i + ']']), strength, a);\r\n                });\r\n                return ResultCombine.consolidateArr(results);\r\n            };\r\n            var toString = function () {\r\n                return 'array(' + prop.toString() + ')';\r\n            };\r\n            var toDsl = function () {\r\n                return typeAdt.arrOf(prop);\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: toString,\r\n                toDsl: toDsl\r\n            };\r\n        };\r\n        var setOf = function (validator, prop) {\r\n            var validateKeys = function (path, keys) {\r\n                return arrOf(value$2(validator)).extract(path, identity, keys);\r\n            };\r\n            var extract = function (path, strength, o) {\r\n                var keys$1 = keys(o);\r\n                var validatedKeys = validateKeys(path, keys$1);\r\n                return SimpleResult.bind(validatedKeys, function (validKeys) {\r\n                    var schema = map(validKeys, function (vk) {\r\n                        return adt$1.field(vk, vk, strict(), prop);\r\n                    });\r\n                    return objOf(schema).extract(path, strength, o);\r\n                });\r\n            };\r\n            var toString = function () {\r\n                return 'setOf(' + prop.toString() + ')';\r\n            };\r\n            var toDsl = function () {\r\n                return typeAdt.setOf(validator, prop);\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: toString,\r\n                toDsl: toDsl\r\n            };\r\n        };\r\n        var func = function (args, schema, retriever) {\r\n            var delegate = value$2(function (f, strength) {\r\n                return isFunction(f) ? SimpleResult.svalue(function () {\r\n                    var gArgs = Array.prototype.slice.call(arguments, 0);\r\n                    var allowedArgs = gArgs.slice(0, args.length);\r\n                    var o = f.apply(null, allowedArgs);\r\n                    return retriever(o, strength);\r\n                }) : SimpleResult.serror('Not a function');\r\n            });\r\n            return {\r\n                extract: delegate.extract,\r\n                toString: function () {\r\n                    return 'function';\r\n                },\r\n                toDsl: function () {\r\n                    return typeAdt.func(args, schema);\r\n                }\r\n            };\r\n        };\r\n        var thunk = function (desc, processor) {\r\n            var getP = cached(function () {\r\n                return processor();\r\n            });\r\n            var extract = function (path, strength, val) {\r\n                return getP().extract(path, strength, val);\r\n            };\r\n            var toString = function () {\r\n                return getP().toString();\r\n            };\r\n            var toDsl = function () {\r\n                return typeAdt.thunk(desc);\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: toString,\r\n                toDsl: toDsl\r\n            };\r\n        };\r\n        var anyValue = constant(value$2(SimpleResult.svalue));\r\n        var arrOfObj = compose(arrOf, objOf);\r\n        var state = adt$1.state;\r\n        var field = adt$1.field;\r\n        var chooseFrom = function (path, strength, input, branches, ch) {\r\n            var fields = readOptFrom$1(branches, ch);\r\n            return fields.fold(function () {\r\n                return missingBranch(path, branches, ch);\r\n            }, function (fs) {\r\n                return objOf(fs).extract(path.concat(['branch: ' + ch]), strength, input);\r\n            });\r\n        };\r\n        var choose = function (key, branches) {\r\n            var extract = function (path, strength, input) {\r\n                var choice = readOptFrom$1(input, key);\r\n                return choice.fold(function () {\r\n                    return missingKey(path, key);\r\n                }, function (chosen) {\r\n                    return chooseFrom(path, strength, input, branches, chosen);\r\n                });\r\n            };\r\n            var toString = function () {\r\n                return 'chooseOn(' + key + '). Possible values: ' + keys(branches);\r\n            };\r\n            var toDsl = function () {\r\n                return typeAdt.choiceOf(key, branches);\r\n            };\r\n            return {\r\n                extract: extract,\r\n                toString: toString,\r\n                toDsl: toDsl\r\n            };\r\n        };\r\n        var _anyValue = value$2(SimpleResult.svalue);\r\n        var arrOfObj$1 = function (objFields) {\r\n            return arrOfObj(objFields);\r\n        };\r\n        var arrOfVal = function () {\r\n            return arrOf(_anyValue);\r\n        };\r\n        var valueOf = function (validator) {\r\n            return value$2(function (v) {\r\n                return validator(v).fold(SimpleResult.serror, SimpleResult.svalue);\r\n            });\r\n        };\r\n        var setOf$1 = function (validator, prop) {\r\n            return setOf(function (v) {\r\n                return SimpleResult.fromResult(validator(v));\r\n            }, prop);\r\n        };\r\n        var extract = function (label, prop, strength, obj) {\r\n            var res = prop.extract([label], strength, obj);\r\n            return SimpleResult.mapError(res, function (errs) {\r\n                return {\r\n                    input: obj,\r\n                    errors: errs\r\n                };\r\n            });\r\n        };\r\n        var asStruct = function (label, prop, obj) {\r\n            return SimpleResult.toResult(extract(label, prop, constant, obj));\r\n        };\r\n        var asRaw = function (label, prop, obj) {\r\n            return SimpleResult.toResult(extract(label, prop, identity, obj));\r\n        };\r\n        var getOrDie$1 = function (extraction) {\r\n            return extraction.fold(function (errInfo) {\r\n                throw new Error(formatError(errInfo));\r\n            }, identity);\r\n        };\r\n        var asRawOrDie = function (label, prop, obj) {\r\n            return getOrDie$1(asRaw(label, prop, obj));\r\n        };\r\n        var asStructOrDie = function (label, prop, obj) {\r\n            return getOrDie$1(asStruct(label, prop, obj));\r\n        };\r\n        var formatError = function (errInfo) {\r\n            return 'Errors: \\n' + formatErrors(errInfo.errors) + '\\n\\nInput object: ' + formatObj(errInfo.input);\r\n        };\r\n        var choose$1 = function (key, branches) {\r\n            return choose(key, branches);\r\n        };\r\n        var thunkOf = function (desc, schema) {\r\n            return thunk(desc, schema);\r\n        };\r\n        var funcOrDie = function (args, prop) {\r\n            var retriever = function (output, strength) {\r\n                return getOrDie$1(SimpleResult.toResult(extract('()', prop, strength, output)));\r\n            };\r\n            return func(args, prop, retriever);\r\n        };\r\n        var anyValue$1 = constant(_anyValue);\r\n        var typedValue = function (validator, expectedType) {\r\n            return value$2(function (a) {\r\n                var actualType = typeof a;\r\n                return validator(a) ? SimpleResult.svalue(a) : SimpleResult.serror('Expected type: ' + expectedType + ' but got: ' + actualType);\r\n            });\r\n        };\r\n        var number = typedValue(isNumber, 'number');\r\n        var string = typedValue(isString, 'string');\r\n        var boolean = typedValue(isBoolean, 'boolean');\r\n        var functionProcessor = typedValue(isFunction, 'function');\r\n        var ValueSchema = Object.freeze({\r\n            anyValue: anyValue$1,\r\n            arrOfObj: arrOfObj$1,\r\n            arrOf: arrOf,\r\n            arrOfVal: arrOfVal,\r\n            valueOf: valueOf,\r\n            setOf: setOf$1,\r\n            objOf: objOf,\r\n            objOfOnly: objOfOnly,\r\n            asStruct: asStruct,\r\n            asRaw: asRaw,\r\n            asStructOrDie: asStructOrDie,\r\n            asRawOrDie: asRawOrDie,\r\n            getOrDie: getOrDie$1,\r\n            formatError: formatError,\r\n            choose: choose$1,\r\n            thunkOf: thunkOf,\r\n            funcOrDie: funcOrDie,\r\n            number: number,\r\n            string: string,\r\n            boolean: boolean,\r\n            func: functionProcessor\r\n        });\r\n        var validateEnum = function (values) {\r\n            return valueOf(function (value) {\r\n                return contains(values, value) ? Result.value(value) : Result.error('Unsupported value: \"' + value + '\", choose one of \"' + values.join(', ') + '\".');\r\n            });\r\n        };\r\n        var strict$1 = function (key) {\r\n            return field(key, key, strict(), anyValue());\r\n        };\r\n        var strictOf = function (key, schema) {\r\n            return field(key, key, strict(), schema);\r\n        };\r\n        var strictNumber = function (key) {\r\n            return strictOf(key, number);\r\n        };\r\n        var strictString = function (key) {\r\n            return strictOf(key, string);\r\n        };\r\n        var strictStringEnum = function (key, values) {\r\n            return field(key, key, strict(), validateEnum(values));\r\n        };\r\n        var strictBoolean = function (key) {\r\n            return strictOf(key, boolean);\r\n        };\r\n        var strictFunction = function (key) {\r\n            return strictOf(key, functionProcessor);\r\n        };\r\n        var forbid = function (key, message) {\r\n            return field(key, key, asOption(), value$2(function (v) {\r\n                return SimpleResult.serror('The field: ' + key + ' is forbidden. ' + message);\r\n            }));\r\n        };\r\n        var strictObjOf = function (key, objSchema) {\r\n            return field(key, key, strict(), objOf(objSchema));\r\n        };\r\n        var strictArrayOfObj = function (key, objFields) {\r\n            return field(key, key, strict(), arrOfObj(objFields));\r\n        };\r\n        var strictArrayOf = function (key, schema) {\r\n            return field(key, key, strict(), arrOf(schema));\r\n        };\r\n        var option = function (key) {\r\n            return field(key, key, asOption(), anyValue());\r\n        };\r\n        var optionOf = function (key, schema) {\r\n            return field(key, key, asOption(), schema);\r\n        };\r\n        var optionNumber = function (key) {\r\n            return optionOf(key, number);\r\n        };\r\n        var optionString = function (key) {\r\n            return optionOf(key, string);\r\n        };\r\n        var optionFunction = function (key) {\r\n            return optionOf(key, functionProcessor);\r\n        };\r\n        var optionArrayOf = function (key, schema) {\r\n            return optionOf(key, arrOf(schema));\r\n        };\r\n        var optionObjOf = function (key, objSchema) {\r\n            return optionOf(key, objOf(objSchema));\r\n        };\r\n        var optionObjOfOnly = function (key, objSchema) {\r\n            return optionOf(key, objOfOnly(objSchema));\r\n        };\r\n        var defaulted$1 = function (key, fallback) {\r\n            return field(key, key, defaulted(fallback), anyValue());\r\n        };\r\n        var defaultedOf = function (key, fallback, schema) {\r\n            return field(key, key, defaulted(fallback), schema);\r\n        };\r\n        var defaultedNumber = function (key, fallback) {\r\n            return defaultedOf(key, fallback, number);\r\n        };\r\n        var defaultedString = function (key, fallback) {\r\n            return defaultedOf(key, fallback, string);\r\n        };\r\n        var defaultedStringEnum = function (key, fallback, values) {\r\n            return defaultedOf(key, fallback, validateEnum(values));\r\n        };\r\n        var defaultedBoolean = function (key, fallback) {\r\n            return defaultedOf(key, fallback, boolean);\r\n        };\r\n        var defaultedFunction = function (key, fallback) {\r\n            return defaultedOf(key, fallback, functionProcessor);\r\n        };\r\n        var defaultedObjOf = function (key, fallback, objSchema) {\r\n            return defaultedOf(key, fallback, objOf(objSchema));\r\n        };\r\n        var state$1 = function (okey, instantiator) {\r\n            return state(okey, instantiator);\r\n        };\r\n        var isSource = function (component, simulatedEvent) {\r\n            return eq(component.element(), simulatedEvent.event().target());\r\n        };\r\n        var nu$4 = function (parts) {\r\n            if (!hasKey$1(parts, 'can') && !hasKey$1(parts, 'abort') && !hasKey$1(parts, 'run')) {\r\n                throw new Error('EventHandler defined by: ' + Json.stringify(parts, null, 2) + ' does not have can, abort, or run!');\r\n            }\r\n            return asRawOrDie('Extracting event.handler', objOfOnly([\r\n                defaulted$1('can', constant(true)),\r\n                defaulted$1('abort', constant(false)),\r\n                defaulted$1('run', noop)\r\n            ]), parts);\r\n        };\r\n        var all$1 = function (handlers, f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return foldl(handlers, function (acc, handler) {\r\n                    return acc && f(handler).apply(undefined, args);\r\n                }, true);\r\n            };\r\n        };\r\n        var any = function (handlers, f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return foldl(handlers, function (acc, handler) {\r\n                    return acc || f(handler).apply(undefined, args);\r\n                }, false);\r\n            };\r\n        };\r\n        var read = function (handler) {\r\n            return isFunction(handler) ? {\r\n                can: constant(true),\r\n                abort: constant(false),\r\n                run: handler\r\n            } : handler;\r\n        };\r\n        var fuse = function (handlers) {\r\n            var can = all$1(handlers, function (handler) {\r\n                return handler.can;\r\n            });\r\n            var abort = any(handlers, function (handler) {\r\n                return handler.abort;\r\n            });\r\n            var run = function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                each(handlers, function (handler) {\r\n                    handler.run.apply(undefined, args);\r\n                });\r\n            };\r\n            return nu$4({\r\n                can: can,\r\n                abort: abort,\r\n                run: run\r\n            });\r\n        };\r\n        var emit = function (component, event) {\r\n            dispatchWith(component, component.element(), event, {});\r\n        };\r\n        var emitWith = function (component, event, properties) {\r\n            dispatchWith(component, component.element(), event, properties);\r\n        };\r\n        var emitExecute = function (component) {\r\n            emit(component, execute());\r\n        };\r\n        var dispatch = function (component, target, event) {\r\n            dispatchWith(component, target, event, {});\r\n        };\r\n        var dispatchWith = function (component, target, event, properties) {\r\n            var data = __assign({ target: target }, properties);\r\n            component.getSystem().triggerEvent(event, target, map$1(data, constant));\r\n        };\r\n        var dispatchEvent = function (component, target, event, simulatedEvent) {\r\n            component.getSystem().triggerEvent(event, target, simulatedEvent.event());\r\n        };\r\n        function ClosestOrAncestor(is, ancestor, scope, a, isRoot) {\r\n            return is(scope, a) ? Option.some(scope) : isFunction(isRoot) && isRoot(scope) ? Option.none() : ancestor(scope, a, isRoot);\r\n        }\r\n        var inBody = function (element) {\r\n            var dom = isText(element) ? element.dom().parentNode : element.dom();\r\n            return dom !== undefined && dom !== null && dom.ownerDocument.body.contains(dom);\r\n        };\r\n        var body = cached(function () {\r\n            return getBody(Element.fromDom(domGlobals.document));\r\n        });\r\n        var getBody = function (doc) {\r\n            var b = doc.dom().body;\r\n            if (b === null || b === undefined) {\r\n                throw new Error('Body is not available yet');\r\n            }\r\n            return Element.fromDom(b);\r\n        };\r\n        var first = function (predicate) {\r\n            return descendant(body(), predicate);\r\n        };\r\n        var ancestor = function (scope, predicate, isRoot) {\r\n            var element = scope.dom();\r\n            var stop = isFunction(isRoot) ? isRoot : constant(false);\r\n            while (element.parentNode) {\r\n                element = element.parentNode;\r\n                var el = Element.fromDom(element);\r\n                if (predicate(el)) {\r\n                    return Option.some(el);\r\n                }\r\n                else if (stop(el)) {\r\n                    break;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var closest = function (scope, predicate, isRoot) {\r\n            var is = function (s) {\r\n                return predicate(s);\r\n            };\r\n            return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\r\n        };\r\n        var sibling = function (scope, predicate) {\r\n            var element = scope.dom();\r\n            if (!element.parentNode) {\r\n                return Option.none();\r\n            }\r\n            return child$1(Element.fromDom(element.parentNode), function (x) {\r\n                return !eq(scope, x) && predicate(x);\r\n            });\r\n        };\r\n        var child$1 = function (scope, predicate) {\r\n            var result = find(scope.dom().childNodes, compose(predicate, Element.fromDom));\r\n            return result.map(Element.fromDom);\r\n        };\r\n        var descendant = function (scope, predicate) {\r\n            var descend = function (node) {\r\n                for (var i = 0; i < node.childNodes.length; i++) {\r\n                    if (predicate(Element.fromDom(node.childNodes[i]))) {\r\n                        return Option.some(Element.fromDom(node.childNodes[i]));\r\n                    }\r\n                    var res = descend(node.childNodes[i]);\r\n                    if (res.isSome()) {\r\n                        return res;\r\n                    }\r\n                }\r\n                return Option.none();\r\n            };\r\n            return descend(scope.dom());\r\n        };\r\n        var closest$1 = function (target, transform, isRoot) {\r\n            var delegate = closest(target, function (elem) {\r\n                return transform(elem).isSome();\r\n            }, isRoot);\r\n            return delegate.bind(transform);\r\n        };\r\n        var derive = function (configs) {\r\n            return wrapAll$1(configs);\r\n        };\r\n        var abort = function (name, predicate) {\r\n            return {\r\n                key: name,\r\n                value: nu$4({ abort: predicate })\r\n            };\r\n        };\r\n        var can = function (name, predicate) {\r\n            return {\r\n                key: name,\r\n                value: nu$4({ can: predicate })\r\n            };\r\n        };\r\n        var preventDefault = function (name) {\r\n            return {\r\n                key: name,\r\n                value: nu$4({\r\n                    run: function (component, simulatedEvent) {\r\n                        simulatedEvent.event().prevent();\r\n                    }\r\n                })\r\n            };\r\n        };\r\n        var run = function (name, handler) {\r\n            return {\r\n                key: name,\r\n                value: nu$4({ run: handler })\r\n            };\r\n        };\r\n        var runActionExtra = function (name, action, extra) {\r\n            return {\r\n                key: name,\r\n                value: nu$4({\r\n                    run: function (component) {\r\n                        action.apply(undefined, [component].concat(extra));\r\n                    }\r\n                })\r\n            };\r\n        };\r\n        var runOnName = function (name) {\r\n            return function (handler) {\r\n                return run(name, handler);\r\n            };\r\n        };\r\n        var runOnSourceName = function (name) {\r\n            return function (handler) {\r\n                return {\r\n                    key: name,\r\n                    value: nu$4({\r\n                        run: function (component, simulatedEvent) {\r\n                            if (isSource(component, simulatedEvent)) {\r\n                                handler(component, simulatedEvent);\r\n                            }\r\n                        }\r\n                    })\r\n                };\r\n            };\r\n        };\r\n        var redirectToUid = function (name, uid) {\r\n            return run(name, function (component, simulatedEvent) {\r\n                component.getSystem().getByUid(uid).each(function (redirectee) {\r\n                    dispatchEvent(redirectee, redirectee.element(), name, simulatedEvent);\r\n                });\r\n            });\r\n        };\r\n        var redirectToPart = function (name, detail, partName) {\r\n            var uid = detail.partUids[partName];\r\n            return redirectToUid(name, uid);\r\n        };\r\n        var runWithTarget = function (name, f) {\r\n            return run(name, function (component, simulatedEvent) {\r\n                var ev = simulatedEvent.event();\r\n                var target = component.getSystem().getByDom(ev.target()).fold(function () {\r\n                    var closest = closest$1(ev.target(), function (el) {\r\n                        return component.getSystem().getByDom(el).toOption();\r\n                    }, constant(false));\r\n                    return closest.getOr(component);\r\n                }, function (c) {\r\n                    return c;\r\n                });\r\n                f(component, target, simulatedEvent);\r\n            });\r\n        };\r\n        var cutter = function (name) {\r\n            return run(name, function (component, simulatedEvent) {\r\n                simulatedEvent.cut();\r\n            });\r\n        };\r\n        var stopper = function (name) {\r\n            return run(name, function (component, simulatedEvent) {\r\n                simulatedEvent.stop();\r\n            });\r\n        };\r\n        var runOnSource = function (name, f) {\r\n            return runOnSourceName(name)(f);\r\n        };\r\n        var runOnAttached = runOnSourceName(attachedToDom());\r\n        var runOnDetached = runOnSourceName(detachedFromDom());\r\n        var runOnInit = runOnSourceName(systemInit());\r\n        var runOnExecute = runOnName(execute());\r\n        var AlloyEvents = Object.freeze({\r\n            derive: derive,\r\n            run: run,\r\n            preventDefault: preventDefault,\r\n            runActionExtra: runActionExtra,\r\n            runOnAttached: runOnAttached,\r\n            runOnDetached: runOnDetached,\r\n            runOnSource: runOnSource,\r\n            runOnInit: runOnInit,\r\n            runOnExecute: runOnExecute,\r\n            redirectToUid: redirectToUid,\r\n            redirectToPart: redirectToPart,\r\n            runWithTarget: runWithTarget,\r\n            abort: abort,\r\n            can: can,\r\n            cutter: cutter,\r\n            stopper: stopper\r\n        });\r\n        var isRecursive = function (component, originator, target) {\r\n            return eq(originator, component.element()) && !eq(originator, target);\r\n        };\r\n        var events = derive([can(focus(), function (component, simulatedEvent) {\r\n                var originator = simulatedEvent.event().originator();\r\n                var target = simulatedEvent.event().target();\r\n                if (isRecursive(component, originator, target)) {\r\n                    domGlobals.console.warn(focus() + ' did not get interpreted by the desired target. ' + '\\nOriginator: ' + element(originator) + '\\nTarget: ' + element(target) + '\\nCheck the ' + focus() + ' event handlers');\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            })]);\r\n        var DefaultEvents = Object.freeze({\r\n            events: events\r\n        });\r\n        var prefix = constant('alloy-id-');\r\n        var idAttr = constant('data-alloy-id');\r\n        var prefix$1 = prefix();\r\n        var idAttr$1 = idAttr();\r\n        var write = function (label, elem) {\r\n            var id = generate$1(prefix$1 + label);\r\n            writeOnly(elem, id);\r\n            return id;\r\n        };\r\n        var writeOnly = function (elem, uid) {\r\n            Object.defineProperty(elem.dom(), idAttr$1, {\r\n                value: uid,\r\n                writable: true\r\n            });\r\n        };\r\n        var read$1 = function (elem) {\r\n            var id = isElement(elem) ? elem.dom()[idAttr$1] : null;\r\n            return Option.from(id);\r\n        };\r\n        var generate$2 = function (prefix) {\r\n            return generate$1(prefix);\r\n        };\r\n        var make = identity;\r\n        var NoContextApi = function (getComp) {\r\n            var fail = function (event) {\r\n                return function () {\r\n                    throw new Error('The component must be in a context to send: ' + event + '\\n' + element(getComp().element()) + ' is not in context.');\r\n                };\r\n            };\r\n            return {\r\n                debugInfo: constant('fake'),\r\n                triggerEvent: fail('triggerEvent'),\r\n                triggerFocus: fail('triggerFocus'),\r\n                triggerEscape: fail('triggerEscape'),\r\n                build: fail('build'),\r\n                addToWorld: fail('addToWorld'),\r\n                removeFromWorld: fail('removeFromWorld'),\r\n                addToGui: fail('addToGui'),\r\n                removeFromGui: fail('removeFromGui'),\r\n                getByUid: fail('getByUid'),\r\n                getByDom: fail('getByDom'),\r\n                broadcast: fail('broadcast'),\r\n                broadcastOn: fail('broadcastOn'),\r\n                broadcastEvent: fail('broadcastEvent'),\r\n                isConnected: constant(false)\r\n            };\r\n        };\r\n        var singleton = NoContextApi();\r\n        var markAsBehaviourApi = function (f, apiName, apiFunction) {\r\n            var delegate = apiFunction.toString();\r\n            var endIndex = delegate.indexOf(')') + 1;\r\n            var openBracketIndex = delegate.indexOf('(');\r\n            var parameters = delegate.substring(openBracketIndex + 1, endIndex - 1).split(/,\\s*/);\r\n            f.toFunctionAnnotation = function () {\r\n                return {\r\n                    name: apiName,\r\n                    parameters: cleanParameters(parameters.slice(0, 1).concat(parameters.slice(3)))\r\n                };\r\n            };\r\n            return f;\r\n        };\r\n        var cleanParameters = function (parameters) {\r\n            return map(parameters, function (p) {\r\n                return endsWith(p, '/*') ? p.substring(0, p.length - '/*'.length) : p;\r\n            });\r\n        };\r\n        var markAsExtraApi = function (f, extraName) {\r\n            var delegate = f.toString();\r\n            var endIndex = delegate.indexOf(')') + 1;\r\n            var openBracketIndex = delegate.indexOf('(');\r\n            var parameters = delegate.substring(openBracketIndex + 1, endIndex - 1).split(/,\\s*/);\r\n            f.toFunctionAnnotation = function () {\r\n                return {\r\n                    name: extraName,\r\n                    parameters: cleanParameters(parameters)\r\n                };\r\n            };\r\n            return f;\r\n        };\r\n        var markAsSketchApi = function (f, apiFunction) {\r\n            var delegate = apiFunction.toString();\r\n            var endIndex = delegate.indexOf(')') + 1;\r\n            var openBracketIndex = delegate.indexOf('(');\r\n            var parameters = delegate.substring(openBracketIndex + 1, endIndex - 1).split(/,\\s*/);\r\n            f.toFunctionAnnotation = function () {\r\n                return {\r\n                    name: 'OVERRIDE',\r\n                    parameters: cleanParameters(parameters.slice(1))\r\n                };\r\n            };\r\n            return f;\r\n        };\r\n        var premadeTag = generate$1('alloy-premade');\r\n        var premade = function (comp) {\r\n            return wrap$1(premadeTag, comp);\r\n        };\r\n        var getPremade = function (spec) {\r\n            return readOptFrom$1(spec, premadeTag);\r\n        };\r\n        var makeApi = function (f) {\r\n            return markAsSketchApi(function (component) {\r\n                var rest = [];\r\n                for (var _i = 1; _i < arguments.length; _i++) {\r\n                    rest[_i - 1] = arguments[_i];\r\n                }\r\n                return f.apply(undefined, [component.getApis()].concat([component].concat(rest)));\r\n            }, f);\r\n        };\r\n        var GuiTypes = Object.freeze({\r\n            makeApi: makeApi,\r\n            premade: premade,\r\n            getPremade: getPremade\r\n        });\r\n        var NoState = {\r\n            init: function () {\r\n                return nu$5({\r\n                    readState: function () {\r\n                        return 'No State required';\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        var nu$5 = function (spec) {\r\n            return spec;\r\n        };\r\n        var generateFrom = function (spec, all) {\r\n            var schema = map(all, function (a) {\r\n                return optionObjOf(a.name(), [\r\n                    strict$1('config'),\r\n                    defaulted$1('state', NoState)\r\n                ]);\r\n            });\r\n            var validated = asRaw('component.behaviours', objOf(schema), spec.behaviours).fold(function (errInfo) {\r\n                throw new Error(formatError(errInfo) + '\\nComplete spec:\\n' + Json.stringify(spec, null, 2));\r\n            }, function (v) {\r\n                return v;\r\n            });\r\n            return {\r\n                list: all,\r\n                data: map$1(validated, function (optBlobThunk) {\r\n                    var optBlob = optBlobThunk;\r\n                    var output = optBlob.map(function (blob) {\r\n                        return {\r\n                            config: blob.config,\r\n                            state: blob.state.init(blob.config)\r\n                        };\r\n                    });\r\n                    return function () {\r\n                        return output;\r\n                    };\r\n                })\r\n            };\r\n        };\r\n        var getBehaviours = function (bData) {\r\n            return bData.list;\r\n        };\r\n        var getData = function (bData) {\r\n            return bData.data;\r\n        };\r\n        var byInnerKey = function (data, tuple) {\r\n            var r = {};\r\n            each$1(data, function (detail, key) {\r\n                each$1(detail, function (value, indexKey) {\r\n                    var chain = readOr$1(indexKey, [])(r);\r\n                    r[indexKey] = chain.concat([tuple(key, value)]);\r\n                });\r\n            });\r\n            return r;\r\n        };\r\n        var nu$6 = function (s) {\r\n            return {\r\n                classes: s.classes !== undefined ? s.classes : [],\r\n                attributes: s.attributes !== undefined ? s.attributes : {},\r\n                styles: s.styles !== undefined ? s.styles : {}\r\n            };\r\n        };\r\n        var merge$1 = function (defnA, mod) {\r\n            return __assign({}, defnA, {\r\n                attributes: __assign({}, defnA.attributes, mod.attributes),\r\n                styles: __assign({}, defnA.styles, mod.styles),\r\n                classes: defnA.classes.concat(mod.classes)\r\n            });\r\n        };\r\n        var combine = function (info, baseMod, behaviours, base) {\r\n            var modsByBehaviour = __assign({}, baseMod);\r\n            each(behaviours, function (behaviour) {\r\n                modsByBehaviour[behaviour.name()] = behaviour.exhibit(info, base);\r\n            });\r\n            var nameAndMod = function (name, modification) {\r\n                return {\r\n                    name: name,\r\n                    modification: modification\r\n                };\r\n            };\r\n            var byAspect = byInnerKey(modsByBehaviour, nameAndMod);\r\n            var combineObjects = function (objects) {\r\n                return foldr(objects, function (b, a) {\r\n                    return __assign({}, a.modification, b);\r\n                }, {});\r\n            };\r\n            var combinedClasses = foldr(byAspect.classes, function (b, a) {\r\n                return a.modification.concat(b);\r\n            }, []);\r\n            var combinedAttributes = combineObjects(byAspect.attributes);\r\n            var combinedStyles = combineObjects(byAspect.styles);\r\n            return nu$6({\r\n                classes: combinedClasses,\r\n                attributes: combinedAttributes,\r\n                styles: combinedStyles\r\n            });\r\n        };\r\n        var sortKeys = function (label, keyName, array, order) {\r\n            var sliced = array.slice(0);\r\n            try {\r\n                var sorted = sliced.sort(function (a, b) {\r\n                    var aKey = a[keyName]();\r\n                    var bKey = b[keyName]();\r\n                    var aIndex = order.indexOf(aKey);\r\n                    var bIndex = order.indexOf(bKey);\r\n                    if (aIndex === -1) {\r\n                        throw new Error('The ordering for ' + label + ' does not have an entry for ' + aKey + '.\\nOrder specified: ' + Json.stringify(order, null, 2));\r\n                    }\r\n                    if (bIndex === -1) {\r\n                        throw new Error('The ordering for ' + label + ' does not have an entry for ' + bKey + '.\\nOrder specified: ' + Json.stringify(order, null, 2));\r\n                    }\r\n                    if (aIndex < bIndex) {\r\n                        return -1;\r\n                    }\r\n                    else if (bIndex < aIndex) {\r\n                        return 1;\r\n                    }\r\n                    else {\r\n                        return 0;\r\n                    }\r\n                });\r\n                return Result.value(sorted);\r\n            }\r\n            catch (err) {\r\n                return Result.error([err]);\r\n            }\r\n        };\r\n        var uncurried = function (handler, purpose) {\r\n            return {\r\n                handler: handler,\r\n                purpose: constant(purpose)\r\n            };\r\n        };\r\n        var curried = function (handler, purpose) {\r\n            return {\r\n                cHandler: handler,\r\n                purpose: constant(purpose)\r\n            };\r\n        };\r\n        var curryArgs = function (descHandler, extraArgs) {\r\n            return curried(curry.apply(undefined, [descHandler.handler].concat(extraArgs)), descHandler.purpose());\r\n        };\r\n        var getCurried = function (descHandler) {\r\n            return descHandler.cHandler;\r\n        };\r\n        var behaviourTuple = function (name, handler) {\r\n            return {\r\n                name: constant(name),\r\n                handler: constant(handler)\r\n            };\r\n        };\r\n        var nameToHandlers = function (behaviours, info) {\r\n            var r = {};\r\n            each(behaviours, function (behaviour) {\r\n                r[behaviour.name()] = behaviour.handlers(info);\r\n            });\r\n            return r;\r\n        };\r\n        var groupByEvents = function (info, behaviours, base) {\r\n            var behaviourEvents = __assign({}, base, nameToHandlers(behaviours, info));\r\n            return byInnerKey(behaviourEvents, behaviourTuple);\r\n        };\r\n        var combine$1 = function (info, eventOrder, behaviours, base) {\r\n            var byEventName = groupByEvents(info, behaviours, base);\r\n            return combineGroups(byEventName, eventOrder);\r\n        };\r\n        var assemble = function (rawHandler) {\r\n            var handler = read(rawHandler);\r\n            return function (component, simulatedEvent) {\r\n                var rest = [];\r\n                for (var _i = 2; _i < arguments.length; _i++) {\r\n                    rest[_i - 2] = arguments[_i];\r\n                }\r\n                var args = [\r\n                    component,\r\n                    simulatedEvent\r\n                ].concat(rest);\r\n                if (handler.abort.apply(undefined, args)) {\r\n                    simulatedEvent.stop();\r\n                }\r\n                else if (handler.can.apply(undefined, args)) {\r\n                    handler.run.apply(undefined, args);\r\n                }\r\n            };\r\n        };\r\n        var missingOrderError = function (eventName, tuples) {\r\n            return Result.error(['The event (' + eventName + ') has more than one behaviour that listens to it.\\nWhen this occurs, you must ' + 'specify an event ordering for the behaviours in your spec (e.g. [ \"listing\", \"toggling\" ]).\\nThe behaviours that ' + 'can trigger it are: ' + Json.stringify(map(tuples, function (c) {\r\n                    return c.name();\r\n                }), null, 2)]);\r\n        };\r\n        var fuse$1 = function (tuples, eventOrder, eventName) {\r\n            var order = eventOrder[eventName];\r\n            if (!order) {\r\n                return missingOrderError(eventName, tuples);\r\n            }\r\n            else {\r\n                return sortKeys('Event: ' + eventName, 'name', tuples, order).map(function (sortedTuples) {\r\n                    var handlers = map(sortedTuples, function (tuple) {\r\n                        return tuple.handler();\r\n                    });\r\n                    return fuse(handlers);\r\n                });\r\n            }\r\n        };\r\n        var combineGroups = function (byEventName, eventOrder) {\r\n            var r = mapToArray(byEventName, function (tuples, eventName) {\r\n                var combined = tuples.length === 1 ? Result.value(tuples[0].handler()) : fuse$1(tuples, eventOrder, eventName);\r\n                return combined.map(function (handler) {\r\n                    var assembled = assemble(handler);\r\n                    var purpose = tuples.length > 1 ? filter(eventOrder, function (o) {\r\n                        return contains(tuples, function (t) {\r\n                            return t.name() === o;\r\n                        });\r\n                    }).join(' > ') : tuples[0].name();\r\n                    return wrap$1(eventName, uncurried(assembled, purpose));\r\n                });\r\n            });\r\n            return consolidate(r, {});\r\n        };\r\n        var toInfo = function (spec) {\r\n            return asRaw('custom.definition', objOf([\r\n                field('dom', 'dom', strict(), objOf([\r\n                    strict$1('tag'),\r\n                    defaulted$1('styles', {}),\r\n                    defaulted$1('classes', []),\r\n                    defaulted$1('attributes', {}),\r\n                    option('value'),\r\n                    option('innerHtml')\r\n                ])),\r\n                strict$1('components'),\r\n                strict$1('uid'),\r\n                defaulted$1('events', {}),\r\n                defaulted$1('apis', {}),\r\n                field('eventOrder', 'eventOrder', mergeWith({\r\n                    'alloy.execute': [\r\n                        'disabling',\r\n                        'alloy.base.behaviour',\r\n                        'toggling',\r\n                        'typeaheadevents'\r\n                    ],\r\n                    'alloy.focus': [\r\n                        'alloy.base.behaviour',\r\n                        'focusing',\r\n                        'keying'\r\n                    ],\r\n                    'alloy.system.init': [\r\n                        'alloy.base.behaviour',\r\n                        'disabling',\r\n                        'toggling',\r\n                        'representing'\r\n                    ],\r\n                    'input': [\r\n                        'alloy.base.behaviour',\r\n                        'representing',\r\n                        'streaming',\r\n                        'invalidating'\r\n                    ],\r\n                    'alloy.system.detached': [\r\n                        'alloy.base.behaviour',\r\n                        'representing',\r\n                        'item-events',\r\n                        'tooltipping'\r\n                    ],\r\n                    'mousedown': [\r\n                        'focusing',\r\n                        'alloy.base.behaviour',\r\n                        'item-type-events'\r\n                    ],\r\n                    'mouseover': [\r\n                        'item-type-events',\r\n                        'tooltipping'\r\n                    ]\r\n                }), anyValue$1()),\r\n                option('domModification')\r\n            ]), spec);\r\n        };\r\n        var toDefinition = function (detail) {\r\n            return __assign({}, detail.dom, {\r\n                uid: detail.uid,\r\n                domChildren: map(detail.components, function (comp) {\r\n                    return comp.element();\r\n                })\r\n            });\r\n        };\r\n        var toModification = function (detail) {\r\n            return detail.domModification.fold(function () {\r\n                return nu$6({});\r\n            }, nu$6);\r\n        };\r\n        var toEvents = function (info) {\r\n            return info.events;\r\n        };\r\n        function Toggler(turnOff, turnOn, initial) {\r\n            var active = initial || false;\r\n            var on = function () {\r\n                turnOn();\r\n                active = true;\r\n            };\r\n            var off = function () {\r\n                turnOff();\r\n                active = false;\r\n            };\r\n            var toggle = function () {\r\n                var f = active ? off : on;\r\n                f();\r\n            };\r\n            var isOn = function () {\r\n                return active;\r\n            };\r\n            return {\r\n                on: on,\r\n                off: off,\r\n                toggle: toggle,\r\n                isOn: isOn\r\n            };\r\n        }\r\n        var read$2 = function (element, attr) {\r\n            var value = get$2(element, attr);\r\n            return value === undefined || value === '' ? [] : value.split(' ');\r\n        };\r\n        var add = function (element, attr, id) {\r\n            var old = read$2(element, attr);\r\n            var nu = old.concat([id]);\r\n            set$1(element, attr, nu.join(' '));\r\n            return true;\r\n        };\r\n        var remove$2 = function (element, attr, id) {\r\n            var nu = filter(read$2(element, attr), function (v) {\r\n                return v !== id;\r\n            });\r\n            if (nu.length > 0) {\r\n                set$1(element, attr, nu.join(' '));\r\n            }\r\n            else {\r\n                remove$1(element, attr);\r\n            }\r\n            return false;\r\n        };\r\n        var supports = function (element) {\r\n            return element.dom().classList !== undefined;\r\n        };\r\n        var get$3 = function (element) {\r\n            return read$2(element, 'class');\r\n        };\r\n        var add$1 = function (element, clazz) {\r\n            return add(element, 'class', clazz);\r\n        };\r\n        var remove$3 = function (element, clazz) {\r\n            return remove$2(element, 'class', clazz);\r\n        };\r\n        var toggle = function (element, clazz) {\r\n            if (contains(get$3(element), clazz)) {\r\n                return remove$3(element, clazz);\r\n            }\r\n            else {\r\n                return add$1(element, clazz);\r\n            }\r\n        };\r\n        var ClassList = Object.freeze({\r\n            get: get$3,\r\n            add: add$1,\r\n            remove: remove$3,\r\n            toggle: toggle,\r\n            supports: supports\r\n        });\r\n        var add$2 = function (element, clazz) {\r\n            if (supports(element)) {\r\n                element.dom().classList.add(clazz);\r\n            }\r\n            else {\r\n                add$1(element, clazz);\r\n            }\r\n        };\r\n        var cleanClass = function (element) {\r\n            var classList = supports(element) ? element.dom().classList : get$3(element);\r\n            if (classList.length === 0) {\r\n                remove$1(element, 'class');\r\n            }\r\n        };\r\n        var remove$4 = function (element, clazz) {\r\n            if (supports(element)) {\r\n                var classList = element.dom().classList;\r\n                classList.remove(clazz);\r\n            }\r\n            else {\r\n                remove$3(element, clazz);\r\n            }\r\n            cleanClass(element);\r\n        };\r\n        var toggle$1 = function (element, clazz) {\r\n            return supports(element) ? element.dom().classList.toggle(clazz) : toggle(element, clazz);\r\n        };\r\n        var toggler = function (element, clazz) {\r\n            var hasClasslist = supports(element);\r\n            var classList = element.dom().classList;\r\n            var off = function () {\r\n                if (hasClasslist) {\r\n                    classList.remove(clazz);\r\n                }\r\n                else {\r\n                    remove$3(element, clazz);\r\n                }\r\n            };\r\n            var on = function () {\r\n                if (hasClasslist) {\r\n                    classList.add(clazz);\r\n                }\r\n                else {\r\n                    add$1(element, clazz);\r\n                }\r\n            };\r\n            return Toggler(off, on, has$2(element, clazz));\r\n        };\r\n        var has$2 = function (element, clazz) {\r\n            return supports(element) && element.dom().classList.contains(clazz);\r\n        };\r\n        var Class = Object.freeze({\r\n            add: add$2,\r\n            remove: remove$4,\r\n            toggle: toggle$1,\r\n            toggler: toggler,\r\n            has: has$2\r\n        });\r\n        var add$3 = function (element, classes) {\r\n            each(classes, function (x) {\r\n                add$2(element, x);\r\n            });\r\n        };\r\n        var remove$5 = function (element, classes) {\r\n            each(classes, function (x) {\r\n                remove$4(element, x);\r\n            });\r\n        };\r\n        var isSupported = function (dom) {\r\n            return dom.style !== undefined;\r\n        };\r\n        var internalSet = function (dom, property, value) {\r\n            if (!isString(value)) {\r\n                domGlobals.console.error('Invalid call to CSS.set. Property ', property, ':: Value ', value, ':: Element ', dom);\r\n                throw new Error('CSS value must be a string: ' + value);\r\n            }\r\n            if (isSupported(dom)) {\r\n                dom.style.setProperty(property, value);\r\n            }\r\n        };\r\n        var internalRemove = function (dom, property) {\r\n            if (isSupported(dom)) {\r\n                dom.style.removeProperty(property);\r\n            }\r\n        };\r\n        var set$2 = function (element, property, value) {\r\n            var dom = element.dom();\r\n            internalSet(dom, property, value);\r\n        };\r\n        var setAll$1 = function (element, css) {\r\n            var dom = element.dom();\r\n            each$1(css, function (v, k) {\r\n                internalSet(dom, k, v);\r\n            });\r\n        };\r\n        var setOptions = function (element, css) {\r\n            var dom = element.dom();\r\n            each$1(css, function (v, k) {\r\n                v.fold(function () {\r\n                    internalRemove(dom, k);\r\n                }, function (value) {\r\n                    internalSet(dom, k, value);\r\n                });\r\n            });\r\n        };\r\n        var get$4 = function (element, property) {\r\n            var dom = element.dom();\r\n            var styles = domGlobals.window.getComputedStyle(dom);\r\n            var r = styles.getPropertyValue(property);\r\n            var v = r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\r\n            return v === null ? undefined : v;\r\n        };\r\n        var getUnsafeProperty = function (dom, property) {\r\n            return isSupported(dom) ? dom.style.getPropertyValue(property) : '';\r\n        };\r\n        var getRaw = function (element, property) {\r\n            var dom = element.dom();\r\n            var raw = getUnsafeProperty(dom, property);\r\n            return Option.from(raw).filter(function (r) {\r\n                return r.length > 0;\r\n            });\r\n        };\r\n        var getAllRaw = function (element) {\r\n            var css = {};\r\n            var dom = element.dom();\r\n            if (isSupported(dom)) {\r\n                for (var i = 0; i < dom.style.length; i++) {\r\n                    var ruleName = dom.style.item(i);\r\n                    css[ruleName] = dom.style[ruleName];\r\n                }\r\n            }\r\n            return css;\r\n        };\r\n        var isValidValue = function (tag, property, value) {\r\n            var element = Element.fromTag(tag);\r\n            set$2(element, property, value);\r\n            var style = getRaw(element, property);\r\n            return style.isSome();\r\n        };\r\n        var remove$6 = function (element, property) {\r\n            var dom = element.dom();\r\n            internalRemove(dom, property);\r\n            if (has$1(element, 'style') && trim(get$2(element, 'style')) === '') {\r\n                remove$1(element, 'style');\r\n            }\r\n        };\r\n        var preserve = function (element, f) {\r\n            var oldStyles = get$2(element, 'style');\r\n            var result = f(element);\r\n            var restore = oldStyles === undefined ? remove$1 : set$1;\r\n            restore(element, 'style', oldStyles);\r\n            return result;\r\n        };\r\n        var copy = function (source, target) {\r\n            var sourceDom = source.dom();\r\n            var targetDom = target.dom();\r\n            if (isSupported(sourceDom) && isSupported(targetDom)) {\r\n                targetDom.style.cssText = sourceDom.style.cssText;\r\n            }\r\n        };\r\n        var reflow = function (e) {\r\n            return e.dom().offsetWidth;\r\n        };\r\n        var transferOne = function (source, destination, style) {\r\n            getRaw(source, style).each(function (value) {\r\n                if (getRaw(destination, style).isNone()) {\r\n                    set$2(destination, style, value);\r\n                }\r\n            });\r\n        };\r\n        var transfer = function (source, destination, styles) {\r\n            if (!isElement(source) || !isElement(destination)) {\r\n                return;\r\n            }\r\n            each(styles, function (style) {\r\n                transferOne(source, destination, style);\r\n            });\r\n        };\r\n        var Css = Object.freeze({\r\n            copy: copy,\r\n            set: set$2,\r\n            preserve: preserve,\r\n            setAll: setAll$1,\r\n            setOptions: setOptions,\r\n            remove: remove$6,\r\n            get: get$4,\r\n            getRaw: getRaw,\r\n            getAllRaw: getAllRaw,\r\n            isValidValue: isValidValue,\r\n            reflow: reflow,\r\n            transfer: transfer\r\n        });\r\n        var get$5 = function (element) {\r\n            return element.dom().value;\r\n        };\r\n        var set$3 = function (element, value) {\r\n            if (value === undefined) {\r\n                throw new Error('Value.set was undefined');\r\n            }\r\n            element.dom().value = value;\r\n        };\r\n        var renderToDom = function (definition) {\r\n            var subject = Element.fromTag(definition.tag);\r\n            setAll(subject, definition.attributes);\r\n            add$3(subject, definition.classes);\r\n            setAll$1(subject, definition.styles);\r\n            definition.innerHtml.each(function (html) {\r\n                return set(subject, html);\r\n            });\r\n            var children = definition.domChildren;\r\n            append$1(subject, children);\r\n            definition.value.each(function (value) {\r\n                set$3(subject, value);\r\n            });\r\n            if (!definition.uid) {\r\n                debugger;\r\n            }\r\n            writeOnly(subject, definition.uid);\r\n            return subject;\r\n        };\r\n        var getBehaviours$1 = function (spec) {\r\n            var behaviours = readOr$1('behaviours', {})(spec);\r\n            var keys$1 = filter(keys(behaviours), function (k) {\r\n                return behaviours[k] !== undefined;\r\n            });\r\n            return map(keys$1, function (k) {\r\n                return behaviours[k].me;\r\n            });\r\n        };\r\n        var generateFrom$1 = function (spec, all) {\r\n            return generateFrom(spec, all);\r\n        };\r\n        var generate$3 = function (spec) {\r\n            var all = getBehaviours$1(spec);\r\n            return generateFrom$1(spec, all);\r\n        };\r\n        var getDomDefinition = function (info, bList, bData) {\r\n            var definition = toDefinition(info);\r\n            var infoModification = toModification(info);\r\n            var baseModification = { 'alloy.base.modification': infoModification };\r\n            var modification = bList.length > 0 ? combine(bData, baseModification, bList, definition) : infoModification;\r\n            return merge$1(definition, modification);\r\n        };\r\n        var getEvents = function (info, bList, bData) {\r\n            var baseEvents = { 'alloy.base.behaviour': toEvents(info) };\r\n            return combine$1(bData, info.eventOrder, bList, baseEvents).getOrDie();\r\n        };\r\n        var build = function (spec) {\r\n            var getMe = function () {\r\n                return me;\r\n            };\r\n            var systemApi = Cell(singleton);\r\n            var info = getOrDie$1(toInfo(spec));\r\n            var bBlob = generate$3(spec);\r\n            var bList = getBehaviours(bBlob);\r\n            var bData = getData(bBlob);\r\n            var modDefinition = getDomDefinition(info, bList, bData);\r\n            var item = renderToDom(modDefinition);\r\n            var events = getEvents(info, bList, bData);\r\n            var subcomponents = Cell(info.components);\r\n            var connect = function (newApi) {\r\n                systemApi.set(newApi);\r\n            };\r\n            var disconnect = function () {\r\n                systemApi.set(NoContextApi(getMe));\r\n            };\r\n            var syncComponents = function () {\r\n                var children$1 = children(item);\r\n                var subs = bind(children$1, function (child) {\r\n                    return systemApi.get().getByDom(child).fold(function () {\r\n                        return [];\r\n                    }, function (c) {\r\n                        return [c];\r\n                    });\r\n                });\r\n                subcomponents.set(subs);\r\n            };\r\n            var config = function (behaviour) {\r\n                var b = bData;\r\n                var f = isFunction(b[behaviour.name()]) ? b[behaviour.name()] : function () {\r\n                    throw new Error('Could not find ' + behaviour.name() + ' in ' + Json.stringify(spec, null, 2));\r\n                };\r\n                return f();\r\n            };\r\n            var hasConfigured = function (behaviour) {\r\n                return isFunction(bData[behaviour.name()]);\r\n            };\r\n            var getApis = function () {\r\n                return info.apis;\r\n            };\r\n            var readState = function (behaviourName) {\r\n                return bData[behaviourName]().map(function (b) {\r\n                    return b.state.readState();\r\n                }).getOr('not enabled');\r\n            };\r\n            var me = {\r\n                getSystem: systemApi.get,\r\n                config: config,\r\n                hasConfigured: hasConfigured,\r\n                spec: constant(spec),\r\n                readState: readState,\r\n                getApis: getApis,\r\n                connect: connect,\r\n                disconnect: disconnect,\r\n                element: constant(item),\r\n                syncComponents: syncComponents,\r\n                components: subcomponents.get,\r\n                events: constant(events)\r\n            };\r\n            return me;\r\n        };\r\n        var buildSubcomponents = function (spec) {\r\n            var components = readOr$1('components', [])(spec);\r\n            return map(components, build$1);\r\n        };\r\n        var buildFromSpec = function (userSpec) {\r\n            var _a = make(userSpec), specEvents = _a.events, spec = __rest(_a, ['events']);\r\n            var components = buildSubcomponents(spec);\r\n            var completeSpec = __assign({}, spec, {\r\n                events: __assign({}, DefaultEvents, specEvents),\r\n                components: components\r\n            });\r\n            return Result.value(build(completeSpec));\r\n        };\r\n        var text = function (textContent) {\r\n            var element = Element.fromText(textContent);\r\n            return external({ element: element });\r\n        };\r\n        var external = function (spec) {\r\n            var extSpec = asRawOrDie('external.component', objOfOnly([\r\n                strict$1('element'),\r\n                option('uid')\r\n            ]), spec);\r\n            var systemApi = Cell(NoContextApi());\r\n            var connect = function (newApi) {\r\n                systemApi.set(newApi);\r\n            };\r\n            var disconnect = function () {\r\n                systemApi.set(NoContextApi(function () {\r\n                    return me;\r\n                }));\r\n            };\r\n            extSpec.uid.each(function (uid) {\r\n                writeOnly(extSpec.element, uid);\r\n            });\r\n            var me = {\r\n                getSystem: systemApi.get,\r\n                config: Option.none,\r\n                hasConfigured: constant(false),\r\n                connect: connect,\r\n                disconnect: disconnect,\r\n                getApis: function () {\r\n                    return {};\r\n                },\r\n                element: constant(extSpec.element),\r\n                spec: constant(spec),\r\n                readState: constant('No state'),\r\n                syncComponents: noop,\r\n                components: constant([]),\r\n                events: constant({})\r\n            };\r\n            return premade(me);\r\n        };\r\n        var uids = generate$2;\r\n        var build$1 = function (spec) {\r\n            return getPremade(spec).fold(function () {\r\n                var userSpecWithUid = spec.hasOwnProperty('uid') ? spec : __assign({ uid: uids('') }, spec);\r\n                return buildFromSpec(userSpecWithUid).getOrDie();\r\n            }, function (prebuilt) {\r\n                return prebuilt;\r\n            });\r\n        };\r\n        var premade$1 = premade;\r\n        var GuiFactory = Object.freeze({\r\n            build: build$1,\r\n            premade: premade$1,\r\n            external: external,\r\n            text: text\r\n        });\r\n        var any$1 = function (predicate) {\r\n            return first(predicate).isSome();\r\n        };\r\n        var ancestor$1 = function (scope, predicate, isRoot) {\r\n            return ancestor(scope, predicate, isRoot).isSome();\r\n        };\r\n        var closest$2 = function (scope, predicate, isRoot) {\r\n            return closest(scope, predicate, isRoot).isSome();\r\n        };\r\n        var sibling$1 = function (scope, predicate) {\r\n            return sibling(scope, predicate).isSome();\r\n        };\r\n        var child$2 = function (scope, predicate) {\r\n            return child$1(scope, predicate).isSome();\r\n        };\r\n        var descendant$1 = function (scope, predicate) {\r\n            return descendant(scope, predicate).isSome();\r\n        };\r\n        var PredicateExists = Object.freeze({\r\n            any: any$1,\r\n            ancestor: ancestor$1,\r\n            closest: closest$2,\r\n            sibling: sibling$1,\r\n            child: child$2,\r\n            descendant: descendant$1\r\n        });\r\n        var first$1 = function (selector) {\r\n            return one(selector);\r\n        };\r\n        var ancestor$2 = function (scope, selector, isRoot) {\r\n            return ancestor(scope, function (e) {\r\n                return is(e, selector);\r\n            }, isRoot);\r\n        };\r\n        var sibling$2 = function (scope, selector) {\r\n            return sibling(scope, function (e) {\r\n                return is(e, selector);\r\n            });\r\n        };\r\n        var child$3 = function (scope, selector) {\r\n            return child$1(scope, function (e) {\r\n                return is(e, selector);\r\n            });\r\n        };\r\n        var descendant$2 = function (scope, selector) {\r\n            return one(selector, scope);\r\n        };\r\n        var closest$3 = function (scope, selector, isRoot) {\r\n            return ClosestOrAncestor(is, ancestor$2, scope, selector, isRoot);\r\n        };\r\n        var SelectorFind = Object.freeze({\r\n            first: first$1,\r\n            ancestor: ancestor$2,\r\n            sibling: sibling$2,\r\n            child: child$3,\r\n            descendant: descendant$2,\r\n            closest: closest$3\r\n        });\r\n        var find$3 = function (queryElem) {\r\n            var dependent = closest(queryElem, function (elem) {\r\n                if (!isElement(elem)) {\r\n                    return false;\r\n                }\r\n                var id = get$2(elem, 'id');\r\n                return id !== undefined && id.indexOf('aria-owns') > -1;\r\n            });\r\n            return dependent.bind(function (dep) {\r\n                var id = get$2(dep, 'id');\r\n                var doc = owner(dep);\r\n                return descendant$2(doc, '[aria-owns=\"' + id + '\"]');\r\n            });\r\n        };\r\n        var manager = function () {\r\n            var ariaId = generate$1('aria-owns');\r\n            var link = function (elem) {\r\n                set$1(elem, 'aria-owns', ariaId);\r\n            };\r\n            var unlink = function (elem) {\r\n                remove$1(elem, 'aria-owns');\r\n            };\r\n            return {\r\n                id: constant(ariaId),\r\n                link: link,\r\n                unlink: unlink\r\n            };\r\n        };\r\n        var isAriaPartOf = function (component, queryElem) {\r\n            return find$3(queryElem).exists(function (owner) {\r\n                return isPartOf(component, owner);\r\n            });\r\n        };\r\n        var isPartOf = function (component, queryElem) {\r\n            return closest$2(queryElem, function (el) {\r\n                return eq(el, component.element());\r\n            }, constant(false)) || isAriaPartOf(component, queryElem);\r\n        };\r\n        var menuFields = constant([\r\n            strict$1('menu'),\r\n            strict$1('selectedMenu')\r\n        ]);\r\n        var itemFields = constant([\r\n            strict$1('item'),\r\n            strict$1('selectedItem')\r\n        ]);\r\n        var schema = constant(objOf(itemFields().concat(menuFields())));\r\n        var itemSchema = constant(objOf(itemFields()));\r\n        var _initSize = strictObjOf('initSize', [\r\n            strict$1('numColumns'),\r\n            strict$1('numRows')\r\n        ]);\r\n        var itemMarkers = function () {\r\n            return strictOf('markers', itemSchema());\r\n        };\r\n        var tieredMenuMarkers = function () {\r\n            return strictObjOf('markers', [strict$1('backgroundMenu')].concat(menuFields()).concat(itemFields()));\r\n        };\r\n        var markers = function (required) {\r\n            return strictObjOf('markers', map(required, strict$1));\r\n        };\r\n        var onPresenceHandler = function (label, fieldName, presence) {\r\n            var trace = getTrace();\r\n            return field(fieldName, fieldName, presence, valueOf(function (f) {\r\n                return Result.value(function () {\r\n                    var args = [];\r\n                    for (var _i = 0; _i < arguments.length; _i++) {\r\n                        args[_i] = arguments[_i];\r\n                    }\r\n                    return f.apply(undefined, args);\r\n                });\r\n            }));\r\n        };\r\n        var onHandler = function (fieldName) {\r\n            return onPresenceHandler('onHandler', fieldName, defaulted(noop));\r\n        };\r\n        var onKeyboardHandler = function (fieldName) {\r\n            return onPresenceHandler('onKeyboardHandler', fieldName, defaulted(Option.none));\r\n        };\r\n        var onStrictHandler = function (fieldName) {\r\n            return onPresenceHandler('onHandler', fieldName, strict());\r\n        };\r\n        var onStrictKeyboardHandler = function (fieldName) {\r\n            return onPresenceHandler('onKeyboardHandler', fieldName, strict());\r\n        };\r\n        var output = function (name, value) {\r\n            return state$1(name, constant(value));\r\n        };\r\n        var snapshot = function (name) {\r\n            return state$1(name, identity);\r\n        };\r\n        var initSize = constant(_initSize);\r\n        var executeEvent = function (bConfig, bState, executor) {\r\n            return runOnExecute(function (component) {\r\n                executor(component, bConfig, bState);\r\n            });\r\n        };\r\n        var loadEvent = function (bConfig, bState, f) {\r\n            return runOnInit(function (component, simulatedEvent) {\r\n                f(component, bConfig, bState);\r\n            });\r\n        };\r\n        var create = function (schema, name, active, apis, extra, state) {\r\n            var configSchema = objOfOnly(schema);\r\n            var schemaSchema = optionObjOf(name, [optionObjOfOnly('config', schema)]);\r\n            return doCreate(configSchema, schemaSchema, name, active, apis, extra, state);\r\n        };\r\n        var createModes = function (modes, name, active, apis, extra, state) {\r\n            var configSchema = modes;\r\n            var schemaSchema = optionObjOf(name, [optionOf('config', modes)]);\r\n            return doCreate(configSchema, schemaSchema, name, active, apis, extra, state);\r\n        };\r\n        var wrapApi = function (bName, apiFunction, apiName) {\r\n            var f = function (component) {\r\n                var rest = [];\r\n                for (var _i = 1; _i < arguments.length; _i++) {\r\n                    rest[_i - 1] = arguments[_i];\r\n                }\r\n                var args = [component].concat(rest);\r\n                return component.config({ name: constant(bName) }).fold(function () {\r\n                    throw new Error('We could not find any behaviour configuration for: ' + bName + '. Using API: ' + apiName);\r\n                }, function (info) {\r\n                    var rest = Array.prototype.slice.call(args, 1);\r\n                    return apiFunction.apply(undefined, [\r\n                        component,\r\n                        info.config,\r\n                        info.state\r\n                    ].concat(rest));\r\n                });\r\n            };\r\n            return markAsBehaviourApi(f, apiName, apiFunction);\r\n        };\r\n        var revokeBehaviour = function (name) {\r\n            return {\r\n                key: name,\r\n                value: undefined\r\n            };\r\n        };\r\n        var doCreate = function (configSchema, schemaSchema, name, active, apis, extra, state) {\r\n            var getConfig = function (info) {\r\n                return hasKey$1(info, name) ? info[name]() : Option.none();\r\n            };\r\n            var wrappedApis = map$1(apis, function (apiF, apiName) {\r\n                return wrapApi(name, apiF, apiName);\r\n            });\r\n            var wrappedExtra = map$1(extra, function (extraF, extraName) {\r\n                return markAsExtraApi(extraF, extraName);\r\n            });\r\n            var me = __assign({}, wrappedExtra, wrappedApis, {\r\n                revoke: curry(revokeBehaviour, name),\r\n                config: function (spec) {\r\n                    var prepared = asRawOrDie(name + '-config', configSchema, spec);\r\n                    return {\r\n                        key: name,\r\n                        value: {\r\n                            config: prepared,\r\n                            me: me,\r\n                            configAsRaw: cached(function () {\r\n                                return asRawOrDie(name + '-config', configSchema, spec);\r\n                            }),\r\n                            initialConfig: spec,\r\n                            state: state\r\n                        }\r\n                    };\r\n                },\r\n                schema: function () {\r\n                    return schemaSchema;\r\n                },\r\n                exhibit: function (info, base) {\r\n                    return getConfig(info).bind(function (behaviourInfo) {\r\n                        return readOptFrom$1(active, 'exhibit').map(function (exhibitor) {\r\n                            return exhibitor(base, behaviourInfo.config, behaviourInfo.state);\r\n                        });\r\n                    }).getOr(nu$6({}));\r\n                },\r\n                name: function () {\r\n                    return name;\r\n                },\r\n                handlers: function (info) {\r\n                    return getConfig(info).map(function (behaviourInfo) {\r\n                        var getEvents = readOr$1('events', function (a, b) {\r\n                            return {};\r\n                        })(active);\r\n                        return getEvents(behaviourInfo.config, behaviourInfo.state);\r\n                    }).getOr({});\r\n                }\r\n            });\r\n            return me;\r\n        };\r\n        var derive$1 = function (capabilities) {\r\n            return wrapAll$1(capabilities);\r\n        };\r\n        var simpleSchema = objOfOnly([\r\n            strict$1('fields'),\r\n            strict$1('name'),\r\n            defaulted$1('active', {}),\r\n            defaulted$1('apis', {}),\r\n            defaulted$1('state', NoState),\r\n            defaulted$1('extra', {})\r\n        ]);\r\n        var create$1 = function (data) {\r\n            var value = asRawOrDie('Creating behaviour: ' + data.name, simpleSchema, data);\r\n            return create(value.fields, value.name, value.active, value.apis, value.extra, value.state);\r\n        };\r\n        var modeSchema = objOfOnly([\r\n            strict$1('branchKey'),\r\n            strict$1('branches'),\r\n            strict$1('name'),\r\n            defaulted$1('active', {}),\r\n            defaulted$1('apis', {}),\r\n            defaulted$1('state', NoState),\r\n            defaulted$1('extra', {})\r\n        ]);\r\n        var createModes$1 = function (data) {\r\n            var value = asRawOrDie('Creating behaviour: ' + data.name, modeSchema, data);\r\n            return createModes(choose$1(value.branchKey, value.branches), value.name, value.active, value.apis, value.extra, value.state);\r\n        };\r\n        var revoke = constant(undefined);\r\n        var chooseChannels = function (channels, message) {\r\n            return message.universal() ? channels : filter(channels, function (ch) {\r\n                return contains(message.channels(), ch);\r\n            });\r\n        };\r\n        var events$1 = function (receiveConfig) {\r\n            return derive([run(receive(), function (component, message) {\r\n                    var channelMap = receiveConfig.channels;\r\n                    var channels = keys(channelMap);\r\n                    var targetChannels = chooseChannels(channels, message);\r\n                    each(targetChannels, function (ch) {\r\n                        var channelInfo = channelMap[ch];\r\n                        var channelSchema = channelInfo.schema;\r\n                        var data = asRawOrDie('channel[' + ch + '] data\\nReceiver: ' + element(component.element()), channelSchema, message.data());\r\n                        channelInfo.onReceive(component, data);\r\n                    });\r\n                })]);\r\n        };\r\n        var ActiveReceiving = Object.freeze({\r\n            events: events$1\r\n        });\r\n        var ReceivingSchema = [strictOf('channels', setOf$1(Result.value, objOfOnly([\r\n                onStrictHandler('onReceive'),\r\n                defaulted$1('schema', anyValue$1())\r\n            ])))];\r\n        var Receiving = create$1({\r\n            fields: ReceivingSchema,\r\n            name: 'receiving',\r\n            active: ActiveReceiving\r\n        });\r\n        var exhibit = function (base, posConfig) {\r\n            return nu$6({\r\n                classes: [],\r\n                styles: posConfig.useFixed ? {} : { position: 'relative' }\r\n            });\r\n        };\r\n        var ActivePosition = Object.freeze({\r\n            exhibit: exhibit\r\n        });\r\n        var attached = function (element, scope) {\r\n            var doc = scope || Element.fromDom(domGlobals.document.documentElement);\r\n            return ancestor(element, curry(eq, doc)).isSome();\r\n        };\r\n        var windowOf = function (element) {\r\n            var dom = element.dom();\r\n            if (dom === dom.window && element instanceof domGlobals.Window) {\r\n                return element;\r\n            }\r\n            return isDocument(element) ? dom.defaultView || dom.parentWindow : null;\r\n        };\r\n        var r = function (left, top) {\r\n            var translate = function (x, y) {\r\n                return r(left + x, top + y);\r\n            };\r\n            return {\r\n                left: constant(left),\r\n                top: constant(top),\r\n                translate: translate\r\n            };\r\n        };\r\n        var Position = r;\r\n        var boxPosition = function (dom) {\r\n            var box = dom.getBoundingClientRect();\r\n            return Position(box.left, box.top);\r\n        };\r\n        var firstDefinedOrZero = function (a, b) {\r\n            return a !== undefined ? a : b !== undefined ? b : 0;\r\n        };\r\n        var absolute = function (element) {\r\n            var doc = element.dom().ownerDocument;\r\n            var body = doc.body;\r\n            var win = windowOf(Element.fromDom(doc));\r\n            var html = doc.documentElement;\r\n            var scrollTop = firstDefinedOrZero(win.pageYOffset, html.scrollTop);\r\n            var scrollLeft = firstDefinedOrZero(win.pageXOffset, html.scrollLeft);\r\n            var clientTop = firstDefinedOrZero(html.clientTop, body.clientTop);\r\n            var clientLeft = firstDefinedOrZero(html.clientLeft, body.clientLeft);\r\n            return viewport(element).translate(scrollLeft - clientLeft, scrollTop - clientTop);\r\n        };\r\n        var viewport = function (element) {\r\n            var dom = element.dom();\r\n            var doc = dom.ownerDocument;\r\n            var body = doc.body;\r\n            var html = Element.fromDom(doc.documentElement);\r\n            if (body === dom) {\r\n                return Position(body.offsetLeft, body.offsetTop);\r\n            }\r\n            if (!attached(element, html)) {\r\n                return Position(0, 0);\r\n            }\r\n            return boxPosition(dom);\r\n        };\r\n        var isSafari = PlatformDetection$1.detect().browser.isSafari();\r\n        var get$6 = function (_DOC) {\r\n            var doc = _DOC !== undefined ? _DOC.dom() : domGlobals.document;\r\n            var x = doc.body.scrollLeft || doc.documentElement.scrollLeft;\r\n            var y = doc.body.scrollTop || doc.documentElement.scrollTop;\r\n            return Position(x, y);\r\n        };\r\n        function Dimension(name, getOffset) {\r\n            var set = function (element, h) {\r\n                if (!isNumber(h) && !h.match(/^[0-9]+$/)) {\r\n                    throw new Error(name + '.set accepts only positive integer values. Value was ' + h);\r\n                }\r\n                var dom = element.dom();\r\n                if (isSupported(dom)) {\r\n                    dom.style[name] = h + 'px';\r\n                }\r\n            };\r\n            var get = function (element) {\r\n                var r = getOffset(element);\r\n                if (r <= 0 || r === null) {\r\n                    var css = get$4(element, name);\r\n                    return parseFloat(css) || 0;\r\n                }\r\n                return r;\r\n            };\r\n            var getOuter = get;\r\n            var aggregate = function (element, properties) {\r\n                return foldl(properties, function (acc, property) {\r\n                    var val = get$4(element, property);\r\n                    var value = val === undefined ? 0 : parseInt(val, 10);\r\n                    return isNaN(value) ? acc : acc + value;\r\n                }, 0);\r\n            };\r\n            var max = function (element, value, properties) {\r\n                var cumulativeInclusions = aggregate(element, properties);\r\n                var absoluteMax = value > cumulativeInclusions ? value - cumulativeInclusions : 0;\r\n                return absoluteMax;\r\n            };\r\n            return {\r\n                set: set,\r\n                get: get,\r\n                getOuter: getOuter,\r\n                aggregate: aggregate,\r\n                max: max\r\n            };\r\n        }\r\n        var api = Dimension('width', function (element) {\r\n            return element.dom().offsetWidth;\r\n        });\r\n        var set$4 = function (element, h) {\r\n            api.set(element, h);\r\n        };\r\n        var get$7 = function (element) {\r\n            return api.get(element);\r\n        };\r\n        var getOuter$1 = function (element) {\r\n            return api.getOuter(element);\r\n        };\r\n        var api$1 = Dimension('height', function (element) {\r\n            var dom = element.dom();\r\n            return inBody(element) ? dom.getBoundingClientRect().height : dom.offsetHeight;\r\n        });\r\n        var get$8 = function (element) {\r\n            return api$1.get(element);\r\n        };\r\n        var getOuter$2 = function (element) {\r\n            return api$1.getOuter(element);\r\n        };\r\n        var setMax = function (element, value) {\r\n            var inclusions = [\r\n                'margin-top',\r\n                'border-top-width',\r\n                'padding-top',\r\n                'padding-bottom',\r\n                'border-bottom-width',\r\n                'margin-bottom'\r\n            ];\r\n            var absMax = api$1.max(element, value, inclusions);\r\n            set$2(element, 'max-height', absMax + 'px');\r\n        };\r\n        var decision = MixedBag([\r\n            'x',\r\n            'y',\r\n            'width',\r\n            'height',\r\n            'maxHeight',\r\n            'direction',\r\n            'classes',\r\n            'label',\r\n            'candidateYforTest'\r\n        ], []);\r\n        var css = Immutable('position', 'left', 'top', 'right', 'bottom');\r\n        var adt$2 = Adt.generate([\r\n            { southeast: [] },\r\n            { southwest: [] },\r\n            { northeast: [] },\r\n            { northwest: [] },\r\n            { south: [] },\r\n            { north: [] },\r\n            { east: [] },\r\n            { west: [] }\r\n        ]);\r\n        var cata = function (subject, southeast, southwest, northeast, northwest, south, north, east, west) {\r\n            return subject.fold(southeast, southwest, northeast, northwest, south, north, east, west);\r\n        };\r\n        var cataVertical = function (subject, south, middle, north) {\r\n            return subject.fold(south, south, north, north, south, north, middle, middle);\r\n        };\r\n        var southeast = adt$2.southeast;\r\n        var southwest = adt$2.southwest;\r\n        var northeast = adt$2.northeast;\r\n        var northwest = adt$2.northwest;\r\n        var south = adt$2.south;\r\n        var north = adt$2.north;\r\n        var east = adt$2.east;\r\n        var west = adt$2.west;\r\n        var pointed = Immutable('point', 'width', 'height');\r\n        var rect = Immutable('x', 'y', 'width', 'height');\r\n        var bounds = function (x, y, width, height) {\r\n            return {\r\n                x: constant(x),\r\n                y: constant(y),\r\n                width: constant(width),\r\n                height: constant(height),\r\n                right: constant(x + width),\r\n                bottom: constant(y + height)\r\n            };\r\n        };\r\n        var box = function (element) {\r\n            var xy = absolute(element);\r\n            var w = getOuter$1(element);\r\n            var h = getOuter$2(element);\r\n            return bounds(xy.left(), xy.top(), w, h);\r\n        };\r\n        var walkUp = function (navigation, doc) {\r\n            var frame = navigation.view(doc);\r\n            return frame.fold(constant([]), function (f) {\r\n                var parent = navigation.owner(f);\r\n                var rest = walkUp(navigation, parent);\r\n                return [f].concat(rest);\r\n            });\r\n        };\r\n        var pathTo = function (element, navigation) {\r\n            var d = navigation.owner(element);\r\n            var paths = walkUp(navigation, d);\r\n            return Option.some(paths);\r\n        };\r\n        var view = function (doc) {\r\n            var element = doc.dom() === domGlobals.document ? Option.none() : Option.from(doc.dom().defaultView.frameElement);\r\n            return element.map(Element.fromDom);\r\n        };\r\n        var owner$1 = function (element) {\r\n            return owner(element);\r\n        };\r\n        var Navigation = Object.freeze({\r\n            view: view,\r\n            owner: owner$1\r\n        });\r\n        var find$4 = function (element) {\r\n            var doc = Element.fromDom(domGlobals.document);\r\n            var scroll = get$6(doc);\r\n            var path = pathTo(element, Navigation);\r\n            return path.fold(curry(absolute, element), function (frames) {\r\n                var offset = viewport(element);\r\n                var r = foldr(frames, function (b, a) {\r\n                    var loc = viewport(a);\r\n                    return {\r\n                        left: b.left + loc.left(),\r\n                        top: b.top + loc.top()\r\n                    };\r\n                }, {\r\n                    left: 0,\r\n                    top: 0\r\n                });\r\n                return Position(r.left + offset.left() + scroll.left(), r.top + offset.top() + scroll.top());\r\n            });\r\n        };\r\n        var win = function () {\r\n            var width = domGlobals.window.innerWidth;\r\n            var height = domGlobals.window.innerHeight;\r\n            var doc = Element.fromDom(domGlobals.document);\r\n            var scroll = get$6(doc);\r\n            return bounds(scroll.left(), scroll.top(), width, height);\r\n        };\r\n        var adt$3 = Adt.generate([\r\n            { none: [] },\r\n            {\r\n                relative: [\r\n                    'x',\r\n                    'y',\r\n                    'width',\r\n                    'height'\r\n                ]\r\n            },\r\n            {\r\n                fixed: [\r\n                    'x',\r\n                    'y',\r\n                    'width',\r\n                    'height'\r\n                ]\r\n            }\r\n        ]);\r\n        var positionWithDirection = function (posName, decision, x, y, width, height) {\r\n            var decisionX = decision.x() - x;\r\n            var decisionY = decision.y() - y;\r\n            var decisionWidth = decision.width();\r\n            var decisionHeight = decision.height();\r\n            var decisionRight = width - (decisionX + decisionWidth);\r\n            var decisionBottom = height - (decisionY + decisionHeight);\r\n            var left = Option.some(decisionX);\r\n            var top = Option.some(decisionY);\r\n            var right = Option.some(decisionRight);\r\n            var bottom = Option.some(decisionBottom);\r\n            var none = Option.none();\r\n            return cata(decision.direction(), function () {\r\n                return css(posName, left, top, none, none);\r\n            }, function () {\r\n                return css(posName, none, top, right, none);\r\n            }, function () {\r\n                return css(posName, left, none, none, bottom);\r\n            }, function () {\r\n                return css(posName, none, none, right, bottom);\r\n            }, function () {\r\n                return css(posName, left, top, none, none);\r\n            }, function () {\r\n                return css(posName, left, none, none, bottom);\r\n            }, function () {\r\n                return css(posName, left, top, none, none);\r\n            }, function () {\r\n                return css(posName, none, top, right, none);\r\n            });\r\n        };\r\n        var reposition = function (origin, decision) {\r\n            return origin.fold(function () {\r\n                return css('absolute', Option.some(decision.x()), Option.some(decision.y()), Option.none(), Option.none());\r\n            }, function (x, y, width, height) {\r\n                return positionWithDirection('absolute', decision, x, y, width, height);\r\n            }, function (x, y, width, height) {\r\n                return positionWithDirection('fixed', decision, x, y, width, height);\r\n            });\r\n        };\r\n        var toBox = function (origin, element) {\r\n            var rel = curry(find$4, element);\r\n            var position = origin.fold(rel, rel, function () {\r\n                var scroll = get$6();\r\n                return find$4(element).translate(-scroll.left(), -scroll.top());\r\n            });\r\n            var width = getOuter$1(element);\r\n            var height = getOuter$2(element);\r\n            return bounds(position.left(), position.top(), width, height);\r\n        };\r\n        var viewport$1 = function (origin, getBounds) {\r\n            return getBounds.fold(function () {\r\n                return origin.fold(win, win, bounds);\r\n            }, function (b) {\r\n                return origin.fold(b, b, bounds);\r\n            });\r\n        };\r\n        var cata$1 = function (subject, onNone, onRelative, onFixed) {\r\n            return subject.fold(onNone, onRelative, onFixed);\r\n        };\r\n        var relative = adt$3.relative;\r\n        var fixed = adt$3.fixed;\r\n        var anchor = Immutable('anchorBox', 'origin');\r\n        var box$1 = function (anchorBox, origin) {\r\n            return anchor(anchorBox, origin);\r\n        };\r\n        var adt$4 = Adt.generate([\r\n            { fit: ['reposition'] },\r\n            {\r\n                nofit: [\r\n                    'reposition',\r\n                    'deltaW',\r\n                    'deltaH'\r\n                ]\r\n            }\r\n        ]);\r\n        var attempt = function (candidate, width, height, bounds) {\r\n            var candidateX = candidate.x();\r\n            var candidateY = candidate.y();\r\n            var bubbleLeft = candidate.bubble().offset().left();\r\n            var bubbleTop = candidate.bubble().offset().top();\r\n            var boundsX = bounds.x();\r\n            var boundsY = bounds.y();\r\n            var boundsWidth = bounds.width();\r\n            var boundsHeight = bounds.height();\r\n            var newX = candidateX + bubbleLeft;\r\n            var newY = candidateY + bubbleTop;\r\n            var xInBounds = newX >= boundsX;\r\n            var yInBounds = newY >= boundsY;\r\n            var originInBounds = xInBounds && yInBounds;\r\n            var xFit = newX + width <= boundsX + boundsWidth;\r\n            var yFit = newY + height <= boundsY + boundsHeight;\r\n            var sizeInBounds = xFit && yFit;\r\n            var deltaW = xInBounds ? Math.min(width, boundsX + boundsWidth - newX) : Math.abs(boundsX - (newX + width));\r\n            var deltaH = yInBounds ? Math.min(height, boundsY + boundsHeight - newY) : Math.abs(boundsY - (newY + height));\r\n            var maxX = bounds.x() + bounds.width();\r\n            var minX = Math.max(bounds.x(), newX);\r\n            var limitX = Math.min(minX, maxX);\r\n            var limitY = yInBounds ? newY : newY + (height - deltaH);\r\n            var upAvailable = constant(limitY + deltaH - boundsY);\r\n            var downAvailable = constant(boundsY + boundsHeight - limitY);\r\n            var maxHeight = cataVertical(candidate.direction(), downAvailable, downAvailable, upAvailable);\r\n            var reposition = decision({\r\n                x: limitX,\r\n                y: limitY,\r\n                width: deltaW,\r\n                height: deltaH,\r\n                maxHeight: maxHeight,\r\n                direction: candidate.direction(),\r\n                classes: {\r\n                    on: candidate.bubble().classesOn(),\r\n                    off: candidate.bubble().classesOff()\r\n                },\r\n                label: candidate.label(),\r\n                candidateYforTest: newY\r\n            });\r\n            return originInBounds && sizeInBounds ? adt$4.fit(reposition) : adt$4.nofit(reposition, deltaW, deltaH);\r\n        };\r\n        var attempts = function (candidates, anchorBox, elementBox, bubbles, bounds) {\r\n            var panelWidth = elementBox.width();\r\n            var panelHeight = elementBox.height();\r\n            var attemptBestFit = function (layout, reposition, deltaW, deltaH) {\r\n                var next = layout(anchorBox, elementBox, bubbles);\r\n                var attemptLayout = attempt(next, panelWidth, panelHeight, bounds);\r\n                return attemptLayout.fold(adt$4.fit, function (newReposition, newDeltaW, newDeltaH) {\r\n                    var improved = newDeltaH > deltaH || newDeltaW > deltaW;\r\n                    return improved ? adt$4.nofit(newReposition, newDeltaW, newDeltaH) : adt$4.nofit(reposition, deltaW, deltaH);\r\n                });\r\n            };\r\n            var abc = foldl(candidates, function (b, a) {\r\n                var bestNext = curry(attemptBestFit, a);\r\n                return b.fold(adt$4.fit, bestNext);\r\n            }, adt$4.nofit(decision({\r\n                x: anchorBox.x(),\r\n                y: anchorBox.y(),\r\n                width: elementBox.width(),\r\n                height: elementBox.height(),\r\n                maxHeight: elementBox.height(),\r\n                direction: southeast(),\r\n                classes: [],\r\n                label: 'none',\r\n                candidateYforTest: anchorBox.y()\r\n            }), -1, -1));\r\n            return abc.fold(identity, identity);\r\n        };\r\n        var elementSize = function (p) {\r\n            return {\r\n                width: constant(getOuter$1(p)),\r\n                height: constant(getOuter$2(p))\r\n            };\r\n        };\r\n        var layout = function (anchorBox, element, bubbles, options) {\r\n            remove$6(element, 'max-height');\r\n            var elementBox = elementSize(element);\r\n            return attempts(options.preference(), anchorBox, elementBox, bubbles, options.bounds());\r\n        };\r\n        var setClasses = function (element, decision) {\r\n            var classInfo = decision.classes();\r\n            remove$5(element, classInfo.off);\r\n            add$3(element, classInfo.on);\r\n        };\r\n        var setHeight = function (element, decision, options) {\r\n            var maxHeightFunction = options.maxHeightFunction();\r\n            maxHeightFunction(element, decision.maxHeight());\r\n        };\r\n        var position = function (element, decision, options) {\r\n            var addPx = function (num) {\r\n                return num + 'px';\r\n            };\r\n            var newPosition = reposition(options.origin(), decision);\r\n            setOptions(element, {\r\n                position: Option.some(newPosition.position()),\r\n                left: newPosition.left().map(addPx),\r\n                top: newPosition.top().map(addPx),\r\n                right: newPosition.right().map(addPx),\r\n                bottom: newPosition.bottom().map(addPx)\r\n            });\r\n        };\r\n        var setMaxHeight = function (element, maxHeight) {\r\n            setMax(element, Math.floor(maxHeight));\r\n        };\r\n        var anchored = constant(function (element, available) {\r\n            setMaxHeight(element, available);\r\n            setAll$1(element, {\r\n                'overflow-x': 'hidden',\r\n                'overflow-y': 'auto'\r\n            });\r\n        });\r\n        var expandable = constant(function (element, available) {\r\n            setMaxHeight(element, available);\r\n        });\r\n        var reparteeOptions = MixedBag([\r\n            'bounds',\r\n            'origin',\r\n            'preference',\r\n            'maxHeightFunction'\r\n        ], []);\r\n        var defaultOr = function (options, key, dephault) {\r\n            return options[key] === undefined ? dephault : options[key];\r\n        };\r\n        var simple = function (anchor, element, bubble, layouts, getBounds, overrideOptions) {\r\n            var maxHeightFunction = defaultOr(overrideOptions, 'maxHeightFunction', anchored());\r\n            var anchorBox = anchor.anchorBox();\r\n            var origin = anchor.origin();\r\n            var options = reparteeOptions({\r\n                bounds: viewport$1(origin, getBounds),\r\n                origin: origin,\r\n                preference: layouts,\r\n                maxHeightFunction: maxHeightFunction\r\n            });\r\n            go(anchorBox, element, bubble, options);\r\n        };\r\n        var go = function (anchorBox, element, bubble, options) {\r\n            var decision = layout(anchorBox, element, bubble, options);\r\n            position(element, decision, options);\r\n            setClasses(element, decision);\r\n            setHeight(element, decision, options);\r\n        };\r\n        var allAlignments = [\r\n            'valignCentre',\r\n            'alignLeft',\r\n            'alignRight',\r\n            'alignCentre',\r\n            'top',\r\n            'bottom',\r\n            'left',\r\n            'right'\r\n        ];\r\n        var nu$7 = function (width, yoffset, classes) {\r\n            var getClasses = function (prop) {\r\n                return readOptFrom$1(classes, prop).getOr([]);\r\n            };\r\n            var make = function (xDelta, yDelta, alignmentsOn) {\r\n                var alignmentsOff = difference(allAlignments, alignmentsOn);\r\n                return {\r\n                    offset: function () {\r\n                        return Position(xDelta, yDelta);\r\n                    },\r\n                    classesOn: function () {\r\n                        return bind(alignmentsOn, getClasses);\r\n                    },\r\n                    classesOff: function () {\r\n                        return bind(alignmentsOff, getClasses);\r\n                    }\r\n                };\r\n            };\r\n            return {\r\n                southeast: function () {\r\n                    return make(-width, yoffset, [\r\n                        'top',\r\n                        'alignLeft'\r\n                    ]);\r\n                },\r\n                southwest: function () {\r\n                    return make(width, yoffset, [\r\n                        'top',\r\n                        'alignRight'\r\n                    ]);\r\n                },\r\n                south: function () {\r\n                    return make(-width / 2, yoffset, [\r\n                        'top',\r\n                        'alignCentre'\r\n                    ]);\r\n                },\r\n                northeast: function () {\r\n                    return make(-width, -yoffset, [\r\n                        'bottom',\r\n                        'alignLeft'\r\n                    ]);\r\n                },\r\n                northwest: function () {\r\n                    return make(width, -yoffset, [\r\n                        'bottom',\r\n                        'alignRight'\r\n                    ]);\r\n                },\r\n                north: function () {\r\n                    return make(-width / 2, -yoffset, [\r\n                        'bottom',\r\n                        'alignCentre'\r\n                    ]);\r\n                },\r\n                east: function () {\r\n                    return make(width, -yoffset / 2, [\r\n                        'valignCentre',\r\n                        'left'\r\n                    ]);\r\n                },\r\n                west: function () {\r\n                    return make(-width, -yoffset / 2, [\r\n                        'valignCentre',\r\n                        'right'\r\n                    ]);\r\n                }\r\n            };\r\n        };\r\n        var fallback = function () {\r\n            return nu$7(0, 0, {});\r\n        };\r\n        var nu$8 = Immutable('x', 'y', 'bubble', 'direction', 'label');\r\n        var eastX = function (anchor) {\r\n            return anchor.x();\r\n        };\r\n        var middleX = function (anchor, element) {\r\n            return anchor.x() + anchor.width() / 2 - element.width() / 2;\r\n        };\r\n        var westX = function (anchor, element) {\r\n            return anchor.x() + anchor.width() - element.width();\r\n        };\r\n        var northY = function (anchor, element) {\r\n            return anchor.y() - element.height();\r\n        };\r\n        var southY = function (anchor) {\r\n            return anchor.y() + anchor.height();\r\n        };\r\n        var centreY = function (anchor, element) {\r\n            return anchor.y() + anchor.height() / 2 - element.height() / 2;\r\n        };\r\n        var eastEdgeX = function (anchor) {\r\n            return anchor.x() + anchor.width();\r\n        };\r\n        var westEdgeX = function (anchor, element) {\r\n            return anchor.x() - element.width();\r\n        };\r\n        var southeast$1 = function (anchor, element, bubbles) {\r\n            return nu$8(eastX(anchor), southY(anchor), bubbles.southeast(), southeast(), 'layout-se');\r\n        };\r\n        var southwest$1 = function (anchor, element, bubbles) {\r\n            return nu$8(westX(anchor, element), southY(anchor), bubbles.southwest(), southwest(), 'layout-sw');\r\n        };\r\n        var northeast$1 = function (anchor, element, bubbles) {\r\n            return nu$8(eastX(anchor), northY(anchor, element), bubbles.northeast(), northeast(), 'layout-ne');\r\n        };\r\n        var northwest$1 = function (anchor, element, bubbles) {\r\n            return nu$8(westX(anchor, element), northY(anchor, element), bubbles.northwest(), northwest(), 'layout-nw');\r\n        };\r\n        var north$1 = function (anchor, element, bubbles) {\r\n            return nu$8(middleX(anchor, element), northY(anchor, element), bubbles.north(), north(), 'layout-n');\r\n        };\r\n        var south$1 = function (anchor, element, bubbles) {\r\n            return nu$8(middleX(anchor, element), southY(anchor), bubbles.south(), south(), 'layout-s');\r\n        };\r\n        var east$1 = function (anchor, element, bubbles) {\r\n            return nu$8(eastEdgeX(anchor), centreY(anchor, element), bubbles.east(), east(), 'layout-e');\r\n        };\r\n        var west$1 = function (anchor, element, bubbles) {\r\n            return nu$8(westEdgeX(anchor, element), centreY(anchor, element), bubbles.west(), west(), 'layout-w');\r\n        };\r\n        var all$2 = function () {\r\n            return [\r\n                southeast$1,\r\n                southwest$1,\r\n                northeast$1,\r\n                northwest$1,\r\n                south$1,\r\n                north$1,\r\n                east$1,\r\n                west$1\r\n            ];\r\n        };\r\n        var allRtl = function () {\r\n            return [\r\n                southwest$1,\r\n                southeast$1,\r\n                northwest$1,\r\n                northeast$1,\r\n                south$1,\r\n                north$1,\r\n                east$1,\r\n                west$1\r\n            ];\r\n        };\r\n        var nu$9 = function (x) {\r\n            return x;\r\n        };\r\n        var onDirection = function (isLtr, isRtl) {\r\n            return function (element) {\r\n                return getDirection(element) === 'rtl' ? isRtl : isLtr;\r\n            };\r\n        };\r\n        var getDirection = function (element) {\r\n            return get$4(element, 'direction') === 'rtl' ? 'rtl' : 'ltr';\r\n        };\r\n        var schema$1 = function () {\r\n            return optionObjOf('layouts', [\r\n                strict$1('onLtr'),\r\n                strict$1('onRtl')\r\n            ]);\r\n        };\r\n        var get$9 = function (elem, info, defaultLtr, defaultRtl) {\r\n            var ltr = info.layouts.map(function (ls) {\r\n                return ls.onLtr(elem);\r\n            }).getOr(defaultLtr);\r\n            var rtl = info.layouts.map(function (ls) {\r\n                return ls.onRtl(elem);\r\n            }).getOr(defaultRtl);\r\n            var f = onDirection(ltr, rtl);\r\n            return f(elem);\r\n        };\r\n        var placement = function (component, anchorInfo, origin) {\r\n            var hotspot = anchorInfo.hotspot;\r\n            var anchorBox = toBox(origin, hotspot.element());\r\n            var layouts = get$9(component.element(), anchorInfo, all$2(), allRtl());\r\n            return Option.some(nu$9({\r\n                anchorBox: anchorBox,\r\n                bubble: anchorInfo.bubble.getOr(fallback()),\r\n                overrides: anchorInfo.overrides,\r\n                layouts: layouts,\r\n                placer: Option.none()\r\n            }));\r\n        };\r\n        var HotspotAnchor = [\r\n            strict$1('hotspot'),\r\n            option('bubble'),\r\n            defaulted$1('overrides', {}),\r\n            schema$1(),\r\n            output('placement', placement)\r\n        ];\r\n        var placement$1 = function (component, anchorInfo, origin) {\r\n            var anchorBox = bounds(anchorInfo.x, anchorInfo.y, anchorInfo.width, anchorInfo.height);\r\n            var layouts = get$9(component.element(), anchorInfo, all$2(), allRtl());\r\n            return Option.some(nu$9({\r\n                anchorBox: anchorBox,\r\n                bubble: anchorInfo.bubble,\r\n                overrides: anchorInfo.overrides,\r\n                layouts: layouts,\r\n                placer: Option.none()\r\n            }));\r\n        };\r\n        var MakeshiftAnchor = [\r\n            strict$1('x'),\r\n            strict$1('y'),\r\n            defaulted$1('height', 0),\r\n            defaulted$1('width', 0),\r\n            defaulted$1('bubble', fallback()),\r\n            defaulted$1('overrides', {}),\r\n            schema$1(),\r\n            output('placement', placement$1)\r\n        ];\r\n        var zeroWidth = function () {\r\n            return '\\uFEFF';\r\n        };\r\n        var adt$5 = Adt.generate([\r\n            { before: ['element'] },\r\n            {\r\n                on: [\r\n                    'element',\r\n                    'offset'\r\n                ]\r\n            },\r\n            { after: ['element'] }\r\n        ]);\r\n        var type$1 = Adt.generate([\r\n            { domRange: ['rng'] },\r\n            {\r\n                relative: [\r\n                    'startSitu',\r\n                    'finishSitu'\r\n                ]\r\n            },\r\n            {\r\n                exact: [\r\n                    'start',\r\n                    'soffset',\r\n                    'finish',\r\n                    'foffset'\r\n                ]\r\n            }\r\n        ]);\r\n        var range$1 = Immutable('start', 'soffset', 'finish', 'foffset');\r\n        var exactFromRange = function (simRange) {\r\n            return type$1.exact(simRange.start(), simRange.soffset(), simRange.finish(), simRange.foffset());\r\n        };\r\n        var exact = type$1.exact;\r\n        var makeRange = function (start, soffset, finish, foffset) {\r\n            var doc = owner(start);\r\n            var rng = doc.dom().createRange();\r\n            rng.setStart(start.dom(), soffset);\r\n            rng.setEnd(finish.dom(), foffset);\r\n            return rng;\r\n        };\r\n        var after$1 = function (start, soffset, finish, foffset) {\r\n            var r = makeRange(start, soffset, finish, foffset);\r\n            var same = eq(start, finish) && soffset === foffset;\r\n            return r.collapsed && !same;\r\n        };\r\n        var setStart = function (rng, situ) {\r\n            situ.fold(function (e) {\r\n                rng.setStartBefore(e.dom());\r\n            }, function (e, o) {\r\n                rng.setStart(e.dom(), o);\r\n            }, function (e) {\r\n                rng.setStartAfter(e.dom());\r\n            });\r\n        };\r\n        var setFinish = function (rng, situ) {\r\n            situ.fold(function (e) {\r\n                rng.setEndBefore(e.dom());\r\n            }, function (e, o) {\r\n                rng.setEnd(e.dom(), o);\r\n            }, function (e) {\r\n                rng.setEndAfter(e.dom());\r\n            });\r\n        };\r\n        var relativeToNative = function (win, startSitu, finishSitu) {\r\n            var range = win.document.createRange();\r\n            setStart(range, startSitu);\r\n            setFinish(range, finishSitu);\r\n            return range;\r\n        };\r\n        var exactToNative = function (win, start, soffset, finish, foffset) {\r\n            var rng = win.document.createRange();\r\n            rng.setStart(start.dom(), soffset);\r\n            rng.setEnd(finish.dom(), foffset);\r\n            return rng;\r\n        };\r\n        var toRect = function (rect) {\r\n            return {\r\n                left: constant(rect.left),\r\n                top: constant(rect.top),\r\n                right: constant(rect.right),\r\n                bottom: constant(rect.bottom),\r\n                width: constant(rect.width),\r\n                height: constant(rect.height)\r\n            };\r\n        };\r\n        var getFirstRect = function (rng) {\r\n            var rects = rng.getClientRects();\r\n            var rect = rects.length > 0 ? rects[0] : rng.getBoundingClientRect();\r\n            return rect.width > 0 || rect.height > 0 ? Option.some(rect).map(toRect) : Option.none();\r\n        };\r\n        var adt$6 = Adt.generate([\r\n            {\r\n                ltr: [\r\n                    'start',\r\n                    'soffset',\r\n                    'finish',\r\n                    'foffset'\r\n                ]\r\n            },\r\n            {\r\n                rtl: [\r\n                    'start',\r\n                    'soffset',\r\n                    'finish',\r\n                    'foffset'\r\n                ]\r\n            }\r\n        ]);\r\n        var fromRange = function (win, type, range) {\r\n            return type(Element.fromDom(range.startContainer), range.startOffset, Element.fromDom(range.endContainer), range.endOffset);\r\n        };\r\n        var getRanges = function (win, selection) {\r\n            return selection.match({\r\n                domRange: function (rng) {\r\n                    return {\r\n                        ltr: constant(rng),\r\n                        rtl: Option.none\r\n                    };\r\n                },\r\n                relative: function (startSitu, finishSitu) {\r\n                    return {\r\n                        ltr: cached(function () {\r\n                            return relativeToNative(win, startSitu, finishSitu);\r\n                        }),\r\n                        rtl: cached(function () {\r\n                            return Option.some(relativeToNative(win, finishSitu, startSitu));\r\n                        })\r\n                    };\r\n                },\r\n                exact: function (start, soffset, finish, foffset) {\r\n                    return {\r\n                        ltr: cached(function () {\r\n                            return exactToNative(win, start, soffset, finish, foffset);\r\n                        }),\r\n                        rtl: cached(function () {\r\n                            return Option.some(exactToNative(win, finish, foffset, start, soffset));\r\n                        })\r\n                    };\r\n                }\r\n            });\r\n        };\r\n        var doDiagnose = function (win, ranges) {\r\n            var rng = ranges.ltr();\r\n            if (rng.collapsed) {\r\n                var reversed = ranges.rtl().filter(function (rev) {\r\n                    return rev.collapsed === false;\r\n                });\r\n                return reversed.map(function (rev) {\r\n                    return adt$6.rtl(Element.fromDom(rev.endContainer), rev.endOffset, Element.fromDom(rev.startContainer), rev.startOffset);\r\n                }).getOrThunk(function () {\r\n                    return fromRange(win, adt$6.ltr, rng);\r\n                });\r\n            }\r\n            else {\r\n                return fromRange(win, adt$6.ltr, rng);\r\n            }\r\n        };\r\n        var diagnose = function (win, selection) {\r\n            var ranges = getRanges(win, selection);\r\n            return doDiagnose(win, ranges);\r\n        };\r\n        var asLtrRange = function (win, selection) {\r\n            var diagnosis = diagnose(win, selection);\r\n            return diagnosis.match({\r\n                ltr: function (start, soffset, finish, foffset) {\r\n                    var rng = win.document.createRange();\r\n                    rng.setStart(start.dom(), soffset);\r\n                    rng.setEnd(finish.dom(), foffset);\r\n                    return rng;\r\n                },\r\n                rtl: function (start, soffset, finish, foffset) {\r\n                    var rng = win.document.createRange();\r\n                    rng.setStart(finish.dom(), foffset);\r\n                    rng.setEnd(start.dom(), soffset);\r\n                    return rng;\r\n                }\r\n            });\r\n        };\r\n        var searchForPoint = function (rectForOffset, x, y, maxX, length) {\r\n            if (length === 0) {\r\n                return 0;\r\n            }\r\n            else if (x === maxX) {\r\n                return length - 1;\r\n            }\r\n            var xDelta = maxX;\r\n            for (var i = 1; i < length; i++) {\r\n                var rect = rectForOffset(i);\r\n                var curDeltaX = Math.abs(x - rect.left);\r\n                if (y <= rect.bottom) {\r\n                    if (y < rect.top || curDeltaX > xDelta) {\r\n                        return i - 1;\r\n                    }\r\n                    else {\r\n                        xDelta = curDeltaX;\r\n                    }\r\n                }\r\n            }\r\n            return 0;\r\n        };\r\n        var inRect = function (rect, x, y) {\r\n            return x >= rect.left && x <= rect.right && y >= rect.top && y <= rect.bottom;\r\n        };\r\n        function NodeValue(is, name) {\r\n            var get = function (element) {\r\n                if (!is(element)) {\r\n                    throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\r\n                }\r\n                return getOption(element).getOr('');\r\n            };\r\n            var getOptionIE10 = function (element) {\r\n                try {\r\n                    return getOptionSafe(element);\r\n                }\r\n                catch (e) {\r\n                    return Option.none();\r\n                }\r\n            };\r\n            var getOptionSafe = function (element) {\r\n                return is(element) ? Option.from(element.dom().nodeValue) : Option.none();\r\n            };\r\n            var browser = PlatformDetection$1.detect().browser;\r\n            var getOption = browser.isIE() && browser.version.major === 10 ? getOptionIE10 : getOptionSafe;\r\n            var set = function (element, value) {\r\n                if (!is(element)) {\r\n                    throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\r\n                }\r\n                element.dom().nodeValue = value;\r\n            };\r\n            return {\r\n                get: get,\r\n                getOption: getOption,\r\n                set: set\r\n            };\r\n        }\r\n        var api$2 = NodeValue(isText, 'text');\r\n        var get$a = function (element) {\r\n            return api$2.get(element);\r\n        };\r\n        var getOption = function (element) {\r\n            return api$2.getOption(element);\r\n        };\r\n        var locateOffset = function (doc, textnode, x, y, rect) {\r\n            var rangeForOffset = function (o) {\r\n                var r = doc.dom().createRange();\r\n                r.setStart(textnode.dom(), o);\r\n                r.collapse(true);\r\n                return r;\r\n            };\r\n            var rectForOffset = function (o) {\r\n                var r = rangeForOffset(o);\r\n                return r.getBoundingClientRect();\r\n            };\r\n            var length = get$a(textnode).length;\r\n            var offset = searchForPoint(rectForOffset, x, y, rect.right, length);\r\n            return rangeForOffset(offset);\r\n        };\r\n        var locate = function (doc, node, x, y) {\r\n            var r = doc.dom().createRange();\r\n            r.selectNode(node.dom());\r\n            var rects = r.getClientRects();\r\n            var foundRect = findMap(rects, function (rect) {\r\n                return inRect(rect, x, y) ? Option.some(rect) : Option.none();\r\n            });\r\n            return foundRect.map(function (rect) {\r\n                return locateOffset(doc, node, x, y, rect);\r\n            });\r\n        };\r\n        var TextPoint = Object.freeze({\r\n            locate: locate\r\n        });\r\n        var searchInChildren = function (doc, node, x, y) {\r\n            var r = doc.dom().createRange();\r\n            var nodes = children(node);\r\n            return findMap(nodes, function (n) {\r\n                r.selectNode(n.dom());\r\n                return inRect(r.getBoundingClientRect(), x, y) ? locateNode(doc, n, x, y) : Option.none();\r\n            });\r\n        };\r\n        var locateNode = function (doc, node, x, y) {\r\n            var locator = isText(node) ? locate : searchInChildren;\r\n            return locator(doc, node, x, y);\r\n        };\r\n        var locate$1 = function (doc, node, x, y) {\r\n            var r = doc.dom().createRange();\r\n            r.selectNode(node.dom());\r\n            var rect = r.getBoundingClientRect();\r\n            var boundedX = Math.max(rect.left, Math.min(rect.right, x));\r\n            var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\r\n            return locateNode(doc, node, boundedX, boundedY);\r\n        };\r\n        var NBSP = '\\xA0';\r\n        var isTextNodeWithCursorPosition = function (el) {\r\n            return getOption(el).filter(function (text) {\r\n                return text.trim().length !== 0 || text.indexOf(NBSP) > -1;\r\n            }).isSome();\r\n        };\r\n        var elementsWithCursorPosition = [\r\n            'img',\r\n            'br'\r\n        ];\r\n        var isCursorPosition = function (elem) {\r\n            var hasCursorPosition = isTextNodeWithCursorPosition(elem);\r\n            return hasCursorPosition || contains(elementsWithCursorPosition, name(elem));\r\n        };\r\n        var first$2 = function (element) {\r\n            return descendant(element, isCursorPosition);\r\n        };\r\n        var last$1 = function (element) {\r\n            return descendantRtl(element, isCursorPosition);\r\n        };\r\n        var descendantRtl = function (scope, predicate) {\r\n            var descend = function (element) {\r\n                var children$1 = children(element);\r\n                for (var i = children$1.length - 1; i >= 0; i--) {\r\n                    var child = children$1[i];\r\n                    if (predicate(child)) {\r\n                        return Option.some(child);\r\n                    }\r\n                    var res = descend(child);\r\n                    if (res.isSome()) {\r\n                        return res;\r\n                    }\r\n                }\r\n                return Option.none();\r\n            };\r\n            return descend(scope);\r\n        };\r\n        var COLLAPSE_TO_LEFT = true;\r\n        var COLLAPSE_TO_RIGHT = false;\r\n        var getCollapseDirection = function (rect, x) {\r\n            return x - rect.left < rect.right - x ? COLLAPSE_TO_LEFT : COLLAPSE_TO_RIGHT;\r\n        };\r\n        var createCollapsedNode = function (doc, target, collapseDirection) {\r\n            var r = doc.dom().createRange();\r\n            r.selectNode(target.dom());\r\n            r.collapse(collapseDirection);\r\n            return r;\r\n        };\r\n        var locateInElement = function (doc, node, x) {\r\n            var cursorRange = doc.dom().createRange();\r\n            cursorRange.selectNode(node.dom());\r\n            var rect = cursorRange.getBoundingClientRect();\r\n            var collapseDirection = getCollapseDirection(rect, x);\r\n            var f = collapseDirection === COLLAPSE_TO_LEFT ? first$2 : last$1;\r\n            return f(node).map(function (target) {\r\n                return createCollapsedNode(doc, target, collapseDirection);\r\n            });\r\n        };\r\n        var locateInEmpty = function (doc, node, x) {\r\n            var rect = node.dom().getBoundingClientRect();\r\n            var collapseDirection = getCollapseDirection(rect, x);\r\n            return Option.some(createCollapsedNode(doc, node, collapseDirection));\r\n        };\r\n        var search = function (doc, node, x) {\r\n            var f = children(node).length === 0 ? locateInEmpty : locateInElement;\r\n            return f(doc, node, x);\r\n        };\r\n        var caretPositionFromPoint = function (doc, x, y) {\r\n            return Option.from(doc.dom().caretPositionFromPoint(x, y)).bind(function (pos) {\r\n                if (pos.offsetNode === null) {\r\n                    return Option.none();\r\n                }\r\n                var r = doc.dom().createRange();\r\n                r.setStart(pos.offsetNode, pos.offset);\r\n                r.collapse();\r\n                return Option.some(r);\r\n            });\r\n        };\r\n        var caretRangeFromPoint = function (doc, x, y) {\r\n            return Option.from(doc.dom().caretRangeFromPoint(x, y));\r\n        };\r\n        var searchTextNodes = function (doc, node, x, y) {\r\n            var r = doc.dom().createRange();\r\n            r.selectNode(node.dom());\r\n            var rect = r.getBoundingClientRect();\r\n            var boundedX = Math.max(rect.left, Math.min(rect.right, x));\r\n            var boundedY = Math.max(rect.top, Math.min(rect.bottom, y));\r\n            return locate$1(doc, node, boundedX, boundedY);\r\n        };\r\n        var searchFromPoint = function (doc, x, y) {\r\n            return Element.fromPoint(doc, x, y).bind(function (elem) {\r\n                var fallback = function () {\r\n                    return search(doc, elem, x);\r\n                };\r\n                return children(elem).length === 0 ? fallback() : searchTextNodes(doc, elem, x, y).orThunk(fallback);\r\n            });\r\n        };\r\n        var availableSearch = document.caretPositionFromPoint ? caretPositionFromPoint : document.caretRangeFromPoint ? caretRangeFromPoint : searchFromPoint;\r\n        var ancestors = function (scope, predicate, isRoot) {\r\n            return filter(parents(scope, isRoot), predicate);\r\n        };\r\n        var siblings$1 = function (scope, predicate) {\r\n            return filter(siblings(scope), predicate);\r\n        };\r\n        var children$1 = function (scope, predicate) {\r\n            return filter(children(scope), predicate);\r\n        };\r\n        var all$3 = function (selector) {\r\n            return all(selector);\r\n        };\r\n        var ancestors$1 = function (scope, selector, isRoot) {\r\n            return ancestors(scope, function (e) {\r\n                return is(e, selector);\r\n            }, isRoot);\r\n        };\r\n        var siblings$2 = function (scope, selector) {\r\n            return siblings$1(scope, function (e) {\r\n                return is(e, selector);\r\n            });\r\n        };\r\n        var children$2 = function (scope, selector) {\r\n            return children$1(scope, function (e) {\r\n                return is(e, selector);\r\n            });\r\n        };\r\n        var descendants = function (scope, selector) {\r\n            return all(selector, scope);\r\n        };\r\n        var SelectorFilter = Object.freeze({\r\n            all: all$3,\r\n            ancestors: ancestors$1,\r\n            siblings: siblings$2,\r\n            children: children$2,\r\n            descendants: descendants\r\n        });\r\n        var readRange = function (selection) {\r\n            if (selection.rangeCount > 0) {\r\n                var firstRng = selection.getRangeAt(0);\r\n                var lastRng = selection.getRangeAt(selection.rangeCount - 1);\r\n                return Option.some(range$1(Element.fromDom(firstRng.startContainer), firstRng.startOffset, Element.fromDom(lastRng.endContainer), lastRng.endOffset));\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var doGetExact = function (selection) {\r\n            var anchor = Element.fromDom(selection.anchorNode);\r\n            var focus = Element.fromDom(selection.focusNode);\r\n            return after$1(anchor, selection.anchorOffset, focus, selection.focusOffset) ? Option.some(range$1(anchor, selection.anchorOffset, focus, selection.focusOffset)) : readRange(selection);\r\n        };\r\n        var getExact = function (win) {\r\n            return Option.from(win.getSelection()).filter(function (sel) {\r\n                return sel.rangeCount > 0;\r\n            }).bind(doGetExact);\r\n        };\r\n        var getFirstRect$1 = function (win, selection) {\r\n            var rng = asLtrRange(win, selection);\r\n            return getFirstRect(rng);\r\n        };\r\n        var point = Immutable('element', 'offset');\r\n        var descendOnce = function (element, offset) {\r\n            var children$1 = children(element);\r\n            if (children$1.length === 0) {\r\n                return point(element, offset);\r\n            }\r\n            else if (offset < children$1.length) {\r\n                return point(children$1[offset], 0);\r\n            }\r\n            else {\r\n                var last = children$1[children$1.length - 1];\r\n                var len = isText(last) ? get$a(last).length : children(last).length;\r\n                return point(last, len);\r\n            }\r\n        };\r\n        var adt$7 = Adt.generate([\r\n            { screen: ['point'] },\r\n            {\r\n                absolute: [\r\n                    'point',\r\n                    'scrollLeft',\r\n                    'scrollTop'\r\n                ]\r\n            }\r\n        ]);\r\n        var toFixed = function (pos) {\r\n            return pos.fold(function (point) {\r\n                return point;\r\n            }, function (point, scrollLeft, scrollTop) {\r\n                return point.translate(-scrollLeft, -scrollTop);\r\n            });\r\n        };\r\n        var toAbsolute = function (pos) {\r\n            return pos.fold(function (point) {\r\n                return point;\r\n            }, function (point, scrollLeft, scrollTop) {\r\n                return point;\r\n            });\r\n        };\r\n        var sum = function (points) {\r\n            return foldl(points, function (b, a) {\r\n                return b.translate(a.left(), a.top());\r\n            }, Position(0, 0));\r\n        };\r\n        var sumAsFixed = function (positions) {\r\n            var points = map(positions, toFixed);\r\n            return sum(points);\r\n        };\r\n        var sumAsAbsolute = function (positions) {\r\n            var points = map(positions, toAbsolute);\r\n            return sum(points);\r\n        };\r\n        var screen = adt$7.screen;\r\n        var absolute$1 = adt$7.absolute;\r\n        var getOffset = function (component, origin, anchorInfo) {\r\n            var win = defaultView(anchorInfo.root).dom();\r\n            var hasSameOwner = function (frame) {\r\n                var frameOwner = owner(frame);\r\n                var compOwner = owner(component.element());\r\n                return eq(frameOwner, compOwner);\r\n            };\r\n            return Option.from(win.frameElement).map(Element.fromDom).filter(hasSameOwner).map(absolute);\r\n        };\r\n        var getRootPoint = function (component, origin, anchorInfo) {\r\n            var doc = owner(component.element());\r\n            var outerScroll = get$6(doc);\r\n            var offset = getOffset(component, origin, anchorInfo).getOr(outerScroll);\r\n            return absolute$1(offset, outerScroll.left(), outerScroll.top());\r\n        };\r\n        var capRect = function (left, top, width, height) {\r\n            var newLeft = left, newTop = top, newWidth = width, newHeight = height;\r\n            if (left < 0) {\r\n                newLeft = 0;\r\n                newWidth = width + left;\r\n            }\r\n            if (top < 0) {\r\n                newTop = 0;\r\n                newHeight = height + top;\r\n            }\r\n            var point = screen(Position(newLeft, newTop));\r\n            return Option.some(pointed(point, newWidth, newHeight));\r\n        };\r\n        var calcNewAnchor = function (optBox, rootPoint, anchorInfo, origin, elem) {\r\n            return optBox.map(function (box) {\r\n                var points = [\r\n                    rootPoint,\r\n                    box.point()\r\n                ];\r\n                var topLeft = cata$1(origin, function () {\r\n                    return sumAsAbsolute(points);\r\n                }, function () {\r\n                    return sumAsAbsolute(points);\r\n                }, function () {\r\n                    return sumAsFixed(points);\r\n                });\r\n                var anchorBox = rect(topLeft.left(), topLeft.top(), box.width(), box.height());\r\n                var layoutsLtr = function () {\r\n                    return anchorInfo.showAbove ? [\r\n                        northeast$1,\r\n                        northwest$1,\r\n                        southeast$1,\r\n                        southwest$1,\r\n                        north$1,\r\n                        south$1\r\n                    ] : [\r\n                        southeast$1,\r\n                        southwest$1,\r\n                        northeast$1,\r\n                        northwest$1,\r\n                        south$1,\r\n                        south$1\r\n                    ];\r\n                };\r\n                var layoutsRtl = function () {\r\n                    return anchorInfo.showAbove ? [\r\n                        northwest$1,\r\n                        northeast$1,\r\n                        southwest$1,\r\n                        southeast$1,\r\n                        north$1,\r\n                        south$1\r\n                    ] : [\r\n                        southwest$1,\r\n                        southeast$1,\r\n                        northwest$1,\r\n                        northeast$1,\r\n                        south$1,\r\n                        north$1\r\n                    ];\r\n                };\r\n                var layouts = get$9(elem, anchorInfo, layoutsLtr(), layoutsRtl());\r\n                return nu$9({\r\n                    anchorBox: anchorBox,\r\n                    bubble: anchorInfo.bubble.getOr(fallback()),\r\n                    overrides: anchorInfo.overrides,\r\n                    layouts: layouts,\r\n                    placer: Option.none()\r\n                });\r\n            });\r\n        };\r\n        var ContentAnchorCommon = {\r\n            capRect: capRect,\r\n            calcNewAnchor: calcNewAnchor\r\n        };\r\n        var point$1 = Immutable('element', 'offset');\r\n        var descendOnce$1 = function (element, offset) {\r\n            return isText(element) ? point$1(element, offset) : descendOnce(element, offset);\r\n        };\r\n        var getAnchorSelection = function (win, anchorInfo) {\r\n            var getSelection = anchorInfo.getSelection.getOrThunk(function () {\r\n                return function () {\r\n                    return getExact(win);\r\n                };\r\n            });\r\n            return getSelection().map(function (sel) {\r\n                var modStart = descendOnce$1(sel.start(), sel.soffset());\r\n                var modFinish = descendOnce$1(sel.finish(), sel.foffset());\r\n                return range$1(modStart.element(), modStart.offset(), modFinish.element(), modFinish.offset());\r\n            });\r\n        };\r\n        var placement$2 = function (component, anchorInfo, origin) {\r\n            var win = defaultView(anchorInfo.root).dom();\r\n            var rootPoint = getRootPoint(component, origin, anchorInfo);\r\n            var selectionBox = getAnchorSelection(win, anchorInfo).bind(function (sel) {\r\n                var optRect = getFirstRect$1(win, exactFromRange(sel)).orThunk(function () {\r\n                    var x = Element.fromText(zeroWidth());\r\n                    before(sel.start(), x);\r\n                    return getFirstRect$1(win, exact(x, 0, x, 1)).map(function (rect) {\r\n                        remove(x);\r\n                        return rect;\r\n                    });\r\n                });\r\n                return optRect.bind(function (rawRect) {\r\n                    return ContentAnchorCommon.capRect(rawRect.left(), rawRect.top(), rawRect.width(), rawRect.height());\r\n                });\r\n            });\r\n            var targetElement = getAnchorSelection(win, anchorInfo).bind(function (sel) {\r\n                return isElement(sel.start()) ? Option.some(sel.start()) : parent(sel.start());\r\n            });\r\n            var elem = targetElement.getOr(component.element());\r\n            return ContentAnchorCommon.calcNewAnchor(selectionBox, rootPoint, anchorInfo, origin, elem);\r\n        };\r\n        var SelectionAnchor = [\r\n            option('getSelection'),\r\n            strict$1('root'),\r\n            option('bubble'),\r\n            schema$1(),\r\n            defaulted$1('overrides', {}),\r\n            defaulted$1('showAbove', false),\r\n            output('placement', placement$2)\r\n        ];\r\n        var placement$3 = function (component, anchorInfo, origin) {\r\n            var rootPoint = getRootPoint(component, origin, anchorInfo);\r\n            return anchorInfo.node.bind(function (target) {\r\n                var rect = target.dom().getBoundingClientRect();\r\n                var nodeBox = ContentAnchorCommon.capRect(rect.left, rect.top, rect.width, rect.height);\r\n                var elem = anchorInfo.node.getOr(component.element());\r\n                return ContentAnchorCommon.calcNewAnchor(nodeBox, rootPoint, anchorInfo, origin, elem);\r\n            });\r\n        };\r\n        var NodeAnchor = [\r\n            strict$1('node'),\r\n            strict$1('root'),\r\n            option('bubble'),\r\n            schema$1(),\r\n            defaulted$1('overrides', {}),\r\n            defaulted$1('showAbove', false),\r\n            output('placement', placement$3)\r\n        ];\r\n        var eastX$1 = function (anchor) {\r\n            return anchor.x() + anchor.width();\r\n        };\r\n        var westX$1 = function (anchor, element) {\r\n            return anchor.x() - element.width();\r\n        };\r\n        var northY$1 = function (anchor, element) {\r\n            return anchor.y() - element.height() + anchor.height();\r\n        };\r\n        var southY$1 = function (anchor) {\r\n            return anchor.y();\r\n        };\r\n        var southeast$2 = function (anchor, element, bubbles) {\r\n            return nu$8(eastX$1(anchor), southY$1(anchor), bubbles.southeast(), southeast(), 'link-layout-se');\r\n        };\r\n        var southwest$2 = function (anchor, element, bubbles) {\r\n            return nu$8(westX$1(anchor, element), southY$1(anchor), bubbles.southwest(), southwest(), 'link-layout-sw');\r\n        };\r\n        var northeast$2 = function (anchor, element, bubbles) {\r\n            return nu$8(eastX$1(anchor), northY$1(anchor, element), bubbles.northeast(), northeast(), 'link-layout-ne');\r\n        };\r\n        var northwest$2 = function (anchor, element, bubbles) {\r\n            return nu$8(westX$1(anchor, element), northY$1(anchor, element), bubbles.northwest(), northwest(), 'link-layout-nw');\r\n        };\r\n        var all$4 = function () {\r\n            return [\r\n                southeast$2,\r\n                southwest$2,\r\n                northeast$2,\r\n                northwest$2\r\n            ];\r\n        };\r\n        var allRtl$1 = function () {\r\n            return [\r\n                southwest$2,\r\n                southeast$2,\r\n                northwest$2,\r\n                northeast$2\r\n            ];\r\n        };\r\n        var placement$4 = function (component, submenuInfo, origin) {\r\n            var anchorBox = toBox(origin, submenuInfo.item.element());\r\n            var layouts = get$9(component.element(), submenuInfo, all$4(), allRtl$1());\r\n            return Option.some(nu$9({\r\n                anchorBox: anchorBox,\r\n                bubble: fallback(),\r\n                overrides: submenuInfo.overrides,\r\n                layouts: layouts,\r\n                placer: Option.none()\r\n            }));\r\n        };\r\n        var SubmenuAnchor = [\r\n            strict$1('item'),\r\n            schema$1(),\r\n            defaulted$1('overrides', {}),\r\n            output('placement', placement$4)\r\n        ];\r\n        var AnchorSchema = choose$1('anchor', {\r\n            selection: SelectionAnchor,\r\n            node: NodeAnchor,\r\n            hotspot: HotspotAnchor,\r\n            submenu: SubmenuAnchor,\r\n            makeshift: MakeshiftAnchor\r\n        });\r\n        var getFixedOrigin = function () {\r\n            return fixed(0, 0, domGlobals.window.innerWidth, domGlobals.window.innerHeight);\r\n        };\r\n        var getRelativeOrigin = function (component) {\r\n            var position = absolute(component.element());\r\n            var bounds = component.element().dom().getBoundingClientRect();\r\n            return relative(position.left(), position.top(), bounds.width, bounds.height);\r\n        };\r\n        var place = function (component, origin, anchoring, getBounds, placee) {\r\n            var anchor = box$1(anchoring.anchorBox, origin);\r\n            simple(anchor, placee.element(), anchoring.bubble, anchoring.layouts, getBounds, anchoring.overrides);\r\n        };\r\n        var position$1 = function (component, posConfig, posState, anchor, placee) {\r\n            var boxElement = Option.none();\r\n            positionWithin(component, posConfig, posState, anchor, placee, boxElement);\r\n        };\r\n        var positionWithin = function (component, posConfig, posState, anchor, placee, boxElement) {\r\n            var anchorage = asRawOrDie('positioning anchor.info', AnchorSchema, anchor);\r\n            set$2(placee.element(), 'position', 'fixed');\r\n            var oldVisibility = getRaw(placee.element(), 'visibility');\r\n            set$2(placee.element(), 'visibility', 'hidden');\r\n            var origin = posConfig.useFixed ? getFixedOrigin() : getRelativeOrigin(component);\r\n            var placer = anchorage.placement;\r\n            var getBounds = boxElement.map(function (boxElem) {\r\n                return function () {\r\n                    return box(boxElem);\r\n                };\r\n            }).or(posConfig.getBounds);\r\n            placer(component, anchorage, origin).each(function (anchoring) {\r\n                var doPlace = anchoring.placer.getOr(place);\r\n                doPlace(component, origin, anchoring, getBounds, placee);\r\n            });\r\n            oldVisibility.fold(function () {\r\n                remove$6(placee.element(), 'visibility');\r\n            }, function (vis) {\r\n                set$2(placee.element(), 'visibility', vis);\r\n            });\r\n            if (getRaw(placee.element(), 'left').isNone() && getRaw(placee.element(), 'top').isNone() && getRaw(placee.element(), 'right').isNone() && getRaw(placee.element(), 'bottom').isNone() && getRaw(placee.element(), 'position').is('fixed')) {\r\n                remove$6(placee.element(), 'position');\r\n            }\r\n        };\r\n        var getMode = function (component, pConfig, pState) {\r\n            return pConfig.useFixed ? 'fixed' : 'absolute';\r\n        };\r\n        var PositionApis = Object.freeze({\r\n            position: position$1,\r\n            positionWithin: positionWithin,\r\n            getMode: getMode\r\n        });\r\n        var PositionSchema = [\r\n            defaulted$1('useFixed', false),\r\n            option('getBounds')\r\n        ];\r\n        var Positioning = create$1({\r\n            fields: PositionSchema,\r\n            name: 'positioning',\r\n            active: ActivePosition,\r\n            apis: PositionApis\r\n        });\r\n        var fireDetaching = function (component) {\r\n            emit(component, detachedFromDom());\r\n            var children = component.components();\r\n            each(children, fireDetaching);\r\n        };\r\n        var fireAttaching = function (component) {\r\n            var children = component.components();\r\n            each(children, fireAttaching);\r\n            emit(component, attachedToDom());\r\n        };\r\n        var attach = function (parent, child) {\r\n            attachWith(parent, child, append);\r\n        };\r\n        var attachWith = function (parent, child, insertion) {\r\n            parent.getSystem().addToWorld(child);\r\n            insertion(parent.element(), child.element());\r\n            if (inBody(parent.element())) {\r\n                fireAttaching(child);\r\n            }\r\n            parent.syncComponents();\r\n        };\r\n        var doDetach = function (component) {\r\n            fireDetaching(component);\r\n            remove(component.element());\r\n            component.getSystem().removeFromWorld(component);\r\n        };\r\n        var detach = function (component) {\r\n            var parent$1 = parent(component.element()).bind(function (p) {\r\n                return component.getSystem().getByDom(p).fold(Option.none, Option.some);\r\n            });\r\n            doDetach(component);\r\n            parent$1.each(function (p) {\r\n                p.syncComponents();\r\n            });\r\n        };\r\n        var detachChildren = function (component) {\r\n            var subs = component.components();\r\n            each(subs, doDetach);\r\n            empty(component.element());\r\n            component.syncComponents();\r\n        };\r\n        var attachSystem = function (element, guiSystem) {\r\n            attachSystemInternal(element, guiSystem, append);\r\n        };\r\n        var attachSystemAfter = function (element, guiSystem) {\r\n            attachSystemInternal(element, guiSystem, after);\r\n        };\r\n        var attachSystemInternal = function (element, guiSystem, inserter) {\r\n            inserter(element, guiSystem.element());\r\n            var children$1 = children(guiSystem.element());\r\n            each(children$1, function (child) {\r\n                guiSystem.getByDom(child).each(fireAttaching);\r\n            });\r\n        };\r\n        var detachSystem = function (guiSystem) {\r\n            var children$1 = children(guiSystem.element());\r\n            each(children$1, function (child) {\r\n                guiSystem.getByDom(child).each(fireDetaching);\r\n            });\r\n            remove(guiSystem.element());\r\n        };\r\n        var rebuild = function (sandbox, sConfig, sState, data) {\r\n            sState.get().each(function (data) {\r\n                detachChildren(sandbox);\r\n            });\r\n            var point = sConfig.getAttachPoint(sandbox);\r\n            attach(point, sandbox);\r\n            var built = sandbox.getSystem().build(data);\r\n            attach(sandbox, built);\r\n            sState.set(built);\r\n            return built;\r\n        };\r\n        var open = function (sandbox, sConfig, sState, data) {\r\n            var newState = rebuild(sandbox, sConfig, sState, data);\r\n            sConfig.onOpen(sandbox, newState);\r\n            return newState;\r\n        };\r\n        var openWhileCloaked = function (sandbox, sConfig, sState, data, transaction) {\r\n            cloak(sandbox, sConfig, sState);\r\n            open(sandbox, sConfig, sState, data);\r\n            transaction();\r\n            decloak(sandbox, sConfig, sState);\r\n        };\r\n        var close = function (sandbox, sConfig, sState) {\r\n            sState.get().each(function (data) {\r\n                detachChildren(sandbox);\r\n                detach(sandbox);\r\n                sConfig.onClose(sandbox, data);\r\n                sState.clear();\r\n            });\r\n        };\r\n        var isOpen = function (sandbox, sConfig, sState) {\r\n            return sState.isOpen();\r\n        };\r\n        var isPartOf$1 = function (sandbox, sConfig, sState, queryElem) {\r\n            return isOpen(sandbox, sConfig, sState) && sState.get().exists(function (data) {\r\n                return sConfig.isPartOf(sandbox, data, queryElem);\r\n            });\r\n        };\r\n        var getState = function (sandbox, sConfig, sState) {\r\n            return sState.get();\r\n        };\r\n        var store = function (sandbox, cssKey, attr, newValue) {\r\n            getRaw(sandbox.element(), cssKey).fold(function () {\r\n                remove$1(sandbox.element(), attr);\r\n            }, function (v) {\r\n                set$1(sandbox.element(), attr, v);\r\n            });\r\n            set$2(sandbox.element(), cssKey, newValue);\r\n        };\r\n        var restore = function (sandbox, cssKey, attr) {\r\n            if (has$1(sandbox.element(), attr)) {\r\n                var oldValue = get$2(sandbox.element(), attr);\r\n                set$2(sandbox.element(), cssKey, oldValue);\r\n            }\r\n            else {\r\n                remove$6(sandbox.element(), cssKey);\r\n            }\r\n        };\r\n        var cloak = function (sandbox, sConfig, sState) {\r\n            var sink = sConfig.getAttachPoint(sandbox);\r\n            set$2(sandbox.element(), 'position', Positioning.getMode(sink));\r\n            store(sandbox, 'visibility', sConfig.cloakVisibilityAttr, 'hidden');\r\n        };\r\n        var hasPosition = function (element) {\r\n            return exists([\r\n                'top',\r\n                'left',\r\n                'right',\r\n                'bottom'\r\n            ], function (pos) {\r\n                return getRaw(element, pos).isSome();\r\n            });\r\n        };\r\n        var decloak = function (sandbox, sConfig, sState) {\r\n            if (!hasPosition(sandbox.element())) {\r\n                remove$6(sandbox.element(), 'position');\r\n            }\r\n            restore(sandbox, 'visibility', sConfig.cloakVisibilityAttr);\r\n        };\r\n        var SandboxApis = Object.freeze({\r\n            cloak: cloak,\r\n            decloak: decloak,\r\n            open: open,\r\n            openWhileCloaked: openWhileCloaked,\r\n            close: close,\r\n            isOpen: isOpen,\r\n            isPartOf: isPartOf$1,\r\n            getState: getState\r\n        });\r\n        var events$2 = function (sandboxConfig, sandboxState) {\r\n            return derive([run(sandboxClose(), function (sandbox, simulatedEvent) {\r\n                    close(sandbox, sandboxConfig, sandboxState);\r\n                })]);\r\n        };\r\n        var ActiveSandbox = Object.freeze({\r\n            events: events$2\r\n        });\r\n        var SandboxSchema = [\r\n            onHandler('onOpen'),\r\n            onHandler('onClose'),\r\n            strict$1('isPartOf'),\r\n            strict$1('getAttachPoint'),\r\n            defaulted$1('cloakVisibilityAttr', 'data-precloak-visibility')\r\n        ];\r\n        var init = function () {\r\n            var contents = Cell(Option.none());\r\n            var readState = constant('not-implemented');\r\n            var isOpen = function () {\r\n                return contents.get().isSome();\r\n            };\r\n            var set = function (c) {\r\n                contents.set(Option.some(c));\r\n            };\r\n            var get = function (c) {\r\n                return contents.get();\r\n            };\r\n            var clear = function () {\r\n                contents.set(Option.none());\r\n            };\r\n            return nu$5({\r\n                readState: readState,\r\n                isOpen: isOpen,\r\n                clear: clear,\r\n                set: set,\r\n                get: get\r\n            });\r\n        };\r\n        var SandboxState = Object.freeze({\r\n            init: init\r\n        });\r\n        var Sandboxing = create$1({\r\n            fields: SandboxSchema,\r\n            name: 'sandboxing',\r\n            active: ActiveSandbox,\r\n            apis: SandboxApis,\r\n            state: SandboxState\r\n        });\r\n        var dismissPopups = constant('dismiss.popups');\r\n        var mouseReleased = constant('mouse.released');\r\n        var schema$2 = objOfOnly([\r\n            defaulted$1('isExtraPart', constant(false)),\r\n            optionObjOf('fireEventInstead', [defaulted$1('event', dismissRequested())])\r\n        ]);\r\n        var receivingConfig = function (rawSpec) {\r\n            var c = receiving(rawSpec);\r\n            return Receiving.config(c);\r\n        };\r\n        var receiving = function (rawSpec) {\r\n            var spec = asRawOrDie('Dismissal', schema$2, rawSpec);\r\n            return {\r\n                channels: wrap$1(dismissPopups(), {\r\n                    schema: objOfOnly([strict$1('target')]),\r\n                    onReceive: function (sandbox, data) {\r\n                        if (Sandboxing.isOpen(sandbox)) {\r\n                            var isPart = Sandboxing.isPartOf(sandbox, data.target) || spec.isExtraPart(sandbox, data.target);\r\n                            if (!isPart) {\r\n                                spec.fireEventInstead.fold(function () {\r\n                                    return Sandboxing.close(sandbox);\r\n                                }, function (fe) {\r\n                                    return emit(sandbox, fe.event);\r\n                                });\r\n                            }\r\n                        }\r\n                    }\r\n                })\r\n            };\r\n        };\r\n        var field$1 = function (name, forbidden) {\r\n            return defaultedObjOf(name, {}, map(forbidden, function (f) {\r\n                return forbid(f.name(), 'Cannot configure ' + f.name() + ' for ' + name);\r\n            }).concat([state$1('dump', identity)]));\r\n        };\r\n        var get$b = function (data) {\r\n            return data.dump;\r\n        };\r\n        var augment = function (data, original) {\r\n            return __assign({}, data.dump, derive$1(original));\r\n        };\r\n        var SketchBehaviours = {\r\n            field: field$1,\r\n            augment: augment,\r\n            get: get$b\r\n        };\r\n        var SketchBehaviours$1 = Object.freeze({\r\n            SketchBehaviours: SketchBehaviours,\r\n            field: field$1,\r\n            get: get$b,\r\n            augment: augment\r\n        });\r\n        var _placeholder = 'placeholder';\r\n        var adt$8 = Adt.generate([\r\n            {\r\n                single: [\r\n                    'required',\r\n                    'valueThunk'\r\n                ]\r\n            },\r\n            {\r\n                multiple: [\r\n                    'required',\r\n                    'valueThunks'\r\n                ]\r\n            }\r\n        ]);\r\n        var isSubstitute = function (uiType) {\r\n            return contains([_placeholder], uiType);\r\n        };\r\n        var subPlaceholder = function (owner, detail, compSpec, placeholders) {\r\n            if (owner.exists(function (o) {\r\n                return o !== compSpec.owner;\r\n            })) {\r\n                return adt$8.single(true, constant(compSpec));\r\n            }\r\n            return readOptFrom$1(placeholders, compSpec.name).fold(function () {\r\n                throw new Error('Unknown placeholder component: ' + compSpec.name + '\\nKnown: [' + keys(placeholders) + ']\\nNamespace: ' + owner.getOr('none') + '\\nSpec: ' + Json.stringify(compSpec, null, 2));\r\n            }, function (newSpec) {\r\n                return newSpec.replace();\r\n            });\r\n        };\r\n        var scan = function (owner, detail, compSpec, placeholders) {\r\n            if (compSpec.uiType === _placeholder) {\r\n                return subPlaceholder(owner, detail, compSpec, placeholders);\r\n            }\r\n            else {\r\n                return adt$8.single(false, constant(compSpec));\r\n            }\r\n        };\r\n        var substitute = function (owner, detail, compSpec, placeholders) {\r\n            var base = scan(owner, detail, compSpec, placeholders);\r\n            return base.fold(function (req, valueThunk) {\r\n                var value = valueThunk(detail, compSpec.config, compSpec.validated);\r\n                var childSpecs = readOptFrom$1(value, 'components').getOr([]);\r\n                var substituted = bind(childSpecs, function (c) {\r\n                    return substitute(owner, detail, c, placeholders);\r\n                });\r\n                return [__assign({}, value, { components: substituted })];\r\n            }, function (req, valuesThunk) {\r\n                var values = valuesThunk(detail, compSpec.config, compSpec.validated);\r\n                var preprocessor = compSpec.validated.preprocess.getOr(identity);\r\n                return preprocessor(values);\r\n            });\r\n        };\r\n        var substituteAll = function (owner, detail, components, placeholders) {\r\n            return bind(components, function (c) {\r\n                return substitute(owner, detail, c, placeholders);\r\n            });\r\n        };\r\n        var oneReplace = function (label, replacements) {\r\n            var called = false;\r\n            var used = function () {\r\n                return called;\r\n            };\r\n            var replace = function () {\r\n                if (called === true) {\r\n                    throw new Error('Trying to use the same placeholder more than once: ' + label);\r\n                }\r\n                called = true;\r\n                return replacements;\r\n            };\r\n            var required = function () {\r\n                return replacements.fold(function (req, _) {\r\n                    return req;\r\n                }, function (req, _) {\r\n                    return req;\r\n                });\r\n            };\r\n            return {\r\n                name: constant(label),\r\n                required: required,\r\n                used: used,\r\n                replace: replace\r\n            };\r\n        };\r\n        var substitutePlaces = function (owner, detail, components, placeholders) {\r\n            var ps = map$1(placeholders, function (ph, name) {\r\n                return oneReplace(name, ph);\r\n            });\r\n            var outcome = substituteAll(owner, detail, components, ps);\r\n            each$1(ps, function (p) {\r\n                if (p.used() === false && p.required()) {\r\n                    throw new Error('Placeholder: ' + p.name() + ' was not found in components list\\nNamespace: ' + owner.getOr('none') + '\\nComponents: ' + Json.stringify(detail.components, null, 2));\r\n                }\r\n            });\r\n            return outcome;\r\n        };\r\n        var singleReplace = function (detail, p) {\r\n            var replacement = p;\r\n            return replacement.fold(function (req, valueThunk) {\r\n                return [valueThunk(detail)];\r\n            }, function (req, valuesThunk) {\r\n                return valuesThunk(detail);\r\n            });\r\n        };\r\n        var single = adt$8.single;\r\n        var multiple = adt$8.multiple;\r\n        var placeholder = constant(_placeholder);\r\n        var UiSubstitutes = Object.freeze({\r\n            single: single,\r\n            multiple: multiple,\r\n            isSubstitute: isSubstitute,\r\n            placeholder: placeholder,\r\n            substituteAll: substituteAll,\r\n            substitutePlaces: substitutePlaces,\r\n            singleReplace: singleReplace\r\n        });\r\n        var adt$9 = Adt.generate([\r\n            { required: ['data'] },\r\n            { external: ['data'] },\r\n            { optional: ['data'] },\r\n            { group: ['data'] }\r\n        ]);\r\n        var fFactory = defaulted$1('factory', { sketch: identity });\r\n        var fSchema = defaulted$1('schema', []);\r\n        var fName = strict$1('name');\r\n        var fPname = field('pname', 'pname', defaultedThunk(function (typeSpec) {\r\n            return '<alloy.' + generate$1(typeSpec.name) + '>';\r\n        }), anyValue$1());\r\n        var fGroupSchema = state$1('schema', function () {\r\n            return [option('preprocess')];\r\n        });\r\n        var fDefaults = defaulted$1('defaults', constant({}));\r\n        var fOverrides = defaulted$1('overrides', constant({}));\r\n        var requiredSpec = objOf([\r\n            fFactory,\r\n            fSchema,\r\n            fName,\r\n            fPname,\r\n            fDefaults,\r\n            fOverrides\r\n        ]);\r\n        var externalSpec = objOf([\r\n            fFactory,\r\n            fSchema,\r\n            fName,\r\n            fDefaults,\r\n            fOverrides\r\n        ]);\r\n        var optionalSpec = objOf([\r\n            fFactory,\r\n            fSchema,\r\n            fName,\r\n            fPname,\r\n            fDefaults,\r\n            fOverrides\r\n        ]);\r\n        var groupSpec = objOf([\r\n            fFactory,\r\n            fGroupSchema,\r\n            fName,\r\n            strict$1('unit'),\r\n            fPname,\r\n            fDefaults,\r\n            fOverrides\r\n        ]);\r\n        var asNamedPart = function (part) {\r\n            return part.fold(Option.some, Option.none, Option.some, Option.some);\r\n        };\r\n        var name$1 = function (part) {\r\n            var get = function (data) {\r\n                return data.name;\r\n            };\r\n            return part.fold(get, get, get, get);\r\n        };\r\n        var asCommon = function (part) {\r\n            return part.fold(identity, identity, identity, identity);\r\n        };\r\n        var convert = function (adtConstructor, partSchema) {\r\n            return function (spec) {\r\n                var data = asRawOrDie('Converting part type', partSchema, spec);\r\n                return adtConstructor(data);\r\n            };\r\n        };\r\n        var required = convert(adt$9.required, requiredSpec);\r\n        var external$1 = convert(adt$9.external, externalSpec);\r\n        var optional = convert(adt$9.optional, optionalSpec);\r\n        var group = convert(adt$9.group, groupSpec);\r\n        var original = constant('entirety');\r\n        var PartType = Object.freeze({\r\n            required: required,\r\n            external: external$1,\r\n            optional: optional,\r\n            group: group,\r\n            asNamedPart: asNamedPart,\r\n            name: name$1,\r\n            asCommon: asCommon,\r\n            original: original\r\n        });\r\n        var combine$2 = function (detail, data, partSpec, partValidated) {\r\n            return deepMerge(data.defaults(detail, partSpec, partValidated), partSpec, { uid: detail.partUids[data.name] }, data.overrides(detail, partSpec, partValidated));\r\n        };\r\n        var subs = function (owner, detail, parts) {\r\n            var internals = {};\r\n            var externals = {};\r\n            each(parts, function (part) {\r\n                part.fold(function (data) {\r\n                    internals[data.pname] = single(true, function (detail, partSpec, partValidated) {\r\n                        return data.factory.sketch(combine$2(detail, data, partSpec, partValidated));\r\n                    });\r\n                }, function (data) {\r\n                    var partSpec = detail.parts[data.name];\r\n                    externals[data.name] = constant(data.factory.sketch(combine$2(detail, data, partSpec[original()]), partSpec));\r\n                }, function (data) {\r\n                    internals[data.pname] = single(false, function (detail, partSpec, partValidated) {\r\n                        return data.factory.sketch(combine$2(detail, data, partSpec, partValidated));\r\n                    });\r\n                }, function (data) {\r\n                    internals[data.pname] = multiple(true, function (detail, _partSpec, _partValidated) {\r\n                        var units = detail[data.name];\r\n                        return map(units, function (u) {\r\n                            return data.factory.sketch(deepMerge(data.defaults(detail, u, _partValidated), u, data.overrides(detail, u)));\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n            return {\r\n                internals: constant(internals),\r\n                externals: constant(externals)\r\n            };\r\n        };\r\n        var generate$4 = function (owner, parts) {\r\n            var r = {};\r\n            each(parts, function (part) {\r\n                asNamedPart(part).each(function (np) {\r\n                    var g = doGenerateOne(owner, np.pname);\r\n                    r[np.name] = function (config) {\r\n                        var validated = asRawOrDie('Part: ' + np.name + ' in ' + owner, objOf(np.schema), config);\r\n                        return __assign({}, g, {\r\n                            config: config,\r\n                            validated: validated\r\n                        });\r\n                    };\r\n                });\r\n            });\r\n            return r;\r\n        };\r\n        var doGenerateOne = function (owner, pname) {\r\n            return {\r\n                uiType: placeholder(),\r\n                owner: owner,\r\n                name: pname\r\n            };\r\n        };\r\n        var generateOne = function (owner, pname, config) {\r\n            return {\r\n                uiType: placeholder(),\r\n                owner: owner,\r\n                name: pname,\r\n                config: config,\r\n                validated: {}\r\n            };\r\n        };\r\n        var schemas = function (parts) {\r\n            return bind(parts, function (part) {\r\n                return part.fold(Option.none, Option.some, Option.none, Option.none).map(function (data) {\r\n                    return strictObjOf(data.name, data.schema.concat([snapshot(original())]));\r\n                }).toArray();\r\n            });\r\n        };\r\n        var names = function (parts) {\r\n            return map(parts, name$1);\r\n        };\r\n        var substitutes = function (owner, detail, parts) {\r\n            return subs(owner, detail, parts);\r\n        };\r\n        var components = function (owner, detail, internals) {\r\n            return substitutePlaces(Option.some(owner), detail, detail.components, internals);\r\n        };\r\n        var getPart = function (component, detail, partKey) {\r\n            var uid = detail.partUids[partKey];\r\n            return component.getSystem().getByUid(uid).toOption();\r\n        };\r\n        var getPartOrDie = function (component, detail, partKey) {\r\n            return getPart(component, detail, partKey).getOrDie('Could not find part: ' + partKey);\r\n        };\r\n        var getParts = function (component, detail, partKeys) {\r\n            var r = {};\r\n            var uids = detail.partUids;\r\n            var system = component.getSystem();\r\n            each(partKeys, function (pk) {\r\n                r[pk] = system.getByUid(uids[pk]);\r\n            });\r\n            return map$1(r, constant);\r\n        };\r\n        var getAllParts = function (component, detail) {\r\n            var system = component.getSystem();\r\n            return map$1(detail.partUids, function (pUid, k) {\r\n                return constant(system.getByUid(pUid));\r\n            });\r\n        };\r\n        var getAllPartNames = function (detail) {\r\n            return keys(detail.partUids);\r\n        };\r\n        var getPartsOrDie = function (component, detail, partKeys) {\r\n            var r = {};\r\n            var uids = detail.partUids;\r\n            var system = component.getSystem();\r\n            each(partKeys, function (pk) {\r\n                r[pk] = system.getByUid(uids[pk]).getOrDie();\r\n            });\r\n            return map$1(r, constant);\r\n        };\r\n        var defaultUids = function (baseUid, partTypes) {\r\n            var partNames = names(partTypes);\r\n            return wrapAll$1(map(partNames, function (pn) {\r\n                return {\r\n                    key: pn,\r\n                    value: baseUid + '-' + pn\r\n                };\r\n            }));\r\n        };\r\n        var defaultUidsSchema = function (partTypes) {\r\n            return field('partUids', 'partUids', mergeWithThunk(function (spec) {\r\n                return defaultUids(spec.uid, partTypes);\r\n            }), anyValue$1());\r\n        };\r\n        var AlloyParts = Object.freeze({\r\n            generate: generate$4,\r\n            generateOne: generateOne,\r\n            schemas: schemas,\r\n            names: names,\r\n            substitutes: substitutes,\r\n            components: components,\r\n            defaultUids: defaultUids,\r\n            defaultUidsSchema: defaultUidsSchema,\r\n            getAllParts: getAllParts,\r\n            getAllPartNames: getAllPartNames,\r\n            getPart: getPart,\r\n            getPartOrDie: getPartOrDie,\r\n            getParts: getParts,\r\n            getPartsOrDie: getPartsOrDie\r\n        });\r\n        var base = function (label, partSchemas, partUidsSchemas, spec) {\r\n            var ps = partSchemas.length > 0 ? [strictObjOf('parts', partSchemas)] : [];\r\n            return ps.concat([\r\n                strict$1('uid'),\r\n                defaulted$1('dom', {}),\r\n                defaulted$1('components', []),\r\n                snapshot('originalSpec'),\r\n                defaulted$1('debug.sketcher', {})\r\n            ]).concat(partUidsSchemas);\r\n        };\r\n        var asRawOrDie$1 = function (label, schema, spec, partSchemas, partUidsSchemas) {\r\n            var baseS = base(label, partSchemas, partUidsSchemas, spec);\r\n            return asRawOrDie(label + ' [SpecSchema]', objOfOnly(baseS.concat(schema)), spec);\r\n        };\r\n        var single$1 = function (owner, schema, factory, spec) {\r\n            var specWithUid = supplyUid(spec);\r\n            var detail = asRawOrDie$1(owner, schema, specWithUid, [], []);\r\n            return factory(detail, specWithUid);\r\n        };\r\n        var composite = function (owner, schema, partTypes, factory, spec) {\r\n            var specWithUid = supplyUid(spec);\r\n            var partSchemas = schemas(partTypes);\r\n            var partUidsSchema = defaultUidsSchema(partTypes);\r\n            var detail = asRawOrDie$1(owner, schema, specWithUid, partSchemas, [partUidsSchema]);\r\n            var subs = substitutes(owner, detail, partTypes);\r\n            var components$1 = components(owner, detail, subs.internals());\r\n            return factory(detail, components$1, specWithUid, subs.externals());\r\n        };\r\n        var supplyUid = function (spec) {\r\n            return spec.hasOwnProperty('uid') ? spec : __assign({}, spec, { uid: generate$2('uid') });\r\n        };\r\n        function isSketchSpec(spec) {\r\n            return spec.uid !== undefined;\r\n        }\r\n        var singleSchema = objOfOnly([\r\n            strict$1('name'),\r\n            strict$1('factory'),\r\n            strict$1('configFields'),\r\n            defaulted$1('apis', {}),\r\n            defaulted$1('extraApis', {})\r\n        ]);\r\n        var compositeSchema = objOfOnly([\r\n            strict$1('name'),\r\n            strict$1('factory'),\r\n            strict$1('configFields'),\r\n            strict$1('partFields'),\r\n            defaulted$1('apis', {}),\r\n            defaulted$1('extraApis', {})\r\n        ]);\r\n        var single$2 = function (rawConfig) {\r\n            var config = asRawOrDie('Sketcher for ' + rawConfig.name, singleSchema, rawConfig);\r\n            var sketch = function (spec) {\r\n                return single$1(config.name, config.configFields, config.factory, spec);\r\n            };\r\n            var apis = map$1(config.apis, makeApi);\r\n            var extraApis = map$1(config.extraApis, function (f, k) {\r\n                return markAsExtraApi(f, k);\r\n            });\r\n            return __assign({\r\n                name: constant(config.name),\r\n                partFields: constant([]),\r\n                configFields: constant(config.configFields),\r\n                sketch: sketch\r\n            }, apis, extraApis);\r\n        };\r\n        var composite$1 = function (rawConfig) {\r\n            var config = asRawOrDie('Sketcher for ' + rawConfig.name, compositeSchema, rawConfig);\r\n            var sketch = function (spec) {\r\n                return composite(config.name, config.configFields, config.partFields, config.factory, spec);\r\n            };\r\n            var parts = generate$4(config.name, config.partFields);\r\n            var apis = map$1(config.apis, makeApi);\r\n            var extraApis = map$1(config.extraApis, function (f, k) {\r\n                return markAsExtraApi(f, k);\r\n            });\r\n            return __assign({\r\n                name: constant(config.name),\r\n                partFields: constant(config.partFields),\r\n                configFields: constant(config.configFields),\r\n                sketch: sketch,\r\n                parts: constant(parts)\r\n            }, apis, extraApis);\r\n        };\r\n        var Sketcher = Object.freeze({\r\n            isSketchSpec: isSketchSpec,\r\n            single: single$2,\r\n            composite: composite$1\r\n        });\r\n        var inside = function (target) {\r\n            return name(target) === 'input' && get$2(target, 'type') !== 'radio' || name(target) === 'textarea';\r\n        };\r\n        var getCurrent = function (component, composeConfig, composeState) {\r\n            return composeConfig.find(component);\r\n        };\r\n        var ComposeApis = Object.freeze({\r\n            getCurrent: getCurrent\r\n        });\r\n        var ComposeSchema = [strict$1('find')];\r\n        var Composing = create$1({\r\n            fields: ComposeSchema,\r\n            name: 'composing',\r\n            apis: ComposeApis\r\n        });\r\n        var cycleBy = function (value, delta, min, max) {\r\n            var r = value + delta;\r\n            if (r > max) {\r\n                return min;\r\n            }\r\n            else {\r\n                return r < min ? max : r;\r\n            }\r\n        };\r\n        var cap = function (value, min, max) {\r\n            if (value <= min) {\r\n                return min;\r\n            }\r\n            else {\r\n                return value >= max ? max : value;\r\n            }\r\n        };\r\n        var dehighlightAllExcept = function (component, hConfig, hState, skip) {\r\n            var highlighted = descendants(component.element(), '.' + hConfig.highlightClass);\r\n            each(highlighted, function (h) {\r\n                if (!exists(skip, function (skipComp) {\r\n                    return skipComp.element() === h;\r\n                })) {\r\n                    remove$4(h, hConfig.highlightClass);\r\n                    component.getSystem().getByDom(h).each(function (target) {\r\n                        hConfig.onDehighlight(component, target);\r\n                        emit(target, dehighlight());\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        var dehighlightAll = function (component, hConfig, hState) {\r\n            return dehighlightAllExcept(component, hConfig, hState, []);\r\n        };\r\n        var dehighlight$1 = function (component, hConfig, hState, target) {\r\n            if (isHighlighted(component, hConfig, hState, target)) {\r\n                remove$4(target.element(), hConfig.highlightClass);\r\n                hConfig.onDehighlight(component, target);\r\n                emit(target, dehighlight());\r\n            }\r\n        };\r\n        var highlight$1 = function (component, hConfig, hState, target) {\r\n            dehighlightAllExcept(component, hConfig, hState, [target]);\r\n            if (!isHighlighted(component, hConfig, hState, target)) {\r\n                add$2(target.element(), hConfig.highlightClass);\r\n                hConfig.onHighlight(component, target);\r\n                emit(target, highlight());\r\n            }\r\n        };\r\n        var highlightFirst = function (component, hConfig, hState) {\r\n            getFirst(component, hConfig, hState).each(function (firstComp) {\r\n                highlight$1(component, hConfig, hState, firstComp);\r\n            });\r\n        };\r\n        var highlightLast = function (component, hConfig, hState) {\r\n            getLast(component, hConfig, hState).each(function (lastComp) {\r\n                highlight$1(component, hConfig, hState, lastComp);\r\n            });\r\n        };\r\n        var highlightAt = function (component, hConfig, hState, index) {\r\n            getByIndex(component, hConfig, hState, index).fold(function (err) {\r\n                throw new Error(err);\r\n            }, function (firstComp) {\r\n                highlight$1(component, hConfig, hState, firstComp);\r\n            });\r\n        };\r\n        var highlightBy = function (component, hConfig, hState, predicate) {\r\n            var candidates = getCandidates(component, hConfig, hState);\r\n            var targetComp = find(candidates, predicate);\r\n            targetComp.each(function (c) {\r\n                highlight$1(component, hConfig, hState, c);\r\n            });\r\n        };\r\n        var isHighlighted = function (component, hConfig, hState, queryTarget) {\r\n            return has$2(queryTarget.element(), hConfig.highlightClass);\r\n        };\r\n        var getHighlighted = function (component, hConfig, hState) {\r\n            return descendant$2(component.element(), '.' + hConfig.highlightClass).bind(function (e) {\r\n                return component.getSystem().getByDom(e).toOption();\r\n            });\r\n        };\r\n        var getByIndex = function (component, hConfig, hState, index) {\r\n            var items = descendants(component.element(), '.' + hConfig.itemClass);\r\n            return Option.from(items[index]).fold(function () {\r\n                return Result.error('No element found with index ' + index);\r\n            }, component.getSystem().getByDom);\r\n        };\r\n        var getFirst = function (component, hConfig, hState) {\r\n            return descendant$2(component.element(), '.' + hConfig.itemClass).bind(function (e) {\r\n                return component.getSystem().getByDom(e).toOption();\r\n            });\r\n        };\r\n        var getLast = function (component, hConfig, hState) {\r\n            var items = descendants(component.element(), '.' + hConfig.itemClass);\r\n            var last = items.length > 0 ? Option.some(items[items.length - 1]) : Option.none();\r\n            return last.bind(function (c) {\r\n                return component.getSystem().getByDom(c).toOption();\r\n            });\r\n        };\r\n        var getDelta = function (component, hConfig, hState, delta) {\r\n            var items = descendants(component.element(), '.' + hConfig.itemClass);\r\n            var current = findIndex(items, function (item) {\r\n                return has$2(item, hConfig.highlightClass);\r\n            });\r\n            return current.bind(function (selected) {\r\n                var dest = cycleBy(selected, delta, 0, items.length - 1);\r\n                return component.getSystem().getByDom(items[dest]).toOption();\r\n            });\r\n        };\r\n        var getPrevious = function (component, hConfig, hState) {\r\n            return getDelta(component, hConfig, hState, -1);\r\n        };\r\n        var getNext = function (component, hConfig, hState) {\r\n            return getDelta(component, hConfig, hState, +1);\r\n        };\r\n        var getCandidates = function (component, hConfig, hState) {\r\n            var items = descendants(component.element(), '.' + hConfig.itemClass);\r\n            return cat(map(items, function (i) {\r\n                return component.getSystem().getByDom(i).toOption();\r\n            }));\r\n        };\r\n        var HighlightApis = Object.freeze({\r\n            dehighlightAll: dehighlightAll,\r\n            dehighlight: dehighlight$1,\r\n            highlight: highlight$1,\r\n            highlightFirst: highlightFirst,\r\n            highlightLast: highlightLast,\r\n            highlightAt: highlightAt,\r\n            highlightBy: highlightBy,\r\n            isHighlighted: isHighlighted,\r\n            getHighlighted: getHighlighted,\r\n            getFirst: getFirst,\r\n            getLast: getLast,\r\n            getPrevious: getPrevious,\r\n            getNext: getNext,\r\n            getCandidates: getCandidates\r\n        });\r\n        var HighlightSchema = [\r\n            strict$1('highlightClass'),\r\n            strict$1('itemClass'),\r\n            onHandler('onHighlight'),\r\n            onHandler('onDehighlight')\r\n        ];\r\n        var Highlighting = create$1({\r\n            fields: HighlightSchema,\r\n            name: 'highlighting',\r\n            apis: HighlightApis\r\n        });\r\n        var BACKSPACE = function () {\r\n            return [8];\r\n        };\r\n        var TAB = function () {\r\n            return [9];\r\n        };\r\n        var ENTER = function () {\r\n            return [13];\r\n        };\r\n        var ESCAPE = function () {\r\n            return [27];\r\n        };\r\n        var SPACE = function () {\r\n            return [32];\r\n        };\r\n        var LEFT = function () {\r\n            return [37];\r\n        };\r\n        var UP = function () {\r\n            return [38];\r\n        };\r\n        var RIGHT = function () {\r\n            return [39];\r\n        };\r\n        var DOWN = function () {\r\n            return [40];\r\n        };\r\n        var cyclePrev = function (values, index, predicate) {\r\n            var before = reverse(values.slice(0, index));\r\n            var after = reverse(values.slice(index + 1));\r\n            return find(before.concat(after), predicate);\r\n        };\r\n        var tryPrev = function (values, index, predicate) {\r\n            var before = reverse(values.slice(0, index));\r\n            return find(before, predicate);\r\n        };\r\n        var cycleNext = function (values, index, predicate) {\r\n            var before = values.slice(0, index);\r\n            var after = values.slice(index + 1);\r\n            return find(after.concat(before), predicate);\r\n        };\r\n        var tryNext = function (values, index, predicate) {\r\n            var after = values.slice(index + 1);\r\n            return find(after, predicate);\r\n        };\r\n        var inSet = function (keys) {\r\n            return function (event) {\r\n                var raw = event.raw();\r\n                return contains(keys, raw.which);\r\n            };\r\n        };\r\n        var and = function (preds) {\r\n            return function (event) {\r\n                return forall(preds, function (pred) {\r\n                    return pred(event);\r\n                });\r\n            };\r\n        };\r\n        var is$1 = function (key) {\r\n            return function (event) {\r\n                var raw = event.raw();\r\n                return raw.which === key;\r\n            };\r\n        };\r\n        var isShift = function (event) {\r\n            var raw = event.raw();\r\n            return raw.shiftKey === true;\r\n        };\r\n        var isControl = function (event) {\r\n            var raw = event.raw();\r\n            return raw.ctrlKey === true;\r\n        };\r\n        var isNotShift = not(isShift);\r\n        var basic = function (key, action) {\r\n            return {\r\n                matches: is$1(key),\r\n                classification: action\r\n            };\r\n        };\r\n        var rule = function (matches, action) {\r\n            return {\r\n                matches: matches,\r\n                classification: action\r\n            };\r\n        };\r\n        var choose$2 = function (transitions, event) {\r\n            var transition = find(transitions, function (t) {\r\n                return t.matches(event);\r\n            });\r\n            return transition.map(function (t) {\r\n                return t.classification;\r\n            });\r\n        };\r\n        var KeyRules = Object.freeze({\r\n            basic: basic,\r\n            rule: rule,\r\n            choose: choose$2\r\n        });\r\n        var focus$1 = function (element) {\r\n            element.dom().focus();\r\n        };\r\n        var blur = function (element) {\r\n            element.dom().blur();\r\n        };\r\n        var hasFocus = function (element) {\r\n            var doc = owner(element).dom();\r\n            return element.dom() === doc.activeElement;\r\n        };\r\n        var active = function (_DOC) {\r\n            var doc = _DOC !== undefined ? _DOC.dom() : domGlobals.document;\r\n            return Option.from(doc.activeElement).map(Element.fromDom);\r\n        };\r\n        var search$1 = function (element) {\r\n            return active(owner(element)).filter(function (e) {\r\n                return element.dom().contains(e.dom());\r\n            });\r\n        };\r\n        var reportFocusShifting = function (component, prevFocus, newFocus) {\r\n            var noChange = prevFocus.exists(function (p) {\r\n                return newFocus.exists(function (n) {\r\n                    return eq(n, p);\r\n                });\r\n            });\r\n            if (!noChange) {\r\n                emitWith(component, focusShifted(), {\r\n                    prevFocus: prevFocus,\r\n                    newFocus: newFocus\r\n                });\r\n            }\r\n        };\r\n        var dom = function () {\r\n            var get = function (component) {\r\n                return search$1(component.element());\r\n            };\r\n            var set = function (component, focusee) {\r\n                var prevFocus = get(component);\r\n                component.getSystem().triggerFocus(focusee, component.element());\r\n                var newFocus = get(component);\r\n                reportFocusShifting(component, prevFocus, newFocus);\r\n            };\r\n            return {\r\n                get: get,\r\n                set: set\r\n            };\r\n        };\r\n        var highlights = function () {\r\n            var get = function (component) {\r\n                return Highlighting.getHighlighted(component).map(function (item) {\r\n                    return item.element();\r\n                });\r\n            };\r\n            var set = function (component, element) {\r\n                var prevFocus = get(component);\r\n                component.getSystem().getByDom(element).fold(noop, function (item) {\r\n                    Highlighting.highlight(component, item);\r\n                });\r\n                var newFocus = get(component);\r\n                reportFocusShifting(component, prevFocus, newFocus);\r\n            };\r\n            return {\r\n                get: get,\r\n                set: set\r\n            };\r\n        };\r\n        var FocusInsideModes;\r\n        (function (FocusInsideModes) {\r\n            FocusInsideModes['OnFocusMode'] = 'onFocus';\r\n            FocusInsideModes['OnEnterOrSpaceMode'] = 'onEnterOrSpace';\r\n            FocusInsideModes['OnApiMode'] = 'onApi';\r\n        }(FocusInsideModes || (FocusInsideModes = {})));\r\n        var typical = function (infoSchema, stateInit, getKeydownRules, getKeyupRules, optFocusIn) {\r\n            var schema = function () {\r\n                return infoSchema.concat([\r\n                    defaulted$1('focusManager', dom()),\r\n                    defaultedOf('focusInside', 'onFocus', valueOf(function (val) {\r\n                        return contains([\r\n                            'onFocus',\r\n                            'onEnterOrSpace',\r\n                            'onApi'\r\n                        ], val) ? Result.value(val) : Result.error('Invalid value for focusInside');\r\n                    })),\r\n                    output('handler', me),\r\n                    output('state', stateInit),\r\n                    output('sendFocusIn', optFocusIn)\r\n                ]);\r\n            };\r\n            var processKey = function (component, simulatedEvent, getRules, keyingConfig, keyingState) {\r\n                var rules = getRules(component, simulatedEvent, keyingConfig, keyingState);\r\n                return choose$2(rules, simulatedEvent.event()).bind(function (rule) {\r\n                    return rule(component, simulatedEvent, keyingConfig, keyingState);\r\n                });\r\n            };\r\n            var toEvents = function (keyingConfig, keyingState) {\r\n                var onFocusHandler = keyingConfig.focusInside !== FocusInsideModes.OnFocusMode ? Option.none() : optFocusIn(keyingConfig).map(function (focusIn) {\r\n                    return run(focus(), function (component, simulatedEvent) {\r\n                        focusIn(component, keyingConfig, keyingState);\r\n                        simulatedEvent.stop();\r\n                    });\r\n                });\r\n                var tryGoInsideComponent = function (component, simulatedEvent) {\r\n                    var isEnterOrSpace = inSet(SPACE().concat(ENTER()))(simulatedEvent.event());\r\n                    if (keyingConfig.focusInside === FocusInsideModes.OnEnterOrSpaceMode && isEnterOrSpace && isSource(component, simulatedEvent)) {\r\n                        optFocusIn(keyingConfig).each(function (focusIn) {\r\n                            focusIn(component, keyingConfig, keyingState);\r\n                            simulatedEvent.stop();\r\n                        });\r\n                    }\r\n                };\r\n                return derive(onFocusHandler.toArray().concat([\r\n                    run(keydown(), function (component, simulatedEvent) {\r\n                        processKey(component, simulatedEvent, getKeydownRules, keyingConfig, keyingState).fold(function () {\r\n                            tryGoInsideComponent(component, simulatedEvent);\r\n                        }, function (_) {\r\n                            simulatedEvent.stop();\r\n                        });\r\n                    }),\r\n                    run(keyup(), function (component, simulatedEvent) {\r\n                        processKey(component, simulatedEvent, getKeyupRules, keyingConfig, keyingState).each(function (_) {\r\n                            simulatedEvent.stop();\r\n                        });\r\n                    })\r\n                ]));\r\n            };\r\n            var me = {\r\n                schema: schema,\r\n                processKey: processKey,\r\n                toEvents: toEvents\r\n            };\r\n            return me;\r\n        };\r\n        var create$2 = function (cyclicField) {\r\n            var schema = [\r\n                option('onEscape'),\r\n                option('onEnter'),\r\n                defaulted$1('selector', '[data-alloy-tabstop=\"true\"]'),\r\n                defaulted$1('firstTabstop', 0),\r\n                defaulted$1('useTabstopAt', constant(true)),\r\n                option('visibilitySelector')\r\n            ].concat([cyclicField]);\r\n            var isVisible = function (tabbingConfig, element) {\r\n                var target = tabbingConfig.visibilitySelector.bind(function (sel) {\r\n                    return closest$3(element, sel);\r\n                }).getOr(element);\r\n                return get$8(target) > 0;\r\n            };\r\n            var findInitial = function (component, tabbingConfig) {\r\n                var tabstops = descendants(component.element(), tabbingConfig.selector);\r\n                var visibles = filter(tabstops, function (elem) {\r\n                    return isVisible(tabbingConfig, elem);\r\n                });\r\n                return Option.from(visibles[tabbingConfig.firstTabstop]);\r\n            };\r\n            var findCurrent = function (component, tabbingConfig) {\r\n                return tabbingConfig.focusManager.get(component).bind(function (elem) {\r\n                    return closest$3(elem, tabbingConfig.selector);\r\n                });\r\n            };\r\n            var isTabstop = function (tabbingConfig, element) {\r\n                return isVisible(tabbingConfig, element) && tabbingConfig.useTabstopAt(element);\r\n            };\r\n            var focusIn = function (component, tabbingConfig) {\r\n                findInitial(component, tabbingConfig).each(function (target) {\r\n                    tabbingConfig.focusManager.set(component, target);\r\n                });\r\n            };\r\n            var goFromTabstop = function (component, tabstops, stopIndex, tabbingConfig, cycle) {\r\n                return cycle(tabstops, stopIndex, function (elem) {\r\n                    return isTabstop(tabbingConfig, elem);\r\n                }).fold(function () {\r\n                    return tabbingConfig.cyclic ? Option.some(true) : Option.none();\r\n                }, function (target) {\r\n                    tabbingConfig.focusManager.set(component, target);\r\n                    return Option.some(true);\r\n                });\r\n            };\r\n            var go = function (component, simulatedEvent, tabbingConfig, cycle) {\r\n                var tabstops = descendants(component.element(), tabbingConfig.selector);\r\n                return findCurrent(component, tabbingConfig).bind(function (tabstop) {\r\n                    var optStopIndex = findIndex(tabstops, curry(eq, tabstop));\r\n                    return optStopIndex.bind(function (stopIndex) {\r\n                        return goFromTabstop(component, tabstops, stopIndex, tabbingConfig, cycle);\r\n                    });\r\n                });\r\n            };\r\n            var goBackwards = function (component, simulatedEvent, tabbingConfig, tabbingState) {\r\n                var navigate = tabbingConfig.cyclic ? cyclePrev : tryPrev;\r\n                return go(component, simulatedEvent, tabbingConfig, navigate);\r\n            };\r\n            var goForwards = function (component, simulatedEvent, tabbingConfig, tabbingState) {\r\n                var navigate = tabbingConfig.cyclic ? cycleNext : tryNext;\r\n                return go(component, simulatedEvent, tabbingConfig, navigate);\r\n            };\r\n            var execute = function (component, simulatedEvent, tabbingConfig, tabbingState) {\r\n                return tabbingConfig.onEnter.bind(function (f) {\r\n                    return f(component, simulatedEvent);\r\n                });\r\n            };\r\n            var exit = function (component, simulatedEvent, tabbingConfig, tabbingState) {\r\n                return tabbingConfig.onEscape.bind(function (f) {\r\n                    return f(component, simulatedEvent);\r\n                });\r\n            };\r\n            var getKeydownRules = constant([\r\n                rule(and([\r\n                    isShift,\r\n                    inSet(TAB())\r\n                ]), goBackwards),\r\n                rule(inSet(TAB()), goForwards),\r\n                rule(inSet(ESCAPE()), exit),\r\n                rule(and([\r\n                    isNotShift,\r\n                    inSet(ENTER())\r\n                ]), execute)\r\n            ]);\r\n            var getKeyupRules = constant([]);\r\n            return typical(schema, NoState.init, getKeydownRules, getKeyupRules, function () {\r\n                return Option.some(focusIn);\r\n            });\r\n        };\r\n        var AcyclicType = create$2(state$1('cyclic', constant(false)));\r\n        var CyclicType = create$2(state$1('cyclic', constant(true)));\r\n        var doDefaultExecute = function (component, simulatedEvent, focused) {\r\n            dispatch(component, focused, execute());\r\n            return Option.some(true);\r\n        };\r\n        var defaultExecute = function (component, simulatedEvent, focused) {\r\n            return inside(focused) && inSet(SPACE())(simulatedEvent.event()) ? Option.none() : doDefaultExecute(component, simulatedEvent, focused);\r\n        };\r\n        var stopEventForFirefox = function (component, simulatedEvent) {\r\n            return Option.some(true);\r\n        };\r\n        var schema$3 = [\r\n            defaulted$1('execute', defaultExecute),\r\n            defaulted$1('useSpace', false),\r\n            defaulted$1('useEnter', true),\r\n            defaulted$1('useControlEnter', false),\r\n            defaulted$1('useDown', false)\r\n        ];\r\n        var execute$1 = function (component, simulatedEvent, executeConfig) {\r\n            return executeConfig.execute(component, simulatedEvent, component.element());\r\n        };\r\n        var getKeydownRules = function (component, simulatedEvent, executeConfig, executeState) {\r\n            var spaceExec = executeConfig.useSpace && !inside(component.element()) ? SPACE() : [];\r\n            var enterExec = executeConfig.useEnter ? ENTER() : [];\r\n            var downExec = executeConfig.useDown ? DOWN() : [];\r\n            var execKeys = spaceExec.concat(enterExec).concat(downExec);\r\n            return [rule(inSet(execKeys), execute$1)].concat(executeConfig.useControlEnter ? [rule(and([\r\n                    isControl,\r\n                    inSet(ENTER())\r\n                ]), execute$1)] : []);\r\n        };\r\n        var getKeyupRules = function (component, simulatedEvent, executeConfig, executeState) {\r\n            return executeConfig.useSpace && !inside(component.element()) ? [rule(inSet(SPACE()), stopEventForFirefox)] : [];\r\n        };\r\n        var ExecutionType = typical(schema$3, NoState.init, getKeydownRules, getKeyupRules, function () {\r\n            return Option.none();\r\n        });\r\n        var flatgrid = function (spec) {\r\n            var dimensions = Cell(Option.none());\r\n            var setGridSize = function (numRows, numColumns) {\r\n                dimensions.set(Option.some({\r\n                    numRows: constant(numRows),\r\n                    numColumns: constant(numColumns)\r\n                }));\r\n            };\r\n            var getNumRows = function () {\r\n                return dimensions.get().map(function (d) {\r\n                    return d.numRows();\r\n                });\r\n            };\r\n            var getNumColumns = function () {\r\n                return dimensions.get().map(function (d) {\r\n                    return d.numColumns();\r\n                });\r\n            };\r\n            return nu$5({\r\n                readState: function () {\r\n                    return dimensions.get().map(function (d) {\r\n                        return {\r\n                            numRows: d.numRows(),\r\n                            numColumns: d.numColumns()\r\n                        };\r\n                    }).getOr({\r\n                        numRows: '?',\r\n                        numColumns: '?'\r\n                    });\r\n                },\r\n                setGridSize: setGridSize,\r\n                getNumRows: getNumRows,\r\n                getNumColumns: getNumColumns\r\n            });\r\n        };\r\n        var init$1 = function (spec) {\r\n            return spec.state(spec);\r\n        };\r\n        var KeyingState = Object.freeze({\r\n            flatgrid: flatgrid,\r\n            init: init$1\r\n        });\r\n        var useH = function (movement) {\r\n            return function (component, simulatedEvent, config, state) {\r\n                var move = movement(component.element());\r\n                return use(move, component, simulatedEvent, config, state);\r\n            };\r\n        };\r\n        var west$2 = function (moveLeft, moveRight) {\r\n            var movement = onDirection(moveLeft, moveRight);\r\n            return useH(movement);\r\n        };\r\n        var east$2 = function (moveLeft, moveRight) {\r\n            var movement = onDirection(moveRight, moveLeft);\r\n            return useH(movement);\r\n        };\r\n        var useV = function (move) {\r\n            return function (component, simulatedEvent, config, state) {\r\n                return use(move, component, simulatedEvent, config, state);\r\n            };\r\n        };\r\n        var use = function (move, component, simulatedEvent, config, state) {\r\n            var outcome = config.focusManager.get(component).bind(function (focused) {\r\n                return move(component.element(), focused, config, state);\r\n            });\r\n            return outcome.map(function (newFocus) {\r\n                config.focusManager.set(component, newFocus);\r\n                return true;\r\n            });\r\n        };\r\n        var north$2 = useV;\r\n        var south$2 = useV;\r\n        var move = useV;\r\n        var isHidden = function (dom) {\r\n            return dom.offsetWidth <= 0 && dom.offsetHeight <= 0;\r\n        };\r\n        var isVisible = function (element) {\r\n            var dom = element.dom();\r\n            return !isHidden(dom);\r\n        };\r\n        var indexInfo = MixedBag([\r\n            'index',\r\n            'candidates'\r\n        ], []);\r\n        var locate$2 = function (candidates, predicate) {\r\n            return findIndex(candidates, predicate).map(function (index) {\r\n                return indexInfo({\r\n                    index: index,\r\n                    candidates: candidates\r\n                });\r\n            });\r\n        };\r\n        var locateVisible = function (container, current, selector) {\r\n            var filter = isVisible;\r\n            return locateIn(container, current, selector, filter);\r\n        };\r\n        var locateIn = function (container, current, selector, filter$1) {\r\n            var predicate = curry(eq, current);\r\n            var candidates = descendants(container, selector);\r\n            var visible = filter(candidates, isVisible);\r\n            return locate$2(visible, predicate);\r\n        };\r\n        var findIndex$1 = function (elements, target) {\r\n            return findIndex(elements, function (elem) {\r\n                return eq(target, elem);\r\n            });\r\n        };\r\n        var withGrid = function (values, index, numCols, f) {\r\n            var oldRow = Math.floor(index / numCols);\r\n            var oldColumn = index % numCols;\r\n            return f(oldRow, oldColumn).bind(function (address) {\r\n                var newIndex = address.row() * numCols + address.column();\r\n                return newIndex >= 0 && newIndex < values.length ? Option.some(values[newIndex]) : Option.none();\r\n            });\r\n        };\r\n        var cycleHorizontal = function (values, index, numRows, numCols, delta) {\r\n            return withGrid(values, index, numCols, function (oldRow, oldColumn) {\r\n                var onLastRow = oldRow === numRows - 1;\r\n                var colsInRow = onLastRow ? values.length - oldRow * numCols : numCols;\r\n                var newColumn = cycleBy(oldColumn, delta, 0, colsInRow - 1);\r\n                return Option.some({\r\n                    row: constant(oldRow),\r\n                    column: constant(newColumn)\r\n                });\r\n            });\r\n        };\r\n        var cycleVertical = function (values, index, numRows, numCols, delta) {\r\n            return withGrid(values, index, numCols, function (oldRow, oldColumn) {\r\n                var newRow = cycleBy(oldRow, delta, 0, numRows - 1);\r\n                var onLastRow = newRow === numRows - 1;\r\n                var colsInRow = onLastRow ? values.length - newRow * numCols : numCols;\r\n                var newCol = cap(oldColumn, 0, colsInRow - 1);\r\n                return Option.some({\r\n                    row: constant(newRow),\r\n                    column: constant(newCol)\r\n                });\r\n            });\r\n        };\r\n        var cycleRight = function (values, index, numRows, numCols) {\r\n            return cycleHorizontal(values, index, numRows, numCols, +1);\r\n        };\r\n        var cycleLeft = function (values, index, numRows, numCols) {\r\n            return cycleHorizontal(values, index, numRows, numCols, -1);\r\n        };\r\n        var cycleUp = function (values, index, numRows, numCols) {\r\n            return cycleVertical(values, index, numRows, numCols, -1);\r\n        };\r\n        var cycleDown = function (values, index, numRows, numCols) {\r\n            return cycleVertical(values, index, numRows, numCols, +1);\r\n        };\r\n        var schema$4 = [\r\n            strict$1('selector'),\r\n            defaulted$1('execute', defaultExecute),\r\n            onKeyboardHandler('onEscape'),\r\n            defaulted$1('captureTab', false),\r\n            initSize()\r\n        ];\r\n        var focusIn = function (component, gridConfig, gridState) {\r\n            descendant$2(component.element(), gridConfig.selector).each(function (first) {\r\n                gridConfig.focusManager.set(component, first);\r\n            });\r\n        };\r\n        var findCurrent = function (component, gridConfig) {\r\n            return gridConfig.focusManager.get(component).bind(function (elem) {\r\n                return closest$3(elem, gridConfig.selector);\r\n            });\r\n        };\r\n        var execute$2 = function (component, simulatedEvent, gridConfig, gridState) {\r\n            return findCurrent(component, gridConfig).bind(function (focused) {\r\n                return gridConfig.execute(component, simulatedEvent, focused);\r\n            });\r\n        };\r\n        var doMove = function (cycle) {\r\n            return function (element, focused, gridConfig, gridState) {\r\n                return locateVisible(element, focused, gridConfig.selector).bind(function (identified) {\r\n                    return cycle(identified.candidates(), identified.index(), gridState.getNumRows().getOr(gridConfig.initSize.numRows), gridState.getNumColumns().getOr(gridConfig.initSize.numColumns));\r\n                });\r\n            };\r\n        };\r\n        var handleTab = function (component, simulatedEvent, gridConfig, gridState) {\r\n            return gridConfig.captureTab ? Option.some(true) : Option.none();\r\n        };\r\n        var doEscape = function (component, simulatedEvent, gridConfig, gridState) {\r\n            return gridConfig.onEscape(component, simulatedEvent);\r\n        };\r\n        var moveLeft = doMove(cycleLeft);\r\n        var moveRight = doMove(cycleRight);\r\n        var moveNorth = doMove(cycleUp);\r\n        var moveSouth = doMove(cycleDown);\r\n        var getKeydownRules$1 = constant([\r\n            rule(inSet(LEFT()), west$2(moveLeft, moveRight)),\r\n            rule(inSet(RIGHT()), east$2(moveLeft, moveRight)),\r\n            rule(inSet(UP()), north$2(moveNorth)),\r\n            rule(inSet(DOWN()), south$2(moveSouth)),\r\n            rule(and([\r\n                isShift,\r\n                inSet(TAB())\r\n            ]), handleTab),\r\n            rule(and([\r\n                isNotShift,\r\n                inSet(TAB())\r\n            ]), handleTab),\r\n            rule(inSet(ESCAPE()), doEscape),\r\n            rule(inSet(SPACE().concat(ENTER())), execute$2)\r\n        ]);\r\n        var getKeyupRules$1 = constant([rule(inSet(SPACE()), stopEventForFirefox)]);\r\n        var FlatgridType = typical(schema$4, flatgrid, getKeydownRules$1, getKeyupRules$1, function () {\r\n            return Option.some(focusIn);\r\n        });\r\n        var horizontal = function (container, selector, current, delta) {\r\n            var isDisabledButton = function (candidate) {\r\n                return name(candidate) === 'button' && get$2(candidate, 'disabled') === 'disabled';\r\n            };\r\n            var tryCycle = function (initial, index, candidates) {\r\n                var newIndex = cycleBy(index, delta, 0, candidates.length - 1);\r\n                if (newIndex === initial) {\r\n                    return Option.none();\r\n                }\r\n                else {\r\n                    return isDisabledButton(candidates[newIndex]) ? tryCycle(initial, newIndex, candidates) : Option.from(candidates[newIndex]);\r\n                }\r\n            };\r\n            return locateVisible(container, current, selector).bind(function (identified) {\r\n                var index = identified.index();\r\n                var candidates = identified.candidates();\r\n                return tryCycle(index, index, candidates);\r\n            });\r\n        };\r\n        var schema$5 = [\r\n            strict$1('selector'),\r\n            defaulted$1('getInitial', Option.none),\r\n            defaulted$1('execute', defaultExecute),\r\n            onKeyboardHandler('onEscape'),\r\n            defaulted$1('executeOnMove', false),\r\n            defaulted$1('allowVertical', true)\r\n        ];\r\n        var findCurrent$1 = function (component, flowConfig) {\r\n            return flowConfig.focusManager.get(component).bind(function (elem) {\r\n                return closest$3(elem, flowConfig.selector);\r\n            });\r\n        };\r\n        var execute$3 = function (component, simulatedEvent, flowConfig) {\r\n            return findCurrent$1(component, flowConfig).bind(function (focused) {\r\n                return flowConfig.execute(component, simulatedEvent, focused);\r\n            });\r\n        };\r\n        var focusIn$1 = function (component, flowConfig) {\r\n            flowConfig.getInitial(component).orThunk(function () {\r\n                return descendant$2(component.element(), flowConfig.selector);\r\n            }).each(function (first) {\r\n                flowConfig.focusManager.set(component, first);\r\n            });\r\n        };\r\n        var moveLeft$1 = function (element, focused, info) {\r\n            return horizontal(element, info.selector, focused, -1);\r\n        };\r\n        var moveRight$1 = function (element, focused, info) {\r\n            return horizontal(element, info.selector, focused, +1);\r\n        };\r\n        var doMove$1 = function (movement) {\r\n            return function (component, simulatedEvent, flowConfig) {\r\n                return movement(component, simulatedEvent, flowConfig).bind(function () {\r\n                    return flowConfig.executeOnMove ? execute$3(component, simulatedEvent, flowConfig) : Option.some(true);\r\n                });\r\n            };\r\n        };\r\n        var doEscape$1 = function (component, simulatedEvent, flowConfig, _flowState) {\r\n            return flowConfig.onEscape(component, simulatedEvent);\r\n        };\r\n        var getKeydownRules$2 = function (_component, _se, flowConfig, _flowState) {\r\n            var westMovers = LEFT().concat(flowConfig.allowVertical ? UP() : []);\r\n            var eastMovers = RIGHT().concat(flowConfig.allowVertical ? DOWN() : []);\r\n            return [\r\n                rule(inSet(westMovers), doMove$1(west$2(moveLeft$1, moveRight$1))),\r\n                rule(inSet(eastMovers), doMove$1(east$2(moveLeft$1, moveRight$1))),\r\n                rule(inSet(ENTER()), execute$3),\r\n                rule(inSet(SPACE()), execute$3),\r\n                rule(inSet(ESCAPE()), doEscape$1)\r\n            ];\r\n        };\r\n        var getKeyupRules$2 = constant([rule(inSet(SPACE()), stopEventForFirefox)]);\r\n        var FlowType = typical(schema$5, NoState.init, getKeydownRules$2, getKeyupRules$2, function () {\r\n            return Option.some(focusIn$1);\r\n        });\r\n        var outcome = MixedBag([\r\n            'rowIndex',\r\n            'columnIndex',\r\n            'cell'\r\n        ], []);\r\n        var toCell = function (matrix, rowIndex, columnIndex) {\r\n            return Option.from(matrix[rowIndex]).bind(function (row) {\r\n                return Option.from(row[columnIndex]).map(function (cell) {\r\n                    return outcome({\r\n                        rowIndex: rowIndex,\r\n                        columnIndex: columnIndex,\r\n                        cell: cell\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var cycleHorizontal$1 = function (matrix, rowIndex, startCol, deltaCol) {\r\n            var row = matrix[rowIndex];\r\n            var colsInRow = row.length;\r\n            var newColIndex = cycleBy(startCol, deltaCol, 0, colsInRow - 1);\r\n            return toCell(matrix, rowIndex, newColIndex);\r\n        };\r\n        var cycleVertical$1 = function (matrix, colIndex, startRow, deltaRow) {\r\n            var nextRowIndex = cycleBy(startRow, deltaRow, 0, matrix.length - 1);\r\n            var colsInNextRow = matrix[nextRowIndex].length;\r\n            var nextColIndex = cap(colIndex, 0, colsInNextRow - 1);\r\n            return toCell(matrix, nextRowIndex, nextColIndex);\r\n        };\r\n        var moveHorizontal = function (matrix, rowIndex, startCol, deltaCol) {\r\n            var row = matrix[rowIndex];\r\n            var colsInRow = row.length;\r\n            var newColIndex = cap(startCol + deltaCol, 0, colsInRow - 1);\r\n            return toCell(matrix, rowIndex, newColIndex);\r\n        };\r\n        var moveVertical = function (matrix, colIndex, startRow, deltaRow) {\r\n            var nextRowIndex = cap(startRow + deltaRow, 0, matrix.length - 1);\r\n            var colsInNextRow = matrix[nextRowIndex].length;\r\n            var nextColIndex = cap(colIndex, 0, colsInNextRow - 1);\r\n            return toCell(matrix, nextRowIndex, nextColIndex);\r\n        };\r\n        var cycleRight$1 = function (matrix, startRow, startCol) {\r\n            return cycleHorizontal$1(matrix, startRow, startCol, +1);\r\n        };\r\n        var cycleLeft$1 = function (matrix, startRow, startCol) {\r\n            return cycleHorizontal$1(matrix, startRow, startCol, -1);\r\n        };\r\n        var cycleUp$1 = function (matrix, startRow, startCol) {\r\n            return cycleVertical$1(matrix, startCol, startRow, -1);\r\n        };\r\n        var cycleDown$1 = function (matrix, startRow, startCol) {\r\n            return cycleVertical$1(matrix, startCol, startRow, +1);\r\n        };\r\n        var moveLeft$2 = function (matrix, startRow, startCol) {\r\n            return moveHorizontal(matrix, startRow, startCol, -1);\r\n        };\r\n        var moveRight$2 = function (matrix, startRow, startCol) {\r\n            return moveHorizontal(matrix, startRow, startCol, +1);\r\n        };\r\n        var moveUp = function (matrix, startRow, startCol) {\r\n            return moveVertical(matrix, startCol, startRow, -1);\r\n        };\r\n        var moveDown = function (matrix, startRow, startCol) {\r\n            return moveVertical(matrix, startCol, startRow, +1);\r\n        };\r\n        var schema$6 = [\r\n            strictObjOf('selectors', [\r\n                strict$1('row'),\r\n                strict$1('cell')\r\n            ]),\r\n            defaulted$1('cycles', true),\r\n            defaulted$1('previousSelector', Option.none),\r\n            defaulted$1('execute', defaultExecute)\r\n        ];\r\n        var focusIn$2 = function (component, matrixConfig) {\r\n            var focused = matrixConfig.previousSelector(component).orThunk(function () {\r\n                var selectors = matrixConfig.selectors;\r\n                return descendant$2(component.element(), selectors.cell);\r\n            });\r\n            focused.each(function (cell) {\r\n                matrixConfig.focusManager.set(component, cell);\r\n            });\r\n        };\r\n        var execute$4 = function (component, simulatedEvent, matrixConfig) {\r\n            return search$1(component.element()).bind(function (focused) {\r\n                return matrixConfig.execute(component, simulatedEvent, focused);\r\n            });\r\n        };\r\n        var toMatrix = function (rows, matrixConfig) {\r\n            return map(rows, function (row) {\r\n                return descendants(row, matrixConfig.selectors.cell);\r\n            });\r\n        };\r\n        var doMove$2 = function (ifCycle, ifMove) {\r\n            return function (element, focused, matrixConfig) {\r\n                var move = matrixConfig.cycles ? ifCycle : ifMove;\r\n                return closest$3(focused, matrixConfig.selectors.row).bind(function (inRow) {\r\n                    var cellsInRow = descendants(inRow, matrixConfig.selectors.cell);\r\n                    return findIndex$1(cellsInRow, focused).bind(function (colIndex) {\r\n                        var allRows = descendants(element, matrixConfig.selectors.row);\r\n                        return findIndex$1(allRows, inRow).bind(function (rowIndex) {\r\n                            var matrix = toMatrix(allRows, matrixConfig);\r\n                            return move(matrix, rowIndex, colIndex).map(function (next) {\r\n                                return next.cell();\r\n                            });\r\n                        });\r\n                    });\r\n                });\r\n            };\r\n        };\r\n        var moveLeft$3 = doMove$2(cycleLeft$1, moveLeft$2);\r\n        var moveRight$3 = doMove$2(cycleRight$1, moveRight$2);\r\n        var moveNorth$1 = doMove$2(cycleUp$1, moveUp);\r\n        var moveSouth$1 = doMove$2(cycleDown$1, moveDown);\r\n        var getKeydownRules$3 = constant([\r\n            rule(inSet(LEFT()), west$2(moveLeft$3, moveRight$3)),\r\n            rule(inSet(RIGHT()), east$2(moveLeft$3, moveRight$3)),\r\n            rule(inSet(UP()), north$2(moveNorth$1)),\r\n            rule(inSet(DOWN()), south$2(moveSouth$1)),\r\n            rule(inSet(SPACE().concat(ENTER())), execute$4)\r\n        ]);\r\n        var getKeyupRules$3 = constant([rule(inSet(SPACE()), stopEventForFirefox)]);\r\n        var MatrixType = typical(schema$6, NoState.init, getKeydownRules$3, getKeyupRules$3, function () {\r\n            return Option.some(focusIn$2);\r\n        });\r\n        var schema$7 = [\r\n            strict$1('selector'),\r\n            defaulted$1('execute', defaultExecute),\r\n            defaulted$1('moveOnTab', false)\r\n        ];\r\n        var execute$5 = function (component, simulatedEvent, menuConfig) {\r\n            return menuConfig.focusManager.get(component).bind(function (focused) {\r\n                return menuConfig.execute(component, simulatedEvent, focused);\r\n            });\r\n        };\r\n        var focusIn$3 = function (component, menuConfig) {\r\n            descendant$2(component.element(), menuConfig.selector).each(function (first) {\r\n                menuConfig.focusManager.set(component, first);\r\n            });\r\n        };\r\n        var moveUp$1 = function (element, focused, info) {\r\n            return horizontal(element, info.selector, focused, -1);\r\n        };\r\n        var moveDown$1 = function (element, focused, info) {\r\n            return horizontal(element, info.selector, focused, +1);\r\n        };\r\n        var fireShiftTab = function (component, simulatedEvent, menuConfig) {\r\n            return menuConfig.moveOnTab ? move(moveUp$1)(component, simulatedEvent, menuConfig) : Option.none();\r\n        };\r\n        var fireTab = function (component, simulatedEvent, menuConfig) {\r\n            return menuConfig.moveOnTab ? move(moveDown$1)(component, simulatedEvent, menuConfig) : Option.none();\r\n        };\r\n        var getKeydownRules$4 = constant([\r\n            rule(inSet(UP()), move(moveUp$1)),\r\n            rule(inSet(DOWN()), move(moveDown$1)),\r\n            rule(and([\r\n                isShift,\r\n                inSet(TAB())\r\n            ]), fireShiftTab),\r\n            rule(and([\r\n                isNotShift,\r\n                inSet(TAB())\r\n            ]), fireTab),\r\n            rule(inSet(ENTER()), execute$5),\r\n            rule(inSet(SPACE()), execute$5)\r\n        ]);\r\n        var getKeyupRules$4 = constant([rule(inSet(SPACE()), stopEventForFirefox)]);\r\n        var MenuType = typical(schema$7, NoState.init, getKeydownRules$4, getKeyupRules$4, function () {\r\n            return Option.some(focusIn$3);\r\n        });\r\n        var schema$8 = [\r\n            onKeyboardHandler('onSpace'),\r\n            onKeyboardHandler('onEnter'),\r\n            onKeyboardHandler('onShiftEnter'),\r\n            onKeyboardHandler('onLeft'),\r\n            onKeyboardHandler('onRight'),\r\n            onKeyboardHandler('onTab'),\r\n            onKeyboardHandler('onShiftTab'),\r\n            onKeyboardHandler('onUp'),\r\n            onKeyboardHandler('onDown'),\r\n            onKeyboardHandler('onEscape'),\r\n            defaulted$1('stopSpaceKeyup', false),\r\n            option('focusIn')\r\n        ];\r\n        var getKeydownRules$5 = function (component, simulatedEvent, specialInfo) {\r\n            return [\r\n                rule(inSet(SPACE()), specialInfo.onSpace),\r\n                rule(and([\r\n                    isNotShift,\r\n                    inSet(ENTER())\r\n                ]), specialInfo.onEnter),\r\n                rule(and([\r\n                    isShift,\r\n                    inSet(ENTER())\r\n                ]), specialInfo.onShiftEnter),\r\n                rule(and([\r\n                    isShift,\r\n                    inSet(TAB())\r\n                ]), specialInfo.onShiftTab),\r\n                rule(and([\r\n                    isNotShift,\r\n                    inSet(TAB())\r\n                ]), specialInfo.onTab),\r\n                rule(inSet(UP()), specialInfo.onUp),\r\n                rule(inSet(DOWN()), specialInfo.onDown),\r\n                rule(inSet(LEFT()), specialInfo.onLeft),\r\n                rule(inSet(RIGHT()), specialInfo.onRight),\r\n                rule(inSet(SPACE()), specialInfo.onSpace),\r\n                rule(inSet(ESCAPE()), specialInfo.onEscape)\r\n            ];\r\n        };\r\n        var getKeyupRules$5 = function (component, simulatedEvent, specialInfo) {\r\n            return specialInfo.stopSpaceKeyup ? [rule(inSet(SPACE()), stopEventForFirefox)] : [];\r\n        };\r\n        var SpecialType = typical(schema$8, NoState.init, getKeydownRules$5, getKeyupRules$5, function (specialInfo) {\r\n            return specialInfo.focusIn;\r\n        });\r\n        var acyclic = AcyclicType.schema();\r\n        var cyclic = CyclicType.schema();\r\n        var flow = FlowType.schema();\r\n        var flatgrid$1 = FlatgridType.schema();\r\n        var matrix = MatrixType.schema();\r\n        var execution = ExecutionType.schema();\r\n        var menu = MenuType.schema();\r\n        var special = SpecialType.schema();\r\n        var KeyboardBranches = Object.freeze({\r\n            acyclic: acyclic,\r\n            cyclic: cyclic,\r\n            flow: flow,\r\n            flatgrid: flatgrid$1,\r\n            matrix: matrix,\r\n            execution: execution,\r\n            menu: menu,\r\n            special: special\r\n        });\r\n        var Keying = createModes$1({\r\n            branchKey: 'mode',\r\n            branches: KeyboardBranches,\r\n            name: 'keying',\r\n            active: {\r\n                events: function (keyingConfig, keyingState) {\r\n                    var handler = keyingConfig.handler;\r\n                    return handler.toEvents(keyingConfig, keyingState);\r\n                }\r\n            },\r\n            apis: {\r\n                focusIn: function (component, keyConfig, keyState) {\r\n                    keyConfig.sendFocusIn(keyConfig).fold(function () {\r\n                        component.getSystem().triggerFocus(component.element(), component.element());\r\n                    }, function (sendFocusIn) {\r\n                        sendFocusIn(component, keyConfig, keyState);\r\n                    });\r\n                },\r\n                setGridSize: function (component, keyConfig, keyState, numRows, numColumns) {\r\n                    if (!hasKey$1(keyState, 'setGridSize')) {\r\n                        domGlobals.console.error('Layout does not support setGridSize');\r\n                    }\r\n                    else {\r\n                        keyState.setGridSize(numRows, numColumns);\r\n                    }\r\n                }\r\n            },\r\n            state: KeyingState\r\n        });\r\n        var preserve$1 = function (f, container) {\r\n            var ownerDoc = owner(container);\r\n            var refocus = active(ownerDoc).bind(function (focused) {\r\n                var hasFocus = function (elem) {\r\n                    return eq(focused, elem);\r\n                };\r\n                return hasFocus(container) ? Option.some(container) : descendant(container, hasFocus);\r\n            });\r\n            var result = f(container);\r\n            refocus.each(function (oldFocus) {\r\n                active(ownerDoc).filter(function (newFocus) {\r\n                    return eq(newFocus, oldFocus);\r\n                }).fold(function () {\r\n                    focus$1(oldFocus);\r\n                }, noop);\r\n            });\r\n            return result;\r\n        };\r\n        var set$5 = function (component, replaceConfig, replaceState, data) {\r\n            detachChildren(component);\r\n            preserve$1(function () {\r\n                var children = map(data, component.getSystem().build);\r\n                each(children, function (l) {\r\n                    attach(component, l);\r\n                });\r\n            }, component.element());\r\n        };\r\n        var insert = function (component, replaceConfig, insertion, childSpec) {\r\n            var child = component.getSystem().build(childSpec);\r\n            attachWith(component, child, insertion);\r\n        };\r\n        var append$2 = function (component, replaceConfig, replaceState, appendee) {\r\n            insert(component, replaceConfig, append, appendee);\r\n        };\r\n        var prepend$1 = function (component, replaceConfig, replaceState, prependee) {\r\n            insert(component, replaceConfig, prepend, prependee);\r\n        };\r\n        var remove$7 = function (component, replaceConfig, replaceState, removee) {\r\n            var children = contents(component, replaceConfig);\r\n            var foundChild = find(children, function (child) {\r\n                return eq(removee.element(), child.element());\r\n            });\r\n            foundChild.each(detach);\r\n        };\r\n        var contents = function (component, replaceConfig) {\r\n            return component.components();\r\n        };\r\n        var replaceAt = function (component, replaceConfig, replaceState, replaceeIndex, replacer) {\r\n            var children = contents(component, replaceConfig);\r\n            return Option.from(children[replaceeIndex]).map(function (replacee) {\r\n                remove$7(component, replaceConfig, replaceState, replacee);\r\n                replacer.each(function (r) {\r\n                    insert(component, replaceConfig, function (p, c) {\r\n                        appendAt(p, c, replaceeIndex);\r\n                    }, r);\r\n                });\r\n                return replacee;\r\n            });\r\n        };\r\n        var replaceBy = function (component, replaceConfig, replaceState, replaceePred, replacer) {\r\n            var children = contents(component, replaceConfig);\r\n            return findIndex(children, replaceePred).bind(function (replaceeIndex) {\r\n                return replaceAt(component, replaceConfig, replaceState, replaceeIndex, replacer);\r\n            });\r\n        };\r\n        var ReplaceApis = Object.freeze({\r\n            append: append$2,\r\n            prepend: prepend$1,\r\n            remove: remove$7,\r\n            replaceAt: replaceAt,\r\n            replaceBy: replaceBy,\r\n            set: set$5,\r\n            contents: contents\r\n        });\r\n        var Replacing = create$1({\r\n            fields: [],\r\n            name: 'replacing',\r\n            apis: ReplaceApis\r\n        });\r\n        var onLoad = function (component, repConfig, repState) {\r\n            repConfig.store.manager.onLoad(component, repConfig, repState);\r\n        };\r\n        var onUnload = function (component, repConfig, repState) {\r\n            repConfig.store.manager.onUnload(component, repConfig, repState);\r\n        };\r\n        var setValue = function (component, repConfig, repState, data) {\r\n            repConfig.store.manager.setValue(component, repConfig, repState, data);\r\n        };\r\n        var getValue = function (component, repConfig, repState) {\r\n            return repConfig.store.manager.getValue(component, repConfig, repState);\r\n        };\r\n        var getState$1 = function (component, repConfig, repState) {\r\n            return repState;\r\n        };\r\n        var RepresentApis = Object.freeze({\r\n            onLoad: onLoad,\r\n            onUnload: onUnload,\r\n            setValue: setValue,\r\n            getValue: getValue,\r\n            getState: getState$1\r\n        });\r\n        var events$3 = function (repConfig, repState) {\r\n            var es = repConfig.resetOnDom ? [\r\n                runOnAttached(function (comp, se) {\r\n                    onLoad(comp, repConfig, repState);\r\n                }),\r\n                runOnDetached(function (comp, se) {\r\n                    onUnload(comp, repConfig, repState);\r\n                })\r\n            ] : [loadEvent(repConfig, repState, onLoad)];\r\n            return derive(es);\r\n        };\r\n        var ActiveRepresenting = Object.freeze({\r\n            events: events$3\r\n        });\r\n        var memory = function () {\r\n            var data = Cell(null);\r\n            var readState = function () {\r\n                return {\r\n                    mode: 'memory',\r\n                    value: data.get()\r\n                };\r\n            };\r\n            var isNotSet = function () {\r\n                return data.get() === null;\r\n            };\r\n            var clear = function () {\r\n                data.set(null);\r\n            };\r\n            return nu$5({\r\n                set: data.set,\r\n                get: data.get,\r\n                isNotSet: isNotSet,\r\n                clear: clear,\r\n                readState: readState\r\n            });\r\n        };\r\n        var manual = function () {\r\n            var readState = function () {\r\n            };\r\n            return nu$5({ readState: readState });\r\n        };\r\n        var dataset = function () {\r\n            var dataByValue = Cell({});\r\n            var dataByText = Cell({});\r\n            var readState = function () {\r\n                return {\r\n                    mode: 'dataset',\r\n                    dataByValue: dataByValue.get(),\r\n                    dataByText: dataByText.get()\r\n                };\r\n            };\r\n            var clear = function () {\r\n                dataByValue.set({});\r\n                dataByText.set({});\r\n            };\r\n            var lookup = function (itemString) {\r\n                return readOptFrom$1(dataByValue.get(), itemString).orThunk(function () {\r\n                    return readOptFrom$1(dataByText.get(), itemString);\r\n                });\r\n            };\r\n            var update = function (items) {\r\n                var currentDataByValue = dataByValue.get();\r\n                var currentDataByText = dataByText.get();\r\n                var newDataByValue = {};\r\n                var newDataByText = {};\r\n                each(items, function (item) {\r\n                    newDataByValue[item.value] = item;\r\n                    readOptFrom$1(item, 'meta').each(function (meta) {\r\n                        readOptFrom$1(meta, 'text').each(function (text) {\r\n                            newDataByText[text] = item;\r\n                        });\r\n                    });\r\n                });\r\n                dataByValue.set(__assign({}, currentDataByValue, newDataByValue));\r\n                dataByText.set(__assign({}, currentDataByText, newDataByText));\r\n            };\r\n            return nu$5({\r\n                readState: readState,\r\n                lookup: lookup,\r\n                update: update,\r\n                clear: clear\r\n            });\r\n        };\r\n        var init$2 = function (spec) {\r\n            return spec.store.manager.state(spec);\r\n        };\r\n        var RepresentState = Object.freeze({\r\n            memory: memory,\r\n            dataset: dataset,\r\n            manual: manual,\r\n            init: init$2\r\n        });\r\n        var setValue$1 = function (component, repConfig, repState, data) {\r\n            var store = repConfig.store;\r\n            repState.update([data]);\r\n            store.setValue(component, data);\r\n            repConfig.onSetValue(component, data);\r\n        };\r\n        var getValue$1 = function (component, repConfig, repState) {\r\n            var store = repConfig.store;\r\n            var key = store.getDataKey(component);\r\n            return repState.lookup(key).fold(function () {\r\n                return store.getFallbackEntry(key);\r\n            }, function (data) {\r\n                return data;\r\n            });\r\n        };\r\n        var onLoad$1 = function (component, repConfig, repState) {\r\n            var store = repConfig.store;\r\n            store.initialValue.each(function (data) {\r\n                setValue$1(component, repConfig, repState, data);\r\n            });\r\n        };\r\n        var onUnload$1 = function (component, repConfig, repState) {\r\n            repState.clear();\r\n        };\r\n        var DatasetStore = [\r\n            option('initialValue'),\r\n            strict$1('getFallbackEntry'),\r\n            strict$1('getDataKey'),\r\n            strict$1('setValue'),\r\n            output('manager', {\r\n                setValue: setValue$1,\r\n                getValue: getValue$1,\r\n                onLoad: onLoad$1,\r\n                onUnload: onUnload$1,\r\n                state: dataset\r\n            })\r\n        ];\r\n        var getValue$2 = function (component, repConfig, repState) {\r\n            return repConfig.store.getValue(component);\r\n        };\r\n        var setValue$2 = function (component, repConfig, repState, data) {\r\n            repConfig.store.setValue(component, data);\r\n            repConfig.onSetValue(component, data);\r\n        };\r\n        var onLoad$2 = function (component, repConfig, repState) {\r\n            repConfig.store.initialValue.each(function (data) {\r\n                repConfig.store.setValue(component, data);\r\n            });\r\n        };\r\n        var ManualStore = [\r\n            strict$1('getValue'),\r\n            defaulted$1('setValue', noop),\r\n            option('initialValue'),\r\n            output('manager', {\r\n                setValue: setValue$2,\r\n                getValue: getValue$2,\r\n                onLoad: onLoad$2,\r\n                onUnload: noop,\r\n                state: NoState.init\r\n            })\r\n        ];\r\n        var setValue$3 = function (component, repConfig, repState, data) {\r\n            repState.set(data);\r\n            repConfig.onSetValue(component, data);\r\n        };\r\n        var getValue$3 = function (component, repConfig, repState) {\r\n            return repState.get();\r\n        };\r\n        var onLoad$3 = function (component, repConfig, repState) {\r\n            repConfig.store.initialValue.each(function (initVal) {\r\n                if (repState.isNotSet()) {\r\n                    repState.set(initVal);\r\n                }\r\n            });\r\n        };\r\n        var onUnload$2 = function (component, repConfig, repState) {\r\n            repState.clear();\r\n        };\r\n        var MemoryStore = [\r\n            option('initialValue'),\r\n            output('manager', {\r\n                setValue: setValue$3,\r\n                getValue: getValue$3,\r\n                onLoad: onLoad$3,\r\n                onUnload: onUnload$2,\r\n                state: memory\r\n            })\r\n        ];\r\n        var RepresentSchema = [\r\n            defaultedOf('store', { mode: 'memory' }, choose$1('mode', {\r\n                memory: MemoryStore,\r\n                manual: ManualStore,\r\n                dataset: DatasetStore\r\n            })),\r\n            onHandler('onSetValue'),\r\n            defaulted$1('resetOnDom', false)\r\n        ];\r\n        var Representing = create$1({\r\n            fields: RepresentSchema,\r\n            name: 'representing',\r\n            active: ActiveRepresenting,\r\n            apis: RepresentApis,\r\n            extra: {\r\n                setValueFrom: function (component, source) {\r\n                    var value = Representing.getValue(source);\r\n                    Representing.setValue(component, value);\r\n                }\r\n            },\r\n            state: RepresentState\r\n        });\r\n        var focus$2 = function (component, focusConfig) {\r\n            if (!focusConfig.ignore) {\r\n                focus$1(component.element());\r\n                focusConfig.onFocus(component);\r\n            }\r\n        };\r\n        var blur$1 = function (component, focusConfig) {\r\n            if (!focusConfig.ignore) {\r\n                blur(component.element());\r\n            }\r\n        };\r\n        var isFocused = function (component) {\r\n            return hasFocus(component.element());\r\n        };\r\n        var FocusApis = Object.freeze({\r\n            focus: focus$2,\r\n            blur: blur$1,\r\n            isFocused: isFocused\r\n        });\r\n        var exhibit$1 = function (base, focusConfig) {\r\n            var mod = focusConfig.ignore ? {} : { attributes: { tabindex: '-1' } };\r\n            return nu$6(mod);\r\n        };\r\n        var events$4 = function (focusConfig) {\r\n            return derive([run(focus(), function (component, simulatedEvent) {\r\n                    focus$2(component, focusConfig);\r\n                    simulatedEvent.stop();\r\n                })].concat(focusConfig.stopMousedown ? [run(mousedown(), function (_, simulatedEvent) {\r\n                    simulatedEvent.event().prevent();\r\n                })] : []));\r\n        };\r\n        var ActiveFocus = Object.freeze({\r\n            exhibit: exhibit$1,\r\n            events: events$4\r\n        });\r\n        var FocusSchema = [\r\n            onHandler('onFocus'),\r\n            defaulted$1('stopMousedown', false),\r\n            defaulted$1('ignore', false)\r\n        ];\r\n        var Focusing = create$1({\r\n            fields: FocusSchema,\r\n            name: 'focusing',\r\n            active: ActiveFocus,\r\n            apis: FocusApis\r\n        });\r\n        var updateAriaState = function (component, toggleConfig, toggleState) {\r\n            var ariaInfo = toggleConfig.aria;\r\n            ariaInfo.update(component, ariaInfo, toggleState.get());\r\n        };\r\n        var updateClass = function (component, toggleConfig, toggleState) {\r\n            toggleConfig.toggleClass.each(function (toggleClass) {\r\n                if (toggleState.get()) {\r\n                    add$2(component.element(), toggleClass);\r\n                }\r\n                else {\r\n                    remove$4(component.element(), toggleClass);\r\n                }\r\n            });\r\n        };\r\n        var toggle$2 = function (component, toggleConfig, toggleState) {\r\n            set$6(component, toggleConfig, toggleState, !toggleState.get());\r\n        };\r\n        var on = function (component, toggleConfig, toggleState) {\r\n            toggleState.set(true);\r\n            updateClass(component, toggleConfig, toggleState);\r\n            updateAriaState(component, toggleConfig, toggleState);\r\n        };\r\n        var off = function (component, toggleConfig, toggleState) {\r\n            toggleState.set(false);\r\n            updateClass(component, toggleConfig, toggleState);\r\n            updateAriaState(component, toggleConfig, toggleState);\r\n        };\r\n        var set$6 = function (component, toggleConfig, toggleState, state) {\r\n            var action = state ? on : off;\r\n            action(component, toggleConfig, toggleState);\r\n        };\r\n        var isOn = function (component, toggleConfig, toggleState) {\r\n            return toggleState.get();\r\n        };\r\n        var onLoad$4 = function (component, toggleConfig, toggleState) {\r\n            set$6(component, toggleConfig, toggleState, toggleConfig.selected);\r\n        };\r\n        var ToggleApis = Object.freeze({\r\n            onLoad: onLoad$4,\r\n            toggle: toggle$2,\r\n            isOn: isOn,\r\n            on: on,\r\n            off: off,\r\n            set: set$6\r\n        });\r\n        var exhibit$2 = function (base, toggleConfig, toggleState) {\r\n            return nu$6({});\r\n        };\r\n        var events$5 = function (toggleConfig, toggleState) {\r\n            var execute = executeEvent(toggleConfig, toggleState, toggle$2);\r\n            var load = loadEvent(toggleConfig, toggleState, onLoad$4);\r\n            return derive(flatten([\r\n                toggleConfig.toggleOnExecute ? [execute] : [],\r\n                [load]\r\n            ]));\r\n        };\r\n        var ActiveToggle = Object.freeze({\r\n            exhibit: exhibit$2,\r\n            events: events$5\r\n        });\r\n        var SetupBehaviourCellState = function (initialState) {\r\n            var init = function () {\r\n                var cell = Cell(initialState);\r\n                var get = function () {\r\n                    return cell.get();\r\n                };\r\n                var set = function (newState) {\r\n                    return cell.set(newState);\r\n                };\r\n                var clear = function () {\r\n                    return cell.set(initialState);\r\n                };\r\n                var readState = function () {\r\n                    return cell.get();\r\n                };\r\n                return {\r\n                    get: get,\r\n                    set: set,\r\n                    clear: clear,\r\n                    readState: readState\r\n                };\r\n            };\r\n            return { init: init };\r\n        };\r\n        var updatePressed = function (component, ariaInfo, status) {\r\n            set$1(component.element(), 'aria-pressed', status);\r\n            if (ariaInfo.syncWithExpanded) {\r\n                updateExpanded(component, ariaInfo, status);\r\n            }\r\n        };\r\n        var updateSelected = function (component, ariaInfo, status) {\r\n            set$1(component.element(), 'aria-selected', status);\r\n        };\r\n        var updateChecked = function (component, ariaInfo, status) {\r\n            set$1(component.element(), 'aria-checked', status);\r\n        };\r\n        var updateExpanded = function (component, ariaInfo, status) {\r\n            set$1(component.element(), 'aria-expanded', status);\r\n        };\r\n        var ToggleSchema = [\r\n            defaulted$1('selected', false),\r\n            option('toggleClass'),\r\n            defaulted$1('toggleOnExecute', true),\r\n            defaultedOf('aria', { mode: 'none' }, choose$1('mode', {\r\n                pressed: [\r\n                    defaulted$1('syncWithExpanded', false),\r\n                    output('update', updatePressed)\r\n                ],\r\n                checked: [output('update', updateChecked)],\r\n                expanded: [output('update', updateExpanded)],\r\n                selected: [output('update', updateSelected)],\r\n                none: [output('update', noop)]\r\n            }))\r\n        ];\r\n        var Toggling = create$1({\r\n            fields: ToggleSchema,\r\n            name: 'toggling',\r\n            active: ActiveToggle,\r\n            apis: ToggleApis,\r\n            state: SetupBehaviourCellState(false)\r\n        });\r\n        var hoverEvent = 'alloy.item-hover';\r\n        var focusEvent = 'alloy.item-focus';\r\n        var onHover = function (item) {\r\n            if (search$1(item.element()).isNone() || Focusing.isFocused(item)) {\r\n                if (!Focusing.isFocused(item)) {\r\n                    Focusing.focus(item);\r\n                }\r\n                emitWith(item, hoverEvent, { item: item });\r\n            }\r\n        };\r\n        var onFocus = function (item) {\r\n            emitWith(item, focusEvent, { item: item });\r\n        };\r\n        var hover = constant(hoverEvent);\r\n        var focus$3 = constant(focusEvent);\r\n        var events$6 = function (name, eventHandlers) {\r\n            var events = derive(eventHandlers);\r\n            return create$1({\r\n                fields: [strict$1('enabled')],\r\n                name: name,\r\n                active: { events: constant(events) }\r\n            });\r\n        };\r\n        var config = function (name, eventHandlers) {\r\n            var me = events$6(name, eventHandlers);\r\n            return {\r\n                key: name,\r\n                value: {\r\n                    config: {},\r\n                    me: me,\r\n                    configAsRaw: constant({}),\r\n                    initialConfig: {},\r\n                    state: NoState\r\n                }\r\n            };\r\n        };\r\n        var builder = function (detail) {\r\n            return {\r\n                dom: detail.dom,\r\n                domModification: __assign({}, detail.domModification, { attributes: __assign({ 'role': detail.toggling.isSome() ? 'menuitemcheckbox' : 'menuitem' }, detail.domModification.attributes, { 'aria-haspopup': detail.hasSubmenu }, detail.hasSubmenu ? { 'aria-expanded': false } : {}) }),\r\n                behaviours: SketchBehaviours.augment(detail.itemBehaviours, [\r\n                    detail.toggling.fold(Toggling.revoke, function (tConfig) {\r\n                        return Toggling.config(__assign({ aria: { mode: 'checked' } }, tConfig));\r\n                    }),\r\n                    Focusing.config({\r\n                        ignore: detail.ignoreFocus,\r\n                        stopMousedown: detail.ignoreFocus,\r\n                        onFocus: function (component) {\r\n                            onFocus(component);\r\n                        }\r\n                    }),\r\n                    Keying.config({ mode: 'execution' }),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: detail.data\r\n                        }\r\n                    }),\r\n                    config('item-type-events', [\r\n                        run(tapOrClick(), emitExecute),\r\n                        cutter(mousedown()),\r\n                        run(mouseover(), onHover),\r\n                        run(focusItem(), Focusing.focus)\r\n                    ])\r\n                ]),\r\n                components: detail.components,\r\n                eventOrder: detail.eventOrder\r\n            };\r\n        };\r\n        var schema$9 = [\r\n            strict$1('data'),\r\n            strict$1('components'),\r\n            strict$1('dom'),\r\n            defaulted$1('hasSubmenu', false),\r\n            option('toggling'),\r\n            SketchBehaviours.field('itemBehaviours', [\r\n                Toggling,\r\n                Focusing,\r\n                Keying,\r\n                Representing\r\n            ]),\r\n            defaulted$1('ignoreFocus', false),\r\n            defaulted$1('domModification', {}),\r\n            output('builder', builder),\r\n            defaulted$1('eventOrder', {})\r\n        ];\r\n        var builder$1 = function (detail) {\r\n            return {\r\n                dom: detail.dom,\r\n                components: detail.components,\r\n                events: derive([stopper(focusItem())])\r\n            };\r\n        };\r\n        var schema$a = [\r\n            strict$1('dom'),\r\n            strict$1('components'),\r\n            output('builder', builder$1)\r\n        ];\r\n        var owner$2 = function () {\r\n            return 'item-widget';\r\n        };\r\n        var parts = constant([required({\r\n                name: 'widget',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        behaviours: derive$1([Representing.config({\r\n                                store: {\r\n                                    mode: 'manual',\r\n                                    getValue: function (component) {\r\n                                        return detail.data;\r\n                                    },\r\n                                    setValue: function () {\r\n                                    }\r\n                                }\r\n                            })])\r\n                    };\r\n                }\r\n            })]);\r\n        var builder$2 = function (detail) {\r\n            var subs = substitutes(owner$2(), detail, parts());\r\n            var components$1 = components(owner$2(), detail, subs.internals());\r\n            var focusWidget = function (component) {\r\n                return getPart(component, detail, 'widget').map(function (widget) {\r\n                    Keying.focusIn(widget);\r\n                    return widget;\r\n                });\r\n            };\r\n            var onHorizontalArrow = function (component, simulatedEvent) {\r\n                return inside(simulatedEvent.event().target()) ? Option.none() : function () {\r\n                    if (detail.autofocus) {\r\n                        simulatedEvent.setSource(component.element());\r\n                        return Option.none();\r\n                    }\r\n                    else {\r\n                        return Option.none();\r\n                    }\r\n                }();\r\n            };\r\n            return {\r\n                dom: detail.dom,\r\n                components: components$1,\r\n                domModification: detail.domModification,\r\n                events: derive([\r\n                    runOnExecute(function (component, simulatedEvent) {\r\n                        focusWidget(component).each(function (widget) {\r\n                            simulatedEvent.stop();\r\n                        });\r\n                    }),\r\n                    run(mouseover(), onHover),\r\n                    run(focusItem(), function (component, simulatedEvent) {\r\n                        if (detail.autofocus) {\r\n                            focusWidget(component);\r\n                        }\r\n                        else {\r\n                            Focusing.focus(component);\r\n                        }\r\n                    })\r\n                ]),\r\n                behaviours: SketchBehaviours.augment(detail.widgetBehaviours, [\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: detail.data\r\n                        }\r\n                    }),\r\n                    Focusing.config({\r\n                        ignore: detail.ignoreFocus,\r\n                        onFocus: function (component) {\r\n                            onFocus(component);\r\n                        }\r\n                    }),\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        focusIn: detail.autofocus ? function (component) {\r\n                            focusWidget(component);\r\n                        } : revoke(),\r\n                        onLeft: onHorizontalArrow,\r\n                        onRight: onHorizontalArrow,\r\n                        onEscape: function (component, simulatedEvent) {\r\n                            if (!Focusing.isFocused(component) && !detail.autofocus) {\r\n                                Focusing.focus(component);\r\n                                return Option.some(true);\r\n                            }\r\n                            else if (detail.autofocus) {\r\n                                simulatedEvent.setSource(component.element());\r\n                                return Option.none();\r\n                            }\r\n                            else {\r\n                                return Option.none();\r\n                            }\r\n                        }\r\n                    })\r\n                ])\r\n            };\r\n        };\r\n        var schema$b = [\r\n            strict$1('uid'),\r\n            strict$1('data'),\r\n            strict$1('components'),\r\n            strict$1('dom'),\r\n            defaulted$1('autofocus', false),\r\n            defaulted$1('ignoreFocus', false),\r\n            SketchBehaviours.field('widgetBehaviours', [\r\n                Representing,\r\n                Focusing,\r\n                Keying\r\n            ]),\r\n            defaulted$1('domModification', {}),\r\n            defaultUidsSchema(parts()),\r\n            output('builder', builder$2)\r\n        ];\r\n        var itemSchema$1 = choose$1('type', {\r\n            widget: schema$b,\r\n            item: schema$9,\r\n            separator: schema$a\r\n        });\r\n        var configureGrid = function (detail, movementInfo) {\r\n            return {\r\n                mode: 'flatgrid',\r\n                selector: '.' + detail.markers.item,\r\n                initSize: {\r\n                    numColumns: movementInfo.initSize.numColumns,\r\n                    numRows: movementInfo.initSize.numRows\r\n                },\r\n                focusManager: detail.focusManager\r\n            };\r\n        };\r\n        var configureMatrix = function (detail, movementInfo) {\r\n            return {\r\n                mode: 'matrix',\r\n                selectors: {\r\n                    row: movementInfo.rowSelector,\r\n                    cell: '.' + detail.markers.item\r\n                },\r\n                focusManager: detail.focusManager\r\n            };\r\n        };\r\n        var configureMenu = function (detail, movementInfo) {\r\n            return {\r\n                mode: 'menu',\r\n                selector: '.' + detail.markers.item,\r\n                moveOnTab: movementInfo.moveOnTab,\r\n                focusManager: detail.focusManager\r\n            };\r\n        };\r\n        var parts$1 = constant([group({\r\n                factory: {\r\n                    sketch: function (spec) {\r\n                        var itemInfo = asRawOrDie('menu.spec item', itemSchema$1, spec);\r\n                        return itemInfo.builder(itemInfo);\r\n                    }\r\n                },\r\n                name: 'items',\r\n                unit: 'item',\r\n                defaults: function (detail, u) {\r\n                    return u.hasOwnProperty('uid') ? u : __assign({}, u, { uid: generate$2('item') });\r\n                },\r\n                overrides: function (detail, u) {\r\n                    return {\r\n                        type: u.type,\r\n                        ignoreFocus: detail.fakeFocus,\r\n                        domModification: { classes: [detail.markers.item] }\r\n                    };\r\n                }\r\n            })]);\r\n        var schema$c = constant([\r\n            strict$1('value'),\r\n            strict$1('items'),\r\n            strict$1('dom'),\r\n            strict$1('components'),\r\n            defaulted$1('eventOrder', {}),\r\n            field$1('menuBehaviours', [\r\n                Highlighting,\r\n                Representing,\r\n                Composing,\r\n                Keying\r\n            ]),\r\n            defaultedOf('movement', {\r\n                mode: 'menu',\r\n                moveOnTab: true\r\n            }, choose$1('mode', {\r\n                grid: [\r\n                    initSize(),\r\n                    output('config', configureGrid)\r\n                ],\r\n                matrix: [\r\n                    output('config', configureMatrix),\r\n                    strict$1('rowSelector')\r\n                ],\r\n                menu: [\r\n                    defaulted$1('moveOnTab', true),\r\n                    output('config', configureMenu)\r\n                ]\r\n            })),\r\n            itemMarkers(),\r\n            defaulted$1('fakeFocus', false),\r\n            defaulted$1('focusManager', dom()),\r\n            onHandler('onHighlight')\r\n        ]);\r\n        var focus$4 = constant('alloy.menu-focus');\r\n        var make$1 = function (detail, components, spec, externals) {\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                markers: detail.markers,\r\n                behaviours: augment(detail.menuBehaviours, [\r\n                    Highlighting.config({\r\n                        highlightClass: detail.markers.selectedItem,\r\n                        itemClass: detail.markers.item,\r\n                        onHighlight: detail.onHighlight\r\n                    }),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: detail.value\r\n                        }\r\n                    }),\r\n                    Composing.config({ find: Option.some }),\r\n                    Keying.config(detail.movement.config(detail, detail.movement))\r\n                ]),\r\n                events: derive([\r\n                    run(focus$3(), function (menu, simulatedEvent) {\r\n                        var event = simulatedEvent.event();\r\n                        menu.getSystem().getByDom(event.target()).each(function (item) {\r\n                            Highlighting.highlight(menu, item);\r\n                            simulatedEvent.stop();\r\n                            emitWith(menu, focus$4(), {\r\n                                menu: menu,\r\n                                item: item\r\n                            });\r\n                        });\r\n                    }),\r\n                    run(hover(), function (menu, simulatedEvent) {\r\n                        var item = simulatedEvent.event().item();\r\n                        Highlighting.highlight(menu, item);\r\n                    })\r\n                ]),\r\n                components: components,\r\n                eventOrder: detail.eventOrder,\r\n                domModification: { attributes: { role: 'menu' } }\r\n            };\r\n        };\r\n        var Menu = composite$1({\r\n            name: 'Menu',\r\n            configFields: schema$c(),\r\n            partFields: parts$1(),\r\n            factory: make$1\r\n        });\r\n        var transpose = function (obj) {\r\n            return tupleMap(obj, function (v, k) {\r\n                return {\r\n                    k: v,\r\n                    v: k\r\n                };\r\n            });\r\n        };\r\n        var trace = function (items, byItem, byMenu, finish) {\r\n            return readOptFrom$1(byMenu, finish).bind(function (triggerItem) {\r\n                return readOptFrom$1(items, triggerItem).bind(function (triggerMenu) {\r\n                    var rest = trace(items, byItem, byMenu, triggerMenu);\r\n                    return Option.some([triggerMenu].concat(rest));\r\n                });\r\n            }).getOr([]);\r\n        };\r\n        var generate$5 = function (menus, expansions) {\r\n            var items = {};\r\n            each$1(menus, function (menuItems, menu) {\r\n                each(menuItems, function (item) {\r\n                    items[item] = menu;\r\n                });\r\n            });\r\n            var byItem = expansions;\r\n            var byMenu = transpose(expansions);\r\n            var menuPaths = map$1(byMenu, function (_triggerItem, submenu) {\r\n                return [submenu].concat(trace(items, byItem, byMenu, submenu));\r\n            });\r\n            return map$1(items, function (menu) {\r\n                return readOptFrom$1(menuPaths, menu).getOr([menu]);\r\n            });\r\n        };\r\n        var init$3 = function () {\r\n            var expansions = Cell({});\r\n            var menus = Cell({});\r\n            var paths = Cell({});\r\n            var primary = Cell(Option.none());\r\n            var directory = Cell({});\r\n            var clear = function () {\r\n                expansions.set({});\r\n                menus.set({});\r\n                paths.set({});\r\n                primary.set(Option.none());\r\n            };\r\n            var isClear = function () {\r\n                return primary.get().isNone();\r\n            };\r\n            var setMenuBuilt = function (menuName, built) {\r\n                var _a;\r\n                menus.set(__assign({}, menus.get(), (_a = {}, _a[menuName] = {\r\n                    type: 'prepared',\r\n                    menu: built\r\n                }, _a)));\r\n            };\r\n            var setContents = function (sPrimary, sMenus, sExpansions, dir) {\r\n                primary.set(Option.some(sPrimary));\r\n                expansions.set(sExpansions);\r\n                menus.set(sMenus);\r\n                directory.set(dir);\r\n                var sPaths = generate$5(dir, sExpansions);\r\n                paths.set(sPaths);\r\n            };\r\n            var expand = function (itemValue) {\r\n                return readOptFrom$1(expansions.get(), itemValue).map(function (menu) {\r\n                    var current = readOptFrom$1(paths.get(), itemValue).getOr([]);\r\n                    return [menu].concat(current);\r\n                });\r\n            };\r\n            var collapse = function (itemValue) {\r\n                return readOptFrom$1(paths.get(), itemValue).bind(function (path) {\r\n                    return path.length > 1 ? Option.some(path.slice(1)) : Option.none();\r\n                });\r\n            };\r\n            var refresh = function (itemValue) {\r\n                return readOptFrom$1(paths.get(), itemValue);\r\n            };\r\n            var lookupMenu = function (menuValue) {\r\n                return readOptFrom$1(menus.get(), menuValue);\r\n            };\r\n            var otherMenus = function (path) {\r\n                var menuValues = directory.get();\r\n                return difference(keys(menuValues), path);\r\n            };\r\n            var getPrimary = function () {\r\n                return primary.get().bind(function (primaryName) {\r\n                    return lookupMenu(primaryName).bind(function (prep) {\r\n                        return prep.type === 'prepared' ? Option.some(prep.menu) : Option.none();\r\n                    });\r\n                });\r\n            };\r\n            var getMenus = function () {\r\n                return menus.get();\r\n            };\r\n            return {\r\n                setMenuBuilt: setMenuBuilt,\r\n                setContents: setContents,\r\n                expand: expand,\r\n                refresh: refresh,\r\n                collapse: collapse,\r\n                lookupMenu: lookupMenu,\r\n                otherMenus: otherMenus,\r\n                getPrimary: getPrimary,\r\n                getMenus: getMenus,\r\n                clear: clear,\r\n                isClear: isClear\r\n            };\r\n        };\r\n        var LayeredState = { init: init$3 };\r\n        var make$2 = function (detail, rawUiSpec) {\r\n            var submenuParentItems = Cell(Option.none());\r\n            var buildMenus = function (container, primaryName, menus) {\r\n                return map$1(menus, function (spec, name) {\r\n                    var makeSketch = function () {\r\n                        return Menu.sketch(__assign({ dom: spec.dom }, spec, {\r\n                            value: name,\r\n                            items: spec.items,\r\n                            markers: detail.markers,\r\n                            fakeFocus: detail.fakeFocus,\r\n                            onHighlight: detail.onHighlight,\r\n                            focusManager: detail.fakeFocus ? highlights() : dom()\r\n                        }));\r\n                    };\r\n                    return name === primaryName ? {\r\n                        type: 'prepared',\r\n                        menu: container.getSystem().build(makeSketch())\r\n                    } : {\r\n                        type: 'notbuilt',\r\n                        nbMenu: makeSketch\r\n                    };\r\n                });\r\n            };\r\n            var layeredState = LayeredState.init();\r\n            var setup = function (container) {\r\n                var componentMap = buildMenus(container, detail.data.primary, detail.data.menus);\r\n                var directory = toDirectory(container);\r\n                layeredState.setContents(detail.data.primary, componentMap, detail.data.expansions, directory);\r\n                return layeredState.getPrimary();\r\n            };\r\n            var getItemValue = function (item) {\r\n                return Representing.getValue(item).value;\r\n            };\r\n            var toDirectory = function (container) {\r\n                return map$1(detail.data.menus, function (data, menuName) {\r\n                    return bind(data.items, function (item) {\r\n                        return item.type === 'separator' ? [] : [item.data.value];\r\n                    });\r\n                });\r\n            };\r\n            var setActiveMenu = function (container, menu) {\r\n                Highlighting.highlight(container, menu);\r\n                Highlighting.getHighlighted(menu).orThunk(function () {\r\n                    return Highlighting.getFirst(menu);\r\n                }).each(function (item) {\r\n                    dispatch(container, item.element(), focusItem());\r\n                });\r\n            };\r\n            var getMenus = function (state, menuValues) {\r\n                return cat(map(menuValues, function (mv) {\r\n                    return state.lookupMenu(mv).bind(function (prep) {\r\n                        return prep.type === 'prepared' ? Option.some(prep.menu) : Option.none();\r\n                    });\r\n                }));\r\n            };\r\n            var closeOthers = function (container, state, path) {\r\n                var others = getMenus(state, state.otherMenus(path));\r\n                each(others, function (o) {\r\n                    remove$5(o.element(), [detail.markers.backgroundMenu]);\r\n                    if (!detail.stayInDom) {\r\n                        Replacing.remove(container, o);\r\n                    }\r\n                });\r\n            };\r\n            var getSubmenuParents = function (container) {\r\n                return submenuParentItems.get().getOrThunk(function () {\r\n                    var r = {};\r\n                    var items = descendants(container.element(), '.' + detail.markers.item);\r\n                    var parentItems = filter(items, function (i) {\r\n                        return get$2(i, 'aria-haspopup') === 'true';\r\n                    });\r\n                    each(parentItems, function (i) {\r\n                        container.getSystem().getByDom(i).each(function (itemComp) {\r\n                            var key = getItemValue(itemComp);\r\n                            r[key] = itemComp;\r\n                        });\r\n                    });\r\n                    submenuParentItems.set(Option.some(r));\r\n                    return r;\r\n                });\r\n            };\r\n            var updateAriaExpansions = function (container, path) {\r\n                var parentItems = getSubmenuParents(container);\r\n                each$1(parentItems, function (v, k) {\r\n                    var expanded = contains(path, k);\r\n                    set$1(v.element(), 'aria-expanded', expanded);\r\n                });\r\n            };\r\n            var updateMenuPath = function (container, state, path) {\r\n                return Option.from(path[0]).bind(function (latestMenuName) {\r\n                    return state.lookupMenu(latestMenuName).bind(function (menuPrep) {\r\n                        if (menuPrep.type === 'notbuilt') {\r\n                            return Option.none();\r\n                        }\r\n                        else {\r\n                            var activeMenu = menuPrep.menu;\r\n                            var rest = getMenus(state, path.slice(1));\r\n                            each(rest, function (r) {\r\n                                add$2(r.element(), detail.markers.backgroundMenu);\r\n                            });\r\n                            if (!inBody(activeMenu.element())) {\r\n                                Replacing.append(container, premade$1(activeMenu));\r\n                            }\r\n                            remove$5(activeMenu.element(), [detail.markers.backgroundMenu]);\r\n                            setActiveMenu(container, activeMenu);\r\n                            closeOthers(container, state, path);\r\n                            return Option.some(activeMenu);\r\n                        }\r\n                    });\r\n                });\r\n            };\r\n            var ExpandHighlightDecision;\r\n            (function (ExpandHighlightDecision) {\r\n                ExpandHighlightDecision[ExpandHighlightDecision['HighlightSubmenu'] = 0] = 'HighlightSubmenu';\r\n                ExpandHighlightDecision[ExpandHighlightDecision['HighlightParent'] = 1] = 'HighlightParent';\r\n            }(ExpandHighlightDecision || (ExpandHighlightDecision = {})));\r\n            var buildIfRequired = function (container, menuName, menuPrep) {\r\n                if (menuPrep.type === 'notbuilt') {\r\n                    var menu = container.getSystem().build(menuPrep.nbMenu());\r\n                    layeredState.setMenuBuilt(menuName, menu);\r\n                    return menu;\r\n                }\r\n                else {\r\n                    return menuPrep.menu;\r\n                }\r\n            };\r\n            var expandRight = function (container, item, decision) {\r\n                if (decision === void 0) {\r\n                    decision = ExpandHighlightDecision.HighlightSubmenu;\r\n                }\r\n                var value = getItemValue(item);\r\n                return layeredState.expand(value).bind(function (path) {\r\n                    updateAriaExpansions(container, path);\r\n                    return Option.from(path[0]).bind(function (menuName) {\r\n                        return layeredState.lookupMenu(menuName).bind(function (activeMenuPrep) {\r\n                            var activeMenu = buildIfRequired(container, menuName, activeMenuPrep);\r\n                            if (!inBody(activeMenu.element())) {\r\n                                Replacing.append(container, premade$1(activeMenu));\r\n                            }\r\n                            detail.onOpenSubmenu(container, item, activeMenu);\r\n                            if (decision === ExpandHighlightDecision.HighlightSubmenu) {\r\n                                Highlighting.highlightFirst(activeMenu);\r\n                                return updateMenuPath(container, layeredState, path);\r\n                            }\r\n                            else {\r\n                                Highlighting.dehighlightAll(activeMenu);\r\n                                return Option.some(item);\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            };\r\n            var collapseLeft = function (container, item) {\r\n                var value = getItemValue(item);\r\n                return layeredState.collapse(value).bind(function (path) {\r\n                    updateAriaExpansions(container, path);\r\n                    return updateMenuPath(container, layeredState, path).map(function (activeMenu) {\r\n                        detail.onCollapseMenu(container, item, activeMenu);\r\n                        return activeMenu;\r\n                    });\r\n                });\r\n            };\r\n            var updateView = function (container, item) {\r\n                var value = getItemValue(item);\r\n                return layeredState.refresh(value).bind(function (path) {\r\n                    updateAriaExpansions(container, path);\r\n                    return updateMenuPath(container, layeredState, path);\r\n                });\r\n            };\r\n            var onRight = function (container, item) {\r\n                return inside(item.element()) ? Option.none() : expandRight(container, item, ExpandHighlightDecision.HighlightSubmenu);\r\n            };\r\n            var onLeft = function (container, item) {\r\n                return inside(item.element()) ? Option.none() : collapseLeft(container, item);\r\n            };\r\n            var onEscape = function (container, item) {\r\n                return collapseLeft(container, item).orThunk(function () {\r\n                    return detail.onEscape(container, item).map(function () {\r\n                        return container;\r\n                    });\r\n                });\r\n            };\r\n            var keyOnItem = function (f) {\r\n                return function (container, simulatedEvent) {\r\n                    return closest$3(simulatedEvent.getSource(), '.' + detail.markers.item).bind(function (target) {\r\n                        return container.getSystem().getByDom(target).toOption().bind(function (item) {\r\n                            return f(container, item).map(function () {\r\n                                return true;\r\n                            });\r\n                        });\r\n                    });\r\n                };\r\n            };\r\n            var events = derive([\r\n                run(focus$4(), function (sandbox, simulatedEvent) {\r\n                    var menu = simulatedEvent.event().menu();\r\n                    Highlighting.highlight(sandbox, menu);\r\n                    var value = getItemValue(simulatedEvent.event().item());\r\n                    layeredState.refresh(value).each(function (path) {\r\n                        return closeOthers(sandbox, layeredState, path);\r\n                    });\r\n                }),\r\n                runOnExecute(function (component, simulatedEvent) {\r\n                    var target = simulatedEvent.event().target();\r\n                    component.getSystem().getByDom(target).each(function (item) {\r\n                        var itemValue = getItemValue(item);\r\n                        if (itemValue.indexOf('collapse-item') === 0) {\r\n                            collapseLeft(component, item);\r\n                        }\r\n                        expandRight(component, item, ExpandHighlightDecision.HighlightSubmenu).fold(function () {\r\n                            detail.onExecute(component, item);\r\n                        }, function () {\r\n                        });\r\n                    });\r\n                }),\r\n                runOnAttached(function (container, simulatedEvent) {\r\n                    setup(container).each(function (primary) {\r\n                        Replacing.append(container, premade$1(primary));\r\n                        detail.onOpenMenu(container, primary);\r\n                        if (detail.highlightImmediately) {\r\n                            setActiveMenu(container, primary);\r\n                        }\r\n                    });\r\n                })\r\n            ].concat(detail.navigateOnHover ? [run(hover(), function (sandbox, simulatedEvent) {\r\n                    var item = simulatedEvent.event().item();\r\n                    updateView(sandbox, item);\r\n                    expandRight(sandbox, item, ExpandHighlightDecision.HighlightParent);\r\n                    detail.onHover(sandbox, item);\r\n                })] : []));\r\n            var collapseMenuApi = function (container) {\r\n                Highlighting.getHighlighted(container).each(function (currentMenu) {\r\n                    Highlighting.getHighlighted(currentMenu).each(function (currentItem) {\r\n                        collapseLeft(container, currentItem);\r\n                    });\r\n                });\r\n            };\r\n            var highlightPrimary = function (container) {\r\n                layeredState.getPrimary().each(function (primary) {\r\n                    setActiveMenu(container, primary);\r\n                });\r\n            };\r\n            var apis = {\r\n                collapseMenu: collapseMenuApi,\r\n                highlightPrimary: highlightPrimary\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                markers: detail.markers,\r\n                behaviours: augment(detail.tmenuBehaviours, [\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onRight: keyOnItem(onRight),\r\n                        onLeft: keyOnItem(onLeft),\r\n                        onEscape: keyOnItem(onEscape),\r\n                        focusIn: function (container, keyInfo) {\r\n                            layeredState.getPrimary().each(function (primary) {\r\n                                dispatch(container, primary.element(), focusItem());\r\n                            });\r\n                        }\r\n                    }),\r\n                    Highlighting.config({\r\n                        highlightClass: detail.markers.selectedMenu,\r\n                        itemClass: detail.markers.menu\r\n                    }),\r\n                    Composing.config({\r\n                        find: function (container) {\r\n                            return Highlighting.getHighlighted(container);\r\n                        }\r\n                    }),\r\n                    Replacing.config({})\r\n                ]),\r\n                eventOrder: detail.eventOrder,\r\n                apis: apis,\r\n                events: events\r\n            };\r\n        };\r\n        var collapseItem = constant('collapse-item');\r\n        var tieredData = function (primary, menus, expansions) {\r\n            return {\r\n                primary: primary,\r\n                menus: menus,\r\n                expansions: expansions\r\n            };\r\n        };\r\n        var singleData = function (name, menu) {\r\n            return {\r\n                primary: name,\r\n                menus: wrap$1(name, menu),\r\n                expansions: {}\r\n            };\r\n        };\r\n        var collapseItem$1 = function (text) {\r\n            return {\r\n                value: generate$1(collapseItem()),\r\n                meta: { text: text }\r\n            };\r\n        };\r\n        var tieredMenu = single$2({\r\n            name: 'TieredMenu',\r\n            configFields: [\r\n                onStrictKeyboardHandler('onExecute'),\r\n                onStrictKeyboardHandler('onEscape'),\r\n                onStrictHandler('onOpenMenu'),\r\n                onStrictHandler('onOpenSubmenu'),\r\n                onHandler('onCollapseMenu'),\r\n                defaulted$1('highlightImmediately', true),\r\n                strictObjOf('data', [\r\n                    strict$1('primary'),\r\n                    strict$1('menus'),\r\n                    strict$1('expansions')\r\n                ]),\r\n                defaulted$1('fakeFocus', false),\r\n                onHandler('onHighlight'),\r\n                onHandler('onHover'),\r\n                tieredMenuMarkers(),\r\n                strict$1('dom'),\r\n                defaulted$1('navigateOnHover', true),\r\n                defaulted$1('stayInDom', false),\r\n                field$1('tmenuBehaviours', [\r\n                    Keying,\r\n                    Highlighting,\r\n                    Composing,\r\n                    Replacing\r\n                ]),\r\n                defaulted$1('eventOrder', {})\r\n            ],\r\n            apis: {\r\n                collapseMenu: function (apis, tmenu) {\r\n                    apis.collapseMenu(tmenu);\r\n                },\r\n                highlightPrimary: function (apis, tmenu) {\r\n                    apis.highlightPrimary(tmenu);\r\n                }\r\n            },\r\n            factory: make$2,\r\n            extraApis: {\r\n                tieredData: tieredData,\r\n                singleData: singleData,\r\n                collapseItem: collapseItem$1\r\n            }\r\n        });\r\n        var makeMenu = function (detail, menuSandbox, anchor, menuSpec) {\r\n            var lazySink = function () {\r\n                return detail.lazySink(menuSandbox);\r\n            };\r\n            return tieredMenu.sketch({\r\n                dom: { tag: 'div' },\r\n                data: menuSpec.data,\r\n                markers: menuSpec.menu.markers,\r\n                onEscape: function () {\r\n                    Sandboxing.close(menuSandbox);\r\n                    detail.onEscape.map(function (handler) {\r\n                        return handler(menuSandbox);\r\n                    });\r\n                    return Option.some(true);\r\n                },\r\n                onExecute: function () {\r\n                    return Option.some(true);\r\n                },\r\n                onOpenMenu: function (tmenu, menu) {\r\n                    Positioning.position(lazySink().getOrDie(), anchor, menu);\r\n                },\r\n                onOpenSubmenu: function (tmenu, item, submenu) {\r\n                    var sink = lazySink().getOrDie();\r\n                    Positioning.position(sink, {\r\n                        anchor: 'submenu',\r\n                        item: item\r\n                    }, submenu);\r\n                }\r\n            });\r\n        };\r\n        var factory = function (detail, spec) {\r\n            var isPartOfRelated = function (sandbox, queryElem) {\r\n                var related = detail.getRelated(sandbox);\r\n                return related.exists(function (rel) {\r\n                    return isPartOf(rel, queryElem);\r\n                });\r\n            };\r\n            var setContent = function (sandbox, thing) {\r\n                Sandboxing.open(sandbox, thing);\r\n            };\r\n            var showAt = function (sandbox, anchor, thing) {\r\n                var getBounds = Option.none();\r\n                showWithin(sandbox, anchor, thing, getBounds);\r\n            };\r\n            var showWithin = function (sandbox, anchor, thing, boxElement) {\r\n                var sink = detail.lazySink(sandbox).getOrDie();\r\n                Sandboxing.openWhileCloaked(sandbox, thing, function () {\r\n                    return Positioning.positionWithin(sink, anchor, sandbox, boxElement);\r\n                });\r\n                detail.onShow(sandbox);\r\n            };\r\n            var showMenuAt = function (sandbox, anchor, menuSpec) {\r\n                var menu = makeMenu(detail, sandbox, anchor, menuSpec);\r\n                Sandboxing.open(sandbox, menu);\r\n                detail.onShow(sandbox);\r\n            };\r\n            var hide = function (sandbox) {\r\n                Sandboxing.close(sandbox);\r\n                detail.onHide(sandbox);\r\n            };\r\n            var getContent = function (sandbox) {\r\n                return Sandboxing.getState(sandbox);\r\n            };\r\n            var apis = {\r\n                setContent: setContent,\r\n                showAt: showAt,\r\n                showWithin: showWithin,\r\n                showMenuAt: showMenuAt,\r\n                hide: hide,\r\n                getContent: getContent,\r\n                isOpen: Sandboxing.isOpen\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                behaviours: augment(detail.inlineBehaviours, [\r\n                    Sandboxing.config({\r\n                        isPartOf: function (sandbox, data, queryElem) {\r\n                            return isPartOf(data, queryElem) || isPartOfRelated(sandbox, queryElem);\r\n                        },\r\n                        getAttachPoint: function (sandbox) {\r\n                            return detail.lazySink(sandbox).getOrDie();\r\n                        }\r\n                    }),\r\n                    receivingConfig(__assign({ isExtraPart: constant(false) }, detail.fireDismissalEventInstead.map(function (fe) {\r\n                        return { fireEventInstead: { event: fe.event } };\r\n                    }).getOr({})))\r\n                ]),\r\n                eventOrder: detail.eventOrder,\r\n                apis: apis\r\n            };\r\n        };\r\n        var InlineView = single$2({\r\n            name: 'InlineView',\r\n            configFields: [\r\n                strict$1('lazySink'),\r\n                onHandler('onShow'),\r\n                onHandler('onHide'),\r\n                optionFunction('onEscape'),\r\n                field$1('inlineBehaviours', [\r\n                    Sandboxing,\r\n                    Receiving\r\n                ]),\r\n                optionObjOf('fireDismissalEventInstead', [defaulted$1('event', dismissRequested())]),\r\n                defaulted$1('getRelated', Option.none),\r\n                defaulted$1('eventOrder', Option.none)\r\n            ],\r\n            factory: factory,\r\n            apis: {\r\n                showAt: function (apis, component, anchor, thing) {\r\n                    apis.showAt(component, anchor, thing);\r\n                },\r\n                showWithin: function (apis, component, anchor, thing, boxElement) {\r\n                    apis.showWithin(component, anchor, thing, boxElement);\r\n                },\r\n                showMenuAt: function (apis, component, anchor, menuSpec) {\r\n                    apis.showMenuAt(component, anchor, menuSpec);\r\n                },\r\n                hide: function (apis, component) {\r\n                    apis.hide(component);\r\n                },\r\n                isOpen: function (apis, component) {\r\n                    return apis.isOpen(component);\r\n                },\r\n                getContent: function (apis, component) {\r\n                    return apis.getContent(component);\r\n                },\r\n                setContent: function (apis, component, thing) {\r\n                    apis.setContent(component, thing);\r\n                }\r\n            }\r\n        });\r\n        var events$7 = function (optAction) {\r\n            var executeHandler = function (action) {\r\n                return run(execute(), function (component, simulatedEvent) {\r\n                    action(component);\r\n                    simulatedEvent.stop();\r\n                });\r\n            };\r\n            var onClick = function (component, simulatedEvent) {\r\n                simulatedEvent.stop();\r\n                emitExecute(component);\r\n            };\r\n            var onMousedown = function (component, simulatedEvent) {\r\n                simulatedEvent.cut();\r\n            };\r\n            var pointerEvents = PlatformDetection$1.detect().deviceType.isTouch() ? [run(tap(), onClick)] : [\r\n                run(click(), onClick),\r\n                run(mousedown(), onMousedown)\r\n            ];\r\n            return derive(flatten([\r\n                optAction.map(executeHandler).toArray(),\r\n                pointerEvents\r\n            ]));\r\n        };\r\n        var factory$1 = function (detail) {\r\n            var events = events$7(detail.action);\r\n            var tag = detail.dom.tag;\r\n            var lookupAttr = function (attr) {\r\n                return readOptFrom$1(detail.dom, 'attributes').bind(function (attrs) {\r\n                    return readOptFrom$1(attrs, attr);\r\n                });\r\n            };\r\n            var getModAttributes = function () {\r\n                if (tag === 'button') {\r\n                    var type = lookupAttr('type').getOr('button');\r\n                    var roleAttrs = lookupAttr('role').map(function (role) {\r\n                        return { role: role };\r\n                    }).getOr({});\r\n                    return __assign({ type: type }, roleAttrs);\r\n                }\r\n                else {\r\n                    var role = lookupAttr('role').getOr('button');\r\n                    return { role: role };\r\n                }\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: detail.components,\r\n                events: events,\r\n                behaviours: SketchBehaviours.augment(detail.buttonBehaviours, [\r\n                    Focusing.config({}),\r\n                    Keying.config({\r\n                        mode: 'execution',\r\n                        useSpace: true,\r\n                        useEnter: true\r\n                    })\r\n                ]),\r\n                domModification: { attributes: getModAttributes() },\r\n                eventOrder: detail.eventOrder\r\n            };\r\n        };\r\n        var Button = single$2({\r\n            name: 'Button',\r\n            factory: factory$1,\r\n            configFields: [\r\n                defaulted$1('uid', undefined),\r\n                strict$1('dom'),\r\n                defaulted$1('components', []),\r\n                SketchBehaviours.field('buttonBehaviours', [\r\n                    Focusing,\r\n                    Keying\r\n                ]),\r\n                option('action'),\r\n                option('role'),\r\n                defaulted$1('eventOrder', {})\r\n            ]\r\n        });\r\n        var record = function (spec) {\r\n            var uid = isSketchSpec(spec) && hasKey$1(spec, 'uid') ? spec.uid : generate$2('memento');\r\n            var get = function (anyInSystem) {\r\n                return anyInSystem.getSystem().getByUid(uid).getOrDie();\r\n            };\r\n            var getOpt = function (anyInSystem) {\r\n                return anyInSystem.getSystem().getByUid(uid).fold(Option.none, Option.some);\r\n            };\r\n            var asSpec = function () {\r\n                return __assign({}, spec, { uid: uid });\r\n            };\r\n            return {\r\n                get: get,\r\n                getOpt: getOpt,\r\n                asSpec: asSpec\r\n            };\r\n        };\r\n        var Memento = Object.freeze({\r\n            record: record\r\n        });\r\n        var defaultIcon = function (icons) {\r\n            return Option.from(icons()['temporary-placeholder']).getOr('!not found!');\r\n        };\r\n        var get$c = function (name, icons) {\r\n            return Option.from(icons()[name]).getOrThunk(function () {\r\n                return defaultIcon(icons);\r\n            });\r\n        };\r\n        var getOr = function (name, icons, fallback) {\r\n            return Option.from(icons()[name]).or(fallback).getOrThunk(function () {\r\n                return defaultIcon(icons);\r\n            });\r\n        };\r\n        var getFirst$1 = function (names, icons) {\r\n            return findMap(names, function (name) {\r\n                return Option.from(icons()[name]);\r\n            }).getOrThunk(function () {\r\n                return defaultIcon(icons);\r\n            });\r\n        };\r\n        var notificationIconMap = {\r\n            success: 'checkmark',\r\n            error: 'warning',\r\n            err: 'error',\r\n            warning: 'warning',\r\n            warn: 'warning',\r\n            info: 'info'\r\n        };\r\n        var factory$2 = function (detail) {\r\n            var memBannerText = record({\r\n                dom: {\r\n                    tag: 'p',\r\n                    innerHtml: detail.translationProvider(detail.text)\r\n                },\r\n                behaviours: derive$1([Replacing.config({})])\r\n            });\r\n            var renderPercentBar = function (percent) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-bar'],\r\n                        attributes: { style: 'width: ' + percent + '%' }\r\n                    }\r\n                };\r\n            };\r\n            var renderPercentText = function (percent) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-text'],\r\n                        innerHtml: percent + '%'\r\n                    }\r\n                };\r\n            };\r\n            var memBannerProgress = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: detail.progress ? [\r\n                        'tox-progress-bar',\r\n                        'tox-progress-indicator'\r\n                    ] : ['tox-progress-bar']\r\n                },\r\n                components: [\r\n                    {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-bar-container']\r\n                        },\r\n                        components: [renderPercentBar(0)]\r\n                    },\r\n                    renderPercentText(0)\r\n                ],\r\n                behaviours: derive$1([Replacing.config({})])\r\n            });\r\n            var updateProgress = function (comp, percent) {\r\n                if (comp.getSystem().isConnected()) {\r\n                    memBannerProgress.getOpt(comp).each(function (progress) {\r\n                        Replacing.set(progress, [\r\n                            {\r\n                                dom: {\r\n                                    tag: 'div',\r\n                                    classes: ['tox-bar-container']\r\n                                },\r\n                                components: [renderPercentBar(percent)]\r\n                            },\r\n                            renderPercentText(percent)\r\n                        ]);\r\n                    });\r\n                }\r\n            };\r\n            var updateText = function (comp, text$1) {\r\n                if (comp.getSystem().isConnected()) {\r\n                    var banner = memBannerText.get(comp);\r\n                    Replacing.set(banner, [text(text$1)]);\r\n                }\r\n            };\r\n            var apis = {\r\n                updateProgress: updateProgress,\r\n                updateText: updateText\r\n            };\r\n            var iconChoices = flatten([\r\n                detail.icon.toArray(),\r\n                detail.level.toArray(),\r\n                detail.level.bind(function (level) {\r\n                    return Option.from(notificationIconMap[level]);\r\n                }).toArray()\r\n            ]);\r\n            return {\r\n                uid: detail.uid,\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { role: 'alert' },\r\n                    classes: detail.level.map(function (level) {\r\n                        return [\r\n                            'tox-notification',\r\n                            'tox-notification--in',\r\n                            'tox-notification--' + level\r\n                        ];\r\n                    }).getOr([\r\n                        'tox-notification',\r\n                        'tox-notification--in'\r\n                    ])\r\n                },\r\n                components: [\r\n                    {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-notification__icon'],\r\n                            innerHtml: getFirst$1(iconChoices, detail.iconProvider)\r\n                        }\r\n                    },\r\n                    {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-notification__body']\r\n                        },\r\n                        components: [memBannerText.asSpec()],\r\n                        behaviours: derive$1([Replacing.config({})])\r\n                    }\r\n                ].concat(detail.progress ? [memBannerProgress.asSpec()] : []).concat(Button.sketch({\r\n                    dom: {\r\n                        tag: 'button',\r\n                        classes: [\r\n                            'tox-notification__dismiss',\r\n                            'tox-button',\r\n                            'tox-button--naked',\r\n                            'tox-button--icon'\r\n                        ]\r\n                    },\r\n                    components: [{\r\n                            dom: {\r\n                                tag: 'div',\r\n                                classes: ['tox-icon'],\r\n                                innerHtml: get$c('close', detail.iconProvider),\r\n                                attributes: { 'aria-label': detail.translationProvider('Close') }\r\n                            }\r\n                        }],\r\n                    action: function (comp) {\r\n                        detail.onAction(comp);\r\n                    }\r\n                })),\r\n                apis: apis\r\n            };\r\n        };\r\n        var Notification = single$2({\r\n            name: 'Notification',\r\n            factory: factory$2,\r\n            configFields: [\r\n                option('level'),\r\n                strict$1('progress'),\r\n                strict$1('icon'),\r\n                strict$1('onAction'),\r\n                strict$1('text'),\r\n                strict$1('iconProvider'),\r\n                strict$1('translationProvider')\r\n            ],\r\n            apis: {\r\n                updateProgress: function (apis, comp, percent) {\r\n                    apis.updateProgress(comp, percent);\r\n                },\r\n                updateText: function (apis, comp, text) {\r\n                    apis.updateText(comp, text);\r\n                }\r\n            }\r\n        });\r\n        var global$1 = tinymce.util.Tools.resolve('tinymce.util.Delay');\r\n        function NotificationManagerImpl(editor, extras, uiMothership) {\r\n            var backstage = extras.backstage;\r\n            var getEditorContainer = function (editor) {\r\n                return editor.inline ? editor.getElement() : editor.getContentAreaContainer();\r\n            };\r\n            var prePositionNotifications = function (notifications) {\r\n                each(notifications, function (notification) {\r\n                    notification.moveTo(0, 0);\r\n                });\r\n            };\r\n            var positionNotifications = function (notifications) {\r\n                if (notifications.length > 0) {\r\n                    var firstItem = notifications.slice(0, 1)[0];\r\n                    var container = getEditorContainer(editor);\r\n                    firstItem.moveRel(container, 'tc-tc');\r\n                    each(notifications, function (notification, index) {\r\n                        if (index > 0) {\r\n                            notification.moveRel(notifications[index - 1].getEl(), 'bc-tc');\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var reposition = function (notifications) {\r\n                prePositionNotifications(notifications);\r\n                positionNotifications(notifications);\r\n            };\r\n            var open = function (settings, closeCallback) {\r\n                var close = function () {\r\n                    closeCallback();\r\n                    InlineView.hide(notificationWrapper);\r\n                };\r\n                var notification = build$1(Notification.sketch({\r\n                    text: settings.text,\r\n                    level: contains([\r\n                        'success',\r\n                        'error',\r\n                        'warning',\r\n                        'info'\r\n                    ], settings.type) ? settings.type : undefined,\r\n                    progress: settings.progressBar === true,\r\n                    icon: Option.from(settings.icon),\r\n                    onAction: close,\r\n                    iconProvider: backstage.shared.providers.icons,\r\n                    translationProvider: backstage.shared.providers.translate\r\n                }));\r\n                var notificationWrapper = build$1(InlineView.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-notifications-container']\r\n                    },\r\n                    lazySink: extras.backstage.shared.getSink,\r\n                    fireDismissalEventInstead: {}\r\n                }));\r\n                uiMothership.add(notificationWrapper);\r\n                if (settings.timeout) {\r\n                    global$1.setTimeout(function () {\r\n                        close();\r\n                    }, settings.timeout);\r\n                }\r\n                return {\r\n                    close: close,\r\n                    moveTo: function (x, y) {\r\n                        InlineView.showAt(notificationWrapper, {\r\n                            anchor: 'makeshift',\r\n                            x: x,\r\n                            y: y\r\n                        }, premade$1(notification));\r\n                    },\r\n                    moveRel: function (element, rel) {\r\n                        InlineView.showAt(notificationWrapper, extras.backstage.shared.anchors.banner(), premade$1(notification));\r\n                    },\r\n                    text: function (nuText) {\r\n                        Notification.updateText(notification, nuText);\r\n                    },\r\n                    settings: settings,\r\n                    getEl: function () {\r\n                    },\r\n                    progressBar: {\r\n                        value: function (percent) {\r\n                            Notification.updateProgress(notification, percent);\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n            var close = function (notification) {\r\n                notification.close();\r\n            };\r\n            var getArgs = function (notification) {\r\n                return notification.settings;\r\n            };\r\n            return {\r\n                open: open,\r\n                close: close,\r\n                reposition: reposition,\r\n                getArgs: getArgs\r\n            };\r\n        }\r\n        var last$2 = function (fn, rate) {\r\n            var timer = null;\r\n            var cancel = function () {\r\n                if (timer !== null) {\r\n                    domGlobals.clearTimeout(timer);\r\n                    timer = null;\r\n                }\r\n            };\r\n            var throttle = function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                if (timer !== null)\r\n                    domGlobals.clearTimeout(timer);\r\n                timer = domGlobals.setTimeout(function () {\r\n                    fn.apply(null, args);\r\n                    timer = null;\r\n                }, rate);\r\n            };\r\n            return {\r\n                cancel: cancel,\r\n                throttle: throttle\r\n            };\r\n        };\r\n        var isValidTextRange = function (rng) {\r\n            return rng.collapsed && rng.startContainer.nodeType === 3;\r\n        };\r\n        var whiteSpace = /[\\u00a0 \\t\\r\\n]/;\r\n        var parse$1 = function (text, index, ch, minChars) {\r\n            var i;\r\n            for (i = index - 1; i >= 0; i--) {\r\n                if (whiteSpace.test(text.charAt(i))) {\r\n                    return Option.none();\r\n                }\r\n                if (text.charAt(i) === ch) {\r\n                    break;\r\n                }\r\n            }\r\n            if (i === -1 || index - i < minChars) {\r\n                return Option.none();\r\n            }\r\n            return Option.some(text.substring(i + 1, index));\r\n        };\r\n        var getContext = function (initRange, ch, text, index, minChars) {\r\n            if (minChars === void 0) {\r\n                minChars = 0;\r\n            }\r\n            if (!isValidTextRange(initRange)) {\r\n                return Option.none();\r\n            }\r\n            return parse$1(text, index, ch, minChars).map(function (newText) {\r\n                var rng = initRange.cloneRange();\r\n                rng.setStart(initRange.startContainer, initRange.startOffset - newText.length - 1);\r\n                rng.setEnd(initRange.startContainer, initRange.startOffset);\r\n                return {\r\n                    text: newText,\r\n                    rng: rng\r\n                };\r\n            });\r\n        };\r\n        var setup = function (api, editor) {\r\n            editor.on('keypress', api.onKeypress.throttle);\r\n            editor.on('remove', api.onKeypress.cancel);\r\n            var redirectKeyToItem = function (item, e) {\r\n                emitWith(item, keydown(), { raw: e });\r\n            };\r\n            editor.on('keydown', function (e) {\r\n                var getItem = function () {\r\n                    return api.getView().bind(Highlighting.getHighlighted);\r\n                };\r\n                if (e.which === 8) {\r\n                    api.onKeypress.throttle(e);\r\n                }\r\n                if (api.isActive()) {\r\n                    if (e.which === 27) {\r\n                        api.closeIfNecessary();\r\n                    }\r\n                    else if (e.which === 32) {\r\n                        api.closeIfNecessary();\r\n                    }\r\n                    else if (e.which === 13) {\r\n                        getItem().each(emitExecute);\r\n                        e.preventDefault();\r\n                    }\r\n                    else if (e.which === 40) {\r\n                        getItem().fold(function () {\r\n                            api.getView().each(Highlighting.highlightFirst);\r\n                        }, function (item) {\r\n                            redirectKeyToItem(item, e);\r\n                        });\r\n                        e.preventDefault();\r\n                    }\r\n                    else if (e.which === 37 || e.which === 38 || e.which === 39) {\r\n                        getItem().each(function (item) {\r\n                            redirectKeyToItem(item, e);\r\n                            e.preventDefault();\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        var AutocompleterEditorEvents = { setup: setup };\r\n        var global$2 = tinymce.util.Tools.resolve('tinymce.util.Promise');\r\n        var isStartOfWord = function (rng, text) {\r\n            return rng.startOffset === 0 || /\\s/.test(text.charAt(rng.startOffset - 1));\r\n        };\r\n        var getTriggerContext = function (initRange, initText, database) {\r\n            return findMap(database.triggerChars, function (ch) {\r\n                return getContext(initRange, ch, initText, initRange.startOffset).map(function (_a) {\r\n                    var rng = _a.rng, text = _a.text;\r\n                    return {\r\n                        range: rng,\r\n                        text: text,\r\n                        triggerChar: ch\r\n                    };\r\n                });\r\n            });\r\n        };\r\n        var lookup = function (editor, getDatabase) {\r\n            var database = getDatabase();\r\n            var rng = editor.selection.getRng();\r\n            var startText = rng.startContainer.nodeValue;\r\n            return getTriggerContext(rng, startText, database).map(function (context) {\r\n                var autocompleters = filter(database.lookupByChar(context.triggerChar), function (autocompleter) {\r\n                    return context.text.length >= autocompleter.minChars && autocompleter.matches.getOr(isStartOfWord)(context.range, startText, context.text);\r\n                });\r\n                var lookupData = global$2.all(map(autocompleters, function (ac) {\r\n                    var fetchResult = ac.fetch(context.text, ac.maxResults);\r\n                    return fetchResult.then(function (results) {\r\n                        return {\r\n                            items: results,\r\n                            columns: ac.columns,\r\n                            onAction: ac.onAction\r\n                        };\r\n                    });\r\n                }));\r\n                return {\r\n                    lookupData: lookupData,\r\n                    triggerChar: context.triggerChar,\r\n                    range: context.range\r\n                };\r\n            });\r\n        };\r\n        var autocompleterItemSchema = objOf([\r\n            state$1('type', function () {\r\n                return 'autocompleteitem';\r\n            }),\r\n            state$1('active', function () {\r\n                return false;\r\n            }),\r\n            state$1('disabled', function () {\r\n                return false;\r\n            }),\r\n            defaulted$1('meta', {}),\r\n            strictString('value'),\r\n            optionString('text'),\r\n            optionString('icon')\r\n        ]);\r\n        var autocompleterSchema = objOf([\r\n            strictString('type'),\r\n            strictString('ch'),\r\n            defaultedNumber('minChars', 1),\r\n            defaulted$1('columns', 1),\r\n            defaultedNumber('maxResults', 10),\r\n            optionFunction('matches'),\r\n            strictFunction('fetch'),\r\n            strictFunction('onAction')\r\n        ]);\r\n        var createAutocompleterItem = function (spec) {\r\n            return asRaw('Autocompleter.Item', autocompleterItemSchema, spec);\r\n        };\r\n        var createAutocompleter = function (spec) {\r\n            return asRaw('Autocompleter', autocompleterSchema, spec);\r\n        };\r\n        var stringArray = function (a) {\r\n            var all = {};\r\n            each(a, function (key) {\r\n                all[key] = {};\r\n            });\r\n            return keys(all);\r\n        };\r\n        var register = function (editor) {\r\n            var popups = editor.ui.registry.getAll().popups;\r\n            var dataset = map$1(popups, function (popup) {\r\n                return createAutocompleter(popup).fold(function (err) {\r\n                    throw new Error(formatError(err));\r\n                }, function (x) {\r\n                    return x;\r\n                });\r\n            });\r\n            var triggerChars = stringArray(mapToArray(dataset, function (v) {\r\n                return v.ch;\r\n            }));\r\n            var datasetValues = values(dataset);\r\n            var lookupByChar = function (ch) {\r\n                return filter(datasetValues, function (dv) {\r\n                    return dv.ch === ch;\r\n                });\r\n            };\r\n            return {\r\n                dataset: dataset,\r\n                triggerChars: triggerChars,\r\n                lookupByChar: lookupByChar\r\n            };\r\n        };\r\n        var commonMenuItemFields = [\r\n            defaultedBoolean('disabled', false),\r\n            optionString('text'),\r\n            optionString('shortcut'),\r\n            field('value', 'value', defaultedThunk(function () {\r\n                return generate$1('menuitem-value');\r\n            }), anyValue$1()),\r\n            defaulted$1('meta', {})\r\n        ];\r\n        var menuItemSchema = objOf([\r\n            strictString('type'),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            }),\r\n            defaultedFunction('onAction', noop),\r\n            optionString('icon')\r\n        ].concat(commonMenuItemFields));\r\n        var createMenuItem = function (spec) {\r\n            return asRaw('menuitem', menuItemSchema, spec);\r\n        };\r\n        var nestedMenuItemSchema = objOf([\r\n            strictString('type'),\r\n            strictFunction('getSubmenuItems'),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            }),\r\n            optionString('icon')\r\n        ].concat(commonMenuItemFields));\r\n        var createNestedMenuItem = function (spec) {\r\n            return asRaw('nestedmenuitem', nestedMenuItemSchema, spec);\r\n        };\r\n        var toggleMenuItemSchema = objOf([\r\n            strictString('type'),\r\n            defaultedBoolean('active', false),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            }),\r\n            strictFunction('onAction')\r\n        ].concat(commonMenuItemFields));\r\n        var createToggleMenuItem = function (spec) {\r\n            return asRaw('togglemenuitem', toggleMenuItemSchema, spec);\r\n        };\r\n        var choiceMenuItemSchema = objOf([\r\n            strictString('type'),\r\n            defaultedBoolean('active', false),\r\n            optionString('icon')\r\n        ].concat(commonMenuItemFields));\r\n        var createChoiceMenuItem = function (spec) {\r\n            return asRaw('choicemenuitem', choiceMenuItemSchema, spec);\r\n        };\r\n        var separatorMenuItemSchema = objOf([\r\n            strictString('type'),\r\n            optionString('text')\r\n        ]);\r\n        var createSeparatorMenuItem = function (spec) {\r\n            return asRaw('separatormenuitem', separatorMenuItemSchema, spec);\r\n        };\r\n        var fancyTypes = [\r\n            'inserttable',\r\n            'colorswatch'\r\n        ];\r\n        var fancyMenuItemSchema = objOf([\r\n            strictString('type'),\r\n            strictStringEnum('fancytype', fancyTypes),\r\n            defaultedFunction('onAction', noop)\r\n        ]);\r\n        var createFancyMenuItem = function (spec) {\r\n            return asRaw('fancymenuitem', fancyMenuItemSchema, spec);\r\n        };\r\n        var detectSize = function (comp, margin, selectorClass) {\r\n            var descendants$1 = descendants(comp.element(), '.' + selectorClass);\r\n            if (descendants$1.length > 0) {\r\n                var columnLength = findIndex(descendants$1, function (c) {\r\n                    var thisTop = c.dom().getBoundingClientRect().top;\r\n                    var cTop = descendants$1[0].dom().getBoundingClientRect().top;\r\n                    return Math.abs(thisTop - cTop) > margin;\r\n                }).getOr(descendants$1.length);\r\n                return Option.some({\r\n                    numColumns: columnLength,\r\n                    numRows: Math.ceil(descendants$1.length / columnLength)\r\n                });\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var namedEvents = function (name, handlers) {\r\n            return derive$1([config(name, handlers)]);\r\n        };\r\n        var unnamedEvents = function (handlers) {\r\n            return namedEvents(generate$1('unnamed-events'), handlers);\r\n        };\r\n        var SimpleBehaviours = {\r\n            namedEvents: namedEvents,\r\n            unnamedEvents: unnamedEvents\r\n        };\r\n        var TooltippingSchema = [\r\n            strict$1('lazySink'),\r\n            strict$1('tooltipDom'),\r\n            defaulted$1('exclusive', true),\r\n            defaulted$1('tooltipComponents', []),\r\n            defaulted$1('delay', 300),\r\n            defaultedStringEnum('mode', 'normal', [\r\n                'normal',\r\n                'follow-highlight'\r\n            ]),\r\n            defaulted$1('anchor', function (comp) {\r\n                return {\r\n                    anchor: 'hotspot',\r\n                    hotspot: comp,\r\n                    layouts: {\r\n                        onLtr: constant([\r\n                            south$1,\r\n                            north$1,\r\n                            southeast$1,\r\n                            northeast$1,\r\n                            southwest$1,\r\n                            northwest$1\r\n                        ]),\r\n                        onRtl: constant([\r\n                            south$1,\r\n                            north$1,\r\n                            southeast$1,\r\n                            northeast$1,\r\n                            southwest$1,\r\n                            northwest$1\r\n                        ])\r\n                    }\r\n                };\r\n            }),\r\n            onHandler('onHide'),\r\n            onHandler('onShow')\r\n        ];\r\n        var init$4 = function () {\r\n            var timer = Cell(Option.none());\r\n            var popup = Cell(Option.none());\r\n            var getTooltip = function () {\r\n                return popup.get();\r\n            };\r\n            var setTooltip = function (s) {\r\n                popup.set(Option.some(s));\r\n            };\r\n            var clearTooltip = function () {\r\n                popup.set(Option.none());\r\n            };\r\n            var clearTimer = function () {\r\n                timer.get().each(function (t) {\r\n                    domGlobals.clearTimeout(t);\r\n                });\r\n            };\r\n            var resetTimer = function (f, delay) {\r\n                clearTimer();\r\n                timer.set(Option.some(domGlobals.setTimeout(function () {\r\n                    f();\r\n                }, delay)));\r\n            };\r\n            var isShowing = function () {\r\n                return popup.get().isSome();\r\n            };\r\n            var readState = constant('not-implemented');\r\n            return nu$5({\r\n                getTooltip: getTooltip,\r\n                isShowing: isShowing,\r\n                setTooltip: setTooltip,\r\n                clearTooltip: clearTooltip,\r\n                clearTimer: clearTimer,\r\n                resetTimer: resetTimer,\r\n                readState: readState\r\n            });\r\n        };\r\n        var TooltippingState = Object.freeze({\r\n            init: init$4\r\n        });\r\n        var ExclusivityChannel = generate$1('tooltip.exclusive');\r\n        var ShowTooltipEvent = generate$1('tooltip.show');\r\n        var HideTooltipEvent = generate$1('tooltip.hide');\r\n        var hideAllExclusive = function (component, tConfig, tState) {\r\n            component.getSystem().broadcastOn([ExclusivityChannel], {});\r\n        };\r\n        var setComponents = function (component, tConfig, tState, specs) {\r\n            tState.getTooltip().each(function (tooltip) {\r\n                if (tooltip.getSystem().isConnected()) {\r\n                    Replacing.set(tooltip, specs);\r\n                }\r\n            });\r\n        };\r\n        var TooltippingApis = Object.freeze({\r\n            hideAllExclusive: hideAllExclusive,\r\n            setComponents: setComponents\r\n        });\r\n        var events$8 = function (tooltipConfig, state) {\r\n            var hide = function (comp) {\r\n                state.getTooltip().each(function (p) {\r\n                    detach(p);\r\n                    tooltipConfig.onHide(comp, p);\r\n                    state.clearTooltip();\r\n                });\r\n                state.clearTimer();\r\n            };\r\n            var show = function (comp) {\r\n                if (!state.isShowing()) {\r\n                    hideAllExclusive(comp, tooltipConfig, state);\r\n                    var sink = tooltipConfig.lazySink(comp).getOrDie();\r\n                    var popup = comp.getSystem().build({\r\n                        dom: tooltipConfig.tooltipDom,\r\n                        components: tooltipConfig.tooltipComponents,\r\n                        events: derive(tooltipConfig.mode === 'normal' ? [\r\n                            run(mouseover(), function (_) {\r\n                                emit(comp, ShowTooltipEvent);\r\n                            }),\r\n                            run(mouseout(), function (_) {\r\n                                emit(comp, HideTooltipEvent);\r\n                            })\r\n                        ] : []),\r\n                        behaviours: derive$1([Replacing.config({})])\r\n                    });\r\n                    state.setTooltip(popup);\r\n                    attach(sink, popup);\r\n                    tooltipConfig.onShow(comp, popup);\r\n                    Positioning.position(sink, tooltipConfig.anchor(comp), popup);\r\n                }\r\n            };\r\n            return derive(flatten([\r\n                [\r\n                    run(ShowTooltipEvent, function (comp) {\r\n                        state.resetTimer(function () {\r\n                            show(comp);\r\n                        }, tooltipConfig.delay);\r\n                    }),\r\n                    run(HideTooltipEvent, function (comp) {\r\n                        state.resetTimer(function () {\r\n                            hide(comp);\r\n                        }, tooltipConfig.delay);\r\n                    }),\r\n                    run(receive(), function (comp, message) {\r\n                        var receivingData = message;\r\n                        if (contains(receivingData.channels(), ExclusivityChannel)) {\r\n                            hide(comp);\r\n                        }\r\n                    }),\r\n                    runOnDetached(function (comp) {\r\n                        hide(comp);\r\n                    })\r\n                ],\r\n                tooltipConfig.mode === 'normal' ? [\r\n                    run(focusin(), function (comp) {\r\n                        emit(comp, ShowTooltipEvent);\r\n                    }),\r\n                    run(postBlur(), function (comp) {\r\n                        emit(comp, HideTooltipEvent);\r\n                    }),\r\n                    run(mouseover(), function (comp) {\r\n                        emit(comp, ShowTooltipEvent);\r\n                    }),\r\n                    run(mouseout(), function (comp) {\r\n                        emit(comp, HideTooltipEvent);\r\n                    })\r\n                ] : [\r\n                    run(highlight(), function (comp, se) {\r\n                        emit(comp, ShowTooltipEvent);\r\n                    }),\r\n                    run(dehighlight(), function (comp) {\r\n                        emit(comp, HideTooltipEvent);\r\n                    })\r\n                ]\r\n            ]));\r\n        };\r\n        var ActiveTooltipping = Object.freeze({\r\n            events: events$8\r\n        });\r\n        var Tooltipping = create$1({\r\n            fields: TooltippingSchema,\r\n            name: 'tooltipping',\r\n            active: ActiveTooltipping,\r\n            state: TooltippingState,\r\n            apis: TooltippingApis\r\n        });\r\n        var getAttrs = function (elem) {\r\n            var attributes = elem.dom().attributes !== undefined ? elem.dom().attributes : [];\r\n            return foldl(attributes, function (b, attr) {\r\n                var _a;\r\n                if (attr.name === 'class') {\r\n                    return b;\r\n                }\r\n                else {\r\n                    return __assign({}, b, (_a = {}, _a[attr.name] = attr.value, _a));\r\n                }\r\n            }, {});\r\n        };\r\n        var getClasses = function (elem) {\r\n            return Array.prototype.slice.call(elem.dom().classList, 0);\r\n        };\r\n        var fromHtml$2 = function (html) {\r\n            var elem = Element.fromHtml(html);\r\n            var children$1 = children(elem);\r\n            var attrs = getAttrs(elem);\r\n            var classes = getClasses(elem);\r\n            var contents = children$1.length === 0 ? {} : { innerHtml: get$1(elem) };\r\n            return __assign({\r\n                tag: name(elem),\r\n                classes: classes,\r\n                attributes: attrs\r\n            }, contents);\r\n        };\r\n        var global$3 = tinymce.util.Tools.resolve('tinymce.util.I18n');\r\n        var navClass = 'tox-menu-nav__js';\r\n        var selectableClass = 'tox-collection__item';\r\n        var colorClass = 'tox-swatch';\r\n        var presetClasses = {\r\n            normal: navClass,\r\n            color: colorClass\r\n        };\r\n        var tickedClass = 'tox-collection__item--enabled';\r\n        var groupHeadingClass = 'tox-collection__group-heading';\r\n        var iconClass = 'tox-collection__item-icon';\r\n        var textClass = 'tox-collection__item-label';\r\n        var accessoryClass = 'tox-collection__item-accessory';\r\n        var caretClass = 'tox-collection__item-caret';\r\n        var checkmarkClass = 'tox-collection__item-checkmark';\r\n        var activeClass = 'tox-collection__item--active';\r\n        var iconClassRtl = 'tox-collection__item-icon-rtl';\r\n        var classForPreset = function (presets) {\r\n            return readOptFrom$1(presetClasses, presets).getOr(navClass);\r\n        };\r\n        var global$4 = tinymce.util.Tools.resolve('tinymce.Env');\r\n        var convertText = function (source) {\r\n            var mac = {\r\n                alt: '&#x2325;',\r\n                ctrl: '&#x2303;',\r\n                shift: '&#x21E7;',\r\n                meta: '&#x2318;',\r\n                access: '&#x2303;&#x2325;'\r\n            };\r\n            var other = {\r\n                meta: 'Ctrl',\r\n                access: 'Shift+Alt'\r\n            };\r\n            var replace = global$4.mac ? mac : other;\r\n            var shortcut = source.split('+');\r\n            var updated = map(shortcut, function (segment) {\r\n                var search = segment.toLowerCase().trim();\r\n                return has(replace, search) ? replace[search] : segment;\r\n            });\r\n            return global$4.mac ? updated.join('') : updated.join('+');\r\n        };\r\n        var ConvertShortcut = { convertText: convertText };\r\n        var renderIcon = function (iconHtml) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [iconClass],\r\n                    innerHtml: iconHtml\r\n                }\r\n            };\r\n        };\r\n        var renderText = function (text$1) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [textClass]\r\n                },\r\n                components: [text(global$3.translate(text$1))]\r\n            };\r\n        };\r\n        var renderStyledText = function (style, text$1) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [textClass]\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: style.tag,\r\n                            attributes: { style: style.styleAttr }\r\n                        },\r\n                        components: [text(global$3.translate(text$1))]\r\n                    }]\r\n            };\r\n        };\r\n        var renderShortcut = function (shortcut) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [accessoryClass],\r\n                    innerHtml: ConvertShortcut.convertText(shortcut)\r\n                }\r\n            };\r\n        };\r\n        var renderCheckmark = function (icons) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        iconClass,\r\n                        checkmarkClass\r\n                    ],\r\n                    innerHtml: get$c('checkmark', icons)\r\n                }\r\n            };\r\n        };\r\n        var renderSubmenuCaret = function (icons) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [caretClass],\r\n                    innerHtml: get$c('chevron-right', icons)\r\n                }\r\n            };\r\n        };\r\n        var renderColorStructure = function (itemText, itemValue, iconSvg, providerBackstage) {\r\n            var colorPickerCommand = 'custom';\r\n            var removeColorCommand = 'remove';\r\n            var getDom = function () {\r\n                var common = colorClass;\r\n                var icon = iconSvg.getOr('');\r\n                var title = itemText.map(function (text) {\r\n                    return ' title=\"' + providerBackstage.translate(text) + '\"';\r\n                }).getOr('');\r\n                if (itemValue === colorPickerCommand) {\r\n                    return fromHtml$2('<button class=\"' + common + ' tox-swatches__picker-btn\"' + title + '>' + icon + '</button>');\r\n                }\r\n                else if (itemValue === removeColorCommand) {\r\n                    return fromHtml$2('<div class=\"' + common + ' tox-swatch--remove\"' + title + '>' + icon + '</div>');\r\n                }\r\n                else {\r\n                    return fromHtml$2('<div class=\"' + common + '\" style=\"background-color: ' + itemValue + '\" data-mce-color=\"' + itemValue + '\"' + title + '></div>');\r\n                }\r\n            };\r\n            return {\r\n                dom: getDom(),\r\n                optComponents: []\r\n            };\r\n        };\r\n        var renderNormalItemStructure = function (info, icon, renderIcons, textRender, rtlClass) {\r\n            var leftIcon = renderIcons ? info.checkMark.orThunk(function () {\r\n                return icon.or(Option.some('')).map(renderIcon);\r\n            }) : Option.none();\r\n            var domTitle = info.ariaLabel.map(function (label) {\r\n                return { attributes: { title: global$3.translate(label) } };\r\n            }).getOr({});\r\n            var dom = merge({\r\n                tag: 'div',\r\n                classes: [\r\n                    navClass,\r\n                    selectableClass\r\n                ].concat(rtlClass ? [iconClassRtl] : [])\r\n            }, domTitle);\r\n            var menuItem = {\r\n                dom: dom,\r\n                optComponents: [\r\n                    leftIcon,\r\n                    info.textContent.map(textRender),\r\n                    info.shortcutContent.map(renderShortcut),\r\n                    info.caret\r\n                ]\r\n            };\r\n            return menuItem;\r\n        };\r\n        var rtlIcon = [\r\n            'list-num-default',\r\n            'list-num-lower-alpha',\r\n            'list-num-lower-greek',\r\n            'list-num-lower-roman',\r\n            'list-num-upper-alpha',\r\n            'list-num-upper-roman'\r\n        ];\r\n        var rtlTransform = [\r\n            'list-bull-circle',\r\n            'list-bull-default',\r\n            'list-bull-square'\r\n        ];\r\n        var renderItemStructure = function (info, providersBackstage, renderIcons, fallbackIcon) {\r\n            if (fallbackIcon === void 0) {\r\n                fallbackIcon = Option.none();\r\n            }\r\n            var getIconName = function (iconName) {\r\n                return iconName.map(function (name) {\r\n                    return global$3.isRtl() && contains(rtlIcon, name) ? name + '-rtl' : name;\r\n                });\r\n            };\r\n            var needRtlClass = global$3.isRtl() && info.iconContent.exists(function (name) {\r\n                return contains(rtlTransform, name);\r\n            });\r\n            var icon = getIconName(info.iconContent).map(function (iconName) {\r\n                return getOr(iconName, providersBackstage.icons, fallbackIcon);\r\n            });\r\n            var textRender = Option.from(info.meta).fold(function () {\r\n                return renderText;\r\n            }, function (meta) {\r\n                return has(meta, 'style') ? curry(renderStyledText, meta.style) : renderText;\r\n            });\r\n            if (info.presets === 'color') {\r\n                return renderColorStructure(info.ariaLabel, info.value, icon, providersBackstage);\r\n            }\r\n            else {\r\n                return renderNormalItemStructure(info, icon, renderIcons, textRender, needRtlClass);\r\n            }\r\n        };\r\n        var nativeDisabled = [\r\n            'input',\r\n            'button',\r\n            'textarea'\r\n        ];\r\n        var onLoad$5 = function (component, disableConfig, disableState) {\r\n            if (disableConfig.disabled) {\r\n                disable(component, disableConfig, disableState);\r\n            }\r\n        };\r\n        var hasNative = function (component) {\r\n            return contains(nativeDisabled, name(component.element()));\r\n        };\r\n        var nativeIsDisabled = function (component) {\r\n            return has$1(component.element(), 'disabled');\r\n        };\r\n        var nativeDisable = function (component) {\r\n            set$1(component.element(), 'disabled', 'disabled');\r\n        };\r\n        var nativeEnable = function (component) {\r\n            remove$1(component.element(), 'disabled');\r\n        };\r\n        var ariaIsDisabled = function (component) {\r\n            return get$2(component.element(), 'aria-disabled') === 'true';\r\n        };\r\n        var ariaDisable = function (component) {\r\n            set$1(component.element(), 'aria-disabled', 'true');\r\n        };\r\n        var ariaEnable = function (component) {\r\n            set$1(component.element(), 'aria-disabled', 'false');\r\n        };\r\n        var disable = function (component, disableConfig, disableState) {\r\n            disableConfig.disableClass.each(function (disableClass) {\r\n                add$2(component.element(), disableClass);\r\n            });\r\n            var f = hasNative(component) ? nativeDisable : ariaDisable;\r\n            f(component);\r\n        };\r\n        var enable = function (component, disableConfig, disableState) {\r\n            disableConfig.disableClass.each(function (disableClass) {\r\n                remove$4(component.element(), disableClass);\r\n            });\r\n            var f = hasNative(component) ? nativeEnable : ariaEnable;\r\n            f(component);\r\n        };\r\n        var isDisabled = function (component) {\r\n            return hasNative(component) ? nativeIsDisabled(component) : ariaIsDisabled(component);\r\n        };\r\n        var set$7 = function (component, disableConfig, disableState, disabled) {\r\n            var f = disabled ? disable : enable;\r\n            f(component, disableConfig, disableState);\r\n        };\r\n        var DisableApis = Object.freeze({\r\n            enable: enable,\r\n            disable: disable,\r\n            isDisabled: isDisabled,\r\n            onLoad: onLoad$5,\r\n            set: set$7\r\n        });\r\n        var exhibit$3 = function (base, disableConfig, disableState) {\r\n            return nu$6({ classes: disableConfig.disabled ? disableConfig.disableClass.map(pure).getOr([]) : [] });\r\n        };\r\n        var events$9 = function (disableConfig, disableState) {\r\n            return derive([\r\n                abort(execute(), function (component, simulatedEvent) {\r\n                    return isDisabled(component);\r\n                }),\r\n                loadEvent(disableConfig, disableState, onLoad$5)\r\n            ]);\r\n        };\r\n        var ActiveDisable = Object.freeze({\r\n            exhibit: exhibit$3,\r\n            events: events$9\r\n        });\r\n        var DisableSchema = [\r\n            defaulted$1('disabled', false),\r\n            option('disableClass')\r\n        ];\r\n        var Disabling = create$1({\r\n            fields: DisableSchema,\r\n            name: 'disabling',\r\n            active: ActiveDisable,\r\n            apis: DisableApis\r\n        });\r\n        var item = function (disabled) {\r\n            return Disabling.config({\r\n                disabled: disabled,\r\n                disableClass: 'tox-collection__item--state-disabled'\r\n            });\r\n        };\r\n        var button = function (disabled) {\r\n            return Disabling.config({ disabled: disabled });\r\n        };\r\n        var splitButton = function (disabled) {\r\n            return Disabling.config({\r\n                disabled: disabled,\r\n                disableClass: 'tox-tbtn--disabled'\r\n            });\r\n        };\r\n        var DisablingConfigs = {\r\n            item: item,\r\n            button: button,\r\n            splitButton: splitButton\r\n        };\r\n        var runWithApi = function (info, comp) {\r\n            var api = info.getApi(comp);\r\n            return function (f) {\r\n                f(api);\r\n            };\r\n        };\r\n        var onControlAttached = function (info, editorOffCell) {\r\n            return runOnAttached(function (comp) {\r\n                var run = runWithApi(info, comp);\r\n                run(function (api) {\r\n                    var onDestroy = info.onSetup(api);\r\n                    if (onDestroy !== null && onDestroy !== undefined) {\r\n                        editorOffCell.set(onDestroy);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var onControlDetached = function (getApi, editorOffCell) {\r\n            return runOnDetached(function (comp) {\r\n                return runWithApi(getApi, comp)(editorOffCell.get());\r\n            });\r\n        };\r\n        var ItemResponse;\r\n        (function (ItemResponse) {\r\n            ItemResponse[ItemResponse['CLOSE_ON_EXECUTE'] = 0] = 'CLOSE_ON_EXECUTE';\r\n            ItemResponse[ItemResponse['BUBBLE_TO_SANDBOX'] = 1] = 'BUBBLE_TO_SANDBOX';\r\n        }(ItemResponse || (ItemResponse = {})));\r\n        var ItemResponse$1 = ItemResponse;\r\n        var onMenuItemExecute = function (info, itemResponse) {\r\n            return runOnExecute(function (comp, simulatedEvent) {\r\n                runWithApi(info, comp)(info.onAction);\r\n                if (!info.triggersSubmenu && itemResponse === ItemResponse$1.CLOSE_ON_EXECUTE) {\r\n                    emit(comp, sandboxClose());\r\n                    simulatedEvent.stop();\r\n                }\r\n            });\r\n        };\r\n        var menuItemEventOrder = {\r\n            'alloy.execute': [\r\n                'disabling',\r\n                'alloy.base.behaviour',\r\n                'toggling',\r\n                'item-events'\r\n            ]\r\n        };\r\n        var componentRenderPipeline = function (xs) {\r\n            return bind(xs, function (o) {\r\n                return o.toArray();\r\n            });\r\n        };\r\n        var renderCommonItem = function (spec, structure, itemResponse) {\r\n            var editorOffCell = Cell(noop);\r\n            return {\r\n                type: 'item',\r\n                dom: structure.dom,\r\n                components: componentRenderPipeline(structure.optComponents),\r\n                data: spec.data,\r\n                eventOrder: menuItemEventOrder,\r\n                hasSubmenu: spec.triggersSubmenu,\r\n                itemBehaviours: derive$1([\r\n                    config('item-events', [\r\n                        onMenuItemExecute(spec, itemResponse),\r\n                        onControlAttached(spec, editorOffCell),\r\n                        onControlDetached(spec, editorOffCell)\r\n                    ]),\r\n                    DisablingConfigs.item(spec.disabled),\r\n                    Replacing.config({})\r\n                ].concat(spec.itemBehaviours))\r\n            };\r\n        };\r\n        var buildData = function (source) {\r\n            return {\r\n                value: source.value,\r\n                meta: merge({ text: source.text.getOr('') }, source.meta)\r\n            };\r\n        };\r\n        var tooltipBehaviour = function (meta, sharedBackstage) {\r\n            return get(meta, 'tooltipWorker').map(function (tooltipWorker) {\r\n                return [Tooltipping.config({\r\n                        lazySink: sharedBackstage.getSink,\r\n                        tooltipDom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-tooltip-worker-container']\r\n                        },\r\n                        tooltipComponents: [],\r\n                        anchor: function (comp) {\r\n                            return {\r\n                                anchor: 'submenu',\r\n                                item: comp,\r\n                                overrides: { maxHeightFunction: expandable }\r\n                            };\r\n                        },\r\n                        mode: 'follow-highlight',\r\n                        onShow: function (component, _tooltip) {\r\n                            tooltipWorker(function (elm) {\r\n                                Tooltipping.setComponents(component, [external({ element: Element.fromDom(elm) })]);\r\n                            });\r\n                        }\r\n                    })];\r\n            }).getOr([]);\r\n        };\r\n        var renderAutocompleteItem = function (spec, useText, presets, onItemValueHandler, itemResponse, sharedBackstage, renderIcons) {\r\n            if (renderIcons === void 0) {\r\n                renderIcons = true;\r\n            }\r\n            var structure = renderItemStructure({\r\n                presets: presets,\r\n                textContent: useText ? spec.text : Option.none(),\r\n                ariaLabel: spec.text,\r\n                iconContent: spec.icon,\r\n                shortcutContent: Option.none(),\r\n                checkMark: Option.none(),\r\n                caret: Option.none(),\r\n                value: spec.value\r\n            }, sharedBackstage.providers, renderIcons, spec.icon);\r\n            return renderCommonItem({\r\n                data: buildData(spec),\r\n                disabled: spec.disabled,\r\n                getApi: function () {\r\n                    return {};\r\n                },\r\n                onAction: function (_api) {\r\n                    return onItemValueHandler(spec.value, spec.meta);\r\n                },\r\n                onSetup: function () {\r\n                    return function () {\r\n                    };\r\n                },\r\n                triggersSubmenu: false,\r\n                itemBehaviours: tooltipBehaviour(spec.meta, sharedBackstage)\r\n            }, structure, itemResponse);\r\n        };\r\n        var renderChoiceItem = function (spec, useText, presets, onItemValueHandler, isSelected, itemResponse, providersBackstage) {\r\n            var getApi = function (component) {\r\n                return {\r\n                    setActive: function (state) {\r\n                        Toggling.set(component, state);\r\n                    },\r\n                    isActive: function () {\r\n                        return Toggling.isOn(component);\r\n                    },\r\n                    isDisabled: function () {\r\n                        return Disabling.isDisabled(component);\r\n                    },\r\n                    setDisabled: function (state) {\r\n                        return Disabling.set(component, state);\r\n                    }\r\n                };\r\n            };\r\n            var structure = renderItemStructure({\r\n                presets: presets,\r\n                textContent: useText ? spec.text : Option.none(),\r\n                ariaLabel: spec.text,\r\n                iconContent: spec.icon,\r\n                shortcutContent: useText ? spec.shortcut : Option.none(),\r\n                checkMark: useText ? Option.some(renderCheckmark(providersBackstage.icons)) : Option.none(),\r\n                caret: Option.none(),\r\n                value: spec.value\r\n            }, providersBackstage, true);\r\n            return deepMerge(renderCommonItem({\r\n                data: buildData(spec),\r\n                disabled: spec.disabled,\r\n                getApi: getApi,\r\n                onAction: function (_api) {\r\n                    return onItemValueHandler(spec.value);\r\n                },\r\n                onSetup: function (api) {\r\n                    api.setActive(isSelected);\r\n                    return function () {\r\n                    };\r\n                },\r\n                triggersSubmenu: false,\r\n                itemBehaviours: []\r\n            }, structure, itemResponse), {\r\n                toggling: {\r\n                    toggleClass: tickedClass,\r\n                    toggleOnExecute: false,\r\n                    selected: spec.active\r\n                }\r\n            });\r\n        };\r\n        var parts$2 = constant(generate$4(owner$2(), parts()));\r\n        var cellOverEvent = generate$1('cell-over');\r\n        var cellExecuteEvent = generate$1('cell-execute');\r\n        var makeCell = function (row, col, labelId) {\r\n            var _a;\r\n            var emitCellOver = function (c) {\r\n                return emitWith(c, cellOverEvent, {\r\n                    row: row,\r\n                    col: col\r\n                });\r\n            };\r\n            var emitExecute = function (c) {\r\n                return emitWith(c, cellExecuteEvent, {\r\n                    row: row,\r\n                    col: col\r\n                });\r\n            };\r\n            return build$1({\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: (_a = { role: 'button' }, _a['aria-labelledby'] = labelId, _a)\r\n                },\r\n                behaviours: derive$1([\r\n                    config('insert-table-picker-cell', [\r\n                        run(mouseover(), Focusing.focus),\r\n                        run(execute(), emitExecute),\r\n                        run(tapOrClick(), emitExecute)\r\n                    ]),\r\n                    Toggling.config({\r\n                        toggleClass: 'tox-insert-table-picker__selected',\r\n                        toggleOnExecute: false\r\n                    }),\r\n                    Focusing.config({ onFocus: emitCellOver })\r\n                ])\r\n            });\r\n        };\r\n        var makeCells = function (labelId, numRows, numCols) {\r\n            var cells = [];\r\n            for (var i = 0; i < numRows; i++) {\r\n                var row = [];\r\n                for (var j = 0; j < numCols; j++) {\r\n                    row.push(makeCell(i, j, labelId));\r\n                }\r\n                cells.push(row);\r\n            }\r\n            return cells;\r\n        };\r\n        var selectCells = function (cells, selectedRow, selectedColumn, numRows, numColumns) {\r\n            for (var i = 0; i < numRows; i++) {\r\n                for (var j = 0; j < numColumns; j++) {\r\n                    Toggling.set(cells[i][j], i <= selectedRow && j <= selectedColumn);\r\n                }\r\n            }\r\n        };\r\n        var makeComponents = function (cells) {\r\n            return bind(cells, function (cellRow) {\r\n                return map(cellRow, premade$1);\r\n            });\r\n        };\r\n        var makeLabelText = function (row, col) {\r\n            return text(col + 1 + 'x' + (row + 1));\r\n        };\r\n        function renderInsertTableMenuItem(spec) {\r\n            var numRows = 10;\r\n            var numColumns = 10;\r\n            var sizeLabelId = generate$1('size-label');\r\n            var cells = makeCells(sizeLabelId, numRows, numColumns);\r\n            var memLabel = record({\r\n                dom: {\r\n                    tag: 'span',\r\n                    classes: ['tox-insert-table-picker__label'],\r\n                    attributes: { id: sizeLabelId }\r\n                },\r\n                components: [text('0x0')],\r\n                behaviours: derive$1([Replacing.config({})])\r\n            });\r\n            return {\r\n                type: 'widget',\r\n                data: { value: generate$1('widget-id') },\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-fancymenuitem']\r\n                },\r\n                autofocus: true,\r\n                components: [parts$2().widget({\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-insert-table-picker']\r\n                        },\r\n                        components: makeComponents(cells).concat(memLabel.asSpec()),\r\n                        behaviours: derive$1([\r\n                            config('insert-table-picker', [\r\n                                runWithTarget(cellOverEvent, function (c, t, e) {\r\n                                    var row = e.event().row();\r\n                                    var col = e.event().col();\r\n                                    selectCells(cells, row, col, numRows, numColumns);\r\n                                    Replacing.set(memLabel.get(c), [makeLabelText(row, col)]);\r\n                                }),\r\n                                runWithTarget(cellExecuteEvent, function (c, _, e) {\r\n                                    spec.onAction({\r\n                                        numRows: e.event().row() + 1,\r\n                                        numColumns: e.event().col() + 1\r\n                                    });\r\n                                    emit(c, sandboxClose());\r\n                                })\r\n                            ]),\r\n                            Keying.config({\r\n                                initSize: {\r\n                                    numRows: numRows,\r\n                                    numColumns: numColumns\r\n                                },\r\n                                mode: 'flatgrid',\r\n                                selector: '[role=\"button\"]'\r\n                            })\r\n                        ])\r\n                    })]\r\n            };\r\n        }\r\n        var hexColour = function (hexString) {\r\n            return { value: constant(hexString) };\r\n        };\r\n        var shorthandRegex = /^#?([a-f\\d])([a-f\\d])([a-f\\d])$/i;\r\n        var longformRegex = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i;\r\n        var isHexString = function (hex) {\r\n            return shorthandRegex.test(hex) || longformRegex.test(hex);\r\n        };\r\n        var getLongForm = function (hex) {\r\n            var hexString = hex.value().replace(shorthandRegex, function (m, r, g, b) {\r\n                return r + r + g + g + b + b;\r\n            });\r\n            return { value: constant(hexString) };\r\n        };\r\n        var extractValues = function (hex) {\r\n            var longForm = getLongForm(hex);\r\n            var splitForm = longformRegex.exec(longForm.value());\r\n            return splitForm === null ? [\r\n                'FFFFFF',\r\n                'FF',\r\n                'FF',\r\n                'FF'\r\n            ] : splitForm;\r\n        };\r\n        var toHex = function (component) {\r\n            var hex = component.toString(16);\r\n            return hex.length === 1 ? '0' + hex : hex;\r\n        };\r\n        var fromRgba = function (rgbaColour) {\r\n            var value = toHex(rgbaColour.red()) + toHex(rgbaColour.green()) + toHex(rgbaColour.blue());\r\n            return hexColour(value);\r\n        };\r\n        var min = Math.min;\r\n        var max = Math.max;\r\n        var round = Math.round;\r\n        var rgbRegex = /^rgb\\((\\d+),\\s*(\\d+),\\s*(\\d+)\\)/;\r\n        var rgbaRegex = /^rgba\\((\\d+),\\s*(\\d+),\\s*(\\d+),\\s*(\\d?(?:\\.\\d+)?)\\)/;\r\n        var rgbaColour = function (red, green, blue, alpha) {\r\n            return {\r\n                red: constant(red),\r\n                green: constant(green),\r\n                blue: constant(blue),\r\n                alpha: constant(alpha)\r\n            };\r\n        };\r\n        var isRgbaComponent = function (value) {\r\n            var num = parseInt(value, 10);\r\n            return num.toString() === value && num >= 0 && num <= 255;\r\n        };\r\n        var fromHsv = function (hsv) {\r\n            var r;\r\n            var g;\r\n            var b;\r\n            var hue = (hsv.hue() || 0) % 360;\r\n            var saturation = hsv.saturation() / 100;\r\n            var brightness = hsv.value() / 100;\r\n            saturation = max(0, min(saturation, 1));\r\n            brightness = max(0, min(brightness, 1));\r\n            if (saturation === 0) {\r\n                r = g = b = round(255 * brightness);\r\n                return rgbaColour(r, g, b, 1);\r\n            }\r\n            var side = hue / 60;\r\n            var chroma = brightness * saturation;\r\n            var x = chroma * (1 - Math.abs(side % 2 - 1));\r\n            var match = brightness - chroma;\r\n            switch (Math.floor(side)) {\r\n                case 0:\r\n                    r = chroma;\r\n                    g = x;\r\n                    b = 0;\r\n                    break;\r\n                case 1:\r\n                    r = x;\r\n                    g = chroma;\r\n                    b = 0;\r\n                    break;\r\n                case 2:\r\n                    r = 0;\r\n                    g = chroma;\r\n                    b = x;\r\n                    break;\r\n                case 3:\r\n                    r = 0;\r\n                    g = x;\r\n                    b = chroma;\r\n                    break;\r\n                case 4:\r\n                    r = x;\r\n                    g = 0;\r\n                    b = chroma;\r\n                    break;\r\n                case 5:\r\n                    r = chroma;\r\n                    g = 0;\r\n                    b = x;\r\n                    break;\r\n                default:\r\n                    r = g = b = 0;\r\n            }\r\n            r = round(255 * (r + match));\r\n            g = round(255 * (g + match));\r\n            b = round(255 * (b + match));\r\n            return rgbaColour(r, g, b, 1);\r\n        };\r\n        var fromHex = function (hexColour) {\r\n            var result = extractValues(hexColour);\r\n            var red = parseInt(result[1], 16);\r\n            var green = parseInt(result[2], 16);\r\n            var blue = parseInt(result[3], 16);\r\n            return rgbaColour(red, green, blue, 1);\r\n        };\r\n        var fromStringValues = function (red, green, blue, alpha) {\r\n            var r = parseInt(red, 10);\r\n            var g = parseInt(green, 10);\r\n            var b = parseInt(blue, 10);\r\n            var a = parseFloat(alpha);\r\n            return rgbaColour(r, g, b, a);\r\n        };\r\n        var fromString = function (rgbaString) {\r\n            if (rgbaString === 'transparent') {\r\n                return Option.some(rgbaColour(0, 0, 0, 0));\r\n            }\r\n            var rgbMatch = rgbRegex.exec(rgbaString);\r\n            if (rgbMatch !== null) {\r\n                return Option.some(fromStringValues(rgbMatch[1], rgbMatch[2], rgbMatch[3], '1'));\r\n            }\r\n            var rgbaMatch = rgbaRegex.exec(rgbaString);\r\n            if (rgbaMatch !== null) {\r\n                return Option.some(fromStringValues(rgbaMatch[1], rgbaMatch[2], rgbaMatch[3], rgbaMatch[4]));\r\n            }\r\n            return Option.none();\r\n        };\r\n        var toString = function (rgba) {\r\n            return 'rgba(' + rgba.red() + ',' + rgba.green() + ',' + rgba.blue() + ',' + rgba.alpha() + ')';\r\n        };\r\n        var redColour = constant(rgbaColour(255, 0, 0, 1));\r\n        var global$5 = tinymce.util.Tools.resolve('tinymce.util.LocalStorage');\r\n        var storageName = 'tinymce-custom-colors';\r\n        function ColorCache(max) {\r\n            if (max === void 0) {\r\n                max = 10;\r\n            }\r\n            var storageString = global$5.getItem(storageName);\r\n            var localstorage = isString(storageString) ? JSON.parse(storageString) : [];\r\n            var prune = function (list) {\r\n                var diff = max - list.length;\r\n                return diff < 0 ? list.slice(0, max) : list;\r\n            };\r\n            var cache = prune(localstorage);\r\n            var add = function (key) {\r\n                indexOf(cache, key).each(remove);\r\n                cache.unshift(key);\r\n                if (cache.length > max) {\r\n                    cache.pop();\r\n                }\r\n                global$5.setItem(storageName, JSON.stringify(cache));\r\n            };\r\n            var remove = function (idx) {\r\n                cache.splice(idx, 1);\r\n            };\r\n            var state = function () {\r\n                return cache.slice(0);\r\n            };\r\n            return {\r\n                add: add,\r\n                state: state\r\n            };\r\n        }\r\n        var choiceItem = 'choiceitem';\r\n        var defaultColors = [\r\n            {\r\n                type: choiceItem,\r\n                text: 'Turquoise',\r\n                value: '#18BC9B'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Green',\r\n                value: '#2FCC71'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Blue',\r\n                value: '#3598DB'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Purple',\r\n                value: '#9B59B6'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Navy Blue',\r\n                value: '#34495E'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Dark Turquoise',\r\n                value: '#18A085'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Dark Green',\r\n                value: '#27AE60'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Medium Blue',\r\n                value: '#2880B9'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Medium Purple',\r\n                value: '#8E44AD'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Midnight Blue',\r\n                value: '#2B3E50'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Yellow',\r\n                value: '#F1C40F'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Orange',\r\n                value: '#E67E23'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Red',\r\n                value: '#E74C3C'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Light Gray',\r\n                value: '#ECF0F1'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Gray',\r\n                value: '#95A5A6'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Dark Yellow',\r\n                value: '#F29D12'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Dark Orange',\r\n                value: '#D35400'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Dark Red',\r\n                value: '#C0392B'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Medium Gray',\r\n                value: '#BDC3C7'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Dark Gray',\r\n                value: '#7E8C8D'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'Black',\r\n                value: '#000000'\r\n            },\r\n            {\r\n                type: choiceItem,\r\n                text: 'White',\r\n                value: '#ffffff'\r\n            }\r\n        ];\r\n        var colorCache = ColorCache(10);\r\n        var mapColors = function (colorMap) {\r\n            var i;\r\n            var colors = [];\r\n            for (i = 0; i < colorMap.length; i += 2) {\r\n                colors.push({\r\n                    text: colorMap[i + 1],\r\n                    value: '#' + colorMap[i],\r\n                    type: 'choiceitem'\r\n                });\r\n            }\r\n            return colors;\r\n        };\r\n        var getColorCols = function (editor, defaultCols) {\r\n            return editor.getParam('color_cols', defaultCols, 'number');\r\n        };\r\n        var hasCustomColors = function (editor) {\r\n            return editor.getParam('custom_colors') !== false;\r\n        };\r\n        var getColorMap = function (editor) {\r\n            return editor.getParam('color_map');\r\n        };\r\n        var getColors = function (editor) {\r\n            var unmapped = getColorMap(editor);\r\n            return unmapped !== undefined ? mapColors(unmapped) : defaultColors;\r\n        };\r\n        var getCurrentColors = function () {\r\n            return map(colorCache.state(), function (color) {\r\n                return {\r\n                    type: choiceItem,\r\n                    text: color,\r\n                    value: color\r\n                };\r\n            });\r\n        };\r\n        var addColor = function (color) {\r\n            colorCache.add(color);\r\n        };\r\n        var Settings = {\r\n            mapColors: mapColors,\r\n            getColorCols: getColorCols,\r\n            hasCustomColors: hasCustomColors,\r\n            getColorMap: getColorMap,\r\n            getColors: getColors,\r\n            getCurrentColors: getCurrentColors,\r\n            addColor: addColor\r\n        };\r\n        var getCurrentColor = function (editor, format) {\r\n            var color;\r\n            editor.dom.getParents(editor.selection.getStart(), function (elm) {\r\n                var value;\r\n                if (value = elm.style[format === 'forecolor' ? 'color' : 'background-color']) {\r\n                    color = color ? color : value;\r\n                }\r\n            });\r\n            return color;\r\n        };\r\n        var applyFormat = function (editor, format, value) {\r\n            editor.undoManager.transact(function () {\r\n                editor.focus();\r\n                editor.formatter.apply(format, { value: value });\r\n                editor.nodeChanged();\r\n            });\r\n        };\r\n        var removeFormat = function (editor, format) {\r\n            editor.undoManager.transact(function () {\r\n                editor.focus();\r\n                editor.formatter.remove(format, { value: null }, null, true);\r\n                editor.nodeChanged();\r\n            });\r\n        };\r\n        var registerCommands = function (editor) {\r\n            editor.addCommand('mceApplyTextcolor', function (format, value) {\r\n                applyFormat(editor, format, value);\r\n            });\r\n            editor.addCommand('mceRemoveTextcolor', function (format) {\r\n                removeFormat(editor, format);\r\n            });\r\n        };\r\n        var calcCols = function (colors) {\r\n            return Math.max(5, Math.ceil(Math.sqrt(colors)));\r\n        };\r\n        var getColorCols$1 = function (editor) {\r\n            var colors = Settings.getColors(editor);\r\n            var defaultCols = calcCols(colors.length);\r\n            return Settings.getColorCols(editor, defaultCols);\r\n        };\r\n        var getAdditionalColors = function (hasCustom) {\r\n            var type = 'choiceitem';\r\n            var remove = {\r\n                type: type,\r\n                text: 'Remove color',\r\n                icon: 'color-swatch-remove-color',\r\n                value: 'remove'\r\n            };\r\n            var custom = {\r\n                type: type,\r\n                text: 'Custom color',\r\n                icon: 'color-picker',\r\n                value: 'custom'\r\n            };\r\n            return hasCustom ? [\r\n                remove,\r\n                custom\r\n            ] : [remove];\r\n        };\r\n        var applyColour = function (editor, format, value, onChoice) {\r\n            if (value === 'custom') {\r\n                var dialog = colorPickerDialog(editor);\r\n                dialog(function (colorOpt) {\r\n                    colorOpt.each(function (color) {\r\n                        Settings.addColor(color);\r\n                        editor.execCommand('mceApplyTextcolor', format, color);\r\n                        onChoice(color);\r\n                    });\r\n                }, '#000000');\r\n            }\r\n            else if (value === 'remove') {\r\n                onChoice('');\r\n                editor.execCommand('mceRemoveTextcolor', format);\r\n            }\r\n            else {\r\n                onChoice(value);\r\n                editor.execCommand('mceApplyTextcolor', format, value);\r\n            }\r\n        };\r\n        var getMenuColors = function (colors, hasCustom) {\r\n            return colors.concat(Settings.getCurrentColors().concat(getAdditionalColors(hasCustom)));\r\n        };\r\n        var getFetch = function (colors, hasCustom) {\r\n            return function (callback) {\r\n                callback(getMenuColors(colors, hasCustom));\r\n            };\r\n        };\r\n        var setIconColor = function (splitButtonApi, name, newColor) {\r\n            var setIconFillAndStroke = function (pathId, color) {\r\n                splitButtonApi.setIconFill(pathId, color);\r\n                splitButtonApi.setIconStroke(pathId, color);\r\n            };\r\n            var id = name === 'forecolor' ? 'tox-icon-text-color__color' : 'tox-icon-highlight-bg-color__color';\r\n            setIconFillAndStroke(id, newColor);\r\n        };\r\n        var registerTextColorButton = function (editor, name, format, tooltip, lastColor) {\r\n            editor.ui.registry.addSplitButton(name, {\r\n                tooltip: tooltip,\r\n                presets: 'color',\r\n                icon: name === 'forecolor' ? 'text-color' : 'highlight-bg-color',\r\n                select: function (value) {\r\n                    var optCurrentRgb = Option.from(getCurrentColor(editor, format));\r\n                    return optCurrentRgb.bind(function (currentRgb) {\r\n                        return fromString(currentRgb).map(function (rgba) {\r\n                            var currentHex = fromRgba(rgba).value();\r\n                            return contains$1(value.toLowerCase(), currentHex);\r\n                        });\r\n                    }).getOr(false);\r\n                },\r\n                columns: getColorCols$1(editor),\r\n                fetch: getFetch(Settings.getColors(editor), Settings.hasCustomColors(editor)),\r\n                onAction: function (splitButtonApi) {\r\n                    if (lastColor.get() !== null) {\r\n                        applyColour(editor, format, lastColor.get(), function () {\r\n                        });\r\n                    }\r\n                },\r\n                onItemAction: function (splitButtonApi, value) {\r\n                    applyColour(editor, format, value, function (newColour) {\r\n                        lastColor.set(newColour);\r\n                        setIconColor(splitButtonApi, name, newColour);\r\n                    });\r\n                },\r\n                onSetup: function (splitButtonApi) {\r\n                    if (lastColor.get() !== null) {\r\n                        setIconColor(splitButtonApi, name, lastColor.get());\r\n                    }\r\n                    return function () {\r\n                    };\r\n                }\r\n            });\r\n        };\r\n        var registerTextColorMenuItem = function (editor, name, format, text) {\r\n            editor.ui.registry.addNestedMenuItem(name, {\r\n                text: text,\r\n                icon: name === 'forecolor' ? 'text-color' : 'highlight-bg-color',\r\n                getSubmenuItems: function () {\r\n                    return [{\r\n                            type: 'fancymenuitem',\r\n                            fancytype: 'colorswatch',\r\n                            onAction: function (data) {\r\n                                applyColour(editor, format, data.value, noop);\r\n                            }\r\n                        }];\r\n                }\r\n            });\r\n        };\r\n        var colorPickerDialog = function (editor) {\r\n            return function (callback, value) {\r\n                var getOnSubmit = function (callback) {\r\n                    return function (api) {\r\n                        var data = api.getData();\r\n                        callback(Option.from(data.colorpicker));\r\n                        api.close();\r\n                    };\r\n                };\r\n                var onAction = function (api, details) {\r\n                    if (details.name === 'hex-valid') {\r\n                        if (details.value) {\r\n                            api.enable('ok');\r\n                        }\r\n                        else {\r\n                            api.disable('ok');\r\n                        }\r\n                    }\r\n                };\r\n                var initialData = { colorpicker: value };\r\n                var submit = getOnSubmit(callback);\r\n                editor.windowManager.open({\r\n                    title: 'Color Picker',\r\n                    size: 'normal',\r\n                    body: {\r\n                        type: 'panel',\r\n                        items: [{\r\n                                type: 'colorpicker',\r\n                                name: 'colorpicker',\r\n                                label: 'Color'\r\n                            }]\r\n                    },\r\n                    buttons: [\r\n                        {\r\n                            type: 'cancel',\r\n                            name: 'cancel',\r\n                            text: 'Cancel'\r\n                        },\r\n                        {\r\n                            type: 'submit',\r\n                            name: 'save',\r\n                            text: 'Save',\r\n                            primary: true\r\n                        }\r\n                    ],\r\n                    initialData: initialData,\r\n                    onAction: onAction,\r\n                    onSubmit: submit,\r\n                    onClose: function () {\r\n                    },\r\n                    onCancel: function () {\r\n                        callback(Option.none());\r\n                    }\r\n                });\r\n            };\r\n        };\r\n        var register$1 = function (editor) {\r\n            registerCommands(editor);\r\n            var lastForeColor = Cell(null);\r\n            var lastBackColor = Cell(null);\r\n            registerTextColorButton(editor, 'forecolor', 'forecolor', 'Text color', lastForeColor);\r\n            registerTextColorButton(editor, 'backcolor', 'hilitecolor', 'Background color', lastBackColor);\r\n            registerTextColorMenuItem(editor, 'forecolor', 'forecolor', 'Text color');\r\n            registerTextColorMenuItem(editor, 'backcolor', 'hilitecolor', 'Background color');\r\n        };\r\n        var ColorSwatch = {\r\n            register: register$1,\r\n            getColors: getMenuColors,\r\n            getFetch: getFetch,\r\n            colorPickerDialog: colorPickerDialog,\r\n            getCurrentColor: getCurrentColor,\r\n            getColorCols: getColorCols$1,\r\n            calcCols: calcCols\r\n        };\r\n        var chunk$1 = function (rowDom, numColumns) {\r\n            return function (items) {\r\n                var chunks = chunk(items, numColumns);\r\n                return map(chunks, function (c) {\r\n                    return {\r\n                        dom: rowDom,\r\n                        components: c\r\n                    };\r\n                });\r\n            };\r\n        };\r\n        var forSwatch = function (columns) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox-menu',\r\n                        'tox-swatches-menu'\r\n                    ]\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-swatches']\r\n                        },\r\n                        components: [Menu.parts().items({\r\n                                preprocess: columns !== 'auto' ? chunk$1({\r\n                                    tag: 'div',\r\n                                    classes: ['tox-swatches__row']\r\n                                }, columns) : identity\r\n                            })]\r\n                    }]\r\n            };\r\n        };\r\n        var forToolbar = function (columns) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox-menu',\r\n                        'tox-collection',\r\n                        'tox-collection--toolbar',\r\n                        'tox-collection--toolbar-lg'\r\n                    ]\r\n                },\r\n                components: [Menu.parts().items({\r\n                        preprocess: chunk$1({\r\n                            tag: 'div',\r\n                            classes: ['tox-collection__group']\r\n                        }, columns)\r\n                    })]\r\n            };\r\n        };\r\n        var preprocessCollection = function (items, isSeparator) {\r\n            var allSplits = [];\r\n            var currentSplit = [];\r\n            each(items, function (item, i) {\r\n                if (isSeparator(item, i)) {\r\n                    if (currentSplit.length > 0) {\r\n                        allSplits.push(currentSplit);\r\n                    }\r\n                    currentSplit = [];\r\n                    if (has(item.dom, 'innerHtml')) {\r\n                        currentSplit.push(item);\r\n                    }\r\n                }\r\n                else {\r\n                    currentSplit.push(item);\r\n                }\r\n            });\r\n            if (currentSplit.length > 0) {\r\n                allSplits.push(currentSplit);\r\n            }\r\n            return map(allSplits, function (s) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-collection__group']\r\n                    },\r\n                    components: s\r\n                };\r\n            });\r\n        };\r\n        var forCollection = function (columns, initItems, hasIcons) {\r\n            if (hasIcons === void 0) {\r\n                hasIcons = true;\r\n            }\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox-menu',\r\n                        'tox-collection'\r\n                    ].concat(columns === 1 ? ['tox-collection--list'] : ['tox-collection--grid'])\r\n                },\r\n                components: [Menu.parts().items({\r\n                        preprocess: function (items) {\r\n                            if (columns !== 'auto' && columns > 1) {\r\n                                return chunk$1({\r\n                                    tag: 'div',\r\n                                    classes: ['tox-collection__group']\r\n                                }, columns)(items);\r\n                            }\r\n                            else {\r\n                                return preprocessCollection(items, function (item, i) {\r\n                                    return initItems[i].type === 'separator';\r\n                                });\r\n                            }\r\n                        }\r\n                    })]\r\n            };\r\n        };\r\n        var forMenu = function (presets) {\r\n            if (presets === 'color') {\r\n                return 'tox-swatches';\r\n            }\r\n            else {\r\n                return 'tox-menu';\r\n            }\r\n        };\r\n        var classes = function (presets) {\r\n            return {\r\n                backgroundMenu: 'tox-background-menu',\r\n                selectedMenu: 'tox-selected-menu',\r\n                selectedItem: 'tox-collection__item--active',\r\n                hasIcons: 'tox-menu--has-icons',\r\n                menu: forMenu(presets),\r\n                tieredMenu: 'tox-tiered-menu'\r\n            };\r\n        };\r\n        var markers$1 = function (presets) {\r\n            var menuClasses = classes(presets);\r\n            return {\r\n                backgroundMenu: menuClasses.backgroundMenu,\r\n                selectedMenu: menuClasses.selectedMenu,\r\n                menu: menuClasses.menu,\r\n                selectedItem: menuClasses.selectedItem,\r\n                item: classForPreset(presets)\r\n            };\r\n        };\r\n        var dom$1 = function (hasIcons, columns, presets) {\r\n            var menuClasses = classes(presets);\r\n            return {\r\n                tag: 'div',\r\n                classes: flatten([\r\n                    [\r\n                        menuClasses.menu,\r\n                        'tox-menu-' + columns + '-column'\r\n                    ],\r\n                    hasIcons ? [menuClasses.hasIcons] : []\r\n                ])\r\n            };\r\n        };\r\n        var components$1 = [Menu.parts().items({})];\r\n        var part = function (hasIcons, columns, presets) {\r\n            var menuClasses = classes(presets);\r\n            var d = {\r\n                tag: 'div',\r\n                classes: flatten([[menuClasses.tieredMenu]])\r\n            };\r\n            return {\r\n                dom: d,\r\n                markers: markers$1(presets)\r\n            };\r\n        };\r\n        var hasIcon = function (item) {\r\n            return item.icon !== undefined || item.type === 'togglemenuitem' || item.type === 'choicemenuitem';\r\n        };\r\n        var menuHasIcons = function (xs) {\r\n            return exists(xs, hasIcon);\r\n        };\r\n        var handleError = function (error) {\r\n            domGlobals.console.error(formatError(error));\r\n            domGlobals.console.log(error);\r\n            return Option.none();\r\n        };\r\n        var createPartialMenuWithAlloyItems = function (value, hasIcons, items, columns, presets) {\r\n            if (presets === 'color') {\r\n                var structure = forSwatch(columns);\r\n                return {\r\n                    value: value,\r\n                    dom: structure.dom,\r\n                    components: structure.components,\r\n                    items: items\r\n                };\r\n            }\r\n            if (presets === 'normal' && columns === 'auto') {\r\n                var structure = forCollection(columns, items);\r\n                return {\r\n                    value: value,\r\n                    dom: structure.dom,\r\n                    components: structure.components,\r\n                    items: items\r\n                };\r\n            }\r\n            if (presets === 'normal' && columns === 1) {\r\n                var structure = forCollection(1, items);\r\n                return {\r\n                    value: value,\r\n                    dom: structure.dom,\r\n                    components: structure.components,\r\n                    items: items\r\n                };\r\n            }\r\n            if (presets === 'normal') {\r\n                var structure = forCollection(columns, items);\r\n                return {\r\n                    value: value,\r\n                    dom: structure.dom,\r\n                    components: structure.components,\r\n                    items: items\r\n                };\r\n            }\r\n            if (presets === 'listpreview' && columns !== 'auto') {\r\n                var structure = forToolbar(columns);\r\n                return {\r\n                    value: value,\r\n                    dom: structure.dom,\r\n                    components: structure.components,\r\n                    items: items\r\n                };\r\n            }\r\n            return {\r\n                value: value,\r\n                dom: dom$1(hasIcons, columns, presets),\r\n                components: components$1,\r\n                items: items\r\n            };\r\n        };\r\n        var createPartialChoiceMenu = function (value, items, onItemValueHandler, columns, presets, itemResponse, select, providersBackstage) {\r\n            var hasIcons = menuHasIcons(items);\r\n            var presetItemTypes = presets !== 'color' ? 'normal' : 'color';\r\n            var alloyItems = createChoiceItems(items, onItemValueHandler, columns, presetItemTypes, itemResponse, select, providersBackstage);\r\n            return createPartialMenuWithAlloyItems(value, hasIcons, alloyItems, columns, presets);\r\n        };\r\n        var createChoiceItems = function (items, onItemValueHandler, columns, itemPresets, itemResponse, select, providersBackstage) {\r\n            return cat(map(items, function (item) {\r\n                if (item.type === 'choiceitem') {\r\n                    return createChoiceMenuItem(item).fold(handleError, function (d) {\r\n                        return Option.some(renderChoiceItem(d, columns === 1, itemPresets, onItemValueHandler, select(item.value), itemResponse, providersBackstage));\r\n                    });\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            }));\r\n        };\r\n        var deriveMenuMovement = function (columns, presets) {\r\n            var menuMarkers = markers$1(presets);\r\n            if (columns === 1) {\r\n                return {\r\n                    mode: 'menu',\r\n                    moveOnTab: true\r\n                };\r\n            }\r\n            else if (columns === 'auto') {\r\n                return {\r\n                    mode: 'grid',\r\n                    selector: '.' + menuMarkers.item,\r\n                    initSize: {\r\n                        numColumns: 1,\r\n                        numRows: 1\r\n                    }\r\n                };\r\n            }\r\n            else {\r\n                var rowClass = presets === 'color' ? 'tox-swatches__row' : 'tox-collection__group';\r\n                return {\r\n                    mode: 'matrix',\r\n                    rowSelector: '.' + rowClass\r\n                };\r\n            }\r\n        };\r\n        var deriveCollectionMovement = function (columns, presets) {\r\n            if (columns === 1) {\r\n                return {\r\n                    mode: 'menu',\r\n                    moveOnTab: false,\r\n                    selector: '.tox-collection__item'\r\n                };\r\n            }\r\n            else if (columns === 'auto') {\r\n                return {\r\n                    mode: 'flatgrid',\r\n                    selector: '.' + 'tox-collection__item',\r\n                    initSize: {\r\n                        numColumns: 1,\r\n                        numRows: 1\r\n                    }\r\n                };\r\n            }\r\n            else {\r\n                return {\r\n                    mode: 'matrix',\r\n                    selectors: {\r\n                        row: presets === 'color' ? '.tox-swatches__row' : '.tox-collection__group',\r\n                        cell: presets === 'color' ? '.' + colorClass : '.' + selectableClass\r\n                    }\r\n                };\r\n            }\r\n        };\r\n        function renderColorSwatchItem(spec, backstage) {\r\n            var items = ColorSwatch.getColors(backstage.colorinput.getColors(), backstage.colorinput.hasCustomColors());\r\n            var columns = backstage.colorinput.getColorCols();\r\n            var presets = 'color';\r\n            var menuSpec = createPartialChoiceMenu(generate$1('menu-value'), items, function (value) {\r\n                spec.onAction({ value: value });\r\n            }, columns, presets, ItemResponse$1.CLOSE_ON_EXECUTE, function () {\r\n                return false;\r\n            }, backstage.shared.providers);\r\n            var widgetSpec = deepMerge(__assign({}, menuSpec, {\r\n                markers: markers$1(presets),\r\n                movement: deriveMenuMovement(columns, presets)\r\n            }));\r\n            return {\r\n                type: 'widget',\r\n                data: { value: generate$1('widget-id') },\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-fancymenuitem']\r\n                },\r\n                autofocus: true,\r\n                components: [parts$2().widget(Menu.sketch(widgetSpec))]\r\n            };\r\n        }\r\n        var fancyMenuItems = {\r\n            inserttable: renderInsertTableMenuItem,\r\n            colorswatch: renderColorSwatchItem\r\n        };\r\n        var valueOpt = function (obj, key) {\r\n            return Object.prototype.hasOwnProperty.call(obj, key) ? Option.some(obj[key]) : Option.none();\r\n        };\r\n        var renderFancyMenuItem = function (spec, backstage) {\r\n            return valueOpt(fancyMenuItems, spec.fancytype).map(function (render) {\r\n                return render(spec, backstage);\r\n            });\r\n        };\r\n        var renderNormalItem = function (spec, itemResponse, providersBackstage, renderIcons) {\r\n            if (renderIcons === void 0) {\r\n                renderIcons = true;\r\n            }\r\n            var getApi = function (component) {\r\n                return {\r\n                    isDisabled: function () {\r\n                        return Disabling.isDisabled(component);\r\n                    },\r\n                    setDisabled: function (state) {\r\n                        return Disabling.set(component, state);\r\n                    }\r\n                };\r\n            };\r\n            var structure = renderItemStructure({\r\n                presets: 'normal',\r\n                iconContent: spec.icon,\r\n                textContent: spec.text,\r\n                ariaLabel: spec.text,\r\n                caret: Option.none(),\r\n                checkMark: Option.none(),\r\n                shortcutContent: spec.shortcut\r\n            }, providersBackstage, renderIcons);\r\n            return renderCommonItem({\r\n                data: buildData(spec),\r\n                getApi: getApi,\r\n                disabled: spec.disabled,\r\n                onAction: spec.onAction,\r\n                onSetup: spec.onSetup,\r\n                triggersSubmenu: false,\r\n                itemBehaviours: []\r\n            }, structure, itemResponse);\r\n        };\r\n        var renderNestedItem = function (spec, itemResponse, providersBackstage, renderIcons) {\r\n            if (renderIcons === void 0) {\r\n                renderIcons = true;\r\n            }\r\n            var caret = renderSubmenuCaret(providersBackstage.icons);\r\n            var getApi = function (component) {\r\n                return {\r\n                    isDisabled: function () {\r\n                        return Disabling.isDisabled(component);\r\n                    },\r\n                    setDisabled: function (state) {\r\n                        return Disabling.set(component, state);\r\n                    }\r\n                };\r\n            };\r\n            var structure = renderItemStructure({\r\n                presets: 'normal',\r\n                iconContent: spec.icon,\r\n                textContent: spec.text,\r\n                ariaLabel: spec.text,\r\n                caret: Option.some(caret),\r\n                checkMark: Option.none(),\r\n                shortcutContent: spec.shortcut\r\n            }, providersBackstage, renderIcons);\r\n            return renderCommonItem({\r\n                data: buildData(spec),\r\n                getApi: getApi,\r\n                disabled: spec.disabled,\r\n                onAction: noop,\r\n                onSetup: spec.onSetup,\r\n                triggersSubmenu: true,\r\n                itemBehaviours: []\r\n            }, structure, itemResponse);\r\n        };\r\n        var renderSeparatorItem = function (spec) {\r\n            var innerHtml = spec.text.fold(function () {\r\n                return {};\r\n            }, function (text) {\r\n                return { innerHtml: text };\r\n            });\r\n            return {\r\n                type: 'separator',\r\n                dom: __assign({\r\n                    tag: 'div',\r\n                    classes: [\r\n                        selectableClass,\r\n                        groupHeadingClass\r\n                    ]\r\n                }, innerHtml),\r\n                components: []\r\n            };\r\n        };\r\n        var renderToggleMenuItem = function (spec, itemResponse, providersBackstage) {\r\n            var getApi = function (component) {\r\n                return {\r\n                    setActive: function (state) {\r\n                        Toggling.set(component, state);\r\n                    },\r\n                    isActive: function () {\r\n                        return Toggling.isOn(component);\r\n                    },\r\n                    isDisabled: function () {\r\n                        return Disabling.isDisabled(component);\r\n                    },\r\n                    setDisabled: function (state) {\r\n                        return Disabling.set(component, state);\r\n                    }\r\n                };\r\n            };\r\n            var structure = renderItemStructure({\r\n                iconContent: Option.none(),\r\n                textContent: spec.text,\r\n                ariaLabel: spec.text,\r\n                checkMark: Option.some(renderCheckmark(providersBackstage.icons)),\r\n                caret: Option.none(),\r\n                shortcutContent: spec.shortcut,\r\n                presets: 'normal',\r\n                meta: spec.meta\r\n            }, providersBackstage, true);\r\n            return deepMerge(renderCommonItem({\r\n                data: buildData(spec),\r\n                disabled: spec.disabled,\r\n                getApi: getApi,\r\n                onAction: spec.onAction,\r\n                onSetup: spec.onSetup,\r\n                triggersSubmenu: false,\r\n                itemBehaviours: []\r\n            }, structure, itemResponse), {\r\n                toggling: {\r\n                    toggleClass: tickedClass,\r\n                    toggleOnExecute: false,\r\n                    selected: spec.active\r\n                }\r\n            });\r\n        };\r\n        var autocomplete = renderAutocompleteItem;\r\n        var separator = renderSeparatorItem;\r\n        var normal = renderNormalItem;\r\n        var nested = renderNestedItem;\r\n        var toggle$3 = renderToggleMenuItem;\r\n        var fancy = renderFancyMenuItem;\r\n        var FocusMode;\r\n        (function (FocusMode) {\r\n            FocusMode[FocusMode['ContentFocus'] = 0] = 'ContentFocus';\r\n            FocusMode[FocusMode['UiFocus'] = 1] = 'UiFocus';\r\n        }(FocusMode || (FocusMode = {})));\r\n        var hasIcon$1 = function (item) {\r\n            return item.icon !== undefined || item.type === 'togglemenuitem' || item.type === 'choicemenuitem';\r\n        };\r\n        var menuHasIcons$1 = function (xs) {\r\n            return exists(xs, hasIcon$1);\r\n        };\r\n        var createMenuItemFromBridge = function (item, itemResponse, backstage, menuHasIcons) {\r\n            if (menuHasIcons === void 0) {\r\n                menuHasIcons = true;\r\n            }\r\n            var providersBackstage = backstage.shared.providers;\r\n            switch (item.type) {\r\n                case 'menuitem':\r\n                    return createMenuItem(item).fold(handleError, function (d) {\r\n                        return Option.some(normal(d, itemResponse, providersBackstage, menuHasIcons));\r\n                    });\r\n                case 'nestedmenuitem':\r\n                    return createNestedMenuItem(item).fold(handleError, function (d) {\r\n                        return Option.some(nested(d, itemResponse, providersBackstage, menuHasIcons));\r\n                    });\r\n                case 'togglemenuitem':\r\n                    return createToggleMenuItem(item).fold(handleError, function (d) {\r\n                        return Option.some(toggle$3(d, itemResponse, providersBackstage));\r\n                    });\r\n                case 'separator':\r\n                    return createSeparatorMenuItem(item).fold(handleError, function (d) {\r\n                        return Option.some(separator(d));\r\n                    });\r\n                case 'fancymenuitem':\r\n                    return createFancyMenuItem(item).fold(handleError, function (d) {\r\n                        return fancy(d, backstage);\r\n                    });\r\n                default: {\r\n                    domGlobals.console.error('Unknown item in general menu', item);\r\n                    return Option.none();\r\n                }\r\n            }\r\n        };\r\n        var createAutocompleteItems = function (items, onItemValueHandler, columns, itemResponse, sharedBackstage) {\r\n            var renderText = columns === 1;\r\n            var renderIcons = !renderText || menuHasIcons$1(items);\r\n            return cat(map(items, function (item) {\r\n                return createAutocompleterItem(item).fold(handleError, function (d) {\r\n                    return Option.some(autocomplete(d, renderText, 'normal', onItemValueHandler, itemResponse, sharedBackstage, renderIcons));\r\n                });\r\n            }));\r\n        };\r\n        var createPartialMenu = function (value, items, itemResponse, backstage) {\r\n            var hasIcons = menuHasIcons$1(items);\r\n            var alloyItems = cat(map(items, function (item) {\r\n                var createItem = function (i) {\r\n                    return createMenuItemFromBridge(i, itemResponse, backstage, hasIcons);\r\n                };\r\n                if (item.type === 'nestedmenuitem' && item.getSubmenuItems().length <= 0) {\r\n                    return createItem(merge(item, { disabled: true }));\r\n                }\r\n                else {\r\n                    return createItem(item);\r\n                }\r\n            }));\r\n            return createPartialMenuWithAlloyItems(value, hasIcons, alloyItems, 1, 'normal');\r\n        };\r\n        var createTieredDataFrom = function (partialMenu) {\r\n            return tieredMenu.singleData(partialMenu.value, partialMenu);\r\n        };\r\n        var createMenuFrom = function (partialMenu, columns, focusMode, presets) {\r\n            var focusManager = focusMode === FocusMode.ContentFocus ? highlights() : dom();\r\n            var movement = deriveMenuMovement(columns, presets);\r\n            var menuMarkers = markers$1(presets);\r\n            return {\r\n                dom: partialMenu.dom,\r\n                components: partialMenu.components,\r\n                items: partialMenu.items,\r\n                value: partialMenu.value,\r\n                markers: {\r\n                    selectedItem: menuMarkers.selectedItem,\r\n                    item: menuMarkers.item\r\n                },\r\n                movement: movement,\r\n                fakeFocus: focusMode === FocusMode.ContentFocus,\r\n                focusManager: focusManager,\r\n                menuBehaviours: SimpleBehaviours.unnamedEvents(columns !== 'auto' ? [] : [runOnAttached(function (comp, se) {\r\n                        detectSize(comp, 4, menuMarkers.item).each(function (_a) {\r\n                            var numColumns = _a.numColumns, numRows = _a.numRows;\r\n                            Keying.setGridSize(comp, numRows, numColumns);\r\n                        });\r\n                    })])\r\n            };\r\n        };\r\n        var register$2 = function (editor, sharedBackstage) {\r\n            var autocompleter = build$1(InlineView.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-autocompleter']\r\n                },\r\n                components: [],\r\n                lazySink: sharedBackstage.getSink\r\n            }));\r\n            var isActive = function () {\r\n                return InlineView.isOpen(autocompleter);\r\n            };\r\n            var closeIfNecessary = function () {\r\n                if (isActive()) {\r\n                    InlineView.hide(autocompleter);\r\n                }\r\n            };\r\n            var getAutocompleters = cached(function () {\r\n                return register(editor);\r\n            });\r\n            var getCombinedItems = function (triggerChar, matches) {\r\n                var columns = findMap(matches, function (m) {\r\n                    return Option.from(m.columns);\r\n                }).getOr(1);\r\n                return bind(matches, function (match) {\r\n                    var choices = match.items;\r\n                    return createAutocompleteItems(choices, function (itemValue, itemMeta) {\r\n                        var nr = editor.selection.getRng();\r\n                        var textNode = nr.startContainer;\r\n                        getContext(nr, triggerChar, textNode.data, nr.startOffset).fold(function () {\r\n                            return domGlobals.console.error('Lost context. Cursor probably moved');\r\n                        }, function (_a) {\r\n                            var rng = _a.rng;\r\n                            var autocompleterApi = { hide: closeIfNecessary };\r\n                            match.onAction(autocompleterApi, rng, itemValue, itemMeta);\r\n                        });\r\n                    }, columns, ItemResponse$1.BUBBLE_TO_SANDBOX, sharedBackstage);\r\n                });\r\n            };\r\n            var onKeypress = last$2(function (e) {\r\n                var optMatches = e.key === ' ' ? Option.none() : lookup(editor, getAutocompleters);\r\n                optMatches.fold(closeIfNecessary, function (lookupInfo) {\r\n                    lookupInfo.lookupData.then(function (lookupData) {\r\n                        var combinedItems = getCombinedItems(lookupInfo.triggerChar, lookupData);\r\n                        if (combinedItems.length > 0) {\r\n                            var columns = findMap(lookupData, function (ld) {\r\n                                return Option.from(ld.columns);\r\n                            }).getOr(1);\r\n                            InlineView.showAt(autocompleter, {\r\n                                anchor: 'selection',\r\n                                root: Element.fromDom(editor.getBody()),\r\n                                getSelection: function () {\r\n                                    return Option.some({\r\n                                        start: function () {\r\n                                            return Element.fromDom(lookupInfo.range.startContainer);\r\n                                        },\r\n                                        soffset: function () {\r\n                                            return lookupInfo.range.startOffset;\r\n                                        },\r\n                                        finish: function () {\r\n                                            return Element.fromDom(lookupInfo.range.endContainer);\r\n                                        },\r\n                                        foffset: function () {\r\n                                            return lookupInfo.range.endOffset;\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }, Menu.sketch(createMenuFrom(createPartialMenuWithAlloyItems('autocompleter-value', true, combinedItems, columns, 'normal'), columns, FocusMode.ContentFocus, 'normal')));\r\n                            InlineView.getContent(autocompleter).each(Highlighting.highlightFirst);\r\n                        }\r\n                        else {\r\n                            closeIfNecessary();\r\n                        }\r\n                    });\r\n                });\r\n            }, 50);\r\n            var autocompleterUiApi = {\r\n                onKeypress: onKeypress,\r\n                closeIfNecessary: closeIfNecessary,\r\n                isActive: isActive,\r\n                getView: function () {\r\n                    return InlineView.getContent(autocompleter);\r\n                }\r\n            };\r\n            AutocompleterEditorEvents.setup(autocompleterUiApi, editor);\r\n        };\r\n        var Autocompleter = { register: register$2 };\r\n        var mkEvent = function (target, x, y, stop, prevent, kill, raw) {\r\n            return {\r\n                target: constant(target),\r\n                x: constant(x),\r\n                y: constant(y),\r\n                stop: stop,\r\n                prevent: prevent,\r\n                kill: kill,\r\n                raw: constant(raw)\r\n            };\r\n        };\r\n        var handle = function (filter, handler) {\r\n            return function (rawEvent) {\r\n                if (!filter(rawEvent)) {\r\n                    return;\r\n                }\r\n                var target = Element.fromDom(rawEvent.target);\r\n                var stop = function () {\r\n                    rawEvent.stopPropagation();\r\n                };\r\n                var prevent = function () {\r\n                    rawEvent.preventDefault();\r\n                };\r\n                var kill = compose(prevent, stop);\r\n                var evt = mkEvent(target, rawEvent.clientX, rawEvent.clientY, stop, prevent, kill, rawEvent);\r\n                handler(evt);\r\n            };\r\n        };\r\n        var binder = function (element, event, filter, handler, useCapture) {\r\n            var wrapped = handle(filter, handler);\r\n            element.dom().addEventListener(event, wrapped, useCapture);\r\n            return { unbind: curry(unbind, element, event, wrapped, useCapture) };\r\n        };\r\n        var bind$2 = function (element, event, filter, handler) {\r\n            return binder(element, event, filter, handler, false);\r\n        };\r\n        var capture = function (element, event, filter, handler) {\r\n            return binder(element, event, filter, handler, true);\r\n        };\r\n        var unbind = function (element, event, handler, useCapture) {\r\n            element.dom().removeEventListener(event, handler, useCapture);\r\n        };\r\n        var filter$1 = constant(true);\r\n        var bind$3 = function (element, event, handler) {\r\n            return bind$2(element, event, filter$1, handler);\r\n        };\r\n        var capture$1 = function (element, event, handler) {\r\n            return capture(element, event, filter$1, handler);\r\n        };\r\n        var closest$4 = function (scope, selector, isRoot) {\r\n            return closest$3(scope, selector, isRoot).isSome();\r\n        };\r\n        function DelayedFunction(fun, delay) {\r\n            var ref = null;\r\n            var schedule = function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                ref = domGlobals.setTimeout(function () {\r\n                    fun.apply(null, args);\r\n                    ref = null;\r\n                }, delay);\r\n            };\r\n            var cancel = function () {\r\n                if (ref !== null) {\r\n                    domGlobals.clearTimeout(ref);\r\n                    ref = null;\r\n                }\r\n            };\r\n            return {\r\n                cancel: cancel,\r\n                schedule: schedule\r\n            };\r\n        }\r\n        var SIGNIFICANT_MOVE = 5;\r\n        var LONGPRESS_DELAY = 400;\r\n        var getTouch = function (event) {\r\n            var raw = event.raw();\r\n            if (raw.touches === undefined || raw.touches.length !== 1) {\r\n                return Option.none();\r\n            }\r\n            return Option.some(raw.touches[0]);\r\n        };\r\n        var isFarEnough = function (touch, data) {\r\n            var distX = Math.abs(touch.clientX - data.x());\r\n            var distY = Math.abs(touch.clientY - data.y());\r\n            return distX > SIGNIFICANT_MOVE || distY > SIGNIFICANT_MOVE;\r\n        };\r\n        var monitor = function (settings) {\r\n            var startData = Cell(Option.none());\r\n            var longpress$1 = DelayedFunction(function (event) {\r\n                startData.set(Option.none());\r\n                settings.triggerEvent(longpress(), event);\r\n            }, LONGPRESS_DELAY);\r\n            var handleTouchstart = function (event) {\r\n                getTouch(event).each(function (touch) {\r\n                    longpress$1.cancel();\r\n                    var data = {\r\n                        x: constant(touch.clientX),\r\n                        y: constant(touch.clientY),\r\n                        target: event.target\r\n                    };\r\n                    longpress$1.schedule(event);\r\n                    startData.set(Option.some(data));\r\n                });\r\n                return Option.none();\r\n            };\r\n            var handleTouchmove = function (event) {\r\n                longpress$1.cancel();\r\n                getTouch(event).each(function (touch) {\r\n                    startData.get().each(function (data) {\r\n                        if (isFarEnough(touch, data)) {\r\n                            startData.set(Option.none());\r\n                        }\r\n                    });\r\n                });\r\n                return Option.none();\r\n            };\r\n            var handleTouchend = function (event) {\r\n                longpress$1.cancel();\r\n                var isSame = function (data) {\r\n                    return eq(data.target(), event.target());\r\n                };\r\n                return startData.get().filter(isSame).map(function (data) {\r\n                    return settings.triggerEvent(tap(), event);\r\n                });\r\n            };\r\n            var handlers = wrapAll$1([\r\n                {\r\n                    key: touchstart(),\r\n                    value: handleTouchstart\r\n                },\r\n                {\r\n                    key: touchmove(),\r\n                    value: handleTouchmove\r\n                },\r\n                {\r\n                    key: touchend(),\r\n                    value: handleTouchend\r\n                }\r\n            ]);\r\n            var fireIfReady = function (event, type) {\r\n                return readOptFrom$1(handlers, type).bind(function (handler) {\r\n                    return handler(event);\r\n                });\r\n            };\r\n            return { fireIfReady: fireIfReady };\r\n        };\r\n        var isDangerous = function (event) {\r\n            var keyEv = event.raw();\r\n            return keyEv.which === BACKSPACE()[0] && !contains([\r\n                'input',\r\n                'textarea'\r\n            ], name(event.target())) && !closest$4(event.target(), '[contenteditable=\"true\"]');\r\n        };\r\n        var isFirefox = PlatformDetection$1.detect().browser.isFirefox();\r\n        var settingsSchema = objOfOnly([\r\n            strictFunction('triggerEvent'),\r\n            defaulted$1('stopBackspace', true)\r\n        ]);\r\n        var bindFocus = function (container, handler) {\r\n            if (isFirefox) {\r\n                return capture$1(container, 'focus', handler);\r\n            }\r\n            else {\r\n                return bind$3(container, 'focusin', handler);\r\n            }\r\n        };\r\n        var bindBlur = function (container, handler) {\r\n            if (isFirefox) {\r\n                return capture$1(container, 'blur', handler);\r\n            }\r\n            else {\r\n                return bind$3(container, 'focusout', handler);\r\n            }\r\n        };\r\n        var setup$1 = function (container, rawSettings) {\r\n            var settings = asRawOrDie('Getting GUI events settings', settingsSchema, rawSettings);\r\n            var pointerEvents = PlatformDetection$1.detect().deviceType.isTouch() ? [\r\n                'touchstart',\r\n                'touchmove',\r\n                'touchend',\r\n                'gesturestart'\r\n            ] : [\r\n                'mousedown',\r\n                'mouseup',\r\n                'mouseover',\r\n                'mousemove',\r\n                'mouseout',\r\n                'click'\r\n            ];\r\n            var tapEvent = monitor(settings);\r\n            var simpleEvents = map(pointerEvents.concat([\r\n                'selectstart',\r\n                'input',\r\n                'contextmenu',\r\n                'change',\r\n                'transitionend',\r\n                'drag',\r\n                'dragstart',\r\n                'dragend',\r\n                'dragenter',\r\n                'dragleave',\r\n                'dragover',\r\n                'drop',\r\n                'keyup'\r\n            ]), function (type) {\r\n                return bind$3(container, type, function (event) {\r\n                    tapEvent.fireIfReady(event, type).each(function (tapStopped) {\r\n                        if (tapStopped) {\r\n                            event.kill();\r\n                        }\r\n                    });\r\n                    var stopped = settings.triggerEvent(type, event);\r\n                    if (stopped) {\r\n                        event.kill();\r\n                    }\r\n                });\r\n            });\r\n            var pasteTimeout = Cell(Option.none());\r\n            var onPaste = bind$3(container, 'paste', function (event) {\r\n                tapEvent.fireIfReady(event, 'paste').each(function (tapStopped) {\r\n                    if (tapStopped) {\r\n                        event.kill();\r\n                    }\r\n                });\r\n                var stopped = settings.triggerEvent('paste', event);\r\n                if (stopped) {\r\n                    event.kill();\r\n                }\r\n                pasteTimeout.set(Option.some(domGlobals.setTimeout(function () {\r\n                    settings.triggerEvent(postPaste(), event);\r\n                }, 0)));\r\n            });\r\n            var onKeydown = bind$3(container, 'keydown', function (event) {\r\n                var stopped = settings.triggerEvent('keydown', event);\r\n                if (stopped) {\r\n                    event.kill();\r\n                }\r\n                else if (settings.stopBackspace === true && isDangerous(event)) {\r\n                    event.prevent();\r\n                }\r\n            });\r\n            var onFocusIn = bindFocus(container, function (event) {\r\n                var stopped = settings.triggerEvent('focusin', event);\r\n                if (stopped) {\r\n                    event.kill();\r\n                }\r\n            });\r\n            var focusoutTimeout = Cell(Option.none());\r\n            var onFocusOut = bindBlur(container, function (event) {\r\n                var stopped = settings.triggerEvent('focusout', event);\r\n                if (stopped) {\r\n                    event.kill();\r\n                }\r\n                focusoutTimeout.set(Option.some(domGlobals.setTimeout(function () {\r\n                    settings.triggerEvent(postBlur(), event);\r\n                }, 0)));\r\n            });\r\n            var unbind = function () {\r\n                each(simpleEvents, function (e) {\r\n                    e.unbind();\r\n                });\r\n                onKeydown.unbind();\r\n                onFocusIn.unbind();\r\n                onFocusOut.unbind();\r\n                onPaste.unbind();\r\n                pasteTimeout.get().each(domGlobals.clearTimeout);\r\n                focusoutTimeout.get().each(domGlobals.clearTimeout);\r\n            };\r\n            return { unbind: unbind };\r\n        };\r\n        var derive$2 = function (rawEvent, rawTarget) {\r\n            var source = readOptFrom$1(rawEvent, 'target').map(function (getTarget) {\r\n                return getTarget();\r\n            }).getOr(rawTarget);\r\n            return Cell(source);\r\n        };\r\n        var fromSource = function (event, source) {\r\n            var stopper = Cell(false);\r\n            var cutter = Cell(false);\r\n            var stop = function () {\r\n                stopper.set(true);\r\n            };\r\n            var cut = function () {\r\n                cutter.set(true);\r\n            };\r\n            return {\r\n                stop: stop,\r\n                cut: cut,\r\n                isStopped: stopper.get,\r\n                isCut: cutter.get,\r\n                event: constant(event),\r\n                setSource: source.set,\r\n                getSource: source.get\r\n            };\r\n        };\r\n        var fromExternal = function (event) {\r\n            var stopper = Cell(false);\r\n            var stop = function () {\r\n                stopper.set(true);\r\n            };\r\n            return {\r\n                stop: stop,\r\n                cut: noop,\r\n                isStopped: stopper.get,\r\n                isCut: constant(false),\r\n                event: constant(event),\r\n                setSource: die('Cannot set source of a broadcasted event'),\r\n                getSource: die('Cannot get source of a broadcasted event')\r\n            };\r\n        };\r\n        var adt$a = Adt.generate([\r\n            { stopped: [] },\r\n            { resume: ['element'] },\r\n            { complete: [] }\r\n        ]);\r\n        var doTriggerHandler = function (lookup, eventType, rawEvent, target, source, logger) {\r\n            var handler = lookup(eventType, target);\r\n            var simulatedEvent = fromSource(rawEvent, source);\r\n            return handler.fold(function () {\r\n                logger.logEventNoHandlers(eventType, target);\r\n                return adt$a.complete();\r\n            }, function (handlerInfo) {\r\n                var descHandler = handlerInfo.descHandler();\r\n                var eventHandler = getCurried(descHandler);\r\n                eventHandler(simulatedEvent);\r\n                if (simulatedEvent.isStopped()) {\r\n                    logger.logEventStopped(eventType, handlerInfo.element(), descHandler.purpose());\r\n                    return adt$a.stopped();\r\n                }\r\n                else if (simulatedEvent.isCut()) {\r\n                    logger.logEventCut(eventType, handlerInfo.element(), descHandler.purpose());\r\n                    return adt$a.complete();\r\n                }\r\n                else {\r\n                    return parent(handlerInfo.element()).fold(function () {\r\n                        logger.logNoParent(eventType, handlerInfo.element(), descHandler.purpose());\r\n                        return adt$a.complete();\r\n                    }, function (parent) {\r\n                        logger.logEventResponse(eventType, handlerInfo.element(), descHandler.purpose());\r\n                        return adt$a.resume(parent);\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        var doTriggerOnUntilStopped = function (lookup, eventType, rawEvent, rawTarget, source, logger) {\r\n            return doTriggerHandler(lookup, eventType, rawEvent, rawTarget, source, logger).fold(function () {\r\n                return true;\r\n            }, function (parent) {\r\n                return doTriggerOnUntilStopped(lookup, eventType, rawEvent, parent, source, logger);\r\n            }, function () {\r\n                return false;\r\n            });\r\n        };\r\n        var triggerHandler = function (lookup, eventType, rawEvent, target, logger) {\r\n            var source = derive$2(rawEvent, target);\r\n            return doTriggerHandler(lookup, eventType, rawEvent, target, source, logger);\r\n        };\r\n        var broadcast = function (listeners, rawEvent, logger) {\r\n            var simulatedEvent = fromExternal(rawEvent);\r\n            each(listeners, function (listener) {\r\n                var descHandler = listener.descHandler();\r\n                var handler = getCurried(descHandler);\r\n                handler(simulatedEvent);\r\n            });\r\n            return simulatedEvent.isStopped();\r\n        };\r\n        var triggerUntilStopped = function (lookup, eventType, rawEvent, logger) {\r\n            var rawTarget = rawEvent.target();\r\n            return triggerOnUntilStopped(lookup, eventType, rawEvent, rawTarget, logger);\r\n        };\r\n        var triggerOnUntilStopped = function (lookup, eventType, rawEvent, rawTarget, logger) {\r\n            var source = derive$2(rawEvent, rawTarget);\r\n            return doTriggerOnUntilStopped(lookup, eventType, rawEvent, rawTarget, source, logger);\r\n        };\r\n        var eventHandler = Immutable('element', 'descHandler');\r\n        var broadcastHandler = function (id, handler) {\r\n            return {\r\n                id: constant(id),\r\n                descHandler: constant(handler)\r\n            };\r\n        };\r\n        function EventRegistry() {\r\n            var registry = {};\r\n            var registerId = function (extraArgs, id, events) {\r\n                each$1(events, function (v, k) {\r\n                    var handlers = registry[k] !== undefined ? registry[k] : {};\r\n                    handlers[id] = curryArgs(v, extraArgs);\r\n                    registry[k] = handlers;\r\n                });\r\n            };\r\n            var findHandler = function (handlers, elem) {\r\n                return read$1(elem).fold(function () {\r\n                    return Option.none();\r\n                }, function (id) {\r\n                    var reader = readOpt$1(id);\r\n                    return handlers.bind(reader).map(function (descHandler) {\r\n                        return eventHandler(elem, descHandler);\r\n                    });\r\n                });\r\n            };\r\n            var filterByType = function (type) {\r\n                return readOptFrom$1(registry, type).map(function (handlers) {\r\n                    return mapToArray(handlers, function (f, id) {\r\n                        return broadcastHandler(id, f);\r\n                    });\r\n                }).getOr([]);\r\n            };\r\n            var find = function (isAboveRoot, type, target) {\r\n                var readType = readOpt$1(type);\r\n                var handlers = readType(registry);\r\n                return closest$1(target, function (elem) {\r\n                    return findHandler(handlers, elem);\r\n                }, isAboveRoot);\r\n            };\r\n            var unregisterId = function (id) {\r\n                each$1(registry, function (handlersById, eventName) {\r\n                    if (handlersById.hasOwnProperty(id)) {\r\n                        delete handlersById[id];\r\n                    }\r\n                });\r\n            };\r\n            return {\r\n                registerId: registerId,\r\n                unregisterId: unregisterId,\r\n                filterByType: filterByType,\r\n                find: find\r\n            };\r\n        }\r\n        function Registry() {\r\n            var events = EventRegistry();\r\n            var components = {};\r\n            var readOrTag = function (component) {\r\n                var elem = component.element();\r\n                return read$1(elem).fold(function () {\r\n                    return write('uid-', component.element());\r\n                }, function (uid) {\r\n                    return uid;\r\n                });\r\n            };\r\n            var failOnDuplicate = function (component, tagId) {\r\n                var conflict = components[tagId];\r\n                if (conflict === component) {\r\n                    unregister(component);\r\n                }\r\n                else {\r\n                    throw new Error('The tagId \"' + tagId + '\" is already used by: ' + element(conflict.element()) + '\\nCannot use it for: ' + element(component.element()) + '\\n' + 'The conflicting element is' + (inBody(conflict.element()) ? ' ' : ' not ') + 'already in the DOM');\r\n                }\r\n            };\r\n            var register = function (component) {\r\n                var tagId = readOrTag(component);\r\n                if (hasKey$1(components, tagId)) {\r\n                    failOnDuplicate(component, tagId);\r\n                }\r\n                var extraArgs = [component];\r\n                events.registerId(extraArgs, tagId, component.events());\r\n                components[tagId] = component;\r\n            };\r\n            var unregister = function (component) {\r\n                read$1(component.element()).each(function (tagId) {\r\n                    delete components[tagId];\r\n                    events.unregisterId(tagId);\r\n                });\r\n            };\r\n            var filter = function (type) {\r\n                return events.filterByType(type);\r\n            };\r\n            var find = function (isAboveRoot, type, target) {\r\n                return events.find(isAboveRoot, type, target);\r\n            };\r\n            var getById = function (id) {\r\n                return readOpt$1(id)(components);\r\n            };\r\n            return {\r\n                find: find,\r\n                filter: filter,\r\n                register: register,\r\n                unregister: unregister,\r\n                getById: getById\r\n            };\r\n        }\r\n        var factory$3 = function (detail) {\r\n            var _a = detail.dom, attributes = _a.attributes, domWithoutAttributes = __rest(_a, ['attributes']);\r\n            return {\r\n                uid: detail.uid,\r\n                dom: __assign({\r\n                    tag: 'div',\r\n                    attributes: __assign({ role: 'presentation' }, attributes)\r\n                }, domWithoutAttributes),\r\n                components: detail.components,\r\n                behaviours: get$b(detail.containerBehaviours),\r\n                events: detail.events,\r\n                domModification: detail.domModification,\r\n                eventOrder: detail.eventOrder\r\n            };\r\n        };\r\n        var Container = single$2({\r\n            name: 'Container',\r\n            factory: factory$3,\r\n            configFields: [\r\n                defaulted$1('components', []),\r\n                field$1('containerBehaviours', []),\r\n                defaulted$1('events', {}),\r\n                defaulted$1('domModification', {}),\r\n                defaulted$1('eventOrder', {})\r\n            ]\r\n        });\r\n        var takeover = function (root) {\r\n            var isAboveRoot = function (el) {\r\n                return parent(root.element()).fold(function () {\r\n                    return true;\r\n                }, function (parent) {\r\n                    return eq(el, parent);\r\n                });\r\n            };\r\n            var registry = Registry();\r\n            var lookup = function (eventName, target) {\r\n                return registry.find(isAboveRoot, eventName, target);\r\n            };\r\n            var domEvents = setup$1(root.element(), {\r\n                triggerEvent: function (eventName, event) {\r\n                    return monitorEvent(eventName, event.target(), function (logger) {\r\n                        return triggerUntilStopped(lookup, eventName, event, logger);\r\n                    });\r\n                }\r\n            });\r\n            var systemApi = {\r\n                debugInfo: constant('real'),\r\n                triggerEvent: function (eventName, target, data) {\r\n                    monitorEvent(eventName, target, function (logger) {\r\n                        triggerOnUntilStopped(lookup, eventName, data, target, logger);\r\n                    });\r\n                },\r\n                triggerFocus: function (target, originator) {\r\n                    read$1(target).fold(function () {\r\n                        focus$1(target);\r\n                    }, function (_alloyId) {\r\n                        monitorEvent(focus(), target, function (logger) {\r\n                            triggerHandler(lookup, focus(), {\r\n                                originator: constant(originator),\r\n                                kill: noop,\r\n                                prevent: noop,\r\n                                target: constant(target)\r\n                            }, target, logger);\r\n                        });\r\n                    });\r\n                },\r\n                triggerEscape: function (comp, simulatedEvent) {\r\n                    systemApi.triggerEvent('keydown', comp.element(), simulatedEvent.event());\r\n                },\r\n                getByUid: function (uid) {\r\n                    return getByUid(uid);\r\n                },\r\n                getByDom: function (elem) {\r\n                    return getByDom(elem);\r\n                },\r\n                build: build$1,\r\n                addToGui: function (c) {\r\n                    add(c);\r\n                },\r\n                removeFromGui: function (c) {\r\n                    remove$1(c);\r\n                },\r\n                addToWorld: function (c) {\r\n                    addToWorld(c);\r\n                },\r\n                removeFromWorld: function (c) {\r\n                    removeFromWorld(c);\r\n                },\r\n                broadcast: function (message) {\r\n                    broadcast$1(message);\r\n                },\r\n                broadcastOn: function (channels, message) {\r\n                    broadcastOn(channels, message);\r\n                },\r\n                broadcastEvent: function (eventName, event) {\r\n                    broadcastEvent(eventName, event);\r\n                },\r\n                isConnected: constant(true)\r\n            };\r\n            var addToWorld = function (component) {\r\n                component.connect(systemApi);\r\n                if (!isText(component.element())) {\r\n                    registry.register(component);\r\n                    each(component.components(), addToWorld);\r\n                    systemApi.triggerEvent(systemInit(), component.element(), { target: constant(component.element()) });\r\n                }\r\n            };\r\n            var removeFromWorld = function (component) {\r\n                if (!isText(component.element())) {\r\n                    each(component.components(), removeFromWorld);\r\n                    registry.unregister(component);\r\n                }\r\n                component.disconnect();\r\n            };\r\n            var add = function (component) {\r\n                attach(root, component);\r\n            };\r\n            var remove$1 = function (component) {\r\n                detach(component);\r\n            };\r\n            var destroy = function () {\r\n                domEvents.unbind();\r\n                remove(root.element());\r\n            };\r\n            var broadcastData = function (data) {\r\n                var receivers = registry.filter(receive());\r\n                each(receivers, function (receiver) {\r\n                    var descHandler = receiver.descHandler();\r\n                    var handler = getCurried(descHandler);\r\n                    handler(data);\r\n                });\r\n            };\r\n            var broadcast$1 = function (message) {\r\n                broadcastData({\r\n                    universal: constant(true),\r\n                    data: constant(message)\r\n                });\r\n            };\r\n            var broadcastOn = function (channels, message) {\r\n                broadcastData({\r\n                    universal: constant(false),\r\n                    channels: constant(channels),\r\n                    data: constant(message)\r\n                });\r\n            };\r\n            var broadcastEvent = function (eventName, event) {\r\n                var listeners = registry.filter(eventName);\r\n                return broadcast(listeners, event);\r\n            };\r\n            var getByUid = function (uid) {\r\n                return registry.getById(uid).fold(function () {\r\n                    return Result.error(new Error('Could not find component with uid: \"' + uid + '\" in system.'));\r\n                }, Result.value);\r\n            };\r\n            var getByDom = function (elem) {\r\n                var uid = read$1(elem).getOr('not found');\r\n                return getByUid(uid);\r\n            };\r\n            addToWorld(root);\r\n            return {\r\n                root: constant(root),\r\n                element: root.element,\r\n                destroy: destroy,\r\n                add: add,\r\n                remove: remove$1,\r\n                getByUid: getByUid,\r\n                getByDom: getByDom,\r\n                addToWorld: addToWorld,\r\n                removeFromWorld: removeFromWorld,\r\n                broadcast: broadcast$1,\r\n                broadcastOn: broadcastOn,\r\n                broadcastEvent: broadcastEvent\r\n            };\r\n        };\r\n        var global$6 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\r\n        var global$7 = tinymce.util.Tools.resolve('tinymce.EditorManager');\r\n        var getSkinUrl = function (editor) {\r\n            var settings = editor.settings;\r\n            var skin = settings.skin;\r\n            var skinUrl = settings.skin_url;\r\n            if (skin !== false) {\r\n                var skinName = skin ? skin : 'oxide';\r\n                if (skinUrl) {\r\n                    skinUrl = editor.documentBaseURI.toAbsolute(skinUrl);\r\n                }\r\n                else {\r\n                    skinUrl = global$7.baseURL + '/skins/ui/' + skinName;\r\n                }\r\n            }\r\n            return skinUrl;\r\n        };\r\n        var isReadOnly = function (editor) {\r\n            return editor.getParam('readonly', false, 'boolean');\r\n        };\r\n        var isSkinDisabled = function (editor) {\r\n            return editor.getParam('skin') === false;\r\n        };\r\n        var getHeightSetting = function (editor) {\r\n            return editor.getParam('height', Math.max(editor.getElement().offsetHeight, 200));\r\n        };\r\n        var getMinWidthSetting = function (editor) {\r\n            return Option.from(editor.settings.min_width).filter(isNumber);\r\n        };\r\n        var getMinHeightSetting = function (editor) {\r\n            return Option.from(editor.settings.min_height).filter(isNumber);\r\n        };\r\n        var getMaxWidthSetting = function (editor) {\r\n            return Option.from(editor.getParam('max_width')).filter(isNumber);\r\n        };\r\n        var getMaxHeightSetting = function (editor) {\r\n            return Option.from(editor.getParam('max_height')).filter(isNumber);\r\n        };\r\n        var getUserStyleFormats = function (editor) {\r\n            return Option.from(editor.getParam('style_formats')).filter(isArray);\r\n        };\r\n        var isMergeStyleFormats = function (editor) {\r\n            return editor.getParam('style_formats_merge', false, 'boolean');\r\n        };\r\n        var getRemovedMenuItems = function (editor) {\r\n            return editor.getParam('removed_menuitems', '');\r\n        };\r\n        var isMenubarEnabled = function (editor) {\r\n            return editor.getParam('menubar', true, 'boolean') !== false;\r\n        };\r\n        var isToolbarEnabled = function (editor) {\r\n            var toolbarConfig = editor.getParam('toolbar');\r\n            if (isArray(toolbarConfig)) {\r\n                return toolbarConfig.length > 0;\r\n            }\r\n            else {\r\n                return editor.getParam('toolbar', true, 'boolean') !== false;\r\n            }\r\n        };\r\n        var getMultipleToolbarsSetting = function (editor) {\r\n            var keys$1 = keys(editor.settings);\r\n            var toolbarKeys = filter(keys$1, function (key) {\r\n                return /^toolbar([1-9])$/.test(key);\r\n            });\r\n            var toolbars = map(toolbarKeys, function (key) {\r\n                return editor.getParam(key, false, 'string');\r\n            });\r\n            var toolbarArray = filter(toolbars, function (toolbar) {\r\n                return typeof toolbar === 'string';\r\n            });\r\n            return toolbarArray.length > 0 ? Option.some(toolbarArray) : Option.none();\r\n        };\r\n        var ToolbarDrawer;\r\n        (function (ToolbarDrawer) {\r\n            ToolbarDrawer['default'] = '';\r\n            ToolbarDrawer['floating'] = 'floating';\r\n            ToolbarDrawer['sliding'] = 'sliding';\r\n        }(ToolbarDrawer || (ToolbarDrawer = {})));\r\n        var getToolbarDrawer = function (editor) {\r\n            return editor.getParam('toolbar_drawer', '', 'string');\r\n        };\r\n        var fixedContainerSelector = function (editor) {\r\n            return editor.getParam('fixed_toolbar_container', '', 'string');\r\n        };\r\n        var fixedContainerElement = function (editor) {\r\n            var selector = fixedContainerSelector(editor);\r\n            var isInline = editor.getParam('inline', false, 'boolean');\r\n            return selector.length > 0 && isInline ? descendant$2(body(), selector) : Option.none();\r\n        };\r\n        var useFixedContainer = function (editor) {\r\n            return editor.getParam('inline', false, 'boolean') && fixedContainerElement(editor).isSome();\r\n        };\r\n        var getUiContainer = function (editor) {\r\n            var fixedContainer = fixedContainerElement(editor);\r\n            return fixedContainer.getOr(body());\r\n        };\r\n        var formChangeEvent = generate$1('form-component-change');\r\n        var formCloseEvent = generate$1('form-close');\r\n        var formCancelEvent = generate$1('form-cancel');\r\n        var formActionEvent = generate$1('form-action');\r\n        var formSubmitEvent = generate$1('form-submit');\r\n        var formBlockEvent = generate$1('form-block');\r\n        var formUnblockEvent = generate$1('form-unblock');\r\n        var formTabChangeEvent = generate$1('form-tabchange');\r\n        var formResizeEvent = generate$1('form-resize');\r\n        var renderAlertBanner = function (spec, providersBackstage) {\r\n            return Container.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { role: 'alert' },\r\n                    classes: [\r\n                        'tox-notification',\r\n                        'tox-notification--in',\r\n                        'tox-notification--' + spec.level\r\n                    ]\r\n                },\r\n                components: [\r\n                    {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-notification__icon']\r\n                        },\r\n                        components: [Button.sketch({\r\n                                dom: {\r\n                                    tag: 'button',\r\n                                    classes: [\r\n                                        'tox-button',\r\n                                        'tox-button--naked',\r\n                                        'tox-button--icon'\r\n                                    ],\r\n                                    innerHtml: get$c(spec.icon, providersBackstage.icons),\r\n                                    attributes: { title: providersBackstage.translate(spec.actionLabel) }\r\n                                },\r\n                                action: function (comp) {\r\n                                    emitWith(comp, formActionEvent, {\r\n                                        name: 'alert-banner',\r\n                                        value: spec.url\r\n                                    });\r\n                                }\r\n                            })]\r\n                    },\r\n                    {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-notification__body'],\r\n                            innerHtml: providersBackstage.translate(spec.text)\r\n                        }\r\n                    }\r\n                ]\r\n            });\r\n        };\r\n        var schema$d = constant([\r\n            defaulted$1('prefix', 'form-field'),\r\n            field$1('fieldBehaviours', [\r\n                Composing,\r\n                Representing\r\n            ])\r\n        ]);\r\n        var parts$3 = constant([\r\n            optional({\r\n                schema: [strict$1('dom')],\r\n                name: 'label'\r\n            }),\r\n            optional({\r\n                factory: {\r\n                    sketch: function (spec) {\r\n                        return {\r\n                            uid: spec.uid,\r\n                            dom: {\r\n                                tag: 'span',\r\n                                styles: { display: 'none' },\r\n                                attributes: { 'aria-hidden': 'true' },\r\n                                innerHtml: spec.text\r\n                            }\r\n                        };\r\n                    }\r\n                },\r\n                schema: [strict$1('text')],\r\n                name: 'aria-descriptor'\r\n            }),\r\n            required({\r\n                factory: {\r\n                    sketch: function (spec) {\r\n                        var excludeFactory = exclude$1(spec, ['factory']);\r\n                        return spec.factory.sketch(excludeFactory);\r\n                    }\r\n                },\r\n                schema: [strict$1('factory')],\r\n                name: 'field'\r\n            })\r\n        ]);\r\n        var factory$4 = function (detail, components, spec, externals) {\r\n            var behaviours = augment(detail.fieldBehaviours, [\r\n                Composing.config({\r\n                    find: function (container) {\r\n                        return getPart(container, detail, 'field');\r\n                    }\r\n                }),\r\n                Representing.config({\r\n                    store: {\r\n                        mode: 'manual',\r\n                        getValue: function (field) {\r\n                            return Composing.getCurrent(field).bind(Representing.getValue);\r\n                        },\r\n                        setValue: function (field, value) {\r\n                            Composing.getCurrent(field).each(function (current) {\r\n                                Representing.setValue(current, value);\r\n                            });\r\n                        }\r\n                    }\r\n                })\r\n            ]);\r\n            var events = derive([runOnAttached(function (component, simulatedEvent) {\r\n                    var ps = getParts(component, detail, [\r\n                        'label',\r\n                        'field',\r\n                        'aria-descriptor'\r\n                    ]);\r\n                    ps.field().each(function (field) {\r\n                        var id = generate$1(detail.prefix);\r\n                        ps.label().each(function (label) {\r\n                            set$1(label.element(), 'for', id);\r\n                            set$1(field.element(), 'id', id);\r\n                        });\r\n                        ps['aria-descriptor']().each(function (descriptor) {\r\n                            var descriptorId = generate$1(detail.prefix);\r\n                            set$1(descriptor.element(), 'id', descriptorId);\r\n                            set$1(field.element(), 'aria-describedby', descriptorId);\r\n                        });\r\n                    });\r\n                })]);\r\n            var apis = {\r\n                getField: function (container) {\r\n                    return getPart(container, detail, 'field');\r\n                },\r\n                getLabel: function (container) {\r\n                    return getPart(container, detail, 'label');\r\n                }\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                behaviours: behaviours,\r\n                events: events,\r\n                apis: apis\r\n            };\r\n        };\r\n        var FormField = composite$1({\r\n            name: 'FormField',\r\n            configFields: schema$d(),\r\n            partFields: parts$3(),\r\n            factory: factory$4,\r\n            apis: {\r\n                getField: function (apis, comp) {\r\n                    return apis.getField(comp);\r\n                },\r\n                getLabel: function (apis, comp) {\r\n                    return apis.getLabel(comp);\r\n                }\r\n            }\r\n        });\r\n        var getCoupled = function (component, coupleConfig, coupleState, name) {\r\n            return coupleState.getOrCreate(component, coupleConfig, name);\r\n        };\r\n        var CouplingApis = Object.freeze({\r\n            getCoupled: getCoupled\r\n        });\r\n        var CouplingSchema = [strictOf('others', setOf$1(Result.value, anyValue$1()))];\r\n        var init$5 = function (spec) {\r\n            var coupled = {};\r\n            var getOrCreate = function (component, coupleConfig, name) {\r\n                var available = keys(coupleConfig.others);\r\n                if (!available) {\r\n                    throw new Error('Cannot find coupled component: ' + name + '. Known coupled components: ' + Json.stringify(available, null, 2));\r\n                }\r\n                else {\r\n                    return readOptFrom$1(coupled, name).getOrThunk(function () {\r\n                        var builder = readOptFrom$1(coupleConfig.others, name).getOrDie('No information found for coupled component: ' + name);\r\n                        var spec = builder(component);\r\n                        var built = component.getSystem().build(spec);\r\n                        coupled[name] = built;\r\n                        return built;\r\n                    });\r\n                }\r\n            };\r\n            var readState = constant({});\r\n            return nu$5({\r\n                readState: readState,\r\n                getOrCreate: getOrCreate\r\n            });\r\n        };\r\n        var CouplingState = Object.freeze({\r\n            init: init$5\r\n        });\r\n        var Coupling = create$1({\r\n            fields: CouplingSchema,\r\n            name: 'coupling',\r\n            apis: CouplingApis,\r\n            state: CouplingState\r\n        });\r\n        var events$a = function (streamConfig, streamState) {\r\n            var streams = streamConfig.stream.streams;\r\n            var processor = streams.setup(streamConfig, streamState);\r\n            return derive([\r\n                run(streamConfig.event, processor),\r\n                runOnDetached(function () {\r\n                    return streamState.cancel();\r\n                })\r\n            ].concat(streamConfig.cancelEvent.map(function (e) {\r\n                return [run(e, function () {\r\n                        return streamState.cancel();\r\n                    })];\r\n            }).getOr([])));\r\n        };\r\n        var ActiveStreaming = Object.freeze({\r\n            events: events$a\r\n        });\r\n        var throttle = function (_config) {\r\n            var state = Cell(null);\r\n            var readState = function () {\r\n                return { timer: state.get() !== null ? 'set' : 'unset' };\r\n            };\r\n            var setTimer = function (t) {\r\n                state.set(t);\r\n            };\r\n            var cancel = function () {\r\n                var t = state.get();\r\n                if (t !== null) {\r\n                    t.cancel();\r\n                }\r\n            };\r\n            return nu$5({\r\n                readState: readState,\r\n                setTimer: setTimer,\r\n                cancel: cancel\r\n            });\r\n        };\r\n        var init$6 = function (spec) {\r\n            return spec.stream.streams.state(spec);\r\n        };\r\n        var StreamingState = Object.freeze({\r\n            throttle: throttle,\r\n            init: init$6\r\n        });\r\n        var setup$2 = function (streamInfo, streamState) {\r\n            var sInfo = streamInfo.stream;\r\n            var throttler = last$2(streamInfo.onStream, sInfo.delay);\r\n            streamState.setTimer(throttler);\r\n            return function (component, simulatedEvent) {\r\n                throttler.throttle(component, simulatedEvent);\r\n                if (sInfo.stopEvent) {\r\n                    simulatedEvent.stop();\r\n                }\r\n            };\r\n        };\r\n        var StreamingSchema = [\r\n            strictOf('stream', choose$1('mode', {\r\n                throttle: [\r\n                    strict$1('delay'),\r\n                    defaulted$1('stopEvent', true),\r\n                    output('streams', {\r\n                        setup: setup$2,\r\n                        state: throttle\r\n                    })\r\n                ]\r\n            })),\r\n            defaulted$1('event', 'input'),\r\n            option('cancelEvent'),\r\n            onStrictHandler('onStream')\r\n        ];\r\n        var Streaming = create$1({\r\n            fields: StreamingSchema,\r\n            name: 'streaming',\r\n            active: ActiveStreaming,\r\n            state: StreamingState\r\n        });\r\n        var nu$a = function (baseFn) {\r\n            var data = Option.none();\r\n            var callbacks = [];\r\n            var map = function (f) {\r\n                return nu$a(function (nCallback) {\r\n                    get(function (data) {\r\n                        nCallback(f(data));\r\n                    });\r\n                });\r\n            };\r\n            var get = function (nCallback) {\r\n                if (isReady())\r\n                    call(nCallback);\r\n                else\r\n                    callbacks.push(nCallback);\r\n            };\r\n            var set = function (x) {\r\n                data = Option.some(x);\r\n                run(callbacks);\r\n                callbacks = [];\r\n            };\r\n            var isReady = function () {\r\n                return data.isSome();\r\n            };\r\n            var run = function (cbs) {\r\n                each(cbs, call);\r\n            };\r\n            var call = function (cb) {\r\n                data.each(function (x) {\r\n                    domGlobals.setTimeout(function () {\r\n                        cb(x);\r\n                    }, 0);\r\n                });\r\n            };\r\n            baseFn(set);\r\n            return {\r\n                get: get,\r\n                map: map,\r\n                isReady: isReady\r\n            };\r\n        };\r\n        var pure$1 = function (a) {\r\n            return nu$a(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var LazyValue = {\r\n            nu: nu$a,\r\n            pure: pure$1\r\n        };\r\n        var bounce = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var me = this;\r\n                domGlobals.setTimeout(function () {\r\n                    f.apply(me, args);\r\n                }, 0);\r\n            };\r\n        };\r\n        var nu$b = function (baseFn) {\r\n            var get = function (callback) {\r\n                baseFn(bounce(callback));\r\n            };\r\n            var map = function (fab) {\r\n                return nu$b(function (callback) {\r\n                    get(function (a) {\r\n                        var value = fab(a);\r\n                        callback(value);\r\n                    });\r\n                });\r\n            };\r\n            var bind = function (aFutureB) {\r\n                return nu$b(function (callback) {\r\n                    get(function (a) {\r\n                        aFutureB(a).get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var anonBind = function (futureB) {\r\n                return nu$b(function (callback) {\r\n                    get(function (a) {\r\n                        futureB.get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var toLazy = function () {\r\n                return LazyValue.nu(get);\r\n            };\r\n            var toCached = function () {\r\n                var cache = null;\r\n                return nu$b(function (callback) {\r\n                    if (cache === null) {\r\n                        cache = toLazy();\r\n                    }\r\n                    cache.get(callback);\r\n                });\r\n            };\r\n            return {\r\n                map: map,\r\n                bind: bind,\r\n                anonBind: anonBind,\r\n                toLazy: toLazy,\r\n                toCached: toCached,\r\n                get: get\r\n            };\r\n        };\r\n        var pure$2 = function (a) {\r\n            return nu$b(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var Future = {\r\n            nu: nu$b,\r\n            pure: pure$2\r\n        };\r\n        var suffix = constant('sink');\r\n        var partType = constant(optional({\r\n            name: suffix(),\r\n            overrides: constant({\r\n                dom: { tag: 'div' },\r\n                behaviours: derive$1([Positioning.config({ useFixed: true })]),\r\n                events: derive([\r\n                    cutter(keydown()),\r\n                    cutter(mousedown()),\r\n                    cutter(click())\r\n                ])\r\n            })\r\n        }));\r\n        var HighlightOnOpen;\r\n        (function (HighlightOnOpen) {\r\n            HighlightOnOpen[HighlightOnOpen['HighlightFirst'] = 0] = 'HighlightFirst';\r\n            HighlightOnOpen[HighlightOnOpen['HighlightNone'] = 1] = 'HighlightNone';\r\n        }(HighlightOnOpen || (HighlightOnOpen = {})));\r\n        var getAnchor = function (detail, component) {\r\n            var hotspot = detail.getHotspot(component).getOr(component);\r\n            var anchor = 'hotspot';\r\n            var overrides = detail.getAnchorOverrides();\r\n            return detail.layouts.fold(function () {\r\n                return {\r\n                    anchor: anchor,\r\n                    hotspot: hotspot,\r\n                    overrides: overrides\r\n                };\r\n            }, function (layouts) {\r\n                return {\r\n                    anchor: anchor,\r\n                    hotspot: hotspot,\r\n                    overrides: overrides,\r\n                    layouts: layouts\r\n                };\r\n            });\r\n        };\r\n        var fetch = function (detail, mapFetch, component) {\r\n            var fetcher = detail.fetch;\r\n            return fetcher(component).map(mapFetch);\r\n        };\r\n        var openF = function (detail, mapFetch, anchor, component, sandbox, externals, highlightOnOpen) {\r\n            var futureData = fetch(detail, mapFetch, component);\r\n            var getLazySink = getSink(component, detail);\r\n            return futureData.map(function (tdata) {\r\n                return tdata.bind(function (data) {\r\n                    return Option.from(tieredMenu.sketch(__assign({}, externals.menu(), {\r\n                        uid: generate$2(''),\r\n                        data: data,\r\n                        highlightImmediately: highlightOnOpen === HighlightOnOpen.HighlightFirst,\r\n                        onOpenMenu: function (tmenu, menu) {\r\n                            var sink = getLazySink().getOrDie();\r\n                            Positioning.position(sink, anchor, menu);\r\n                            Sandboxing.decloak(sandbox);\r\n                        },\r\n                        onOpenSubmenu: function (tmenu, item, submenu) {\r\n                            var sink = getLazySink().getOrDie();\r\n                            Positioning.position(sink, {\r\n                                anchor: 'submenu',\r\n                                item: item\r\n                            }, submenu);\r\n                            Sandboxing.decloak(sandbox);\r\n                        },\r\n                        onEscape: function () {\r\n                            Focusing.focus(component);\r\n                            Sandboxing.close(sandbox);\r\n                            return Option.some(true);\r\n                        }\r\n                    })));\r\n                });\r\n            });\r\n        };\r\n        var open$1 = function (detail, mapFetch, hotspot, sandbox, externals, onOpenSync, highlightOnOpen) {\r\n            var anchor = getAnchor(detail, hotspot);\r\n            var processed = openF(detail, mapFetch, anchor, hotspot, sandbox, externals, highlightOnOpen);\r\n            return processed.map(function (tdata) {\r\n                tdata.fold(function () {\r\n                    if (Sandboxing.isOpen(sandbox)) {\r\n                        Sandboxing.close(sandbox);\r\n                    }\r\n                }, function (data) {\r\n                    Sandboxing.cloak(sandbox);\r\n                    Sandboxing.open(sandbox, data);\r\n                    onOpenSync(sandbox);\r\n                });\r\n                return sandbox;\r\n            });\r\n        };\r\n        var close$1 = function (detail, mapFetch, component, sandbox, _externals, _onOpenSync, _highlightOnOpen) {\r\n            Sandboxing.close(sandbox);\r\n            return Future.pure(sandbox);\r\n        };\r\n        var togglePopup = function (detail, mapFetch, hotspot, externals, onOpenSync, highlightOnOpen) {\r\n            var sandbox = Coupling.getCoupled(hotspot, 'sandbox');\r\n            var showing = Sandboxing.isOpen(sandbox);\r\n            var action = showing ? close$1 : open$1;\r\n            return action(detail, mapFetch, hotspot, sandbox, externals, onOpenSync, highlightOnOpen);\r\n        };\r\n        var matchWidth = function (hotspot, container, useMinWidth) {\r\n            var menu = Composing.getCurrent(container).getOr(container);\r\n            var buttonWidth = get$7(hotspot.element());\r\n            if (useMinWidth) {\r\n                set$2(menu.element(), 'min-width', buttonWidth + 'px');\r\n            }\r\n            else {\r\n                set$4(menu.element(), buttonWidth);\r\n            }\r\n        };\r\n        var getSink = function (anyInSystem, sinkDetail) {\r\n            return anyInSystem.getSystem().getByUid(sinkDetail.uid + '-' + suffix()).map(function (internalSink) {\r\n                return function () {\r\n                    return Result.value(internalSink);\r\n                };\r\n            }).getOrThunk(function () {\r\n                return sinkDetail.lazySink.fold(function () {\r\n                    return function () {\r\n                        return Result.error(new Error('No internal sink is specified, nor could an external sink be found'));\r\n                    };\r\n                }, function (lazySinkFn) {\r\n                    return function () {\r\n                        return lazySinkFn(anyInSystem);\r\n                    };\r\n                });\r\n            });\r\n        };\r\n        var makeSandbox = function (detail, hotspot, extras) {\r\n            var ariaOwner = manager();\r\n            var onOpen = function (component, menu) {\r\n                var anchor = getAnchor(detail, hotspot);\r\n                ariaOwner.link(hotspot.element());\r\n                if (detail.matchWidth) {\r\n                    matchWidth(anchor.hotspot, menu, detail.useMinWidth);\r\n                }\r\n                detail.onOpen(anchor, component, menu);\r\n                if (extras !== undefined && extras.onOpen !== undefined) {\r\n                    extras.onOpen(component, menu);\r\n                }\r\n            };\r\n            var onClose = function (component, menu) {\r\n                ariaOwner.unlink(hotspot.element());\r\n                if (extras !== undefined && extras.onClose !== undefined) {\r\n                    extras.onClose(component, menu);\r\n                }\r\n            };\r\n            var lazySink = getSink(hotspot, detail);\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: detail.sandboxClasses,\r\n                    attributes: {\r\n                        id: ariaOwner.id(),\r\n                        role: 'listbox'\r\n                    }\r\n                },\r\n                behaviours: SketchBehaviours.augment(detail.sandboxBehaviours, [\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: hotspot\r\n                        }\r\n                    }),\r\n                    Sandboxing.config({\r\n                        onOpen: onOpen,\r\n                        onClose: onClose,\r\n                        isPartOf: function (container, data, queryElem) {\r\n                            return isPartOf(data, queryElem) || isPartOf(hotspot, queryElem);\r\n                        },\r\n                        getAttachPoint: function () {\r\n                            return lazySink().getOrDie();\r\n                        }\r\n                    }),\r\n                    Composing.config({\r\n                        find: function (sandbox) {\r\n                            return Sandboxing.getState(sandbox).bind(function (menu) {\r\n                                return Composing.getCurrent(menu);\r\n                            });\r\n                        }\r\n                    }),\r\n                    receivingConfig({ isExtraPart: constant(false) })\r\n                ])\r\n            };\r\n        };\r\n        var setValueFromItem = function (model, input, item) {\r\n            var itemData = Representing.getValue(item);\r\n            Representing.setValue(input, itemData);\r\n            setCursorAtEnd(input);\r\n        };\r\n        var setSelectionOn = function (input, f) {\r\n            var el = input.element();\r\n            var value = get$5(el);\r\n            var node = el.dom();\r\n            if (get$2(el, 'type') !== 'number') {\r\n                f(node, value);\r\n            }\r\n        };\r\n        var setCursorAtEnd = function (input) {\r\n            setSelectionOn(input, function (node, value) {\r\n                return node.setSelectionRange(value.length, value.length);\r\n            });\r\n        };\r\n        var setSelectionToEnd = function (input, startOffset) {\r\n            setSelectionOn(input, function (node, value) {\r\n                return node.setSelectionRange(startOffset, value.length);\r\n            });\r\n        };\r\n        var attemptSelectOver = function (model, input, item) {\r\n            if (!model.selectsOver) {\r\n                return Option.none();\r\n            }\r\n            else {\r\n                var currentValue = Representing.getValue(input);\r\n                var inputDisplay_1 = model.getDisplayText(currentValue);\r\n                var itemValue = Representing.getValue(item);\r\n                var itemDisplay = model.getDisplayText(itemValue);\r\n                return itemDisplay.indexOf(inputDisplay_1) === 0 ? Option.some(function () {\r\n                    setValueFromItem(model, input, item);\r\n                    setSelectionToEnd(input, inputDisplay_1.length);\r\n                }) : Option.none();\r\n            }\r\n        };\r\n        var schema$e = constant([\r\n            option('data'),\r\n            defaulted$1('inputAttributes', {}),\r\n            defaulted$1('inputStyles', {}),\r\n            defaulted$1('tag', 'input'),\r\n            defaulted$1('inputClasses', []),\r\n            onHandler('onSetValue'),\r\n            defaulted$1('styles', {}),\r\n            defaulted$1('eventOrder', {}),\r\n            field$1('inputBehaviours', [\r\n                Representing,\r\n                Focusing\r\n            ]),\r\n            defaulted$1('selectOnFocus', true)\r\n        ]);\r\n        var focusBehaviours = function (detail) {\r\n            return derive$1([Focusing.config({\r\n                    onFocus: detail.selectOnFocus === false ? noop : function (component) {\r\n                        var input = component.element();\r\n                        var value = get$5(input);\r\n                        input.dom().setSelectionRange(0, value.length);\r\n                    }\r\n                })]);\r\n        };\r\n        var behaviours = function (detail) {\r\n            return __assign({}, focusBehaviours(detail), augment(detail.inputBehaviours, [Representing.config({\r\n                    store: {\r\n                        mode: 'manual',\r\n                        initialValue: detail.data.getOr(undefined),\r\n                        getValue: function (input) {\r\n                            return get$5(input.element());\r\n                        },\r\n                        setValue: function (input, data) {\r\n                            var current = get$5(input.element());\r\n                            if (current !== data) {\r\n                                set$3(input.element(), data);\r\n                            }\r\n                        }\r\n                    },\r\n                    onSetValue: detail.onSetValue\r\n                })]));\r\n        };\r\n        var dom$2 = function (detail) {\r\n            return {\r\n                tag: detail.tag,\r\n                attributes: __assign({ type: 'text' }, detail.inputAttributes),\r\n                styles: detail.inputStyles,\r\n                classes: detail.inputClasses\r\n            };\r\n        };\r\n        var itemExecute = constant('alloy.typeahead.itemexecute');\r\n        var make$3 = function (detail, components, spec, externals) {\r\n            var navigateList = function (comp, simulatedEvent, highlighter) {\r\n                detail.previewing.set(false);\r\n                var sandbox = Coupling.getCoupled(comp, 'sandbox');\r\n                if (Sandboxing.isOpen(sandbox)) {\r\n                    Composing.getCurrent(sandbox).each(function (menu) {\r\n                        Highlighting.getHighlighted(menu).fold(function () {\r\n                            highlighter(menu);\r\n                        }, function () {\r\n                            dispatchEvent(sandbox, menu.element(), 'keydown', simulatedEvent);\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    var onOpenSync = function (sandbox) {\r\n                        Composing.getCurrent(sandbox).each(highlighter);\r\n                    };\r\n                    open$1(detail, mapFetch(comp), comp, sandbox, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);\r\n                }\r\n            };\r\n            var focusBehaviours$1 = focusBehaviours(detail);\r\n            var mapFetch = function (comp) {\r\n                return function (tdata) {\r\n                    return tdata.map(function (data) {\r\n                        var menus = values(data.menus);\r\n                        var items = bind(menus, function (menu) {\r\n                            return filter(menu.items, function (item) {\r\n                                return item.type === 'item';\r\n                            });\r\n                        });\r\n                        var repState = Representing.getState(comp);\r\n                        repState.update(map(items, function (item) {\r\n                            return item.data;\r\n                        }));\r\n                        return data;\r\n                    });\r\n                };\r\n            };\r\n            var behaviours = [\r\n                Focusing.config({}),\r\n                Representing.config({\r\n                    onSetValue: detail.onSetValue,\r\n                    store: __assign({\r\n                        mode: 'dataset',\r\n                        getDataKey: function (comp) {\r\n                            return get$5(comp.element());\r\n                        },\r\n                        getFallbackEntry: function (itemString) {\r\n                            return {\r\n                                value: itemString,\r\n                                meta: {}\r\n                            };\r\n                        },\r\n                        setValue: function (comp, data) {\r\n                            set$3(comp.element(), detail.model.getDisplayText(data));\r\n                        }\r\n                    }, detail.initialData.map(function (d) {\r\n                        return wrap$1('initialValue', d);\r\n                    }).getOr({}))\r\n                }),\r\n                Streaming.config({\r\n                    stream: {\r\n                        mode: 'throttle',\r\n                        delay: detail.responseTime,\r\n                        stopEvent: false\r\n                    },\r\n                    onStream: function (component, simulatedEvent) {\r\n                        var sandbox = Coupling.getCoupled(component, 'sandbox');\r\n                        var focusInInput = Focusing.isFocused(component);\r\n                        if (focusInInput) {\r\n                            if (get$5(component.element()).length >= detail.minChars) {\r\n                                var previousValue_1 = Composing.getCurrent(sandbox).bind(function (menu) {\r\n                                    return Highlighting.getHighlighted(menu).map(Representing.getValue);\r\n                                });\r\n                                detail.previewing.set(true);\r\n                                var onOpenSync = function (_sandbox) {\r\n                                    Composing.getCurrent(sandbox).each(function (menu) {\r\n                                        previousValue_1.fold(function () {\r\n                                            if (detail.model.selectsOver) {\r\n                                                Highlighting.highlightFirst(menu);\r\n                                            }\r\n                                        }, function (pv) {\r\n                                            Highlighting.highlightBy(menu, function (item) {\r\n                                                var itemData = Representing.getValue(item);\r\n                                                return itemData.value === pv.value;\r\n                                            });\r\n                                            Highlighting.getHighlighted(menu).orThunk(function () {\r\n                                                Highlighting.highlightFirst(menu);\r\n                                                return Option.none();\r\n                                            });\r\n                                        });\r\n                                    });\r\n                                };\r\n                                open$1(detail, mapFetch(component), component, sandbox, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);\r\n                            }\r\n                        }\r\n                    },\r\n                    cancelEvent: typeaheadCancel()\r\n                }),\r\n                Keying.config({\r\n                    mode: 'special',\r\n                    onDown: function (comp, simulatedEvent) {\r\n                        navigateList(comp, simulatedEvent, Highlighting.highlightFirst);\r\n                        return Option.some(true);\r\n                    },\r\n                    onEscape: function (comp) {\r\n                        var sandbox = Coupling.getCoupled(comp, 'sandbox');\r\n                        if (Sandboxing.isOpen(sandbox)) {\r\n                            Sandboxing.close(sandbox);\r\n                            return Option.some(true);\r\n                        }\r\n                        return Option.none();\r\n                    },\r\n                    onUp: function (comp, simulatedEvent) {\r\n                        navigateList(comp, simulatedEvent, Highlighting.highlightLast);\r\n                        return Option.some(true);\r\n                    },\r\n                    onEnter: function (comp) {\r\n                        var sandbox = Coupling.getCoupled(comp, 'sandbox');\r\n                        var sandboxIsOpen = Sandboxing.isOpen(sandbox);\r\n                        if (sandboxIsOpen && !detail.previewing.get()) {\r\n                            return Composing.getCurrent(sandbox).bind(function (menu) {\r\n                                return Highlighting.getHighlighted(menu);\r\n                            }).map(function (item) {\r\n                                emitWith(comp, itemExecute(), { item: item });\r\n                                return true;\r\n                            });\r\n                        }\r\n                        else {\r\n                            var currentValue = Representing.getValue(comp);\r\n                            emit(comp, typeaheadCancel());\r\n                            detail.onExecute(sandbox, comp, currentValue);\r\n                            if (sandboxIsOpen) {\r\n                                Sandboxing.close(sandbox);\r\n                            }\r\n                            return Option.some(true);\r\n                        }\r\n                    }\r\n                }),\r\n                Toggling.config({\r\n                    toggleClass: detail.markers.openClass,\r\n                    aria: { mode: 'expanded' }\r\n                }),\r\n                Coupling.config({\r\n                    others: {\r\n                        sandbox: function (hotspot) {\r\n                            return makeSandbox(detail, hotspot, {\r\n                                onOpen: function () {\r\n                                    return Toggling.on(hotspot);\r\n                                },\r\n                                onClose: function () {\r\n                                    return Toggling.off(hotspot);\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                }),\r\n                config('typeaheadevents', [\r\n                    runOnExecute(function (comp) {\r\n                        var onOpenSync = noop;\r\n                        togglePopup(detail, mapFetch(comp), comp, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);\r\n                    }),\r\n                    run(itemExecute(), function (comp, se) {\r\n                        var sandbox = Coupling.getCoupled(comp, 'sandbox');\r\n                        setValueFromItem(detail.model, comp, se.event().item());\r\n                        emit(comp, typeaheadCancel());\r\n                        detail.onItemExecute(comp, sandbox, se.event().item(), Representing.getValue(comp));\r\n                        Sandboxing.close(sandbox);\r\n                        setCursorAtEnd(comp);\r\n                    })\r\n                ].concat(detail.dismissOnBlur ? [run(postBlur(), function (typeahead) {\r\n                        var sandbox = Coupling.getCoupled(typeahead, 'sandbox');\r\n                        if (search$1(sandbox.element()).isNone()) {\r\n                            Sandboxing.close(sandbox);\r\n                        }\r\n                    })] : []))\r\n            ];\r\n            return {\r\n                uid: detail.uid,\r\n                dom: dom$2(deepMerge(detail, {\r\n                    inputAttributes: {\r\n                        'role': 'combobox',\r\n                        'aria-autocomplete': 'list',\r\n                        'aria-haspopup': 'true'\r\n                    }\r\n                })),\r\n                behaviours: __assign({}, focusBehaviours$1, augment(detail.typeaheadBehaviours, behaviours)),\r\n                eventOrder: detail.eventOrder\r\n            };\r\n        };\r\n        var sandboxFields = function () {\r\n            return [\r\n                defaulted$1('sandboxClasses', []),\r\n                SketchBehaviours.field('sandboxBehaviours', [\r\n                    Composing,\r\n                    Receiving,\r\n                    Sandboxing,\r\n                    Representing\r\n                ])\r\n            ];\r\n        };\r\n        var schema$f = constant([\r\n            option('lazySink'),\r\n            strict$1('fetch'),\r\n            defaulted$1('minChars', 5),\r\n            defaulted$1('responseTime', 1000),\r\n            onHandler('onOpen'),\r\n            defaulted$1('getHotspot', Option.some),\r\n            defaulted$1('getAnchorOverrides', constant({})),\r\n            defaulted$1('layouts', Option.none()),\r\n            defaulted$1('eventOrder', {}),\r\n            defaultedObjOf('model', {}, [\r\n                defaulted$1('getDisplayText', function (itemData) {\r\n                    return itemData.meta !== undefined && itemData.meta.text !== undefined ? itemData.meta.text : itemData.value;\r\n                }),\r\n                defaulted$1('selectsOver', true),\r\n                defaulted$1('populateFromBrowse', true)\r\n            ]),\r\n            onHandler('onSetValue'),\r\n            onKeyboardHandler('onExecute'),\r\n            onHandler('onItemExecute'),\r\n            defaulted$1('inputClasses', []),\r\n            defaulted$1('inputAttributes', {}),\r\n            defaulted$1('inputStyles', {}),\r\n            defaulted$1('matchWidth', true),\r\n            defaulted$1('useMinWidth', false),\r\n            defaulted$1('dismissOnBlur', true),\r\n            markers(['openClass']),\r\n            option('initialData'),\r\n            field$1('typeaheadBehaviours', [\r\n                Focusing,\r\n                Representing,\r\n                Streaming,\r\n                Keying,\r\n                Toggling,\r\n                Coupling\r\n            ]),\r\n            state$1('previewing', function () {\r\n                return Cell(true);\r\n            })\r\n        ].concat(schema$e()).concat(sandboxFields()));\r\n        var parts$4 = constant([external$1({\r\n                schema: [tieredMenuMarkers()],\r\n                name: 'menu',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        fakeFocus: true,\r\n                        onHighlight: function (menu, item) {\r\n                            if (!detail.previewing.get()) {\r\n                                menu.getSystem().getByUid(detail.uid).each(function (input) {\r\n                                    if (detail.model.populateFromBrowse) {\r\n                                        setValueFromItem(detail.model, input, item);\r\n                                    }\r\n                                });\r\n                            }\r\n                            else {\r\n                                menu.getSystem().getByUid(detail.uid).each(function (input) {\r\n                                    attemptSelectOver(detail.model, input, item).fold(function () {\r\n                                        return Highlighting.dehighlight(menu, item);\r\n                                    }, function (fn) {\r\n                                        return fn();\r\n                                    });\r\n                                });\r\n                            }\r\n                            detail.previewing.set(false);\r\n                        },\r\n                        onExecute: function (menu, item) {\r\n                            return menu.getSystem().getByUid(detail.uid).toOption().map(function (typeahead) {\r\n                                emitWith(typeahead, itemExecute(), { item: item });\r\n                                return true;\r\n                            });\r\n                        },\r\n                        onHover: function (menu, item) {\r\n                            detail.previewing.set(false);\r\n                            menu.getSystem().getByUid(detail.uid).each(function (input) {\r\n                                if (detail.model.populateFromBrowse) {\r\n                                    setValueFromItem(detail.model, input, item);\r\n                                }\r\n                            });\r\n                        }\r\n                    };\r\n                }\r\n            })]);\r\n        var Typeahead = composite$1({\r\n            name: 'Typeahead',\r\n            configFields: schema$f(),\r\n            partFields: parts$4(),\r\n            factory: make$3\r\n        });\r\n        var renderFormFieldWith = function (pLabel, pField, extraClasses) {\r\n            var spec = renderFormFieldSpecWith(pLabel, pField, extraClasses);\r\n            return FormField.sketch(spec);\r\n        };\r\n        var renderFormField = function (pLabel, pField) {\r\n            return renderFormFieldWith(pLabel, pField, []);\r\n        };\r\n        var renderFormFieldSpecWith = function (pLabel, pField, extraClasses) {\r\n            return {\r\n                dom: renderFormFieldDomWith(extraClasses),\r\n                components: pLabel.toArray().concat([pField])\r\n            };\r\n        };\r\n        var renderFormFieldDom = function () {\r\n            return renderFormFieldDomWith([]);\r\n        };\r\n        var renderFormFieldDomWith = function (extraClasses) {\r\n            return {\r\n                tag: 'div',\r\n                classes: ['tox-form__group'].concat(extraClasses)\r\n            };\r\n        };\r\n        var renderLabel = function (label, providersBackstage) {\r\n            return FormField.parts().label({\r\n                dom: {\r\n                    tag: 'label',\r\n                    classes: ['tox-label'],\r\n                    innerHtml: providersBackstage.translate(label)\r\n                }\r\n            });\r\n        };\r\n        var isMenuItemReference = function (item) {\r\n            return isString(item);\r\n        };\r\n        var isSeparator = function (item) {\r\n            return item.type === 'separator';\r\n        };\r\n        var isExpandingMenuItem = function (item) {\r\n            return has(item, 'getSubmenuItems');\r\n        };\r\n        var separator$1 = { type: 'separator' };\r\n        var unwrapReferences = function (items, menuItems) {\r\n            var realItems = foldl(items, function (acc, item) {\r\n                if (isMenuItemReference(item)) {\r\n                    if (item === '') {\r\n                        return acc;\r\n                    }\r\n                    else if (item === '|') {\r\n                        return acc.length > 0 && !isSeparator(acc[acc.length - 1]) ? acc.concat([separator$1]) : acc;\r\n                    }\r\n                    else if (has(menuItems, item.toLowerCase())) {\r\n                        return acc.concat([menuItems[item.toLowerCase()]]);\r\n                    }\r\n                    else {\r\n                        return acc;\r\n                    }\r\n                }\r\n                else {\r\n                    return acc.concat([item]);\r\n                }\r\n            }, []);\r\n            if (realItems.length > 0 && isSeparator(realItems[realItems.length - 1])) {\r\n                realItems.pop();\r\n            }\r\n            return realItems;\r\n        };\r\n        var getFromExpandingItem = function (item, menuItems) {\r\n            var submenuItems = item.getSubmenuItems();\r\n            var rest = expand(submenuItems, menuItems);\r\n            var newMenus = deepMerge(rest.menus, wrap$1(item.value, rest.items));\r\n            var newExpansions = deepMerge(rest.expansions, wrap$1(item.value, item.value));\r\n            return {\r\n                item: item,\r\n                menus: newMenus,\r\n                expansions: newExpansions\r\n            };\r\n        };\r\n        var getFromItem = function (item, menuItems) {\r\n            return isExpandingMenuItem(item) ? getFromExpandingItem(item, menuItems) : {\r\n                item: item,\r\n                menus: {},\r\n                expansions: {}\r\n            };\r\n        };\r\n        var generateValueIfRequired = function (item) {\r\n            if (isSeparator(item)) {\r\n                return item;\r\n            }\r\n            else {\r\n                var itemValue = readOptFrom$1(item, 'value').getOrThunk(function () {\r\n                    return generate$1('generated-menu-item');\r\n                });\r\n                return deepMerge({ value: itemValue }, item);\r\n            }\r\n        };\r\n        var expand = function (items, menuItems) {\r\n            var realItems = unwrapReferences(isString(items) ? items.split(' ') : items, menuItems);\r\n            return foldr(realItems, function (acc, item) {\r\n                var itemWithValue = generateValueIfRequired(item);\r\n                var newData = getFromItem(itemWithValue, menuItems);\r\n                return {\r\n                    menus: deepMerge(acc.menus, newData.menus),\r\n                    items: [newData.item].concat(acc.items),\r\n                    expansions: deepMerge(acc.expansions, newData.expansions)\r\n                };\r\n            }, {\r\n                menus: {},\r\n                expansions: {},\r\n                items: []\r\n            });\r\n        };\r\n        var build$2 = function (items, itemResponse, backstage) {\r\n            var primary = generate$1('primary-menu');\r\n            var data = expand(items, backstage.shared.providers.menuItems());\r\n            if (data.items.length === 0) {\r\n                return Option.none();\r\n            }\r\n            var mainMenu = createPartialMenu(primary, data.items, itemResponse, backstage);\r\n            var submenus = map$1(data.menus, function (menuItems, menuName) {\r\n                return createPartialMenu(menuName, menuItems, itemResponse, backstage);\r\n            });\r\n            var menus = deepMerge(submenus, wrap$1(primary, mainMenu));\r\n            return Option.from(tieredMenu.tieredData(primary, menus, data.expansions));\r\n        };\r\n        var renderAutocomplete = function (spec, backstage) {\r\n            var pLabel = renderLabel(spec.label.getOr('?'), backstage.shared.providers);\r\n            var pField = FormField.parts().field({\r\n                factory: Typeahead,\r\n                dismissOnBlur: false,\r\n                inputClasses: ['tox-textfield'],\r\n                minChars: 1,\r\n                fetch: function (input) {\r\n                    var value = Representing.getValue(input);\r\n                    var items = spec.getItems(value);\r\n                    var tdata = build$2(items, ItemResponse$1.BUBBLE_TO_SANDBOX, backstage);\r\n                    return Future.pure(tdata);\r\n                },\r\n                markers: { openClass: 'dog' },\r\n                lazySink: backstage.shared.getSink,\r\n                parts: { menu: part(false, 1, 'normal') }\r\n            });\r\n            return renderFormField(Option.some(pLabel), pField);\r\n        };\r\n        var renderBar = function (spec, backstage) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-bar']\r\n                },\r\n                components: map(spec.items, backstage.interpreter)\r\n            };\r\n        };\r\n        var factory$5 = function (detail, spec) {\r\n            return {\r\n                uid: detail.uid,\r\n                dom: dom$2(detail),\r\n                components: [],\r\n                behaviours: behaviours(detail),\r\n                eventOrder: detail.eventOrder\r\n            };\r\n        };\r\n        var Input = single$2({\r\n            name: 'Input',\r\n            configFields: schema$e(),\r\n            factory: factory$5\r\n        });\r\n        var ariaElements = [\r\n            'input',\r\n            'textarea'\r\n        ];\r\n        var isAriaElement = function (elem) {\r\n            var name$1 = name(elem);\r\n            return contains(ariaElements, name$1);\r\n        };\r\n        var markValid = function (component, invalidConfig) {\r\n            var elem = invalidConfig.getRoot(component).getOr(component.element());\r\n            remove$4(elem, invalidConfig.invalidClass);\r\n            invalidConfig.notify.each(function (notifyInfo) {\r\n                if (isAriaElement(component.element())) {\r\n                    set$1(component.element(), 'aria-invalid', false);\r\n                }\r\n                notifyInfo.getContainer(component).each(function (container) {\r\n                    set(container, notifyInfo.validHtml);\r\n                });\r\n                notifyInfo.onValid(component);\r\n            });\r\n        };\r\n        var markInvalid = function (component, invalidConfig, invalidState, text) {\r\n            var elem = invalidConfig.getRoot(component).getOr(component.element());\r\n            add$2(elem, invalidConfig.invalidClass);\r\n            invalidConfig.notify.each(function (notifyInfo) {\r\n                if (isAriaElement(component.element())) {\r\n                    set$1(component.element(), 'aria-invalid', true);\r\n                }\r\n                notifyInfo.getContainer(component).each(function (container) {\r\n                    set(container, text);\r\n                });\r\n                notifyInfo.onInvalid(component, text);\r\n            });\r\n        };\r\n        var query = function (component, invalidConfig, invalidState) {\r\n            return invalidConfig.validator.fold(function () {\r\n                return Future.pure(Result.value(true));\r\n            }, function (validatorInfo) {\r\n                return validatorInfo.validate(component);\r\n            });\r\n        };\r\n        var run$1 = function (component, invalidConfig, invalidState) {\r\n            invalidConfig.notify.each(function (notifyInfo) {\r\n                notifyInfo.onValidate(component);\r\n            });\r\n            return query(component, invalidConfig, invalidState).map(function (valid) {\r\n                if (component.getSystem().isConnected()) {\r\n                    return valid.fold(function (err) {\r\n                        markInvalid(component, invalidConfig, invalidState, err);\r\n                        return Result.error(err);\r\n                    }, function (v) {\r\n                        markValid(component, invalidConfig);\r\n                        return Result.value(v);\r\n                    });\r\n                }\r\n                else {\r\n                    return Result.error('No longer in system');\r\n                }\r\n            });\r\n        };\r\n        var isInvalid = function (component, invalidConfig) {\r\n            var elem = invalidConfig.getRoot(component).getOr(component.element());\r\n            return has$2(elem, invalidConfig.invalidClass);\r\n        };\r\n        var InvalidateApis = Object.freeze({\r\n            markValid: markValid,\r\n            markInvalid: markInvalid,\r\n            query: query,\r\n            run: run$1,\r\n            isInvalid: isInvalid\r\n        });\r\n        var events$b = function (invalidConfig, invalidState) {\r\n            return invalidConfig.validator.map(function (validatorInfo) {\r\n                return derive([run(validatorInfo.onEvent, function (component) {\r\n                        run$1(component, invalidConfig, invalidState).get(identity);\r\n                    })].concat(validatorInfo.validateOnLoad ? [runOnAttached(function (component) {\r\n                        run$1(component, invalidConfig, invalidState).get(noop);\r\n                    })] : []));\r\n            }).getOr({});\r\n        };\r\n        var ActiveInvalidate = Object.freeze({\r\n            events: events$b\r\n        });\r\n        var InvalidateSchema = [\r\n            strict$1('invalidClass'),\r\n            defaulted$1('getRoot', Option.none),\r\n            optionObjOf('notify', [\r\n                defaulted$1('aria', 'alert'),\r\n                defaulted$1('getContainer', Option.none),\r\n                defaulted$1('validHtml', ''),\r\n                onHandler('onValid'),\r\n                onHandler('onInvalid'),\r\n                onHandler('onValidate')\r\n            ]),\r\n            optionObjOf('validator', [\r\n                strict$1('validate'),\r\n                defaulted$1('onEvent', 'input'),\r\n                defaulted$1('validateOnLoad', true)\r\n            ])\r\n        ];\r\n        var Invalidating = create$1({\r\n            fields: InvalidateSchema,\r\n            name: 'invalidating',\r\n            active: ActiveInvalidate,\r\n            apis: InvalidateApis,\r\n            extra: {\r\n                validation: function (validator) {\r\n                    return function (component) {\r\n                        var v = Representing.getValue(component);\r\n                        return Future.pure(validator(v));\r\n                    };\r\n                }\r\n            }\r\n        });\r\n        var exhibit$4 = function (base, tabConfig) {\r\n            return nu$6({\r\n                attributes: wrapAll$1([{\r\n                        key: tabConfig.tabAttr,\r\n                        value: 'true'\r\n                    }])\r\n            });\r\n        };\r\n        var ActiveTabstopping = Object.freeze({\r\n            exhibit: exhibit$4\r\n        });\r\n        var TabstopSchema = [defaulted$1('tabAttr', 'data-alloy-tabstop')];\r\n        var Tabstopping = create$1({\r\n            fields: TabstopSchema,\r\n            name: 'tabstopping',\r\n            active: ActiveTabstopping\r\n        });\r\n        var schema$g = constant([\r\n            strict$1('dom'),\r\n            strict$1('fetch'),\r\n            onHandler('onOpen'),\r\n            onKeyboardHandler('onExecute'),\r\n            defaulted$1('getHotspot', Option.some),\r\n            defaulted$1('getAnchorOverrides', constant({})),\r\n            defaulted$1('layouts', Option.none()),\r\n            field$1('dropdownBehaviours', [\r\n                Toggling,\r\n                Coupling,\r\n                Keying,\r\n                Focusing\r\n            ]),\r\n            strict$1('toggleClass'),\r\n            defaulted$1('eventOrder', {}),\r\n            option('lazySink'),\r\n            defaulted$1('matchWidth', false),\r\n            defaulted$1('useMinWidth', false),\r\n            option('role')\r\n        ].concat(sandboxFields()));\r\n        var parts$5 = constant([\r\n            external$1({\r\n                schema: [tieredMenuMarkers()],\r\n                name: 'menu',\r\n                defaults: function (detail) {\r\n                    return { onExecute: detail.onExecute };\r\n                }\r\n            }),\r\n            partType()\r\n        ]);\r\n        var factory$6 = function (detail, components, _spec, externals) {\r\n            var _a;\r\n            var lookupAttr = function (attr) {\r\n                return readOptFrom$1(detail.dom, 'attributes').bind(function (attrs) {\r\n                    return readOptFrom$1(attrs, attr);\r\n                });\r\n            };\r\n            var switchToMenu = function (sandbox) {\r\n                Sandboxing.getState(sandbox).each(function (tmenu) {\r\n                    tieredMenu.highlightPrimary(tmenu);\r\n                });\r\n            };\r\n            var action = function (component) {\r\n                var onOpenSync = switchToMenu;\r\n                togglePopup(detail, function (x) {\r\n                    return x;\r\n                }, component, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);\r\n            };\r\n            var apis = {\r\n                expand: function (comp) {\r\n                    if (!Toggling.isOn(comp)) {\r\n                        togglePopup(detail, function (x) {\r\n                            return x;\r\n                        }, comp, externals, noop, HighlightOnOpen.HighlightNone).get(noop);\r\n                    }\r\n                },\r\n                open: function (comp) {\r\n                    if (!Toggling.isOn(comp)) {\r\n                        togglePopup(detail, function (x) {\r\n                            return x;\r\n                        }, comp, externals, noop, HighlightOnOpen.HighlightFirst).get(noop);\r\n                    }\r\n                },\r\n                isOpen: Toggling.isOn,\r\n                close: function (comp) {\r\n                    if (Toggling.isOn(comp)) {\r\n                        togglePopup(detail, function (x) {\r\n                            return x;\r\n                        }, comp, externals, noop, HighlightOnOpen.HighlightFirst).get(noop);\r\n                    }\r\n                }\r\n            };\r\n            var triggerExecute = function (comp, se) {\r\n                emitExecute(comp);\r\n                return Option.some(true);\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                behaviours: augment(detail.dropdownBehaviours, [\r\n                    Toggling.config({\r\n                        toggleClass: detail.toggleClass,\r\n                        aria: { mode: 'expanded' }\r\n                    }),\r\n                    Coupling.config({\r\n                        others: {\r\n                            sandbox: function (hotspot) {\r\n                                return makeSandbox(detail, hotspot, {\r\n                                    onOpen: function () {\r\n                                        Toggling.on(hotspot);\r\n                                    },\r\n                                    onClose: function () {\r\n                                        Toggling.off(hotspot);\r\n                                    }\r\n                                });\r\n                            }\r\n                        }\r\n                    }),\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onSpace: triggerExecute,\r\n                        onEnter: triggerExecute,\r\n                        onDown: function (comp, se) {\r\n                            if (Dropdown.isOpen(comp)) {\r\n                                var sandbox = Coupling.getCoupled(comp, 'sandbox');\r\n                                switchToMenu(sandbox);\r\n                            }\r\n                            else {\r\n                                Dropdown.open(comp);\r\n                            }\r\n                            return Option.some(true);\r\n                        },\r\n                        onEscape: function (comp, se) {\r\n                            if (Dropdown.isOpen(comp)) {\r\n                                Dropdown.close(comp);\r\n                                return Option.some(true);\r\n                            }\r\n                            else {\r\n                                return Option.none();\r\n                            }\r\n                        }\r\n                    }),\r\n                    Focusing.config({})\r\n                ]),\r\n                events: events$7(Option.some(action)),\r\n                eventOrder: __assign({}, detail.eventOrder, (_a = {}, _a[execute()] = [\r\n                    'disabling',\r\n                    'toggling',\r\n                    'alloy.base.behaviour'\r\n                ], _a)),\r\n                apis: apis,\r\n                domModification: {\r\n                    attributes: __assign({ 'aria-haspopup': 'true' }, detail.role.fold(function () {\r\n                        return {};\r\n                    }, function (role) {\r\n                        return { role: role };\r\n                    }), detail.dom.tag === 'button' ? { type: lookupAttr('type').getOr('button') } : {})\r\n                }\r\n            };\r\n        };\r\n        var Dropdown = composite$1({\r\n            name: 'Dropdown',\r\n            configFields: schema$g(),\r\n            partFields: parts$5(),\r\n            factory: factory$6,\r\n            apis: {\r\n                open: function (apis, comp) {\r\n                    return apis.open(comp);\r\n                },\r\n                expand: function (apis, comp) {\r\n                    return apis.expand(comp);\r\n                },\r\n                close: function (apis, comp) {\r\n                    return apis.close(comp);\r\n                },\r\n                isOpen: function (apis, comp) {\r\n                    return apis.isOpen(comp);\r\n                }\r\n            }\r\n        });\r\n        var exhibit$5 = function (base, unselectConfig) {\r\n            return nu$6({\r\n                styles: {\r\n                    '-webkit-user-select': 'none',\r\n                    'user-select': 'none',\r\n                    '-ms-user-select': 'none',\r\n                    '-moz-user-select': '-moz-none'\r\n                },\r\n                attributes: { unselectable: 'on' }\r\n            });\r\n        };\r\n        var events$c = function (unselectConfig) {\r\n            return derive([abort(selectstart(), constant(true))]);\r\n        };\r\n        var ActiveUnselecting = Object.freeze({\r\n            events: events$c,\r\n            exhibit: exhibit$5\r\n        });\r\n        var Unselecting = create$1({\r\n            fields: [],\r\n            name: 'unselecting',\r\n            active: ActiveUnselecting\r\n        });\r\n        var renderPanelButton = function (spec, sharedBackstage) {\r\n            return Dropdown.sketch({\r\n                dom: spec.dom,\r\n                components: spec.components,\r\n                toggleClass: 'mce-active',\r\n                dropdownBehaviours: derive$1([\r\n                    Unselecting.config({}),\r\n                    Tabstopping.config({})\r\n                ]),\r\n                layouts: spec.layouts,\r\n                sandboxClasses: ['tox-dialog__popups'],\r\n                lazySink: sharedBackstage.getSink,\r\n                fetch: function (comp) {\r\n                    return Future.nu(function (callback) {\r\n                        return spec.fetch(callback);\r\n                    }).map(function (items) {\r\n                        return Option.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$1('menu-value'), items, function (value) {\r\n                            spec.onItemAction(comp, value);\r\n                        }, spec.columns, spec.presets, ItemResponse$1.CLOSE_ON_EXECUTE, function () {\r\n                            return false;\r\n                        }, sharedBackstage.providers), { movement: deriveMenuMovement(spec.columns, spec.presets) })));\r\n                    });\r\n                },\r\n                parts: { menu: part(false, 1, spec.presets) }\r\n            });\r\n        };\r\n        var colorInputChangeEvent = generate$1('color-input-change');\r\n        var colorSwatchChangeEvent = generate$1('color-swatch-change');\r\n        var colorPickerCancelEvent = generate$1('color-picker-cancel');\r\n        var renderColorInput = function (spec, sharedBackstage, colorInputBackstage) {\r\n            var pField = FormField.parts().field({\r\n                factory: Input,\r\n                inputClasses: ['tox-textfield'],\r\n                onSetValue: function (c) {\r\n                    return Invalidating.run(c).get(function () {\r\n                    });\r\n                },\r\n                inputBehaviours: derive$1([\r\n                    Tabstopping.config({}),\r\n                    Invalidating.config({\r\n                        invalidClass: 'tox-textbox-field-invalid',\r\n                        getRoot: function (comp) {\r\n                            return parent(comp.element());\r\n                        },\r\n                        notify: {\r\n                            onValid: function (comp) {\r\n                                var val = Representing.getValue(comp);\r\n                                emitWith(comp, colorInputChangeEvent, { color: val });\r\n                            }\r\n                        },\r\n                        validator: {\r\n                            validateOnLoad: false,\r\n                            validate: function (input) {\r\n                                var inputValue = Representing.getValue(input);\r\n                                if (inputValue.length === 0) {\r\n                                    return Future.pure(Result.value(true));\r\n                                }\r\n                                else {\r\n                                    var span = Element.fromTag('span');\r\n                                    set$2(span, 'background-color', inputValue);\r\n                                    var res = getRaw(span, 'background-color').fold(function () {\r\n                                        return Result.error('blah');\r\n                                    }, function (_) {\r\n                                        return Result.value(inputValue);\r\n                                    });\r\n                                    return Future.pure(res);\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                ]),\r\n                selectOnFocus: false\r\n            });\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, sharedBackstage.providers);\r\n            });\r\n            var emitSwatchChange = function (colorBit, value) {\r\n                emitWith(colorBit, colorSwatchChangeEvent, { value: value });\r\n            };\r\n            var onItemAction = function (comp, value) {\r\n                memColorButton.getOpt(comp).each(function (colorBit) {\r\n                    if (value === 'custom') {\r\n                        colorInputBackstage.colorPicker(function (valueOpt) {\r\n                            valueOpt.fold(function () {\r\n                                return emit(colorBit, colorPickerCancelEvent);\r\n                            }, function (value) {\r\n                                emitSwatchChange(colorBit, value);\r\n                                Settings.addColor(value);\r\n                            });\r\n                        }, '#ffffff');\r\n                    }\r\n                    else if (value === 'remove') {\r\n                        emitSwatchChange(colorBit, '');\r\n                    }\r\n                    else {\r\n                        emitSwatchChange(colorBit, value);\r\n                    }\r\n                });\r\n            };\r\n            var memColorButton = record(renderPanelButton({\r\n                dom: {\r\n                    tag: 'span',\r\n                    attributes: { 'aria-label': sharedBackstage.providers.translate('Color swatch') }\r\n                },\r\n                layouts: Option.some({\r\n                    onRtl: function () {\r\n                        return [southeast$1];\r\n                    },\r\n                    onLtr: function () {\r\n                        return [southwest$1];\r\n                    }\r\n                }),\r\n                components: [],\r\n                fetch: ColorSwatch.getFetch(colorInputBackstage.getColors(), colorInputBackstage.hasCustomColors()),\r\n                columns: colorInputBackstage.getColorCols(),\r\n                presets: 'color',\r\n                onItemAction: onItemAction\r\n            }, sharedBackstage));\r\n            return FormField.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-form__group']\r\n                },\r\n                components: pLabel.toArray().concat([{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-color-input']\r\n                        },\r\n                        components: [\r\n                            pField,\r\n                            memColorButton.asSpec()\r\n                        ]\r\n                    }]),\r\n                fieldBehaviours: derive$1([config('form-field-events', [\r\n                        run(colorInputChangeEvent, function (comp, se) {\r\n                            memColorButton.getOpt(comp).each(function (colorButton) {\r\n                                set$2(colorButton.element(), 'background-color', se.event().color());\r\n                            });\r\n                        }),\r\n                        run(colorSwatchChangeEvent, function (comp, se) {\r\n                            FormField.getField(comp).each(function (field) {\r\n                                Representing.setValue(field, se.event().value());\r\n                                Composing.getCurrent(comp).each(Focusing.focus);\r\n                            });\r\n                        }),\r\n                        run(colorPickerCancelEvent, function (comp, se) {\r\n                            FormField.getField(comp).each(function (field) {\r\n                                Composing.getCurrent(comp).each(Focusing.focus);\r\n                            });\r\n                        })\r\n                    ])])\r\n            });\r\n        };\r\n        var hsvColour = function (hue, saturation, value) {\r\n            return {\r\n                hue: constant(hue),\r\n                saturation: constant(saturation),\r\n                value: constant(value)\r\n            };\r\n        };\r\n        var fromRgb = function (rgbaColour) {\r\n            var h = 0;\r\n            var s = 0;\r\n            var v = 0;\r\n            var r = rgbaColour.red() / 255;\r\n            var g = rgbaColour.green() / 255;\r\n            var b = rgbaColour.blue() / 255;\r\n            var minRGB = Math.min(r, Math.min(g, b));\r\n            var maxRGB = Math.max(r, Math.max(g, b));\r\n            if (minRGB === maxRGB) {\r\n                v = minRGB;\r\n                return hsvColour(0, 0, v * 100);\r\n            }\r\n            var d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\r\n            h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\r\n            h = 60 * (h - d / (maxRGB - minRGB));\r\n            s = (maxRGB - minRGB) / maxRGB;\r\n            v = maxRGB;\r\n            return hsvColour(Math.round(h), Math.round(s * 100), Math.round(v * 100));\r\n        };\r\n        var calcHex = function (value) {\r\n            var hue = (100 - value) / 100 * 360;\r\n            var hsv = hsvColour(hue, 100, 100);\r\n            var rgb = fromHsv(hsv);\r\n            return fromRgba(rgb);\r\n        };\r\n        var fieldsUpdate = constant(generate$1('rgb-hex-update'));\r\n        var sliderUpdate = constant(generate$1('slider-update'));\r\n        var paletteUpdate = constant(generate$1('palette-update'));\r\n        var platform = PlatformDetection$1.detect();\r\n        var isTouch = platform.deviceType.isTouch();\r\n        var labelPart = optional({\r\n            schema: [strict$1('dom')],\r\n            name: 'label'\r\n        });\r\n        var edgePart = function (name) {\r\n            return optional({\r\n                name: '' + name + '-edge',\r\n                overrides: function (detail) {\r\n                    var action = detail.model.manager.edgeActions[name];\r\n                    return action.fold(function () {\r\n                        return {};\r\n                    }, function (a) {\r\n                        var touchEvents = derive([runActionExtra(touchstart(), a, [detail])]);\r\n                        var mouseEvents = derive([\r\n                            runActionExtra(mousedown(), a, [detail]),\r\n                            runActionExtra(mousemove(), function (l, det) {\r\n                                if (det.mouseIsDown.get()) {\r\n                                    a(l, det);\r\n                                }\r\n                            }, [detail])\r\n                        ]);\r\n                        return { events: isTouch ? touchEvents : mouseEvents };\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        var tlEdgePart = edgePart('top-left');\r\n        var tedgePart = edgePart('top');\r\n        var trEdgePart = edgePart('top-right');\r\n        var redgePart = edgePart('right');\r\n        var brEdgePart = edgePart('bottom-right');\r\n        var bedgePart = edgePart('bottom');\r\n        var blEdgePart = edgePart('bottom-left');\r\n        var ledgePart = edgePart('left');\r\n        var thumbPart = required({\r\n            name: 'thumb',\r\n            defaults: constant({ dom: { styles: { position: 'absolute' } } }),\r\n            overrides: function (detail) {\r\n                return {\r\n                    events: derive([\r\n                        redirectToPart(touchstart(), detail, 'spectrum'),\r\n                        redirectToPart(touchmove(), detail, 'spectrum'),\r\n                        redirectToPart(touchend(), detail, 'spectrum'),\r\n                        redirectToPart(mousedown(), detail, 'spectrum'),\r\n                        redirectToPart(mousemove(), detail, 'spectrum'),\r\n                        redirectToPart(mouseup(), detail, 'spectrum')\r\n                    ])\r\n                };\r\n            }\r\n        });\r\n        var spectrumPart = required({\r\n            schema: [state$1('mouseIsDown', function () {\r\n                    return Cell(false);\r\n                })],\r\n            name: 'spectrum',\r\n            overrides: function (detail) {\r\n                var modelDetail = detail.model;\r\n                var model = modelDetail.manager;\r\n                var setValueFrom = function (component, simulatedEvent) {\r\n                    return model.getValueFromEvent(simulatedEvent).map(function (value) {\r\n                        return model.setValueFrom(component, detail, value);\r\n                    });\r\n                };\r\n                var touchEvents = derive([\r\n                    run(touchstart(), setValueFrom),\r\n                    run(touchmove(), setValueFrom)\r\n                ]);\r\n                var mouseEvents = derive([\r\n                    run(mousedown(), setValueFrom),\r\n                    run(mousemove(), function (spectrum, se) {\r\n                        if (detail.mouseIsDown.get()) {\r\n                            setValueFrom(spectrum, se);\r\n                        }\r\n                    })\r\n                ]);\r\n                return {\r\n                    behaviours: derive$1(isTouch ? [] : [\r\n                        Keying.config({\r\n                            mode: 'special',\r\n                            onLeft: function (spectrum) {\r\n                                return model.onLeft(spectrum, detail);\r\n                            },\r\n                            onRight: function (spectrum) {\r\n                                return model.onRight(spectrum, detail);\r\n                            },\r\n                            onUp: function (spectrum) {\r\n                                return model.onUp(spectrum, detail);\r\n                            },\r\n                            onDown: function (spectrum) {\r\n                                return model.onDown(spectrum, detail);\r\n                            }\r\n                        }),\r\n                        Focusing.config({})\r\n                    ]),\r\n                    events: isTouch ? touchEvents : mouseEvents\r\n                };\r\n            }\r\n        });\r\n        var SliderParts = [\r\n            labelPart,\r\n            ledgePart,\r\n            redgePart,\r\n            tedgePart,\r\n            bedgePart,\r\n            tlEdgePart,\r\n            trEdgePart,\r\n            blEdgePart,\r\n            brEdgePart,\r\n            thumbPart,\r\n            spectrumPart\r\n        ];\r\n        var isTouch$1 = PlatformDetection$1.detect().deviceType.isTouch();\r\n        var _sliderChangeEvent = 'slider.change.value';\r\n        var sliderChangeEvent = constant(_sliderChangeEvent);\r\n        var getEventSource = function (simulatedEvent) {\r\n            var evt = simulatedEvent.event().raw();\r\n            if (isTouch$1) {\r\n                var touchEvent = evt;\r\n                return touchEvent.touches !== undefined && touchEvent.touches.length === 1 ? Option.some(touchEvent.touches[0]).map(function (t) {\r\n                    return Position(t.clientX, t.clientY);\r\n                }) : Option.none();\r\n            }\r\n            else {\r\n                var mouseEvent = evt;\r\n                return mouseEvent.clientX !== undefined ? Option.some(mouseEvent).map(function (me) {\r\n                    return Position(me.clientX, me.clientY);\r\n                }) : Option.none();\r\n            }\r\n        };\r\n        var reduceBy = function (value, min, max, step) {\r\n            if (value < min) {\r\n                return value;\r\n            }\r\n            else if (value > max) {\r\n                return max;\r\n            }\r\n            else if (value === min) {\r\n                return min - 1;\r\n            }\r\n            else {\r\n                return Math.max(min, value - step);\r\n            }\r\n        };\r\n        var increaseBy = function (value, min, max, step) {\r\n            if (value > max) {\r\n                return value;\r\n            }\r\n            else if (value < min) {\r\n                return min;\r\n            }\r\n            else if (value === max) {\r\n                return max + 1;\r\n            }\r\n            else {\r\n                return Math.min(max, value + step);\r\n            }\r\n        };\r\n        var capValue = function (value, min, max) {\r\n            return Math.max(min, Math.min(max, value));\r\n        };\r\n        var snapValueOf = function (value, min, max, step, snapStart) {\r\n            return snapStart.fold(function () {\r\n                var initValue = value - min;\r\n                var extraValue = Math.round(initValue / step) * step;\r\n                return capValue(min + extraValue, min - 1, max + 1);\r\n            }, function (start) {\r\n                var remainder = (value - start) % step;\r\n                var adjustment = Math.round(remainder / step);\r\n                var rawSteps = Math.floor((value - start) / step);\r\n                var maxSteps = Math.floor((max - start) / step);\r\n                var numSteps = Math.min(maxSteps, rawSteps + adjustment);\r\n                var r = start + numSteps * step;\r\n                return Math.max(start, r);\r\n            });\r\n        };\r\n        var findOffsetOf = function (value, min, max) {\r\n            return Math.min(max, Math.max(value, min)) - min;\r\n        };\r\n        var findValueOf = function (args) {\r\n            var min = args.min, max = args.max, range = args.range, value = args.value, step = args.step, snap = args.snap, snapStart = args.snapStart, rounded = args.rounded, hasMinEdge = args.hasMinEdge, hasMaxEdge = args.hasMaxEdge, minBound = args.minBound, maxBound = args.maxBound, screenRange = args.screenRange;\r\n            var capMin = hasMinEdge ? min - 1 : min;\r\n            var capMax = hasMaxEdge ? max + 1 : max;\r\n            if (value < minBound) {\r\n                return capMin;\r\n            }\r\n            else if (value > maxBound) {\r\n                return capMax;\r\n            }\r\n            else {\r\n                var offset = findOffsetOf(value, minBound, maxBound);\r\n                var newValue = capValue(offset / screenRange * range + min, capMin, capMax);\r\n                if (snap && newValue >= min && newValue <= max) {\r\n                    return snapValueOf(newValue, min, max, step, snapStart);\r\n                }\r\n                else if (rounded) {\r\n                    return Math.round(newValue);\r\n                }\r\n                else {\r\n                    return newValue;\r\n                }\r\n            }\r\n        };\r\n        var findOffsetOfValue = function (args) {\r\n            var min = args.min, max = args.max, range = args.range, value = args.value, hasMinEdge = args.hasMinEdge, hasMaxEdge = args.hasMaxEdge, maxBound = args.maxBound, maxOffset = args.maxOffset, centerMinEdge = args.centerMinEdge, centerMaxEdge = args.centerMaxEdge;\r\n            if (value < min) {\r\n                return hasMinEdge ? 0 : centerMinEdge;\r\n            }\r\n            else if (value > max) {\r\n                return hasMaxEdge ? maxBound : centerMaxEdge;\r\n            }\r\n            else {\r\n                return (value - min) / range * maxOffset;\r\n            }\r\n        };\r\n        var t = 'top', r$1 = 'right', b = 'bottom', l = 'left';\r\n        var minX = function (detail) {\r\n            return detail.model.minX;\r\n        };\r\n        var minY = function (detail) {\r\n            return detail.model.minY;\r\n        };\r\n        var min1X = function (detail) {\r\n            return detail.model.minX - 1;\r\n        };\r\n        var min1Y = function (detail) {\r\n            return detail.model.minY - 1;\r\n        };\r\n        var maxX = function (detail) {\r\n            return detail.model.maxX;\r\n        };\r\n        var maxY = function (detail) {\r\n            return detail.model.maxY;\r\n        };\r\n        var max1X = function (detail) {\r\n            return detail.model.maxX + 1;\r\n        };\r\n        var max1Y = function (detail) {\r\n            return detail.model.maxY + 1;\r\n        };\r\n        var range$2 = function (detail, max, min) {\r\n            return max(detail) - min(detail);\r\n        };\r\n        var xRange = function (detail) {\r\n            return range$2(detail, maxX, minX);\r\n        };\r\n        var yRange = function (detail) {\r\n            return range$2(detail, maxY, minY);\r\n        };\r\n        var halfX = function (detail) {\r\n            return xRange(detail) / 2;\r\n        };\r\n        var halfY = function (detail) {\r\n            return yRange(detail) / 2;\r\n        };\r\n        var step = function (detail) {\r\n            return detail.stepSize;\r\n        };\r\n        var snap = function (detail) {\r\n            return detail.snapToGrid;\r\n        };\r\n        var snapStart = function (detail) {\r\n            return detail.snapStart;\r\n        };\r\n        var rounded = function (detail) {\r\n            return detail.rounded;\r\n        };\r\n        var hasEdge = function (detail, edgeName) {\r\n            return detail[edgeName + '-edge'] !== undefined;\r\n        };\r\n        var hasLEdge = function (detail) {\r\n            return hasEdge(detail, l);\r\n        };\r\n        var hasREdge = function (detail) {\r\n            return hasEdge(detail, r$1);\r\n        };\r\n        var hasTEdge = function (detail) {\r\n            return hasEdge(detail, t);\r\n        };\r\n        var hasBEdge = function (detail) {\r\n            return hasEdge(detail, b);\r\n        };\r\n        var currentValue = function (detail) {\r\n            return detail.model.value.get();\r\n        };\r\n        var xValue = function (x) {\r\n            return { x: constant(x) };\r\n        };\r\n        var yValue = function (y) {\r\n            return { y: constant(y) };\r\n        };\r\n        var xyValue = function (x, y) {\r\n            return {\r\n                x: constant(x),\r\n                y: constant(y)\r\n            };\r\n        };\r\n        var fireSliderChange = function (component, value) {\r\n            emitWith(component, sliderChangeEvent(), { value: value });\r\n        };\r\n        var setToTLEdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(min1X(detail), min1Y(detail)));\r\n        };\r\n        var setToTEdge = function (edge, detail) {\r\n            fireSliderChange(edge, yValue(min1Y(detail)));\r\n        };\r\n        var setToTEdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(halfX(detail), min1Y(detail)));\r\n        };\r\n        var setToTREdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(max1X(detail), min1Y(detail)));\r\n        };\r\n        var setToREdge = function (edge, detail) {\r\n            fireSliderChange(edge, xValue(max1X(detail)));\r\n        };\r\n        var setToREdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(max1X(detail), halfY(detail)));\r\n        };\r\n        var setToBREdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(max1X(detail), max1Y(detail)));\r\n        };\r\n        var setToBEdge = function (edge, detail) {\r\n            fireSliderChange(edge, yValue(max1Y(detail)));\r\n        };\r\n        var setToBEdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(halfX(detail), max1Y(detail)));\r\n        };\r\n        var setToBLEdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(min1X(detail), max1Y(detail)));\r\n        };\r\n        var setToLEdge = function (edge, detail) {\r\n            fireSliderChange(edge, xValue(min1X(detail)));\r\n        };\r\n        var setToLEdgeXY = function (edge, detail) {\r\n            fireSliderChange(edge, xyValue(min1X(detail), halfY(detail)));\r\n        };\r\n        var top = 'top', right = 'right', bottom = 'bottom', left = 'left', width = 'width', height = 'height';\r\n        var getBounds = function (component) {\r\n            return component.element().dom().getBoundingClientRect();\r\n        };\r\n        var getBoundsProperty = function (bounds, property) {\r\n            return bounds[property];\r\n        };\r\n        var getMinXBounds = function (component) {\r\n            var bounds = getBounds(component);\r\n            return getBoundsProperty(bounds, left);\r\n        };\r\n        var getMaxXBounds = function (component) {\r\n            var bounds = getBounds(component);\r\n            return getBoundsProperty(bounds, right);\r\n        };\r\n        var getMinYBounds = function (component) {\r\n            var bounds = getBounds(component);\r\n            return getBoundsProperty(bounds, top);\r\n        };\r\n        var getMaxYBounds = function (component) {\r\n            var bounds = getBounds(component);\r\n            return getBoundsProperty(bounds, bottom);\r\n        };\r\n        var getXScreenRange = function (component) {\r\n            var bounds = getBounds(component);\r\n            return getBoundsProperty(bounds, width);\r\n        };\r\n        var getYScreenRange = function (component) {\r\n            var bounds = getBounds(component);\r\n            return getBoundsProperty(bounds, height);\r\n        };\r\n        var getCenterOffsetOf = function (componentMinEdge, componentMaxEdge, spectrumMinEdge) {\r\n            return (componentMinEdge + componentMaxEdge) / 2 - spectrumMinEdge;\r\n        };\r\n        var getXCenterOffSetOf = function (component, spectrum) {\r\n            var componentBounds = getBounds(component);\r\n            var spectrumBounds = getBounds(spectrum);\r\n            var componentMinEdge = getBoundsProperty(componentBounds, left);\r\n            var componentMaxEdge = getBoundsProperty(componentBounds, right);\r\n            var spectrumMinEdge = getBoundsProperty(spectrumBounds, left);\r\n            return getCenterOffsetOf(componentMinEdge, componentMaxEdge, spectrumMinEdge);\r\n        };\r\n        var getYCenterOffSetOf = function (component, spectrum) {\r\n            var componentBounds = getBounds(component);\r\n            var spectrumBounds = getBounds(spectrum);\r\n            var componentMinEdge = getBoundsProperty(componentBounds, top);\r\n            var componentMaxEdge = getBoundsProperty(componentBounds, bottom);\r\n            var spectrumMinEdge = getBoundsProperty(spectrumBounds, top);\r\n            return getCenterOffsetOf(componentMinEdge, componentMaxEdge, spectrumMinEdge);\r\n        };\r\n        var fireSliderChange$1 = function (spectrum, value) {\r\n            emitWith(spectrum, sliderChangeEvent(), { value: value });\r\n        };\r\n        var sliderValue = function (x) {\r\n            return { x: constant(x) };\r\n        };\r\n        var findValueOfOffset = function (spectrum, detail, left) {\r\n            var args = {\r\n                min: minX(detail),\r\n                max: maxX(detail),\r\n                range: xRange(detail),\r\n                value: left,\r\n                step: step(detail),\r\n                snap: snap(detail),\r\n                snapStart: snapStart(detail),\r\n                rounded: rounded(detail),\r\n                hasMinEdge: hasLEdge(detail),\r\n                hasMaxEdge: hasREdge(detail),\r\n                minBound: getMinXBounds(spectrum),\r\n                maxBound: getMaxXBounds(spectrum),\r\n                screenRange: getXScreenRange(spectrum)\r\n            };\r\n            return findValueOf(args);\r\n        };\r\n        var setValueFrom = function (spectrum, detail, value) {\r\n            var xValue = findValueOfOffset(spectrum, detail, value);\r\n            var sliderVal = sliderValue(xValue);\r\n            fireSliderChange$1(spectrum, sliderVal);\r\n            return xValue;\r\n        };\r\n        var setToMin = function (spectrum, detail) {\r\n            var min = minX(detail);\r\n            fireSliderChange$1(spectrum, sliderValue(min));\r\n        };\r\n        var setToMax = function (spectrum, detail) {\r\n            var max = maxX(detail);\r\n            fireSliderChange$1(spectrum, sliderValue(max));\r\n        };\r\n        var moveBy = function (direction, spectrum, detail) {\r\n            var f = direction > 0 ? increaseBy : reduceBy;\r\n            var xValue = f(currentValue(detail).x(), minX(detail), maxX(detail), step(detail));\r\n            fireSliderChange$1(spectrum, sliderValue(xValue));\r\n            return Option.some(xValue);\r\n        };\r\n        var handleMovement = function (direction) {\r\n            return function (spectrum, detail) {\r\n                return moveBy(direction, spectrum, detail).map(function () {\r\n                    return true;\r\n                });\r\n            };\r\n        };\r\n        var getValueFromEvent = function (simulatedEvent) {\r\n            var pos = getEventSource(simulatedEvent);\r\n            return pos.map(function (p) {\r\n                return p.left();\r\n            });\r\n        };\r\n        var findOffsetOfValue$1 = function (spectrum, detail, value, minEdge, maxEdge) {\r\n            var minOffset = 0;\r\n            var maxOffset = getXScreenRange(spectrum);\r\n            var centerMinEdge = minEdge.bind(function (edge) {\r\n                return Option.some(getXCenterOffSetOf(edge, spectrum));\r\n            }).getOr(minOffset);\r\n            var centerMaxEdge = maxEdge.bind(function (edge) {\r\n                return Option.some(getXCenterOffSetOf(edge, spectrum));\r\n            }).getOr(maxOffset);\r\n            var args = {\r\n                min: minX(detail),\r\n                max: maxX(detail),\r\n                range: xRange(detail),\r\n                value: value,\r\n                hasMinEdge: hasLEdge(detail),\r\n                hasMaxEdge: hasREdge(detail),\r\n                minBound: getMinXBounds(spectrum),\r\n                minOffset: minOffset,\r\n                maxBound: getMaxXBounds(spectrum),\r\n                maxOffset: maxOffset,\r\n                centerMinEdge: centerMinEdge,\r\n                centerMaxEdge: centerMaxEdge\r\n            };\r\n            return findOffsetOfValue(args);\r\n        };\r\n        var findPositionOfValue = function (slider, spectrum, value, minEdge, maxEdge, detail) {\r\n            var offset = findOffsetOfValue$1(spectrum, detail, value, minEdge, maxEdge);\r\n            return getMinXBounds(spectrum) - getMinXBounds(slider) + offset;\r\n        };\r\n        var setPositionFromValue = function (slider, thumb, detail, edges) {\r\n            var value = currentValue(detail);\r\n            var pos = findPositionOfValue(slider, edges.getSpectrum(slider), value.x(), edges.getLeftEdge(slider), edges.getRightEdge(slider), detail);\r\n            var thumbRadius = get$7(thumb.element()) / 2;\r\n            set$2(thumb.element(), 'left', pos - thumbRadius + 'px');\r\n        };\r\n        var onLeft = handleMovement(-1);\r\n        var onRight = handleMovement(1);\r\n        var onUp = Option.none;\r\n        var onDown = Option.none;\r\n        var edgeActions = {\r\n            'top-left': Option.none(),\r\n            'top': Option.none(),\r\n            'top-right': Option.none(),\r\n            'right': Option.some(setToREdge),\r\n            'bottom-right': Option.none(),\r\n            'bottom': Option.none(),\r\n            'bottom-left': Option.none(),\r\n            'left': Option.some(setToLEdge)\r\n        };\r\n        var HorizontalModel = Object.freeze({\r\n            setValueFrom: setValueFrom,\r\n            setToMin: setToMin,\r\n            setToMax: setToMax,\r\n            findValueOfOffset: findValueOfOffset,\r\n            getValueFromEvent: getValueFromEvent,\r\n            findPositionOfValue: findPositionOfValue,\r\n            setPositionFromValue: setPositionFromValue,\r\n            onLeft: onLeft,\r\n            onRight: onRight,\r\n            onUp: onUp,\r\n            onDown: onDown,\r\n            edgeActions: edgeActions\r\n        });\r\n        var fireSliderChange$2 = function (spectrum, value) {\r\n            emitWith(spectrum, sliderChangeEvent(), { value: value });\r\n        };\r\n        var sliderValue$1 = function (y) {\r\n            return { y: constant(y) };\r\n        };\r\n        var findValueOfOffset$1 = function (spectrum, detail, top) {\r\n            var args = {\r\n                min: minY(detail),\r\n                max: maxY(detail),\r\n                range: yRange(detail),\r\n                value: top,\r\n                step: step(detail),\r\n                snap: snap(detail),\r\n                snapStart: snapStart(detail),\r\n                rounded: rounded(detail),\r\n                hasMinEdge: hasTEdge(detail),\r\n                hasMaxEdge: hasBEdge(detail),\r\n                minBound: getMinYBounds(spectrum),\r\n                maxBound: getMaxYBounds(spectrum),\r\n                screenRange: getYScreenRange(spectrum)\r\n            };\r\n            return findValueOf(args);\r\n        };\r\n        var setValueFrom$1 = function (spectrum, detail, value) {\r\n            var yValue = findValueOfOffset$1(spectrum, detail, value);\r\n            var sliderVal = sliderValue$1(yValue);\r\n            fireSliderChange$2(spectrum, sliderVal);\r\n            return yValue;\r\n        };\r\n        var setToMin$1 = function (spectrum, detail) {\r\n            var min = minY(detail);\r\n            fireSliderChange$2(spectrum, sliderValue$1(min));\r\n        };\r\n        var setToMax$1 = function (spectrum, detail) {\r\n            var max = maxY(detail);\r\n            fireSliderChange$2(spectrum, sliderValue$1(max));\r\n        };\r\n        var moveBy$1 = function (direction, spectrum, detail) {\r\n            var f = direction > 0 ? increaseBy : reduceBy;\r\n            var yValue = f(currentValue(detail).y(), minY(detail), maxY(detail), step(detail));\r\n            fireSliderChange$2(spectrum, sliderValue$1(yValue));\r\n            return Option.some(yValue);\r\n        };\r\n        var handleMovement$1 = function (direction) {\r\n            return function (spectrum, detail) {\r\n                return moveBy$1(direction, spectrum, detail).map(function () {\r\n                    return true;\r\n                });\r\n            };\r\n        };\r\n        var getValueFromEvent$1 = function (simulatedEvent) {\r\n            var pos = getEventSource(simulatedEvent);\r\n            return pos.map(function (p) {\r\n                return p.top();\r\n            });\r\n        };\r\n        var findOffsetOfValue$2 = function (spectrum, detail, value, minEdge, maxEdge) {\r\n            var minOffset = 0;\r\n            var maxOffset = getYScreenRange(spectrum);\r\n            var centerMinEdge = minEdge.bind(function (edge) {\r\n                return Option.some(getYCenterOffSetOf(edge, spectrum));\r\n            }).getOr(minOffset);\r\n            var centerMaxEdge = maxEdge.bind(function (edge) {\r\n                return Option.some(getYCenterOffSetOf(edge, spectrum));\r\n            }).getOr(maxOffset);\r\n            var args = {\r\n                min: minY(detail),\r\n                max: maxY(detail),\r\n                range: yRange(detail),\r\n                value: value,\r\n                hasMinEdge: hasTEdge(detail),\r\n                hasMaxEdge: hasBEdge(detail),\r\n                minBound: getMinYBounds(spectrum),\r\n                minOffset: minOffset,\r\n                maxBound: getMaxYBounds(spectrum),\r\n                maxOffset: maxOffset,\r\n                centerMinEdge: centerMinEdge,\r\n                centerMaxEdge: centerMaxEdge\r\n            };\r\n            return findOffsetOfValue(args);\r\n        };\r\n        var findPositionOfValue$1 = function (slider, spectrum, value, minEdge, maxEdge, detail) {\r\n            var offset = findOffsetOfValue$2(spectrum, detail, value, minEdge, maxEdge);\r\n            return getMinYBounds(spectrum) - getMinYBounds(slider) + offset;\r\n        };\r\n        var setPositionFromValue$1 = function (slider, thumb, detail, edges) {\r\n            var value = currentValue(detail);\r\n            var pos = findPositionOfValue$1(slider, edges.getSpectrum(slider), value.y(), edges.getTopEdge(slider), edges.getBottomEdge(slider), detail);\r\n            var thumbRadius = get$8(thumb.element()) / 2;\r\n            set$2(thumb.element(), 'top', pos - thumbRadius + 'px');\r\n        };\r\n        var onLeft$1 = Option.none;\r\n        var onRight$1 = Option.none;\r\n        var onUp$1 = handleMovement$1(-1);\r\n        var onDown$1 = handleMovement$1(1);\r\n        var edgeActions$1 = {\r\n            'top-left': Option.none(),\r\n            'top': Option.some(setToTEdge),\r\n            'top-right': Option.none(),\r\n            'right': Option.none(),\r\n            'bottom-right': Option.none(),\r\n            'bottom': Option.some(setToBEdge),\r\n            'bottom-left': Option.none(),\r\n            'left': Option.none()\r\n        };\r\n        var VerticalModel = Object.freeze({\r\n            setValueFrom: setValueFrom$1,\r\n            setToMin: setToMin$1,\r\n            setToMax: setToMax$1,\r\n            findValueOfOffset: findValueOfOffset$1,\r\n            getValueFromEvent: getValueFromEvent$1,\r\n            findPositionOfValue: findPositionOfValue$1,\r\n            setPositionFromValue: setPositionFromValue$1,\r\n            onLeft: onLeft$1,\r\n            onRight: onRight$1,\r\n            onUp: onUp$1,\r\n            onDown: onDown$1,\r\n            edgeActions: edgeActions$1\r\n        });\r\n        var fireSliderChange$3 = function (spectrum, value) {\r\n            emitWith(spectrum, sliderChangeEvent(), { value: value });\r\n        };\r\n        var sliderValue$2 = function (x, y) {\r\n            return {\r\n                x: constant(x),\r\n                y: constant(y)\r\n            };\r\n        };\r\n        var setValueFrom$2 = function (spectrum, detail, value) {\r\n            var xValue = findValueOfOffset(spectrum, detail, value.left());\r\n            var yValue = findValueOfOffset$1(spectrum, detail, value.top());\r\n            var val = sliderValue$2(xValue, yValue);\r\n            fireSliderChange$3(spectrum, val);\r\n            return val;\r\n        };\r\n        var moveBy$2 = function (direction, isVerticalMovement, spectrum, detail) {\r\n            var f = direction > 0 ? increaseBy : reduceBy;\r\n            var xValue = isVerticalMovement ? currentValue(detail).x() : f(currentValue(detail).x(), minX(detail), maxX(detail), step(detail));\r\n            var yValue = !isVerticalMovement ? currentValue(detail).y() : f(currentValue(detail).y(), minY(detail), maxY(detail), step(detail));\r\n            fireSliderChange$3(spectrum, sliderValue$2(xValue, yValue));\r\n            return Option.some(xValue);\r\n        };\r\n        var handleMovement$2 = function (direction, isVerticalMovement) {\r\n            return function (spectrum, detail) {\r\n                return moveBy$2(direction, isVerticalMovement, spectrum, detail).map(function () {\r\n                    return true;\r\n                });\r\n            };\r\n        };\r\n        var setToMin$2 = function (spectrum, detail) {\r\n            var mX = minX(detail);\r\n            var mY = minY(detail);\r\n            fireSliderChange$3(spectrum, sliderValue$2(mX, mY));\r\n        };\r\n        var setToMax$2 = function (spectrum, detail) {\r\n            var mX = maxX(detail);\r\n            var mY = maxY(detail);\r\n            fireSliderChange$3(spectrum, sliderValue$2(mX, mY));\r\n        };\r\n        var getValueFromEvent$2 = function (simulatedEvent) {\r\n            return getEventSource(simulatedEvent);\r\n        };\r\n        var setPositionFromValue$2 = function (slider, thumb, detail, edges) {\r\n            var value = currentValue(detail);\r\n            var xPos = findPositionOfValue(slider, edges.getSpectrum(slider), value.x(), edges.getLeftEdge(slider), edges.getRightEdge(slider), detail);\r\n            var yPos = findPositionOfValue$1(slider, edges.getSpectrum(slider), value.y(), edges.getTopEdge(slider), edges.getBottomEdge(slider), detail);\r\n            var thumbXRadius = get$7(thumb.element()) / 2;\r\n            var thumbYRadius = get$8(thumb.element()) / 2;\r\n            set$2(thumb.element(), 'left', xPos - thumbXRadius + 'px');\r\n            set$2(thumb.element(), 'top', yPos - thumbYRadius + 'px');\r\n        };\r\n        var onLeft$2 = handleMovement$2(-1, false);\r\n        var onRight$2 = handleMovement$2(1, false);\r\n        var onUp$2 = handleMovement$2(-1, true);\r\n        var onDown$2 = handleMovement$2(1, true);\r\n        var edgeActions$2 = {\r\n            'top-left': Option.some(setToTLEdgeXY),\r\n            'top': Option.some(setToTEdgeXY),\r\n            'top-right': Option.some(setToTREdgeXY),\r\n            'right': Option.some(setToREdgeXY),\r\n            'bottom-right': Option.some(setToBREdgeXY),\r\n            'bottom': Option.some(setToBEdgeXY),\r\n            'bottom-left': Option.some(setToBLEdgeXY),\r\n            'left': Option.some(setToLEdgeXY)\r\n        };\r\n        var TwoDModel = Object.freeze({\r\n            setValueFrom: setValueFrom$2,\r\n            setToMin: setToMin$2,\r\n            setToMax: setToMax$2,\r\n            getValueFromEvent: getValueFromEvent$2,\r\n            setPositionFromValue: setPositionFromValue$2,\r\n            onLeft: onLeft$2,\r\n            onRight: onRight$2,\r\n            onUp: onUp$2,\r\n            onDown: onDown$2,\r\n            edgeActions: edgeActions$2\r\n        });\r\n        var isTouch$2 = PlatformDetection$1.detect().deviceType.isTouch();\r\n        var SliderSchema = [\r\n            defaulted$1('stepSize', 1),\r\n            defaulted$1('onChange', noop),\r\n            defaulted$1('onChoose', noop),\r\n            defaulted$1('onInit', noop),\r\n            defaulted$1('onDragStart', noop),\r\n            defaulted$1('onDragEnd', noop),\r\n            defaulted$1('snapToGrid', false),\r\n            defaulted$1('rounded', true),\r\n            option('snapStart'),\r\n            strictOf('model', choose$1('mode', {\r\n                x: [\r\n                    defaulted$1('minX', 0),\r\n                    defaulted$1('maxX', 100),\r\n                    state$1('value', function (spec) {\r\n                        return Cell(spec.mode.minX);\r\n                    }),\r\n                    strict$1('getInitialValue'),\r\n                    output('manager', HorizontalModel)\r\n                ],\r\n                y: [\r\n                    defaulted$1('minY', 0),\r\n                    defaulted$1('maxY', 100),\r\n                    state$1('value', function (spec) {\r\n                        return Cell(spec.mode.minY);\r\n                    }),\r\n                    strict$1('getInitialValue'),\r\n                    output('manager', VerticalModel)\r\n                ],\r\n                xy: [\r\n                    defaulted$1('minX', 0),\r\n                    defaulted$1('maxX', 100),\r\n                    defaulted$1('minY', 0),\r\n                    defaulted$1('maxY', 100),\r\n                    state$1('value', function (spec) {\r\n                        return Cell({\r\n                            x: constant(spec.mode.minX),\r\n                            y: constant(spec.mode.minY)\r\n                        });\r\n                    }),\r\n                    strict$1('getInitialValue'),\r\n                    output('manager', TwoDModel)\r\n                ]\r\n            })),\r\n            field$1('sliderBehaviours', [\r\n                Keying,\r\n                Representing\r\n            ])\r\n        ].concat(!isTouch$2 ? [state$1('mouseIsDown', function () {\r\n                return Cell(false);\r\n            })] : []);\r\n        var isTouch$3 = PlatformDetection$1.detect().deviceType.isTouch();\r\n        var sketch = function (detail, components, _spec, _externals) {\r\n            var getThumb = function (component) {\r\n                return getPartOrDie(component, detail, 'thumb');\r\n            };\r\n            var getSpectrum = function (component) {\r\n                return getPartOrDie(component, detail, 'spectrum');\r\n            };\r\n            var getLeftEdge = function (component) {\r\n                return getPart(component, detail, 'left-edge');\r\n            };\r\n            var getRightEdge = function (component) {\r\n                return getPart(component, detail, 'right-edge');\r\n            };\r\n            var getTopEdge = function (component) {\r\n                return getPart(component, detail, 'top-edge');\r\n            };\r\n            var getBottomEdge = function (component) {\r\n                return getPart(component, detail, 'bottom-edge');\r\n            };\r\n            var modelDetail = detail.model;\r\n            var model = modelDetail.manager;\r\n            var refresh = function (slider, thumb) {\r\n                model.setPositionFromValue(slider, thumb, detail, {\r\n                    getLeftEdge: getLeftEdge,\r\n                    getRightEdge: getRightEdge,\r\n                    getTopEdge: getTopEdge,\r\n                    getBottomEdge: getBottomEdge,\r\n                    getSpectrum: getSpectrum\r\n                });\r\n            };\r\n            var changeValue = function (slider, newValue) {\r\n                modelDetail.value.set(newValue);\r\n                var thumb = getThumb(slider);\r\n                refresh(slider, thumb);\r\n                detail.onChange(slider, thumb, newValue);\r\n                return Option.some(true);\r\n            };\r\n            var resetToMin = function (slider) {\r\n                model.setToMin(slider, detail);\r\n            };\r\n            var resetToMax = function (slider) {\r\n                model.setToMax(slider, detail);\r\n            };\r\n            var touchEvents = [\r\n                run(touchstart(), function (slider, _simulatedEvent) {\r\n                    detail.onDragStart(slider, getThumb(slider));\r\n                }),\r\n                run(touchend(), function (slider, _simulatedEvent) {\r\n                    detail.onDragEnd(slider, getThumb(slider));\r\n                })\r\n            ];\r\n            var mouseEvents = [\r\n                run(mousedown(), function (slider, simulatedEvent) {\r\n                    simulatedEvent.stop();\r\n                    detail.onDragStart(slider, getThumb(slider));\r\n                    detail.mouseIsDown.set(true);\r\n                }),\r\n                run(mouseup(), function (slider, _simulatedEvent) {\r\n                    detail.onDragEnd(slider, getThumb(slider));\r\n                })\r\n            ];\r\n            var uiEventsArr = isTouch$3 ? touchEvents : mouseEvents;\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                behaviours: augment(detail.sliderBehaviours, flatten([\r\n                    !isTouch$3 ? [Keying.config({\r\n                            mode: 'special',\r\n                            focusIn: function (slider) {\r\n                                return getPart(slider, detail, 'spectrum').map(Keying.focusIn).map(constant(true));\r\n                            }\r\n                        })] : [],\r\n                    [\r\n                        Representing.config({\r\n                            store: {\r\n                                mode: 'manual',\r\n                                getValue: function (_) {\r\n                                    return modelDetail.value.get();\r\n                                }\r\n                            }\r\n                        }),\r\n                        Receiving.config({\r\n                            channels: {\r\n                                'mouse.released': {\r\n                                    onReceive: function (slider, se) {\r\n                                        var wasDown = detail.mouseIsDown.get();\r\n                                        detail.mouseIsDown.set(false);\r\n                                        if (wasDown) {\r\n                                            getPart(slider, detail, 'thumb').each(function (thumb) {\r\n                                                var value = modelDetail.value.get();\r\n                                                detail.onChoose(slider, thumb, value);\r\n                                            });\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        })\r\n                    ]\r\n                ])),\r\n                events: derive([\r\n                    run(sliderChangeEvent(), function (slider, simulatedEvent) {\r\n                        changeValue(slider, simulatedEvent.event().value());\r\n                    }),\r\n                    runOnAttached(function (slider, simulatedEvent) {\r\n                        var getInitial = modelDetail.getInitialValue();\r\n                        modelDetail.value.set(getInitial);\r\n                        var thumb = getThumb(slider);\r\n                        refresh(slider, thumb);\r\n                        var spectrum = getSpectrum(slider);\r\n                        detail.onInit(slider, thumb, spectrum, modelDetail.value.get());\r\n                    })\r\n                ].concat(uiEventsArr)),\r\n                apis: {\r\n                    resetToMin: resetToMin,\r\n                    resetToMax: resetToMax,\r\n                    changeValue: changeValue,\r\n                    refresh: refresh\r\n                },\r\n                domModification: { styles: { position: 'relative' } }\r\n            };\r\n        };\r\n        var Slider = composite$1({\r\n            name: 'Slider',\r\n            configFields: SliderSchema,\r\n            partFields: SliderParts,\r\n            factory: sketch,\r\n            apis: {\r\n                resetToMin: function (apis, slider) {\r\n                    apis.resetToMin(slider);\r\n                },\r\n                resetToMax: function (apis, slider) {\r\n                    apis.resetToMax(slider);\r\n                },\r\n                refresh: function (apis, slider) {\r\n                    apis.refresh(slider);\r\n                }\r\n            }\r\n        });\r\n        var sliderFactory = function (translate, getClass) {\r\n            var spectrum = Slider.parts().spectrum({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [getClass('hue-slider-spectrum')],\r\n                    attributes: { role: 'presentation' }\r\n                }\r\n            });\r\n            var thumb = Slider.parts().thumb({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [getClass('hue-slider-thumb')],\r\n                    attributes: { role: 'presentation' }\r\n                }\r\n            });\r\n            return Slider.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [getClass('hue-slider')],\r\n                    attributes: { role: 'presentation' }\r\n                },\r\n                rounded: false,\r\n                model: {\r\n                    mode: 'y',\r\n                    getInitialValue: constant({ y: constant(0) })\r\n                },\r\n                components: [\r\n                    spectrum,\r\n                    thumb\r\n                ],\r\n                sliderBehaviours: derive$1([Focusing.config({})]),\r\n                onChange: function (slider, _thumb, value) {\r\n                    emitWith(slider, sliderUpdate(), { value: value });\r\n                }\r\n            });\r\n        };\r\n        var HueSlider = { sliderFactory: sliderFactory };\r\n        var owner$3 = 'form';\r\n        var schema$h = [field$1('formBehaviours', [Representing])];\r\n        var getPartName = function (name) {\r\n            return '<alloy.field.' + name + '>';\r\n        };\r\n        var sketch$1 = function (fSpec) {\r\n            var parts = function () {\r\n                var record = [];\r\n                var field = function (name, config) {\r\n                    record.push(name);\r\n                    return generateOne(owner$3, getPartName(name), config);\r\n                };\r\n                return {\r\n                    field: field,\r\n                    record: function () {\r\n                        return record;\r\n                    }\r\n                };\r\n            }();\r\n            var spec = fSpec(parts);\r\n            var partNames = parts.record();\r\n            var fieldParts = map(partNames, function (n) {\r\n                return required({\r\n                    name: n,\r\n                    pname: getPartName(n)\r\n                });\r\n            });\r\n            return composite(owner$3, schema$h, fieldParts, make$4, spec);\r\n        };\r\n        var toResult$1 = function (o, e) {\r\n            return o.fold(function () {\r\n                return Result.error(e);\r\n            }, Result.value);\r\n        };\r\n        var make$4 = function (detail, components, spec) {\r\n            return {\r\n                'uid': detail.uid,\r\n                'dom': detail.dom,\r\n                'components': components,\r\n                'behaviours': augment(detail.formBehaviours, [Representing.config({\r\n                        store: {\r\n                            mode: 'manual',\r\n                            getValue: function (form) {\r\n                                var resPs = getAllParts(form, detail);\r\n                                return map$1(resPs, function (resPThunk, pName) {\r\n                                    return resPThunk().bind(function (v) {\r\n                                        var opt = Composing.getCurrent(v);\r\n                                        return toResult$1(opt, 'missing current');\r\n                                    }).map(Representing.getValue);\r\n                                });\r\n                            },\r\n                            setValue: function (form, values) {\r\n                                each$1(values, function (newValue, key) {\r\n                                    getPart(form, detail, key).each(function (wrapper) {\r\n                                        Composing.getCurrent(wrapper).each(function (field) {\r\n                                            Representing.setValue(field, newValue);\r\n                                        });\r\n                                    });\r\n                                });\r\n                            }\r\n                        }\r\n                    })]),\r\n                'apis': {\r\n                    getField: function (form, key) {\r\n                        return getPart(form, detail, key).bind(Composing.getCurrent);\r\n                    }\r\n                }\r\n            };\r\n        };\r\n        var Form = {\r\n            getField: makeApi(function (apis, component, key) {\r\n                return apis.getField(component, key);\r\n            }),\r\n            sketch: sketch$1\r\n        };\r\n        var validInput = generate$1('valid-input');\r\n        var invalidInput = generate$1('invalid-input');\r\n        var validatingInput = generate$1('validating-input');\r\n        var translatePrefix = 'colorcustom.rgb.';\r\n        var rgbFormFactory = function (translate, getClass, onValidHexx, onInvalidHexx) {\r\n            var invalidation = function (label, isValid) {\r\n                return Invalidating.config({\r\n                    invalidClass: getClass('invalid'),\r\n                    notify: {\r\n                        onValidate: function (comp) {\r\n                            emitWith(comp, validatingInput, { type: label });\r\n                        },\r\n                        onValid: function (comp) {\r\n                            emitWith(comp, validInput, {\r\n                                type: label,\r\n                                value: Representing.getValue(comp)\r\n                            });\r\n                        },\r\n                        onInvalid: function (comp) {\r\n                            emitWith(comp, invalidInput, {\r\n                                type: label,\r\n                                value: Representing.getValue(comp)\r\n                            });\r\n                        }\r\n                    },\r\n                    validator: {\r\n                        validate: function (comp) {\r\n                            var value = Representing.getValue(comp);\r\n                            var res = isValid(value) ? Result.value(true) : Result.error(translate('aria.input.invalid'));\r\n                            return Future.pure(res);\r\n                        },\r\n                        validateOnLoad: false\r\n                    }\r\n                });\r\n            };\r\n            var renderTextField = function (isValid, name, label, description, data) {\r\n                var helptext = translate(translatePrefix + 'range');\r\n                var pLabel = FormField.parts().label({\r\n                    dom: {\r\n                        tag: 'label',\r\n                        innerHtml: label,\r\n                        attributes: { 'aria-label': description }\r\n                    }\r\n                });\r\n                var pField = FormField.parts().field({\r\n                    data: data,\r\n                    factory: Input,\r\n                    inputAttributes: __assign({ type: 'text' }, name === 'hex' ? { 'aria-live': 'polite' } : {}),\r\n                    inputClasses: [getClass('textfield')],\r\n                    inputBehaviours: derive$1([\r\n                        invalidation(name, isValid),\r\n                        Tabstopping.config({})\r\n                    ]),\r\n                    onSetValue: function (input) {\r\n                        if (Invalidating.isInvalid(input)) {\r\n                            var run = Invalidating.run(input);\r\n                            run.get(noop);\r\n                        }\r\n                    }\r\n                });\r\n                var comps = [\r\n                    pLabel,\r\n                    pField\r\n                ];\r\n                var concats = name !== 'hex' ? [FormField.parts()['aria-descriptor']({ text: helptext })] : [];\r\n                var components = comps.concat(concats);\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        attributes: { role: 'presentation' }\r\n                    },\r\n                    components: components\r\n                };\r\n            };\r\n            var copyRgbToHex = function (form, rgba) {\r\n                var hex = fromRgba(rgba);\r\n                Form.getField(form, 'hex').each(function (hexField) {\r\n                    if (!Focusing.isFocused(hexField)) {\r\n                        Representing.setValue(form, { hex: hex.value() });\r\n                    }\r\n                });\r\n                return hex;\r\n            };\r\n            var copyRgbToForm = function (form, rgb) {\r\n                var red = rgb.red();\r\n                var green = rgb.green();\r\n                var blue = rgb.blue();\r\n                Representing.setValue(form, {\r\n                    red: red,\r\n                    green: green,\r\n                    blue: blue\r\n                });\r\n            };\r\n            var memPreview = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [getClass('rgba-preview')],\r\n                    styles: { 'background-color': 'white' },\r\n                    attributes: { role: 'presentation' }\r\n                }\r\n            });\r\n            var updatePreview = function (anyInSystem, hex) {\r\n                memPreview.getOpt(anyInSystem).each(function (preview) {\r\n                    set$2(preview.element(), 'background-color', '#' + hex.value());\r\n                });\r\n            };\r\n            var factory = function () {\r\n                var state = {\r\n                    red: constant(Cell(Option.some(255))),\r\n                    green: constant(Cell(Option.some(255))),\r\n                    blue: constant(Cell(Option.some(255))),\r\n                    hex: constant(Cell(Option.some('ffffff')))\r\n                };\r\n                var copyHexToRgb = function (form, hex) {\r\n                    var rgb = fromHex(hex);\r\n                    copyRgbToForm(form, rgb);\r\n                    setValueRgb(rgb);\r\n                };\r\n                var get = function (prop) {\r\n                    return state[prop]().get();\r\n                };\r\n                var set = function (prop, value) {\r\n                    state[prop]().set(value);\r\n                };\r\n                var getValueRgb = function () {\r\n                    return get('red').bind(function (red) {\r\n                        return get('green').bind(function (green) {\r\n                            return get('blue').map(function (blue) {\r\n                                return rgbaColour(red, green, blue, 1);\r\n                            });\r\n                        });\r\n                    });\r\n                };\r\n                var setValueRgb = function (rgb) {\r\n                    var red = rgb.red();\r\n                    var green = rgb.green();\r\n                    var blue = rgb.blue();\r\n                    set('red', Option.some(red));\r\n                    set('green', Option.some(green));\r\n                    set('blue', Option.some(blue));\r\n                };\r\n                var onInvalidInput = function (form, simulatedEvent) {\r\n                    var data = simulatedEvent.event();\r\n                    if (data.type() !== 'hex') {\r\n                        set(data.type(), Option.none());\r\n                    }\r\n                    else {\r\n                        onInvalidHexx(form);\r\n                    }\r\n                };\r\n                var onValidHex = function (form, value) {\r\n                    onValidHexx(form);\r\n                    var hex = hexColour(value);\r\n                    set('hex', Option.some(value));\r\n                    var rgb = fromHex(hex);\r\n                    copyRgbToForm(form, rgb);\r\n                    setValueRgb(rgb);\r\n                    emitWith(form, fieldsUpdate(), { hex: hex });\r\n                    updatePreview(form, hex);\r\n                };\r\n                var onValidRgb = function (form, prop, value) {\r\n                    var val = parseInt(value, 10);\r\n                    set(prop, Option.some(val));\r\n                    getValueRgb().each(function (rgb) {\r\n                        var hex = copyRgbToHex(form, rgb);\r\n                        updatePreview(form, hex);\r\n                    });\r\n                };\r\n                var isHexInputEvent = function (data) {\r\n                    return data.type() === 'hex';\r\n                };\r\n                var onValidInput = function (form, simulatedEvent) {\r\n                    var data = simulatedEvent.event();\r\n                    if (isHexInputEvent(data)) {\r\n                        onValidHex(form, data.value());\r\n                    }\r\n                    else {\r\n                        onValidRgb(form, data.type(), data.value());\r\n                    }\r\n                };\r\n                var formPartStrings = function (key) {\r\n                    return {\r\n                        label: translate(translatePrefix + key + '.label'),\r\n                        description: translate(translatePrefix + key + '.description')\r\n                    };\r\n                };\r\n                var redStrings = formPartStrings('red');\r\n                var greenStrings = formPartStrings('green');\r\n                var blueStrings = formPartStrings('blue');\r\n                var hexStrings = formPartStrings('hex');\r\n                return deepMerge(Form.sketch(function (parts) {\r\n                    return {\r\n                        dom: {\r\n                            tag: 'form',\r\n                            classes: [getClass('rgb-form')],\r\n                            attributes: { 'aria-label': translate('aria.color.picker') }\r\n                        },\r\n                        components: [\r\n                            parts.field('red', FormField.sketch(renderTextField(isRgbaComponent, 'red', redStrings.label, redStrings.description, 255))),\r\n                            parts.field('green', FormField.sketch(renderTextField(isRgbaComponent, 'green', greenStrings.label, greenStrings.description, 255))),\r\n                            parts.field('blue', FormField.sketch(renderTextField(isRgbaComponent, 'blue', blueStrings.label, blueStrings.description, 255))),\r\n                            parts.field('hex', FormField.sketch(renderTextField(isHexString, 'hex', hexStrings.label, hexStrings.description, 'ffffff'))),\r\n                            memPreview.asSpec()\r\n                        ],\r\n                        formBehaviours: derive$1([\r\n                            Invalidating.config({ invalidClass: getClass('form-invalid') }),\r\n                            config('rgb-form-events', [\r\n                                run(validInput, onValidInput),\r\n                                run(invalidInput, onInvalidInput),\r\n                                run(validatingInput, onInvalidInput)\r\n                            ])\r\n                        ])\r\n                    };\r\n                }), {\r\n                    apis: {\r\n                        updateHex: function (form, hex) {\r\n                            Representing.setValue(form, { hex: hex.value() });\r\n                            copyHexToRgb(form, hex);\r\n                            updatePreview(form, hex);\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n            var rgbFormSketcher = single$2({\r\n                factory: factory,\r\n                name: 'RgbForm',\r\n                configFields: [],\r\n                apis: {\r\n                    updateHex: function (apis, form, hex) {\r\n                        apis.updateHex(form, hex);\r\n                    }\r\n                },\r\n                extraApis: {}\r\n            });\r\n            return rgbFormSketcher;\r\n        };\r\n        var RgbForm = { rgbFormFactory: rgbFormFactory };\r\n        var paletteFactory = function (_translate, getClass) {\r\n            var spectrumPart = Slider.parts().spectrum({\r\n                dom: {\r\n                    tag: 'canvas',\r\n                    attributes: { role: 'presentation' },\r\n                    classes: [getClass('sv-palette-spectrum')]\r\n                }\r\n            });\r\n            var thumbPart = Slider.parts().thumb({\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { role: 'presentation' },\r\n                    classes: [getClass('sv-palette-thumb')],\r\n                    innerHtml: '<div class=' + getClass('sv-palette-inner-thumb') + ' role=\"presentation\"></div>'\r\n                }\r\n            });\r\n            var setColour = function (canvas, rgba) {\r\n                var width = canvas.width, height = canvas.height;\r\n                var ctx = canvas.getContext('2d');\r\n                if (ctx === null) {\r\n                    return;\r\n                }\r\n                ctx.fillStyle = rgba;\r\n                ctx.fillRect(0, 0, width, height);\r\n                var grdWhite = ctx.createLinearGradient(0, 0, width, 0);\r\n                grdWhite.addColorStop(0, 'rgba(255,255,255,1)');\r\n                grdWhite.addColorStop(1, 'rgba(255,255,255,0)');\r\n                ctx.fillStyle = grdWhite;\r\n                ctx.fillRect(0, 0, width, height);\r\n                var grdBlack = ctx.createLinearGradient(0, 0, 0, height);\r\n                grdBlack.addColorStop(0, 'rgba(0,0,0,0)');\r\n                grdBlack.addColorStop(1, 'rgba(0,0,0,1)');\r\n                ctx.fillStyle = grdBlack;\r\n                ctx.fillRect(0, 0, width, height);\r\n            };\r\n            var setSliderColour = function (slider, rgba) {\r\n                var canvas = slider.components()[0].element().dom();\r\n                setColour(canvas, toString(rgba));\r\n            };\r\n            var factory = function (_detail) {\r\n                var getInitialValue = constant({\r\n                    x: constant(0),\r\n                    y: constant(0)\r\n                });\r\n                var onChange = function (slider, _thumb, value) {\r\n                    emitWith(slider, paletteUpdate(), { value: value });\r\n                };\r\n                var onInit = function (_slider, _thumb, spectrum, _value) {\r\n                    setColour(spectrum.element().dom(), toString(redColour()));\r\n                };\r\n                var sliderBehaviours = derive$1([\r\n                    Composing.config({ find: Option.some }),\r\n                    Focusing.config({})\r\n                ]);\r\n                return Slider.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        attributes: { role: 'presentation' },\r\n                        classes: [getClass('sv-palette')]\r\n                    },\r\n                    model: {\r\n                        mode: 'xy',\r\n                        getInitialValue: getInitialValue\r\n                    },\r\n                    rounded: false,\r\n                    components: [\r\n                        spectrumPart,\r\n                        thumbPart\r\n                    ],\r\n                    onChange: onChange,\r\n                    onInit: onInit,\r\n                    sliderBehaviours: sliderBehaviours\r\n                });\r\n            };\r\n            var saturationBrightnessPaletteSketcher = single$2({\r\n                factory: factory,\r\n                name: 'SaturationBrightnessPalette',\r\n                configFields: [],\r\n                apis: {\r\n                    setRgba: function (_apis, slider, rgba) {\r\n                        setSliderColour(slider, rgba);\r\n                    }\r\n                },\r\n                extraApis: {}\r\n            });\r\n            return saturationBrightnessPaletteSketcher;\r\n        };\r\n        var SaturationBrightnessPalette = { paletteFactory: paletteFactory };\r\n        var makeFactory = function (translate, getClass) {\r\n            var factory = function (detail) {\r\n                var rgbForm = RgbForm.rgbFormFactory(translate, getClass, detail.onValidHex, detail.onInvalidHex);\r\n                var sbPalette = SaturationBrightnessPalette.paletteFactory(translate, getClass);\r\n                var state = { paletteRgba: constant(Cell(redColour())) };\r\n                var memPalette = record(sbPalette.sketch({}));\r\n                var memRgb = record(rgbForm.sketch({}));\r\n                var updatePalette = function (anyInSystem, hex) {\r\n                    memPalette.getOpt(anyInSystem).each(function (palette) {\r\n                        var rgba = fromHex(hex);\r\n                        state.paletteRgba().set(rgba);\r\n                        sbPalette.setRgba(palette, rgba);\r\n                    });\r\n                };\r\n                var updateFields = function (anyInSystem, hex) {\r\n                    memRgb.getOpt(anyInSystem).each(function (form) {\r\n                        rgbForm.updateHex(form, hex);\r\n                    });\r\n                };\r\n                var runUpdates = function (anyInSystem, hex, updates) {\r\n                    each(updates, function (update) {\r\n                        update(anyInSystem, hex);\r\n                    });\r\n                };\r\n                var paletteUpdates = function () {\r\n                    var updates = [updateFields];\r\n                    return function (form, simulatedEvent) {\r\n                        var value = simulatedEvent.event().value();\r\n                        var oldRgb = state.paletteRgba().get();\r\n                        var hsvColour$1 = fromRgb(oldRgb);\r\n                        var newHsvColour = hsvColour(hsvColour$1.hue(), value.x(), 100 - value.y());\r\n                        var rgb = fromHsv(newHsvColour);\r\n                        var nuHex = fromRgba(rgb);\r\n                        runUpdates(form, nuHex, updates);\r\n                    };\r\n                };\r\n                var sliderUpdates = function () {\r\n                    var updates = [\r\n                        updatePalette,\r\n                        updateFields\r\n                    ];\r\n                    return function (form, simulatedEvent) {\r\n                        var value = simulatedEvent.event().value();\r\n                        var hex = calcHex(value.y());\r\n                        runUpdates(form, hex, updates);\r\n                    };\r\n                };\r\n                return {\r\n                    uid: detail.uid,\r\n                    dom: detail.dom,\r\n                    components: [\r\n                        memPalette.asSpec(),\r\n                        HueSlider.sliderFactory(translate, getClass),\r\n                        memRgb.asSpec()\r\n                    ],\r\n                    behaviours: derive$1([\r\n                        config('colour-picker-events', [\r\n                            run(paletteUpdate(), paletteUpdates()),\r\n                            run(sliderUpdate(), sliderUpdates())\r\n                        ]),\r\n                        Composing.config({\r\n                            find: function (comp) {\r\n                                return memRgb.getOpt(comp);\r\n                            }\r\n                        }),\r\n                        Keying.config({ mode: 'acyclic' })\r\n                    ])\r\n                };\r\n            };\r\n            var colourPickerSketcher = single$2({\r\n                name: 'ColourPicker',\r\n                configFields: [\r\n                    strict$1('dom'),\r\n                    defaulted$1('onValidHex', noop),\r\n                    defaulted$1('onInvalidHex', noop)\r\n                ],\r\n                factory: factory\r\n            });\r\n            return colourPickerSketcher;\r\n        };\r\n        var ColourPicker = { makeFactory: makeFactory };\r\n        var self = function () {\r\n            return Composing.config({ find: Option.some });\r\n        };\r\n        var memento = function (mem) {\r\n            return Composing.config({ find: mem.getOpt });\r\n        };\r\n        var childAt = function (index) {\r\n            return Composing.config({\r\n                find: function (comp) {\r\n                    return child(comp.element(), index).bind(function (element) {\r\n                        return comp.getSystem().getByDom(element).toOption();\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        var ComposingConfigs = {\r\n            self: self,\r\n            memento: memento,\r\n            childAt: childAt\r\n        };\r\n        var english = {\r\n            'colorcustom.rgb.red.label': 'R',\r\n            'colorcustom.rgb.red.description': 'Red component',\r\n            'colorcustom.rgb.green.label': 'G',\r\n            'colorcustom.rgb.green.description': 'Green component',\r\n            'colorcustom.rgb.blue.label': 'B',\r\n            'colorcustom.rgb.blue.description': 'Blue component',\r\n            'colorcustom.rgb.hex.label': '#',\r\n            'colorcustom.rgb.hex.description': 'Hex color code',\r\n            'colorcustom.rgb.range': 'Range 0 to 255',\r\n            'colorcustom.sb.saturation': 'Saturation',\r\n            'colorcustom.sb.brightness': 'Brightness',\r\n            'colorcustom.sb.picker': 'Saturation and Brightness Picker',\r\n            'colorcustom.sb.palette': 'Saturation and Brightness Palette',\r\n            'colorcustom.sb.instructions': 'Use arrow keys to select saturation and brightness, on x and y axes',\r\n            'colorcustom.hue.hue': 'Hue',\r\n            'colorcustom.hue.slider': 'Hue Slider',\r\n            'colorcustom.hue.palette': 'Hue Palette',\r\n            'colorcustom.hue.instructions': 'Use arrow keys to select a hue',\r\n            'aria.color.picker': 'Color Picker',\r\n            'aria.input.invalid': 'Invalid input'\r\n        };\r\n        var getEnglishText = function (key) {\r\n            return english[key];\r\n        };\r\n        var translate = function (key) {\r\n            return getEnglishText(key);\r\n        };\r\n        var renderColorPicker = function (spec) {\r\n            var getClass = function (key) {\r\n                return 'tox-' + key;\r\n            };\r\n            var colourPickerFactory = ColourPicker.makeFactory(translate, getClass);\r\n            var onValidHex = function (form) {\r\n                emitWith(form, formActionEvent, {\r\n                    name: 'hex-valid',\r\n                    value: true\r\n                });\r\n            };\r\n            var onInvalidHex = function (form) {\r\n                emitWith(form, formActionEvent, {\r\n                    name: 'hex-valid',\r\n                    value: false\r\n                });\r\n            };\r\n            var memPicker = record(colourPickerFactory.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [getClass('color-picker-container')],\r\n                    attributes: { role: 'presentation' }\r\n                },\r\n                onValidHex: onValidHex,\r\n                onInvalidHex: onInvalidHex\r\n            }));\r\n            return {\r\n                dom: { tag: 'div' },\r\n                components: [memPicker.asSpec()],\r\n                behaviours: derive$1([\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'manual',\r\n                            getValue: function (comp) {\r\n                                var picker = memPicker.get(comp);\r\n                                var optRgbForm = Composing.getCurrent(picker);\r\n                                var optHex = optRgbForm.bind(function (rgbForm) {\r\n                                    var formValues = Representing.getValue(rgbForm);\r\n                                    return formValues.hex;\r\n                                });\r\n                                return optHex.map(function (hex) {\r\n                                    return '#' + hex;\r\n                                }).getOr('');\r\n                            },\r\n                            setValue: function (comp, newValue) {\r\n                                var pattern = /^#([a-fA-F0-9]{3}(?:[a-fA-F0-9]{3})?)/;\r\n                                var m = pattern.exec(newValue);\r\n                                var picker = memPicker.get(comp);\r\n                                var optRgbForm = Composing.getCurrent(picker);\r\n                                optRgbForm.fold(function () {\r\n                                    domGlobals.console.log('Can not find form');\r\n                                }, function (rgbForm) {\r\n                                    Representing.setValue(rgbForm, { hex: Option.from(m[1]).getOr('') });\r\n                                    Form.getField(rgbForm, 'hex').each(function (hexField) {\r\n                                        emit(hexField, input());\r\n                                    });\r\n                                });\r\n                            }\r\n                        }\r\n                    }),\r\n                    ComposingConfigs.self()\r\n                ])\r\n            };\r\n        };\r\n        var renderCustomEditor = function (spec) {\r\n            var editorApi = Cell(Option.none());\r\n            var memReplaced = record({ dom: { tag: spec.tag } });\r\n            var initialValue = Cell(Option.none());\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-custom-editor']\r\n                },\r\n                behaviours: derive$1([\r\n                    config('editor-foo-events', [runOnAttached(function (component) {\r\n                            memReplaced.getOpt(component).each(function (ta) {\r\n                                spec.init(ta.element().dom()).then(function (ea) {\r\n                                    initialValue.get().each(function (cvalue) {\r\n                                        ea.setValue(cvalue);\r\n                                    });\r\n                                    initialValue.set(Option.none());\r\n                                    editorApi.set(Option.some(ea));\r\n                                });\r\n                            });\r\n                        })]),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'manual',\r\n                            getValue: function () {\r\n                                return editorApi.get().fold(function () {\r\n                                    return initialValue.get().getOr('');\r\n                                }, function (ed) {\r\n                                    return ed.getValue();\r\n                                });\r\n                            },\r\n                            setValue: function (component, value) {\r\n                                editorApi.get().fold(function () {\r\n                                    initialValue.set(Option.some(value));\r\n                                }, function (ed) {\r\n                                    return ed.setValue(value);\r\n                                });\r\n                            }\r\n                        }\r\n                    }),\r\n                    ComposingConfigs.self()\r\n                ]),\r\n                components: [memReplaced.asSpec()]\r\n            };\r\n        };\r\n        var processors = objOf([\r\n            defaulted$1('preprocess', identity),\r\n            defaulted$1('postprocess', identity)\r\n        ]);\r\n        var memento$1 = function (mem, rawProcessors) {\r\n            var ps = asRawOrDie('RepresentingConfigs.memento processors', processors, rawProcessors);\r\n            return Representing.config({\r\n                store: {\r\n                    mode: 'manual',\r\n                    getValue: function (comp) {\r\n                        var other = mem.get(comp);\r\n                        var rawValue = Representing.getValue(other);\r\n                        return ps.postprocess(rawValue);\r\n                    },\r\n                    setValue: function (comp, rawValue) {\r\n                        var newValue = ps.preprocess(rawValue);\r\n                        var other = mem.get(comp);\r\n                        Representing.setValue(other, newValue);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        var withComp = function (optInitialValue, getter, setter) {\r\n            return Representing.config(deepMerge({\r\n                store: {\r\n                    mode: 'manual',\r\n                    getValue: getter,\r\n                    setValue: setter\r\n                }\r\n            }, optInitialValue.map(function (initialValue) {\r\n                return { store: { initialValue: initialValue } };\r\n            }).getOr({})));\r\n        };\r\n        var withElement = function (initialValue, getter, setter) {\r\n            return withComp(initialValue, function (c) {\r\n                return getter(c.element());\r\n            }, function (c, v) {\r\n                return setter(c.element(), v);\r\n            });\r\n        };\r\n        var domValue = function (optInitialValue) {\r\n            return withElement(optInitialValue, get$5, set$3);\r\n        };\r\n        var domHtml = function (optInitialValue) {\r\n            return withElement(optInitialValue, get$1, set);\r\n        };\r\n        var memory$1 = function (initialValue) {\r\n            return Representing.config({\r\n                store: {\r\n                    mode: 'memory',\r\n                    initialValue: initialValue\r\n                }\r\n            });\r\n        };\r\n        var RepresentingConfigs = {\r\n            memento: memento$1,\r\n            withElement: withElement,\r\n            withComp: withComp,\r\n            domValue: domValue,\r\n            domHtml: domHtml,\r\n            memory: memory$1\r\n        };\r\n        var extensionsAccepted = '.jpg,.jpeg,.png,.gif';\r\n        var filterByExtension = function (files) {\r\n            var re = new RegExp('(' + extensionsAccepted.split(/\\s*,\\s*/).join('|') + ')$', 'i');\r\n            return filter(from$1(files), function (file) {\r\n                return re.test(file.name);\r\n            });\r\n        };\r\n        var renderDropZone = function (spec, providersBackstage) {\r\n            var stopper = function (_, se) {\r\n                se.stop();\r\n            };\r\n            var sequence = function (actions) {\r\n                return function (comp, se) {\r\n                    each(actions, function (a) {\r\n                        a(comp, se);\r\n                    });\r\n                };\r\n            };\r\n            var onDrop = function (comp, se) {\r\n                if (!Disabling.isDisabled(comp)) {\r\n                    var transferEvent = se.event().raw();\r\n                    handleFiles(comp, transferEvent.dataTransfer.files);\r\n                }\r\n            };\r\n            var onSelect = function (component, simulatedEvent) {\r\n                var files = simulatedEvent.event().raw().target.files;\r\n                handleFiles(component, files);\r\n            };\r\n            var handleFiles = function (component, files) {\r\n                Representing.setValue(component, filterByExtension(files));\r\n                emitWith(component, formChangeEvent, { name: spec.name });\r\n            };\r\n            var memInput = record({\r\n                dom: {\r\n                    tag: 'input',\r\n                    attributes: {\r\n                        type: 'file',\r\n                        accept: 'image/*'\r\n                    },\r\n                    styles: { display: 'none' }\r\n                },\r\n                behaviours: derive$1([config('input-file-events', [cutter(tapOrClick())])])\r\n            });\r\n            var renderField = function (s) {\r\n                return {\r\n                    uid: s.uid,\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-dropzone-container']\r\n                    },\r\n                    behaviours: derive$1([\r\n                        RepresentingConfigs.memory([]),\r\n                        ComposingConfigs.self(),\r\n                        Disabling.config({}),\r\n                        Toggling.config({\r\n                            toggleClass: 'dragenter',\r\n                            toggleOnExecute: false\r\n                        }),\r\n                        config('dropzone-events', [\r\n                            run('dragenter', sequence([\r\n                                stopper,\r\n                                Toggling.toggle\r\n                            ])),\r\n                            run('dragleave', sequence([\r\n                                stopper,\r\n                                Toggling.toggle\r\n                            ])),\r\n                            run('dragover', stopper),\r\n                            run('drop', sequence([\r\n                                stopper,\r\n                                onDrop\r\n                            ])),\r\n                            run(change(), onSelect)\r\n                        ])\r\n                    ]),\r\n                    components: [{\r\n                            dom: {\r\n                                tag: 'div',\r\n                                classes: ['tox-dropzone'],\r\n                                styles: {}\r\n                            },\r\n                            components: [\r\n                                {\r\n                                    dom: {\r\n                                        tag: 'p',\r\n                                        innerHtml: providersBackstage.translate('Drop an image here')\r\n                                    }\r\n                                },\r\n                                Button.sketch({\r\n                                    dom: {\r\n                                        tag: 'button',\r\n                                        innerHtml: providersBackstage.translate('Browse for an image'),\r\n                                        styles: { position: 'relative' },\r\n                                        classes: [\r\n                                            'tox-button',\r\n                                            'tox-button--secondary'\r\n                                        ]\r\n                                    },\r\n                                    components: [memInput.asSpec()],\r\n                                    action: function (comp) {\r\n                                        var inputComp = memInput.get(comp);\r\n                                        inputComp.element().dom().click();\r\n                                    },\r\n                                    buttonBehaviours: derive$1([Tabstopping.config({})])\r\n                                })\r\n                            ]\r\n                        }]\r\n                };\r\n            };\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, providersBackstage);\r\n            });\r\n            var pField = FormField.parts().field({ factory: { sketch: renderField } });\r\n            return renderFormFieldWith(pLabel, pField, ['tox-form__group--stretched']);\r\n        };\r\n        var renderGrid = function (spec, backstage) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox-form__grid',\r\n                        'tox-form__grid--' + spec.columns + 'col'\r\n                    ]\r\n                },\r\n                components: map(spec.items, backstage.interpreter)\r\n            };\r\n        };\r\n        var beforeObject = generate$1('alloy-fake-before-tabstop');\r\n        var afterObject = generate$1('alloy-fake-after-tabstop');\r\n        var craftWithClasses = function (classes) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    styles: {\r\n                        width: '1px',\r\n                        height: '1px',\r\n                        outline: 'none'\r\n                    },\r\n                    attributes: { tabindex: '0' },\r\n                    classes: classes\r\n                },\r\n                behaviours: derive$1([\r\n                    Focusing.config({ ignore: true }),\r\n                    Tabstopping.config({})\r\n                ])\r\n            };\r\n        };\r\n        var craft = function (spec) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-navobj']\r\n                },\r\n                components: [\r\n                    craftWithClasses([beforeObject]),\r\n                    spec,\r\n                    craftWithClasses([afterObject])\r\n                ],\r\n                behaviours: derive$1([ComposingConfigs.childAt(1)])\r\n            };\r\n        };\r\n        var triggerTab = function (placeholder, shiftKey) {\r\n            emitWith(placeholder, keydown(), {\r\n                raw: {\r\n                    which: 9,\r\n                    shiftKey: shiftKey\r\n                }\r\n            });\r\n        };\r\n        var onFocus$1 = function (container, targetComp) {\r\n            var target = targetComp.element();\r\n            if (has$2(target, beforeObject)) {\r\n                triggerTab(container, true);\r\n            }\r\n            else if (has$2(target, afterObject)) {\r\n                triggerTab(container, false);\r\n            }\r\n        };\r\n        var isPseudoStop = function (element) {\r\n            return closest$4(element, [\r\n                '.' + beforeObject,\r\n                '.' + afterObject\r\n            ].join(','), constant(false));\r\n        };\r\n        var NavigableObject = {\r\n            isPseudoStop: isPseudoStop,\r\n            onFocus: onFocus$1,\r\n            craft: craft\r\n        };\r\n        var platformNeedsSandboxing = !(PlatformDetection$1.detect().browser.isIE() || PlatformDetection$1.detect().browser.isEdge());\r\n        var getDynamicSource = function (isSandbox) {\r\n            var cachedValue = Cell('');\r\n            return {\r\n                getValue: function (frameComponent) {\r\n                    return cachedValue.get();\r\n                },\r\n                setValue: function (frameComponent, html) {\r\n                    if (!isSandbox) {\r\n                        set$1(frameComponent.element(), 'src', 'javascript:\\'\\'');\r\n                        var doc = frameComponent.element().dom().contentWindow.document;\r\n                        doc.open();\r\n                        doc.write(html);\r\n                        doc.close();\r\n                    }\r\n                    else {\r\n                        set$1(frameComponent.element(), 'src', 'data:text/html;charset=utf-8,' + encodeURIComponent(html));\r\n                    }\r\n                    cachedValue.set(html);\r\n                }\r\n            };\r\n        };\r\n        var renderIFrame = function (spec, providersBackstage) {\r\n            var isSandbox = platformNeedsSandboxing && spec.sandboxed;\r\n            var attributes = __assign({}, spec.label.map(function (title) {\r\n                return { title: title };\r\n            }).getOr({}), isSandbox ? { sandbox: 'allow-scripts allow-same-origin' } : {});\r\n            var sourcing = getDynamicSource(isSandbox);\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, providersBackstage);\r\n            });\r\n            var factory = function (newSpec) {\r\n                return NavigableObject.craft({\r\n                    uid: newSpec.uid,\r\n                    dom: {\r\n                        tag: 'iframe',\r\n                        attributes: attributes\r\n                    },\r\n                    behaviours: derive$1([\r\n                        Tabstopping.config({}),\r\n                        Focusing.config({}),\r\n                        RepresentingConfigs.withComp(Option.none(), sourcing.getValue, sourcing.setValue)\r\n                    ])\r\n                });\r\n            };\r\n            var pField = FormField.parts().field({ factory: { sketch: factory } });\r\n            return renderFormFieldWith(pLabel, pField, ['tox-form__group--stretched']);\r\n        };\r\n        function create$3(width, height) {\r\n            return resize(domGlobals.document.createElement('canvas'), width, height);\r\n        }\r\n        function clone$1(canvas) {\r\n            var tCanvas = create$3(canvas.width, canvas.height);\r\n            var ctx = get2dContext(tCanvas);\r\n            ctx.drawImage(canvas, 0, 0);\r\n            return tCanvas;\r\n        }\r\n        function get2dContext(canvas) {\r\n            return canvas.getContext('2d');\r\n        }\r\n        function resize(canvas, width, height) {\r\n            canvas.width = width;\r\n            canvas.height = height;\r\n            return canvas;\r\n        }\r\n        function SandBlob(parts, properties) {\r\n            var f = Global$1.getOrDie('Blob');\r\n            return new f(parts, properties);\r\n        }\r\n        function FileReader() {\r\n            var f = Global$1.getOrDie('FileReader');\r\n            return new f();\r\n        }\r\n        function Uint8Array(arr) {\r\n            var f = Global$1.getOrDie('Uint8Array');\r\n            return new f(arr);\r\n        }\r\n        var requestAnimationFrame = function (callback) {\r\n            var f = Global$1.getOrDie('requestAnimationFrame');\r\n            f(callback);\r\n        };\r\n        var atob = function (base64) {\r\n            var f = Global$1.getOrDie('atob');\r\n            return f(base64);\r\n        };\r\n        var Window = {\r\n            atob: atob,\r\n            requestAnimationFrame: requestAnimationFrame\r\n        };\r\n        function getWidth(image) {\r\n            return image.naturalWidth || image.width;\r\n        }\r\n        function getHeight(image) {\r\n            return image.naturalHeight || image.height;\r\n        }\r\n        var promise = function () {\r\n            var Promise = function (fn) {\r\n                if (typeof this !== 'object') {\r\n                    throw new TypeError('Promises must be constructed via new');\r\n                }\r\n                if (typeof fn !== 'function') {\r\n                    throw new TypeError('not a function');\r\n                }\r\n                this._state = null;\r\n                this._value = null;\r\n                this._deferreds = [];\r\n                doResolve(fn, bind(resolve, this), bind(reject, this));\r\n            };\r\n            var asap = Promise.immediateFn || typeof window.setImmediate === 'function' && window.setImmediate || function (fn) {\r\n                domGlobals.setTimeout(fn, 1);\r\n            };\r\n            function bind(fn, thisArg) {\r\n                return function () {\r\n                    return fn.apply(thisArg, arguments);\r\n                };\r\n            }\r\n            var isArray = Array.isArray || function (value) {\r\n                return Object.prototype.toString.call(value) === '[object Array]';\r\n            };\r\n            function handle(deferred) {\r\n                var me = this;\r\n                if (this._state === null) {\r\n                    this._deferreds.push(deferred);\r\n                    return;\r\n                }\r\n                asap(function () {\r\n                    var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\r\n                    if (cb === null) {\r\n                        (me._state ? deferred.resolve : deferred.reject)(me._value);\r\n                        return;\r\n                    }\r\n                    var ret;\r\n                    try {\r\n                        ret = cb(me._value);\r\n                    }\r\n                    catch (e) {\r\n                        deferred.reject(e);\r\n                        return;\r\n                    }\r\n                    deferred.resolve(ret);\r\n                });\r\n            }\r\n            function resolve(newValue) {\r\n                try {\r\n                    if (newValue === this) {\r\n                        throw new TypeError('A promise cannot be resolved with itself.');\r\n                    }\r\n                    if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\r\n                        var then = newValue.then;\r\n                        if (typeof then === 'function') {\r\n                            doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\r\n                            return;\r\n                        }\r\n                    }\r\n                    this._state = true;\r\n                    this._value = newValue;\r\n                    finale.call(this);\r\n                }\r\n                catch (e) {\r\n                    reject.call(this, e);\r\n                }\r\n            }\r\n            function reject(newValue) {\r\n                this._state = false;\r\n                this._value = newValue;\r\n                finale.call(this);\r\n            }\r\n            function finale() {\r\n                for (var _i = 0, _a = this._deferreds; _i < _a.length; _i++) {\r\n                    var deferred = _a[_i];\r\n                    handle.call(this, deferred);\r\n                }\r\n                this._deferreds = [];\r\n            }\r\n            function Handler(onFulfilled, onRejected, resolve, reject) {\r\n                this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\r\n                this.onRejected = typeof onRejected === 'function' ? onRejected : null;\r\n                this.resolve = resolve;\r\n                this.reject = reject;\r\n            }\r\n            function doResolve(fn, onFulfilled, onRejected) {\r\n                var done = false;\r\n                try {\r\n                    fn(function (value) {\r\n                        if (done) {\r\n                            return;\r\n                        }\r\n                        done = true;\r\n                        onFulfilled(value);\r\n                    }, function (reason) {\r\n                        if (done) {\r\n                            return;\r\n                        }\r\n                        done = true;\r\n                        onRejected(reason);\r\n                    });\r\n                }\r\n                catch (ex) {\r\n                    if (done) {\r\n                        return;\r\n                    }\r\n                    done = true;\r\n                    onRejected(ex);\r\n                }\r\n            }\r\n            Promise.prototype.catch = function (onRejected) {\r\n                return this.then(null, onRejected);\r\n            };\r\n            Promise.prototype.then = function (onFulfilled, onRejected) {\r\n                var me = this;\r\n                return new Promise(function (resolve, reject) {\r\n                    handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\r\n                });\r\n            };\r\n            Promise.all = function () {\r\n                var values = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    values[_i] = arguments[_i];\r\n                }\r\n                var args = Array.prototype.slice.call(values.length === 1 && isArray(values[0]) ? values[0] : values);\r\n                return new Promise(function (resolve, reject) {\r\n                    if (args.length === 0) {\r\n                        return resolve([]);\r\n                    }\r\n                    var remaining = args.length;\r\n                    function res(i, val) {\r\n                        try {\r\n                            if (val && (typeof val === 'object' || typeof val === 'function')) {\r\n                                var then = val.then;\r\n                                if (typeof then === 'function') {\r\n                                    then.call(val, function (val) {\r\n                                        res(i, val);\r\n                                    }, reject);\r\n                                    return;\r\n                                }\r\n                            }\r\n                            args[i] = val;\r\n                            if (--remaining === 0) {\r\n                                resolve(args);\r\n                            }\r\n                        }\r\n                        catch (ex) {\r\n                            reject(ex);\r\n                        }\r\n                    }\r\n                    for (var i = 0; i < args.length; i++) {\r\n                        res(i, args[i]);\r\n                    }\r\n                });\r\n            };\r\n            Promise.resolve = function (value) {\r\n                if (value && typeof value === 'object' && value.constructor === Promise) {\r\n                    return value;\r\n                }\r\n                return new Promise(function (resolve) {\r\n                    resolve(value);\r\n                });\r\n            };\r\n            Promise.reject = function (reason) {\r\n                return new Promise(function (resolve, reject) {\r\n                    reject(reason);\r\n                });\r\n            };\r\n            Promise.race = function (values) {\r\n                return new Promise(function (resolve, reject) {\r\n                    for (var _i = 0, values_1 = values; _i < values_1.length; _i++) {\r\n                        var value = values_1[_i];\r\n                        value.then(resolve, reject);\r\n                    }\r\n                });\r\n            };\r\n            return Promise;\r\n        };\r\n        var Promise$1 = window.Promise ? window.Promise : promise();\r\n        function imageToBlob(image) {\r\n            var src = image.src;\r\n            if (src.indexOf('data:') === 0) {\r\n                return dataUriToBlob(src);\r\n            }\r\n            return anyUriToBlob(src);\r\n        }\r\n        function blobToImage(blob) {\r\n            return new Promise$1(function (resolve, reject) {\r\n                var blobUrl = domGlobals.URL.createObjectURL(blob);\r\n                var image = new domGlobals.Image();\r\n                var removeListeners = function () {\r\n                    image.removeEventListener('load', loaded);\r\n                    image.removeEventListener('error', error);\r\n                };\r\n                function loaded() {\r\n                    removeListeners();\r\n                    resolve(image);\r\n                }\r\n                function error() {\r\n                    removeListeners();\r\n                    reject('Unable to load data of type ' + blob.type + ': ' + blobUrl);\r\n                }\r\n                image.addEventListener('load', loaded);\r\n                image.addEventListener('error', error);\r\n                image.src = blobUrl;\r\n                if (image.complete) {\r\n                    loaded();\r\n                }\r\n            });\r\n        }\r\n        function anyUriToBlob(url) {\r\n            return new Promise$1(function (resolve, reject) {\r\n                var xhr = new domGlobals.XMLHttpRequest();\r\n                xhr.open('GET', url, true);\r\n                xhr.responseType = 'blob';\r\n                xhr.onload = function () {\r\n                    if (this.status === 200) {\r\n                        resolve(this.response);\r\n                    }\r\n                };\r\n                xhr.onerror = function () {\r\n                    var _this = this;\r\n                    var corsError = function () {\r\n                        var obj = new Error('No access to download image');\r\n                        obj.code = 18;\r\n                        obj.name = 'SecurityError';\r\n                        return obj;\r\n                    };\r\n                    var genericError = function () {\r\n                        return new Error('Error ' + _this.status + ' downloading image');\r\n                    };\r\n                    reject(this.status === 0 ? corsError() : genericError());\r\n                };\r\n                xhr.send();\r\n            });\r\n        }\r\n        function dataUriToBlobSync(uri) {\r\n            var data = uri.split(',');\r\n            var matches = /data:([^;]+)/.exec(data[0]);\r\n            if (!matches) {\r\n                return Option.none();\r\n            }\r\n            var mimetype = matches[1];\r\n            var base64 = data[1];\r\n            var sliceSize = 1024;\r\n            var byteCharacters = Window.atob(base64);\r\n            var bytesLength = byteCharacters.length;\r\n            var slicesCount = Math.ceil(bytesLength / sliceSize);\r\n            var byteArrays = new Array(slicesCount);\r\n            for (var sliceIndex = 0; sliceIndex < slicesCount; ++sliceIndex) {\r\n                var begin = sliceIndex * sliceSize;\r\n                var end = Math.min(begin + sliceSize, bytesLength);\r\n                var bytes = new Array(end - begin);\r\n                for (var offset = begin, i = 0; offset < end; ++i, ++offset) {\r\n                    bytes[i] = byteCharacters[offset].charCodeAt(0);\r\n                }\r\n                byteArrays[sliceIndex] = Uint8Array(bytes);\r\n            }\r\n            return Option.some(SandBlob(byteArrays, { type: mimetype }));\r\n        }\r\n        function dataUriToBlob(uri) {\r\n            return new Promise$1(function (resolve, reject) {\r\n                dataUriToBlobSync(uri).fold(function () {\r\n                    reject('uri is not base64: ' + uri);\r\n                }, resolve);\r\n            });\r\n        }\r\n        function canvasToBlob(canvas, type, quality) {\r\n            type = type || 'image/png';\r\n            if (domGlobals.HTMLCanvasElement.prototype.toBlob) {\r\n                return new Promise$1(function (resolve, reject) {\r\n                    canvas.toBlob(function (blob) {\r\n                        if (blob) {\r\n                            resolve(blob);\r\n                        }\r\n                        else {\r\n                            reject();\r\n                        }\r\n                    }, type, quality);\r\n                });\r\n            }\r\n            else {\r\n                return dataUriToBlob(canvas.toDataURL(type, quality));\r\n            }\r\n        }\r\n        function canvasToDataURL(canvas, type, quality) {\r\n            type = type || 'image/png';\r\n            return canvas.toDataURL(type, quality);\r\n        }\r\n        function blobToCanvas(blob) {\r\n            return blobToImage(blob).then(function (image) {\r\n                revokeImageUrl(image);\r\n                var canvas = create$3(getWidth(image), getHeight(image));\r\n                var context = get2dContext(canvas);\r\n                context.drawImage(image, 0, 0);\r\n                return canvas;\r\n            });\r\n        }\r\n        function blobToDataUri(blob) {\r\n            return new Promise$1(function (resolve) {\r\n                var reader = FileReader();\r\n                reader.onloadend = function () {\r\n                    resolve(reader.result);\r\n                };\r\n                reader.readAsDataURL(blob);\r\n            });\r\n        }\r\n        function revokeImageUrl(image) {\r\n            domGlobals.URL.revokeObjectURL(image.src);\r\n        }\r\n        function create$4(getCanvas, blob, uri) {\r\n            var initialType = blob.type;\r\n            var getType = constant(initialType);\r\n            function toBlob() {\r\n                return Promise$1.resolve(blob);\r\n            }\r\n            function toDataURL() {\r\n                return uri;\r\n            }\r\n            function toBase64() {\r\n                return uri.split(',')[1];\r\n            }\r\n            function toAdjustedBlob(type, quality) {\r\n                return getCanvas.then(function (canvas) {\r\n                    return canvasToBlob(canvas, type, quality);\r\n                });\r\n            }\r\n            function toAdjustedDataURL(type, quality) {\r\n                return getCanvas.then(function (canvas) {\r\n                    return canvasToDataURL(canvas, type, quality);\r\n                });\r\n            }\r\n            function toAdjustedBase64(type, quality) {\r\n                return toAdjustedDataURL(type, quality).then(function (dataurl) {\r\n                    return dataurl.split(',')[1];\r\n                });\r\n            }\r\n            function toCanvas() {\r\n                return getCanvas.then(clone$1);\r\n            }\r\n            return {\r\n                getType: getType,\r\n                toBlob: toBlob,\r\n                toDataURL: toDataURL,\r\n                toBase64: toBase64,\r\n                toAdjustedBlob: toAdjustedBlob,\r\n                toAdjustedDataURL: toAdjustedDataURL,\r\n                toAdjustedBase64: toAdjustedBase64,\r\n                toCanvas: toCanvas\r\n            };\r\n        }\r\n        function fromBlob(blob) {\r\n            return blobToDataUri(blob).then(function (uri) {\r\n                return create$4(blobToCanvas(blob), blob, uri);\r\n            });\r\n        }\r\n        function fromCanvas(canvas, type) {\r\n            return canvasToBlob(canvas, type).then(function (blob) {\r\n                return create$4(Promise$1.resolve(canvas), blob, canvas.toDataURL());\r\n            });\r\n        }\r\n        function fromImage(image) {\r\n            return imageToBlob(image).then(function (blob) {\r\n                return fromBlob(blob);\r\n            });\r\n        }\r\n        var fromBlobAndUrlSync = function (blob, url) {\r\n            return create$4(blobToCanvas(blob), blob, url);\r\n        };\r\n        var ImageResult = Object.freeze({\r\n            fromBlob: fromBlob,\r\n            fromCanvas: fromCanvas,\r\n            fromImage: fromImage,\r\n            fromBlobAndUrlSync: fromBlobAndUrlSync\r\n        });\r\n        var blobToImageResult = function (blob) {\r\n            return fromBlob(blob);\r\n        };\r\n        function clamp(value, min, max) {\r\n            var parsedValue = typeof value === 'string' ? parseFloat(value) : value;\r\n            if (parsedValue > max) {\r\n                parsedValue = max;\r\n            }\r\n            else if (parsedValue < min) {\r\n                parsedValue = min;\r\n            }\r\n            return parsedValue;\r\n        }\r\n        function identity$1() {\r\n            return [\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1\r\n            ];\r\n        }\r\n        var DELTA_INDEX = [\r\n            0,\r\n            0.01,\r\n            0.02,\r\n            0.04,\r\n            0.05,\r\n            0.06,\r\n            0.07,\r\n            0.08,\r\n            0.1,\r\n            0.11,\r\n            0.12,\r\n            0.14,\r\n            0.15,\r\n            0.16,\r\n            0.17,\r\n            0.18,\r\n            0.2,\r\n            0.21,\r\n            0.22,\r\n            0.24,\r\n            0.25,\r\n            0.27,\r\n            0.28,\r\n            0.3,\r\n            0.32,\r\n            0.34,\r\n            0.36,\r\n            0.38,\r\n            0.4,\r\n            0.42,\r\n            0.44,\r\n            0.46,\r\n            0.48,\r\n            0.5,\r\n            0.53,\r\n            0.56,\r\n            0.59,\r\n            0.62,\r\n            0.65,\r\n            0.68,\r\n            0.71,\r\n            0.74,\r\n            0.77,\r\n            0.8,\r\n            0.83,\r\n            0.86,\r\n            0.89,\r\n            0.92,\r\n            0.95,\r\n            0.98,\r\n            1,\r\n            1.06,\r\n            1.12,\r\n            1.18,\r\n            1.24,\r\n            1.3,\r\n            1.36,\r\n            1.42,\r\n            1.48,\r\n            1.54,\r\n            1.6,\r\n            1.66,\r\n            1.72,\r\n            1.78,\r\n            1.84,\r\n            1.9,\r\n            1.96,\r\n            2,\r\n            2.12,\r\n            2.25,\r\n            2.37,\r\n            2.5,\r\n            2.62,\r\n            2.75,\r\n            2.87,\r\n            3,\r\n            3.2,\r\n            3.4,\r\n            3.6,\r\n            3.8,\r\n            4,\r\n            4.3,\r\n            4.7,\r\n            4.9,\r\n            5,\r\n            5.5,\r\n            6,\r\n            6.5,\r\n            6.8,\r\n            7,\r\n            7.3,\r\n            7.5,\r\n            7.8,\r\n            8,\r\n            8.4,\r\n            8.7,\r\n            9,\r\n            9.4,\r\n            9.6,\r\n            9.8,\r\n            10\r\n        ];\r\n        function multiply(matrix1, matrix2) {\r\n            var col = [];\r\n            var out = new Array(25);\r\n            var val;\r\n            for (var i = 0; i < 5; i++) {\r\n                for (var j = 0; j < 5; j++) {\r\n                    col[j] = matrix2[j + i * 5];\r\n                }\r\n                for (var j = 0; j < 5; j++) {\r\n                    val = 0;\r\n                    for (var k = 0; k < 5; k++) {\r\n                        val += matrix1[j + k * 5] * col[k];\r\n                    }\r\n                    out[j + i * 5] = val;\r\n                }\r\n            }\r\n            return out;\r\n        }\r\n        function adjustContrast(matrix, value) {\r\n            var x;\r\n            value = clamp(value, -1, 1);\r\n            value *= 100;\r\n            if (value < 0) {\r\n                x = 127 + value / 100 * 127;\r\n            }\r\n            else {\r\n                x = value % 1;\r\n                if (x === 0) {\r\n                    x = DELTA_INDEX[value];\r\n                }\r\n                else {\r\n                    x = DELTA_INDEX[Math.floor(value)] * (1 - x) + DELTA_INDEX[Math.floor(value) + 1] * x;\r\n                }\r\n                x = x * 127 + 127;\r\n            }\r\n            return multiply(matrix, [\r\n                x / 127,\r\n                0,\r\n                0,\r\n                0,\r\n                0.5 * (127 - x),\r\n                0,\r\n                x / 127,\r\n                0,\r\n                0,\r\n                0.5 * (127 - x),\r\n                0,\r\n                0,\r\n                x / 127,\r\n                0,\r\n                0.5 * (127 - x),\r\n                0,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1\r\n            ]);\r\n        }\r\n        function adjustBrightness(matrix, value) {\r\n            value = clamp(255 * value, -255, 255);\r\n            return multiply(matrix, [\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                value,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                value,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                value,\r\n                0,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1\r\n            ]);\r\n        }\r\n        function adjustColors(matrix, adjustR, adjustG, adjustB) {\r\n            adjustR = clamp(adjustR, 0, 2);\r\n            adjustG = clamp(adjustG, 0, 2);\r\n            adjustB = clamp(adjustB, 0, 2);\r\n            return multiply(matrix, [\r\n                adjustR,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                adjustG,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                adjustB,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                0,\r\n                1\r\n            ]);\r\n        }\r\n        function colorFilter(ir, matrix) {\r\n            return ir.toCanvas().then(function (canvas) {\r\n                return applyColorFilter(canvas, ir.getType(), matrix);\r\n            });\r\n        }\r\n        function applyColorFilter(canvas, type, matrix) {\r\n            var context = get2dContext(canvas);\r\n            function applyMatrix(pixelsData, m) {\r\n                var r, g, b, a;\r\n                var data = pixelsData.data, m0 = m[0], m1 = m[1], m2 = m[2], m3 = m[3], m4 = m[4], m5 = m[5], m6 = m[6], m7 = m[7], m8 = m[8], m9 = m[9], m10 = m[10], m11 = m[11], m12 = m[12], m13 = m[13], m14 = m[14], m15 = m[15], m16 = m[16], m17 = m[17], m18 = m[18], m19 = m[19];\r\n                for (var i = 0; i < data.length; i += 4) {\r\n                    r = data[i];\r\n                    g = data[i + 1];\r\n                    b = data[i + 2];\r\n                    a = data[i + 3];\r\n                    data[i] = r * m0 + g * m1 + b * m2 + a * m3 + m4;\r\n                    data[i + 1] = r * m5 + g * m6 + b * m7 + a * m8 + m9;\r\n                    data[i + 2] = r * m10 + g * m11 + b * m12 + a * m13 + m14;\r\n                    data[i + 3] = r * m15 + g * m16 + b * m17 + a * m18 + m19;\r\n                }\r\n                return pixelsData;\r\n            }\r\n            var pixels = applyMatrix(context.getImageData(0, 0, canvas.width, canvas.height), matrix);\r\n            context.putImageData(pixels, 0, 0);\r\n            return fromCanvas(canvas, type);\r\n        }\r\n        function convoluteFilter(ir, matrix) {\r\n            return ir.toCanvas().then(function (canvas) {\r\n                return applyConvoluteFilter(canvas, ir.getType(), matrix);\r\n            });\r\n        }\r\n        function applyConvoluteFilter(canvas, type, matrix) {\r\n            var context = get2dContext(canvas);\r\n            function applyMatrix(pIn, pOut, aMatrix) {\r\n                function clamp(value, min, max) {\r\n                    if (value > max) {\r\n                        value = max;\r\n                    }\r\n                    else if (value < min) {\r\n                        value = min;\r\n                    }\r\n                    return value;\r\n                }\r\n                var side = Math.round(Math.sqrt(aMatrix.length));\r\n                var halfSide = Math.floor(side / 2);\r\n                var rgba = pIn.data;\r\n                var drgba = pOut.data;\r\n                var w = pIn.width;\r\n                var h = pIn.height;\r\n                for (var y = 0; y < h; y++) {\r\n                    for (var x = 0; x < w; x++) {\r\n                        var r = 0;\r\n                        var g = 0;\r\n                        var b = 0;\r\n                        for (var cy = 0; cy < side; cy++) {\r\n                            for (var cx = 0; cx < side; cx++) {\r\n                                var scx = clamp(x + cx - halfSide, 0, w - 1);\r\n                                var scy = clamp(y + cy - halfSide, 0, h - 1);\r\n                                var innerOffset = (scy * w + scx) * 4;\r\n                                var wt = aMatrix[cy * side + cx];\r\n                                r += rgba[innerOffset] * wt;\r\n                                g += rgba[innerOffset + 1] * wt;\r\n                                b += rgba[innerOffset + 2] * wt;\r\n                            }\r\n                        }\r\n                        var offset = (y * w + x) * 4;\r\n                        drgba[offset] = clamp(r, 0, 255);\r\n                        drgba[offset + 1] = clamp(g, 0, 255);\r\n                        drgba[offset + 2] = clamp(b, 0, 255);\r\n                    }\r\n                }\r\n                return pOut;\r\n            }\r\n            var pixelsIn = context.getImageData(0, 0, canvas.width, canvas.height);\r\n            var pixelsOut = context.getImageData(0, 0, canvas.width, canvas.height);\r\n            pixelsOut = applyMatrix(pixelsIn, pixelsOut, matrix);\r\n            context.putImageData(pixelsOut, 0, 0);\r\n            return fromCanvas(canvas, type);\r\n        }\r\n        function functionColorFilter(colorFn) {\r\n            var filterImpl = function (canvas, type, value) {\r\n                var context = get2dContext(canvas);\r\n                var lookup = new Array(256);\r\n                function applyLookup(pixelsData, lookupData) {\r\n                    var data = pixelsData.data;\r\n                    for (var i = 0; i < data.length; i += 4) {\r\n                        data[i] = lookupData[data[i]];\r\n                        data[i + 1] = lookupData[data[i + 1]];\r\n                        data[i + 2] = lookupData[data[i + 2]];\r\n                    }\r\n                    return pixelsData;\r\n                }\r\n                for (var i = 0; i < lookup.length; i++) {\r\n                    lookup[i] = colorFn(i, value);\r\n                }\r\n                var pixels = applyLookup(context.getImageData(0, 0, canvas.width, canvas.height), lookup);\r\n                context.putImageData(pixels, 0, 0);\r\n                return fromCanvas(canvas, type);\r\n            };\r\n            return function (ir, value) {\r\n                return ir.toCanvas().then(function (canvas) {\r\n                    return filterImpl(canvas, ir.getType(), value);\r\n                });\r\n            };\r\n        }\r\n        function complexAdjustableColorFilter(matrixAdjustFn) {\r\n            return function (ir, adjust) {\r\n                return colorFilter(ir, matrixAdjustFn(identity$1(), adjust));\r\n            };\r\n        }\r\n        function basicColorFilter(matrix) {\r\n            return function (ir) {\r\n                return colorFilter(ir, matrix);\r\n            };\r\n        }\r\n        function basicConvolutionFilter(kernel) {\r\n            return function (ir) {\r\n                return convoluteFilter(ir, kernel);\r\n            };\r\n        }\r\n        var invert = basicColorFilter([\r\n            -1,\r\n            0,\r\n            0,\r\n            0,\r\n            255,\r\n            0,\r\n            -1,\r\n            0,\r\n            0,\r\n            255,\r\n            0,\r\n            0,\r\n            -1,\r\n            0,\r\n            255,\r\n            0,\r\n            0,\r\n            0,\r\n            1,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            1\r\n        ]);\r\n        var brightness = complexAdjustableColorFilter(adjustBrightness);\r\n        var contrast = complexAdjustableColorFilter(adjustContrast);\r\n        var colorize = function (ir, adjustR, adjustG, adjustB) {\r\n            return colorFilter(ir, adjustColors(identity$1(), adjustR, adjustG, adjustB));\r\n        };\r\n        var sharpen = basicConvolutionFilter([\r\n            0,\r\n            -1,\r\n            0,\r\n            -1,\r\n            5,\r\n            -1,\r\n            0,\r\n            -1,\r\n            0\r\n        ]);\r\n        var gamma = functionColorFilter(function (color, value) {\r\n            return Math.pow(color / 255, 1 - value) * 255;\r\n        });\r\n        function scale(image, dW, dH) {\r\n            var sW = getWidth(image);\r\n            var sH = getHeight(image);\r\n            var wRatio = dW / sW;\r\n            var hRatio = dH / sH;\r\n            var scaleCapped = false;\r\n            if (wRatio < 0.5 || wRatio > 2) {\r\n                wRatio = wRatio < 0.5 ? 0.5 : 2;\r\n                scaleCapped = true;\r\n            }\r\n            if (hRatio < 0.5 || hRatio > 2) {\r\n                hRatio = hRatio < 0.5 ? 0.5 : 2;\r\n                scaleCapped = true;\r\n            }\r\n            var scaled = _scale(image, wRatio, hRatio);\r\n            return !scaleCapped ? scaled : scaled.then(function (tCanvas) {\r\n                return scale(tCanvas, dW, dH);\r\n            });\r\n        }\r\n        function _scale(image, wRatio, hRatio) {\r\n            return new Promise$1(function (resolve) {\r\n                var sW = getWidth(image);\r\n                var sH = getHeight(image);\r\n                var dW = Math.floor(sW * wRatio);\r\n                var dH = Math.floor(sH * hRatio);\r\n                var canvas = create$3(dW, dH);\r\n                var context = get2dContext(canvas);\r\n                context.drawImage(image, 0, 0, sW, sH, 0, 0, dW, dH);\r\n                resolve(canvas);\r\n            });\r\n        }\r\n        function rotate(ir, angle) {\r\n            return ir.toCanvas().then(function (canvas) {\r\n                return applyRotate(canvas, ir.getType(), angle);\r\n            });\r\n        }\r\n        function applyRotate(image, type, angle) {\r\n            var canvas = create$3(image.width, image.height);\r\n            var context = get2dContext(canvas);\r\n            var translateX = 0;\r\n            var translateY = 0;\r\n            angle = angle < 0 ? 360 + angle : angle;\r\n            if (angle === 90 || angle === 270) {\r\n                resize(canvas, canvas.height, canvas.width);\r\n            }\r\n            if (angle === 90 || angle === 180) {\r\n                translateX = canvas.width;\r\n            }\r\n            if (angle === 270 || angle === 180) {\r\n                translateY = canvas.height;\r\n            }\r\n            context.translate(translateX, translateY);\r\n            context.rotate(angle * Math.PI / 180);\r\n            context.drawImage(image, 0, 0);\r\n            return fromCanvas(canvas, type);\r\n        }\r\n        function flip(ir, axis) {\r\n            return ir.toCanvas().then(function (canvas) {\r\n                return applyFlip(canvas, ir.getType(), axis);\r\n            });\r\n        }\r\n        function applyFlip(image, type, axis) {\r\n            var canvas = create$3(image.width, image.height);\r\n            var context = get2dContext(canvas);\r\n            if (axis === 'v') {\r\n                context.scale(1, -1);\r\n                context.drawImage(image, 0, -canvas.height);\r\n            }\r\n            else {\r\n                context.scale(-1, 1);\r\n                context.drawImage(image, -canvas.width, 0);\r\n            }\r\n            return fromCanvas(canvas, type);\r\n        }\r\n        function crop(ir, x, y, w, h) {\r\n            return ir.toCanvas().then(function (canvas) {\r\n                return applyCrop(canvas, ir.getType(), x, y, w, h);\r\n            });\r\n        }\r\n        function applyCrop(image, type, x, y, w, h) {\r\n            var canvas = create$3(w, h);\r\n            var context = get2dContext(canvas);\r\n            context.drawImage(image, -x, -y);\r\n            return fromCanvas(canvas, type);\r\n        }\r\n        function resize$1(ir, w, h) {\r\n            return ir.toCanvas().then(function (canvas) {\r\n                return scale(canvas, w, h).then(function (newCanvas) {\r\n                    return fromCanvas(newCanvas, ir.getType());\r\n                });\r\n            });\r\n        }\r\n        var invert$1 = function (ir) {\r\n            return invert(ir);\r\n        };\r\n        var sharpen$1 = function (ir) {\r\n            return sharpen(ir);\r\n        };\r\n        var gamma$1 = function (ir, value) {\r\n            return gamma(ir, value);\r\n        };\r\n        var colorize$1 = function (ir, adjustR, adjustG, adjustB) {\r\n            return colorize(ir, adjustR, adjustG, adjustB);\r\n        };\r\n        var brightness$1 = function (ir, adjust) {\r\n            return brightness(ir, adjust);\r\n        };\r\n        var contrast$1 = function (ir, adjust) {\r\n            return contrast(ir, adjust);\r\n        };\r\n        var flip$1 = function (ir, axis) {\r\n            return flip(ir, axis);\r\n        };\r\n        var crop$1 = function (ir, x, y, w, h) {\r\n            return crop(ir, x, y, w, h);\r\n        };\r\n        var resize$2 = function (ir, w, h) {\r\n            return resize$1(ir, w, h);\r\n        };\r\n        var rotate$1 = function (ir, angle) {\r\n            return rotate(ir, angle);\r\n        };\r\n        var renderIcon$1 = function (iconHtml, behaviours) {\r\n            return __assign({\r\n                dom: {\r\n                    tag: 'span',\r\n                    innerHtml: iconHtml,\r\n                    classes: [\r\n                        'tox-icon',\r\n                        'tox-tbtn__icon-wrap'\r\n                    ]\r\n                }\r\n            }, behaviours);\r\n        };\r\n        var renderIconFromPack = function (iconName, iconsProvider) {\r\n            return renderIcon$1(get$c(iconName, iconsProvider), {});\r\n        };\r\n        var renderReplacableIconFromPack = function (iconName, iconsProvider) {\r\n            return renderIcon$1(get$c(iconName, iconsProvider), { behaviours: derive$1([Replacing.config({})]) });\r\n        };\r\n        var renderLabel$1 = function (text, prefix, providersBackstage) {\r\n            return {\r\n                dom: {\r\n                    tag: 'span',\r\n                    innerHtml: providersBackstage.translate(text),\r\n                    classes: [prefix + '__select-label']\r\n                },\r\n                behaviours: derive$1([Replacing.config({})])\r\n            };\r\n        };\r\n        var renderCommonSpec = function (spec, actionOpt, extraBehaviours, dom, components) {\r\n            if (extraBehaviours === void 0) {\r\n                extraBehaviours = [];\r\n            }\r\n            var action = actionOpt.fold(function () {\r\n                return {};\r\n            }, function (action) {\r\n                return { action: action };\r\n            });\r\n            var common = __assign({\r\n                buttonBehaviours: derive$1([\r\n                    DisablingConfigs.button(spec.disabled),\r\n                    Tabstopping.config({}),\r\n                    config('button press', [\r\n                        preventDefault('click'),\r\n                        preventDefault('mousedown')\r\n                    ])\r\n                ].concat(extraBehaviours)),\r\n                eventOrder: {\r\n                    click: [\r\n                        'button press',\r\n                        'alloy.base.behaviour'\r\n                    ],\r\n                    mousedown: [\r\n                        'button press',\r\n                        'alloy.base.behaviour'\r\n                    ]\r\n                }\r\n            }, action);\r\n            var domFinal = deepMerge(common, { dom: dom });\r\n            return deepMerge(domFinal, { components: components });\r\n        };\r\n        var renderCommon = function (spec, action, extraBehaviours, dom, components) {\r\n            if (extraBehaviours === void 0) {\r\n                extraBehaviours = [];\r\n            }\r\n            var specFinal = renderCommonSpec(spec, Option.some(action), extraBehaviours, dom, components);\r\n            return Button.sketch(specFinal);\r\n        };\r\n        var renderIconButtonSpec = function (spec, action, providersBackstage, extraBehaviours) {\r\n            if (extraBehaviours === void 0) {\r\n                extraBehaviours = [];\r\n            }\r\n            var tooltipAttributes = spec.tooltip.map(function (tooltip) {\r\n                return {\r\n                    'aria-label': providersBackstage.translate(tooltip),\r\n                    'title': providersBackstage.translate(tooltip)\r\n                };\r\n            }).getOr({});\r\n            var dom = {\r\n                tag: 'button',\r\n                classes: ['tox-tbtn'],\r\n                attributes: tooltipAttributes\r\n            };\r\n            var icon = spec.icon.map(function (iconName) {\r\n                return renderIconFromPack(iconName, providersBackstage.icons);\r\n            });\r\n            var components = componentRenderPipeline([icon]);\r\n            return renderCommonSpec(spec, action, extraBehaviours, dom, components);\r\n        };\r\n        var renderIconButton = function (spec, action, providersBackstage, extraBehaviours) {\r\n            if (extraBehaviours === void 0) {\r\n                extraBehaviours = [];\r\n            }\r\n            var iconButtonSpec = renderIconButtonSpec(spec, Option.some(action), providersBackstage, extraBehaviours);\r\n            return Button.sketch(iconButtonSpec);\r\n        };\r\n        var renderButton = function (spec, action, providersBackstage, extraBehaviours) {\r\n            if (extraBehaviours === void 0) {\r\n                extraBehaviours = [];\r\n            }\r\n            var translatedText = providersBackstage.translate(spec.text);\r\n            var icon = spec.icon ? spec.icon.map(function (iconName) {\r\n                return renderIconFromPack(iconName, providersBackstage.icons);\r\n            }) : Option.none();\r\n            var components = icon.isSome() ? componentRenderPipeline([icon]) : [];\r\n            var innerHtml = icon.isSome() ? {} : { innerHtml: translatedText };\r\n            var classes = (spec.primary ? ['tox-button'] : [\r\n                'tox-button',\r\n                'tox-button--secondary'\r\n            ]).concat(icon.isSome() ? ['tox-button--icon'] : []);\r\n            var dom = __assign({\r\n                tag: 'button',\r\n                classes: classes\r\n            }, innerHtml, { attributes: { title: translatedText } });\r\n            return renderCommon(spec, action, extraBehaviours, dom, components);\r\n        };\r\n        var getAction = function (name, buttonType) {\r\n            return function (comp) {\r\n                if (buttonType === 'custom') {\r\n                    emitWith(comp, formActionEvent, {\r\n                        name: name,\r\n                        value: {}\r\n                    });\r\n                }\r\n                else if (buttonType === 'submit') {\r\n                    emit(comp, formSubmitEvent);\r\n                }\r\n                else if (buttonType === 'cancel') {\r\n                    emit(comp, formCancelEvent);\r\n                }\r\n                else {\r\n                    domGlobals.console.error('Unknown button type: ', buttonType);\r\n                }\r\n            };\r\n        };\r\n        var renderFooterButton = function (spec, buttonType, providersBackstage) {\r\n            var action = getAction(spec.name, buttonType);\r\n            return renderButton(spec, action, providersBackstage, []);\r\n        };\r\n        var renderDialogButton = function (spec, providersBackstage) {\r\n            var action = getAction(spec.name, 'custom');\r\n            return renderButton(spec, action, providersBackstage, [\r\n                RepresentingConfigs.memory(''),\r\n                ComposingConfigs.self()\r\n            ]);\r\n        };\r\n        var schema$i = constant([\r\n            defaulted$1('field1Name', 'field1'),\r\n            defaulted$1('field2Name', 'field2'),\r\n            onStrictHandler('onLockedChange'),\r\n            markers(['lockClass']),\r\n            defaulted$1('locked', false),\r\n            SketchBehaviours.field('coupledFieldBehaviours', [\r\n                Composing,\r\n                Representing\r\n            ])\r\n        ]);\r\n        var getField = function (comp, detail, partName) {\r\n            return getPart(comp, detail, partName).bind(Composing.getCurrent);\r\n        };\r\n        var coupledPart = function (selfName, otherName) {\r\n            return required({\r\n                factory: FormField,\r\n                name: selfName,\r\n                overrides: function (detail) {\r\n                    return {\r\n                        fieldBehaviours: derive$1([config('coupled-input-behaviour', [run(input(), function (me) {\r\n                                    getField(me, detail, otherName).each(function (other) {\r\n                                        getPart(me, detail, 'lock').each(function (lock) {\r\n                                            if (Toggling.isOn(lock)) {\r\n                                                detail.onLockedChange(me, other, lock);\r\n                                            }\r\n                                        });\r\n                                    });\r\n                                })])])\r\n                    };\r\n                }\r\n            });\r\n        };\r\n        var parts$6 = constant([\r\n            coupledPart('field1', 'field2'),\r\n            coupledPart('field2', 'field1'),\r\n            required({\r\n                factory: Button,\r\n                schema: [strict$1('dom')],\r\n                name: 'lock',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        buttonBehaviours: derive$1([Toggling.config({\r\n                                selected: detail.locked,\r\n                                toggleClass: detail.markers.lockClass,\r\n                                aria: { mode: 'pressed' }\r\n                            })])\r\n                    };\r\n                }\r\n            })\r\n        ]);\r\n        var factory$7 = function (detail, components, spec, externals) {\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                behaviours: SketchBehaviours.augment(detail.coupledFieldBehaviours, [\r\n                    Composing.config({ find: Option.some }),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'manual',\r\n                            getValue: function (comp) {\r\n                                var _a;\r\n                                var parts = getPartsOrDie(comp, detail, [\r\n                                    'field1',\r\n                                    'field2'\r\n                                ]);\r\n                                return _a = {}, _a[detail.field1Name] = Representing.getValue(parts.field1()), _a[detail.field2Name] = Representing.getValue(parts.field2()), _a;\r\n                            },\r\n                            setValue: function (comp, value) {\r\n                                var parts = getPartsOrDie(comp, detail, [\r\n                                    'field1',\r\n                                    'field2'\r\n                                ]);\r\n                                if (hasKey$1(value, detail.field1Name)) {\r\n                                    Representing.setValue(parts.field1(), value[detail.field1Name]);\r\n                                }\r\n                                if (hasKey$1(value, detail.field2Name)) {\r\n                                    Representing.setValue(parts.field2(), value[detail.field2Name]);\r\n                                }\r\n                            }\r\n                        }\r\n                    })\r\n                ]),\r\n                apis: {\r\n                    getField1: function (component) {\r\n                        return getPart(component, detail, 'field1');\r\n                    },\r\n                    getField2: function (component) {\r\n                        return getPart(component, detail, 'field2');\r\n                    },\r\n                    getLock: function (component) {\r\n                        return getPart(component, detail, 'lock');\r\n                    }\r\n                }\r\n            };\r\n        };\r\n        var FormCoupledInputs = composite$1({\r\n            name: 'FormCoupledInputs',\r\n            configFields: schema$i(),\r\n            partFields: parts$6(),\r\n            factory: factory$7,\r\n            apis: {\r\n                getField1: function (apis, component) {\r\n                    return apis.getField1(component);\r\n                },\r\n                getField2: function (apis, component) {\r\n                    return apis.getField2(component);\r\n                },\r\n                getLock: function (apis, component) {\r\n                    return apis.getLock(component);\r\n                }\r\n            }\r\n        });\r\n        var formatSize = function (size) {\r\n            var unitDec = {\r\n                '': 0,\r\n                'px': 0,\r\n                'pt': 1,\r\n                'mm': 1,\r\n                'pc': 2,\r\n                'ex': 2,\r\n                'em': 2,\r\n                'ch': 2,\r\n                'rem': 2,\r\n                'cm': 3,\r\n                'in': 4,\r\n                '%': 4\r\n            };\r\n            var maxDecimal = function (unit) {\r\n                return unit in unitDec ? unitDec[unit] : 1;\r\n            };\r\n            var numText = size.value.toFixed(maxDecimal(size.unit));\r\n            if (numText.indexOf('.') !== -1) {\r\n                numText = numText.replace(/\\.?0*$/, '');\r\n            }\r\n            return numText + size.unit;\r\n        };\r\n        var parseSize = function (sizeText) {\r\n            var numPattern = /^\\s*(\\d+(?:\\.\\d+)?)\\s*(|cm|mm|in|px|pt|pc|em|ex|ch|rem|vw|vh|vmin|vmax|%)\\s*$/;\r\n            var match = numPattern.exec(sizeText);\r\n            if (match !== null) {\r\n                var value = parseFloat(match[1]);\r\n                var unit = match[2];\r\n                return Result.value({\r\n                    value: value,\r\n                    unit: unit\r\n                });\r\n            }\r\n            else {\r\n                return Result.error(sizeText);\r\n            }\r\n        };\r\n        var convertUnit = function (size, unit) {\r\n            var inInch = {\r\n                '': 96,\r\n                'px': 96,\r\n                'pt': 72,\r\n                'cm': 2.54,\r\n                'pc': 12,\r\n                'mm': 25.4,\r\n                'in': 1\r\n            };\r\n            var supported = function (u) {\r\n                return Object.prototype.hasOwnProperty.call(inInch, u);\r\n            };\r\n            if (size.unit === unit) {\r\n                return Option.some(size.value);\r\n            }\r\n            else if (supported(size.unit) && supported(unit)) {\r\n                if (inInch[size.unit] === inInch[unit]) {\r\n                    return Option.some(size.value);\r\n                }\r\n                else {\r\n                    return Option.some(size.value / inInch[size.unit] * inInch[unit]);\r\n                }\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var noSizeConversion = function (input) {\r\n            return Option.none();\r\n        };\r\n        var ratioSizeConversion = function (scale, unit) {\r\n            return function (size) {\r\n                return convertUnit(size, unit).map(function (value) {\r\n                    return {\r\n                        value: value * scale,\r\n                        unit: unit\r\n                    };\r\n                });\r\n            };\r\n        };\r\n        var makeRatioConverter = function (currentFieldText, otherFieldText) {\r\n            var cValue = parseSize(currentFieldText).toOption();\r\n            var oValue = parseSize(otherFieldText).toOption();\r\n            return liftN([\r\n                cValue,\r\n                oValue\r\n            ], function (cSize, oSize) {\r\n                return convertUnit(cSize, oSize.unit).map(function (val) {\r\n                    return oSize.value / val;\r\n                }).map(function (r) {\r\n                    return ratioSizeConversion(r, oSize.unit);\r\n                }).getOr(noSizeConversion);\r\n            }).getOr(noSizeConversion);\r\n        };\r\n        var renderSizeInput = function (spec, providersBackstage) {\r\n            var converter = noSizeConversion;\r\n            var ratioEvent = generate$1('ratio-event');\r\n            var pLock = FormCoupledInputs.parts().lock({\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: [\r\n                        'tox-lock',\r\n                        'tox-button',\r\n                        'tox-button--naked',\r\n                        'tox-button--icon'\r\n                    ],\r\n                    attributes: { title: providersBackstage.translate(spec.label.getOr('Constrain proportions')) }\r\n                },\r\n                components: [\r\n                    {\r\n                        dom: {\r\n                            tag: 'span',\r\n                            classes: [\r\n                                'tox-icon',\r\n                                'tox-lock-icon__lock'\r\n                            ],\r\n                            innerHtml: get$c('lock', providersBackstage.icons)\r\n                        }\r\n                    },\r\n                    {\r\n                        dom: {\r\n                            tag: 'span',\r\n                            classes: [\r\n                                'tox-icon',\r\n                                'tox-lock-icon__unlock'\r\n                            ],\r\n                            innerHtml: get$c('unlock', providersBackstage.icons)\r\n                        }\r\n                    }\r\n                ],\r\n                buttonBehaviours: derive$1([Tabstopping.config({})])\r\n            });\r\n            var formGroup = function (components) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-form__group']\r\n                    },\r\n                    components: components\r\n                };\r\n            };\r\n            var getFieldPart = function (isField1) {\r\n                return FormField.parts().field({\r\n                    factory: Input,\r\n                    inputClasses: ['tox-textfield'],\r\n                    inputBehaviours: derive$1([\r\n                        Tabstopping.config({}),\r\n                        config('size-input-events', [\r\n                            run(focusin(), function (component, simulatedEvent) {\r\n                                emitWith(component, ratioEvent, { isField1: isField1 });\r\n                            }),\r\n                            run(change(), function (component, simulatedEvent) {\r\n                                emitWith(component, formChangeEvent, { name: spec.name });\r\n                            })\r\n                        ])\r\n                    ]),\r\n                    selectOnFocus: false\r\n                });\r\n            };\r\n            var getLabel = function (label) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'label',\r\n                        classes: ['tox-label'],\r\n                        innerHtml: providersBackstage.translate(label)\r\n                    }\r\n                };\r\n            };\r\n            var widthField = FormCoupledInputs.parts().field1(formGroup([\r\n                FormField.parts().label(getLabel('Width')),\r\n                getFieldPart(true)\r\n            ]));\r\n            var heightField = FormCoupledInputs.parts().field2(formGroup([\r\n                FormField.parts().label(getLabel('Height')),\r\n                getFieldPart(false)\r\n            ]));\r\n            return FormCoupledInputs.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-form__group']\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-form__controls-h-stack']\r\n                        },\r\n                        components: [\r\n                            widthField,\r\n                            heightField,\r\n                            formGroup([\r\n                                getLabel('&nbsp;'),\r\n                                pLock\r\n                            ])\r\n                        ]\r\n                    }],\r\n                field1Name: 'width',\r\n                field2Name: 'height',\r\n                locked: true,\r\n                markers: { lockClass: 'tox-locked' },\r\n                onLockedChange: function (current, other, lock) {\r\n                    parseSize(Representing.getValue(current)).each(function (size) {\r\n                        converter(size).each(function (newSize) {\r\n                            Representing.setValue(other, formatSize(newSize));\r\n                        });\r\n                    });\r\n                },\r\n                coupledFieldBehaviours: derive$1([\r\n                    Disabling.config({}),\r\n                    config('size-input-events2', [run(ratioEvent, function (component, simulatedEvent) {\r\n                            var isField1 = simulatedEvent.event().isField1();\r\n                            var optCurrent = isField1 ? FormCoupledInputs.getField1(component) : FormCoupledInputs.getField2(component);\r\n                            var optOther = isField1 ? FormCoupledInputs.getField2(component) : FormCoupledInputs.getField1(component);\r\n                            var value1 = optCurrent.map(Representing.getValue).getOr('');\r\n                            var value2 = optOther.map(Representing.getValue).getOr('');\r\n                            converter = makeRatioConverter(value1, value2);\r\n                        })])\r\n                ])\r\n            });\r\n        };\r\n        var undo = constant(generate$1('undo'));\r\n        var redo = constant(generate$1('redo'));\r\n        var zoom = constant(generate$1('zoom'));\r\n        var back = constant(generate$1('back'));\r\n        var apply$1 = constant(generate$1('apply'));\r\n        var swap = constant(generate$1('swap'));\r\n        var transform = constant(generate$1('transform'));\r\n        var tempTransform = constant(generate$1('temp-transform'));\r\n        var transformApply = constant(generate$1('transform-apply'));\r\n        var internal = {\r\n            undo: undo,\r\n            redo: redo,\r\n            zoom: zoom,\r\n            back: back,\r\n            apply: apply$1,\r\n            swap: swap,\r\n            transform: transform,\r\n            tempTransform: tempTransform,\r\n            transformApply: transformApply\r\n        };\r\n        var saveState = constant('save-state');\r\n        var disable$1 = constant('disable');\r\n        var enable$1 = constant('enable');\r\n        var external$2 = {\r\n            formActionEvent: formActionEvent,\r\n            saveState: saveState,\r\n            disable: disable$1,\r\n            enable: enable$1\r\n        };\r\n        var renderEditPanel = function (imagePanel, providersBackstage) {\r\n            var createButton = function (text, action, disabled, primary) {\r\n                return record(renderButton({\r\n                    name: text,\r\n                    text: text,\r\n                    disabled: disabled,\r\n                    primary: primary\r\n                }, action, providersBackstage));\r\n            };\r\n            var createIconButton = function (icon, tooltip, action, disabled) {\r\n                return record(renderIconButton({\r\n                    name: icon,\r\n                    icon: Option.some(icon),\r\n                    tooltip: Option.some(tooltip),\r\n                    disabled: disabled\r\n                }, action, providersBackstage));\r\n            };\r\n            var disableAllComponents = function (comps, eventcomp) {\r\n                comps.map(function (mem) {\r\n                    var component = mem.get(eventcomp);\r\n                    if (component.hasConfigured(Disabling)) {\r\n                        Disabling.disable(component);\r\n                    }\r\n                });\r\n            };\r\n            var enableAllComponents = function (comps, eventcomp) {\r\n                comps.map(function (mem) {\r\n                    var component = mem.get(eventcomp);\r\n                    if (component.hasConfigured(Disabling)) {\r\n                        Disabling.enable(component);\r\n                    }\r\n                });\r\n            };\r\n            var panelDom = {\r\n                tag: 'div',\r\n                classes: [\r\n                    'tox-image-tools__toolbar',\r\n                    'tox-image-tools-edit-panel'\r\n                ]\r\n            };\r\n            var none = Option.none();\r\n            var noop$1 = noop;\r\n            var emit$1 = function (comp, event, data) {\r\n                emitWith(comp, event, data);\r\n            };\r\n            var emitDisable = function (component) {\r\n                return emit(component, external$2.disable());\r\n            };\r\n            var emitEnable = function (component) {\r\n                return emit(component, external$2.enable());\r\n            };\r\n            var emitTransform = function (comp, transform) {\r\n                emitDisable(comp);\r\n                emit$1(comp, internal.transform(), { transform: transform });\r\n                emitEnable(comp);\r\n            };\r\n            var emitTempTransform = function (comp, transform) {\r\n                emitDisable(comp);\r\n                emit$1(comp, internal.tempTransform(), { transform: transform });\r\n                emitEnable(comp);\r\n            };\r\n            var getBackSwap = function (anyInSystem) {\r\n                return function () {\r\n                    memContainer.getOpt(anyInSystem).each(function (container) {\r\n                        Replacing.set(container, [ButtonPanel]);\r\n                    });\r\n                };\r\n            };\r\n            var emitTransformApply = function (comp, transform) {\r\n                emitDisable(comp);\r\n                emit$1(comp, internal.transformApply(), {\r\n                    transform: transform,\r\n                    swap: getBackSwap(comp)\r\n                });\r\n                emitEnable(comp);\r\n            };\r\n            var createBackButton = function () {\r\n                return createButton('Back', function (button) {\r\n                    return emit$1(button, internal.back(), { swap: getBackSwap(button) });\r\n                }, false, false);\r\n            };\r\n            var createSpacer = function () {\r\n                return record({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-spacer']\r\n                    },\r\n                    behaviours: derive$1([Disabling.config({})])\r\n                });\r\n            };\r\n            var createApplyButton = function () {\r\n                return createButton('Apply', function (button) {\r\n                    return emit$1(button, internal.apply(), { swap: getBackSwap(button) });\r\n                }, true, true);\r\n            };\r\n            var makeCropTransform = function () {\r\n                return function (ir) {\r\n                    var rect = imagePanel.getRect();\r\n                    return crop$1(ir, rect.x, rect.y, rect.w, rect.h);\r\n                };\r\n            };\r\n            var cropPanelComponents = [\r\n                createBackButton(),\r\n                createSpacer(),\r\n                createButton('Apply', function (button) {\r\n                    var transform = makeCropTransform();\r\n                    emitTransformApply(button, transform);\r\n                    imagePanel.hideCrop();\r\n                }, false, true)\r\n            ];\r\n            var CropPanel = Container.sketch({\r\n                dom: panelDom,\r\n                components: cropPanelComponents.map(function (mem) {\r\n                    return mem.asSpec();\r\n                }),\r\n                containerBehaviours: derive$1([config('image-tools-crop-buttons-events', [\r\n                        run(external$2.disable(), function (comp, se) {\r\n                            disableAllComponents(cropPanelComponents, comp);\r\n                        }),\r\n                        run(external$2.enable(), function (comp, se) {\r\n                            enableAllComponents(cropPanelComponents, comp);\r\n                        })\r\n                    ])])\r\n            });\r\n            var memSize = record(renderSizeInput({\r\n                name: 'size',\r\n                label: none,\r\n                type: 'sizeinput',\r\n                constrain: true\r\n            }, providersBackstage));\r\n            var makeResizeTransform = function (width, height) {\r\n                return function (ir) {\r\n                    return resize$2(ir, width, height);\r\n                };\r\n            };\r\n            var resizePanelComponents = [\r\n                createBackButton(),\r\n                createSpacer(),\r\n                memSize,\r\n                createSpacer(),\r\n                createButton('Apply', function (button) {\r\n                    memSize.getOpt(button).each(function (sizeInput) {\r\n                        var value = Representing.getValue(sizeInput);\r\n                        var width = parseInt(value.width, 10);\r\n                        var height = parseInt(value.height, 10);\r\n                        var transform = makeResizeTransform(width, height);\r\n                        emitTransformApply(button, transform);\r\n                    });\r\n                }, false, true)\r\n            ];\r\n            var ResizePanel = Container.sketch({\r\n                dom: panelDom,\r\n                components: resizePanelComponents.map(function (mem) {\r\n                    return mem.asSpec();\r\n                }),\r\n                containerBehaviours: derive$1([config('image-tools-resize-buttons-events', [\r\n                        run(external$2.disable(), function (comp, se) {\r\n                            disableAllComponents(resizePanelComponents, comp);\r\n                        }),\r\n                        run(external$2.enable(), function (comp, se) {\r\n                            enableAllComponents(resizePanelComponents, comp);\r\n                        })\r\n                    ])])\r\n            });\r\n            var makeValueTransform = function (transform, value) {\r\n                return function (ir) {\r\n                    return transform(ir, value);\r\n                };\r\n            };\r\n            var horizontalFlip = makeValueTransform(flip$1, 'h');\r\n            var verticalFlip = makeValueTransform(flip$1, 'v');\r\n            var counterclockwiseRotate = makeValueTransform(rotate$1, -90);\r\n            var clockwiseRotate = makeValueTransform(rotate$1, 90);\r\n            var flipRotateOnAction = function (comp, operation) {\r\n                emitTempTransform(comp, operation);\r\n            };\r\n            var flipRotateComponents = [\r\n                createBackButton(),\r\n                createSpacer(),\r\n                createIconButton('flip-horizontally', 'Flip horizontally', function (button) {\r\n                    flipRotateOnAction(button, horizontalFlip);\r\n                }, false),\r\n                createIconButton('flip-vertically', 'Flip vertically', function (button) {\r\n                    flipRotateOnAction(button, verticalFlip);\r\n                }, false),\r\n                createIconButton('rotate-left', 'Rotate counterclockwise', function (button) {\r\n                    flipRotateOnAction(button, counterclockwiseRotate);\r\n                }, false),\r\n                createIconButton('rotate-right', 'Rotate clockwise', function (button) {\r\n                    flipRotateOnAction(button, clockwiseRotate);\r\n                }, false),\r\n                createSpacer(),\r\n                createApplyButton()\r\n            ];\r\n            var FlipRotatePanel = Container.sketch({\r\n                dom: panelDom,\r\n                components: flipRotateComponents.map(function (mem) {\r\n                    return mem.asSpec();\r\n                }),\r\n                containerBehaviours: derive$1([config('image-tools-fliprotate-buttons-events', [\r\n                        run(external$2.disable(), function (comp, se) {\r\n                            disableAllComponents(flipRotateComponents, comp);\r\n                        }),\r\n                        run(external$2.enable(), function (comp, se) {\r\n                            enableAllComponents(flipRotateComponents, comp);\r\n                        })\r\n                    ])])\r\n            });\r\n            var makeSlider = function (label, onChoose, min, value, max) {\r\n                var labelPart = Slider.parts().label({\r\n                    dom: {\r\n                        tag: 'label',\r\n                        classes: ['tox-label'],\r\n                        innerHtml: providersBackstage.translate(label)\r\n                    }\r\n                });\r\n                var spectrum = Slider.parts().spectrum({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-slider__rail'],\r\n                        attributes: { role: 'presentation' }\r\n                    }\r\n                });\r\n                var thumb = Slider.parts().thumb({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-slider__handle'],\r\n                        attributes: { role: 'presentation' }\r\n                    }\r\n                });\r\n                return record(Slider.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-slider'],\r\n                        attributes: { role: 'presentation' }\r\n                    },\r\n                    model: {\r\n                        mode: 'x',\r\n                        minX: min,\r\n                        maxX: max,\r\n                        getInitialValue: constant({ x: constant(value) })\r\n                    },\r\n                    components: [\r\n                        labelPart,\r\n                        spectrum,\r\n                        thumb\r\n                    ],\r\n                    sliderBehaviours: derive$1([Focusing.config({})]),\r\n                    onChoose: onChoose\r\n                }));\r\n            };\r\n            var makeVariableSlider = function (label, transform, min, value, max) {\r\n                var onChoose = function (slider, thumb, value) {\r\n                    var valTransform = makeValueTransform(transform, value.x() / 100);\r\n                    emitTransform(slider, valTransform);\r\n                };\r\n                return makeSlider(label, onChoose, min, value, max);\r\n            };\r\n            var variableFilterPanelComponents = function (label, transform, min, value, max) {\r\n                return [\r\n                    createBackButton(),\r\n                    makeVariableSlider(label, transform, min, value, max),\r\n                    createApplyButton()\r\n                ];\r\n            };\r\n            var createVariableFilterPanel = function (label, transform, min, value, max) {\r\n                var filterPanelComponents = variableFilterPanelComponents(label, transform, min, value, max);\r\n                return Container.sketch({\r\n                    dom: panelDom,\r\n                    components: filterPanelComponents.map(function (mem) {\r\n                        return mem.asSpec();\r\n                    }),\r\n                    containerBehaviours: derive$1([config('image-tools-filter-panel-buttons-events', [\r\n                            run(external$2.disable(), function (comp, se) {\r\n                                disableAllComponents(filterPanelComponents, comp);\r\n                            }),\r\n                            run(external$2.enable(), function (comp, se) {\r\n                                enableAllComponents(filterPanelComponents, comp);\r\n                            })\r\n                        ])])\r\n                });\r\n            };\r\n            var filterPanelComponents = [\r\n                createBackButton(),\r\n                createSpacer(),\r\n                createApplyButton()\r\n            ];\r\n            var FilterPanel = Container.sketch({\r\n                dom: panelDom,\r\n                components: filterPanelComponents.map(function (mem) {\r\n                    return mem.asSpec();\r\n                })\r\n            });\r\n            var BrightnessPanel = createVariableFilterPanel('Brightness', brightness$1, -100, 0, 100);\r\n            var ContrastPanel = createVariableFilterPanel('Contrast', contrast$1, -100, 0, 100);\r\n            var GammaPanel = createVariableFilterPanel('Gamma', gamma$1, -100, 0, 100);\r\n            var makeColorTransform = function (red, green, blue) {\r\n                return function (ir) {\r\n                    return colorize$1(ir, red, green, blue);\r\n                };\r\n            };\r\n            var makeColorSlider = function (label) {\r\n                var onChoose = function (slider, thumb, value) {\r\n                    var redOpt = memRed.getOpt(slider);\r\n                    var blueOpt = memBlue.getOpt(slider);\r\n                    var greenOpt = memGreen.getOpt(slider);\r\n                    redOpt.each(function (red) {\r\n                        blueOpt.each(function (blue) {\r\n                            greenOpt.each(function (green) {\r\n                                var r = Representing.getValue(red).x() / 100;\r\n                                var g = Representing.getValue(green).x() / 100;\r\n                                var b = Representing.getValue(blue).x() / 100;\r\n                                var transform = makeColorTransform(r, g, b);\r\n                                emitTransform(slider, transform);\r\n                            });\r\n                        });\r\n                    });\r\n                };\r\n                return makeSlider(label, onChoose, 0, 100, 200);\r\n            };\r\n            var memRed = makeColorSlider('R');\r\n            var memGreen = makeColorSlider('G');\r\n            var memBlue = makeColorSlider('B');\r\n            var colorizePanelComponents = [\r\n                createBackButton(),\r\n                memRed,\r\n                memGreen,\r\n                memBlue,\r\n                createApplyButton()\r\n            ];\r\n            var ColorizePanel = Container.sketch({\r\n                dom: panelDom,\r\n                components: colorizePanelComponents.map(function (mem) {\r\n                    return mem.asSpec();\r\n                })\r\n            });\r\n            var getTransformPanelEvent = function (panel, transform, update) {\r\n                return function (button) {\r\n                    var swap = function () {\r\n                        memContainer.getOpt(button).each(function (container) {\r\n                            Replacing.set(container, [panel]);\r\n                            update(container);\r\n                        });\r\n                    };\r\n                    emit$1(button, internal.swap(), {\r\n                        transform: transform,\r\n                        swap: swap\r\n                    });\r\n                };\r\n            };\r\n            var cropPanelUpdate = function (_anyInSystem) {\r\n                imagePanel.showCrop();\r\n            };\r\n            var resizePanelUpdate = function (anyInSystem) {\r\n                memSize.getOpt(anyInSystem).each(function (sizeInput) {\r\n                    var measurements = imagePanel.getMeasurements();\r\n                    var width = measurements.width;\r\n                    var height = measurements.height;\r\n                    Representing.setValue(sizeInput, {\r\n                        width: width,\r\n                        height: height\r\n                    });\r\n                });\r\n            };\r\n            var sharpenTransform = Option.some(sharpen$1);\r\n            var invertTransform = Option.some(invert$1);\r\n            var buttonPanelComponents = [\r\n                createIconButton('crop', 'Crop', getTransformPanelEvent(CropPanel, none, cropPanelUpdate), false),\r\n                createIconButton('resize', 'Resize', getTransformPanelEvent(ResizePanel, none, resizePanelUpdate), false),\r\n                createIconButton('orientation', 'Orientation', getTransformPanelEvent(FlipRotatePanel, none, noop$1), false),\r\n                createIconButton('brightness', 'Brightness', getTransformPanelEvent(BrightnessPanel, none, noop$1), false),\r\n                createIconButton('sharpen', 'Sharpen', getTransformPanelEvent(FilterPanel, sharpenTransform, noop$1), false),\r\n                createIconButton('contrast', 'Contrast', getTransformPanelEvent(ContrastPanel, none, noop$1), false),\r\n                createIconButton('color-levels', 'Color levels', getTransformPanelEvent(ColorizePanel, none, noop$1), false),\r\n                createIconButton('gamma', 'Gamma', getTransformPanelEvent(GammaPanel, none, noop$1), false),\r\n                createIconButton('invert', 'Invert', getTransformPanelEvent(FilterPanel, invertTransform, noop$1), false)\r\n            ];\r\n            var ButtonPanel = Container.sketch({\r\n                dom: panelDom,\r\n                components: buttonPanelComponents.map(function (mem) {\r\n                    return mem.asSpec();\r\n                })\r\n            });\r\n            var container = Container.sketch({\r\n                dom: { tag: 'div' },\r\n                components: [ButtonPanel],\r\n                containerBehaviours: derive$1([Replacing.config({})])\r\n            });\r\n            var memContainer = record(container);\r\n            var getApplyButton = function (anyInSystem) {\r\n                return memContainer.getOpt(anyInSystem).map(function (container) {\r\n                    var panel = container.components()[0];\r\n                    return panel.components()[panel.components().length - 1];\r\n                });\r\n            };\r\n            return {\r\n                memContainer: memContainer,\r\n                getApplyButton: getApplyButton\r\n            };\r\n        };\r\n        var EditPanel = Object.freeze({\r\n            renderEditPanel: renderEditPanel\r\n        });\r\n        var global$8 = tinymce.util.Tools.resolve('tinymce.dom.DomQuery');\r\n        var global$9 = tinymce.util.Tools.resolve('tinymce.geom.Rect');\r\n        var global$a = tinymce.util.Tools.resolve('tinymce.util.Observable');\r\n        var global$b = tinymce.util.Tools.resolve('tinymce.util.Tools');\r\n        var global$c = tinymce.util.Tools.resolve('tinymce.util.VK');\r\n        function getDocumentSize(doc) {\r\n            var documentElement, body, scrollWidth, clientWidth;\r\n            var offsetWidth, scrollHeight, clientHeight, offsetHeight;\r\n            var max = Math.max;\r\n            documentElement = doc.documentElement;\r\n            body = doc.body;\r\n            scrollWidth = max(documentElement.scrollWidth, body.scrollWidth);\r\n            clientWidth = max(documentElement.clientWidth, body.clientWidth);\r\n            offsetWidth = max(documentElement.offsetWidth, body.offsetWidth);\r\n            scrollHeight = max(documentElement.scrollHeight, body.scrollHeight);\r\n            clientHeight = max(documentElement.clientHeight, body.clientHeight);\r\n            offsetHeight = max(documentElement.offsetHeight, body.offsetHeight);\r\n            return {\r\n                width: scrollWidth < offsetWidth ? clientWidth : scrollWidth,\r\n                height: scrollHeight < offsetHeight ? clientHeight : scrollHeight\r\n            };\r\n        }\r\n        function updateWithTouchData(e) {\r\n            var keys, i;\r\n            if (e.changedTouches) {\r\n                keys = 'screenX screenY pageX pageY clientX clientY'.split(' ');\r\n                for (i = 0; i < keys.length; i++) {\r\n                    e[keys[i]] = e.changedTouches[0][keys[i]];\r\n                }\r\n            }\r\n        }\r\n        function DragHelper(id, settings) {\r\n            var $eventOverlay;\r\n            var doc = settings.document || domGlobals.document;\r\n            var downButton;\r\n            var start, stop, drag, startX, startY;\r\n            settings = settings || {};\r\n            var handleElement = doc.getElementById(settings.handle || id);\r\n            start = function (e) {\r\n                var docSize = getDocumentSize(doc);\r\n                var handleElm, cursor;\r\n                updateWithTouchData(e);\r\n                e.preventDefault();\r\n                downButton = e.button;\r\n                handleElm = handleElement;\r\n                startX = e.screenX;\r\n                startY = e.screenY;\r\n                if (domGlobals.window.getComputedStyle) {\r\n                    cursor = domGlobals.window.getComputedStyle(handleElm, null).getPropertyValue('cursor');\r\n                }\r\n                else {\r\n                    cursor = handleElm.runtimeStyle.cursor;\r\n                }\r\n                $eventOverlay = global$8('<div></div>').css({\r\n                    position: 'absolute',\r\n                    top: 0,\r\n                    left: 0,\r\n                    width: docSize.width,\r\n                    height: docSize.height,\r\n                    zIndex: 2147483647,\r\n                    opacity: 0.0001,\r\n                    cursor: cursor\r\n                }).appendTo(doc.body);\r\n                global$8(doc).on('mousemove touchmove', drag).on('mouseup touchend', stop);\r\n                settings.start(e);\r\n            };\r\n            drag = function (e) {\r\n                updateWithTouchData(e);\r\n                if (e.button !== downButton) {\r\n                    return stop(e);\r\n                }\r\n                e.deltaX = e.screenX - startX;\r\n                e.deltaY = e.screenY - startY;\r\n                e.preventDefault();\r\n                settings.drag(e);\r\n            };\r\n            stop = function (e) {\r\n                updateWithTouchData(e);\r\n                global$8(doc).off('mousemove touchmove', drag).off('mouseup touchend', stop);\r\n                $eventOverlay.remove();\r\n                if (settings.stop) {\r\n                    settings.stop(e);\r\n                }\r\n            };\r\n            this.destroy = function () {\r\n                global$8(handleElement).off();\r\n            };\r\n            global$8(handleElement).on('mousedown touchstart', start);\r\n        }\r\n        var count = 0;\r\n        function CropRect(currentRect, viewPortRect, clampRect, containerElm, action) {\r\n            var instance;\r\n            var handles;\r\n            var dragHelpers;\r\n            var blockers;\r\n            var prefix = 'tox-';\r\n            var id = prefix + 'crid-' + count++;\r\n            handles = [\r\n                {\r\n                    name: 'move',\r\n                    xMul: 0,\r\n                    yMul: 0,\r\n                    deltaX: 1,\r\n                    deltaY: 1,\r\n                    deltaW: 0,\r\n                    deltaH: 0,\r\n                    label: 'Crop Mask'\r\n                },\r\n                {\r\n                    name: 'nw',\r\n                    xMul: 0,\r\n                    yMul: 0,\r\n                    deltaX: 1,\r\n                    deltaY: 1,\r\n                    deltaW: -1,\r\n                    deltaH: -1,\r\n                    label: 'Top Left Crop Handle'\r\n                },\r\n                {\r\n                    name: 'ne',\r\n                    xMul: 1,\r\n                    yMul: 0,\r\n                    deltaX: 0,\r\n                    deltaY: 1,\r\n                    deltaW: 1,\r\n                    deltaH: -1,\r\n                    label: 'Top Right Crop Handle'\r\n                },\r\n                {\r\n                    name: 'sw',\r\n                    xMul: 0,\r\n                    yMul: 1,\r\n                    deltaX: 1,\r\n                    deltaY: 0,\r\n                    deltaW: -1,\r\n                    deltaH: 1,\r\n                    label: 'Bottom Left Crop Handle'\r\n                },\r\n                {\r\n                    name: 'se',\r\n                    xMul: 1,\r\n                    yMul: 1,\r\n                    deltaX: 0,\r\n                    deltaY: 0,\r\n                    deltaW: 1,\r\n                    deltaH: 1,\r\n                    label: 'Bottom Right Crop Handle'\r\n                }\r\n            ];\r\n            blockers = [\r\n                'top',\r\n                'right',\r\n                'bottom',\r\n                'left'\r\n            ];\r\n            function getAbsoluteRect(outerRect, relativeRect) {\r\n                return {\r\n                    x: relativeRect.x + outerRect.x,\r\n                    y: relativeRect.y + outerRect.y,\r\n                    w: relativeRect.w,\r\n                    h: relativeRect.h\r\n                };\r\n            }\r\n            function getRelativeRect(outerRect, innerRect) {\r\n                return {\r\n                    x: innerRect.x - outerRect.x,\r\n                    y: innerRect.y - outerRect.y,\r\n                    w: innerRect.w,\r\n                    h: innerRect.h\r\n                };\r\n            }\r\n            function getInnerRect() {\r\n                return getRelativeRect(clampRect, currentRect);\r\n            }\r\n            function moveRect(handle, startRect, deltaX, deltaY) {\r\n                var x, y, w, h, rect;\r\n                x = startRect.x;\r\n                y = startRect.y;\r\n                w = startRect.w;\r\n                h = startRect.h;\r\n                x += deltaX * handle.deltaX;\r\n                y += deltaY * handle.deltaY;\r\n                w += deltaX * handle.deltaW;\r\n                h += deltaY * handle.deltaH;\r\n                if (w < 20) {\r\n                    w = 20;\r\n                }\r\n                if (h < 20) {\r\n                    h = 20;\r\n                }\r\n                rect = currentRect = global$9.clamp({\r\n                    x: x,\r\n                    y: y,\r\n                    w: w,\r\n                    h: h\r\n                }, clampRect, handle.name === 'move');\r\n                rect = getRelativeRect(clampRect, rect);\r\n                instance.fire('updateRect', { rect: rect });\r\n                setInnerRect(rect);\r\n            }\r\n            function render() {\r\n                function createDragHelper(handle) {\r\n                    var startRect;\r\n                    return new DragHelper(id, {\r\n                        document: containerElm.ownerDocument,\r\n                        handle: id + '-' + handle.name,\r\n                        start: function () {\r\n                            startRect = currentRect;\r\n                        },\r\n                        drag: function (e) {\r\n                            moveRect(handle, startRect, e.deltaX, e.deltaY);\r\n                        }\r\n                    });\r\n                }\r\n                global$8('<div id=\"' + id + '\" class=\"' + prefix + 'croprect-container\"' + ' role=\"grid\" aria-dropeffect=\"execute\">').appendTo(containerElm);\r\n                global$b.each(blockers, function (blocker) {\r\n                    global$8('#' + id, containerElm).append('<div id=\"' + id + '-' + blocker + '\"class=\"' + prefix + 'croprect-block\" style=\"display: none\" data-mce-bogus=\"all\">');\r\n                });\r\n                global$b.each(handles, function (handle) {\r\n                    global$8('#' + id, containerElm).append('<div id=\"' + id + '-' + handle.name + '\" class=\"' + prefix + 'croprect-handle ' + prefix + 'croprect-handle-' + handle.name + '\"' + 'style=\"display: none\" data-mce-bogus=\"all\" role=\"gridcell\" tabindex=\"-1\"' + ' aria-label=\"' + handle.label + '\" aria-grabbed=\"false\" title=\"' + handle.label + '\">');\r\n                });\r\n                dragHelpers = global$b.map(handles, createDragHelper);\r\n                repaint(currentRect);\r\n                global$8(containerElm).on('focusin focusout', function (e) {\r\n                    global$8(e.target).attr('aria-grabbed', e.type === 'focus' ? 'true' : 'false');\r\n                });\r\n                global$8(containerElm).on('keydown', function (e) {\r\n                    var activeHandle;\r\n                    global$b.each(handles, function (handle) {\r\n                        if (e.target.id === id + '-' + handle.name) {\r\n                            activeHandle = handle;\r\n                            return false;\r\n                        }\r\n                    });\r\n                    function moveAndBlock(evt, handle, startRect, deltaX, deltaY) {\r\n                        evt.stopPropagation();\r\n                        evt.preventDefault();\r\n                        moveRect(activeHandle, startRect, deltaX, deltaY);\r\n                    }\r\n                    switch (e.keyCode) {\r\n                        case global$c.LEFT:\r\n                            moveAndBlock(e, activeHandle, currentRect, -10, 0);\r\n                            break;\r\n                        case global$c.RIGHT:\r\n                            moveAndBlock(e, activeHandle, currentRect, 10, 0);\r\n                            break;\r\n                        case global$c.UP:\r\n                            moveAndBlock(e, activeHandle, currentRect, 0, -10);\r\n                            break;\r\n                        case global$c.DOWN:\r\n                            moveAndBlock(e, activeHandle, currentRect, 0, 10);\r\n                            break;\r\n                        case global$c.ENTER:\r\n                        case global$c.SPACEBAR:\r\n                            e.preventDefault();\r\n                            action();\r\n                            break;\r\n                    }\r\n                });\r\n            }\r\n            function toggleVisibility(state) {\r\n                var selectors;\r\n                selectors = global$b.map(handles, function (handle) {\r\n                    return '#' + id + '-' + handle.name;\r\n                }).concat(global$b.map(blockers, function (blocker) {\r\n                    return '#' + id + '-' + blocker;\r\n                })).join(',');\r\n                if (state) {\r\n                    global$8(selectors, containerElm).show();\r\n                }\r\n                else {\r\n                    global$8(selectors, containerElm).hide();\r\n                }\r\n            }\r\n            function repaint(rect) {\r\n                function updateElementRect(name, rect) {\r\n                    if (rect.h < 0) {\r\n                        rect.h = 0;\r\n                    }\r\n                    if (rect.w < 0) {\r\n                        rect.w = 0;\r\n                    }\r\n                    global$8('#' + id + '-' + name, containerElm).css({\r\n                        left: rect.x,\r\n                        top: rect.y,\r\n                        width: rect.w,\r\n                        height: rect.h\r\n                    });\r\n                }\r\n                global$b.each(handles, function (handle) {\r\n                    global$8('#' + id + '-' + handle.name, containerElm).css({\r\n                        left: rect.w * handle.xMul + rect.x,\r\n                        top: rect.h * handle.yMul + rect.y\r\n                    });\r\n                });\r\n                updateElementRect('top', {\r\n                    x: viewPortRect.x,\r\n                    y: viewPortRect.y,\r\n                    w: viewPortRect.w,\r\n                    h: rect.y - viewPortRect.y\r\n                });\r\n                updateElementRect('right', {\r\n                    x: rect.x + rect.w,\r\n                    y: rect.y,\r\n                    w: viewPortRect.w - rect.x - rect.w + viewPortRect.x,\r\n                    h: rect.h\r\n                });\r\n                updateElementRect('bottom', {\r\n                    x: viewPortRect.x,\r\n                    y: rect.y + rect.h,\r\n                    w: viewPortRect.w,\r\n                    h: viewPortRect.h - rect.y - rect.h + viewPortRect.y\r\n                });\r\n                updateElementRect('left', {\r\n                    x: viewPortRect.x,\r\n                    y: rect.y,\r\n                    w: rect.x - viewPortRect.x,\r\n                    h: rect.h\r\n                });\r\n                updateElementRect('move', rect);\r\n            }\r\n            function setRect(rect) {\r\n                currentRect = rect;\r\n                repaint(currentRect);\r\n            }\r\n            function setViewPortRect(rect) {\r\n                viewPortRect = rect;\r\n                repaint(currentRect);\r\n            }\r\n            function setInnerRect(rect) {\r\n                setRect(getAbsoluteRect(clampRect, rect));\r\n            }\r\n            function setClampRect(rect) {\r\n                clampRect = rect;\r\n                repaint(currentRect);\r\n            }\r\n            function destroy() {\r\n                global$b.each(dragHelpers, function (helper) {\r\n                    helper.destroy();\r\n                });\r\n                dragHelpers = [];\r\n            }\r\n            render();\r\n            instance = global$b.extend({\r\n                toggleVisibility: toggleVisibility,\r\n                setClampRect: setClampRect,\r\n                setRect: setRect,\r\n                getInnerRect: getInnerRect,\r\n                setInnerRect: setInnerRect,\r\n                setViewPortRect: setViewPortRect,\r\n                destroy: destroy\r\n            }, global$a);\r\n            return instance;\r\n        }\r\n        var loadImage = function (image) {\r\n            return new global$2(function (resolve) {\r\n                var loaded = function () {\r\n                    image.removeEventListener('load', loaded);\r\n                    resolve(image);\r\n                };\r\n                if (image.complete) {\r\n                    resolve(image);\r\n                }\r\n                else {\r\n                    image.addEventListener('load', loaded);\r\n                }\r\n            });\r\n        };\r\n        var renderImagePanel = function (initialUrl) {\r\n            var memBg = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-image-tools__image-bg'],\r\n                    attributes: { role: 'presentation' }\r\n                }\r\n            });\r\n            var zoomState = Cell(1);\r\n            var cropRect = Cell(Option.none());\r\n            var rectState = Cell({\r\n                x: 0,\r\n                y: 0,\r\n                w: 1,\r\n                h: 1\r\n            });\r\n            var viewRectState = Cell({\r\n                x: 0,\r\n                y: 0,\r\n                w: 1,\r\n                h: 1\r\n            });\r\n            var repaintImg = function (anyInSystem, img) {\r\n                memContainer.getOpt(anyInSystem).each(function (panel) {\r\n                    var zoom = zoomState.get();\r\n                    var panelW = get$7(panel.element());\r\n                    var panelH = get$8(panel.element());\r\n                    var width = img.dom().naturalWidth * zoom;\r\n                    var height = img.dom().naturalHeight * zoom;\r\n                    var left = Math.max(0, panelW / 2 - width / 2);\r\n                    var top = Math.max(0, panelH / 2 - height / 2);\r\n                    var css = {\r\n                        left: left.toString() + 'px',\r\n                        top: top.toString() + 'px',\r\n                        width: width.toString() + 'px',\r\n                        height: height.toString() + 'px',\r\n                        position: 'absolute'\r\n                    };\r\n                    setAll$1(img, css);\r\n                    memBg.getOpt(panel).each(function (bg) {\r\n                        setAll$1(bg.element(), css);\r\n                    });\r\n                    cropRect.get().each(function (cRect) {\r\n                        var rect = rectState.get();\r\n                        cRect.setRect({\r\n                            x: rect.x * zoom + left,\r\n                            y: rect.y * zoom + top,\r\n                            w: rect.w * zoom,\r\n                            h: rect.h * zoom\r\n                        });\r\n                        cRect.setClampRect({\r\n                            x: left,\r\n                            y: top,\r\n                            w: width,\r\n                            h: height\r\n                        });\r\n                        cRect.setViewPortRect({\r\n                            x: 0,\r\n                            y: 0,\r\n                            w: panelW,\r\n                            h: panelH\r\n                        });\r\n                    });\r\n                });\r\n            };\r\n            var zoomFit = function (anyInSystem, img) {\r\n                memContainer.getOpt(anyInSystem).each(function (panel) {\r\n                    var panelW = get$7(panel.element());\r\n                    var panelH = get$8(panel.element());\r\n                    var width = img.dom().naturalWidth;\r\n                    var height = img.dom().naturalHeight;\r\n                    var zoom = Math.min(panelW / width, panelH / height);\r\n                    if (zoom >= 1) {\r\n                        zoomState.set(1);\r\n                    }\r\n                    else {\r\n                        zoomState.set(zoom);\r\n                    }\r\n                });\r\n            };\r\n            var updateSrc = function (anyInSystem, url) {\r\n                var img = Element.fromTag('img');\r\n                set$1(img, 'src', url);\r\n                return loadImage(img.dom()).then(function () {\r\n                    return memContainer.getOpt(anyInSystem).map(function (panel) {\r\n                        var aImg = external({ element: img });\r\n                        Replacing.replaceAt(panel, 1, Option.some(aImg));\r\n                        var lastViewRect = viewRectState.get();\r\n                        var viewRect = {\r\n                            x: 0,\r\n                            y: 0,\r\n                            w: img.dom().naturalWidth,\r\n                            h: img.dom().naturalHeight\r\n                        };\r\n                        viewRectState.set(viewRect);\r\n                        var rect = global$9.inflate(viewRect, -20, -20);\r\n                        rectState.set(rect);\r\n                        if (lastViewRect.w !== viewRect.w || lastViewRect.h !== viewRect.h) {\r\n                            zoomFit(panel, img);\r\n                        }\r\n                        repaintImg(panel, img);\r\n                        return img;\r\n                    });\r\n                });\r\n            };\r\n            var zoom = function (anyInSystem, direction) {\r\n                var currentZoom = zoomState.get();\r\n                var newZoom = direction > 0 ? Math.min(2, currentZoom + 0.1) : Math.max(0.1, currentZoom - 0.1);\r\n                zoomState.set(newZoom);\r\n                memContainer.getOpt(anyInSystem).each(function (panel) {\r\n                    var img = panel.components()[1].element();\r\n                    repaintImg(panel, img);\r\n                });\r\n            };\r\n            var showCrop = function () {\r\n                cropRect.get().each(function (cRect) {\r\n                    cRect.toggleVisibility(true);\r\n                });\r\n            };\r\n            var hideCrop = function () {\r\n                cropRect.get().each(function (cRect) {\r\n                    cRect.toggleVisibility(false);\r\n                });\r\n            };\r\n            var getRect = function () {\r\n                return rectState.get();\r\n            };\r\n            var container = Container.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-image-tools__image']\r\n                },\r\n                components: [\r\n                    memBg.asSpec(),\r\n                    {\r\n                        dom: {\r\n                            tag: 'img',\r\n                            attributes: { src: initialUrl }\r\n                        }\r\n                    },\r\n                    {\r\n                        dom: { tag: 'div' },\r\n                        behaviours: derive$1([config('image-panel-crop-events', [runOnAttached(function (comp) {\r\n                                    memContainer.getOpt(comp).each(function (container) {\r\n                                        var el = container.element().dom();\r\n                                        var cRect = CropRect({\r\n                                            x: 10,\r\n                                            y: 10,\r\n                                            w: 100,\r\n                                            h: 100\r\n                                        }, {\r\n                                            x: 0,\r\n                                            y: 0,\r\n                                            w: 200,\r\n                                            h: 200\r\n                                        }, {\r\n                                            x: 0,\r\n                                            y: 0,\r\n                                            w: 200,\r\n                                            h: 200\r\n                                        }, el, function () {\r\n                                        });\r\n                                        cRect.toggleVisibility(false);\r\n                                        cRect.on('updateRect', function (e) {\r\n                                            var rect = e.rect;\r\n                                            var zoom = zoomState.get();\r\n                                            var newRect = {\r\n                                                x: Math.round(rect.x / zoom),\r\n                                                y: Math.round(rect.y / zoom),\r\n                                                w: Math.round(rect.w / zoom),\r\n                                                h: Math.round(rect.h / zoom)\r\n                                            };\r\n                                            rectState.set(newRect);\r\n                                        });\r\n                                        cropRect.set(Option.some(cRect));\r\n                                    });\r\n                                })])])\r\n                    }\r\n                ],\r\n                containerBehaviours: derive$1([\r\n                    Replacing.config({}),\r\n                    config('image-panel-events', [runOnAttached(function (comp) {\r\n                            updateSrc(comp, initialUrl);\r\n                        })])\r\n                ])\r\n            });\r\n            var memContainer = record(container);\r\n            var getMeasurements = function () {\r\n                var viewRect = viewRectState.get();\r\n                return {\r\n                    width: viewRect.w,\r\n                    height: viewRect.h\r\n                };\r\n            };\r\n            return {\r\n                memContainer: memContainer,\r\n                updateSrc: updateSrc,\r\n                zoom: zoom,\r\n                showCrop: showCrop,\r\n                hideCrop: hideCrop,\r\n                getRect: getRect,\r\n                getMeasurements: getMeasurements\r\n            };\r\n        };\r\n        var ImagePanel = Object.freeze({\r\n            renderImagePanel: renderImagePanel\r\n        });\r\n        var createButton = function (innerHtml, icon, disabled, action, providersBackstage) {\r\n            return renderIconButton({\r\n                name: innerHtml,\r\n                icon: Option.some(icon),\r\n                disabled: disabled,\r\n                tooltip: Option.some(innerHtml)\r\n            }, action, providersBackstage);\r\n        };\r\n        var setButtonEnabled = function (button, enabled) {\r\n            if (enabled) {\r\n                Disabling.enable(button);\r\n            }\r\n            else {\r\n                Disabling.disable(button);\r\n            }\r\n        };\r\n        var renderSideBar = function (providersBackstage) {\r\n            var updateButtonUndoStates = function (anyInSystem, undoEnabled, redoEnabled) {\r\n                memUndo.getOpt(anyInSystem).each(function (undo) {\r\n                    setButtonEnabled(undo, undoEnabled);\r\n                });\r\n                memRedo.getOpt(anyInSystem).each(function (redo) {\r\n                    setButtonEnabled(redo, redoEnabled);\r\n                });\r\n            };\r\n            var memUndo = record(createButton('Undo', 'undo', true, function (button) {\r\n                emitWith(button, internal.undo(), { direction: 1 });\r\n            }, providersBackstage));\r\n            var memRedo = record(createButton('Redo', 'redo', true, function (button) {\r\n                emitWith(button, internal.redo(), { direction: 1 });\r\n            }, providersBackstage));\r\n            var container = Container.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox-image-tools__toolbar',\r\n                        'tox-image-tools__sidebar'\r\n                    ]\r\n                },\r\n                components: [\r\n                    memUndo.asSpec(),\r\n                    memRedo.asSpec(),\r\n                    createButton('Zoom in', 'zoom-in', false, function (button) {\r\n                        emitWith(button, internal.zoom(), { direction: 1 });\r\n                    }, providersBackstage),\r\n                    createButton('Zoom out', 'zoom-out', false, function (button) {\r\n                        emitWith(button, internal.zoom(), { direction: -1 });\r\n                    }, providersBackstage)\r\n                ]\r\n            });\r\n            return {\r\n                container: container,\r\n                updateButtonUndoStates: updateButtonUndoStates\r\n            };\r\n        };\r\n        var SideBar = Object.freeze({\r\n            renderSideBar: renderSideBar\r\n        });\r\n        var url = function () {\r\n            return Global$1.getOrDie('URL');\r\n        };\r\n        var createObjectURL = function (blob) {\r\n            return url().createObjectURL(blob);\r\n        };\r\n        var revokeObjectURL = function (u) {\r\n            url().revokeObjectURL(u);\r\n        };\r\n        var URL = {\r\n            createObjectURL: createObjectURL,\r\n            revokeObjectURL: revokeObjectURL\r\n        };\r\n        function UndoStack() {\r\n            var data = [];\r\n            var index = -1;\r\n            function add(state) {\r\n                var removed;\r\n                removed = data.splice(++index);\r\n                data.push(state);\r\n                return {\r\n                    state: state,\r\n                    removed: removed\r\n                };\r\n            }\r\n            function undo() {\r\n                if (canUndo()) {\r\n                    return data[--index];\r\n                }\r\n            }\r\n            function redo() {\r\n                if (canRedo()) {\r\n                    return data[++index];\r\n                }\r\n            }\r\n            function canUndo() {\r\n                return index > 0;\r\n            }\r\n            function canRedo() {\r\n                return index !== -1 && index < data.length - 1;\r\n            }\r\n            return {\r\n                data: data,\r\n                add: add,\r\n                undo: undo,\r\n                redo: redo,\r\n                canUndo: canUndo,\r\n                canRedo: canRedo\r\n            };\r\n        }\r\n        var makeState = function (initialState) {\r\n            var blobState = Cell(initialState);\r\n            var tempState = Cell(Option.none());\r\n            var undoStack = UndoStack();\r\n            undoStack.add(initialState);\r\n            var getBlobState = function () {\r\n                return blobState.get();\r\n            };\r\n            var setBlobState = function (state) {\r\n                blobState.set(state);\r\n            };\r\n            var getTempState = function () {\r\n                return tempState.get().fold(function () {\r\n                    return blobState.get();\r\n                }, function (temp) {\r\n                    return temp;\r\n                });\r\n            };\r\n            var updateTempState = function (blob) {\r\n                var newTempState = createState(blob);\r\n                destroyTempState();\r\n                tempState.set(Option.some(newTempState));\r\n                return newTempState.url;\r\n            };\r\n            var createState = function (blob) {\r\n                return {\r\n                    blob: blob,\r\n                    url: URL.createObjectURL(blob)\r\n                };\r\n            };\r\n            var destroyState = function (state) {\r\n                URL.revokeObjectURL(state.url);\r\n            };\r\n            var destroyStates = function (states) {\r\n                global$b.each(states, destroyState);\r\n            };\r\n            var destroyTempState = function () {\r\n                tempState.get().each(destroyState);\r\n                tempState.set(Option.none());\r\n            };\r\n            var addBlobState = function (blob) {\r\n                var newState = createState(blob);\r\n                setBlobState(newState);\r\n                var removed = undoStack.add(newState).removed;\r\n                destroyStates(removed);\r\n                return newState.url;\r\n            };\r\n            var addTempState = function (blob) {\r\n                var newState = createState(blob);\r\n                tempState.set(Option.some(newState));\r\n                return newState.url;\r\n            };\r\n            var applyTempState = function (postApply) {\r\n                return tempState.get().fold(function () {\r\n                }, function (temp) {\r\n                    addBlobState(temp.blob);\r\n                    postApply();\r\n                });\r\n            };\r\n            var undo = function () {\r\n                var currentState = undoStack.undo();\r\n                setBlobState(currentState);\r\n                return currentState.url;\r\n            };\r\n            var redo = function () {\r\n                var currentState = undoStack.redo();\r\n                setBlobState(currentState);\r\n                return currentState.url;\r\n            };\r\n            var getHistoryStates = function () {\r\n                var undoEnabled = undoStack.canUndo();\r\n                var redoEnabled = undoStack.canRedo();\r\n                return {\r\n                    undoEnabled: undoEnabled,\r\n                    redoEnabled: redoEnabled\r\n                };\r\n            };\r\n            return {\r\n                getBlobState: getBlobState,\r\n                setBlobState: setBlobState,\r\n                addBlobState: addBlobState,\r\n                getTempState: getTempState,\r\n                updateTempState: updateTempState,\r\n                addTempState: addTempState,\r\n                applyTempState: applyTempState,\r\n                destroyTempState: destroyTempState,\r\n                undo: undo,\r\n                redo: redo,\r\n                getHistoryStates: getHistoryStates\r\n            };\r\n        };\r\n        var renderImageTools = function (detail, providersBackstage) {\r\n            var state = makeState(detail.currentState);\r\n            var zoom = function (anyInSystem, simulatedEvent) {\r\n                var direction = simulatedEvent.event().direction();\r\n                imagePanel.zoom(anyInSystem, direction);\r\n            };\r\n            var updateButtonUndoStates = function (anyInSystem) {\r\n                var historyStates = state.getHistoryStates();\r\n                sideBar.updateButtonUndoStates(anyInSystem, historyStates.undoEnabled, historyStates.redoEnabled);\r\n                emitWith(anyInSystem, external$2.formActionEvent, {\r\n                    name: external$2.saveState(),\r\n                    value: historyStates.undoEnabled\r\n                });\r\n            };\r\n            var disableUndoRedo = function (anyInSystem) {\r\n                sideBar.updateButtonUndoStates(anyInSystem, false, false);\r\n            };\r\n            var undo = function (anyInSystem, _simulatedEvent) {\r\n                var url = state.undo();\r\n                updateSrc(anyInSystem, url).then(function (oImg) {\r\n                    unblock(anyInSystem);\r\n                    updateButtonUndoStates(anyInSystem);\r\n                });\r\n            };\r\n            var redo = function (anyInSystem, _simulatedEvent) {\r\n                var url = state.redo();\r\n                updateSrc(anyInSystem, url).then(function (oImg) {\r\n                    unblock(anyInSystem);\r\n                    updateButtonUndoStates(anyInSystem);\r\n                });\r\n            };\r\n            var imageResultToBlob = function (ir) {\r\n                return ir.toBlob();\r\n            };\r\n            var block = function (anyInSystem) {\r\n                emitWith(anyInSystem, external$2.formActionEvent, {\r\n                    name: external$2.disable(),\r\n                    value: {}\r\n                });\r\n            };\r\n            var unblock = function (anyInSystem) {\r\n                editPanel.getApplyButton(anyInSystem).each(function (applyButton) {\r\n                    Disabling.enable(applyButton);\r\n                });\r\n                emitWith(anyInSystem, external$2.formActionEvent, {\r\n                    name: external$2.enable(),\r\n                    value: {}\r\n                });\r\n            };\r\n            var updateSrc = function (anyInSystem, src) {\r\n                block(anyInSystem);\r\n                return imagePanel.updateSrc(anyInSystem, src);\r\n            };\r\n            var blobManipulate = function (anyInSystem, blob, filter, action, swap) {\r\n                block(anyInSystem);\r\n                return blobToImageResult(blob).then(filter).then(imageResultToBlob).then(action).then(function (url) {\r\n                    return updateSrc(anyInSystem, url).then(function (oImg) {\r\n                        updateButtonUndoStates(anyInSystem);\r\n                        swap();\r\n                        unblock(anyInSystem);\r\n                        return oImg;\r\n                    });\r\n                }).catch(function (err) {\r\n                    domGlobals.console.log(err);\r\n                    unblock(anyInSystem);\r\n                    return err;\r\n                });\r\n            };\r\n            var manipulate = function (anyInSystem, filter, swap) {\r\n                var blob = state.getBlobState().blob;\r\n                var action = function (blob) {\r\n                    return state.updateTempState(blob);\r\n                };\r\n                blobManipulate(anyInSystem, blob, filter, action, swap);\r\n            };\r\n            var tempManipulate = function (anyInSystem, filter) {\r\n                var blob = state.getTempState().blob;\r\n                var action = function (blob) {\r\n                    return state.addTempState(blob);\r\n                };\r\n                blobManipulate(anyInSystem, blob, filter, action, noop);\r\n            };\r\n            var manipulateApply = function (anyInSystem, filter, swap) {\r\n                var blob = state.getBlobState().blob;\r\n                var action = function (blob) {\r\n                    var url = state.addBlobState(blob);\r\n                    destroyTempState(anyInSystem);\r\n                    return url;\r\n                };\r\n                blobManipulate(anyInSystem, blob, filter, action, swap);\r\n            };\r\n            var apply = function (anyInSystem, simulatedEvent) {\r\n                var postApply = function () {\r\n                    destroyTempState(anyInSystem);\r\n                    var swap = simulatedEvent.event().swap();\r\n                    swap();\r\n                };\r\n                state.applyTempState(postApply);\r\n            };\r\n            var destroyTempState = function (anyInSystem) {\r\n                var currentUrl = state.getBlobState().url;\r\n                state.destroyTempState();\r\n                updateButtonUndoStates(anyInSystem);\r\n                return currentUrl;\r\n            };\r\n            var cancel = function (anyInSystem) {\r\n                var currentUrl = destroyTempState(anyInSystem);\r\n                updateSrc(anyInSystem, currentUrl).then(function (oImg) {\r\n                    unblock(anyInSystem);\r\n                });\r\n            };\r\n            var back = function (anyInSystem, simulatedEvent) {\r\n                cancel(anyInSystem);\r\n                var swap = simulatedEvent.event().swap();\r\n                swap();\r\n                imagePanel.hideCrop();\r\n            };\r\n            var transform = function (anyInSystem, simulatedEvent) {\r\n                return manipulate(anyInSystem, simulatedEvent.event().transform(), noop);\r\n            };\r\n            var tempTransform = function (anyInSystem, simulatedEvent) {\r\n                return tempManipulate(anyInSystem, simulatedEvent.event().transform());\r\n            };\r\n            var transformApply = function (anyInSystem, simulatedEvent) {\r\n                return manipulateApply(anyInSystem, simulatedEvent.event().transform(), simulatedEvent.event().swap());\r\n            };\r\n            var imagePanel = renderImagePanel(detail.currentState.url);\r\n            var sideBar = renderSideBar(providersBackstage);\r\n            var editPanel = renderEditPanel(imagePanel, providersBackstage);\r\n            var swap = function (anyInSystem, simulatedEvent) {\r\n                disableUndoRedo(anyInSystem);\r\n                var transform = simulatedEvent.event().transform();\r\n                var swap = simulatedEvent.event().swap();\r\n                transform.fold(function () {\r\n                    swap();\r\n                }, function (transform) {\r\n                    manipulate(anyInSystem, transform, swap);\r\n                });\r\n            };\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { role: 'presentation' }\r\n                },\r\n                components: [\r\n                    editPanel.memContainer.asSpec(),\r\n                    imagePanel.memContainer.asSpec(),\r\n                    sideBar.container\r\n                ],\r\n                behaviours: derive$1([\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'manual',\r\n                            getValue: function () {\r\n                                return state.getBlobState();\r\n                            }\r\n                        }\r\n                    }),\r\n                    config('image-tools-events', [\r\n                        run(internal.undo(), undo),\r\n                        run(internal.redo(), redo),\r\n                        run(internal.zoom(), zoom),\r\n                        run(internal.back(), back),\r\n                        run(internal.apply(), apply),\r\n                        run(internal.transform(), transform),\r\n                        run(internal.tempTransform(), tempTransform),\r\n                        run(internal.transformApply(), transformApply),\r\n                        run(internal.swap(), swap)\r\n                    ]),\r\n                    ComposingConfigs.self()\r\n                ])\r\n            };\r\n        };\r\n        var factory$8 = function (detail, spec) {\r\n            var options = map(detail.options, function (option) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'option',\r\n                        value: option.value,\r\n                        innerHtml: option.text\r\n                    }\r\n                };\r\n            });\r\n            var initialValues = detail.data.map(function (v) {\r\n                return wrap$1('initialValue', v);\r\n            }).getOr({});\r\n            return {\r\n                uid: detail.uid,\r\n                dom: {\r\n                    tag: 'select',\r\n                    classes: detail.selectClasses,\r\n                    attributes: detail.selectAttributes\r\n                },\r\n                components: options,\r\n                behaviours: augment(detail.selectBehaviours, [\r\n                    Focusing.config({}),\r\n                    Representing.config({\r\n                        store: __assign({\r\n                            mode: 'manual',\r\n                            getValue: function (select) {\r\n                                return get$5(select.element());\r\n                            },\r\n                            setValue: function (select, newValue) {\r\n                                var found = find(detail.options, function (opt) {\r\n                                    return opt.value === newValue;\r\n                                });\r\n                                if (found.isSome()) {\r\n                                    set$3(select.element(), newValue);\r\n                                }\r\n                            }\r\n                        }, initialValues)\r\n                    })\r\n                ])\r\n            };\r\n        };\r\n        var HtmlSelect = single$2({\r\n            name: 'HtmlSelect',\r\n            configFields: [\r\n                strict$1('options'),\r\n                field$1('selectBehaviours', [\r\n                    Focusing,\r\n                    Representing\r\n                ]),\r\n                defaulted$1('selectClasses', []),\r\n                defaulted$1('selectAttributes', {}),\r\n                option('data')\r\n            ],\r\n            factory: factory$8\r\n        });\r\n        var renderSelectBox = function (spec, providersBackstage) {\r\n            var translatedOptions = map(spec.items, function (item) {\r\n                return {\r\n                    text: providersBackstage.translate(item.text),\r\n                    value: item.value\r\n                };\r\n            });\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, providersBackstage);\r\n            });\r\n            var pField = FormField.parts().field({\r\n                dom: {},\r\n                selectAttributes: { size: spec.size },\r\n                options: translatedOptions,\r\n                factory: HtmlSelect,\r\n                selectBehaviours: derive$1([\r\n                    Tabstopping.config({}),\r\n                    config('selectbox-change', [run(change(), function (component, _) {\r\n                            emitWith(component, formChangeEvent, { name: spec.name });\r\n                        })])\r\n                ])\r\n            });\r\n            var chevron = spec.size > 1 ? Option.none() : Option.some({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-selectfield__icon-js'],\r\n                    innerHtml: get$c('chevron-down', providersBackstage.icons)\r\n                }\r\n            });\r\n            var selectWrap = {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-selectfield']\r\n                },\r\n                components: flatten([\r\n                    [pField],\r\n                    chevron.toArray()\r\n                ])\r\n            };\r\n            return FormField.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-form__group']\r\n                },\r\n                components: flatten([\r\n                    pLabel.toArray(),\r\n                    [selectWrap]\r\n                ])\r\n            });\r\n        };\r\n        var renderTextField = function (spec, providersBackstage) {\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, providersBackstage);\r\n            });\r\n            var baseInputBehaviours = [\r\n                Keying.config({\r\n                    mode: 'execution',\r\n                    useEnter: spec.multiline !== true,\r\n                    useControlEnter: spec.multiline === true,\r\n                    execute: function (comp) {\r\n                        emit(comp, formSubmitEvent);\r\n                        return Option.some(true);\r\n                    }\r\n                }),\r\n                config('textfield-change', [\r\n                    run(input(), function (component, _) {\r\n                        emitWith(component, formChangeEvent, { name: spec.name });\r\n                    }),\r\n                    run(postPaste(), function (component, _) {\r\n                        emitWith(component, formChangeEvent, { name: spec.name });\r\n                    })\r\n                ]),\r\n                Tabstopping.config({})\r\n            ];\r\n            var validatingBehaviours = spec.validation.map(function (vl) {\r\n                return Invalidating.config({\r\n                    getRoot: function (input) {\r\n                        return parent(input.element());\r\n                    },\r\n                    invalidClass: 'tox-invalid',\r\n                    validator: {\r\n                        validate: function (input) {\r\n                            var v = Representing.getValue(input);\r\n                            var result = vl.validator(v);\r\n                            return Future.pure(result === true ? Result.value(v) : Result.error(result));\r\n                        },\r\n                        validateOnLoad: vl.validateOnLoad\r\n                    }\r\n                });\r\n            }).toArray();\r\n            var pField = FormField.parts().field({\r\n                tag: spec.multiline === true ? 'textarea' : 'input',\r\n                inputAttributes: spec.placeholder.fold(function () {\r\n                }, function (placeholder) {\r\n                    return { placeholder: providersBackstage.translate(placeholder) };\r\n                }),\r\n                inputClasses: [spec.classname],\r\n                inputBehaviours: derive$1(flatten([\r\n                    baseInputBehaviours,\r\n                    validatingBehaviours\r\n                ])),\r\n                selectOnFocus: false,\r\n                factory: Input\r\n            });\r\n            var extraClasses = spec.flex ? ['tox-form__group--stretched'] : [];\r\n            return renderFormFieldWith(pLabel, pField, extraClasses);\r\n        };\r\n        var renderInput = function (spec, providersBackstage) {\r\n            return renderTextField({\r\n                name: spec.name,\r\n                multiline: false,\r\n                label: spec.label,\r\n                placeholder: spec.placeholder,\r\n                flex: false,\r\n                classname: 'tox-textfield',\r\n                validation: Option.none()\r\n            }, providersBackstage);\r\n        };\r\n        var renderTextarea = function (spec, providersBackstage) {\r\n            return renderTextField({\r\n                name: spec.name,\r\n                multiline: true,\r\n                label: spec.label,\r\n                placeholder: spec.placeholder,\r\n                flex: true,\r\n                classname: 'tox-textarea',\r\n                validation: Option.none()\r\n            }, providersBackstage);\r\n        };\r\n        var wrap$2 = function (delegate) {\r\n            var toCached = function () {\r\n                return wrap$2(delegate.toCached());\r\n            };\r\n            var bindFuture = function (f) {\r\n                return wrap$2(delegate.bind(function (resA) {\r\n                    return resA.fold(function (err) {\r\n                        return Future.pure(Result.error(err));\r\n                    }, function (a) {\r\n                        return f(a);\r\n                    });\r\n                }));\r\n            };\r\n            var bindResult = function (f) {\r\n                return wrap$2(delegate.map(function (resA) {\r\n                    return resA.bind(f);\r\n                }));\r\n            };\r\n            var mapResult = function (f) {\r\n                return wrap$2(delegate.map(function (resA) {\r\n                    return resA.map(f);\r\n                }));\r\n            };\r\n            var mapError = function (f) {\r\n                return wrap$2(delegate.map(function (resA) {\r\n                    return resA.mapError(f);\r\n                }));\r\n            };\r\n            var foldResult = function (whenError, whenValue) {\r\n                return delegate.map(function (res) {\r\n                    return res.fold(whenError, whenValue);\r\n                });\r\n            };\r\n            var withTimeout = function (timeout, errorThunk) {\r\n                return wrap$2(Future.nu(function (callback) {\r\n                    var timedOut = false;\r\n                    var timer = domGlobals.setTimeout(function () {\r\n                        timedOut = true;\r\n                        callback(Result.error(errorThunk()));\r\n                    }, timeout);\r\n                    delegate.get(function (result) {\r\n                        if (!timedOut) {\r\n                            domGlobals.clearTimeout(timer);\r\n                            callback(result);\r\n                        }\r\n                    });\r\n                }));\r\n            };\r\n            return __assign({}, delegate, {\r\n                toCached: toCached,\r\n                bindFuture: bindFuture,\r\n                bindResult: bindResult,\r\n                mapResult: mapResult,\r\n                mapError: mapError,\r\n                foldResult: foldResult,\r\n                withTimeout: withTimeout\r\n            });\r\n        };\r\n        var nu$c = function (worker) {\r\n            return wrap$2(Future.nu(worker));\r\n        };\r\n        var value$3 = function (value) {\r\n            return wrap$2(Future.pure(Result.value(value)));\r\n        };\r\n        var error$1 = function (error) {\r\n            return wrap$2(Future.pure(Result.error(error)));\r\n        };\r\n        var fromResult$1 = function (result) {\r\n            return wrap$2(Future.pure(result));\r\n        };\r\n        var fromFuture = function (future) {\r\n            return wrap$2(future.map(Result.value));\r\n        };\r\n        var fromPromise = function (promise) {\r\n            return nu$c(function (completer) {\r\n                promise.then(function (value) {\r\n                    completer(Result.value(value));\r\n                }, function (error) {\r\n                    completer(Result.error(error));\r\n                });\r\n            });\r\n        };\r\n        var FutureResult = {\r\n            nu: nu$c,\r\n            wrap: wrap$2,\r\n            pure: value$3,\r\n            value: value$3,\r\n            error: error$1,\r\n            fromResult: fromResult$1,\r\n            fromFuture: fromFuture,\r\n            fromPromise: fromPromise\r\n        };\r\n        var separator$2 = { type: 'separator' };\r\n        var toMenuItem = function (target) {\r\n            return {\r\n                type: 'menuitem',\r\n                value: target.url,\r\n                text: target.title,\r\n                meta: { attach: target.attach },\r\n                onAction: function () {\r\n                }\r\n            };\r\n        };\r\n        var staticMenuItem = function (title, url) {\r\n            return {\r\n                type: 'menuitem',\r\n                value: url,\r\n                text: title,\r\n                meta: { attach: undefined },\r\n                onAction: function () {\r\n                }\r\n            };\r\n        };\r\n        var toMenuItems = function (targets) {\r\n            return map(targets, toMenuItem);\r\n        };\r\n        var filterLinkTargets = function (type, targets) {\r\n            return filter(targets, function (target) {\r\n                return target.type === type;\r\n            });\r\n        };\r\n        var filteredTargets = function (type, targets) {\r\n            return toMenuItems(filterLinkTargets(type, targets));\r\n        };\r\n        var headerTargets = function (linkInfo) {\r\n            return filteredTargets('header', linkInfo.targets);\r\n        };\r\n        var anchorTargets = function (linkInfo) {\r\n            return filteredTargets('anchor', linkInfo.targets);\r\n        };\r\n        var anchorTargetTop = function (linkInfo) {\r\n            return Option.from(linkInfo.anchorTop).map(function (url) {\r\n                return staticMenuItem('<top>', url);\r\n            }).toArray();\r\n        };\r\n        var anchorTargetBottom = function (linkInfo) {\r\n            return Option.from(linkInfo.anchorBottom).map(function (url) {\r\n                return staticMenuItem('<bottom>', url);\r\n            }).toArray();\r\n        };\r\n        var historyTargets = function (history) {\r\n            return map(history, function (url) {\r\n                return staticMenuItem(url, url);\r\n            });\r\n        };\r\n        var joinMenuLists = function (items) {\r\n            return foldl(items, function (a, b) {\r\n                var bothEmpty = a.length === 0 || b.length === 0;\r\n                return bothEmpty ? a.concat(b) : a.concat(separator$2, b);\r\n            }, []);\r\n        };\r\n        var filterByQuery = function (term, menuItems) {\r\n            var lowerCaseTerm = term.toLowerCase();\r\n            return filter(menuItems, function (item) {\r\n                var text = item.meta !== undefined && item.meta.text !== undefined ? item.meta.text : item.text;\r\n                return contains$1(text.toLowerCase(), lowerCaseTerm) || contains$1(item.value.toLowerCase(), lowerCaseTerm);\r\n            });\r\n        };\r\n        var getItems = function (fileType, input, urlBackstage) {\r\n            var urlInputValue = Representing.getValue(input);\r\n            var term = urlInputValue.meta.text !== undefined ? urlInputValue.meta.text : urlInputValue.value;\r\n            var info = urlBackstage.getLinkInformation();\r\n            return info.fold(function () {\r\n                return [];\r\n            }, function (linkInfo) {\r\n                var history = filterByQuery(term, historyTargets(urlBackstage.getHistory(fileType)));\r\n                return fileType === 'file' ? joinMenuLists([\r\n                    history,\r\n                    filterByQuery(term, headerTargets(linkInfo)),\r\n                    filterByQuery(term, flatten([\r\n                        anchorTargetTop(linkInfo),\r\n                        anchorTargets(linkInfo),\r\n                        anchorTargetBottom(linkInfo)\r\n                    ]))\r\n                ]) : history;\r\n            });\r\n        };\r\n        var renderInputButton = function (label, eventName, className, iconName, providersBackstage) {\r\n            return Button.sketch({\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: [\r\n                        'tox-tbtn',\r\n                        className\r\n                    ],\r\n                    innerHtml: get$c(iconName, providersBackstage.icons),\r\n                    attributes: { title: providersBackstage.translate(label.getOr('')) }\r\n                },\r\n                buttonBehaviours: derive$1([Tabstopping.config({})]),\r\n                action: function (component) {\r\n                    emit(component, eventName);\r\n                }\r\n            });\r\n        };\r\n        var errorId = generate$1('aria-invalid');\r\n        var renderUrlInput = function (spec, backstage, urlBackstage) {\r\n            var _a;\r\n            var providersBackstage = backstage.shared.providers;\r\n            var updateHistory = function (component) {\r\n                var urlEntry = Representing.getValue(component);\r\n                urlBackstage.addToHistory(urlEntry.value, spec.filetype);\r\n            };\r\n            var pField = FormField.parts().field({\r\n                factory: Typeahead,\r\n                dismissOnBlur: true,\r\n                inputClasses: ['tox-textfield'],\r\n                sandboxClasses: ['tox-dialog__popups'],\r\n                inputAttributes: { 'aria-errormessage': errorId },\r\n                minChars: 0,\r\n                responseTime: 0,\r\n                fetch: function (input) {\r\n                    var items = getItems(spec.filetype, input, urlBackstage);\r\n                    var tdata = build$2(items, ItemResponse$1.BUBBLE_TO_SANDBOX, backstage);\r\n                    return Future.pure(tdata);\r\n                },\r\n                getHotspot: function (comp) {\r\n                    return memUrlBox.getOpt(comp);\r\n                },\r\n                onSetValue: function (comp, newValue) {\r\n                    if (comp.hasConfigured(Invalidating)) {\r\n                        Invalidating.run(comp).get(noop);\r\n                    }\r\n                },\r\n                typeaheadBehaviours: derive$1(flatten([\r\n                    urlBackstage.getValidationHandler().map(function (handler) {\r\n                        return Invalidating.config({\r\n                            getRoot: function (comp) {\r\n                                return parent(comp.element());\r\n                            },\r\n                            invalidClass: 'tox-control-wrap--status-invalid',\r\n                            notify: {\r\n                                onInvalid: function (comp, err) {\r\n                                    memInvalidIcon.getOpt(comp).each(function (invalidComp) {\r\n                                        set$1(invalidComp.element(), 'title', providersBackstage.translate(err));\r\n                                    });\r\n                                }\r\n                            },\r\n                            validator: {\r\n                                validate: function (input) {\r\n                                    var urlEntry = Representing.getValue(input);\r\n                                    return FutureResult.nu(function (completer) {\r\n                                        handler({\r\n                                            type: spec.filetype,\r\n                                            url: urlEntry.value\r\n                                        }, function (validation) {\r\n                                            completer((validation.status === 'invalid' ? Result.error : Result.value)(validation.message));\r\n                                        });\r\n                                    });\r\n                                },\r\n                                validateOnLoad: false\r\n                            }\r\n                        });\r\n                    }).toArray(),\r\n                    [\r\n                        Tabstopping.config({}),\r\n                        config('urlinput-events', flatten([\r\n                            spec.filetype === 'file' ? [run(input(), function (comp) {\r\n                                    emitWith(comp, formChangeEvent, { name: spec.name });\r\n                                })] : [],\r\n                            [\r\n                                run(change(), function (comp) {\r\n                                    emitWith(comp, formChangeEvent, { name: spec.name });\r\n                                    updateHistory(comp);\r\n                                }),\r\n                                run(postPaste(), function (comp) {\r\n                                    emitWith(comp, formChangeEvent, { name: spec.name });\r\n                                    updateHistory(comp);\r\n                                })\r\n                            ]\r\n                        ]))\r\n                    ]\r\n                ])),\r\n                eventOrder: (_a = {}, _a[input()] = [\r\n                    'streaming',\r\n                    'urlinput-events',\r\n                    'invalidating'\r\n                ], _a),\r\n                model: {\r\n                    getDisplayText: function (itemData) {\r\n                        return itemData.value;\r\n                    },\r\n                    selectsOver: false,\r\n                    populateFromBrowse: false\r\n                },\r\n                markers: { openClass: 'dog' },\r\n                lazySink: backstage.shared.getSink,\r\n                parts: { menu: part(false, 1, 'normal') },\r\n                onExecute: function (_menu, component, _entry) {\r\n                    emitWith(component, formSubmitEvent, {});\r\n                },\r\n                onItemExecute: function (typeahead, _sandbox, _item, _value) {\r\n                    updateHistory(typeahead);\r\n                    emitWith(typeahead, formChangeEvent, { name: spec.name });\r\n                }\r\n            });\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, providersBackstage);\r\n            });\r\n            var makeIcon = function (name, errId, icon, label) {\r\n                if (icon === void 0) {\r\n                    icon = name;\r\n                }\r\n                if (label === void 0) {\r\n                    label = name;\r\n                }\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: [\r\n                            'tox-icon',\r\n                            'tox-control-wrap__status-icon-' + name\r\n                        ],\r\n                        innerHtml: get$c(icon, providersBackstage.icons),\r\n                        attributes: __assign({\r\n                            'title': providersBackstage.translate(label),\r\n                            'aria-live': 'polite'\r\n                        }, errId.fold(function () {\r\n                            return {};\r\n                        }, function (id) {\r\n                            return { id: id };\r\n                        }))\r\n                    }\r\n                };\r\n            };\r\n            var memInvalidIcon = record(makeIcon('invalid', Option.some(errorId), 'warning'));\r\n            var memStatus = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-control-wrap__status-icon-wrap']\r\n                },\r\n                components: [memInvalidIcon.asSpec()]\r\n            });\r\n            var optUrlPicker = urlBackstage.getUrlPicker(spec.filetype);\r\n            var browseUrlEvent = generate$1('browser.url.event');\r\n            var memUrlBox = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-control-wrap']\r\n                },\r\n                components: [\r\n                    pField,\r\n                    memStatus.asSpec()\r\n                ]\r\n            });\r\n            var controlHWrapper = function () {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-form__controls-h-stack']\r\n                    },\r\n                    components: flatten([\r\n                        [memUrlBox.asSpec()],\r\n                        optUrlPicker.map(function () {\r\n                            return renderInputButton(spec.label, browseUrlEvent, 'tox-browse-url', 'browse', providersBackstage);\r\n                        }).toArray()\r\n                    ])\r\n                };\r\n            };\r\n            var openUrlPicker = function (comp) {\r\n                Composing.getCurrent(comp).each(function (field) {\r\n                    var urlData = Representing.getValue(field);\r\n                    optUrlPicker.each(function (picker) {\r\n                        picker(urlData).get(function (chosenData) {\r\n                            Representing.setValue(field, chosenData);\r\n                            emitWith(comp, formChangeEvent, { name: spec.name });\r\n                        });\r\n                    });\r\n                });\r\n            };\r\n            return FormField.sketch({\r\n                dom: renderFormFieldDom(),\r\n                components: pLabel.toArray().concat([controlHWrapper()]),\r\n                fieldBehaviours: derive$1([config('url-input-events', [run(browseUrlEvent, openUrlPicker)])])\r\n            });\r\n        };\r\n        var renderCheckbox = function (spec, providerBackstage) {\r\n            var repBehaviour = Representing.config({\r\n                store: {\r\n                    mode: 'manual',\r\n                    getValue: function (comp) {\r\n                        var el = comp.element().dom();\r\n                        return el.checked;\r\n                    },\r\n                    setValue: function (comp, value) {\r\n                        var el = comp.element().dom();\r\n                        el.checked = value;\r\n                    }\r\n                }\r\n            });\r\n            var toggleCheckboxHandler = function (comp) {\r\n                comp.element().dom().click();\r\n                return Option.some(true);\r\n            };\r\n            var pField = FormField.parts().field({\r\n                factory: { sketch: identity },\r\n                dom: {\r\n                    tag: 'input',\r\n                    classes: ['tox-checkbox__input'],\r\n                    attributes: { type: 'checkbox' }\r\n                },\r\n                behaviours: derive$1([\r\n                    ComposingConfigs.self(),\r\n                    Tabstopping.config({}),\r\n                    Focusing.config({}),\r\n                    repBehaviour,\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onEnter: toggleCheckboxHandler,\r\n                        onSpace: toggleCheckboxHandler,\r\n                        stopSpaceKeyup: true\r\n                    }),\r\n                    config('checkbox-events', [run(change(), function (component, _) {\r\n                            emitWith(component, formChangeEvent, { name: spec.name });\r\n                        })])\r\n                ])\r\n            });\r\n            var pLabel = FormField.parts().label({\r\n                dom: {\r\n                    tag: 'span',\r\n                    classes: ['tox-checkbox__label'],\r\n                    innerHtml: providerBackstage.translate(spec.label)\r\n                },\r\n                behaviours: derive$1([Unselecting.config({})])\r\n            });\r\n            var makeIcon = function (className) {\r\n                var iconName = className === 'checked' ? 'selected' : 'unselected';\r\n                return {\r\n                    dom: {\r\n                        tag: 'span',\r\n                        classes: [\r\n                            'tox-icon',\r\n                            'tox-checkbox-icon__' + className\r\n                        ],\r\n                        innerHtml: get$c(iconName, providerBackstage.icons)\r\n                    }\r\n                };\r\n            };\r\n            var memIcons = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-checkbox__icons']\r\n                },\r\n                components: [\r\n                    makeIcon('checked'),\r\n                    makeIcon('unchecked')\r\n                ]\r\n            });\r\n            return FormField.sketch({\r\n                dom: {\r\n                    tag: 'label',\r\n                    classes: ['tox-checkbox']\r\n                },\r\n                components: [\r\n                    pField,\r\n                    memIcons.asSpec(),\r\n                    pLabel\r\n                ]\r\n            });\r\n        };\r\n        var renderHtmlPanel = function (spec) {\r\n            if (spec.presets === 'presentation') {\r\n                return Container.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-form__group'],\r\n                        innerHtml: spec.html\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                return Container.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-form__group'],\r\n                        innerHtml: spec.html,\r\n                        attributes: { role: 'document' }\r\n                    },\r\n                    containerBehaviours: derive$1([\r\n                        Tabstopping.config({}),\r\n                        Focusing.config({})\r\n                    ])\r\n                });\r\n            }\r\n        };\r\n        var renderListbox = function (spec, providersBackstage) {\r\n            var pLabel = renderLabel(spec.label, providersBackstage);\r\n            var pField = FormField.parts().field({\r\n                factory: HtmlSelect,\r\n                dom: { classes: ['mce-select-field'] },\r\n                selectBehaviours: derive$1([Tabstopping.config({})]),\r\n                options: spec.values,\r\n                data: spec.initialValue.getOr(undefined)\r\n            });\r\n            return renderFormField(Option.some(pLabel), pField);\r\n        };\r\n        var renderLabel$2 = function (spec, backstageShared) {\r\n            var label = {\r\n                dom: {\r\n                    tag: 'label',\r\n                    innerHtml: backstageShared.providers.translate(spec.label),\r\n                    classes: ['tox-label']\r\n                }\r\n            };\r\n            var comps = map(spec.items, backstageShared.interpreter);\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-form__group']\r\n                },\r\n                components: [label].concat(comps),\r\n                behaviours: derive$1([\r\n                    ComposingConfigs.self(),\r\n                    Replacing.config({}),\r\n                    RepresentingConfigs.domHtml(Option.none()),\r\n                    Keying.config({ mode: 'acyclic' })\r\n                ])\r\n            };\r\n        };\r\n        var renderCollection = function (spec, providersBackstage) {\r\n            var pLabel = spec.label.map(function (label) {\r\n                return renderLabel(label, providersBackstage);\r\n            });\r\n            var runOnItem = function (f) {\r\n                return function (comp, se) {\r\n                    closest$3(se.event().target(), '[data-collection-item-value]').each(function (target) {\r\n                        f(comp, target, get$2(target, 'data-collection-item-value'));\r\n                    });\r\n                };\r\n            };\r\n            var escapeAttribute = function (ch) {\r\n                if (ch === '\"') {\r\n                    return '&quot;';\r\n                }\r\n                return ch;\r\n            };\r\n            var setContents = function (comp, items) {\r\n                var htmlLines = map(items, function (item) {\r\n                    var textContent = spec.columns === 1 ? '<div class=\"tox-collection__item-label\">' + item.text + '</div>' : '';\r\n                    var iconContent = '<div class=\"tox-collection__item-icon\">' + item.icon + '</div>';\r\n                    var mapItemName = {\r\n                        '_': ' ',\r\n                        ' - ': ' ',\r\n                        '-': ' '\r\n                    };\r\n                    var ariaLabel = item.text.replace(/\\_| \\- |\\-/g, function (match) {\r\n                        return mapItemName[match];\r\n                    });\r\n                    return '<div class=\"tox-collection__item\" tabindex=\"-1\" data-collection-item-value=\"' + escapeAttribute(item.value) + '\" title=\"' + ariaLabel + '\" aria-label=\"' + ariaLabel + '\">' + iconContent + textContent + '</div>';\r\n                });\r\n                var chunks = spec.columns > 1 && spec.columns !== 'auto' ? chunk(htmlLines, spec.columns) : [htmlLines];\r\n                var html = map(chunks, function (ch) {\r\n                    return '<div class=\"tox-collection__group\">' + ch.join('') + '</div>';\r\n                });\r\n                set(comp.element(), html.join(''));\r\n            };\r\n            var collectionEvents = [\r\n                run(mouseover(), runOnItem(function (comp, tgt) {\r\n                    focus$1(tgt);\r\n                })),\r\n                run(tapOrClick(), runOnItem(function (comp, tgt, itemValue) {\r\n                    emitWith(comp, formActionEvent, {\r\n                        name: spec.name,\r\n                        value: itemValue\r\n                    });\r\n                })),\r\n                run(focusin(), runOnItem(function (comp, tgt, itemValue) {\r\n                    descendant$2(comp.element(), '.' + activeClass).each(function (currentActive) {\r\n                        remove$4(currentActive, activeClass);\r\n                    });\r\n                    add$2(tgt, activeClass);\r\n                })),\r\n                run(focusout(), runOnItem(function (comp, tgt, itemValue) {\r\n                    descendant$2(comp.element(), '.' + activeClass).each(function (currentActive) {\r\n                        remove$4(currentActive, activeClass);\r\n                    });\r\n                })),\r\n                runOnExecute(runOnItem(function (comp, tgt, itemValue) {\r\n                    emitWith(comp, formActionEvent, {\r\n                        name: spec.name,\r\n                        value: itemValue\r\n                    });\r\n                }))\r\n            ];\r\n            var pField = FormField.parts().field({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-collection'].concat(spec.columns !== 1 ? ['tox-collection--grid'] : ['tox-collection--list'])\r\n                },\r\n                components: [],\r\n                factory: { sketch: identity },\r\n                behaviours: derive$1([\r\n                    Replacing.config({}),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: []\r\n                        },\r\n                        onSetValue: function (comp, items) {\r\n                            setContents(comp, items);\r\n                            if (spec.columns === 'auto') {\r\n                                detectSize(comp, 5, 'tox-collection__item').each(function (_a) {\r\n                                    var numRows = _a.numRows, numColumns = _a.numColumns;\r\n                                    Keying.setGridSize(comp, numRows, numColumns);\r\n                                });\r\n                            }\r\n                            emit(comp, formResizeEvent);\r\n                        }\r\n                    }),\r\n                    Tabstopping.config({}),\r\n                    Keying.config(deriveCollectionMovement(spec.columns, 'normal')),\r\n                    config('collection-events', collectionEvents)\r\n                ])\r\n            });\r\n            var extraClasses = ['tox-form__group--collection'];\r\n            return renderFormFieldWith(pLabel, pField, extraClasses);\r\n        };\r\n        var renderTable = function (spec, providersBackstage) {\r\n            var renderTh = function (text) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'th',\r\n                        innerHtml: providersBackstage.translate(text)\r\n                    }\r\n                };\r\n            };\r\n            var renderHeader = function (header) {\r\n                return {\r\n                    dom: { tag: 'thead' },\r\n                    components: [{\r\n                            dom: { tag: 'tr' },\r\n                            components: map(header, renderTh)\r\n                        }]\r\n                };\r\n            };\r\n            var renderTd = function (text) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'td',\r\n                        innerHtml: providersBackstage.translate(text)\r\n                    }\r\n                };\r\n            };\r\n            var renderTr = function (row) {\r\n                return {\r\n                    dom: { tag: 'tr' },\r\n                    components: map(row, renderTd)\r\n                };\r\n            };\r\n            var renderRows = function (rows) {\r\n                return {\r\n                    dom: { tag: 'tbody' },\r\n                    components: map(rows, renderTr)\r\n                };\r\n            };\r\n            return {\r\n                dom: {\r\n                    tag: 'table',\r\n                    classes: ['tox-dialog__table']\r\n                },\r\n                components: [\r\n                    renderHeader(spec.header),\r\n                    renderRows(spec.cells)\r\n                ],\r\n                behaviours: derive$1([\r\n                    Tabstopping.config({}),\r\n                    Focusing.config({})\r\n                ])\r\n            };\r\n        };\r\n        var make$5 = function (render) {\r\n            return function (parts, spec, backstage) {\r\n                return readOptFrom$1(spec, 'name').fold(function () {\r\n                    return render(spec, backstage);\r\n                }, function (fieldName) {\r\n                    return parts.field(fieldName, render(spec, backstage));\r\n                });\r\n            };\r\n        };\r\n        var makeIframe = function (render) {\r\n            return function (parts, spec, backstage) {\r\n                var iframeSpec = deepMerge(spec, { source: 'dynamic' });\r\n                return make$5(render)(parts, iframeSpec, backstage);\r\n            };\r\n        };\r\n        var factories = {\r\n            bar: make$5(function (spec, backstage) {\r\n                return renderBar(spec, backstage.shared);\r\n            }),\r\n            collection: make$5(function (spec, backstage) {\r\n                return renderCollection(spec, backstage.shared.providers);\r\n            }),\r\n            alloy: make$5(identity),\r\n            alertbanner: make$5(function (spec, backstage) {\r\n                return renderAlertBanner(spec, backstage.shared.providers);\r\n            }),\r\n            input: make$5(function (spec, backstage) {\r\n                return renderInput(spec, backstage.shared.providers);\r\n            }),\r\n            textarea: make$5(function (spec, backstage) {\r\n                return renderTextarea(spec, backstage.shared.providers);\r\n            }),\r\n            listbox: make$5(function (spec, backstage) {\r\n                return renderListbox(spec, backstage.shared.providers);\r\n            }),\r\n            label: make$5(function (spec, backstage) {\r\n                return renderLabel$2(spec, backstage.shared);\r\n            }),\r\n            iframe: makeIframe(function (spec, backstage) {\r\n                return renderIFrame(spec, backstage.shared.providers);\r\n            }),\r\n            autocomplete: make$5(function (spec, backstage) {\r\n                return renderAutocomplete(spec, backstage);\r\n            }),\r\n            button: make$5(function (spec, backstage) {\r\n                return renderDialogButton(spec, backstage.shared.providers);\r\n            }),\r\n            checkbox: make$5(function (spec, backstage) {\r\n                return renderCheckbox(spec, backstage.shared.providers);\r\n            }),\r\n            colorinput: make$5(function (spec, backstage) {\r\n                return renderColorInput(spec, backstage.shared, backstage.colorinput);\r\n            }),\r\n            colorpicker: make$5(renderColorPicker),\r\n            dropzone: make$5(function (spec, backstage) {\r\n                return renderDropZone(spec, backstage.shared.providers);\r\n            }),\r\n            grid: make$5(function (spec, backstage) {\r\n                return renderGrid(spec, backstage.shared);\r\n            }),\r\n            selectbox: make$5(function (spec, backstage) {\r\n                return renderSelectBox(spec, backstage.shared.providers);\r\n            }),\r\n            sizeinput: make$5(function (spec, backstage) {\r\n                return renderSizeInput(spec, backstage.shared.providers);\r\n            }),\r\n            urlinput: make$5(function (spec, backstage) {\r\n                return renderUrlInput(spec, backstage, backstage.urlinput);\r\n            }),\r\n            customeditor: make$5(renderCustomEditor),\r\n            htmlpanel: make$5(renderHtmlPanel),\r\n            imagetools: make$5(function (spec, backstage) {\r\n                return renderImageTools(spec, backstage.shared.providers);\r\n            }),\r\n            table: make$5(function (spec, backstage) {\r\n                return renderTable(spec, backstage.shared.providers);\r\n            })\r\n        };\r\n        var noFormParts = {\r\n            field: function (_name, spec) {\r\n                return spec;\r\n            }\r\n        };\r\n        var interpretInForm = function (parts, spec, oldBackstage) {\r\n            var newBackstage = deepMerge(oldBackstage, {\r\n                shared: {\r\n                    interpreter: function (childSpec) {\r\n                        return interpretParts(parts, childSpec, newBackstage);\r\n                    }\r\n                }\r\n            });\r\n            return interpretParts(parts, spec, newBackstage);\r\n        };\r\n        var interpretParts = function (parts, spec, backstage) {\r\n            return readOptFrom$1(factories, spec.type).fold(function () {\r\n                domGlobals.console.error('Unknown factory type \"' + spec.type + '\", defaulting to container: ', spec);\r\n                return spec;\r\n            }, function (factory) {\r\n                return factory(parts, spec, backstage);\r\n            });\r\n        };\r\n        var interpretWithoutForm = function (spec, backstage) {\r\n            var parts = noFormParts;\r\n            return interpretParts(parts, spec, backstage);\r\n        };\r\n        var westEdgeX$1 = function (anchor) {\r\n            return anchor.x();\r\n        };\r\n        var middleX$1 = function (anchor, element) {\r\n            return anchor.x() + anchor.width() / 2 - element.width() / 2;\r\n        };\r\n        var eastEdgeX$1 = function (anchor, element) {\r\n            return anchor.x() + anchor.width() - element.width();\r\n        };\r\n        var northY$2 = function (anchor) {\r\n            return anchor.y();\r\n        };\r\n        var northeast$3 = function (anchor, element, bubbles) {\r\n            return nu$8(westEdgeX$1(anchor), northY$2(anchor), bubbles.northeast(), northeast(), 'layout-ne');\r\n        };\r\n        var northwest$3 = function (anchor, element, bubbles) {\r\n            return nu$8(eastEdgeX$1(anchor, element), northY$2(anchor), bubbles.northwest(), northwest(), 'layout-nw');\r\n        };\r\n        var north$3 = function (anchor, element, bubbles) {\r\n            return nu$8(middleX$1(anchor, element), northY$2(anchor), bubbles.north(), north(), 'layout-n');\r\n        };\r\n        var bubbleAlignments = {\r\n            valignCentre: [],\r\n            alignCentre: [],\r\n            alignLeft: [],\r\n            alignRight: [],\r\n            right: [],\r\n            left: [],\r\n            bottom: [],\r\n            top: []\r\n        };\r\n        var getToolbarAnchor = function (bodyElement, lazyAnchorbar, useFixedToolbarContainer) {\r\n            var fixedToolbarAnchor = function () {\r\n                return {\r\n                    anchor: 'node',\r\n                    root: bodyElement(),\r\n                    node: Option.from(bodyElement()),\r\n                    bubble: nu$7(-12, -12, bubbleAlignments),\r\n                    layouts: {\r\n                        onRtl: function () {\r\n                            return [northeast$3];\r\n                        },\r\n                        onLtr: function () {\r\n                            return [northwest$3];\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n            var standardAnchor = function () {\r\n                return {\r\n                    anchor: 'hotspot',\r\n                    hotspot: lazyAnchorbar(),\r\n                    bubble: nu$7(-12, 12, bubbleAlignments),\r\n                    layouts: {\r\n                        onRtl: function () {\r\n                            return [southeast$1];\r\n                        },\r\n                        onLtr: function () {\r\n                            return [southwest$1];\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n            return useFixedToolbarContainer ? fixedToolbarAnchor : standardAnchor;\r\n        };\r\n        var getBannerAnchor = function (bodyElement, lazyAnchorbar, useFixedToolbarContainer) {\r\n            var fixedToolbarAnchor = function () {\r\n                return {\r\n                    anchor: 'node',\r\n                    root: bodyElement(),\r\n                    node: Option.from(bodyElement()),\r\n                    layouts: {\r\n                        onRtl: function () {\r\n                            return [north$3];\r\n                        },\r\n                        onLtr: function () {\r\n                            return [north$3];\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n            var standardAnchor = function () {\r\n                return {\r\n                    anchor: 'hotspot',\r\n                    hotspot: lazyAnchorbar(),\r\n                    layouts: {\r\n                        onRtl: function () {\r\n                            return [south$1];\r\n                        },\r\n                        onLtr: function () {\r\n                            return [south$1];\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n            return useFixedToolbarContainer ? fixedToolbarAnchor : standardAnchor;\r\n        };\r\n        var getToolbarOverflowAnchor = function (lazyMoreButton) {\r\n            return function () {\r\n                return {\r\n                    anchor: 'hotspot',\r\n                    hotspot: lazyMoreButton(),\r\n                    layouts: {\r\n                        onRtl: function () {\r\n                            return [southeast$1];\r\n                        },\r\n                        onLtr: function () {\r\n                            return [southwest$1];\r\n                        }\r\n                    }\r\n                };\r\n            };\r\n        };\r\n        var getCursorAnchor = function (editor, bodyElement) {\r\n            return function () {\r\n                return {\r\n                    anchor: 'selection',\r\n                    root: bodyElement(),\r\n                    getSelection: function () {\r\n                        var rng = editor.selection.getRng();\r\n                        return Option.some(range$1(Element.fromDom(rng.startContainer), rng.startOffset, Element.fromDom(rng.endContainer), rng.endOffset));\r\n                    }\r\n                };\r\n            };\r\n        };\r\n        var getNodeAnchor = function (bodyElement) {\r\n            return function (element) {\r\n                return {\r\n                    anchor: 'node',\r\n                    root: bodyElement(),\r\n                    node: element\r\n                };\r\n            };\r\n        };\r\n        var getAnchors = function (editor, lazyAnchorbar, lazyMoreButton) {\r\n            var useFixedToolbarContainer = useFixedContainer(editor);\r\n            var bodyElement = function () {\r\n                return Element.fromDom(editor.getBody());\r\n            };\r\n            return {\r\n                toolbar: getToolbarAnchor(bodyElement, lazyAnchorbar, useFixedToolbarContainer),\r\n                toolbarOverflow: getToolbarOverflowAnchor(lazyMoreButton),\r\n                banner: getBannerAnchor(bodyElement, lazyAnchorbar, lazyMoreButton),\r\n                cursor: getCursorAnchor(editor, bodyElement),\r\n                node: getNodeAnchor(bodyElement)\r\n            };\r\n        };\r\n        var Anchors = { getAnchors: getAnchors };\r\n        var colorPicker = function (editor) {\r\n            return function (callback, value) {\r\n                var dialog = ColorSwatch.colorPickerDialog(editor);\r\n                dialog(callback, value);\r\n            };\r\n        };\r\n        var hasCustomColors$1 = function (editor) {\r\n            return function () {\r\n                return Settings.hasCustomColors(editor);\r\n            };\r\n        };\r\n        var getColors$1 = function (editor) {\r\n            return function () {\r\n                return Settings.getColors(editor);\r\n            };\r\n        };\r\n        var getColorCols$2 = function (editor) {\r\n            return function () {\r\n                return ColorSwatch.getColorCols(editor);\r\n            };\r\n        };\r\n        var ColorInputBackstage = function (editor) {\r\n            return {\r\n                colorPicker: colorPicker(editor),\r\n                hasCustomColors: hasCustomColors$1(editor),\r\n                getColors: getColors$1(editor),\r\n                getColorCols: getColorCols$2(editor)\r\n            };\r\n        };\r\n        var defaultStyleFormats = [\r\n            {\r\n                title: 'Headings',\r\n                items: [\r\n                    {\r\n                        title: 'Heading 1',\r\n                        format: 'h1'\r\n                    },\r\n                    {\r\n                        title: 'Heading 2',\r\n                        format: 'h2'\r\n                    },\r\n                    {\r\n                        title: 'Heading 3',\r\n                        format: 'h3'\r\n                    },\r\n                    {\r\n                        title: 'Heading 4',\r\n                        format: 'h4'\r\n                    },\r\n                    {\r\n                        title: 'Heading 5',\r\n                        format: 'h5'\r\n                    },\r\n                    {\r\n                        title: 'Heading 6',\r\n                        format: 'h6'\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                title: 'Inline',\r\n                items: [\r\n                    {\r\n                        title: 'Bold',\r\n                        icon: 'bold',\r\n                        format: 'bold'\r\n                    },\r\n                    {\r\n                        title: 'Italic',\r\n                        icon: 'italic',\r\n                        format: 'italic'\r\n                    },\r\n                    {\r\n                        title: 'Underline',\r\n                        icon: 'underline',\r\n                        format: 'underline'\r\n                    },\r\n                    {\r\n                        title: 'Strikethrough',\r\n                        icon: 'strike-through',\r\n                        format: 'strikethrough'\r\n                    },\r\n                    {\r\n                        title: 'Superscript',\r\n                        icon: 'superscript',\r\n                        format: 'superscript'\r\n                    },\r\n                    {\r\n                        title: 'Subscript',\r\n                        icon: 'subscript',\r\n                        format: 'subscript'\r\n                    },\r\n                    {\r\n                        title: 'Code',\r\n                        icon: 'code',\r\n                        format: 'code'\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                title: 'Blocks',\r\n                items: [\r\n                    {\r\n                        title: 'Paragraph',\r\n                        format: 'p'\r\n                    },\r\n                    {\r\n                        title: 'Blockquote',\r\n                        format: 'blockquote'\r\n                    },\r\n                    {\r\n                        title: 'Div',\r\n                        format: 'div'\r\n                    },\r\n                    {\r\n                        title: 'Pre',\r\n                        format: 'pre'\r\n                    }\r\n                ]\r\n            },\r\n            {\r\n                title: 'Align',\r\n                items: [\r\n                    {\r\n                        title: 'Left',\r\n                        icon: 'align-left',\r\n                        format: 'alignleft'\r\n                    },\r\n                    {\r\n                        title: 'Center',\r\n                        icon: 'align-center',\r\n                        format: 'aligncenter'\r\n                    },\r\n                    {\r\n                        title: 'Right',\r\n                        icon: 'align-right',\r\n                        format: 'alignright'\r\n                    },\r\n                    {\r\n                        title: 'Justify',\r\n                        icon: 'align-justify',\r\n                        format: 'alignjustify'\r\n                    }\r\n                ]\r\n            }\r\n        ];\r\n        var isNestedFormat = function (format) {\r\n            return has(format, 'items');\r\n        };\r\n        var isBlockFormat = function (format) {\r\n            return has(format, 'block');\r\n        };\r\n        var isInlineFormat = function (format) {\r\n            return has(format, 'inline');\r\n        };\r\n        var isSelectorFormat = function (format) {\r\n            return has(format, 'selector');\r\n        };\r\n        var mapFormats = function (userFormats) {\r\n            return foldl(userFormats, function (acc, fmt) {\r\n                if (isNestedFormat(fmt)) {\r\n                    var result = mapFormats(fmt.items);\r\n                    return {\r\n                        customFormats: acc.customFormats.concat(result.customFormats),\r\n                        formats: acc.formats.concat([{\r\n                                title: fmt.title,\r\n                                items: result.formats\r\n                            }])\r\n                    };\r\n                }\r\n                else if (isInlineFormat(fmt) || isBlockFormat(fmt) || isSelectorFormat(fmt)) {\r\n                    var formatName = 'custom-' + fmt.title.toLowerCase();\r\n                    return {\r\n                        customFormats: acc.customFormats.concat([{\r\n                                name: formatName,\r\n                                format: fmt\r\n                            }]),\r\n                        formats: acc.formats.concat([{\r\n                                title: fmt.title,\r\n                                format: formatName,\r\n                                icon: fmt.icon\r\n                            }])\r\n                    };\r\n                }\r\n                else {\r\n                    return __assign({}, acc, { formats: acc.formats.concat(fmt) });\r\n                }\r\n            }, {\r\n                customFormats: [],\r\n                formats: []\r\n            });\r\n        };\r\n        var registerCustomFormats = function (editor, userFormats) {\r\n            var result = mapFormats(userFormats);\r\n            var registerFormats = function (customFormats) {\r\n                each(customFormats, function (fmt) {\r\n                    if (!editor.formatter.has(fmt.name)) {\r\n                        editor.formatter.register(fmt.name, fmt.format);\r\n                    }\r\n                });\r\n            };\r\n            if (editor.formatter) {\r\n                registerFormats(result.customFormats);\r\n            }\r\n            else {\r\n                editor.on('init', function () {\r\n                    registerFormats(result.customFormats);\r\n                });\r\n            }\r\n            return result.formats;\r\n        };\r\n        var getStyleFormats = function (editor) {\r\n            return getUserStyleFormats(editor).map(function (userFormats) {\r\n                var registeredUserFormats = registerCustomFormats(editor, userFormats);\r\n                return isMergeStyleFormats(editor) ? defaultStyleFormats.concat(registeredUserFormats) : registeredUserFormats;\r\n            }).getOr(defaultStyleFormats);\r\n        };\r\n        var processBasic = function (item, isSelectedFor, getPreviewFor) {\r\n            var formatterSpec = {\r\n                type: 'formatter',\r\n                isSelected: isSelectedFor(item.format),\r\n                getStylePreview: getPreviewFor(item.format)\r\n            };\r\n            return deepMerge(item, formatterSpec);\r\n        };\r\n        var register$3 = function (editor, formats, isSelectedFor, getPreviewFor) {\r\n            var enrichSupported = function (item) {\r\n                return processBasic(item, isSelectedFor, getPreviewFor);\r\n            };\r\n            var enrichMenu = function (item) {\r\n                var submenuSpec = {\r\n                    type: 'submenu',\r\n                    isSelected: constant(false),\r\n                    getStylePreview: function () {\r\n                        return Option.none();\r\n                    }\r\n                };\r\n                return deepMerge(item, submenuSpec);\r\n            };\r\n            var enrichCustom = function (item) {\r\n                var formatName = generate$1(item.title);\r\n                var customSpec = {\r\n                    type: 'formatter',\r\n                    format: formatName,\r\n                    isSelected: isSelectedFor(formatName),\r\n                    getStylePreview: getPreviewFor(formatName)\r\n                };\r\n                var newItem = deepMerge(item, customSpec);\r\n                editor.formatter.register(formatName, newItem);\r\n                return newItem;\r\n            };\r\n            var doEnrich = function (items) {\r\n                return map(items, function (item) {\r\n                    var keys$1 = keys(item);\r\n                    if (hasKey$1(item, 'items')) {\r\n                        var newItems_1 = doEnrich(item.items);\r\n                        return deepMerge(enrichMenu(item), {\r\n                            getStyleItems: function () {\r\n                                return newItems_1;\r\n                            }\r\n                        });\r\n                    }\r\n                    else if (hasKey$1(item, 'format')) {\r\n                        return enrichSupported(item);\r\n                    }\r\n                    else if (keys$1.length === 1 && contains(keys$1, 'title')) {\r\n                        return deepMerge(item, { type: 'separator' });\r\n                    }\r\n                    else {\r\n                        return enrichCustom(item);\r\n                    }\r\n                });\r\n            };\r\n            return doEnrich(formats);\r\n        };\r\n        var init$7 = function (editor) {\r\n            var isSelectedFor = function (format) {\r\n                return function () {\r\n                    return editor.formatter.match(format);\r\n                };\r\n            };\r\n            var getPreviewFor = function (format) {\r\n                return function () {\r\n                    var fmt = editor.formatter.get(format);\r\n                    return fmt !== undefined ? Option.some({\r\n                        tag: fmt.length > 0 ? fmt[0].inline || fmt[0].block || 'div' : 'div',\r\n                        styleAttr: editor.formatter.getCssText(format)\r\n                    }) : Option.none();\r\n                };\r\n            };\r\n            var flatten = function (fmt) {\r\n                var subs = fmt.items;\r\n                return subs !== undefined && subs.length > 0 ? bind(subs, flatten) : [fmt.format];\r\n            };\r\n            var settingsFormats = Cell([]);\r\n            var settingsFlattenedFormats = Cell([]);\r\n            var eventsFormats = Cell([]);\r\n            var eventsFlattenedFormats = Cell([]);\r\n            var replaceSettings = Cell(false);\r\n            editor.on('init', function () {\r\n                var formats = getStyleFormats(editor);\r\n                var enriched = register$3(editor, formats, isSelectedFor, getPreviewFor);\r\n                settingsFormats.set(enriched);\r\n                settingsFlattenedFormats.set(bind(enriched, flatten));\r\n            });\r\n            editor.on('addStyleModifications', function (e) {\r\n                var modifications = register$3(editor, e.items, isSelectedFor, getPreviewFor);\r\n                eventsFormats.set(modifications);\r\n                replaceSettings.set(e.replace);\r\n                eventsFlattenedFormats.set(bind(modifications, flatten));\r\n            });\r\n            var getData = function () {\r\n                var fromSettings = replaceSettings.get() ? [] : settingsFormats.get();\r\n                var fromEvents = eventsFormats.get();\r\n                return fromSettings.concat(fromEvents);\r\n            };\r\n            var getFlattenedKeys = function () {\r\n                var fromSettings = replaceSettings.get() ? [] : settingsFlattenedFormats.get();\r\n                var fromEvents = eventsFlattenedFormats.get();\r\n                return fromSettings.concat(fromEvents);\r\n            };\r\n            return {\r\n                getData: getData,\r\n                getFlattenedKeys: getFlattenedKeys\r\n            };\r\n        };\r\n        var trim$1 = global$b.trim;\r\n        var hasContentEditableState = function (value) {\r\n            return function (node) {\r\n                if (node && node.nodeType === 1) {\r\n                    if (node.contentEditable === value) {\r\n                        return true;\r\n                    }\r\n                    if (node.getAttribute('data-mce-contenteditable') === value) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n        };\r\n        var isContentEditableTrue = hasContentEditableState('true');\r\n        var isContentEditableFalse = hasContentEditableState('false');\r\n        var create$5 = function (type, title, url, level, attach) {\r\n            return {\r\n                type: type,\r\n                title: title,\r\n                url: url,\r\n                level: level,\r\n                attach: attach\r\n            };\r\n        };\r\n        var isChildOfContentEditableTrue = function (node) {\r\n            while (node = node.parentNode) {\r\n                var value = node.contentEditable;\r\n                if (value && value !== 'inherit') {\r\n                    return isContentEditableTrue(node);\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var select = function (selector, root) {\r\n            return map(descendants(Element.fromDom(root), selector), function (element) {\r\n                return element.dom();\r\n            });\r\n        };\r\n        var getElementText = function (elm) {\r\n            return elm.innerText || elm.textContent;\r\n        };\r\n        var getOrGenerateId = function (elm) {\r\n            return elm.id ? elm.id : generate$1('h');\r\n        };\r\n        var isAnchor = function (elm) {\r\n            return elm && elm.nodeName === 'A' && (elm.id || elm.name) !== undefined;\r\n        };\r\n        var isValidAnchor = function (elm) {\r\n            return isAnchor(elm) && isEditable(elm);\r\n        };\r\n        var isHeader = function (elm) {\r\n            return elm && /^(H[1-6])$/.test(elm.nodeName);\r\n        };\r\n        var isEditable = function (elm) {\r\n            return isChildOfContentEditableTrue(elm) && !isContentEditableFalse(elm);\r\n        };\r\n        var isValidHeader = function (elm) {\r\n            return isHeader(elm) && isEditable(elm);\r\n        };\r\n        var getLevel = function (elm) {\r\n            return isHeader(elm) ? parseInt(elm.nodeName.substr(1), 10) : 0;\r\n        };\r\n        var headerTarget = function (elm) {\r\n            var headerId = getOrGenerateId(elm);\r\n            var attach = function () {\r\n                elm.id = headerId;\r\n            };\r\n            return create$5('header', getElementText(elm), '#' + headerId, getLevel(elm), attach);\r\n        };\r\n        var anchorTarget = function (elm) {\r\n            var anchorId = elm.id || elm.name;\r\n            var anchorText = getElementText(elm);\r\n            return create$5('anchor', anchorText ? anchorText : '#' + anchorId, '#' + anchorId, 0, noop);\r\n        };\r\n        var getHeaderTargets = function (elms) {\r\n            return map(filter(elms, isValidHeader), headerTarget);\r\n        };\r\n        var getAnchorTargets = function (elms) {\r\n            return map(filter(elms, isValidAnchor), anchorTarget);\r\n        };\r\n        var getTargetElements = function (elm) {\r\n            var elms = select('h1,h2,h3,h4,h5,h6,a:not([href])', elm);\r\n            return elms;\r\n        };\r\n        var hasTitle = function (target) {\r\n            return trim$1(target.title).length > 0;\r\n        };\r\n        var find$5 = function (elm) {\r\n            var elms = getTargetElements(elm);\r\n            return filter(getHeaderTargets(elms).concat(getAnchorTargets(elms)), hasTitle);\r\n        };\r\n        var LinkTargets = { find: find$5 };\r\n        var STORAGE_KEY = 'tinymce-url-history';\r\n        var HISTORY_LENGTH = 5;\r\n        var isHttpUrl = function (url) {\r\n            return isString(url) && /^https?/.test(url);\r\n        };\r\n        var isArrayOfUrl = function (a) {\r\n            return isArray(a) && a.length <= HISTORY_LENGTH && forall(a, isHttpUrl);\r\n        };\r\n        var isRecordOfUrlArray = function (r) {\r\n            return isObject(r) && find$1(r, function (value) {\r\n                return !isArrayOfUrl(value);\r\n            }).isNone();\r\n        };\r\n        var getAllHistory = function () {\r\n            var unparsedHistory = domGlobals.localStorage.getItem(STORAGE_KEY);\r\n            if (unparsedHistory === null) {\r\n                return {};\r\n            }\r\n            var history;\r\n            try {\r\n                history = JSON.parse(unparsedHistory);\r\n            }\r\n            catch (e) {\r\n                if (e instanceof SyntaxError) {\r\n                    domGlobals.console.log('Local storage ' + STORAGE_KEY + ' was not valid JSON', e);\r\n                    return {};\r\n                }\r\n                throw e;\r\n            }\r\n            if (!isRecordOfUrlArray(history)) {\r\n                domGlobals.console.log('Local storage ' + STORAGE_KEY + ' was not valid format', history);\r\n                return {};\r\n            }\r\n            return history;\r\n        };\r\n        var setAllHistory = function (history) {\r\n            if (!isRecordOfUrlArray(history)) {\r\n                throw new Error('Bad format for history:\\n' + JSON.stringify(history));\r\n            }\r\n            domGlobals.localStorage.setItem(STORAGE_KEY, JSON.stringify(history));\r\n        };\r\n        var getHistory = function (fileType) {\r\n            var history = getAllHistory();\r\n            return Object.prototype.hasOwnProperty.call(history, fileType) ? history[fileType] : [];\r\n        };\r\n        var addToHistory = function (url, fileType) {\r\n            if (!isHttpUrl(url)) {\r\n                return;\r\n            }\r\n            var history = getAllHistory();\r\n            var items = Object.prototype.hasOwnProperty.call(history, fileType) ? history[fileType] : [];\r\n            var itemsWithoutUrl = filter(items, function (item) {\r\n                return item !== url;\r\n            });\r\n            history[fileType] = [url].concat(itemsWithoutUrl).slice(0, HISTORY_LENGTH);\r\n            setAllHistory(history);\r\n        };\r\n        var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\r\n        var isTruthy = function (value) {\r\n            return !!value;\r\n        };\r\n        var makeMap = function (value) {\r\n            return map$1(global$b.makeMap(value, /[, ]/), isTruthy);\r\n        };\r\n        var getOpt = function (obj, key) {\r\n            return hasOwnProperty$2.call(obj, key) ? Option.some(obj[key]) : Option.none();\r\n        };\r\n        var getTextSetting = function (settings, name, defaultValue) {\r\n            var value = getOpt(settings, name).getOr(defaultValue);\r\n            return isString(value) ? Option.some(value) : Option.none();\r\n        };\r\n        var getPicker = function (settings) {\r\n            return Option.some(settings.file_picker_callback).filter(isFunction);\r\n        };\r\n        var getPickerTypes = function (settings) {\r\n            var optFileTypes = Option.some(settings.file_picker_types).filter(isTruthy);\r\n            var optLegacyTypes = Option.some(settings.file_browser_callback_types).filter(isTruthy);\r\n            var optTypes = optFileTypes.or(optLegacyTypes).map(makeMap);\r\n            return getPicker(settings).fold(function () {\r\n                return false;\r\n            }, function (_picker) {\r\n                return optTypes.fold(function () {\r\n                    return true;\r\n                }, function (types) {\r\n                    return keys(types).length > 0 ? types : false;\r\n                });\r\n            });\r\n        };\r\n        var getPickerSetting = function (settings, filetype) {\r\n            var pickerTypes = getPickerTypes(settings);\r\n            if (isBoolean(pickerTypes)) {\r\n                return pickerTypes ? getPicker(settings) : Option.none();\r\n            }\r\n            else {\r\n                return pickerTypes[filetype] ? getPicker(settings) : Option.none();\r\n            }\r\n        };\r\n        var getUrlPicker = function (editor, filetype) {\r\n            return getPickerSetting(editor.settings, filetype).map(function (picker) {\r\n                return function (entry) {\r\n                    return Future.nu(function (completer) {\r\n                        var handler = function (value, meta) {\r\n                            if (!isString(value)) {\r\n                                throw new Error('Expected value to be string');\r\n                            }\r\n                            if (meta !== undefined && !isObject(meta)) {\r\n                                throw new Error('Expected meta to be a object');\r\n                            }\r\n                            var r = {\r\n                                value: value,\r\n                                meta: meta\r\n                            };\r\n                            completer(r);\r\n                        };\r\n                        var meta = global$b.extend({ filetype: filetype }, Option.from(entry.meta).getOr({}));\r\n                        picker.call(editor, handler, entry.value, meta);\r\n                    });\r\n                };\r\n            });\r\n        };\r\n        var getLinkInformation = function (editor) {\r\n            if (editor.settings.typeahead_urls === false) {\r\n                return Option.none();\r\n            }\r\n            return Option.some({\r\n                targets: LinkTargets.find(editor.getBody()),\r\n                anchorTop: getTextSetting(editor.settings, 'anchor_top', '#top').getOrUndefined(),\r\n                anchorBottom: getTextSetting(editor.settings, 'anchor_bottom', '#bottom').getOrUndefined()\r\n            });\r\n        };\r\n        var getValidationHandler = function (editor) {\r\n            var validatorHandler = editor.settings.filepicker_validator_handler;\r\n            return isFunction(validatorHandler) ? Option.some(validatorHandler) : Option.none();\r\n        };\r\n        var UrlInputBackstage = function (editor) {\r\n            return {\r\n                getHistory: getHistory,\r\n                addToHistory: addToHistory,\r\n                getLinkInformation: function () {\r\n                    return getLinkInformation(editor);\r\n                },\r\n                getValidationHandler: function () {\r\n                    return getValidationHandler(editor);\r\n                },\r\n                getUrlPicker: function (filetype) {\r\n                    return getUrlPicker(editor, filetype);\r\n                }\r\n            };\r\n        };\r\n        var init$8 = function (sink, editor, lazyAnchorbar, lazyMoreButton) {\r\n            var backstage = {\r\n                shared: {\r\n                    providers: {\r\n                        icons: function () {\r\n                            return editor.ui.registry.getAll().icons;\r\n                        },\r\n                        menuItems: function () {\r\n                            return editor.ui.registry.getAll().menuItems;\r\n                        },\r\n                        translate: global$3.translate\r\n                    },\r\n                    interpreter: function (s) {\r\n                        return interpretWithoutForm(s, backstage);\r\n                    },\r\n                    anchors: Anchors.getAnchors(editor, lazyAnchorbar, lazyMoreButton),\r\n                    getSink: function () {\r\n                        return Result.value(sink);\r\n                    }\r\n                },\r\n                urlinput: UrlInputBackstage(editor),\r\n                styleselect: init$7(editor),\r\n                colorinput: ColorInputBackstage(editor)\r\n            };\r\n            return backstage;\r\n        };\r\n        var showContextToolbarEvent = 'contexttoolbar-show';\r\n        var schema$j = constant([\r\n            strict$1('dom'),\r\n            defaulted$1('shell', true),\r\n            field$1('toolbarBehaviours', [Replacing])\r\n        ]);\r\n        var enhanceGroups = function (detail) {\r\n            return { behaviours: derive$1([Replacing.config({})]) };\r\n        };\r\n        var parts$7 = constant([optional({\r\n                name: 'groups',\r\n                overrides: enhanceGroups\r\n            })]);\r\n        var factory$9 = function (detail, components, spec, _externals) {\r\n            var setGroups = function (toolbar, groups) {\r\n                getGroupContainer(toolbar).fold(function () {\r\n                    domGlobals.console.error('Toolbar was defined to not be a shell, but no groups container was specified in components');\r\n                    throw new Error('Toolbar was defined to not be a shell, but no groups container was specified in components');\r\n                }, function (container) {\r\n                    Replacing.set(container, groups);\r\n                });\r\n            };\r\n            var getGroupContainer = function (component) {\r\n                return detail.shell ? Option.some(component) : getPart(component, detail, 'groups');\r\n            };\r\n            var extra = detail.shell ? {\r\n                behaviours: [Replacing.config({})],\r\n                components: []\r\n            } : {\r\n                behaviours: [],\r\n                components: components\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: extra.components,\r\n                behaviours: augment(detail.toolbarBehaviours, extra.behaviours),\r\n                apis: { setGroups: setGroups },\r\n                domModification: { attributes: { role: 'group' } }\r\n            };\r\n        };\r\n        var Toolbar = composite$1({\r\n            name: 'Toolbar',\r\n            configFields: schema$j(),\r\n            partFields: parts$7(),\r\n            factory: factory$9,\r\n            apis: {\r\n                setGroups: function (apis, toolbar, groups) {\r\n                    apis.setGroups(toolbar, groups);\r\n                }\r\n            }\r\n        });\r\n        var generate$6 = function (xs, f) {\r\n            var init = {\r\n                len: 0,\r\n                list: []\r\n            };\r\n            var r = foldl(xs, function (b, a) {\r\n                var value = f(a, b.len);\r\n                return value.fold(constant(b), function (v) {\r\n                    return {\r\n                        len: v.finish(),\r\n                        list: b.list.concat([v])\r\n                    };\r\n                });\r\n            }, init);\r\n            return r.list;\r\n        };\r\n        var output$1 = Immutable('within', 'extra', 'withinWidth');\r\n        var apportion = function (units, total, len) {\r\n            var parray = generate$6(units, function (unit, current) {\r\n                var width = len(unit);\r\n                return Option.some({\r\n                    element: constant(unit),\r\n                    start: constant(current),\r\n                    finish: constant(current + width),\r\n                    width: constant(width)\r\n                });\r\n            });\r\n            var within = filter(parray, function (unit) {\r\n                return unit.finish() <= total;\r\n            });\r\n            var withinWidth = foldr(within, function (acc, el) {\r\n                return acc + el.width();\r\n            }, 0);\r\n            var extra = parray.slice(within.length);\r\n            return {\r\n                within: constant(within),\r\n                extra: constant(extra),\r\n                withinWidth: constant(withinWidth)\r\n            };\r\n        };\r\n        var toUnit = function (parray) {\r\n            return map(parray, function (unit) {\r\n                return unit.element();\r\n            });\r\n        };\r\n        var fitLast = function (within, extra, withinWidth) {\r\n            var fits = toUnit(within.concat(extra));\r\n            return output$1(fits, [], withinWidth);\r\n        };\r\n        var overflow = function (within, extra, overflower, withinWidth) {\r\n            var fits = toUnit(within).concat([overflower]);\r\n            return output$1(fits, toUnit(extra), withinWidth);\r\n        };\r\n        var fitAll = function (within, extra, withinWidth) {\r\n            return output$1(toUnit(within), [], withinWidth);\r\n        };\r\n        var tryFit = function (total, units, len) {\r\n            var divide = apportion(units, total, len);\r\n            return divide.extra().length === 0 ? Option.some(divide) : Option.none();\r\n        };\r\n        var partition$3 = function (total, units, len, overflower) {\r\n            var divide = tryFit(total, units, len).getOrThunk(function () {\r\n                return apportion(units, total - len(overflower), len);\r\n            });\r\n            var within = divide.within();\r\n            var extra = divide.extra();\r\n            var withinWidth = divide.withinWidth();\r\n            if (extra.length === 1 && extra[0].width() <= len(overflower)) {\r\n                return fitLast(within, extra, withinWidth);\r\n            }\r\n            else if (extra.length >= 1) {\r\n                return overflow(within, extra, overflower, withinWidth);\r\n            }\r\n            else {\r\n                return fitAll(within, extra, withinWidth);\r\n            }\r\n        };\r\n        var setStoredGroups = function (toolbar, storedGroups) {\r\n            var bGroups = map(storedGroups, function (g) {\r\n                return premade$1(g);\r\n            });\r\n            Toolbar.setGroups(toolbar, bGroups);\r\n        };\r\n        var findFocusedComp = function (overflow, overflowButton) {\r\n            return overflow.bind(function (overf) {\r\n                return search$1(overf.element()).bind(function (focusedElm) {\r\n                    return overf.getSystem().getByDom(focusedElm).toOption();\r\n                });\r\n            }).orThunk(function () {\r\n                return overflowButton.filter(Focusing.isFocused);\r\n            });\r\n        };\r\n        var refresh = function (toolbar, detail, overflow, isOpen) {\r\n            var primary = getPartOrDie(toolbar, detail, 'primary');\r\n            var overflowButton = getPart(toolbar, detail, 'overflow-button');\r\n            var overflowGroup = Coupling.getCoupled(toolbar, 'overflowGroup');\r\n            set$2(primary.element(), 'visibility', 'hidden');\r\n            var focusedComp = findFocusedComp(overflow, overflowButton);\r\n            overflow.each(function (overf) {\r\n                Toolbar.setGroups(overf, []);\r\n            });\r\n            var groups = detail.builtGroups.get();\r\n            setStoredGroups(primary, groups.concat([overflowGroup]));\r\n            var total = get$7(primary.element());\r\n            var overflows = partition$3(total, groups, function (comp) {\r\n                return get$7(comp.element());\r\n            }, overflowGroup);\r\n            if (overflows.extra().length === 0) {\r\n                Replacing.remove(primary, overflowGroup);\r\n                overflow.each(function (overf) {\r\n                    Toolbar.setGroups(overf, []);\r\n                });\r\n            }\r\n            else {\r\n                setStoredGroups(primary, overflows.within());\r\n                overflow.each(function (overf) {\r\n                    setStoredGroups(overf, overflows.extra());\r\n                });\r\n            }\r\n            remove$6(primary.element(), 'visibility');\r\n            reflow(primary.element());\r\n            overflow.each(function (overf) {\r\n                overflowButton.each(function (button) {\r\n                    return Toggling.set(button, isOpen(overf));\r\n                });\r\n                focusedComp.each(Focusing.focus);\r\n            });\r\n        };\r\n        var schema$k = constant([\r\n            strict$1('items'),\r\n            markers(['itemSelector']),\r\n            field$1('tgroupBehaviours', [Keying])\r\n        ]);\r\n        var parts$8 = constant([group({\r\n                name: 'items',\r\n                unit: 'item'\r\n            })]);\r\n        var factory$a = function (detail, components, spec, _externals) {\r\n            return {\r\n                'uid': detail.uid,\r\n                'dom': detail.dom,\r\n                'components': components,\r\n                'behaviours': augment(detail.tgroupBehaviours, [Keying.config({\r\n                        mode: 'flow',\r\n                        selector: detail.markers.itemSelector\r\n                    })]),\r\n                domModification: { attributes: { role: 'toolbar' } }\r\n            };\r\n        };\r\n        var ToolbarGroup = composite$1({\r\n            name: 'ToolbarGroup',\r\n            configFields: schema$k(),\r\n            partFields: parts$8(),\r\n            factory: factory$a\r\n        });\r\n        var schema$l = constant([\r\n            field$1('splitToolbarBehaviours', []),\r\n            state$1('builtGroups', function () {\r\n                return Cell([]);\r\n            })\r\n        ]);\r\n        var spec = function (detail, components, spec, externals, extras) {\r\n            var toolbarToggleEvent = 'alloy.toolbar.toggle';\r\n            var doSetGroups = function (toolbar, groups) {\r\n                var built = map(groups, toolbar.getSystem().build);\r\n                detail.builtGroups.set(built);\r\n            };\r\n            var setGroups = function (toolbar, groups) {\r\n                doSetGroups(toolbar, groups);\r\n                extras.refresh(toolbar, detail);\r\n            };\r\n            var getMoreButton = function (toolbar) {\r\n                return getPart(toolbar, detail, 'overflow-button');\r\n            };\r\n            var getOverflow = function (toolbar) {\r\n                return extras.getOverflow(toolbar);\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                behaviours: augment(detail.splitToolbarBehaviours, [\r\n                    Coupling.config({\r\n                        others: __assign({}, extras.coupling, {\r\n                            overflowGroup: function (toolbar) {\r\n                                return ToolbarGroup.sketch(__assign({}, externals['overflow-group'](), {\r\n                                    items: [Button.sketch(__assign({}, externals['overflow-button'](), {\r\n                                            action: function (_button) {\r\n                                                emit(toolbar, toolbarToggleEvent);\r\n                                            }\r\n                                        }))]\r\n                                }));\r\n                            }\r\n                        })\r\n                    }),\r\n                    config('toolbar-toggle-events', [run(toolbarToggleEvent, function (toolbar) {\r\n                            extras.toggleToolbar(toolbar, detail, externals);\r\n                        })])\r\n                ]),\r\n                apis: {\r\n                    setGroups: setGroups,\r\n                    refresh: function (toolbar) {\r\n                        extras.refresh(toolbar, detail);\r\n                    },\r\n                    getMoreButton: function (toolbar) {\r\n                        return getMoreButton(toolbar);\r\n                    },\r\n                    getOverflow: function (toolbar) {\r\n                        return getOverflow(toolbar);\r\n                    },\r\n                    toggle: function (toolbar) {\r\n                        extras.toggleToolbar(toolbar, detail, externals);\r\n                    }\r\n                },\r\n                domModification: { attributes: { role: 'group' } }\r\n            };\r\n        };\r\n        var schema$m = constant([\r\n            markers(['overflowToggledClass']),\r\n            strict$1('getAnchor'),\r\n            strict$1('lazySink')\r\n        ].concat(schema$l()));\r\n        var parts$9 = constant([\r\n            required({\r\n                factory: Toolbar,\r\n                schema: schema$j(),\r\n                name: 'primary'\r\n            }),\r\n            external$1({\r\n                factory: Toolbar,\r\n                schema: schema$j(),\r\n                name: 'overflow',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        toolbarBehaviours: derive$1([Keying.config({\r\n                                mode: 'cyclic',\r\n                                onEscape: function (comp) {\r\n                                    getPart(comp, detail, 'overflow-button').each(Focusing.focus);\r\n                                    return Option.none();\r\n                                }\r\n                            })])\r\n                    };\r\n                }\r\n            }),\r\n            external$1({\r\n                name: 'overflow-button',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        dom: { attributes: { 'aria-haspopup': 'true' } },\r\n                        buttonBehaviours: derive$1([Toggling.config({\r\n                                toggleClass: detail.markers.overflowToggledClass,\r\n                                aria: { mode: 'expanded' },\r\n                                toggleOnExecute: false\r\n                            })])\r\n                    };\r\n                }\r\n            }),\r\n            external$1({ name: 'overflow-group' })\r\n        ]);\r\n        var toggleToolbar = function (toolbar, detail, externals) {\r\n            var sandbox = Coupling.getCoupled(toolbar, 'sandbox');\r\n            if (Sandboxing.isOpen(sandbox)) {\r\n                Sandboxing.close(sandbox);\r\n            }\r\n            else {\r\n                Sandboxing.open(sandbox, externals['overflow']());\r\n            }\r\n        };\r\n        var isOpen$1 = function (over) {\r\n            return over.getSystem().isConnected();\r\n        };\r\n        var refresh$1 = function (toolbar, detail) {\r\n            var overflow = Sandboxing.getState(Coupling.getCoupled(toolbar, 'sandbox'));\r\n            refresh(toolbar, detail, overflow, isOpen$1);\r\n            overflow.each(function (overf) {\r\n                var sink = detail.lazySink(toolbar).getOrDie();\r\n                var anchor = detail.getAnchor(toolbar);\r\n                Positioning.position(sink, anchor, overf);\r\n            });\r\n        };\r\n        var makeSandbox$1 = function (toolbar, detail) {\r\n            var ariaOwner = manager();\r\n            var onOpen = function (sandbox, overf) {\r\n                refresh$1(toolbar, detail);\r\n                getPart(toolbar, detail, 'overflow-button').each(function (button) {\r\n                    Toggling.on(button);\r\n                    ariaOwner.link(button.element());\r\n                });\r\n                Keying.focusIn(overf);\r\n            };\r\n            var onClose = function () {\r\n                getPart(toolbar, detail, 'overflow-button').each(function (button) {\r\n                    Toggling.off(button);\r\n                    Focusing.focus(button);\r\n                    ariaOwner.unlink(button.element());\r\n                });\r\n            };\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { id: ariaOwner.id() }\r\n                },\r\n                behaviours: derive$1([\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onEscape: function (comp) {\r\n                            Sandboxing.close(comp);\r\n                            return Option.some(true);\r\n                        }\r\n                    }),\r\n                    Sandboxing.config({\r\n                        onOpen: onOpen,\r\n                        onClose: onClose,\r\n                        isPartOf: function (container, data, queryElem) {\r\n                            return isPartOf(data, queryElem) || isPartOf(toolbar, queryElem);\r\n                        },\r\n                        getAttachPoint: function () {\r\n                            return detail.lazySink(toolbar).getOrDie();\r\n                        }\r\n                    })\r\n                ])\r\n            };\r\n        };\r\n        var factory$b = function (detail, components, spec$1, externals) {\r\n            return spec(detail, components, spec$1, externals, {\r\n                refresh: refresh$1,\r\n                toggleToolbar: toggleToolbar,\r\n                getOverflow: function (toolbar) {\r\n                    return Sandboxing.getState(Coupling.getCoupled(toolbar, 'sandbox'));\r\n                },\r\n                coupling: {\r\n                    sandbox: function (toolbar) {\r\n                        return makeSandbox$1(toolbar, detail);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        var SplitFloatingToolbar = composite$1({\r\n            name: 'SplitFloatingToolbar',\r\n            configFields: schema$m(),\r\n            partFields: parts$9(),\r\n            factory: factory$b,\r\n            apis: {\r\n                setGroups: function (apis, toolbar, groups) {\r\n                    apis.setGroups(toolbar, groups);\r\n                },\r\n                refresh: function (apis, toolbar) {\r\n                    apis.refresh(toolbar);\r\n                },\r\n                getMoreButton: function (apis, toolbar) {\r\n                    return apis.getMoreButton(toolbar);\r\n                },\r\n                getOverflow: function (apis, toolbar) {\r\n                    return apis.getOverflow(toolbar);\r\n                },\r\n                toggle: function (apis, toolbar) {\r\n                    apis.toggle(toolbar);\r\n                }\r\n            }\r\n        });\r\n        var getAnimationRoot = function (component, slideConfig) {\r\n            return slideConfig.getAnimationRoot.fold(function () {\r\n                return component.element();\r\n            }, function (get) {\r\n                return get(component);\r\n            });\r\n        };\r\n        var getDimensionProperty = function (slideConfig) {\r\n            return slideConfig.dimension.property;\r\n        };\r\n        var getDimension = function (slideConfig, elem) {\r\n            return slideConfig.dimension.getDimension(elem);\r\n        };\r\n        var disableTransitions = function (component, slideConfig) {\r\n            var root = getAnimationRoot(component, slideConfig);\r\n            remove$5(root, [\r\n                slideConfig.shrinkingClass,\r\n                slideConfig.growingClass\r\n            ]);\r\n        };\r\n        var setShrunk = function (component, slideConfig) {\r\n            remove$4(component.element(), slideConfig.openClass);\r\n            add$2(component.element(), slideConfig.closedClass);\r\n            set$2(component.element(), getDimensionProperty(slideConfig), '0px');\r\n            reflow(component.element());\r\n        };\r\n        var setGrown = function (component, slideConfig) {\r\n            remove$4(component.element(), slideConfig.closedClass);\r\n            add$2(component.element(), slideConfig.openClass);\r\n            remove$6(component.element(), getDimensionProperty(slideConfig));\r\n        };\r\n        var doImmediateShrink = function (component, slideConfig, slideState, _calculatedSize) {\r\n            slideState.setCollapsed();\r\n            set$2(component.element(), getDimensionProperty(slideConfig), getDimension(slideConfig, component.element()));\r\n            reflow(component.element());\r\n            disableTransitions(component, slideConfig);\r\n            setShrunk(component, slideConfig);\r\n            slideConfig.onStartShrink(component);\r\n            slideConfig.onShrunk(component);\r\n        };\r\n        var doStartShrink = function (component, slideConfig, slideState, calculatedSize) {\r\n            var size = calculatedSize.getOrThunk(function () {\r\n                return getDimension(slideConfig, component.element());\r\n            });\r\n            slideState.setCollapsed();\r\n            set$2(component.element(), getDimensionProperty(slideConfig), size);\r\n            reflow(component.element());\r\n            var root = getAnimationRoot(component, slideConfig);\r\n            remove$4(root, slideConfig.growingClass);\r\n            add$2(root, slideConfig.shrinkingClass);\r\n            setShrunk(component, slideConfig);\r\n            slideConfig.onStartShrink(component);\r\n        };\r\n        var doStartSmartShrink = function (component, slideConfig, slideState) {\r\n            var size = getDimension(slideConfig, component.element());\r\n            var shrinker = size === '0px' ? doImmediateShrink : doStartShrink;\r\n            shrinker(component, slideConfig, slideState, Option.some(size));\r\n        };\r\n        var doStartGrow = function (component, slideConfig, slideState) {\r\n            var root = getAnimationRoot(component, slideConfig);\r\n            var wasShrinking = has$2(root, slideConfig.shrinkingClass);\r\n            var beforeSize = getDimension(slideConfig, component.element());\r\n            setGrown(component, slideConfig);\r\n            var fullSize = getDimension(slideConfig, component.element());\r\n            var startPartialGrow = function () {\r\n                set$2(component.element(), getDimensionProperty(slideConfig), beforeSize);\r\n                reflow(component.element());\r\n            };\r\n            var startCompleteGrow = function () {\r\n                setShrunk(component, slideConfig);\r\n            };\r\n            var setStartSize = wasShrinking ? startPartialGrow : startCompleteGrow;\r\n            setStartSize();\r\n            remove$4(root, slideConfig.shrinkingClass);\r\n            add$2(root, slideConfig.growingClass);\r\n            setGrown(component, slideConfig);\r\n            set$2(component.element(), getDimensionProperty(slideConfig), fullSize);\r\n            slideState.setExpanded();\r\n            slideConfig.onStartGrow(component);\r\n        };\r\n        var refresh$2 = function (component, slideConfig, slideState) {\r\n            if (slideState.isExpanded()) {\r\n                remove$6(component.element(), getDimensionProperty(slideConfig));\r\n                var fullSize = getDimension(slideConfig, component.element());\r\n                set$2(component.element(), getDimensionProperty(slideConfig), fullSize);\r\n            }\r\n        };\r\n        var grow = function (component, slideConfig, slideState) {\r\n            if (!slideState.isExpanded()) {\r\n                doStartGrow(component, slideConfig, slideState);\r\n            }\r\n        };\r\n        var shrink = function (component, slideConfig, slideState) {\r\n            if (slideState.isExpanded()) {\r\n                doStartSmartShrink(component, slideConfig, slideState);\r\n            }\r\n        };\r\n        var immediateShrink = function (component, slideConfig, slideState) {\r\n            if (slideState.isExpanded()) {\r\n                doImmediateShrink(component, slideConfig, slideState, Option.none());\r\n            }\r\n        };\r\n        var hasGrown = function (component, slideConfig, slideState) {\r\n            return slideState.isExpanded();\r\n        };\r\n        var hasShrunk = function (component, slideConfig, slideState) {\r\n            return slideState.isCollapsed();\r\n        };\r\n        var isGrowing = function (component, slideConfig, slideState) {\r\n            var root = getAnimationRoot(component, slideConfig);\r\n            return has$2(root, slideConfig.growingClass) === true;\r\n        };\r\n        var isShrinking = function (component, slideConfig, slideState) {\r\n            var root = getAnimationRoot(component, slideConfig);\r\n            return has$2(root, slideConfig.shrinkingClass) === true;\r\n        };\r\n        var isTransitioning = function (component, slideConfig, slideState) {\r\n            return isGrowing(component, slideConfig, slideState) === true || isShrinking(component, slideConfig, slideState) === true;\r\n        };\r\n        var toggleGrow = function (component, slideConfig, slideState) {\r\n            var f = slideState.isExpanded() ? doStartSmartShrink : doStartGrow;\r\n            f(component, slideConfig, slideState);\r\n        };\r\n        var SlidingApis = Object.freeze({\r\n            refresh: refresh$2,\r\n            grow: grow,\r\n            shrink: shrink,\r\n            immediateShrink: immediateShrink,\r\n            hasGrown: hasGrown,\r\n            hasShrunk: hasShrunk,\r\n            isGrowing: isGrowing,\r\n            isShrinking: isShrinking,\r\n            isTransitioning: isTransitioning,\r\n            toggleGrow: toggleGrow,\r\n            disableTransitions: disableTransitions\r\n        });\r\n        var exhibit$6 = function (base, slideConfig) {\r\n            var expanded = slideConfig.expanded;\r\n            return expanded ? nu$6({\r\n                classes: [slideConfig.openClass],\r\n                styles: {}\r\n            }) : nu$6({\r\n                classes: [slideConfig.closedClass],\r\n                styles: wrap$1(slideConfig.dimension.property, '0px')\r\n            });\r\n        };\r\n        var events$d = function (slideConfig, slideState) {\r\n            return derive([runOnSource(transitionend(), function (component, simulatedEvent) {\r\n                    var raw = simulatedEvent.event().raw();\r\n                    if (raw.propertyName === slideConfig.dimension.property) {\r\n                        disableTransitions(component, slideConfig);\r\n                        if (slideState.isExpanded()) {\r\n                            remove$6(component.element(), slideConfig.dimension.property);\r\n                        }\r\n                        var notify = slideState.isExpanded() ? slideConfig.onGrown : slideConfig.onShrunk;\r\n                        notify(component);\r\n                    }\r\n                })]);\r\n        };\r\n        var ActiveSliding = Object.freeze({\r\n            exhibit: exhibit$6,\r\n            events: events$d\r\n        });\r\n        var SlidingSchema = [\r\n            strict$1('closedClass'),\r\n            strict$1('openClass'),\r\n            strict$1('shrinkingClass'),\r\n            strict$1('growingClass'),\r\n            option('getAnimationRoot'),\r\n            onHandler('onShrunk'),\r\n            onHandler('onStartShrink'),\r\n            onHandler('onGrown'),\r\n            onHandler('onStartGrow'),\r\n            defaulted$1('expanded', false),\r\n            strictOf('dimension', choose$1('property', {\r\n                width: [\r\n                    output('property', 'width'),\r\n                    output('getDimension', function (elem) {\r\n                        return get$7(elem) + 'px';\r\n                    })\r\n                ],\r\n                height: [\r\n                    output('property', 'height'),\r\n                    output('getDimension', function (elem) {\r\n                        return get$8(elem) + 'px';\r\n                    })\r\n                ]\r\n            }))\r\n        ];\r\n        var init$9 = function (spec) {\r\n            var state = Cell(spec.expanded);\r\n            var readState = function () {\r\n                return 'expanded: ' + state.get();\r\n            };\r\n            return nu$5({\r\n                isExpanded: function () {\r\n                    return state.get() === true;\r\n                },\r\n                isCollapsed: function () {\r\n                    return state.get() === false;\r\n                },\r\n                setCollapsed: curry(state.set, false),\r\n                setExpanded: curry(state.set, true),\r\n                readState: readState\r\n            });\r\n        };\r\n        var SlidingState = Object.freeze({\r\n            init: init$9\r\n        });\r\n        var Sliding = create$1({\r\n            fields: SlidingSchema,\r\n            name: 'sliding',\r\n            active: ActiveSliding,\r\n            apis: SlidingApis,\r\n            state: SlidingState\r\n        });\r\n        var schema$n = constant([markers([\r\n                'closedClass',\r\n                'openClass',\r\n                'shrinkingClass',\r\n                'growingClass',\r\n                'overflowToggledClass'\r\n            ])].concat(schema$l()));\r\n        var parts$a = constant([\r\n            required({\r\n                factory: Toolbar,\r\n                schema: schema$j(),\r\n                name: 'primary'\r\n            }),\r\n            required({\r\n                factory: Toolbar,\r\n                schema: schema$j(),\r\n                name: 'overflow',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        toolbarBehaviours: derive$1([\r\n                            Sliding.config({\r\n                                dimension: { property: 'height' },\r\n                                closedClass: detail.markers.closedClass,\r\n                                openClass: detail.markers.openClass,\r\n                                shrinkingClass: detail.markers.shrinkingClass,\r\n                                growingClass: detail.markers.growingClass,\r\n                                onShrunk: function (comp) {\r\n                                    getPart(comp, detail, 'overflow-button').each(function (button) {\r\n                                        Toggling.off(button);\r\n                                        Focusing.focus(button);\r\n                                    });\r\n                                },\r\n                                onGrown: function (comp) {\r\n                                    Keying.focusIn(comp);\r\n                                },\r\n                                onStartGrow: function (comp) {\r\n                                    getPart(comp, detail, 'overflow-button').each(Toggling.on);\r\n                                }\r\n                            }),\r\n                            Keying.config({\r\n                                mode: 'acyclic',\r\n                                onEscape: function (comp) {\r\n                                    getPart(comp, detail, 'overflow-button').each(Focusing.focus);\r\n                                    return Option.some(true);\r\n                                }\r\n                            })\r\n                        ])\r\n                    };\r\n                }\r\n            }),\r\n            external$1({\r\n                name: 'overflow-button',\r\n                overrides: function (detail) {\r\n                    return {\r\n                        buttonBehaviours: derive$1([Toggling.config({\r\n                                toggleClass: detail.markers.overflowToggledClass,\r\n                                aria: { mode: 'pressed' },\r\n                                toggleOnExecute: false\r\n                            })])\r\n                    };\r\n                }\r\n            }),\r\n            external$1({ name: 'overflow-group' })\r\n        ]);\r\n        var toggleToolbar$1 = function (toolbar, detail) {\r\n            getPart(toolbar, detail, 'overflow').each(function (overf) {\r\n                refresh$3(toolbar, detail);\r\n                Sliding.toggleGrow(overf);\r\n            });\r\n        };\r\n        var isOpen$2 = function (overf) {\r\n            return Sliding.hasGrown(overf);\r\n        };\r\n        var refresh$3 = function (toolbar, detail) {\r\n            var overflow = getPart(toolbar, detail, 'overflow');\r\n            refresh(toolbar, detail, overflow, isOpen$2);\r\n            overflow.each(Sliding.refresh);\r\n        };\r\n        var factory$c = function (detail, components, spec$1, externals) {\r\n            return spec(detail, components, spec$1, externals, {\r\n                refresh: refresh$3,\r\n                toggleToolbar: toggleToolbar$1,\r\n                getOverflow: function (toolbar) {\r\n                    return getPart(toolbar, detail, 'overflow');\r\n                },\r\n                coupling: {}\r\n            });\r\n        };\r\n        var SplitSlidingToolbar = composite$1({\r\n            name: 'SplitSlidingToolbar',\r\n            configFields: schema$n(),\r\n            partFields: parts$a(),\r\n            factory: factory$c,\r\n            apis: {\r\n                setGroups: function (apis, toolbar, groups) {\r\n                    apis.setGroups(toolbar, groups);\r\n                },\r\n                refresh: function (apis, toolbar) {\r\n                    apis.refresh(toolbar);\r\n                },\r\n                getMoreButton: function (apis, toolbar) {\r\n                    return apis.getMoreButton(toolbar);\r\n                },\r\n                getOverflow: function (apis, toolbar) {\r\n                    return apis.getOverflow(toolbar);\r\n                },\r\n                toggle: function (apis, toolbar) {\r\n                    apis.toggle(toolbar);\r\n                }\r\n            }\r\n        });\r\n        var ReadOnlyChannel = 'silver.readonly';\r\n        var ReadOnlyDataSchema = objOf([strictBoolean('readonly')]);\r\n        var setDisabledAll = function (element, state) {\r\n            all('*', element.element()).forEach(function (elm) {\r\n                element.getSystem().getByDom(elm).each(function (comp) {\r\n                    if (comp.hasConfigured(Disabling)) {\r\n                        Disabling.set(comp, state);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var broadcastReadonly = function (uiComponents, readonly) {\r\n            var outerContainer = uiComponents.outerContainer;\r\n            var target = outerContainer.element();\r\n            if (readonly) {\r\n                uiComponents.mothership.broadcastOn([dismissPopups()], { target: target });\r\n                uiComponents.uiMothership.broadcastOn([dismissPopups()], { target: target });\r\n            }\r\n            uiComponents.mothership.broadcastOn([ReadOnlyChannel], { readonly: readonly });\r\n            uiComponents.uiMothership.broadcastOn([ReadOnlyChannel], { readonly: readonly });\r\n        };\r\n        var toggleToReadOnly = function (uiComponents, readonly) {\r\n            var outerContainer = uiComponents.outerContainer;\r\n            broadcastReadonly(uiComponents, readonly);\r\n            all('*', outerContainer.element()).forEach(function (elm) {\r\n                outerContainer.getSystem().getByDom(elm).each(function (comp) {\r\n                    if (comp.hasConfigured(Disabling)) {\r\n                        Disabling.set(comp, readonly);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var setupReadonlyModeSwitch = function (editor, uiComponents) {\r\n            editor.on('init', function () {\r\n                if (editor.readonly) {\r\n                    toggleToReadOnly(uiComponents, true);\r\n                }\r\n            });\r\n            editor.on('SwitchMode', function () {\r\n                return toggleToReadOnly(uiComponents, editor.readonly);\r\n            });\r\n            if (isReadOnly(editor)) {\r\n                editor.setMode('readonly');\r\n            }\r\n        };\r\n        var createReadonlyReceivingForOverflow = function (getOverflow) {\r\n            var _a;\r\n            return Receiving.config({\r\n                channels: (_a = {}, _a[ReadOnlyChannel] = {\r\n                    schema: ReadOnlyDataSchema,\r\n                    onReceive: function (comp, data) {\r\n                        getOverflow(comp).each(function (toolbar) {\r\n                            setDisabledAll(toolbar, data.readonly);\r\n                        });\r\n                    }\r\n                }, _a)\r\n            });\r\n        };\r\n        var renderToolbarGroupCommon = function (toolbarGroup) {\r\n            var attributes = toolbarGroup.title.fold(function () {\r\n                return {};\r\n            }, function (title) {\r\n                return { attributes: { title: title } };\r\n            });\r\n            return {\r\n                dom: __assign({\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar__group']\r\n                }, attributes),\r\n                components: [ToolbarGroup.parts().items({})],\r\n                items: toolbarGroup.items,\r\n                markers: { itemSelector: '*:not(.tox-split-button) > .tox-tbtn:not([disabled]), .tox-split-button:not([disabled]), .tox-toolbar-nav-js:not([disabled])' },\r\n                tgroupBehaviours: derive$1([\r\n                    Tabstopping.config({}),\r\n                    Focusing.config({})\r\n                ])\r\n            };\r\n        };\r\n        var renderToolbarGroup = function (toolbarGroup) {\r\n            return ToolbarGroup.sketch(renderToolbarGroupCommon(toolbarGroup));\r\n        };\r\n        var getToolbarbehaviours = function (toolbarSpec, modeName, getOverflow) {\r\n            var onAttached = runOnAttached(function (component) {\r\n                var groups = map(toolbarSpec.initGroups, renderToolbarGroup);\r\n                Toolbar.setGroups(component, groups);\r\n            });\r\n            return derive$1([\r\n                Keying.config({\r\n                    mode: modeName,\r\n                    onEscape: toolbarSpec.onEscape,\r\n                    selector: '.tox-toolbar__group'\r\n                }),\r\n                config('toolbar-events', [onAttached]),\r\n                createReadonlyReceivingForOverflow(getOverflow)\r\n            ]);\r\n        };\r\n        var renderMoreToolbarCommon = function (toolbarSpec, getOverflow) {\r\n            var modeName = toolbarSpec.cyclicKeying ? 'cyclic' : 'acyclic';\r\n            return {\r\n                uid: toolbarSpec.uid,\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar-overlord']\r\n                },\r\n                parts: {\r\n                    'overflow-group': renderToolbarGroupCommon({\r\n                        title: Option.none(),\r\n                        items: []\r\n                    }),\r\n                    'overflow-button': renderIconButtonSpec({\r\n                        name: 'more',\r\n                        icon: Option.some('more-drawer'),\r\n                        disabled: false,\r\n                        tooltip: Option.some('More...')\r\n                    }, Option.none(), toolbarSpec.backstage.shared.providers)\r\n                },\r\n                splitToolbarBehaviours: getToolbarbehaviours(toolbarSpec, modeName, getOverflow)\r\n            };\r\n        };\r\n        var renderFloatingMoreToolbar = function (toolbarSpec) {\r\n            var baseSpec = renderMoreToolbarCommon(toolbarSpec, SplitFloatingToolbar.getOverflow);\r\n            var primary = SplitFloatingToolbar.parts().primary({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar__primary']\r\n                }\r\n            });\r\n            return SplitFloatingToolbar.sketch(__assign({}, baseSpec, {\r\n                lazySink: toolbarSpec.getSink,\r\n                getAnchor: function () {\r\n                    return toolbarSpec.backstage.shared.anchors.toolbarOverflow();\r\n                },\r\n                parts: __assign({}, baseSpec.parts, {\r\n                    overflow: {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-toolbar__overflow']\r\n                        }\r\n                    }\r\n                }),\r\n                components: [primary],\r\n                markers: { overflowToggledClass: 'tox-tbtn--enabled' }\r\n            }));\r\n        };\r\n        var renderSlidingMoreToolbar = function (toolbarSpec) {\r\n            var primary = SplitSlidingToolbar.parts().primary({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar__primary']\r\n                }\r\n            });\r\n            var overflow = SplitSlidingToolbar.parts().overflow({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar__overflow']\r\n                }\r\n            });\r\n            var baseSpec = renderMoreToolbarCommon(toolbarSpec, SplitSlidingToolbar.getOverflow);\r\n            return SplitSlidingToolbar.sketch(__assign({}, baseSpec, {\r\n                components: [\r\n                    primary,\r\n                    overflow\r\n                ],\r\n                markers: {\r\n                    openClass: 'tox-toolbar__overflow--open',\r\n                    closedClass: 'tox-toolbar__overflow--closed',\r\n                    growingClass: 'tox-toolbar__overflow--growing',\r\n                    shrinkingClass: 'tox-toolbar__overflow--shrinking',\r\n                    overflowToggledClass: 'tox-tbtn--enabled'\r\n                }\r\n            }));\r\n        };\r\n        var renderToolbar = function (toolbarSpec) {\r\n            var modeName = toolbarSpec.cyclicKeying ? 'cyclic' : 'acyclic';\r\n            return Toolbar.sketch({\r\n                uid: toolbarSpec.uid,\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar']\r\n                },\r\n                components: [Toolbar.parts().groups({})],\r\n                toolbarBehaviours: getToolbarbehaviours(toolbarSpec, modeName, constant(Option.none()))\r\n            });\r\n        };\r\n        var baseToolbarButtonFields = [\r\n            defaultedBoolean('disabled', false),\r\n            optionString('tooltip'),\r\n            optionString('icon'),\r\n            optionString('text'),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            })\r\n        ];\r\n        var toolbarButtonSchema = objOf([\r\n            strictString('type'),\r\n            strictFunction('onAction')\r\n        ].concat(baseToolbarButtonFields));\r\n        var createToolbarButton = function (spec) {\r\n            return asRaw('toolbarbutton', toolbarButtonSchema, spec);\r\n        };\r\n        var MenuButtonSchema = objOf([\r\n            strictString('type'),\r\n            optionString('tooltip'),\r\n            optionString('icon'),\r\n            optionString('text'),\r\n            strictFunction('fetch'),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            })\r\n        ]);\r\n        var createMenuButton = function (spec) {\r\n            return asRaw('menubutton', MenuButtonSchema, spec);\r\n        };\r\n        var splitButtonSchema = objOf([\r\n            strictString('type'),\r\n            optionString('tooltip'),\r\n            optionString('icon'),\r\n            optionString('text'),\r\n            optionFunction('select'),\r\n            strictFunction('fetch'),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            }),\r\n            defaultedStringEnum('presets', 'normal', [\r\n                'normal',\r\n                'color',\r\n                'listpreview'\r\n            ]),\r\n            defaulted$1('columns', 1),\r\n            strictFunction('onAction'),\r\n            strictFunction('onItemAction')\r\n        ]);\r\n        var createSplitButton = function (spec) {\r\n            return asRaw('SplitButton', splitButtonSchema, spec);\r\n        };\r\n        var baseToolbarToggleButtonFields = [defaultedBoolean('active', false)].concat(baseToolbarButtonFields);\r\n        var toggleButtonSchema = objOf(baseToolbarToggleButtonFields.concat([\r\n            strictString('type'),\r\n            strictFunction('onAction')\r\n        ]));\r\n        var createToggleButton = function (spec) {\r\n            return asRaw('ToggleButton', toggleButtonSchema, spec);\r\n        };\r\n        var contextBarFields = [\r\n            defaultedFunction('predicate', function () {\r\n                return false;\r\n            }),\r\n            defaultedStringEnum('scope', 'node', [\r\n                'node',\r\n                'editor'\r\n            ]),\r\n            defaultedStringEnum('position', 'selection', [\r\n                'node',\r\n                'selection',\r\n                'line'\r\n            ])\r\n        ];\r\n        var contextButtonFields = baseToolbarButtonFields.concat([\r\n            defaulted$1('type', 'contextformbutton'),\r\n            defaulted$1('primary', false),\r\n            strictFunction('onAction'),\r\n            state$1('original', identity)\r\n        ]);\r\n        var contextToggleButtonFields = baseToolbarToggleButtonFields.concat([\r\n            defaulted$1('type', 'contextformbutton'),\r\n            defaulted$1('primary', false),\r\n            strictFunction('onAction'),\r\n            state$1('original', identity)\r\n        ]);\r\n        var launchButtonFields = baseToolbarButtonFields.concat([defaulted$1('type', 'contextformbutton')]);\r\n        var launchToggleButtonFields = baseToolbarToggleButtonFields.concat([defaulted$1('type', 'contextformtogglebutton')]);\r\n        var toggleOrNormal = choose$1('type', {\r\n            contextformbutton: contextButtonFields,\r\n            contextformtogglebutton: contextToggleButtonFields\r\n        });\r\n        var contextFormSchema = objOf([\r\n            defaulted$1('type', 'contextform'),\r\n            defaultedFunction('initValue', function () {\r\n                return '';\r\n            }),\r\n            optionString('label'),\r\n            strictArrayOf('commands', toggleOrNormal),\r\n            optionOf('launch', choose$1('type', {\r\n                contextformbutton: launchButtonFields,\r\n                contextformtogglebutton: launchToggleButtonFields\r\n            }))\r\n        ].concat(contextBarFields));\r\n        var contextToolbarSchema = objOf([\r\n            defaulted$1('type', 'contexttoolbar'),\r\n            strictString('items')\r\n        ].concat(contextBarFields));\r\n        var createContextToolbar = function (spec) {\r\n            return asRaw('ContextToolbar', contextToolbarSchema, spec);\r\n        };\r\n        var createContextForm = function (spec) {\r\n            return asRaw('ContextForm', contextFormSchema, spec);\r\n        };\r\n        var internalToolbarButtonExecute = generate$1('toolbar.button.execute');\r\n        var onToolbarButtonExecute = function (info) {\r\n            return runOnExecute(function (comp, simulatedEvent) {\r\n                runWithApi(info, comp)(function (itemApi) {\r\n                    emitWith(comp, internalToolbarButtonExecute, { buttonApi: itemApi });\r\n                    info.onAction(itemApi);\r\n                });\r\n            });\r\n        };\r\n        var toolbarButtonEventOrder = {\r\n            'alloy.execute': [\r\n                'disabling',\r\n                'alloy.base.behaviour',\r\n                'toggling',\r\n                'toolbar-button-events'\r\n            ]\r\n        };\r\n        var getState$2 = function (component, replaceConfig, reflectState) {\r\n            return reflectState;\r\n        };\r\n        var ReflectingApis = Object.freeze({\r\n            getState: getState$2\r\n        });\r\n        var events$e = function (reflectingConfig, reflectingState) {\r\n            var update = function (component, data) {\r\n                reflectingConfig.updateState.each(function (updateState) {\r\n                    var newState = updateState(component, data);\r\n                    reflectingState.set(newState);\r\n                });\r\n                reflectingConfig.renderComponents.each(function (renderComponents) {\r\n                    var newComponents = renderComponents(data, reflectingState.get());\r\n                    detachChildren(component);\r\n                    each(newComponents, function (c) {\r\n                        attach(component, component.getSystem().build(c));\r\n                    });\r\n                });\r\n            };\r\n            return derive([\r\n                run(receive(), function (component, message) {\r\n                    var channel = reflectingConfig.channel;\r\n                    if (contains(message.channels(), channel)) {\r\n                        update(component, message.data());\r\n                    }\r\n                }),\r\n                runOnAttached(function (comp, se) {\r\n                    reflectingConfig.initialData.each(function (rawData) {\r\n                        update(comp, rawData);\r\n                    });\r\n                })\r\n            ]);\r\n        };\r\n        var ActiveReflecting = Object.freeze({\r\n            events: events$e\r\n        });\r\n        var init$a = function (spec) {\r\n            var cell = Cell(Option.none());\r\n            var set = function (optS) {\r\n                return cell.set(optS);\r\n            };\r\n            var clear = function () {\r\n                return cell.set(Option.none());\r\n            };\r\n            var get = function () {\r\n                return cell.get();\r\n            };\r\n            var readState = function () {\r\n                return cell.get().getOr('none');\r\n            };\r\n            return {\r\n                readState: readState,\r\n                get: get,\r\n                set: set,\r\n                clear: clear\r\n            };\r\n        };\r\n        var ReflectingState = Object.freeze({\r\n            init: init$a\r\n        });\r\n        var ReflectingSchema = [\r\n            strict$1('channel'),\r\n            option('renderComponents'),\r\n            option('updateState'),\r\n            option('initialData')\r\n        ];\r\n        var Reflecting = create$1({\r\n            fields: ReflectingSchema,\r\n            name: 'reflecting',\r\n            active: ActiveReflecting,\r\n            apis: ReflectingApis,\r\n            state: ReflectingState\r\n        });\r\n        var schema$o = constant([\r\n            strict$1('toggleClass'),\r\n            strict$1('fetch'),\r\n            onStrictHandler('onExecute'),\r\n            defaulted$1('getHotspot', Option.some),\r\n            defaulted$1('getAnchorOverrides', constant({})),\r\n            defaulted$1('layouts', Option.none()),\r\n            onStrictHandler('onItemExecute'),\r\n            option('lazySink'),\r\n            strict$1('dom'),\r\n            onHandler('onOpen'),\r\n            field$1('splitDropdownBehaviours', [\r\n                Coupling,\r\n                Keying,\r\n                Focusing\r\n            ]),\r\n            defaulted$1('matchWidth', false),\r\n            defaulted$1('useMinWidth', false),\r\n            defaulted$1('eventOrder', {}),\r\n            option('role')\r\n        ].concat(sandboxFields()));\r\n        var arrowPart = required({\r\n            factory: Button,\r\n            schema: [strict$1('dom')],\r\n            name: 'arrow',\r\n            defaults: function (detail) {\r\n                return { buttonBehaviours: derive$1([Focusing.revoke()]) };\r\n            },\r\n            overrides: function (detail) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'span',\r\n                        attributes: { role: 'presentation' }\r\n                    },\r\n                    action: function (arrow) {\r\n                        arrow.getSystem().getByUid(detail.uid).each(emitExecute);\r\n                    },\r\n                    buttonBehaviours: derive$1([Toggling.config({\r\n                            toggleOnExecute: false,\r\n                            toggleClass: detail.toggleClass\r\n                        })])\r\n                };\r\n            }\r\n        });\r\n        var buttonPart = required({\r\n            factory: Button,\r\n            schema: [strict$1('dom')],\r\n            name: 'button',\r\n            defaults: function (detail) {\r\n                return { buttonBehaviours: derive$1([Focusing.revoke()]) };\r\n            },\r\n            overrides: function (detail) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'span',\r\n                        attributes: { role: 'presentation' }\r\n                    },\r\n                    action: function (btn) {\r\n                        btn.getSystem().getByUid(detail.uid).each(function (splitDropdown) {\r\n                            detail.onExecute(splitDropdown, btn);\r\n                        });\r\n                    }\r\n                };\r\n            }\r\n        });\r\n        var parts$b = constant([\r\n            arrowPart,\r\n            buttonPart,\r\n            optional({\r\n                factory: {\r\n                    sketch: function (spec) {\r\n                        return {\r\n                            uid: spec.uid,\r\n                            dom: {\r\n                                tag: 'span',\r\n                                styles: { display: 'none' },\r\n                                attributes: { 'aria-hidden': 'true' },\r\n                                innerHtml: spec.text\r\n                            }\r\n                        };\r\n                    }\r\n                },\r\n                schema: [strict$1('text')],\r\n                name: 'aria-descriptor'\r\n            }),\r\n            external$1({\r\n                schema: [tieredMenuMarkers()],\r\n                name: 'menu',\r\n                defaults: function (detail) {\r\n                    return {\r\n                        onExecute: function (tmenu, item) {\r\n                            tmenu.getSystem().getByUid(detail.uid).each(function (splitDropdown) {\r\n                                detail.onItemExecute(splitDropdown, tmenu, item);\r\n                            });\r\n                        }\r\n                    };\r\n                }\r\n            }),\r\n            partType()\r\n        ]);\r\n        var factory$d = function (detail, components, spec, externals) {\r\n            var switchToMenu = function (sandbox) {\r\n                Composing.getCurrent(sandbox).each(function (current) {\r\n                    Highlighting.highlightFirst(current);\r\n                    Keying.focusIn(current);\r\n                });\r\n            };\r\n            var action = function (component) {\r\n                var onOpenSync = switchToMenu;\r\n                togglePopup(detail, function (x) {\r\n                    return x;\r\n                }, component, externals, onOpenSync, HighlightOnOpen.HighlightFirst).get(noop);\r\n            };\r\n            var openMenu = function (comp) {\r\n                action(comp);\r\n                return Option.some(true);\r\n            };\r\n            var executeOnButton = function (comp) {\r\n                var button = getPartOrDie(comp, detail, 'button');\r\n                emitExecute(button);\r\n                return Option.some(true);\r\n            };\r\n            var buttonEvents = merge(derive([runOnAttached(function (component, simulatedEvent) {\r\n                    var ariaDescriptor = getPart(component, detail, 'aria-descriptor');\r\n                    ariaDescriptor.each(function (descriptor) {\r\n                        var descriptorId = generate$1('aria');\r\n                        set$1(descriptor.element(), 'id', descriptorId);\r\n                        set$1(component.element(), 'aria-describedby', descriptorId);\r\n                    });\r\n                })]), events$7(Option.some(action)));\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                eventOrder: __assign({}, detail.eventOrder, {\r\n                    'alloy.execute': [\r\n                        'disabling',\r\n                        'toggling',\r\n                        'alloy.base.behaviour'\r\n                    ]\r\n                }),\r\n                events: buttonEvents,\r\n                behaviours: augment(detail.splitDropdownBehaviours, [\r\n                    Coupling.config({\r\n                        others: {\r\n                            sandbox: function (hotspot) {\r\n                                var arrow = getPartOrDie(hotspot, detail, 'arrow');\r\n                                var extras = {\r\n                                    onOpen: function () {\r\n                                        Toggling.on(arrow);\r\n                                        Toggling.on(hotspot);\r\n                                    },\r\n                                    onClose: function () {\r\n                                        Toggling.off(arrow);\r\n                                        Toggling.off(hotspot);\r\n                                    }\r\n                                };\r\n                                return makeSandbox(detail, hotspot, extras);\r\n                            }\r\n                        }\r\n                    }),\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onSpace: executeOnButton,\r\n                        onEnter: executeOnButton,\r\n                        onDown: openMenu\r\n                    }),\r\n                    Focusing.config({}),\r\n                    Toggling.config({\r\n                        toggleOnExecute: false,\r\n                        aria: { mode: 'expanded' }\r\n                    })\r\n                ]),\r\n                domModification: {\r\n                    attributes: {\r\n                        'role': detail.role.getOr('button'),\r\n                        'aria-haspopup': true\r\n                    }\r\n                }\r\n            };\r\n        };\r\n        var SplitDropdown = composite$1({\r\n            name: 'SplitDropdown',\r\n            configFields: schema$o(),\r\n            partFields: parts$b(),\r\n            factory: factory$d\r\n        });\r\n        var updateMenuText = generate$1('update-menu-text');\r\n        var updateMenuIcon = generate$1('update-menu-icon');\r\n        var renderCommonDropdown = function (spec, prefix, sharedBackstage) {\r\n            var editorOffCell = Cell(noop);\r\n            var optMemDisplayText = spec.text.map(function (text) {\r\n                return record(renderLabel$1(text, prefix, sharedBackstage.providers));\r\n            });\r\n            var optMemDisplayIcon = spec.icon.map(function (iconName) {\r\n                return record(renderReplacableIconFromPack(iconName, sharedBackstage.providers.icons));\r\n            });\r\n            var onLeftOrRightInMenu = function (comp, se) {\r\n                var dropdown = Representing.getValue(comp);\r\n                Focusing.focus(dropdown);\r\n                emitWith(dropdown, 'keydown', { raw: se.event().raw() });\r\n                Dropdown.close(dropdown);\r\n                return Option.some(true);\r\n            };\r\n            var role = spec.role.fold(function () {\r\n                return {};\r\n            }, function (role) {\r\n                return { role: role };\r\n            });\r\n            var tooltipAttributes = spec.tooltip.fold(function () {\r\n                return {};\r\n            }, function (tooltip) {\r\n                var translatedTooltip = sharedBackstage.providers.translate(tooltip);\r\n                return {\r\n                    'title': translatedTooltip,\r\n                    'aria-label': translatedTooltip\r\n                };\r\n            });\r\n            var memDropdown = record(Dropdown.sketch(__assign({}, role, {\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: [\r\n                        prefix,\r\n                        prefix + '--select'\r\n                    ].concat(map(spec.classes, function (c) {\r\n                        return prefix + '--' + c;\r\n                    })),\r\n                    attributes: __assign({}, tooltipAttributes)\r\n                },\r\n                components: componentRenderPipeline([\r\n                    optMemDisplayIcon.map(function (mem) {\r\n                        return mem.asSpec();\r\n                    }),\r\n                    optMemDisplayText.map(function (mem) {\r\n                        return mem.asSpec();\r\n                    }),\r\n                    Option.some({\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: [prefix + '__select-chevron'],\r\n                            innerHtml: get$c('chevron-down', sharedBackstage.providers.icons)\r\n                        }\r\n                    })\r\n                ]),\r\n                matchWidth: true,\r\n                useMinWidth: true,\r\n                dropdownBehaviours: derive$1(spec.dropdownBehaviours.concat([\r\n                    DisablingConfigs.button(spec.disabled),\r\n                    Unselecting.config({}),\r\n                    Replacing.config({}),\r\n                    config('dropdown-events', [\r\n                        onControlAttached(spec, editorOffCell),\r\n                        onControlDetached(spec, editorOffCell)\r\n                    ]),\r\n                    config('menubutton-update-display-text', [\r\n                        run(updateMenuText, function (comp, se) {\r\n                            optMemDisplayText.bind(function (mem) {\r\n                                return mem.getOpt(comp);\r\n                            }).each(function (displayText) {\r\n                                Replacing.set(displayText, [text(sharedBackstage.providers.translate(se.event().text()))]);\r\n                            });\r\n                        }),\r\n                        run(updateMenuIcon, function (comp, se) {\r\n                            optMemDisplayIcon.bind(function (mem) {\r\n                                return mem.getOpt(comp);\r\n                            }).each(function (displayIcon) {\r\n                                Replacing.set(displayIcon, [renderReplacableIconFromPack(se.event().icon(), sharedBackstage.providers.icons)]);\r\n                            });\r\n                        })\r\n                    ])\r\n                ])),\r\n                eventOrder: deepMerge(toolbarButtonEventOrder, {\r\n                    mousedown: [\r\n                        'focusing',\r\n                        'alloy.base.behaviour',\r\n                        'item-type-events',\r\n                        'normal-dropdown-events'\r\n                    ]\r\n                }),\r\n                sandboxBehaviours: derive$1([Keying.config({\r\n                        mode: 'special',\r\n                        onLeft: onLeftOrRightInMenu,\r\n                        onRight: onLeftOrRightInMenu\r\n                    })]),\r\n                lazySink: sharedBackstage.getSink,\r\n                toggleClass: prefix + '--active',\r\n                parts: { menu: part(false, spec.columns, spec.presets) },\r\n                fetch: function () {\r\n                    return Future.nu(spec.fetch);\r\n                }\r\n            })));\r\n            return memDropdown.asSpec();\r\n        };\r\n        var getButtonApi = function (component) {\r\n            return {\r\n                isDisabled: function () {\r\n                    return Disabling.isDisabled(component);\r\n                },\r\n                setDisabled: function (state) {\r\n                    return Disabling.set(component, state);\r\n                }\r\n            };\r\n        };\r\n        var getToggleApi = function (component) {\r\n            return {\r\n                setActive: function (state) {\r\n                    Toggling.set(component, state);\r\n                },\r\n                isActive: function () {\r\n                    return Toggling.isOn(component);\r\n                },\r\n                isDisabled: function () {\r\n                    return Disabling.isDisabled(component);\r\n                },\r\n                setDisabled: function (state) {\r\n                    return Disabling.set(component, state);\r\n                }\r\n            };\r\n        };\r\n        var getMenuButtonApi = function (component) {\r\n            return {\r\n                isDisabled: function () {\r\n                    return Disabling.isDisabled(component);\r\n                },\r\n                setDisabled: function (state) {\r\n                    return Disabling.set(component, state);\r\n                },\r\n                setActive: function (state) {\r\n                    var elm = component.element();\r\n                    if (state) {\r\n                        add$2(elm, 'tox-tbtn--enabled');\r\n                        set$1(elm, 'aria-pressed', true);\r\n                    }\r\n                    else {\r\n                        remove$4(elm, 'tox-tbtn--enabled');\r\n                        remove$1(elm, 'aria-pressed');\r\n                    }\r\n                },\r\n                isActive: function () {\r\n                    return has$2(component.element(), 'tox-tbtn--enabled');\r\n                }\r\n            };\r\n        };\r\n        var getTooltipAttributes = function (tooltip, providersBackstage) {\r\n            return tooltip.map(function (tooltip) {\r\n                return {\r\n                    'aria-label': providersBackstage.translate(tooltip),\r\n                    'title': providersBackstage.translate(tooltip)\r\n                };\r\n            }).getOr({});\r\n        };\r\n        var focusButtonEvent = generate$1('focus-button');\r\n        var rtlIcon$1 = [\r\n            'checklist',\r\n            'ordered-list'\r\n        ];\r\n        var rtlTransform$1 = [\r\n            'indent',\r\n            'outdent',\r\n            'table-insert-column-after',\r\n            'table-insert-column-before',\r\n            'unordered-list'\r\n        ];\r\n        var renderCommonStructure = function (icon, text, tooltip, receiver, behaviours, providersBackstage) {\r\n            var _a;\r\n            var getIconName = function (iconName) {\r\n                return global$3.isRtl() && contains(rtlIcon$1, iconName) ? iconName + '-rtl' : iconName;\r\n            };\r\n            var needsRtlClass = global$3.isRtl() && icon.exists(function (name) {\r\n                return contains(rtlTransform$1, name);\r\n            });\r\n            return {\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: ['tox-tbtn'].concat(text.isSome() ? ['tox-tbtn--select'] : []).concat(needsRtlClass ? ['tox-tbtn__icon-rtl'] : []),\r\n                    attributes: getTooltipAttributes(tooltip, providersBackstage)\r\n                },\r\n                components: componentRenderPipeline([\r\n                    icon.map(function (iconName) {\r\n                        return renderIconFromPack(getIconName(iconName), providersBackstage.icons);\r\n                    }),\r\n                    text.map(function (text) {\r\n                        return renderLabel$1(text, 'tox-tbtn', providersBackstage);\r\n                    })\r\n                ]),\r\n                eventOrder: (_a = {}, _a[mousedown()] = [\r\n                    'focusing',\r\n                    'alloy.base.behaviour',\r\n                    'common-button-display-events'\r\n                ], _a),\r\n                buttonBehaviours: derive$1([config('common-button-display-events', [run(mousedown(), function (button, se) {\r\n                            se.event().prevent();\r\n                            emit(button, focusButtonEvent);\r\n                        })])].concat(receiver.map(function (r) {\r\n                    return Reflecting.config({\r\n                        channel: r,\r\n                        initialData: {\r\n                            icon: icon,\r\n                            text: text\r\n                        },\r\n                        renderComponents: function (data, _state) {\r\n                            return componentRenderPipeline([\r\n                                data.icon.map(function (iconName) {\r\n                                    return renderIconFromPack(getIconName(iconName), providersBackstage.icons);\r\n                                }),\r\n                                data.text.map(function (text) {\r\n                                    return renderLabel$1(text, 'tox-tbtn', providersBackstage);\r\n                                })\r\n                            ]);\r\n                        }\r\n                    });\r\n                }).toArray()).concat(behaviours.getOr([])))\r\n            };\r\n        };\r\n        var renderCommonToolbarButton = function (spec, specialisation, providersBackstage) {\r\n            var editorOffCell = Cell(noop);\r\n            var structure = renderCommonStructure(spec.icon, spec.text, spec.tooltip, Option.none(), Option.none(), providersBackstage);\r\n            return Button.sketch({\r\n                dom: structure.dom,\r\n                components: structure.components,\r\n                eventOrder: toolbarButtonEventOrder,\r\n                buttonBehaviours: derive$1([\r\n                    config('toolbar-button-events', [\r\n                        onToolbarButtonExecute({\r\n                            onAction: spec.onAction,\r\n                            getApi: specialisation.getApi\r\n                        }),\r\n                        onControlAttached(specialisation, editorOffCell),\r\n                        onControlDetached(specialisation, editorOffCell)\r\n                    ]),\r\n                    DisablingConfigs.button(spec.disabled)\r\n                ].concat(specialisation.toolbarButtonBehaviours))\r\n            });\r\n        };\r\n        var renderToolbarButton = function (spec, providersBackstage) {\r\n            return renderToolbarButtonWith(spec, providersBackstage, []);\r\n        };\r\n        var renderToolbarButtonWith = function (spec, providersBackstage, bonusEvents) {\r\n            return renderCommonToolbarButton(spec, {\r\n                toolbarButtonBehaviours: [].concat(bonusEvents.length > 0 ? [config('toolbarButtonWith', bonusEvents)] : []),\r\n                getApi: getButtonApi,\r\n                onSetup: spec.onSetup\r\n            }, providersBackstage);\r\n        };\r\n        var renderToolbarToggleButton = function (spec, providersBackstage) {\r\n            return renderToolbarToggleButtonWith(spec, providersBackstage, []);\r\n        };\r\n        var renderToolbarToggleButtonWith = function (spec, providersBackstage, bonusEvents) {\r\n            return deepMerge(renderCommonToolbarButton(spec, {\r\n                toolbarButtonBehaviours: [\r\n                    Replacing.config({}),\r\n                    Toggling.config({\r\n                        toggleClass: 'tox-tbtn--enabled',\r\n                        aria: { mode: 'pressed' },\r\n                        toggleOnExecute: false\r\n                    })\r\n                ].concat(bonusEvents.length > 0 ? [config('toolbarToggleButtonWith', bonusEvents)] : []),\r\n                getApi: getToggleApi,\r\n                onSetup: spec.onSetup\r\n            }, providersBackstage));\r\n        };\r\n        var fetchChoices = function (getApi, spec, providersBackstage) {\r\n            return function (comp) {\r\n                return Future.nu(function (callback) {\r\n                    return spec.fetch(callback);\r\n                }).map(function (items) {\r\n                    return Option.from(createTieredDataFrom(deepMerge(createPartialChoiceMenu(generate$1('menu-value'), items, function (value) {\r\n                        spec.onItemAction(getApi(comp), value);\r\n                    }, spec.columns, spec.presets, ItemResponse$1.CLOSE_ON_EXECUTE, spec.select.getOr(function () {\r\n                        return false;\r\n                    }), providersBackstage), {\r\n                        movement: deriveMenuMovement(spec.columns, spec.presets),\r\n                        menuBehaviours: SimpleBehaviours.unnamedEvents(spec.columns !== 'auto' ? [] : [runOnAttached(function (comp, se) {\r\n                                detectSize(comp, 4, classForPreset(spec.presets)).each(function (_a) {\r\n                                    var numRows = _a.numRows, numColumns = _a.numColumns;\r\n                                    Keying.setGridSize(comp, numRows, numColumns);\r\n                                });\r\n                            })])\r\n                    })));\r\n                });\r\n            };\r\n        };\r\n        var renderSplitButton = function (spec, sharedBackstage) {\r\n            var _a;\r\n            var displayChannel = generate$1('channel-update-split-dropdown-display');\r\n            var getApi = function (comp) {\r\n                return {\r\n                    isDisabled: function () {\r\n                        return Disabling.isDisabled(comp);\r\n                    },\r\n                    setDisabled: function (state) {\r\n                        return Disabling.set(comp, state);\r\n                    },\r\n                    setIconFill: function (id, value) {\r\n                        descendant$2(comp.element(), 'svg path[id=\"' + id + '\"], rect[id=\"' + id + '\"]').each(function (underlinePath) {\r\n                            set$1(underlinePath, 'fill', value);\r\n                        });\r\n                    },\r\n                    setIconStroke: function (id, value) {\r\n                        descendant$2(comp.element(), 'svg path[id=\"' + id + '\"], rect[id=\"' + id + '\"]').each(function (underlinePath) {\r\n                            set$1(underlinePath, 'stroke', value);\r\n                        });\r\n                    },\r\n                    setActive: function (state) {\r\n                        set$1(comp.element(), 'aria-pressed', state);\r\n                        descendant$2(comp.element(), 'span').each(function (button) {\r\n                            comp.getSystem().getByDom(button).each(function (buttonComp) {\r\n                                return Toggling.set(buttonComp, state);\r\n                            });\r\n                        });\r\n                    },\r\n                    isActive: function () {\r\n                        return descendant$2(comp.element(), 'span').exists(function (button) {\r\n                            return comp.getSystem().getByDom(button).exists(Toggling.isOn);\r\n                        });\r\n                    }\r\n                };\r\n            };\r\n            var editorOffCell = Cell(noop);\r\n            var specialisation = {\r\n                getApi: getApi,\r\n                onSetup: spec.onSetup\r\n            };\r\n            return SplitDropdown.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-split-button'],\r\n                    attributes: merge({ 'aria-pressed': false }, getTooltipAttributes(spec.tooltip, sharedBackstage.providers))\r\n                },\r\n                onExecute: function (button) {\r\n                    spec.onAction(getApi(button));\r\n                },\r\n                onItemExecute: function (a, b, c) {\r\n                },\r\n                splitDropdownBehaviours: derive$1([\r\n                    DisablingConfigs.splitButton(false),\r\n                    config('split-dropdown-events', [\r\n                        run(focusButtonEvent, Focusing.focus),\r\n                        onControlAttached(specialisation, editorOffCell),\r\n                        onControlDetached(specialisation, editorOffCell)\r\n                    ])\r\n                ]),\r\n                eventOrder: (_a = {}, _a[attachedToDom()] = [\r\n                    'alloy.base.behaviour',\r\n                    'split-dropdown-events'\r\n                ], _a),\r\n                toggleClass: 'tox-tbtn--enabled',\r\n                lazySink: sharedBackstage.getSink,\r\n                fetch: fetchChoices(getApi, spec, sharedBackstage.providers),\r\n                parts: { menu: part(false, spec.columns, spec.presets) },\r\n                components: [\r\n                    SplitDropdown.parts().button(renderCommonStructure(spec.icon, spec.text, Option.none(), Option.some(displayChannel), Option.some([Toggling.config({\r\n                            toggleClass: 'tox-tbtn--enabled',\r\n                            toggleOnExecute: false\r\n                        })]), sharedBackstage.providers)),\r\n                    SplitDropdown.parts().arrow({\r\n                        dom: {\r\n                            tag: 'button',\r\n                            classes: [\r\n                                'tox-tbtn',\r\n                                'tox-split-button__chevron'\r\n                            ],\r\n                            innerHtml: get$c('chevron-down', sharedBackstage.providers.icons)\r\n                        }\r\n                    }),\r\n                    SplitDropdown.parts()['aria-descriptor']({ text: sharedBackstage.providers.translate('To open the popup, press Shift+Enter') })\r\n                ]\r\n            });\r\n        };\r\n        var renderMenuButton = function (spec, prefix, backstage, role) {\r\n            return renderCommonDropdown({\r\n                text: spec.text,\r\n                icon: spec.icon,\r\n                tooltip: spec.tooltip,\r\n                role: role,\r\n                fetch: function (callback) {\r\n                    spec.fetch(function (items) {\r\n                        callback(build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage));\r\n                    });\r\n                },\r\n                onSetup: spec.onSetup,\r\n                getApi: getMenuButtonApi,\r\n                columns: 1,\r\n                presets: 'normal',\r\n                classes: [],\r\n                dropdownBehaviours: []\r\n            }, prefix, backstage.shared);\r\n        };\r\n        var getFormApi = function (input) {\r\n            return {\r\n                hide: function () {\r\n                    return emit(input, sandboxClose());\r\n                },\r\n                getValue: function () {\r\n                    return Representing.getValue(input);\r\n                }\r\n            };\r\n        };\r\n        var runOnExecute$1 = function (memInput, original) {\r\n            return run(internalToolbarButtonExecute, function (comp, se) {\r\n                var input = memInput.get(comp);\r\n                var formApi = getFormApi(input);\r\n                original.onAction(formApi, se.event().buttonApi());\r\n            });\r\n        };\r\n        var renderContextButton = function (memInput, button, extras) {\r\n            var _a = button.original, primary = _a.primary, rest = __rest(_a, ['primary']);\r\n            var bridged = getOrDie$1(createToolbarButton(__assign({}, rest, {\r\n                type: 'button',\r\n                onAction: function () {\r\n                }\r\n            })));\r\n            return renderToolbarButtonWith(bridged, extras.backstage.shared.providers, [runOnExecute$1(memInput, button)]);\r\n        };\r\n        var renderContextToggleButton = function (memInput, button, extras) {\r\n            var _a = button.original, primary = _a.primary, rest = __rest(_a, ['primary']);\r\n            var bridged = getOrDie$1(createToggleButton(__assign({}, rest, {\r\n                type: 'togglebutton',\r\n                onAction: function () {\r\n                }\r\n            })));\r\n            return renderToolbarToggleButtonWith(bridged, extras.backstage.shared.providers, [runOnExecute$1(memInput, button)]);\r\n        };\r\n        var generateOne$1 = function (memInput, button, providersBackstage) {\r\n            var extras = { backstage: { shared: { providers: providersBackstage } } };\r\n            if (button.type === 'contextformtogglebutton') {\r\n                return renderContextToggleButton(memInput, button, extras);\r\n            }\r\n            else {\r\n                return renderContextButton(memInput, button, extras);\r\n            }\r\n        };\r\n        var generate$7 = function (memInput, buttons, providersBackstage) {\r\n            var mementos = map(buttons, function (button) {\r\n                return record(generateOne$1(memInput, button, providersBackstage));\r\n            });\r\n            var asSpecs = function () {\r\n                return map(mementos, function (mem) {\r\n                    return mem.asSpec();\r\n                });\r\n            };\r\n            var findPrimary = function (compInSystem) {\r\n                return findMap(buttons, function (button, i) {\r\n                    if (button.primary) {\r\n                        return Option.from(mementos[i]).bind(function (mem) {\r\n                            return mem.getOpt(compInSystem);\r\n                        }).filter(not(Disabling.isDisabled));\r\n                    }\r\n                    else {\r\n                        return Option.none();\r\n                    }\r\n                });\r\n            };\r\n            return {\r\n                asSpecs: asSpecs,\r\n                findPrimary: findPrimary\r\n            };\r\n        };\r\n        var renderContextForm = function (ctx, backstage) {\r\n            var inputAttributes = ctx.label.fold(function () {\r\n                return {};\r\n            }, function (label) {\r\n                return { 'aria-label': label };\r\n            });\r\n            var memInput = record(Input.sketch({\r\n                inputClasses: [\r\n                    'tox-toolbar-textfield',\r\n                    'tox-toolbar-nav-js'\r\n                ],\r\n                data: ctx.initValue(),\r\n                inputAttributes: inputAttributes,\r\n                selectOnFocus: true,\r\n                inputBehaviours: derive$1([Keying.config({\r\n                        mode: 'special',\r\n                        onEnter: function (input) {\r\n                            return commands.findPrimary(input).map(function (primary) {\r\n                                emitExecute(primary);\r\n                                return true;\r\n                            });\r\n                        },\r\n                        onLeft: function (comp, se) {\r\n                            se.cut();\r\n                            return Option.none();\r\n                        },\r\n                        onRight: function (comp, se) {\r\n                            se.cut();\r\n                            return Option.none();\r\n                        }\r\n                    })])\r\n            }));\r\n            var commands = generate$7(memInput, ctx.commands, backstage.shared.providers);\r\n            return renderToolbar({\r\n                uid: generate$1('context-toolbar'),\r\n                initGroups: [\r\n                    {\r\n                        title: Option.none(),\r\n                        items: [memInput.asSpec()]\r\n                    },\r\n                    {\r\n                        title: Option.none(),\r\n                        items: commands.asSpecs()\r\n                    }\r\n                ],\r\n                onEscape: Option.none,\r\n                cyclicKeying: true,\r\n                backstage: backstage,\r\n                getSink: function () {\r\n                    return Result.error('');\r\n                }\r\n            });\r\n        };\r\n        var ContextForm = { renderContextForm: renderContextForm };\r\n        var forwardSlideEvent = generate$1('forward-slide');\r\n        var backSlideEvent = generate$1('backward-slide');\r\n        var changeSlideEvent = generate$1('change-slide-event');\r\n        var resizingClass = 'tox-pop--resizing';\r\n        var renderContextToolbar = function (spec) {\r\n            var stack = Cell([]);\r\n            return InlineView.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-pop']\r\n                },\r\n                fireDismissalEventInstead: { event: 'doNotDismissYet' },\r\n                onShow: function (comp) {\r\n                    stack.set([]);\r\n                    InlineView.getContent(comp).each(function (c) {\r\n                        remove$6(c.element(), 'visibility');\r\n                    });\r\n                    remove$4(comp.element(), resizingClass);\r\n                    remove$6(comp.element(), 'width');\r\n                },\r\n                inlineBehaviours: derive$1([\r\n                    config('context-toolbar-events', [\r\n                        runOnSource(transitionend(), function (comp, se) {\r\n                            InlineView.getContent(comp).each(function (c) {\r\n                            });\r\n                            remove$4(comp.element(), resizingClass);\r\n                            remove$6(comp.element(), 'width');\r\n                        }),\r\n                        run(changeSlideEvent, function (comp, se) {\r\n                            remove$6(comp.element(), 'width');\r\n                            var currentWidth = get$7(comp.element());\r\n                            InlineView.setContent(comp, se.event().contents());\r\n                            add$2(comp.element(), resizingClass);\r\n                            var newWidth = get$7(comp.element());\r\n                            set$2(comp.element(), 'width', currentWidth + 'px');\r\n                            InlineView.getContent(comp).each(function (newContents) {\r\n                                se.event().focus().bind(function (f) {\r\n                                    focus$1(f);\r\n                                    return search$1(comp.element());\r\n                                }).orThunk(function () {\r\n                                    Keying.focusIn(newContents);\r\n                                    return active();\r\n                                });\r\n                            });\r\n                            global$1.setTimeout(function () {\r\n                                set$2(comp.element(), 'width', newWidth + 'px');\r\n                            }, 0);\r\n                        }),\r\n                        run(forwardSlideEvent, function (comp, se) {\r\n                            InlineView.getContent(comp).each(function (oldContents) {\r\n                                stack.set(stack.get().concat([{\r\n                                        bar: oldContents,\r\n                                        focus: active()\r\n                                    }]));\r\n                            });\r\n                            emitWith(comp, changeSlideEvent, {\r\n                                contents: se.event().forwardContents(),\r\n                                focus: Option.none()\r\n                            });\r\n                        }),\r\n                        run(backSlideEvent, function (comp, se) {\r\n                            last(stack.get()).each(function (last) {\r\n                                stack.set(stack.get().slice(0, stack.get().length - 1));\r\n                                emitWith(comp, changeSlideEvent, {\r\n                                    contents: premade$1(last.bar),\r\n                                    focus: last.focus\r\n                                });\r\n                            });\r\n                        })\r\n                    ]),\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onEscape: function (comp) {\r\n                            return last(stack.get()).fold(function () {\r\n                                return spec.onEscape();\r\n                            }, function (_) {\r\n                                emit(comp, backSlideEvent);\r\n                                return Option.some(true);\r\n                            });\r\n                        }\r\n                    })\r\n                ]),\r\n                lazySink: function () {\r\n                    return Result.value(spec.sink);\r\n                }\r\n            });\r\n        };\r\n        var ancestor$3 = function (scope, transform, isRoot) {\r\n            var element = scope.dom();\r\n            var stop = isFunction(isRoot) ? isRoot : constant(false);\r\n            while (element.parentNode) {\r\n                element = element.parentNode;\r\n                var el = Element.fromDom(element);\r\n                var transformed = transform(el);\r\n                if (transformed.isSome()) {\r\n                    return transformed;\r\n                }\r\n                else if (stop(el)) {\r\n                    break;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var matchTargetWith = function (elem, toolbars) {\r\n            return findMap(toolbars, function (toolbarApi) {\r\n                return toolbarApi.predicate(elem.dom()) ? Option.some({\r\n                    toolbarApi: toolbarApi,\r\n                    elem: elem\r\n                }) : Option.none();\r\n            });\r\n        };\r\n        var lookup$1 = function (scopes, editor) {\r\n            var isRoot = function (elem) {\r\n                return elem.dom() === editor.getBody();\r\n            };\r\n            var startNode = Element.fromDom(editor.selection.getNode());\r\n            return matchTargetWith(startNode, scopes.inNodeScope).orThunk(function () {\r\n                return matchTargetWith(startNode, scopes.inEditorScope).orThunk(function () {\r\n                    return ancestor$3(startNode, function (elem) {\r\n                        return matchTargetWith(elem, scopes.inNodeScope);\r\n                    }, isRoot);\r\n                });\r\n            });\r\n        };\r\n        var ToolbarLookup = { lookup: lookup$1 };\r\n        var categorise = function (contextToolbars, navigate) {\r\n            var forms = {};\r\n            var inNodeScope = [];\r\n            var inEditorScope = [];\r\n            var formNavigators = {};\r\n            var lookupTable = {};\r\n            var registerForm = function (key, toolbarApi) {\r\n                var contextForm = getOrDie$1(createContextForm(toolbarApi));\r\n                forms[key] = contextForm;\r\n                contextForm.launch.map(function (launch) {\r\n                    formNavigators['form:' + key + ''] = __assign({}, toolbarApi.launch, {\r\n                        type: launch.type === 'contextformtogglebutton' ? 'togglebutton' : 'button',\r\n                        onAction: function () {\r\n                            navigate(contextForm);\r\n                        }\r\n                    });\r\n                });\r\n                if (contextForm.scope === 'editor') {\r\n                    inEditorScope.push(contextForm);\r\n                }\r\n                else {\r\n                    inNodeScope.push(contextForm);\r\n                }\r\n                lookupTable[key] = contextForm;\r\n            };\r\n            var registerToolbar = function (key, toolbarApi) {\r\n                createContextToolbar(toolbarApi).each(function (contextToolbar) {\r\n                    if (toolbarApi.scope === 'editor') {\r\n                        inEditorScope.push(contextToolbar);\r\n                    }\r\n                    else {\r\n                        inNodeScope.push(contextToolbar);\r\n                    }\r\n                    lookupTable[key] = contextToolbar;\r\n                });\r\n            };\r\n            var keys$1 = keys(contextToolbars);\r\n            each(keys$1, function (key) {\r\n                var toolbarApi = contextToolbars[key];\r\n                if (toolbarApi.type === 'contextform') {\r\n                    registerForm(key, toolbarApi);\r\n                }\r\n                else if (toolbarApi.type === 'contexttoolbar') {\r\n                    registerToolbar(key, toolbarApi);\r\n                }\r\n            });\r\n            return {\r\n                forms: forms,\r\n                inNodeScope: inNodeScope,\r\n                inEditorScope: inEditorScope,\r\n                lookupTable: lookupTable,\r\n                formNavigators: formNavigators\r\n            };\r\n        };\r\n        var ToolbarScopes = { categorise: categorise };\r\n        var onSetupFormatToggle = function (editor, name) {\r\n            return function (api) {\r\n                var unbindCell = Cell(Option.none());\r\n                var init = function () {\r\n                    api.setActive(editor.formatter.match(name));\r\n                    var unbind = editor.formatter.formatChanged(name, api.setActive).unbind;\r\n                    unbindCell.set(Option.some(unbind));\r\n                };\r\n                editor.initialized ? init() : editor.on('init', init);\r\n                return function () {\r\n                    return unbindCell.get().each(function (unbind) {\r\n                        return unbind();\r\n                    });\r\n                };\r\n            };\r\n        };\r\n        var onActionToggleFormat = function (editor) {\r\n            return function (rawItem) {\r\n                return function () {\r\n                    editor.undoManager.transact(function () {\r\n                        editor.focus();\r\n                        editor.execCommand('mceToggleFormat', false, rawItem.format);\r\n                    });\r\n                };\r\n            };\r\n        };\r\n        var generateSelectItems = function (editor, backstage, spec) {\r\n            var generateItem = function (rawItem, response, disabled) {\r\n                var translatedText = backstage.shared.providers.translate(rawItem.title);\r\n                if (rawItem.type === 'separator') {\r\n                    return Option.some({\r\n                        type: 'separator',\r\n                        text: translatedText\r\n                    });\r\n                }\r\n                else if (rawItem.type === 'submenu') {\r\n                    var items = bind(rawItem.getStyleItems(), function (si) {\r\n                        return validate(si, response);\r\n                    });\r\n                    if (response === 0 && items.length <= 0) {\r\n                        return Option.none();\r\n                    }\r\n                    else {\r\n                        return Option.some({\r\n                            type: 'nestedmenuitem',\r\n                            text: translatedText,\r\n                            disabled: items.length <= 0,\r\n                            getSubmenuItems: function () {\r\n                                return bind(rawItem.getStyleItems(), function (si) {\r\n                                    return validate(si, response);\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    return Option.some(__assign({\r\n                        type: 'togglemenuitem',\r\n                        text: translatedText,\r\n                        active: rawItem.isSelected(),\r\n                        disabled: disabled,\r\n                        onAction: spec.onAction(rawItem)\r\n                    }, rawItem.getStylePreview().fold(function () {\r\n                        return {};\r\n                    }, function (preview) {\r\n                        return { meta: { style: preview } };\r\n                    })));\r\n                }\r\n            };\r\n            var validate = function (item, response) {\r\n                var invalid = item.type === 'formatter' && spec.isInvalid(item);\r\n                if (response === 0) {\r\n                    return invalid ? [] : generateItem(item, response, false).toArray();\r\n                }\r\n                else {\r\n                    return generateItem(item, response, invalid).toArray();\r\n                }\r\n            };\r\n            var validateItems = function (preItems) {\r\n                var response = spec.shouldHide ? 0 : 1;\r\n                return bind(preItems, function (item) {\r\n                    return validate(item, response);\r\n                });\r\n            };\r\n            var getFetch = function (backstage, getStyleItems) {\r\n                return function (callback) {\r\n                    var preItems = getStyleItems();\r\n                    var items = validateItems(preItems);\r\n                    var menu = build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage);\r\n                    callback(menu);\r\n                };\r\n            };\r\n            return {\r\n                validateItems: validateItems,\r\n                getFetch: getFetch\r\n            };\r\n        };\r\n        var createMenuItems = function (editor, backstage, dataset, spec) {\r\n            var getStyleItems = dataset.type === 'basic' ? function () {\r\n                return map(dataset.data, function (d) {\r\n                    return processBasic(d, spec.isSelectedFor, spec.getPreviewFor);\r\n                });\r\n            } : dataset.getData;\r\n            return {\r\n                items: generateSelectItems(editor, backstage, spec),\r\n                getStyleItems: getStyleItems\r\n            };\r\n        };\r\n        var createSelectButton = function (editor, backstage, dataset, spec) {\r\n            var _a = createMenuItems(editor, backstage, dataset, spec), items = _a.items, getStyleItems = _a.getStyleItems;\r\n            var getApi = function (comp) {\r\n                return {\r\n                    getComponent: function () {\r\n                        return comp;\r\n                    }\r\n                };\r\n            };\r\n            var onSetup = function (api) {\r\n                spec.setInitialValue.each(function (f) {\r\n                    return f(api.getComponent());\r\n                });\r\n                return spec.nodeChangeHandler.map(function (f) {\r\n                    var handler = f(api.getComponent());\r\n                    editor.on('NodeChange', handler);\r\n                    return function () {\r\n                        editor.off('NodeChange', handler);\r\n                    };\r\n                }).getOr(noop);\r\n            };\r\n            return renderCommonDropdown({\r\n                text: spec.icon.isSome() ? Option.none() : Option.some(''),\r\n                icon: spec.icon,\r\n                tooltip: Option.from(spec.tooltip),\r\n                role: Option.none(),\r\n                fetch: items.getFetch(backstage, getStyleItems),\r\n                onSetup: onSetup,\r\n                getApi: getApi,\r\n                columns: 1,\r\n                presets: 'normal',\r\n                classes: spec.icon.isSome() ? [] : ['bespoke'],\r\n                dropdownBehaviours: []\r\n            }, 'tox-tbtn', backstage.shared);\r\n        };\r\n        var process = function (rawFormats) {\r\n            return map(rawFormats, function (item) {\r\n                var title = item, format = item;\r\n                var values = item.split('=');\r\n                if (values.length > 1) {\r\n                    title = values[0];\r\n                    format = values[1];\r\n                }\r\n                return {\r\n                    title: title,\r\n                    format: format\r\n                };\r\n            });\r\n        };\r\n        var buildBasicStaticDataset = function (data) {\r\n            return {\r\n                type: 'basic',\r\n                data: data\r\n            };\r\n        };\r\n        var Delimiter;\r\n        (function (Delimiter) {\r\n            Delimiter[Delimiter['SemiColon'] = 0] = 'SemiColon';\r\n            Delimiter[Delimiter['Space'] = 1] = 'Space';\r\n        }(Delimiter || (Delimiter = {})));\r\n        var split = function (rawFormats, delimiter) {\r\n            if (delimiter === Delimiter.SemiColon) {\r\n                return rawFormats.replace(/;$/, '').split(';');\r\n            }\r\n            else {\r\n                return rawFormats.split(' ');\r\n            }\r\n        };\r\n        var buildBasicSettingsDataset = function (editor, settingName, defaults, delimiter) {\r\n            var rawFormats = readOptFrom$1(editor.settings, settingName).getOr(defaults);\r\n            var data = process(split(rawFormats, delimiter));\r\n            return {\r\n                type: 'basic',\r\n                data: data\r\n            };\r\n        };\r\n        var alignMenuItems = [\r\n            {\r\n                title: 'Left',\r\n                icon: 'align-left',\r\n                format: 'alignleft'\r\n            },\r\n            {\r\n                title: 'Center',\r\n                icon: 'align-center',\r\n                format: 'aligncenter'\r\n            },\r\n            {\r\n                title: 'Right',\r\n                icon: 'align-right',\r\n                format: 'alignright'\r\n            },\r\n            {\r\n                title: 'Justify',\r\n                icon: 'align-justify',\r\n                format: 'alignjustify'\r\n            }\r\n        ];\r\n        var getSpec = function (editor) {\r\n            var getMatchingValue = function () {\r\n                return find(alignMenuItems, function (item) {\r\n                    return editor.formatter.match(item.format);\r\n                });\r\n            };\r\n            var isSelectedFor = function (format) {\r\n                return function () {\r\n                    return editor.formatter.match(format);\r\n                };\r\n            };\r\n            var getPreviewFor = function (format) {\r\n                return function () {\r\n                    return Option.none();\r\n                };\r\n            };\r\n            var updateSelectMenuIcon = function (comp) {\r\n                var match = getMatchingValue();\r\n                var alignment = match.fold(function () {\r\n                    return 'left';\r\n                }, function (item) {\r\n                    return item.title.toLowerCase();\r\n                });\r\n                emitWith(comp, updateMenuIcon, { icon: 'align-' + alignment });\r\n            };\r\n            var nodeChangeHandler = Option.some(function (comp) {\r\n                return function () {\r\n                    return updateSelectMenuIcon(comp);\r\n                };\r\n            });\r\n            var setInitialValue = Option.some(function (comp) {\r\n                return updateSelectMenuIcon(comp);\r\n            });\r\n            var dataset = buildBasicStaticDataset(alignMenuItems);\r\n            return {\r\n                tooltip: 'Align',\r\n                icon: Option.some('align-left'),\r\n                isSelectedFor: isSelectedFor,\r\n                getPreviewFor: getPreviewFor,\r\n                onAction: onActionToggleFormat(editor),\r\n                setInitialValue: setInitialValue,\r\n                nodeChangeHandler: nodeChangeHandler,\r\n                dataset: dataset,\r\n                shouldHide: false,\r\n                isInvalid: function (item) {\r\n                    return !editor.formatter.canApply(item.format);\r\n                }\r\n            };\r\n        };\r\n        var createAlignSelect = function (editor, backstage) {\r\n            var spec = getSpec(editor);\r\n            return createSelectButton(editor, backstage, spec.dataset, spec);\r\n        };\r\n        var alignSelectMenu = function (editor, backstage) {\r\n            var spec = getSpec(editor);\r\n            var menuItems = createMenuItems(editor, backstage, spec.dataset, spec);\r\n            editor.ui.registry.addNestedMenuItem('align', {\r\n                text: backstage.shared.providers.translate('Align'),\r\n                getSubmenuItems: function () {\r\n                    return menuItems.items.validateItems(menuItems.getStyleItems());\r\n                }\r\n            });\r\n        };\r\n        var defaultFontsFormats = 'Andale Mono=andale mono,monospace;' + 'Arial=arial,helvetica,sans-serif;' + 'Arial Black=arial black,sans-serif;' + 'Book Antiqua=book antiqua,palatino,serif;' + 'Comic Sans MS=comic sans ms,sans-serif;' + 'Courier New=courier new,courier,monospace;' + 'Georgia=georgia,palatino,serif;' + 'Helvetica=helvetica,arial,sans-serif;' + 'Impact=impact,sans-serif;' + 'Symbol=symbol;' + 'Tahoma=tahoma,arial,helvetica,sans-serif;' + 'Terminal=terminal,monaco,monospace;' + 'Times New Roman=times new roman,times,serif;' + 'Trebuchet MS=trebuchet ms,geneva,sans-serif;' + 'Verdana=verdana,geneva,sans-serif;' + 'Webdings=webdings;' + 'Wingdings=wingdings,zapf dingbats';\r\n        var systemStackFonts = [\r\n            '-apple-system',\r\n            'Segoe UI',\r\n            'Roboto',\r\n            'Helvetica Neue',\r\n            'sans-serif'\r\n        ];\r\n        var isSystemFontStack = function (fontFamily) {\r\n            var matchesSystemStack = function () {\r\n                var fonts = fontFamily.toLowerCase().split(/['\"]?\\s*,\\s*['\"]?/);\r\n                return forall(systemStackFonts, function (font) {\r\n                    return fonts.indexOf(font.toLowerCase()) > -1;\r\n                });\r\n            };\r\n            return fontFamily.indexOf('-apple-system') === 0 && matchesSystemStack();\r\n        };\r\n        var getSpec$1 = function (editor) {\r\n            var getMatchingValue = function () {\r\n                var getFirstFont = function (fontFamily) {\r\n                    return fontFamily ? fontFamily.split(',')[0] : '';\r\n                };\r\n                var fontFamily = editor.queryCommandValue('FontName');\r\n                var items = dataset.data;\r\n                var font = fontFamily ? fontFamily.toLowerCase() : '';\r\n                return find(items, function (item) {\r\n                    var format = item.format;\r\n                    return format.toLowerCase() === font || getFirstFont(format).toLowerCase() === getFirstFont(font).toLowerCase();\r\n                }).orThunk(function () {\r\n                    if (isSystemFontStack(font)) {\r\n                        return Option.from({\r\n                            title: 'System Font',\r\n                            format: font\r\n                        });\r\n                    }\r\n                    else {\r\n                        return Option.none();\r\n                    }\r\n                });\r\n            };\r\n            var isSelectedFor = function (item) {\r\n                return function () {\r\n                    return getMatchingValue().exists(function (match) {\r\n                        return match.format === item;\r\n                    });\r\n                };\r\n            };\r\n            var getPreviewFor = function (item) {\r\n                return function () {\r\n                    return Option.some({\r\n                        tag: 'div',\r\n                        styleAttr: item.indexOf('dings') === -1 ? 'font-family:' + item : ''\r\n                    });\r\n                };\r\n            };\r\n            var onAction = function (rawItem) {\r\n                return function () {\r\n                    editor.undoManager.transact(function () {\r\n                        editor.focus();\r\n                        editor.execCommand('FontName', false, rawItem.format);\r\n                    });\r\n                };\r\n            };\r\n            var updateSelectMenuText = function (comp) {\r\n                var fontFamily = editor.queryCommandValue('FontName');\r\n                var match = getMatchingValue();\r\n                var text = match.fold(function () {\r\n                    return fontFamily;\r\n                }, function (item) {\r\n                    return item.title;\r\n                });\r\n                emitWith(comp, updateMenuText, { text: text });\r\n            };\r\n            var nodeChangeHandler = Option.some(function (comp) {\r\n                return function () {\r\n                    return updateSelectMenuText(comp);\r\n                };\r\n            });\r\n            var setInitialValue = Option.some(function (comp) {\r\n                return updateSelectMenuText(comp);\r\n            });\r\n            var dataset = buildBasicSettingsDataset(editor, 'font_formats', defaultFontsFormats, Delimiter.SemiColon);\r\n            return {\r\n                tooltip: 'Fonts',\r\n                icon: Option.none(),\r\n                isSelectedFor: isSelectedFor,\r\n                getPreviewFor: getPreviewFor,\r\n                onAction: onAction,\r\n                setInitialValue: setInitialValue,\r\n                nodeChangeHandler: nodeChangeHandler,\r\n                dataset: dataset,\r\n                shouldHide: false,\r\n                isInvalid: function () {\r\n                    return false;\r\n                }\r\n            };\r\n        };\r\n        var createFontSelect = function (editor, backstage) {\r\n            var spec = getSpec$1(editor);\r\n            return createSelectButton(editor, backstage, spec.dataset, spec);\r\n        };\r\n        var fontSelectMenu = function (editor, backstage) {\r\n            var spec = getSpec$1(editor);\r\n            var menuItems = createMenuItems(editor, backstage, spec.dataset, spec);\r\n            editor.ui.registry.addNestedMenuItem('fontformats', {\r\n                text: backstage.shared.providers.translate('Fonts'),\r\n                getSubmenuItems: function () {\r\n                    return menuItems.items.validateItems(menuItems.getStyleItems());\r\n                }\r\n            });\r\n        };\r\n        var defaultFontsizeFormats = '8pt 10pt 12pt 14pt 18pt 24pt 36pt';\r\n        var round$1 = function (number, precision) {\r\n            var factor = Math.pow(10, precision);\r\n            return Math.round(number * factor) / factor;\r\n        };\r\n        var toPt = function (fontSize, precision) {\r\n            if (/[0-9.]+px$/.test(fontSize)) {\r\n                return round$1(parseInt(fontSize, 10) * 72 / 96, precision || 0) + 'pt';\r\n            }\r\n            return fontSize;\r\n        };\r\n        var getSpec$2 = function (editor) {\r\n            var getMatchingValue = function () {\r\n                var matchOpt = Option.none();\r\n                var items = dataset.data;\r\n                var px = editor.queryCommandValue('FontSize');\r\n                if (px) {\r\n                    var _loop_1 = function (precision) {\r\n                        var pt = toPt(px, precision);\r\n                        matchOpt = find(items, function (item) {\r\n                            return item.format === px || item.format === pt;\r\n                        });\r\n                    };\r\n                    for (var precision = 3; matchOpt.isNone() && precision >= 0; precision--) {\r\n                        _loop_1(precision);\r\n                    }\r\n                }\r\n                return {\r\n                    matchOpt: matchOpt,\r\n                    px: px\r\n                };\r\n            };\r\n            var isSelectedFor = function (item) {\r\n                return function () {\r\n                    var matchOpt = getMatchingValue().matchOpt;\r\n                    return matchOpt.exists(function (match) {\r\n                        return match.format === item;\r\n                    });\r\n                };\r\n            };\r\n            var getPreviewFor = function () {\r\n                return function () {\r\n                    return Option.none();\r\n                };\r\n            };\r\n            var onAction = function (rawItem) {\r\n                return function () {\r\n                    editor.undoManager.transact(function () {\r\n                        editor.focus();\r\n                        editor.execCommand('FontSize', false, rawItem.format);\r\n                    });\r\n                };\r\n            };\r\n            var updateSelectMenuText = function (comp) {\r\n                var _a = getMatchingValue(), matchOpt = _a.matchOpt, px = _a.px;\r\n                var text = matchOpt.fold(function () {\r\n                    return px;\r\n                }, function (match) {\r\n                    return match.title;\r\n                });\r\n                emitWith(comp, updateMenuText, { text: text });\r\n            };\r\n            var nodeChangeHandler = Option.some(function (comp) {\r\n                return function () {\r\n                    return updateSelectMenuText(comp);\r\n                };\r\n            });\r\n            var setInitialValue = Option.some(function (comp) {\r\n                return updateSelectMenuText(comp);\r\n            });\r\n            var dataset = buildBasicSettingsDataset(editor, 'fontsize_formats', defaultFontsizeFormats, Delimiter.Space);\r\n            return {\r\n                tooltip: 'Font sizes',\r\n                icon: Option.none(),\r\n                isSelectedFor: isSelectedFor,\r\n                getPreviewFor: getPreviewFor,\r\n                onAction: onAction,\r\n                setInitialValue: setInitialValue,\r\n                nodeChangeHandler: nodeChangeHandler,\r\n                dataset: dataset,\r\n                shouldHide: false,\r\n                isInvalid: function () {\r\n                    return false;\r\n                }\r\n            };\r\n        };\r\n        var createFontsizeSelect = function (editor, backstage) {\r\n            var spec = getSpec$2(editor);\r\n            return createSelectButton(editor, backstage, spec.dataset, spec);\r\n        };\r\n        var fontsizeSelectMenu = function (editor, backstage) {\r\n            var spec = getSpec$2(editor);\r\n            var menuItems = createMenuItems(editor, backstage, spec.dataset, spec);\r\n            editor.ui.registry.addNestedMenuItem('fontsizes', {\r\n                text: 'Font sizes',\r\n                getSubmenuItems: function () {\r\n                    return menuItems.items.validateItems(menuItems.getStyleItems());\r\n                }\r\n            });\r\n        };\r\n        var findNearest = function (editor, getStyles, parents) {\r\n            var styles = getStyles();\r\n            return findMap(parents, function (parent) {\r\n                return find(styles, function (fmt) {\r\n                    return editor.formatter.matchNode(parent, fmt.format);\r\n                });\r\n            }).orThunk(function () {\r\n                if (editor.formatter.match('p')) {\r\n                    return Option.some({\r\n                        title: 'Paragraph',\r\n                        format: 'p'\r\n                    });\r\n                }\r\n                return Option.none();\r\n            });\r\n        };\r\n        var getCurrentSelectionParents = function (editor) {\r\n            var currentNode = editor.selection.getStart(true) || editor.getBody();\r\n            return editor.dom.getParents(currentNode, function () {\r\n                return true;\r\n            }, editor.getBody());\r\n        };\r\n        var defaultBlocks = 'Paragraph=p;' + 'Heading 1=h1;' + 'Heading 2=h2;' + 'Heading 3=h3;' + 'Heading 4=h4;' + 'Heading 5=h5;' + 'Heading 6=h6;' + 'Preformatted=pre';\r\n        var getSpec$3 = function (editor) {\r\n            var getMatchingValue = function (nodeChangeEvent) {\r\n                return findNearest(editor, function () {\r\n                    return dataset.data;\r\n                }, nodeChangeEvent);\r\n            };\r\n            var isSelectedFor = function (format) {\r\n                return function () {\r\n                    return editor.formatter.match(format);\r\n                };\r\n            };\r\n            var getPreviewFor = function (format) {\r\n                return function () {\r\n                    var fmt = editor.formatter.get(format);\r\n                    return Option.some({\r\n                        tag: fmt.length > 0 ? fmt[0].inline || fmt[0].block || 'div' : 'div',\r\n                        styleAttr: editor.formatter.getCssText(format)\r\n                    });\r\n                };\r\n            };\r\n            var updateSelectMenuText = function (parents, comp) {\r\n                var detectedFormat = getMatchingValue(parents);\r\n                var text = detectedFormat.fold(function () {\r\n                    return 'Paragraph';\r\n                }, function (fmt) {\r\n                    return fmt.title;\r\n                });\r\n                emitWith(comp, updateMenuText, { text: text });\r\n            };\r\n            var nodeChangeHandler = Option.some(function (comp) {\r\n                return function (e) {\r\n                    return updateSelectMenuText(e.parents, comp);\r\n                };\r\n            });\r\n            var setInitialValue = Option.some(function (comp) {\r\n                var parents = getCurrentSelectionParents(editor);\r\n                updateSelectMenuText(parents, comp);\r\n            });\r\n            var dataset = buildBasicSettingsDataset(editor, 'block_formats', defaultBlocks, Delimiter.SemiColon);\r\n            return {\r\n                tooltip: 'Blocks',\r\n                icon: Option.none(),\r\n                isSelectedFor: isSelectedFor,\r\n                getPreviewFor: getPreviewFor,\r\n                onAction: onActionToggleFormat(editor),\r\n                setInitialValue: setInitialValue,\r\n                nodeChangeHandler: nodeChangeHandler,\r\n                dataset: dataset,\r\n                shouldHide: false,\r\n                isInvalid: function (item) {\r\n                    return !editor.formatter.canApply(item.format);\r\n                }\r\n            };\r\n        };\r\n        var createFormatSelect = function (editor, backstage) {\r\n            var spec = getSpec$3(editor);\r\n            return createSelectButton(editor, backstage, spec.dataset, spec);\r\n        };\r\n        var formatSelectMenu = function (editor, backstage) {\r\n            var spec = getSpec$3(editor);\r\n            var menuItems = createMenuItems(editor, backstage, spec.dataset, spec);\r\n            editor.ui.registry.addNestedMenuItem('blockformats', {\r\n                text: 'Blocks',\r\n                getSubmenuItems: function () {\r\n                    return menuItems.items.validateItems(menuItems.getStyleItems());\r\n                }\r\n            });\r\n        };\r\n        var getSpec$4 = function (editor) {\r\n            var isSelectedFor = function (format) {\r\n                return function () {\r\n                    return editor.formatter.match(format);\r\n                };\r\n            };\r\n            var getPreviewFor = function (format) {\r\n                return function () {\r\n                    var fmt = editor.formatter.get(format);\r\n                    return fmt !== undefined ? Option.some({\r\n                        tag: fmt.length > 0 ? fmt[0].inline || fmt[0].block || 'div' : 'div',\r\n                        styleAttr: editor.formatter.getCssText(format)\r\n                    }) : Option.none();\r\n                };\r\n            };\r\n            var updateSelectMenuText = function (parents, comp) {\r\n                var getFormatItems = function (fmt) {\r\n                    var subs = fmt.items;\r\n                    return subs !== undefined && subs.length > 0 ? bind(subs, getFormatItems) : [{\r\n                            title: fmt.title,\r\n                            format: fmt.format\r\n                        }];\r\n                };\r\n                var flattenedItems = bind(getStyleFormats(editor), getFormatItems);\r\n                var detectedFormat = findNearest(editor, function () {\r\n                    return flattenedItems;\r\n                }, parents);\r\n                var text = detectedFormat.fold(function () {\r\n                    return 'Paragraph';\r\n                }, function (fmt) {\r\n                    return fmt.title;\r\n                });\r\n                emitWith(comp, updateMenuText, { text: text });\r\n            };\r\n            var nodeChangeHandler = Option.some(function (comp) {\r\n                return function (e) {\r\n                    return updateSelectMenuText(e.parents, comp);\r\n                };\r\n            });\r\n            var setInitialValue = Option.some(function (comp) {\r\n                var parents = getCurrentSelectionParents(editor);\r\n                updateSelectMenuText(parents, comp);\r\n            });\r\n            return {\r\n                tooltip: 'Formats',\r\n                icon: Option.none(),\r\n                isSelectedFor: isSelectedFor,\r\n                getPreviewFor: getPreviewFor,\r\n                onAction: onActionToggleFormat(editor),\r\n                setInitialValue: setInitialValue,\r\n                nodeChangeHandler: nodeChangeHandler,\r\n                shouldHide: editor.getParam('style_formats_autohide', false, 'boolean'),\r\n                isInvalid: function (item) {\r\n                    return !editor.formatter.canApply(item.format);\r\n                }\r\n            };\r\n        };\r\n        var createStyleSelect = function (editor, backstage) {\r\n            var data = backstage.styleselect;\r\n            return createSelectButton(editor, backstage, data, getSpec$4(editor));\r\n        };\r\n        var styleSelectMenu = function (editor, backstage) {\r\n            var data = backstage.styleselect;\r\n            var menuItems = createMenuItems(editor, backstage, data, getSpec$4(editor));\r\n            editor.ui.registry.addNestedMenuItem('formats', {\r\n                text: 'Formats',\r\n                getSubmenuItems: function () {\r\n                    return menuItems.items.validateItems(menuItems.getStyleItems());\r\n                }\r\n            });\r\n        };\r\n        var defaultToolbar = [\r\n            {\r\n                name: 'history',\r\n                items: [\r\n                    'undo',\r\n                    'redo'\r\n                ]\r\n            },\r\n            {\r\n                name: 'styles',\r\n                items: ['styleselect']\r\n            },\r\n            {\r\n                name: 'formatting',\r\n                items: [\r\n                    'bold',\r\n                    'italic'\r\n                ]\r\n            },\r\n            {\r\n                name: 'alignment',\r\n                items: [\r\n                    'alignleft',\r\n                    'aligncenter',\r\n                    'alignright',\r\n                    'alignjustify'\r\n                ]\r\n            },\r\n            {\r\n                name: 'indentation',\r\n                items: [\r\n                    'outdent',\r\n                    'indent'\r\n                ]\r\n            },\r\n            {\r\n                name: 'permanent pen',\r\n                items: ['permanentpen']\r\n            },\r\n            {\r\n                name: 'comments',\r\n                items: ['addcomment']\r\n            }\r\n        ];\r\n        var renderFromBridge = function (bridgeBuilder, render) {\r\n            return function (spec, extras) {\r\n                var internal = bridgeBuilder(spec).mapError(function (errInfo) {\r\n                    return formatError(errInfo);\r\n                }).getOrDie();\r\n                return render(internal, extras);\r\n            };\r\n        };\r\n        var types = {\r\n            button: renderFromBridge(createToolbarButton, function (s, extras) {\r\n                return renderToolbarButton(s, extras.backstage.shared.providers);\r\n            }),\r\n            togglebutton: renderFromBridge(createToggleButton, function (s, extras) {\r\n                return renderToolbarToggleButton(s, extras.backstage.shared.providers);\r\n            }),\r\n            menubutton: renderFromBridge(createMenuButton, function (s, extras) {\r\n                return renderMenuButton(s, 'tox-tbtn', extras.backstage, Option.none());\r\n            }),\r\n            splitbutton: renderFromBridge(createSplitButton, function (s, extras) {\r\n                return renderSplitButton(s, extras.backstage.shared);\r\n            }),\r\n            styleSelectButton: function (editor, extras) {\r\n                return createStyleSelect(editor, extras.backstage);\r\n            },\r\n            fontsizeSelectButton: function (editor, extras) {\r\n                return createFontsizeSelect(editor, extras.backstage);\r\n            },\r\n            fontSelectButton: function (editor, extras) {\r\n                return createFontSelect(editor, extras.backstage);\r\n            },\r\n            formatButton: function (editor, extras) {\r\n                return createFormatSelect(editor, extras.backstage);\r\n            },\r\n            alignMenuButton: function (editor, extras) {\r\n                return createAlignSelect(editor, extras.backstage);\r\n            }\r\n        };\r\n        var extractFrom = function (spec, extras) {\r\n            return get(types, spec.type).fold(function () {\r\n                domGlobals.console.error('skipping button defined by', spec);\r\n                return Option.none();\r\n            }, function (render) {\r\n                return Option.some(render(spec, extras));\r\n            });\r\n        };\r\n        var bespokeButtons = {\r\n            styleselect: types.styleSelectButton,\r\n            fontsizeselect: types.fontsizeSelectButton,\r\n            fontselect: types.fontSelectButton,\r\n            formatselect: types.formatButton,\r\n            align: types.alignMenuButton\r\n        };\r\n        var removeUnusedDefaults = function (buttons) {\r\n            var filteredItemGroups = map(defaultToolbar, function (group) {\r\n                var items = filter(group.items, function (subItem) {\r\n                    return has(buttons, subItem) || has(bespokeButtons, subItem);\r\n                });\r\n                return {\r\n                    name: group.name,\r\n                    items: items\r\n                };\r\n            });\r\n            return filter(filteredItemGroups, function (group) {\r\n                return group.items.length > 0;\r\n            });\r\n        };\r\n        var convertStringToolbar = function (strToolbar) {\r\n            var groupsStrings = strToolbar.split('|');\r\n            return map(groupsStrings, function (g) {\r\n                return { items: g.trim().split(' ') };\r\n            });\r\n        };\r\n        var createToolbar = function (toolbarConfig) {\r\n            if (toolbarConfig.toolbar === false) {\r\n                return [];\r\n            }\r\n            else if (toolbarConfig.toolbar === undefined || toolbarConfig.toolbar === true) {\r\n                return removeUnusedDefaults(toolbarConfig.buttons);\r\n            }\r\n            else if (isString(toolbarConfig.toolbar)) {\r\n                return convertStringToolbar(toolbarConfig.toolbar);\r\n            }\r\n            else if (isArray(toolbarConfig.toolbar) && isString(toolbarConfig.toolbar[0])) {\r\n                return convertStringToolbar(toolbarConfig.toolbar.join(' | '));\r\n            }\r\n            else {\r\n                return toolbarConfig.toolbar;\r\n            }\r\n        };\r\n        var lookupButton = function (editor, buttons, toolbarItem, extras, prefixes) {\r\n            return get(buttons, toolbarItem.toLowerCase()).orThunk(function () {\r\n                return prefixes.bind(function (ps) {\r\n                    return findMap(ps, function (prefix) {\r\n                        return get(buttons, prefix + toolbarItem.toLowerCase());\r\n                    });\r\n                });\r\n            }).fold(function () {\r\n                return get(bespokeButtons, toolbarItem.toLowerCase()).map(function (r) {\r\n                    return r(editor, extras);\r\n                }).orThunk(function () {\r\n                    return Option.none();\r\n                });\r\n            }, function (spec) {\r\n                return extractFrom(spec, extras);\r\n            });\r\n        };\r\n        var identifyButtons = function (editor, toolbarConfig, extras, prefixes) {\r\n            var toolbarGroups = createToolbar(toolbarConfig);\r\n            var groups = map(toolbarGroups, function (group) {\r\n                var items = bind(group.items, function (toolbarItem) {\r\n                    return toolbarItem.trim().length === 0 ? [] : lookupButton(editor, toolbarConfig.buttons, toolbarItem, extras, prefixes).toArray();\r\n                });\r\n                return {\r\n                    title: Option.from(editor.translate(group.name)),\r\n                    items: items\r\n                };\r\n            });\r\n            return filter(groups, function (group) {\r\n                return group.items.length > 0;\r\n            });\r\n        };\r\n        var register$4 = function (editor, registryContextToolbars, sink, extras) {\r\n            var contextbar = build$1(renderContextToolbar({\r\n                sink: sink,\r\n                onEscape: function () {\r\n                    editor.focus();\r\n                    return Option.some(true);\r\n                }\r\n            }));\r\n            var getBoxElement = function () {\r\n                return Option.some(Element.fromDom(editor.contentAreaContainer));\r\n            };\r\n            editor.on('init', function () {\r\n                var scroller = editor.getBody().ownerDocument.defaultView;\r\n                var onScroll = bind$3(Element.fromDom(scroller), 'scroll', function () {\r\n                    lastAnchor.get().each(function (anchor) {\r\n                        var elem = lastElement.get().getOr(editor.selection.getNode());\r\n                        var nodeBounds = elem.getBoundingClientRect();\r\n                        var contentAreaBounds = editor.contentAreaContainer.getBoundingClientRect();\r\n                        var aboveEditor = nodeBounds.bottom < 0;\r\n                        var belowEditor = nodeBounds.top > contentAreaBounds.height;\r\n                        if (aboveEditor || belowEditor) {\r\n                            set$2(contextbar.element(), 'display', 'none');\r\n                        }\r\n                        else {\r\n                            remove$6(contextbar.element(), 'display');\r\n                            Positioning.positionWithin(sink, anchor, contextbar, getBoxElement());\r\n                        }\r\n                    });\r\n                });\r\n                editor.on('remove', function () {\r\n                    onScroll.unbind();\r\n                });\r\n            });\r\n            var lastAnchor = Cell(Option.none());\r\n            var lastElement = Cell(Option.none());\r\n            var timer = Cell(null);\r\n            var wrapInPopDialog = function (toolbarSpec) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-pop__dialog']\r\n                    },\r\n                    components: [toolbarSpec],\r\n                    behaviours: derive$1([\r\n                        Keying.config({ mode: 'acyclic' }),\r\n                        config('pop-dialog-wrap-events', [\r\n                            runOnAttached(function (comp) {\r\n                                editor.shortcuts.add('ctrl+F9', 'focus statusbar', function () {\r\n                                    return Keying.focusIn(comp);\r\n                                });\r\n                            }),\r\n                            runOnDetached(function (comp) {\r\n                                editor.shortcuts.remove('ctrl+F9');\r\n                            })\r\n                        ])\r\n                    ])\r\n                };\r\n            };\r\n            var getScopes = cached(function () {\r\n                return ToolbarScopes.categorise(registryContextToolbars, function (toolbarApi) {\r\n                    var alloySpec = buildToolbar(toolbarApi);\r\n                    emitWith(contextbar, forwardSlideEvent, { forwardContents: wrapInPopDialog(alloySpec) });\r\n                });\r\n            });\r\n            var buildToolbar = function (ctx) {\r\n                var buttons = editor.ui.registry.getAll().buttons;\r\n                var scopes = getScopes();\r\n                return ctx.type === 'contexttoolbar' ? function () {\r\n                    var allButtons = merge(buttons, scopes.formNavigators);\r\n                    var initGroups = identifyButtons(editor, {\r\n                        buttons: allButtons,\r\n                        toolbar: ctx.items\r\n                    }, extras, Option.some(['form:']));\r\n                    return renderToolbar({\r\n                        uid: generate$1('context-toolbar'),\r\n                        initGroups: initGroups,\r\n                        onEscape: Option.none,\r\n                        cyclicKeying: true,\r\n                        backstage: extras.backstage,\r\n                        getSink: function () {\r\n                            return Result.error('');\r\n                        }\r\n                    });\r\n                }() : function () {\r\n                    return ContextForm.renderContextForm(ctx, extras.backstage);\r\n                }();\r\n            };\r\n            editor.on(showContextToolbarEvent, function (e) {\r\n                var scopes = getScopes();\r\n                readOptFrom$1(scopes.lookupTable, e.toolbarKey).each(function (ctx) {\r\n                    launchContext(ctx, e.target === editor ? Option.none() : Option.some(e));\r\n                    InlineView.getContent(contextbar).each(Keying.focusIn);\r\n                });\r\n            });\r\n            var bubbleAlignments = {\r\n                valignCentre: [],\r\n                alignCentre: [],\r\n                alignLeft: ['tox-pop--align-left'],\r\n                alignRight: ['tox-pop--align-right'],\r\n                right: ['tox-pop--right'],\r\n                left: ['tox-pop--left'],\r\n                bottom: ['tox-pop--bottom'],\r\n                top: ['tox-pop--top']\r\n            };\r\n            var anchorOverrides = { maxHeightFunction: expandable() };\r\n            var lineAnchorSpec = {\r\n                bubble: nu$7(12, 0, bubbleAlignments),\r\n                layouts: {\r\n                    onLtr: function () {\r\n                        return [east$1];\r\n                    },\r\n                    onRtl: function () {\r\n                        return [west$1];\r\n                    }\r\n                },\r\n                overrides: anchorOverrides\r\n            };\r\n            var anchorSpec = {\r\n                bubble: nu$7(0, 12, bubbleAlignments),\r\n                layouts: {\r\n                    onLtr: function () {\r\n                        return [\r\n                            north$1,\r\n                            south$1,\r\n                            northeast$1,\r\n                            southeast$1,\r\n                            northwest$1,\r\n                            southwest$1\r\n                        ];\r\n                    },\r\n                    onRtl: function () {\r\n                        return [\r\n                            north$1,\r\n                            south$1,\r\n                            northwest$1,\r\n                            southwest$1,\r\n                            northeast$1,\r\n                            southeast$1\r\n                        ];\r\n                    }\r\n                },\r\n                overrides: anchorOverrides\r\n            };\r\n            var getAnchor = function (position, element) {\r\n                var anchorage = position === 'node' ? extras.backstage.shared.anchors.node(element) : extras.backstage.shared.anchors.cursor();\r\n                var anchor = deepMerge(anchorage, position === 'line' ? lineAnchorSpec : anchorSpec);\r\n                return anchor;\r\n            };\r\n            var launchContext = function (toolbarApi, elem) {\r\n                clearTimer();\r\n                var toolbarSpec = buildToolbar(toolbarApi);\r\n                var sElem = elem.map(Element.fromDom);\r\n                var anchor = getAnchor(toolbarApi.position, sElem);\r\n                lastAnchor.set(Option.some(anchor));\r\n                lastElement.set(elem);\r\n                InlineView.showWithin(contextbar, anchor, wrapInPopDialog(toolbarSpec), getBoxElement());\r\n                remove$6(contextbar.element(), 'display');\r\n            };\r\n            var launchContextToolbar = function () {\r\n                var scopes = getScopes();\r\n                ToolbarLookup.lookup(scopes, editor).fold(function () {\r\n                    lastAnchor.set(Option.none());\r\n                    InlineView.hide(contextbar);\r\n                }, function (info) {\r\n                    launchContext(info.toolbarApi, Option.some(info.elem.dom()));\r\n                });\r\n            };\r\n            var clearTimer = function () {\r\n                var current = timer.get();\r\n                if (current !== null) {\r\n                    global$1.clearTimeout(current);\r\n                    timer.set(null);\r\n                }\r\n            };\r\n            var resetTimer = function (t) {\r\n                clearTimer();\r\n                timer.set(t);\r\n            };\r\n            editor.on('init', function () {\r\n                editor.on('click keyup SetContent ObjectResized ResizeEditor', function (e) {\r\n                    resetTimer(global$1.setEditorTimeout(editor, launchContextToolbar, 0));\r\n                });\r\n                editor.on('focusout', function (e) {\r\n                    global$1.setEditorTimeout(editor, function () {\r\n                        if (search$1(sink.element()).isNone() && search$1(contextbar.element()).isNone()) {\r\n                            lastAnchor.set(Option.none());\r\n                            InlineView.hide(contextbar);\r\n                        }\r\n                    }, 0);\r\n                });\r\n                editor.on('SwitchMode', function () {\r\n                    if (editor.readonly) {\r\n                        lastAnchor.set(Option.none());\r\n                        InlineView.hide(contextbar);\r\n                    }\r\n                });\r\n                editor.on('NodeChange', function (e) {\r\n                    search$1(contextbar.element()).fold(function () {\r\n                        resetTimer(global$1.setEditorTimeout(editor, launchContextToolbar, 0));\r\n                    }, function (_) {\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var ContextToolbar = { register: register$4 };\r\n        var setup$3 = function (editor, mothership, uiMothership) {\r\n            var onMousedown = bind$3(Element.fromDom(domGlobals.document), 'mousedown', function (evt) {\r\n                each([\r\n                    mothership,\r\n                    uiMothership\r\n                ], function (ship) {\r\n                    ship.broadcastOn([dismissPopups()], { target: evt.target() });\r\n                });\r\n            });\r\n            var onTouchstart = bind$3(Element.fromDom(domGlobals.document), 'touchstart', function (evt) {\r\n                each([\r\n                    mothership,\r\n                    uiMothership\r\n                ], function (ship) {\r\n                    ship.broadcastOn([dismissPopups()], { target: evt.target() });\r\n                });\r\n            });\r\n            var onMouseup = bind$3(Element.fromDom(domGlobals.document), 'mouseup', function (evt) {\r\n                if (evt.raw().button === 0) {\r\n                    each([\r\n                        mothership,\r\n                        uiMothership\r\n                    ], function (ship) {\r\n                        ship.broadcastOn([mouseReleased()], { target: evt.target() });\r\n                    });\r\n                }\r\n            });\r\n            var onContentMousedown = function (raw) {\r\n                each([\r\n                    mothership,\r\n                    uiMothership\r\n                ], function (ship) {\r\n                    ship.broadcastOn([dismissPopups()], { target: Element.fromDom(raw.target) });\r\n                });\r\n            };\r\n            editor.on('mousedown', onContentMousedown);\r\n            editor.on('touchstart', onContentMousedown);\r\n            var onContentMouseup = function (raw) {\r\n                if (raw.button === 0) {\r\n                    each([\r\n                        mothership,\r\n                        uiMothership\r\n                    ], function (ship) {\r\n                        ship.broadcastOn([mouseReleased()], { target: Element.fromDom(raw.target) });\r\n                    });\r\n                }\r\n            };\r\n            editor.on('mouseup', onContentMouseup);\r\n            var onWindowScroll = function (evt) {\r\n                each([\r\n                    mothership,\r\n                    uiMothership\r\n                ], function (ship) {\r\n                    ship.broadcastEvent(windowScroll(), evt);\r\n                });\r\n            };\r\n            editor.on('ScrollWindow', onWindowScroll);\r\n            var onWindowResize = function (evt) {\r\n                each([\r\n                    mothership,\r\n                    uiMothership\r\n                ], function (ship) {\r\n                    ship.broadcastEvent(windowResize(), evt);\r\n                });\r\n            };\r\n            editor.on('ResizeWindow', onWindowResize);\r\n            editor.on('remove', function () {\r\n                editor.off('mousedown', onContentMousedown);\r\n                editor.off('touchstart', onContentMousedown);\r\n                editor.off('mouseup', onContentMouseup);\r\n                editor.off('ResizeWindow', onWindowResize);\r\n                editor.off('ScrollWindow', onWindowScroll);\r\n                onMousedown.unbind();\r\n                onTouchstart.unbind();\r\n                onMouseup.unbind();\r\n            });\r\n            editor.on('detach', function () {\r\n                detachSystem(mothership);\r\n                detachSystem(uiMothership);\r\n                mothership.destroy();\r\n                uiMothership.destroy();\r\n            });\r\n        };\r\n        var Events = { setup: setup$3 };\r\n        var fireSkinLoaded = function (editor) {\r\n            return editor.fire('SkinLoaded');\r\n        };\r\n        var fireResizeEditor = function (editor) {\r\n            return editor.fire('ResizeEditor');\r\n        };\r\n        var fireBeforeRenderUI = function (editor) {\r\n            return editor.fire('BeforeRenderUI');\r\n        };\r\n        var fireResizeContent = function (editor) {\r\n            return editor.fire('ResizeContent');\r\n        };\r\n        var Events$1 = {\r\n            fireSkinLoaded: fireSkinLoaded,\r\n            fireResizeEditor: fireResizeEditor,\r\n            fireBeforeRenderUI: fireBeforeRenderUI,\r\n            fireResizeContent: fireResizeContent\r\n        };\r\n        var parts$c = AlloyParts;\r\n        var partType$1 = PartType;\r\n        var factory$e = function (detail, spec) {\r\n            var setMenus = function (comp, menus) {\r\n                var newMenus = map(menus, function (m) {\r\n                    var buttonSpec = {\r\n                        type: 'menubutton',\r\n                        text: m.text,\r\n                        fetch: function (callback) {\r\n                            callback(m.getItems());\r\n                        }\r\n                    };\r\n                    var internal = createMenuButton(buttonSpec).mapError(function (errInfo) {\r\n                        return formatError(errInfo);\r\n                    }).getOrDie();\r\n                    return renderMenuButton(internal, 'tox-mbtn', spec.backstage, Option.some('menuitem'));\r\n                });\r\n                Replacing.set(comp, newMenus);\r\n            };\r\n            var apis = {\r\n                focus: Keying.focusIn,\r\n                setMenus: setMenus\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: [],\r\n                behaviours: derive$1([\r\n                    Replacing.config({}),\r\n                    config('menubar-events', [\r\n                        runOnAttached(function (component) {\r\n                            detail.onSetup(component);\r\n                        }),\r\n                        run(mouseover(), function (comp, se) {\r\n                            descendant$2(comp.element(), '.' + 'tox-mbtn--active').each(function (activeButton) {\r\n                                closest$3(se.event().target(), '.' + 'tox-mbtn').each(function (hoveredButton) {\r\n                                    if (!eq(activeButton, hoveredButton)) {\r\n                                        comp.getSystem().getByDom(activeButton).each(function (activeComp) {\r\n                                            comp.getSystem().getByDom(hoveredButton).each(function (hoveredComp) {\r\n                                                Dropdown.expand(hoveredComp);\r\n                                                Dropdown.close(activeComp);\r\n                                                Focusing.focus(hoveredComp);\r\n                                            });\r\n                                        });\r\n                                    }\r\n                                });\r\n                            });\r\n                        }),\r\n                        run(focusShifted(), function (comp, se) {\r\n                            se.event().prevFocus().bind(function (prev) {\r\n                                return comp.getSystem().getByDom(prev).toOption();\r\n                            }).each(function (prev) {\r\n                                se.event().newFocus().bind(function (nu) {\r\n                                    return comp.getSystem().getByDom(nu).toOption();\r\n                                }).each(function (nu) {\r\n                                    if (Dropdown.isOpen(prev)) {\r\n                                        Dropdown.expand(nu);\r\n                                        Dropdown.close(prev);\r\n                                    }\r\n                                });\r\n                            });\r\n                        })\r\n                    ]),\r\n                    Keying.config({\r\n                        mode: 'flow',\r\n                        selector: '.' + 'tox-mbtn',\r\n                        onEscape: function (comp) {\r\n                            detail.onEscape(comp);\r\n                            return Option.some(true);\r\n                        }\r\n                    }),\r\n                    Tabstopping.config({})\r\n                ]),\r\n                apis: apis,\r\n                domModification: { attributes: { role: 'menubar' } }\r\n            };\r\n        };\r\n        var SilverMenubar = single$2({\r\n            factory: factory$e,\r\n            name: 'silver.Menubar',\r\n            configFields: [\r\n                strict$1('dom'),\r\n                strict$1('uid'),\r\n                strict$1('onEscape'),\r\n                strict$1('backstage'),\r\n                defaulted$1('onSetup', noop)\r\n            ],\r\n            apis: {\r\n                focus: function (apis, comp) {\r\n                    apis.focus(comp);\r\n                },\r\n                setMenus: function (apis, comp, menus) {\r\n                    apis.setMenus(comp, menus);\r\n                }\r\n            }\r\n        });\r\n        var owner$4 = 'container';\r\n        var schema$p = [field$1('slotBehaviours', [])];\r\n        var getPartName$1 = function (name) {\r\n            return '<alloy.field.' + name + '>';\r\n        };\r\n        var sketch$2 = function (sSpec) {\r\n            var parts = function () {\r\n                var record = [];\r\n                var slot = function (name, config) {\r\n                    record.push(name);\r\n                    return generateOne(owner$4, getPartName$1(name), config);\r\n                };\r\n                return {\r\n                    slot: slot,\r\n                    record: function () {\r\n                        return record;\r\n                    }\r\n                };\r\n            }();\r\n            var spec = sSpec(parts);\r\n            var partNames = parts.record();\r\n            var fieldParts = map(partNames, function (n) {\r\n                return required({\r\n                    name: n,\r\n                    pname: getPartName$1(n)\r\n                });\r\n            });\r\n            return composite(owner$4, schema$p, fieldParts, make$6, spec);\r\n        };\r\n        var make$6 = function (detail, components, spec) {\r\n            var getSlotNames = function (_) {\r\n                return getAllPartNames(detail);\r\n            };\r\n            var getSlot = function (container, key) {\r\n                return getPart(container, detail, key);\r\n            };\r\n            var onSlot = function (f, def) {\r\n                if (def === void 0) {\r\n                    def = undefined;\r\n                }\r\n                return function (container, key) {\r\n                    return getPart(container, detail, key).map(function (slot) {\r\n                        return f(slot, key);\r\n                    }).getOr(def);\r\n                };\r\n            };\r\n            var onSlots = function (f) {\r\n                return function (container, keys) {\r\n                    each(keys, function (key) {\r\n                        return f(container, key);\r\n                    });\r\n                };\r\n            };\r\n            var doShowing = function (comp, key) {\r\n                return get$2(comp.element(), 'aria-hidden') !== 'true';\r\n            };\r\n            var doShow = function (comp, key) {\r\n                if (!doShowing(comp, key)) {\r\n                    var element = comp.element();\r\n                    remove$6(element, 'display');\r\n                    remove$1(element, 'aria-hidden');\r\n                    emitWith(comp, slotVisibility(), {\r\n                        name: key,\r\n                        visible: true\r\n                    });\r\n                }\r\n            };\r\n            var doHide = function (comp, key) {\r\n                if (doShowing(comp, key)) {\r\n                    var element = comp.element();\r\n                    set$2(element, 'display', 'none');\r\n                    set$1(element, 'aria-hidden', 'true');\r\n                    emitWith(comp, slotVisibility(), {\r\n                        name: key,\r\n                        visible: false\r\n                    });\r\n                }\r\n            };\r\n            var isShowing = onSlot(doShowing, false);\r\n            var hideSlot = onSlot(doHide);\r\n            var hideSlots = onSlots(hideSlot);\r\n            var hideAllSlots = function (container) {\r\n                return hideSlots(container, getSlotNames(container));\r\n            };\r\n            var showSlot = onSlot(doShow);\r\n            var apis = {\r\n                getSlotNames: getSlotNames,\r\n                getSlot: getSlot,\r\n                isShowing: isShowing,\r\n                hideSlot: hideSlot,\r\n                hideAllSlots: hideAllSlots,\r\n                showSlot: showSlot\r\n            };\r\n            return {\r\n                'uid': detail.uid,\r\n                'dom': detail.dom,\r\n                'components': components,\r\n                'behaviours': get$b(detail.slotBehaviours),\r\n                'apis': apis\r\n            };\r\n        };\r\n        var slotApis = map$1({\r\n            getSlotNames: function (apis, c) {\r\n                return apis.getSlotNames(c);\r\n            },\r\n            getSlot: function (apis, c, key) {\r\n                return apis.getSlot(c, key);\r\n            },\r\n            isShowing: function (apis, c, key) {\r\n                return apis.isShowing(c, key);\r\n            },\r\n            hideSlot: function (apis, c, key) {\r\n                return apis.hideSlot(c, key);\r\n            },\r\n            hideAllSlots: function (apis, c) {\r\n                return apis.hideAllSlots(c);\r\n            },\r\n            showSlot: function (apis, c, key) {\r\n                return apis.showSlot(c, key);\r\n            }\r\n        }, makeApi);\r\n        var SlotContainer = __assign({}, slotApis, { sketch: sketch$2 });\r\n        var sidebarSchema = objOf([\r\n            optionString('icon'),\r\n            optionString('tooltip'),\r\n            defaultedFunction('onShow', noop),\r\n            defaultedFunction('onHide', noop),\r\n            defaultedFunction('onSetup', function () {\r\n                return noop;\r\n            })\r\n        ]);\r\n        var createSidebar = function (spec) {\r\n            return asRaw('sidebar', sidebarSchema, spec);\r\n        };\r\n        var setup$4 = function (editor) {\r\n            var sidebars = editor.ui.registry.getAll().sidebars;\r\n            each(keys(sidebars), function (name) {\r\n                var spec = sidebars[name];\r\n                var isActive = function () {\r\n                    return Option.from(editor.queryCommandValue('ToggleSidebar')).is(name);\r\n                };\r\n                editor.ui.registry.addToggleButton(name, {\r\n                    icon: spec.icon,\r\n                    tooltip: spec.tooltip,\r\n                    onAction: function (buttonApi) {\r\n                        editor.execCommand('ToggleSidebar', false, name);\r\n                        buttonApi.setActive(isActive());\r\n                    },\r\n                    onSetup: function (buttonApi) {\r\n                        var handleToggle = function () {\r\n                            return buttonApi.setActive(isActive());\r\n                        };\r\n                        editor.on('ToggleSidebar', handleToggle);\r\n                        return function () {\r\n                            editor.off('ToggleSidebar', handleToggle);\r\n                        };\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var getApi = function (comp) {\r\n            return {\r\n                element: function () {\r\n                    return comp.element().dom();\r\n                }\r\n            };\r\n        };\r\n        var makePanels = function (parts, panelConfigs) {\r\n            var specs = map(keys(panelConfigs), function (name) {\r\n                var spec = panelConfigs[name];\r\n                var bridged = getOrDie$1(createSidebar(spec));\r\n                return {\r\n                    name: name,\r\n                    getApi: getApi,\r\n                    onSetup: bridged.onSetup,\r\n                    onShow: bridged.onShow,\r\n                    onHide: bridged.onHide\r\n                };\r\n            });\r\n            return map(specs, function (spec) {\r\n                var editorOffCell = Cell(noop);\r\n                return parts.slot(spec.name, {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-sidebar__pane']\r\n                    },\r\n                    behaviours: SimpleBehaviours.unnamedEvents([\r\n                        onControlAttached(spec, editorOffCell),\r\n                        onControlDetached(spec, editorOffCell),\r\n                        run(slotVisibility(), function (sidepanel, se) {\r\n                            var data = se.event();\r\n                            var optSidePanelSpec = find(specs, function (config) {\r\n                                return config.name === data.name();\r\n                            });\r\n                            optSidePanelSpec.each(function (sidePanelSpec) {\r\n                                var handler = data.visible() ? sidePanelSpec.onShow : sidePanelSpec.onHide;\r\n                                handler(sidePanelSpec.getApi(sidepanel));\r\n                            });\r\n                        })\r\n                    ])\r\n                });\r\n            });\r\n        };\r\n        var makeSidebar = function (panelConfigs) {\r\n            return SlotContainer.sketch(function (parts) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-sidebar__pane-container']\r\n                    },\r\n                    components: makePanels(parts, panelConfigs),\r\n                    slotBehaviours: SimpleBehaviours.unnamedEvents([runOnAttached(function (slotContainer) {\r\n                            return SlotContainer.hideAllSlots(slotContainer);\r\n                        })])\r\n                };\r\n            });\r\n        };\r\n        var setSidebar = function (sidebar, panelConfigs) {\r\n            var optSlider = Composing.getCurrent(sidebar);\r\n            optSlider.each(function (slider) {\r\n                return Replacing.set(slider, [makeSidebar(panelConfigs)]);\r\n            });\r\n        };\r\n        var toggleSidebar = function (sidebar, name) {\r\n            var optSlider = Composing.getCurrent(sidebar);\r\n            optSlider.each(function (slider) {\r\n                var optSlotContainer = Composing.getCurrent(slider);\r\n                optSlotContainer.each(function (slotContainer) {\r\n                    if (Sliding.hasGrown(slider)) {\r\n                        if (SlotContainer.isShowing(slotContainer, name)) {\r\n                            Sliding.shrink(slider);\r\n                        }\r\n                        else {\r\n                            SlotContainer.hideAllSlots(slotContainer);\r\n                            SlotContainer.showSlot(slotContainer, name);\r\n                        }\r\n                    }\r\n                    else {\r\n                        SlotContainer.hideAllSlots(slotContainer);\r\n                        SlotContainer.showSlot(slotContainer, name);\r\n                        Sliding.grow(slider);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var whichSidebar = function (sidebar) {\r\n            var optSlider = Composing.getCurrent(sidebar);\r\n            return optSlider.bind(function (slider) {\r\n                var sidebarOpen = Sliding.isGrowing(slider) || Sliding.hasGrown(slider);\r\n                if (sidebarOpen) {\r\n                    var optSlotContainer = Composing.getCurrent(slider);\r\n                    return optSlotContainer.bind(function (slotContainer) {\r\n                        return find(SlotContainer.getSlotNames(slotContainer), function (name) {\r\n                            return SlotContainer.isShowing(slotContainer, name);\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            });\r\n        };\r\n        var fixSize = generate$1('FixSizeEvent');\r\n        var autoSize = generate$1('AutoSizeEvent');\r\n        var renderSidebar = function (spec) {\r\n            return {\r\n                uid: spec.uid,\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-sidebar'],\r\n                    attributes: { role: 'complementary' }\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-sidebar__slider']\r\n                        },\r\n                        components: [],\r\n                        behaviours: derive$1([\r\n                            Tabstopping.config({}),\r\n                            Focusing.config({}),\r\n                            Sliding.config({\r\n                                dimension: { property: 'width' },\r\n                                closedClass: 'tox-sidebar--sliding-closed',\r\n                                openClass: 'tox-sidebar--sliding-open',\r\n                                shrinkingClass: 'tox-sidebar--sliding-shrinking',\r\n                                growingClass: 'tox-sidebar--sliding-growing',\r\n                                onShrunk: function (slider) {\r\n                                    var optSlotContainer = Composing.getCurrent(slider);\r\n                                    optSlotContainer.each(SlotContainer.hideAllSlots);\r\n                                    emit(slider, autoSize);\r\n                                },\r\n                                onGrown: function (slider) {\r\n                                    emit(slider, autoSize);\r\n                                },\r\n                                onStartGrow: function (slider) {\r\n                                    emitWith(slider, fixSize, { width: getRaw(slider.element(), 'width').getOr('') });\r\n                                },\r\n                                onStartShrink: function (slider) {\r\n                                    emitWith(slider, fixSize, { width: get$7(slider.element()) + 'px' });\r\n                                }\r\n                            }),\r\n                            Replacing.config({}),\r\n                            Composing.config({\r\n                                find: function (comp) {\r\n                                    var children = Replacing.contents(comp);\r\n                                    return head(children);\r\n                                }\r\n                            })\r\n                        ])\r\n                    }],\r\n                behaviours: derive$1([\r\n                    ComposingConfigs.childAt(0),\r\n                    config('sidebar-sliding-events', [\r\n                        run(fixSize, function (comp, se) {\r\n                            set$2(comp.element(), 'width', se.event().width());\r\n                        }),\r\n                        run(autoSize, function (comp, se) {\r\n                            remove$6(comp.element(), 'width');\r\n                        })\r\n                    ])\r\n                ])\r\n            };\r\n        };\r\n        var renderSpinner = function (providerBackstage) {\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { 'aria-label': providerBackstage.translate('Loading...') },\r\n                    classes: ['tox-throbber__busy-spinner']\r\n                },\r\n                components: [{ dom: fromHtml$2('<div class=\"tox-spinner\"><div></div><div></div><div></div></div>') }],\r\n                behaviours: derive$1([\r\n                    Keying.config({\r\n                        mode: 'special',\r\n                        onTab: function () {\r\n                            return Option.some(true);\r\n                        },\r\n                        onShiftTab: function () {\r\n                            return Option.some(true);\r\n                        }\r\n                    }),\r\n                    Focusing.config({})\r\n                ])\r\n            };\r\n        };\r\n        var toggleThrobber = function (comp, state, providerBackstage) {\r\n            var element = comp.element();\r\n            if (state === true) {\r\n                Replacing.set(comp, [renderSpinner(providerBackstage)]);\r\n                remove$6(element, 'display');\r\n                remove$1(element, 'aria-hidden');\r\n            }\r\n            else {\r\n                Replacing.set(comp, []);\r\n                set$2(element, 'display', 'none');\r\n                set$1(element, 'aria-hidden', 'true');\r\n            }\r\n        };\r\n        var renderThrobber = function (spec) {\r\n            return {\r\n                uid: spec.uid,\r\n                dom: {\r\n                    tag: 'div',\r\n                    attributes: { 'aria-hidden': 'true' },\r\n                    classes: ['tox-throbber'],\r\n                    styles: { display: 'none' }\r\n                },\r\n                behaviours: derive$1([Replacing.config({})]),\r\n                components: []\r\n            };\r\n        };\r\n        var setup$5 = function (editor, lazyThrobber, sharedBackstage) {\r\n            var throbberState = Cell(false);\r\n            var timer = Cell(Option.none());\r\n            var toggle = function (state) {\r\n                if (state !== throbberState.get()) {\r\n                    toggleThrobber(lazyThrobber(), state, sharedBackstage.providers);\r\n                    throbberState.set(state);\r\n                }\r\n            };\r\n            editor.on('ProgressState', function (e) {\r\n                timer.get().each(global$1.clearTimeout);\r\n                if (isNumber(e.time)) {\r\n                    var timerId = global$1.setEditorTimeout(editor, function () {\r\n                        return toggle(e.state);\r\n                    }, e.time);\r\n                    timer.set(Option.some(timerId));\r\n                }\r\n                else {\r\n                    toggle(e.state);\r\n                    timer.set(Option.none());\r\n                }\r\n            });\r\n        };\r\n        var factory$f = function (detail, components, spec) {\r\n            var apis = {\r\n                getSocket: function (comp) {\r\n                    return parts$c.getPart(comp, detail, 'socket');\r\n                },\r\n                setSidebar: function (comp, panelConfigs) {\r\n                    parts$c.getPart(comp, detail, 'sidebar').each(function (sidebar) {\r\n                        return setSidebar(sidebar, panelConfigs);\r\n                    });\r\n                },\r\n                toggleSidebar: function (comp, name) {\r\n                    parts$c.getPart(comp, detail, 'sidebar').each(function (sidebar) {\r\n                        return toggleSidebar(sidebar, name);\r\n                    });\r\n                },\r\n                whichSidebar: function (comp) {\r\n                    return parts$c.getPart(comp, detail, 'sidebar').bind(whichSidebar).getOrNull();\r\n                },\r\n                getToolbar: function (comp) {\r\n                    return parts$c.getPart(comp, detail, 'toolbar');\r\n                },\r\n                setToolbar: function (comp, groups) {\r\n                    parts$c.getPart(comp, detail, 'toolbar').each(function (toolbar) {\r\n                        toolbar.getApis().setGroups(toolbar, groups);\r\n                    });\r\n                },\r\n                refreshToolbar: function (comp) {\r\n                    var toolbar = parts$c.getPart(comp, detail, 'toolbar');\r\n                    toolbar.each(function (toolbar) {\r\n                        return toolbar.getApis().refresh(toolbar);\r\n                    });\r\n                },\r\n                getMoreButton: function (comp) {\r\n                    var toolbar = parts$c.getPart(comp, detail, 'toolbar');\r\n                    return toolbar.bind(function (toolbar) {\r\n                        return toolbar.getApis().getMoreButton(toolbar);\r\n                    });\r\n                },\r\n                getThrobber: function (comp) {\r\n                    return parts$c.getPart(comp, detail, 'throbber');\r\n                },\r\n                focusToolbar: function (comp) {\r\n                    parts$c.getPart(comp, detail, 'toolbar').each(function (toolbar) {\r\n                        Keying.focusIn(toolbar);\r\n                    });\r\n                },\r\n                setMenubar: function (comp, menus) {\r\n                    parts$c.getPart(comp, detail, 'menubar').each(function (menubar) {\r\n                        SilverMenubar.setMenus(menubar, menus);\r\n                    });\r\n                },\r\n                focusMenubar: function (comp) {\r\n                    parts$c.getPart(comp, detail, 'menubar').each(function (menubar) {\r\n                        SilverMenubar.focus(menubar);\r\n                    });\r\n                }\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                apis: apis,\r\n                behaviours: detail.behaviours\r\n            };\r\n        };\r\n        var partMenubar = partType$1.optional({\r\n            factory: SilverMenubar,\r\n            name: 'menubar',\r\n            schema: [strict$1('backstage')]\r\n        });\r\n        var toolbarFactory = function (spec) {\r\n            if (spec.split === ToolbarDrawer.sliding) {\r\n                return renderSlidingMoreToolbar;\r\n            }\r\n            else if (spec.split === ToolbarDrawer.floating) {\r\n                return renderFloatingMoreToolbar;\r\n            }\r\n            else {\r\n                return renderToolbar;\r\n            }\r\n        };\r\n        var partToolbar = partType$1.optional({\r\n            factory: {\r\n                sketch: function (spec) {\r\n                    var renderer = toolbarFactory(spec);\r\n                    var toolbarSpec = {\r\n                        uid: spec.uid,\r\n                        onEscape: function () {\r\n                            spec.onEscape();\r\n                            return Option.some(true);\r\n                        },\r\n                        cyclicKeying: false,\r\n                        initGroups: [],\r\n                        getSink: spec.getSink,\r\n                        backstage: spec.backstage,\r\n                        moreDrawerData: {\r\n                            lazyToolbar: spec.lazyToolbar,\r\n                            lazyMoreButton: spec.lazyMoreButton\r\n                        }\r\n                    };\r\n                    return renderer(toolbarSpec);\r\n                }\r\n            },\r\n            name: 'toolbar',\r\n            schema: [\r\n                strict$1('dom'),\r\n                strict$1('onEscape'),\r\n                strict$1('getSink')\r\n            ]\r\n        });\r\n        var partSocket = partType$1.optional({\r\n            name: 'socket',\r\n            schema: [strict$1('dom')]\r\n        });\r\n        var partSidebar = partType$1.optional({\r\n            factory: { sketch: renderSidebar },\r\n            name: 'sidebar',\r\n            schema: [strict$1('dom')]\r\n        });\r\n        var partThrobber = partType$1.optional({\r\n            factory: { sketch: renderThrobber },\r\n            name: 'throbber',\r\n            schema: [strict$1('dom')]\r\n        });\r\n        var OuterContainer = composite$1({\r\n            name: 'OuterContainer',\r\n            factory: factory$f,\r\n            configFields: [\r\n                strict$1('dom'),\r\n                strict$1('behaviours')\r\n            ],\r\n            partFields: [\r\n                partMenubar,\r\n                partToolbar,\r\n                partSocket,\r\n                partSidebar,\r\n                partThrobber\r\n            ],\r\n            apis: {\r\n                getSocket: function (apis, comp) {\r\n                    return apis.getSocket(comp);\r\n                },\r\n                setSidebar: function (apis, comp, panelConfigs) {\r\n                    apis.setSidebar(comp, panelConfigs);\r\n                },\r\n                toggleSidebar: function (apis, comp, name) {\r\n                    apis.toggleSidebar(comp, name);\r\n                },\r\n                whichSidebar: function (apis, comp) {\r\n                    return apis.whichSidebar(comp);\r\n                },\r\n                getToolbar: function (apis, comp) {\r\n                    return apis.getToolbar(comp);\r\n                },\r\n                setToolbar: function (apis, comp, grps) {\r\n                    var groups = map(grps, function (grp) {\r\n                        return renderToolbarGroup(grp);\r\n                    });\r\n                    apis.setToolbar(comp, groups);\r\n                },\r\n                getMoreButton: function (apis, comp) {\r\n                    return apis.getMoreButton(comp);\r\n                },\r\n                refreshToolbar: function (apis, comp) {\r\n                    return apis.refreshToolbar(comp);\r\n                },\r\n                getThrobber: function (apis, comp) {\r\n                    return apis.getThrobber(comp);\r\n                },\r\n                setMenubar: function (apis, comp, menus) {\r\n                    apis.setMenubar(comp, menus);\r\n                },\r\n                focusMenubar: function (apis, comp) {\r\n                    apis.focusMenubar(comp);\r\n                },\r\n                focusToolbar: function (apis, comp) {\r\n                    apis.focusToolbar(comp);\r\n                }\r\n            }\r\n        });\r\n        var defaultMenubar = 'file edit view insert format tools table help';\r\n        var defaultMenus = {\r\n            file: {\r\n                title: 'File',\r\n                items: 'newdocument restoredraft | preview | print | deleteallconversations'\r\n            },\r\n            edit: {\r\n                title: 'Edit',\r\n                items: 'undo redo | cut copy paste pastetext | selectall | searchreplace'\r\n            },\r\n            view: {\r\n                title: 'View',\r\n                items: 'code | visualaid visualchars visualblocks | spellchecker | preview fullscreen | showcomments'\r\n            },\r\n            insert: {\r\n                title: 'Insert',\r\n                items: 'image link media addcomment pageembed template codesample inserttable | charmap emoticons hr | pagebreak nonbreaking anchor toc | insertdatetime'\r\n            },\r\n            format: {\r\n                title: 'Format',\r\n                items: 'bold italic underline strikethrough superscript subscript codeformat | formats blockformats fontformats fontsizes align | forecolor backcolor | removeformat'\r\n            },\r\n            tools: {\r\n                title: 'Tools',\r\n                items: 'spellchecker spellcheckerlanguage | a11ycheck code wordcount'\r\n            },\r\n            table: {\r\n                title: 'Table',\r\n                items: 'inserttable tableprops deletetable row column cell'\r\n            },\r\n            help: {\r\n                title: 'Help',\r\n                items: 'help'\r\n            }\r\n        };\r\n        var make$7 = function (menu, registry, editor) {\r\n            var removedMenuItems = getRemovedMenuItems(editor).split(/[ ,]/);\r\n            return {\r\n                text: menu.title,\r\n                getItems: function () {\r\n                    return bind(menu.items, function (i) {\r\n                        var itemName = i.toLowerCase();\r\n                        if (itemName.trim().length === 0) {\r\n                            return [];\r\n                        }\r\n                        else if (exists(removedMenuItems, function (removedMenuItem) {\r\n                            return removedMenuItem === itemName;\r\n                        })) {\r\n                            return [];\r\n                        }\r\n                        else if (itemName === 'separator' || itemName === '|') {\r\n                            return [{ type: 'separator' }];\r\n                        }\r\n                        else if (registry.menuItems[itemName]) {\r\n                            return [registry.menuItems[itemName]];\r\n                        }\r\n                        else {\r\n                            return [];\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        var parseItemsString = function (items) {\r\n            if (typeof items === 'string') {\r\n                return items.split(' ');\r\n            }\r\n            return items;\r\n        };\r\n        var identifyMenus = function (editor, registry) {\r\n            var rawMenuData = merge(defaultMenus, registry.menus);\r\n            var userDefinedMenus = keys(registry.menus).length > 0;\r\n            var menubar = registry.menubar === undefined || registry.menubar === true ? parseItemsString(defaultMenubar) : parseItemsString(registry.menubar === false ? '' : registry.menubar);\r\n            var validMenus = filter(menubar, function (menuName) {\r\n                return userDefinedMenus ? registry.menus.hasOwnProperty(menuName) && registry.menus[menuName].hasOwnProperty('items') || defaultMenus.hasOwnProperty(menuName) : defaultMenus.hasOwnProperty(menuName);\r\n            });\r\n            var menus = map(validMenus, function (menuName) {\r\n                var menuData = rawMenuData[menuName];\r\n                return make$7({\r\n                    title: menuData.title,\r\n                    items: parseItemsString(menuData.items)\r\n                }, registry, editor);\r\n            });\r\n            return filter(menus, function (menu) {\r\n                var isNotSeparator = function (item) {\r\n                    return item.type !== 'separator';\r\n                };\r\n                return menu.getItems().length > 0 && exists(menu.getItems(), isNotSeparator);\r\n            });\r\n        };\r\n        var fireSkinLoaded$1 = function (editor) {\r\n            var done = function () {\r\n                editor._skinLoaded = true;\r\n                Events$1.fireSkinLoaded(editor);\r\n            };\r\n            return function () {\r\n                if (editor.initialized) {\r\n                    done();\r\n                }\r\n                else {\r\n                    editor.on('init', done);\r\n                }\r\n            };\r\n        };\r\n        var SkinLoaded = { fireSkinLoaded: fireSkinLoaded$1 };\r\n        var loadSkin = function (isInline, editor) {\r\n            var skinUrl = getSkinUrl(editor);\r\n            var skinUiCss;\r\n            if (skinUrl) {\r\n                skinUiCss = skinUrl + '/skin.min.css';\r\n                editor.contentCSS.push(skinUrl + (isInline ? '/content.inline' : '/content') + '.min.css');\r\n            }\r\n            if (isSkinDisabled(editor) === false && skinUiCss) {\r\n                global$6.DOM.styleSheetLoader.load(skinUiCss, SkinLoaded.fireSkinLoaded(editor));\r\n            }\r\n            else {\r\n                SkinLoaded.fireSkinLoaded(editor)();\r\n            }\r\n        };\r\n        var iframe = curry(loadSkin, false);\r\n        var inline = curry(loadSkin, true);\r\n        var DOM = global$6.DOM;\r\n        var setupEvents = function (editor) {\r\n            var contentWindow = editor.getWin();\r\n            var initialDocEle = editor.getDoc().documentElement;\r\n            var lastWindowDimensions = Cell(Position(contentWindow.innerWidth, contentWindow.innerHeight));\r\n            var lastDocumentDimensions = Cell(Position(initialDocEle.offsetWidth, initialDocEle.offsetHeight));\r\n            var resize = function () {\r\n                var docEle = editor.getDoc().documentElement;\r\n                var outer = lastWindowDimensions.get();\r\n                var inner = lastDocumentDimensions.get();\r\n                if (outer.left() !== contentWindow.innerWidth || outer.top() !== contentWindow.innerHeight) {\r\n                    lastWindowDimensions.set(Position(contentWindow.innerWidth, contentWindow.innerHeight));\r\n                    Events$1.fireResizeContent(editor);\r\n                }\r\n                else if (inner.left() !== docEle.offsetWidth || inner.top() !== docEle.offsetHeight) {\r\n                    lastDocumentDimensions.set(Position(docEle.offsetWidth, docEle.offsetHeight));\r\n                    Events$1.fireResizeContent(editor);\r\n                }\r\n            };\r\n            DOM.bind(contentWindow, 'resize', resize);\r\n            var elementLoad = capture$1(Element.fromDom(editor.getBody()), 'load', resize);\r\n            editor.on('remove', function () {\r\n                elementLoad.unbind();\r\n                DOM.unbind(contentWindow, 'resize', resize);\r\n            });\r\n        };\r\n        var render = function (editor, uiComponents, rawUiConfig, backstage, args) {\r\n            var lastToolbarWidth = Cell(0);\r\n            iframe(editor);\r\n            attachSystemAfter(Element.fromDom(args.targetNode), uiComponents.mothership);\r\n            attachSystem(body(), uiComponents.uiMothership);\r\n            editor.on('init', function () {\r\n                OuterContainer.setToolbar(uiComponents.outerContainer, identifyButtons(editor, rawUiConfig, { backstage: backstage }, Option.none()));\r\n                lastToolbarWidth.set(editor.getWin().innerWidth);\r\n                OuterContainer.setMenubar(uiComponents.outerContainer, identifyMenus(editor, rawUiConfig));\r\n                OuterContainer.setSidebar(uiComponents.outerContainer, rawUiConfig.sidebar);\r\n                setupEvents(editor);\r\n            });\r\n            var socket = OuterContainer.getSocket(uiComponents.outerContainer).getOrDie('Could not find expected socket element');\r\n            setupReadonlyModeSwitch(editor, uiComponents);\r\n            editor.addCommand('ToggleSidebar', function (ui, value) {\r\n                OuterContainer.toggleSidebar(uiComponents.outerContainer, value);\r\n                editor.fire('ToggleSidebar');\r\n            });\r\n            editor.addQueryValueHandler('ToggleSidebar', function () {\r\n                return OuterContainer.whichSidebar(uiComponents.outerContainer);\r\n            });\r\n            var drawer = getToolbarDrawer(editor);\r\n            var refreshDrawer = function () {\r\n                OuterContainer.refreshToolbar(uiComponents.outerContainer);\r\n            };\r\n            if (drawer === ToolbarDrawer.sliding || drawer === ToolbarDrawer.floating) {\r\n                editor.on('ResizeContent', function () {\r\n                    var width = editor.getWin().innerWidth;\r\n                    if (width !== lastToolbarWidth.get()) {\r\n                        refreshDrawer();\r\n                    }\r\n                    lastToolbarWidth.set(width);\r\n                });\r\n            }\r\n            return {\r\n                iframeContainer: socket.element().dom(),\r\n                editorContainer: uiComponents.outerContainer.element().dom()\r\n            };\r\n        };\r\n        var Iframe = {\r\n            render: render,\r\n            getBehaviours: function (_) {\r\n                return [];\r\n            }\r\n        };\r\n        var getOrigin = function (element, scroll) {\r\n            return offsetParent(element).orThunk(function () {\r\n                var marker = Element.fromTag('span');\r\n                before(element, marker);\r\n                var offsetParent$1 = offsetParent(marker);\r\n                remove(marker);\r\n                return offsetParent$1;\r\n            }).map(function (offsetP) {\r\n                var loc = absolute(offsetP);\r\n                return loc.translate(-scroll.left(), -scroll.top());\r\n            }).getOrThunk(function () {\r\n                return Position(0, 0);\r\n            });\r\n        };\r\n        var adt$b = Adt.generate([\r\n            {\r\n                offset: [\r\n                    'x',\r\n                    'y'\r\n                ]\r\n            },\r\n            {\r\n                absolute: [\r\n                    'x',\r\n                    'y'\r\n                ]\r\n            },\r\n            {\r\n                fixed: [\r\n                    'x',\r\n                    'y'\r\n                ]\r\n            }\r\n        ]);\r\n        var subtract = function (change) {\r\n            return function (point) {\r\n                return point.translate(-change.left(), -change.top());\r\n            };\r\n        };\r\n        var add$4 = function (change) {\r\n            return function (point) {\r\n                return point.translate(change.left(), change.top());\r\n            };\r\n        };\r\n        var transform$1 = function (changes) {\r\n            return function (x, y) {\r\n                return foldl(changes, function (rest, f) {\r\n                    return f(rest);\r\n                }, Position(x, y));\r\n            };\r\n        };\r\n        var asFixed = function (coord, scroll, origin) {\r\n            return coord.fold(transform$1([\r\n                add$4(origin),\r\n                subtract(scroll)\r\n            ]), transform$1([subtract(scroll)]), transform$1([]));\r\n        };\r\n        var asAbsolute = function (coord, scroll, origin) {\r\n            return coord.fold(transform$1([add$4(origin)]), transform$1([]), transform$1([add$4(scroll)]));\r\n        };\r\n        var asOffset = function (coord, scroll, origin) {\r\n            return coord.fold(transform$1([]), transform$1([subtract(origin)]), transform$1([\r\n                add$4(scroll),\r\n                subtract(origin)\r\n            ]));\r\n        };\r\n        var withinRange = function (coord1, coord2, xRange, yRange, scroll, origin) {\r\n            var a1 = asAbsolute(coord1, scroll, origin);\r\n            var a2 = asAbsolute(coord2, scroll, origin);\r\n            return Math.abs(a1.left() - a2.left()) <= xRange && Math.abs(a1.top() - a2.top()) <= yRange;\r\n        };\r\n        var toStyles = function (coord, scroll, origin) {\r\n            return coord.fold(function (x, y) {\r\n                return {\r\n                    position: 'absolute',\r\n                    left: x + 'px',\r\n                    top: y + 'px'\r\n                };\r\n            }, function (x, y) {\r\n                return {\r\n                    position: 'absolute',\r\n                    left: x - origin.left() + 'px',\r\n                    top: y - origin.top() + 'px'\r\n                };\r\n            }, function (x, y) {\r\n                return {\r\n                    position: 'fixed',\r\n                    left: x + 'px',\r\n                    top: y + 'px'\r\n                };\r\n            });\r\n        };\r\n        var translate$1 = function (coord, deltaX, deltaY) {\r\n            return coord.fold(function (x, y) {\r\n                return adt$b.offset(x + deltaX, y + deltaY);\r\n            }, function (x, y) {\r\n                return adt$b.absolute(x + deltaX, y + deltaY);\r\n            }, function (x, y) {\r\n                return adt$b.fixed(x + deltaX, y + deltaY);\r\n            });\r\n        };\r\n        var absorb = function (partialCoord, originalCoord, scroll, origin) {\r\n            var absorbOne = function (stencil, nu) {\r\n                return function (optX, optY) {\r\n                    var original = stencil(originalCoord, scroll, origin);\r\n                    return nu(optX.getOr(original.left()), optY.getOr(original.top()));\r\n                };\r\n            };\r\n            return partialCoord.fold(absorbOne(asOffset, adt$b.offset), absorbOne(asAbsolute, adt$b.absolute), absorbOne(asFixed, adt$b.fixed));\r\n        };\r\n        var offset = adt$b.offset;\r\n        var absolute$2 = adt$b.absolute;\r\n        var fixed$1 = adt$b.fixed;\r\n        var appear = function (component, contextualInfo) {\r\n            add$2(component.element(), contextualInfo.transitionClass);\r\n            remove$4(component.element(), contextualInfo.fadeOutClass);\r\n            add$2(component.element(), contextualInfo.fadeInClass);\r\n        };\r\n        var disappear = function (component, contextualInfo) {\r\n            add$2(component.element(), contextualInfo.transitionClass);\r\n            remove$4(component.element(), contextualInfo.fadeInClass);\r\n            add$2(component.element(), contextualInfo.fadeOutClass);\r\n        };\r\n        var isPartiallyVisible = function (box, viewport) {\r\n            return box.y() < viewport.bottom() && box.bottom() > viewport.y();\r\n        };\r\n        var isCompletelyVisible = function (box, viewport) {\r\n            return box.y() >= viewport.y() && box.bottom() <= viewport.bottom();\r\n        };\r\n        var getAttr = function (elem, attr) {\r\n            return has$1(elem, attr) ? Option.some(parseInt(get$2(elem, attr), 10)) : Option.none();\r\n        };\r\n        var getPrior = function (component, dockInfo) {\r\n            var elem = component.element();\r\n            return getAttr(elem, dockInfo.leftAttr).bind(function (left) {\r\n                return getAttr(elem, dockInfo.topAttr).map(function (top) {\r\n                    var w = get$7(component.element());\r\n                    var h = get$8(component.element());\r\n                    return bounds(left, top, w, h);\r\n                });\r\n            });\r\n        };\r\n        var setPrior = function (component, dockInfo, absLeft, absTop) {\r\n            var elem = component.element();\r\n            set$1(elem, dockInfo.leftAttr, absLeft);\r\n            set$1(elem, dockInfo.topAttr, absTop);\r\n        };\r\n        var clearPrior = function (component, dockInfo) {\r\n            var elem = component.element();\r\n            remove$1(elem, dockInfo.leftAttr);\r\n            remove$1(elem, dockInfo.topAttr);\r\n        };\r\n        var morphToAbsolute = function (component, dockInfo, viewport) {\r\n            return getPrior(component, dockInfo).bind(function (box) {\r\n                if (isCompletelyVisible(box, viewport)) {\r\n                    clearPrior(component, dockInfo);\r\n                    return Option.some(absolute$2(box.x(), box.y()));\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            });\r\n        };\r\n        var morphToFixed = function (component, dockInfo, viewport, scroll, origin) {\r\n            var loc = absolute(component.element());\r\n            var box = bounds(loc.left(), loc.top(), get$7(component.element()), get$8(component.element()));\r\n            if (!isCompletelyVisible(box, viewport)) {\r\n                setPrior(component, dockInfo, loc.left(), loc.top());\r\n                var coord = absolute$2(loc.left(), loc.top());\r\n                var asFixed$1 = asFixed(coord, scroll, origin);\r\n                var viewportPt = absolute$2(viewport.x(), viewport.y());\r\n                var fixedViewport = asFixed(viewportPt, scroll, origin);\r\n                var fixedY = box.y() <= viewport.y() ? fixedViewport.top() : fixedViewport.top() + viewport.height() - box.height();\r\n                return Option.some(fixed$1(asFixed$1.left(), fixedY));\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var getMorph = function (component, dockInfo, viewport, scroll, origin) {\r\n            var isDocked = getRaw(component.element(), 'position').is('fixed');\r\n            return isDocked ? morphToAbsolute(component, dockInfo, viewport) : morphToFixed(component, dockInfo, viewport, scroll, origin);\r\n        };\r\n        var refresh$4 = function (component, config, state) {\r\n            var viewport = config.lazyViewport(component);\r\n            config.contextual.each(function (contextInfo) {\r\n                contextInfo.lazyContext(component).each(function (elem) {\r\n                    var box$1 = box(elem);\r\n                    var isVisible = isPartiallyVisible(box$1, viewport);\r\n                    var method = isVisible ? appear : disappear;\r\n                    method(component, contextInfo);\r\n                });\r\n            });\r\n            var doc = owner(component.element());\r\n            var scroll = get$6(doc);\r\n            var origin = getOrigin(component.element(), scroll);\r\n            getMorph(component, config, viewport, scroll, origin).each(function (morph) {\r\n                var styles = toStyles(morph, scroll, origin);\r\n                setAll$1(component.element(), styles);\r\n            });\r\n        };\r\n        var DockingApis = Object.freeze({\r\n            refresh: refresh$4\r\n        });\r\n        var events$f = function (dockInfo, dockState) {\r\n            return derive([\r\n                run(transitionend(), function (component, simulatedEvent) {\r\n                    dockInfo.contextual.each(function (contextInfo) {\r\n                        if (eq(component.element(), simulatedEvent.event().target())) {\r\n                            remove$4(component.element(), contextInfo.transitionClass);\r\n                            simulatedEvent.stop();\r\n                        }\r\n                    });\r\n                }),\r\n                run(windowScroll(), function (component, _) {\r\n                    refresh$4(component, dockInfo, dockState);\r\n                })\r\n            ]);\r\n        };\r\n        var ActiveDocking = Object.freeze({\r\n            events: events$f\r\n        });\r\n        var defaultLazyViewport = function (_component) {\r\n            var scroll = get$6();\r\n            return bounds(scroll.left(), scroll.top(), domGlobals.window.innerWidth, domGlobals.window.innerHeight);\r\n        };\r\n        var DockingSchema = [\r\n            optionObjOf('contextual', [\r\n                strict$1('fadeInClass'),\r\n                strict$1('fadeOutClass'),\r\n                strict$1('transitionClass'),\r\n                strict$1('lazyContext')\r\n            ]),\r\n            defaulted$1('lazyViewport', defaultLazyViewport),\r\n            strict$1('leftAttr'),\r\n            strict$1('topAttr')\r\n        ];\r\n        var Docking = create$1({\r\n            fields: DockingSchema,\r\n            name: 'docking',\r\n            active: ActiveDocking,\r\n            apis: DockingApis\r\n        });\r\n        var render$1 = function (editor, uiComponents, rawUiConfig, backstage, args) {\r\n            var floatContainer;\r\n            var DOM = global$6.DOM;\r\n            var useFixedToolbarContainer = useFixedContainer(editor);\r\n            var splitSetting = getToolbarDrawer(editor);\r\n            var split = splitSetting === ToolbarDrawer.sliding || splitSetting === ToolbarDrawer.floating;\r\n            inline(editor);\r\n            var calcPosition = function (offset) {\r\n                if (offset === void 0) {\r\n                    offset = 0;\r\n                }\r\n                var location = absolute(Element.fromDom(editor.getBody()));\r\n                return {\r\n                    top: Math.round(location.top() - get$8(floatContainer.element())) + offset,\r\n                    left: Math.round(location.left())\r\n                };\r\n            };\r\n            var setChromePosition = function (toolbar) {\r\n                var isDocked = getRaw(floatContainer.element(), 'position').is('fixed');\r\n                var offset = split ? toolbar.fold(function () {\r\n                    return 0;\r\n                }, function (tbar) {\r\n                    return tbar.components().length > 1 ? get$8(tbar.components()[1].element()) : 0;\r\n                }) : 0;\r\n                var position = calcPosition(offset);\r\n                if (isDocked) {\r\n                    setAll(floatContainer.element(), tupleMap(position, function (value, key) {\r\n                        return {\r\n                            k: 'data-dock-' + key,\r\n                            v: value\r\n                        };\r\n                    }));\r\n                }\r\n                else {\r\n                    setAll$1(floatContainer.element(), map$1(position, function (value) {\r\n                        return value + 'px';\r\n                    }));\r\n                }\r\n                Docking.refresh(floatContainer);\r\n            };\r\n            var updateChromeUi = function () {\r\n                var toolbar = OuterContainer.getToolbar(uiComponents.outerContainer);\r\n                if (split) {\r\n                    OuterContainer.refreshToolbar(uiComponents.outerContainer);\r\n                }\r\n                if (!useFixedToolbarContainer) {\r\n                    setChromePosition(toolbar);\r\n                }\r\n            };\r\n            var show = function () {\r\n                set$2(uiComponents.outerContainer.element(), 'display', 'flex');\r\n                DOM.addClass(editor.getBody(), 'mce-edit-focus');\r\n                remove$6(uiComponents.uiMothership.element(), 'display');\r\n                updateChromeUi();\r\n            };\r\n            var hide = function () {\r\n                if (uiComponents.outerContainer) {\r\n                    set$2(uiComponents.outerContainer.element(), 'display', 'none');\r\n                    DOM.removeClass(editor.getBody(), 'mce-edit-focus');\r\n                }\r\n                set$2(uiComponents.uiMothership.element(), 'display', 'none');\r\n            };\r\n            var render = function () {\r\n                if (floatContainer) {\r\n                    show();\r\n                    return;\r\n                }\r\n                floatContainer = uiComponents.outerContainer;\r\n                var uiContainer = getUiContainer(editor);\r\n                attachSystem(uiContainer, uiComponents.mothership);\r\n                attachSystem(uiContainer, uiComponents.uiMothership);\r\n                OuterContainer.setToolbar(uiComponents.outerContainer, identifyButtons(editor, rawUiConfig, { backstage: backstage }, Option.none()));\r\n                OuterContainer.setMenubar(uiComponents.outerContainer, identifyMenus(editor, rawUiConfig));\r\n                if (!useFixedToolbarContainer) {\r\n                    set$2(floatContainer.element(), 'position', 'absolute');\r\n                }\r\n                updateChromeUi();\r\n                show();\r\n                editor.on('NodeChange ResizeWindow', updateChromeUi);\r\n                editor.on('activate', show);\r\n                editor.on('deactivate', hide);\r\n                editor.nodeChanged();\r\n            };\r\n            editor.on('focus', render);\r\n            editor.on('blur hide', hide);\r\n            editor.on('init', function () {\r\n                if (editor.hasFocus()) {\r\n                    render();\r\n                }\r\n            });\r\n            setupReadonlyModeSwitch(editor, uiComponents);\r\n            return { editorContainer: uiComponents.outerContainer.element().dom() };\r\n        };\r\n        var getBehaviours$2 = function (editor) {\r\n            return useFixedContainer(editor) ? [] : [\r\n                Docking.config({\r\n                    leftAttr: 'data-dock-left',\r\n                    topAttr: 'data-dock-top',\r\n                    contextual: {\r\n                        lazyContext: function (_) {\r\n                            return Option.from(editor).map(function (ed) {\r\n                                return Element.fromDom(ed.getBody());\r\n                            });\r\n                        },\r\n                        fadeInClass: 'tox-toolbar-dock-fadein',\r\n                        fadeOutClass: 'tox-toolbar-dock-fadeout',\r\n                        transitionClass: 'tox-toolbar-dock-transition'\r\n                    }\r\n                }),\r\n                Focusing.config({})\r\n            ];\r\n        };\r\n        var Inline = {\r\n            render: render$1,\r\n            getBehaviours: getBehaviours$2\r\n        };\r\n        var nu$d = function (x, y) {\r\n            return {\r\n                anchor: 'makeshift',\r\n                x: x,\r\n                y: y\r\n            };\r\n        };\r\n        var transpose$1 = function (pos, dx, dy) {\r\n            return nu$d(pos.x + dx, pos.y + dy);\r\n        };\r\n        var fromPageXY = function (e) {\r\n            return nu$d(e.pageX, e.pageY);\r\n        };\r\n        var fromClientXY = function (e) {\r\n            return nu$d(e.clientX, e.clientY);\r\n        };\r\n        var transposeContentAreaContainer = function (element, pos) {\r\n            var containerPos = global$6.DOM.getPos(element);\r\n            return transpose$1(pos, containerPos.x, containerPos.y);\r\n        };\r\n        var getPointAnchor = function (editor, e) {\r\n            if (e.type === 'contextmenu') {\r\n                if (editor.inline) {\r\n                    return fromPageXY(e);\r\n                }\r\n                else {\r\n                    return transposeContentAreaContainer(editor.getContentAreaContainer(), fromClientXY(e));\r\n                }\r\n            }\r\n            else {\r\n                return getSelectionAnchor(editor);\r\n            }\r\n        };\r\n        var getSelectionAnchor = function (editor) {\r\n            return {\r\n                anchor: 'selection',\r\n                root: Element.fromDom(editor.selection.getNode())\r\n            };\r\n        };\r\n        var getNodeAnchor$1 = function (editor) {\r\n            return {\r\n                anchor: 'node',\r\n                node: Option.some(Element.fromDom(editor.selection.getNode())),\r\n                root: Element.fromDom(editor.getBody())\r\n            };\r\n        };\r\n        var patchPipeConfig = function (config) {\r\n            return typeof config === 'string' ? config.split(/[ ,]/) : config;\r\n        };\r\n        var shouldNeverUseNative = function (editor) {\r\n            return editor.settings.contextmenu_never_use_native || false;\r\n        };\r\n        var getMenuItems = function (editor, name, defaultItems) {\r\n            var contextMenus = editor.ui.registry.getAll().contextMenus;\r\n            return get(editor.settings, name).map(patchPipeConfig).getOrThunk(function () {\r\n                return filter(patchPipeConfig(defaultItems), function (item) {\r\n                    return has(contextMenus, item);\r\n                });\r\n            });\r\n        };\r\n        var getContextMenu = function (editor) {\r\n            return getMenuItems(editor, 'contextmenu', 'link linkchecker image imagetools table spellchecker configurepermanentpen');\r\n        };\r\n        var Settings$1 = {\r\n            shouldNeverUseNative: shouldNeverUseNative,\r\n            getContextMenu: getContextMenu\r\n        };\r\n        var isSeparator$1 = function (item) {\r\n            return isString(item) ? item === '|' : item.type === 'separator';\r\n        };\r\n        var separator$3 = { type: 'separator' };\r\n        var makeContextItem = function (item) {\r\n            if (isString(item)) {\r\n                return item;\r\n            }\r\n            else {\r\n                switch (item.type) {\r\n                    case 'separator':\r\n                        return separator$3;\r\n                    case 'submenu':\r\n                        return {\r\n                            type: 'nestedmenuitem',\r\n                            text: item.text,\r\n                            icon: item.icon,\r\n                            getSubmenuItems: function () {\r\n                                var items = item.getSubmenuItems();\r\n                                if (isString(items)) {\r\n                                    return items;\r\n                                }\r\n                                else {\r\n                                    return map(items, makeContextItem);\r\n                                }\r\n                            }\r\n                        };\r\n                    default:\r\n                        return {\r\n                            type: 'menuitem',\r\n                            text: item.text,\r\n                            icon: item.icon,\r\n                            onAction: noarg(item.onAction)\r\n                        };\r\n                }\r\n            }\r\n        };\r\n        var addContextMenuGroup = function (xs, groupItems) {\r\n            if (groupItems.length === 0) {\r\n                return xs;\r\n            }\r\n            var lastMenuItem = last(xs).filter(function (item) {\r\n                return !isSeparator$1(item);\r\n            });\r\n            var before = lastMenuItem.fold(function () {\r\n                return [];\r\n            }, function (_) {\r\n                return [separator$3];\r\n            });\r\n            return xs.concat(before).concat(groupItems).concat([separator$3]);\r\n        };\r\n        var generateContextMenu = function (contextMenus, menuConfig, selectedElement) {\r\n            var items = foldl(menuConfig, function (acc, name) {\r\n                if (has(contextMenus, name)) {\r\n                    var items_1 = contextMenus[name].update(selectedElement);\r\n                    if (isString(items_1)) {\r\n                        return addContextMenuGroup(acc, items_1.split(' '));\r\n                    }\r\n                    else if (items_1.length > 0) {\r\n                        var allItems = map(items_1, makeContextItem);\r\n                        return addContextMenuGroup(acc, allItems);\r\n                    }\r\n                    else {\r\n                        return acc;\r\n                    }\r\n                }\r\n                else {\r\n                    return acc.concat([name]);\r\n                }\r\n            }, []);\r\n            if (items.length > 0 && isSeparator$1(items[items.length - 1])) {\r\n                items.pop();\r\n            }\r\n            return items;\r\n        };\r\n        var isNativeOverrideKeyEvent = function (editor, e) {\r\n            return e.ctrlKey && !Settings$1.shouldNeverUseNative(editor);\r\n        };\r\n        var setup$6 = function (editor, lazySink, backstage) {\r\n            var contextmenu = build$1(InlineView.sketch({\r\n                dom: { tag: 'div' },\r\n                lazySink: lazySink,\r\n                onEscape: function () {\r\n                    return editor.focus();\r\n                },\r\n                fireDismissalEventInstead: {},\r\n                inlineBehaviours: derive$1([config('dismissContextMenu', [run(dismissRequested(), function (comp, se) {\r\n                            Sandboxing.close(comp);\r\n                            editor.focus();\r\n                        })])])\r\n            }));\r\n            editor.on('init', function () {\r\n                editor.on('contextmenu', function (e) {\r\n                    if (isNativeOverrideKeyEvent(editor, e)) {\r\n                        return;\r\n                    }\r\n                    var isTriggeredByKeyboardEvent = e.button !== 2 || e.target === editor.getBody();\r\n                    var anchorSpec = isTriggeredByKeyboardEvent ? getNodeAnchor$1(editor) : getPointAnchor(editor, e);\r\n                    var registry = editor.ui.registry.getAll();\r\n                    var menuConfig = Settings$1.getContextMenu(editor);\r\n                    var selectedElement = isTriggeredByKeyboardEvent ? editor.selection.getStart(true) : e.target;\r\n                    var items = generateContextMenu(registry.contextMenus, menuConfig, selectedElement);\r\n                    build$2(items, ItemResponse$1.CLOSE_ON_EXECUTE, backstage).map(function (menuData) {\r\n                        e.preventDefault();\r\n                        InlineView.showMenuAt(contextmenu, anchorSpec, {\r\n                            menu: { markers: markers$1('normal') },\r\n                            data: menuData\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var parseToInt = function (val) {\r\n            var re = /^[0-9\\.]+(|px)$/i;\r\n            if (re.test('' + val)) {\r\n                return Option.some(parseInt(val, 10));\r\n            }\r\n            return Option.none();\r\n        };\r\n        var numToPx = function (val) {\r\n            return isNumber(val) ? val + 'px' : val;\r\n        };\r\n        var Utils = {\r\n            parseToInt: parseToInt,\r\n            numToPx: numToPx\r\n        };\r\n        var initialAttribute = 'data-initial-z-index';\r\n        var resetZIndex = function (blocker) {\r\n            parent(blocker.element()).each(function (root) {\r\n                var initZIndex = get$2(root, initialAttribute);\r\n                if (has$1(root, initialAttribute)) {\r\n                    set$2(root, 'z-index', initZIndex);\r\n                }\r\n                else {\r\n                    remove$6(root, 'z-index');\r\n                }\r\n                remove$1(root, initialAttribute);\r\n            });\r\n        };\r\n        var changeZIndex = function (blocker) {\r\n            parent(blocker.element()).each(function (root) {\r\n                getRaw(root, 'z-index').each(function (zindex) {\r\n                    set$1(root, initialAttribute, zindex);\r\n                });\r\n                set$2(root, 'z-index', get$4(blocker.element(), 'z-index'));\r\n            });\r\n        };\r\n        var instigate = function (anyComponent, blocker) {\r\n            anyComponent.getSystem().addToGui(blocker);\r\n            changeZIndex(blocker);\r\n        };\r\n        var discard = function (blocker) {\r\n            resetZIndex(blocker);\r\n            blocker.getSystem().removeFromGui(blocker);\r\n        };\r\n        var get$d = function (component, snapsInfo) {\r\n            var element = component.element();\r\n            var x = parseInt(get$2(element, snapsInfo.leftAttr), 10);\r\n            var y = parseInt(get$2(element, snapsInfo.topAttr), 10);\r\n            return isNaN(x) || isNaN(y) ? Option.none() : Option.some(Position(x, y));\r\n        };\r\n        var set$8 = function (component, snapsInfo, pt) {\r\n            var element = component.element();\r\n            set$1(element, snapsInfo.leftAttr, pt.left() + 'px');\r\n            set$1(element, snapsInfo.topAttr, pt.top() + 'px');\r\n        };\r\n        var clear = function (component, snapsInfo) {\r\n            var element = component.element();\r\n            remove$1(element, snapsInfo.leftAttr);\r\n            remove$1(element, snapsInfo.topAttr);\r\n        };\r\n        var getCoords = function (component, snapInfo, coord, delta) {\r\n            return get$d(component, snapInfo).fold(function () {\r\n                return coord;\r\n            }, function (fixed) {\r\n                return fixed$1(fixed.left() + delta.left(), fixed.top() + delta.top());\r\n            });\r\n        };\r\n        var moveOrSnap = function (component, snapInfo, coord, delta, scroll, origin) {\r\n            var newCoord = getCoords(component, snapInfo, coord, delta);\r\n            var snap = findSnap(component, snapInfo, newCoord, scroll, origin);\r\n            var fixedCoord = asFixed(newCoord, scroll, origin);\r\n            set$8(component, snapInfo, fixedCoord);\r\n            return snap.fold(function () {\r\n                return {\r\n                    coord: fixed$1(fixedCoord.left(), fixedCoord.top()),\r\n                    extra: Option.none()\r\n                };\r\n            }, function (spanned) {\r\n                return {\r\n                    coord: spanned.output(),\r\n                    extra: spanned.extra()\r\n                };\r\n            });\r\n        };\r\n        var stopDrag = function (component, snapInfo) {\r\n            clear(component, snapInfo);\r\n        };\r\n        var findSnap = function (component, snapInfo, newCoord, scroll, origin) {\r\n            var snaps = snapInfo.getSnapPoints(component);\r\n            return findMap(snaps, function (snap) {\r\n                var sensor = snap.sensor();\r\n                var inRange = withinRange(newCoord, sensor, snap.range().left(), snap.range().top(), scroll, origin);\r\n                return inRange ? Option.some({\r\n                    output: constant(absorb(snap.output(), newCoord, scroll, origin)),\r\n                    extra: snap.extra\r\n                }) : Option.none();\r\n            });\r\n        };\r\n        var getCurrentCoord = function (target) {\r\n            return getRaw(target, 'left').bind(function (left) {\r\n                return getRaw(target, 'top').bind(function (top) {\r\n                    return getRaw(target, 'position').map(function (position) {\r\n                        var nu = position === 'fixed' ? fixed$1 : offset;\r\n                        return nu(parseInt(left, 10), parseInt(top, 10));\r\n                    });\r\n                });\r\n            }).getOrThunk(function () {\r\n                var location = absolute(target);\r\n                return absolute$2(location.left(), location.top());\r\n            });\r\n        };\r\n        var calcNewCoord = function (component, optSnaps, currentCoord, scroll, origin, delta) {\r\n            return optSnaps.fold(function () {\r\n                var translated = translate$1(currentCoord, delta.left(), delta.top());\r\n                var fixedCoord = asFixed(translated, scroll, origin);\r\n                return fixed$1(fixedCoord.left(), fixedCoord.top());\r\n            }, function (snapInfo) {\r\n                var snapping = moveOrSnap(component, snapInfo, currentCoord, delta, scroll, origin);\r\n                snapping.extra.each(function (extra) {\r\n                    snapInfo.onSensor(component, extra);\r\n                });\r\n                return snapping.coord;\r\n            });\r\n        };\r\n        var dragBy = function (component, dragConfig, delta) {\r\n            var target = dragConfig.getTarget(component.element());\r\n            if (dragConfig.repositionTarget) {\r\n                var doc = owner(component.element());\r\n                var scroll = get$6(doc);\r\n                var origin = getOrigin(target, scroll);\r\n                var currentCoord = getCurrentCoord(target);\r\n                var newCoord = calcNewCoord(component, dragConfig.snaps, currentCoord, scroll, origin, delta);\r\n                var styles = toStyles(newCoord, scroll, origin);\r\n                setAll$1(target, styles);\r\n            }\r\n            dragConfig.onDrag(component, target, delta);\r\n        };\r\n        var defaultLazyViewport$1 = function () {\r\n            var scroll = get$6();\r\n            return {\r\n                x: scroll.left,\r\n                y: scroll.top,\r\n                width: constant(domGlobals.window.innerWidth),\r\n                height: constant(domGlobals.window.innerHeight),\r\n                bottom: constant(scroll.top() + domGlobals.window.innerHeight),\r\n                right: constant(scroll.left() + domGlobals.window.innerWidth)\r\n            };\r\n        };\r\n        var SnapSchema = optionObjOf('snaps', [\r\n            strict$1('getSnapPoints'),\r\n            onHandler('onSensor'),\r\n            strict$1('leftAttr'),\r\n            strict$1('topAttr'),\r\n            defaulted$1('lazyViewport', defaultLazyViewport$1)\r\n        ]);\r\n        var init$b = function (dragApi) {\r\n            return derive([\r\n                run(mousedown(), dragApi.forceDrop),\r\n                run(mouseup(), dragApi.drop),\r\n                run(mousemove(), function (comp, simulatedEvent) {\r\n                    dragApi.move(simulatedEvent.event());\r\n                }),\r\n                run(mouseout(), dragApi.delayDrop)\r\n            ]);\r\n        };\r\n        var getData$1 = function (event) {\r\n            return Option.from(Position(event.x(), event.y()));\r\n        };\r\n        var getDelta$1 = function (old, nu) {\r\n            return Position(nu.left() - old.left(), nu.top() - old.top());\r\n        };\r\n        var MouseData = Object.freeze({\r\n            getData: getData$1,\r\n            getDelta: getDelta$1\r\n        });\r\n        var handlers = function (dragConfig, dragState) {\r\n            return derive([run(mousedown(), function (component, simulatedEvent) {\r\n                    var raw = simulatedEvent.event().raw();\r\n                    if (raw.button !== 0) {\r\n                        return;\r\n                    }\r\n                    simulatedEvent.stop();\r\n                    var dragApi = {\r\n                        drop: function () {\r\n                            stop();\r\n                        },\r\n                        delayDrop: function () {\r\n                            delayDrop.schedule();\r\n                        },\r\n                        forceDrop: function () {\r\n                            stop();\r\n                        },\r\n                        move: function (event) {\r\n                            delayDrop.cancel();\r\n                            var delta = dragState.update(MouseData, event);\r\n                            delta.each(function (dlt) {\r\n                                dragBy(component, dragConfig, dlt);\r\n                            });\r\n                        }\r\n                    };\r\n                    var blocker = component.getSystem().build(Container.sketch({\r\n                        dom: {\r\n                            styles: {\r\n                                'left': '0px',\r\n                                'top': '0px',\r\n                                'width': '100%',\r\n                                'height': '100%',\r\n                                'position': 'fixed',\r\n                                'z-index': '1000000000000000'\r\n                            },\r\n                            classes: [dragConfig.blockerClass]\r\n                        },\r\n                        events: init$b(dragApi)\r\n                    }));\r\n                    var stop = function () {\r\n                        discard(blocker);\r\n                        dragConfig.snaps.each(function (snapInfo) {\r\n                            stopDrag(component, snapInfo);\r\n                        });\r\n                        var target = dragConfig.getTarget(component.element());\r\n                        dragConfig.onDrop(component, target);\r\n                    };\r\n                    var delayDrop = DelayedFunction(stop, 200);\r\n                    var start = function () {\r\n                        dragState.reset();\r\n                        instigate(component, blocker);\r\n                    };\r\n                    start();\r\n                })]);\r\n        };\r\n        var schema$q = [\r\n            defaulted$1('useFixed', false),\r\n            strict$1('blockerClass'),\r\n            defaulted$1('getTarget', identity),\r\n            defaulted$1('onDrag', noop),\r\n            defaulted$1('repositionTarget', true),\r\n            onHandler('onDrop'),\r\n            SnapSchema,\r\n            output('dragger', { handlers: handlers })\r\n        ];\r\n        var getDataFrom = function (touches) {\r\n            var touch = touches[0];\r\n            return Option.some(Position(touch.clientX, touch.clientY));\r\n        };\r\n        var getData$2 = function (event) {\r\n            var raw = event.raw();\r\n            var touches = raw.touches;\r\n            return touches.length === 1 ? getDataFrom(touches) : Option.none();\r\n        };\r\n        var getDelta$2 = function (old, nu) {\r\n            return Position(nu.left() - old.left(), nu.top() - old.top());\r\n        };\r\n        var TouchData = Object.freeze({\r\n            getData: getData$2,\r\n            getDelta: getDelta$2\r\n        });\r\n        var handlers$1 = function (dragConfig, dragState) {\r\n            return derive([\r\n                stopper(touchstart()),\r\n                run(touchmove(), function (component, simulatedEvent) {\r\n                    simulatedEvent.stop();\r\n                    var delta = dragState.update(TouchData, simulatedEvent.event());\r\n                    delta.each(function (dlt) {\r\n                        dragBy(component, dragConfig, dlt);\r\n                    });\r\n                }),\r\n                run(touchend(), function (component, simulatedEvent) {\r\n                    dragConfig.snaps.each(function (snapInfo) {\r\n                        stopDrag(component, snapInfo);\r\n                    });\r\n                    var target = dragConfig.getTarget(component.element());\r\n                    dragState.reset();\r\n                    dragConfig.onDrop(component, target);\r\n                })\r\n            ]);\r\n        };\r\n        var schema$r = [\r\n            defaulted$1('useFixed', false),\r\n            defaulted$1('getTarget', identity),\r\n            defaulted$1('onDrag', noop),\r\n            defaulted$1('repositionTarget', true),\r\n            defaulted$1('onDrop', noop),\r\n            SnapSchema,\r\n            output('dragger', { handlers: handlers$1 })\r\n        ];\r\n        var mouse = schema$q;\r\n        var touch = schema$r;\r\n        var DraggingBranches = Object.freeze({\r\n            mouse: mouse,\r\n            touch: touch\r\n        });\r\n        var init$c = function () {\r\n            var previous = Option.none();\r\n            var reset = function () {\r\n                previous = Option.none();\r\n            };\r\n            var calculateDelta = function (mode, nu) {\r\n                var result = previous.map(function (old) {\r\n                    return mode.getDelta(old, nu);\r\n                });\r\n                previous = Option.some(nu);\r\n                return result;\r\n            };\r\n            var update = function (mode, dragEvent) {\r\n                return mode.getData(dragEvent).bind(function (nuData) {\r\n                    return calculateDelta(mode, nuData);\r\n                });\r\n            };\r\n            var readState = constant({});\r\n            return nu$5({\r\n                readState: readState,\r\n                reset: reset,\r\n                update: update\r\n            });\r\n        };\r\n        var DragState = Object.freeze({\r\n            init: init$c\r\n        });\r\n        var Dragging = createModes$1({\r\n            branchKey: 'mode',\r\n            branches: DraggingBranches,\r\n            name: 'dragging',\r\n            active: {\r\n                events: function (dragConfig, dragState) {\r\n                    var dragger = dragConfig.dragger;\r\n                    return dragger.handlers(dragConfig, dragState);\r\n                }\r\n            },\r\n            extra: {\r\n                snap: MixedBag([\r\n                    'sensor',\r\n                    'range',\r\n                    'output'\r\n                ], ['extra'])\r\n            },\r\n            state: DragState\r\n        });\r\n        var ResizeTypes;\r\n        (function (ResizeTypes) {\r\n            ResizeTypes[ResizeTypes['None'] = 0] = 'None';\r\n            ResizeTypes[ResizeTypes['Both'] = 1] = 'Both';\r\n            ResizeTypes[ResizeTypes['Vertical'] = 2] = 'Vertical';\r\n        }(ResizeTypes || (ResizeTypes = {})));\r\n        var calcCappedSize = function (originalSize, delta, minSize, maxSize) {\r\n            var newSize = originalSize + delta;\r\n            var minOverride = minSize.filter(function (min) {\r\n                return newSize < min;\r\n            });\r\n            var maxOverride = maxSize.filter(function (max) {\r\n                return newSize > max;\r\n            });\r\n            return minOverride.or(maxOverride).getOr(newSize);\r\n        };\r\n        var getDimensions = function (editor, deltas, resizeType, originalHeight, originalWidth) {\r\n            var dimensions = {};\r\n            dimensions.height = calcCappedSize(originalHeight, deltas.top(), getMinHeightSetting(editor), getMaxHeightSetting(editor));\r\n            if (resizeType === ResizeTypes.Both) {\r\n                dimensions.width = calcCappedSize(originalWidth, deltas.left(), getMinWidthSetting(editor), getMaxWidthSetting(editor));\r\n            }\r\n            return dimensions;\r\n        };\r\n        var resize$3 = function (editor, deltas, resizeType) {\r\n            var container = Element.fromDom(editor.getContainer());\r\n            var dimensions = getDimensions(editor, deltas, resizeType, get$8(container), get$7(container));\r\n            each$1(dimensions, function (val, dim) {\r\n                return set$2(container, dim, Utils.numToPx(val));\r\n            });\r\n            Events$1.fireResizeEditor(editor);\r\n        };\r\n        var isHidden$1 = function (elm) {\r\n            if (elm.nodeType === 1) {\r\n                if (elm.nodeName === 'BR' || !!elm.getAttribute('data-mce-bogus')) {\r\n                    return true;\r\n                }\r\n                if (elm.getAttribute('data-mce-type') === 'bookmark') {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var renderElementPath = function (editor, settings) {\r\n            if (!settings.delimiter) {\r\n                settings.delimiter = '\\xBB';\r\n            }\r\n            var getDataPath = function (data) {\r\n                var parts = data || [];\r\n                var newPathElements = map(parts, function (part, index) {\r\n                    return Button.sketch({\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-statusbar__path-item'],\r\n                            attributes: {\r\n                                'role': 'button',\r\n                                'data-index': index,\r\n                                'tab-index': -1,\r\n                                'aria-level': index + 1\r\n                            },\r\n                            innerHtml: part.name\r\n                        },\r\n                        action: function (btn) {\r\n                            editor.focus();\r\n                            editor.selection.select(part.element);\r\n                            editor.nodeChanged();\r\n                        }\r\n                    });\r\n                });\r\n                var divider = {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-statusbar__path-divider'],\r\n                        attributes: { 'aria-hidden': true },\r\n                        innerHtml: ' ' + settings.delimiter + ' '\r\n                    }\r\n                };\r\n                return foldl(newPathElements.slice(1), function (acc, element) {\r\n                    var newAcc = acc;\r\n                    newAcc.push(divider);\r\n                    newAcc.push(element);\r\n                    return newAcc;\r\n                }, [newPathElements[0]]);\r\n            };\r\n            var updatePath = function (parents) {\r\n                var newPath = [];\r\n                var i = parents.length;\r\n                while (i-- > 0) {\r\n                    var parent = parents[i];\r\n                    if (parent.nodeType === 1 && !isHidden$1(parent)) {\r\n                        var args = editor.fire('ResolveName', {\r\n                            name: parent.nodeName.toLowerCase(),\r\n                            target: parent\r\n                        });\r\n                        if (!args.isDefaultPrevented()) {\r\n                            newPath.push({\r\n                                name: args.name,\r\n                                element: parent\r\n                            });\r\n                        }\r\n                        if (args.isPropagationStopped()) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                return newPath;\r\n            };\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-statusbar__path'],\r\n                    attributes: { role: 'navigation' }\r\n                },\r\n                behaviours: derive$1([\r\n                    Keying.config({\r\n                        mode: 'flow',\r\n                        selector: 'div[role=button]'\r\n                    }),\r\n                    Tabstopping.config({}),\r\n                    Replacing.config({}),\r\n                    config('elementPathEvents', [runOnAttached(function (comp, e) {\r\n                            editor.shortcuts.add('alt+F11', 'focus statusbar elementpath', function () {\r\n                                return Keying.focusIn(comp);\r\n                            });\r\n                            editor.on('NodeChange', function (e) {\r\n                                var newPath = updatePath(e.parents);\r\n                                if (newPath.length > 0) {\r\n                                    Replacing.set(comp, getDataPath(newPath));\r\n                                }\r\n                            });\r\n                        })])\r\n                ]),\r\n                components: []\r\n            };\r\n        };\r\n        var ElementPath = { renderElementPath: renderElementPath };\r\n        var renderWordCount = function (editor, providersBackstage) {\r\n            var _a;\r\n            var replaceCountText = function (comp, count, mode) {\r\n                return Replacing.set(comp, [text(providersBackstage.translate([\r\n                        '{0} ' + mode,\r\n                        count[mode]\r\n                    ]))]);\r\n            };\r\n            return Button.sketch({\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: ['tox-statusbar__wordcount']\r\n                },\r\n                components: [],\r\n                buttonBehaviours: derive$1([\r\n                    Tabstopping.config({}),\r\n                    Replacing.config({}),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: {\r\n                                mode: 'words',\r\n                                count: {\r\n                                    words: 0,\r\n                                    characters: 0\r\n                                }\r\n                            }\r\n                        }\r\n                    }),\r\n                    config('wordcount-events', [\r\n                        run(tapOrClick(), function (comp) {\r\n                            var currentVal = Representing.getValue(comp);\r\n                            var newMode = currentVal.mode === 'words' ? 'characters' : 'words';\r\n                            Representing.setValue(comp, {\r\n                                mode: newMode,\r\n                                count: currentVal.count\r\n                            });\r\n                            replaceCountText(comp, currentVal.count, newMode);\r\n                        }),\r\n                        runOnAttached(function (comp) {\r\n                            editor.on('wordCountUpdate', function (e) {\r\n                                var mode = Representing.getValue(comp).mode;\r\n                                Representing.setValue(comp, {\r\n                                    mode: mode,\r\n                                    count: e.wordCount\r\n                                });\r\n                                replaceCountText(comp, e.wordCount, mode);\r\n                            });\r\n                        })\r\n                    ])\r\n                ]),\r\n                eventOrder: (_a = {}, _a[tapOrClick()] = [\r\n                    'wordcount-events',\r\n                    'alloy.base.behaviour'\r\n                ], _a)\r\n            });\r\n        };\r\n        var renderStatusbar = function (editor, providersBackstage) {\r\n            var renderResizeHandlerIcon = function (resizeType) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-statusbar__resize-handle'],\r\n                        attributes: { title: providersBackstage.translate('Resize') },\r\n                        innerHtml: get$c('resize-handle', providersBackstage.icons)\r\n                    },\r\n                    behaviours: derive$1([Dragging.config({\r\n                            mode: 'mouse',\r\n                            repositionTarget: false,\r\n                            onDrag: function (comp, target, delta) {\r\n                                resize$3(editor, delta, resizeType);\r\n                            },\r\n                            blockerClass: 'tox-blocker'\r\n                        })])\r\n                };\r\n            };\r\n            var renderBranding = function () {\r\n                var label = global$3.translate([\r\n                    'Powered by {0}',\r\n                    'Tiny'\r\n                ]);\r\n                var linkHtml = '<a href=\"https://www.tiny.cloud/?utm_campaign=editor_referral&amp;utm_medium=poweredby&amp;utm_source=tinymce&amp;utm_content=v5\" rel=\"noopener\" target=\"_blank\" tabindex=\"-1\" aria-label=\"' + label + '\">' + label + '</a>';\r\n                return {\r\n                    dom: {\r\n                        tag: 'span',\r\n                        classes: ['tox-statusbar__branding'],\r\n                        innerHtml: linkHtml\r\n                    }\r\n                };\r\n            };\r\n            var getResizeType = function (editor) {\r\n                var fallback = !contains$1(editor.settings.plugins, 'autoresize');\r\n                var resize = editor.getParam('resize', fallback);\r\n                if (resize === false) {\r\n                    return ResizeTypes.None;\r\n                }\r\n                else if (resize === 'both') {\r\n                    return ResizeTypes.Both;\r\n                }\r\n                else {\r\n                    return ResizeTypes.Vertical;\r\n                }\r\n            };\r\n            var getTextComponents = function () {\r\n                var components = [];\r\n                if (editor.getParam('elementpath', true, 'boolean')) {\r\n                    components.push(ElementPath.renderElementPath(editor, {}));\r\n                }\r\n                if (contains$1(editor.settings.plugins, 'wordcount')) {\r\n                    components.push(renderWordCount(editor, providersBackstage));\r\n                }\r\n                if (editor.getParam('branding', true, 'boolean')) {\r\n                    components.push(renderBranding());\r\n                }\r\n                if (components.length > 0) {\r\n                    return [{\r\n                            dom: {\r\n                                tag: 'div',\r\n                                classes: ['tox-statusbar__text-container']\r\n                            },\r\n                            components: components\r\n                        }];\r\n                }\r\n                return [];\r\n            };\r\n            var getComponents = function () {\r\n                var components = getTextComponents();\r\n                var resizeType = getResizeType(editor);\r\n                if (resizeType !== ResizeTypes.None) {\r\n                    components.push(renderResizeHandlerIcon(resizeType));\r\n                }\r\n                return components;\r\n            };\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-statusbar']\r\n                },\r\n                components: getComponents()\r\n            };\r\n        };\r\n        var setup$7 = function (editor) {\r\n            var isInline = editor.getParam('inline', false, 'boolean');\r\n            var mode = isInline ? Inline : Iframe;\r\n            var lazyOuterContainer = Option.none();\r\n            var platform = PlatformDetection$1.detect();\r\n            var isIE = platform.browser.isIE();\r\n            var platformClasses = isIE ? ['tox-platform-ie'] : [];\r\n            var dirAttributes = global$3.isRtl() ? { attributes: { dir: 'rtl' } } : {};\r\n            var sink = build$1({\r\n                dom: __assign({\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox',\r\n                        'tox-silver-sink',\r\n                        'tox-tinymce-aux'\r\n                    ].concat(platformClasses)\r\n                }, dirAttributes),\r\n                behaviours: derive$1([Positioning.config({ useFixed: false })])\r\n            });\r\n            var memAnchorBar = record({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-anchorbar']\r\n                }\r\n            });\r\n            var lazyAnchorBar = function () {\r\n                return lazyOuterContainer.bind(function (container) {\r\n                    return memAnchorBar.getOpt(container);\r\n                }).getOrDie('Could not find a anchor bar element');\r\n            };\r\n            var lazyMoreButton = function () {\r\n                return lazyOuterContainer.bind(function (container) {\r\n                    return OuterContainer.getMoreButton(container);\r\n                }).getOrDie('Could not find more button element');\r\n            };\r\n            var lazyToolbar = function () {\r\n                return lazyOuterContainer.bind(function (container) {\r\n                    return OuterContainer.getToolbar(container);\r\n                }).getOrDie('Could not find more toolbar element');\r\n            };\r\n            var lazyThrobber = function () {\r\n                return lazyOuterContainer.bind(function (container) {\r\n                    return OuterContainer.getThrobber(container);\r\n                }).getOrDie('Could not find throbber element');\r\n            };\r\n            var backstage = init$8(sink, editor, lazyAnchorBar, lazyMoreButton);\r\n            var lazySink = function () {\r\n                return Result.value(sink);\r\n            };\r\n            var partMenubar = OuterContainer.parts().menubar({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-menubar']\r\n                },\r\n                backstage: backstage,\r\n                onEscape: function () {\r\n                    editor.focus();\r\n                }\r\n            });\r\n            var partToolbar = OuterContainer.parts().toolbar({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-toolbar']\r\n                },\r\n                getSink: lazySink,\r\n                backstage: backstage,\r\n                onEscape: function () {\r\n                    editor.focus();\r\n                },\r\n                split: getToolbarDrawer(editor),\r\n                lazyToolbar: lazyToolbar,\r\n                lazyMoreButton: lazyMoreButton\r\n            });\r\n            var partSocket = OuterContainer.parts().socket({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-edit-area']\r\n                }\r\n            });\r\n            var partSidebar = OuterContainer.parts().sidebar({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-sidebar']\r\n                }\r\n            });\r\n            var partThrobber = OuterContainer.parts().throbber({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-throbber']\r\n                },\r\n                backstage: backstage\r\n            });\r\n            var statusbar = editor.getParam('statusbar', true, 'boolean') && !isInline ? Option.some(renderStatusbar(editor, backstage.shared.providers)) : Option.none();\r\n            var socketSidebarContainer = {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-sidebar-wrap']\r\n                },\r\n                components: [\r\n                    partSocket,\r\n                    partSidebar\r\n                ]\r\n            };\r\n            var hasToolbar = isToolbarEnabled(editor) || getMultipleToolbarsSetting(editor).isSome();\r\n            var hasMenubar = isMenubarEnabled(editor);\r\n            var editorComponents = flatten([\r\n                hasMenubar ? [partMenubar] : [],\r\n                hasToolbar ? [partToolbar] : [],\r\n                useFixedContainer(editor) ? [] : [memAnchorBar.asSpec()],\r\n                isInline ? [] : [socketSidebarContainer]\r\n            ]);\r\n            var editorContainer = {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-editor-container']\r\n                },\r\n                components: editorComponents\r\n            };\r\n            var containerComponents = flatten([\r\n                [editorContainer],\r\n                isInline ? [] : statusbar.toArray(),\r\n                [partThrobber]\r\n            ]);\r\n            var attributes = __assign({ role: 'application' }, global$3.isRtl() ? { dir: 'rtl' } : {});\r\n            var outerContainer = build$1(OuterContainer.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox',\r\n                        'tox-tinymce'\r\n                    ].concat(isInline ? ['tox-tinymce-inline'] : []).concat(platformClasses),\r\n                    styles: { visibility: 'hidden' },\r\n                    attributes: attributes\r\n                },\r\n                components: containerComponents,\r\n                behaviours: derive$1(mode.getBehaviours(editor).concat([Keying.config({\r\n                        mode: 'cyclic',\r\n                        selector: '.tox-menubar, .tox-toolbar, .tox-toolbar__primary, .tox-toolbar__overflow--open, .tox-sidebar__overflow--open, .tox-statusbar__path, .tox-statusbar__wordcount, .tox-statusbar__branding a'\r\n                    })]))\r\n            }));\r\n            lazyOuterContainer = Option.some(outerContainer);\r\n            editor.shortcuts.add('alt+F9', 'focus menubar', function () {\r\n                OuterContainer.focusMenubar(outerContainer);\r\n            });\r\n            editor.shortcuts.add('alt+F10', 'focus toolbar', function () {\r\n                OuterContainer.focusToolbar(outerContainer);\r\n            });\r\n            var mothership = takeover(outerContainer);\r\n            var uiMothership = takeover(sink);\r\n            Events.setup(editor, mothership, uiMothership);\r\n            var getUi = function () {\r\n                var channels = {\r\n                    broadcastAll: uiMothership.broadcast,\r\n                    broadcastOn: uiMothership.broadcastOn,\r\n                    register: function () {\r\n                    }\r\n                };\r\n                return { channels: channels };\r\n            };\r\n            var setEditorSize = function (elm) {\r\n                var DOM = global$6.DOM;\r\n                var baseWidth = editor.getParam('width', DOM.getStyle(elm, 'width'));\r\n                var baseHeight = getHeightSetting(editor);\r\n                var minWidth = getMinWidthSetting(editor);\r\n                var minHeight = getMinHeightSetting(editor);\r\n                var parsedWidth = Utils.parseToInt(baseWidth).bind(function (w) {\r\n                    return Utils.numToPx(minWidth.map(function (mw) {\r\n                        return Math.max(w, mw);\r\n                    }));\r\n                }).getOr(Utils.numToPx(baseWidth));\r\n                var parsedHeight = Utils.parseToInt(baseHeight).bind(function (h) {\r\n                    return minHeight.map(function (mh) {\r\n                        return Math.max(h, mh);\r\n                    });\r\n                }).getOr(baseHeight);\r\n                var stringWidth = Utils.numToPx(parsedWidth);\r\n                if (isValidValue('div', 'width', stringWidth)) {\r\n                    set$2(outerContainer.element(), 'width', stringWidth);\r\n                }\r\n                if (!editor.inline) {\r\n                    var stringHeight = Utils.numToPx(parsedHeight);\r\n                    if (isValidValue('div', 'height', stringHeight)) {\r\n                        set$2(outerContainer.element(), 'height', stringHeight);\r\n                    }\r\n                    else {\r\n                        set$2(outerContainer.element(), 'height', '200px');\r\n                    }\r\n                }\r\n                return parsedHeight;\r\n            };\r\n            var renderUI = function () {\r\n                setup$6(editor, lazySink, backstage);\r\n                setup$4(editor);\r\n                setup$5(editor, lazyThrobber, backstage.shared);\r\n                var _a = editor.ui.registry.getAll(), buttons = _a.buttons, menuItems = _a.menuItems, contextToolbars = _a.contextToolbars, sidebars = _a.sidebars;\r\n                var rawUiConfig = {\r\n                    menuItems: menuItems,\r\n                    buttons: buttons,\r\n                    menus: !editor.settings.menu ? {} : map$1(editor.settings.menu, function (menu) {\r\n                        return merge(menu, { items: menu.items });\r\n                    }),\r\n                    menubar: editor.settings.menubar,\r\n                    toolbar: getMultipleToolbarsSetting(editor).getOr(editor.getParam('toolbar', true)),\r\n                    sidebar: sidebars\r\n                };\r\n                ContextToolbar.register(editor, contextToolbars, sink, { backstage: backstage });\r\n                var elm = editor.getElement();\r\n                var height = setEditorSize(elm);\r\n                var uiComponents = {\r\n                    mothership: mothership,\r\n                    uiMothership: uiMothership,\r\n                    outerContainer: outerContainer\r\n                };\r\n                var args = {\r\n                    targetNode: elm,\r\n                    height: height\r\n                };\r\n                return mode.render(editor, uiComponents, rawUiConfig, backstage, args);\r\n            };\r\n            return {\r\n                mothership: mothership,\r\n                uiMothership: uiMothership,\r\n                backstage: backstage,\r\n                renderUI: renderUI,\r\n                getUi: getUi\r\n            };\r\n        };\r\n        var Render = { setup: setup$7 };\r\n        var register$5 = function (editor) {\r\n            var alignToolbarButtons = [\r\n                {\r\n                    name: 'alignleft',\r\n                    text: 'Align left',\r\n                    cmd: 'JustifyLeft',\r\n                    icon: 'align-left'\r\n                },\r\n                {\r\n                    name: 'aligncenter',\r\n                    text: 'Align center',\r\n                    cmd: 'JustifyCenter',\r\n                    icon: 'align-center'\r\n                },\r\n                {\r\n                    name: 'alignright',\r\n                    text: 'Align right',\r\n                    cmd: 'JustifyRight',\r\n                    icon: 'align-right'\r\n                },\r\n                {\r\n                    name: 'alignjustify',\r\n                    text: 'Justify',\r\n                    cmd: 'JustifyFull',\r\n                    icon: 'align-justify'\r\n                }\r\n            ];\r\n            global$b.each(alignToolbarButtons, function (item) {\r\n                editor.ui.registry.addToggleButton(item.name, {\r\n                    tooltip: item.text,\r\n                    onAction: function () {\r\n                        return editor.execCommand(item.cmd);\r\n                    },\r\n                    icon: item.icon,\r\n                    onSetup: onSetupFormatToggle(editor, item.name)\r\n                });\r\n            });\r\n            var alignNoneToolbarButton = {\r\n                name: 'alignnone',\r\n                text: 'No alignment',\r\n                cmd: 'JustifyNone',\r\n                icon: 'align-none'\r\n            };\r\n            editor.ui.registry.addButton(alignNoneToolbarButton.name, {\r\n                tooltip: alignNoneToolbarButton.text,\r\n                onAction: function () {\r\n                    return editor.execCommand(alignNoneToolbarButton.cmd);\r\n                },\r\n                icon: alignNoneToolbarButton.icon\r\n            });\r\n        };\r\n        var AlignmentButtons = { register: register$5 };\r\n        var toggleFormat = function (editor, fmt) {\r\n            return function () {\r\n                editor.execCommand('mceToggleFormat', false, fmt);\r\n            };\r\n        };\r\n        var registerFormatButtons = function (editor) {\r\n            global$b.each([\r\n                {\r\n                    name: 'bold',\r\n                    text: 'Bold',\r\n                    icon: 'bold'\r\n                },\r\n                {\r\n                    name: 'italic',\r\n                    text: 'Italic',\r\n                    icon: 'italic'\r\n                },\r\n                {\r\n                    name: 'underline',\r\n                    text: 'Underline',\r\n                    icon: 'underline'\r\n                },\r\n                {\r\n                    name: 'strikethrough',\r\n                    text: 'Strikethrough',\r\n                    icon: 'strike-through'\r\n                },\r\n                {\r\n                    name: 'subscript',\r\n                    text: 'Subscript',\r\n                    icon: 'subscript'\r\n                },\r\n                {\r\n                    name: 'superscript',\r\n                    text: 'Superscript',\r\n                    icon: 'superscript'\r\n                }\r\n            ], function (btn, idx) {\r\n                editor.ui.registry.addToggleButton(btn.name, {\r\n                    tooltip: btn.text,\r\n                    icon: btn.icon,\r\n                    onSetup: onSetupFormatToggle(editor, btn.name),\r\n                    onAction: toggleFormat(editor, btn.name)\r\n                });\r\n            });\r\n            for (var i = 1; i <= 6; i++) {\r\n                var name = 'h' + i;\r\n                editor.ui.registry.addToggleButton(name, {\r\n                    text: name.toUpperCase(),\r\n                    tooltip: 'Heading ' + i,\r\n                    onSetup: onSetupFormatToggle(editor, name),\r\n                    onAction: toggleFormat(editor, name)\r\n                });\r\n            }\r\n        };\r\n        var registerCommandButtons = function (editor) {\r\n            global$b.each([\r\n                {\r\n                    name: 'cut',\r\n                    text: 'Cut',\r\n                    action: 'Cut',\r\n                    icon: 'cut'\r\n                },\r\n                {\r\n                    name: 'copy',\r\n                    text: 'Copy',\r\n                    action: 'Copy',\r\n                    icon: 'copy'\r\n                },\r\n                {\r\n                    name: 'paste',\r\n                    text: 'Paste',\r\n                    action: 'Paste',\r\n                    icon: 'paste'\r\n                },\r\n                {\r\n                    name: 'help',\r\n                    text: 'Help',\r\n                    action: 'mceHelp',\r\n                    icon: 'help'\r\n                },\r\n                {\r\n                    name: 'selectall',\r\n                    text: 'Select all',\r\n                    action: 'SelectAll',\r\n                    icon: 'select-all'\r\n                },\r\n                {\r\n                    name: 'newdocument',\r\n                    text: 'New document',\r\n                    action: 'mceNewDocument',\r\n                    icon: 'new-document'\r\n                },\r\n                {\r\n                    name: 'removeformat',\r\n                    text: 'Clear formatting',\r\n                    action: 'RemoveFormat',\r\n                    icon: 'remove-formatting'\r\n                },\r\n                {\r\n                    name: 'remove',\r\n                    text: 'Remove',\r\n                    action: 'Delete',\r\n                    icon: 'remove'\r\n                }\r\n            ], function (btn) {\r\n                editor.ui.registry.addButton(btn.name, {\r\n                    tooltip: btn.text,\r\n                    icon: btn.icon,\r\n                    onAction: function () {\r\n                        return editor.execCommand(btn.action);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var registerCommandToggleButtons = function (editor) {\r\n            global$b.each([{\r\n                    name: 'blockquote',\r\n                    text: 'Blockquote',\r\n                    action: 'mceBlockQuote',\r\n                    icon: 'quote'\r\n                }], function (btn) {\r\n                editor.ui.registry.addToggleButton(btn.name, {\r\n                    tooltip: btn.text,\r\n                    icon: btn.icon,\r\n                    onAction: function () {\r\n                        return editor.execCommand(btn.action);\r\n                    },\r\n                    onSetup: onSetupFormatToggle(editor, btn.name)\r\n                });\r\n            });\r\n        };\r\n        var registerButtons = function (editor) {\r\n            registerFormatButtons(editor);\r\n            registerCommandButtons(editor);\r\n            registerCommandToggleButtons(editor);\r\n        };\r\n        var registerMenuItems = function (editor) {\r\n            global$b.each([\r\n                {\r\n                    name: 'bold',\r\n                    text: 'Bold',\r\n                    action: 'Bold',\r\n                    icon: 'bold',\r\n                    shortcut: 'Meta+B'\r\n                },\r\n                {\r\n                    name: 'italic',\r\n                    text: 'Italic',\r\n                    action: 'Italic',\r\n                    icon: 'italic',\r\n                    shortcut: 'Meta+I'\r\n                },\r\n                {\r\n                    name: 'underline',\r\n                    text: 'Underline',\r\n                    action: 'Underline',\r\n                    icon: 'underline',\r\n                    shortcut: 'Meta+U'\r\n                },\r\n                {\r\n                    name: 'strikethrough',\r\n                    text: 'Strikethrough',\r\n                    action: 'Strikethrough',\r\n                    icon: 'strike-through',\r\n                    shortcut: ''\r\n                },\r\n                {\r\n                    name: 'subscript',\r\n                    text: 'Subscript',\r\n                    action: 'Subscript',\r\n                    icon: 'subscript',\r\n                    shortcut: ''\r\n                },\r\n                {\r\n                    name: 'superscript',\r\n                    text: 'Superscript',\r\n                    action: 'Superscript',\r\n                    icon: 'superscript',\r\n                    shortcut: ''\r\n                },\r\n                {\r\n                    name: 'removeformat',\r\n                    text: 'Clear formatting',\r\n                    action: 'RemoveFormat',\r\n                    icon: 'remove-formatting',\r\n                    shortcut: ''\r\n                },\r\n                {\r\n                    name: 'newdocument',\r\n                    text: 'New document',\r\n                    action: 'mceNewDocument',\r\n                    icon: 'new-document',\r\n                    shortcut: ''\r\n                },\r\n                {\r\n                    name: 'cut',\r\n                    text: 'Cut',\r\n                    action: 'Cut',\r\n                    icon: 'cut',\r\n                    shortcut: 'Meta+X'\r\n                },\r\n                {\r\n                    name: 'copy',\r\n                    text: 'Copy',\r\n                    action: 'Copy',\r\n                    icon: 'copy',\r\n                    shortcut: 'Meta+C'\r\n                },\r\n                {\r\n                    name: 'paste',\r\n                    text: 'Paste',\r\n                    action: 'Paste',\r\n                    icon: 'paste',\r\n                    shortcut: 'Meta+V'\r\n                },\r\n                {\r\n                    name: 'selectall',\r\n                    text: 'Select all',\r\n                    action: 'SelectAll',\r\n                    icon: 'select-all',\r\n                    shortcut: 'Meta+A'\r\n                }\r\n            ], function (btn) {\r\n                editor.ui.registry.addMenuItem(btn.name, {\r\n                    text: btn.text,\r\n                    icon: btn.icon,\r\n                    shortcut: btn.shortcut,\r\n                    onAction: function () {\r\n                        return editor.execCommand(btn.action);\r\n                    }\r\n                });\r\n            });\r\n            editor.ui.registry.addMenuItem('codeformat', {\r\n                text: 'Code',\r\n                icon: 'sourcecode',\r\n                onAction: toggleFormat(editor, 'code')\r\n            });\r\n        };\r\n        var register$6 = function (editor) {\r\n            registerButtons(editor);\r\n            registerMenuItems(editor);\r\n        };\r\n        var SimpleControls = { register: register$6 };\r\n        var toggleUndoRedoState = function (api, editor, type) {\r\n            var checkState = function () {\r\n                return editor.undoManager ? editor.undoManager[type]() : false;\r\n            };\r\n            var onUndoStateChange = function () {\r\n                api.setDisabled(editor.readonly || !checkState());\r\n            };\r\n            api.setDisabled(!checkState());\r\n            editor.on('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', onUndoStateChange);\r\n            return function () {\r\n                return editor.off('Undo Redo AddUndo TypingUndo ClearUndos SwitchMode', onUndoStateChange);\r\n            };\r\n        };\r\n        var registerMenuItems$1 = function (editor) {\r\n            editor.ui.registry.addMenuItem('undo', {\r\n                text: 'Undo',\r\n                icon: 'undo',\r\n                shortcut: 'Meta+Z',\r\n                onSetup: function (api) {\r\n                    return toggleUndoRedoState(api, editor, 'hasUndo');\r\n                },\r\n                onAction: function () {\r\n                    return editor.execCommand('undo');\r\n                }\r\n            });\r\n            editor.ui.registry.addMenuItem('redo', {\r\n                text: 'Redo',\r\n                icon: 'redo',\r\n                shortcut: 'Meta+Y',\r\n                onSetup: function (api) {\r\n                    return toggleUndoRedoState(api, editor, 'hasRedo');\r\n                },\r\n                onAction: function () {\r\n                    return editor.execCommand('redo');\r\n                }\r\n            });\r\n        };\r\n        var registerButtons$1 = function (editor) {\r\n            editor.ui.registry.addButton('undo', {\r\n                tooltip: 'Undo',\r\n                icon: 'undo',\r\n                onSetup: function (api) {\r\n                    return toggleUndoRedoState(api, editor, 'hasUndo');\r\n                },\r\n                onAction: function () {\r\n                    return editor.execCommand('undo');\r\n                }\r\n            });\r\n            editor.ui.registry.addButton('redo', {\r\n                tooltip: 'Redo',\r\n                icon: 'redo',\r\n                onSetup: function (api) {\r\n                    return toggleUndoRedoState(api, editor, 'hasRedo');\r\n                },\r\n                onAction: function () {\r\n                    return editor.execCommand('redo');\r\n                }\r\n            });\r\n        };\r\n        var register$7 = function (editor) {\r\n            registerMenuItems$1(editor);\r\n            registerButtons$1(editor);\r\n        };\r\n        var UndoRedo = { register: register$7 };\r\n        var toggleVisualAidState = function (api, editor) {\r\n            api.setActive(editor.hasVisual);\r\n            var onVisualAid = function (e) {\r\n                api.setActive(e.hasVisual);\r\n            };\r\n            editor.on('VisualAid', onVisualAid);\r\n            return function () {\r\n                return editor.off('VisualAid', onVisualAid);\r\n            };\r\n        };\r\n        var registerMenuItems$2 = function (editor) {\r\n            editor.ui.registry.addToggleMenuItem('visualaid', {\r\n                text: 'Visual aids',\r\n                onSetup: function (api) {\r\n                    return toggleVisualAidState(api, editor);\r\n                },\r\n                onAction: function () {\r\n                    editor.execCommand('mceToggleVisualAid');\r\n                }\r\n            });\r\n        };\r\n        var registerToolbarButton = function (editor) {\r\n            editor.ui.registry.addButton('visualaid', {\r\n                tooltip: 'Visual aids',\r\n                text: 'Visual aids',\r\n                onAction: function () {\r\n                    return editor.execCommand('mceToggleVisualAid');\r\n                }\r\n            });\r\n        };\r\n        var register$8 = function (editor) {\r\n            registerToolbarButton(editor);\r\n            registerMenuItems$2(editor);\r\n        };\r\n        var VisualAid = { register: register$8 };\r\n        var toggleOutdentState = function (api, editor) {\r\n            api.setDisabled(!editor.queryCommandState('outdent'));\r\n            var onNodeChange = function () {\r\n                api.setDisabled(!editor.queryCommandState('outdent'));\r\n            };\r\n            editor.on('NodeChange', onNodeChange);\r\n            return function () {\r\n                return editor.off('NodeChange', onNodeChange);\r\n            };\r\n        };\r\n        var registerButtons$2 = function (editor) {\r\n            editor.ui.registry.addButton('outdent', {\r\n                tooltip: 'Decrease indent',\r\n                icon: 'outdent',\r\n                onSetup: function (api) {\r\n                    return toggleOutdentState(api, editor);\r\n                },\r\n                onAction: function () {\r\n                    return editor.execCommand('outdent');\r\n                }\r\n            });\r\n            editor.ui.registry.addButton('indent', {\r\n                tooltip: 'Increase indent',\r\n                icon: 'indent',\r\n                onAction: function () {\r\n                    return editor.execCommand('indent');\r\n                }\r\n            });\r\n        };\r\n        var register$9 = function (editor) {\r\n            registerButtons$2(editor);\r\n        };\r\n        var IndentOutdent = { register: register$9 };\r\n        var register$a = function (editor, backstage) {\r\n            alignSelectMenu(editor, backstage);\r\n            fontSelectMenu(editor, backstage);\r\n            styleSelectMenu(editor, backstage);\r\n            formatSelectMenu(editor, backstage);\r\n            fontsizeSelectMenu(editor, backstage);\r\n        };\r\n        var ComplexControls = { register: register$a };\r\n        var setup$8 = function (editor, backstage) {\r\n            AlignmentButtons.register(editor);\r\n            SimpleControls.register(editor);\r\n            ComplexControls.register(editor, backstage);\r\n            UndoRedo.register(editor);\r\n            ColorSwatch.register(editor);\r\n            VisualAid.register(editor);\r\n            IndentOutdent.register(editor);\r\n        };\r\n        var FormatControls = { setup: setup$8 };\r\n        var AriaLabel = {\r\n            labelledBy: function (labelledElement, labelElement) {\r\n                var labelId = Option.from(get$2(labelledElement, 'id')).fold(function () {\r\n                    var id = generate$1('dialog-label');\r\n                    set$1(labelElement, 'id', id);\r\n                    return id;\r\n                }, identity);\r\n                set$1(labelledElement, 'aria-labelledby', labelId);\r\n            }\r\n        };\r\n        var schema$s = constant([\r\n            strict$1('lazySink'),\r\n            option('dragBlockClass'),\r\n            defaulted$1('useTabstopAt', constant(true)),\r\n            defaulted$1('eventOrder', {}),\r\n            field$1('modalBehaviours', [Keying]),\r\n            onKeyboardHandler('onExecute'),\r\n            onStrictKeyboardHandler('onEscape')\r\n        ]);\r\n        var basic$1 = { sketch: identity };\r\n        var parts$d = constant([\r\n            optional({\r\n                name: 'draghandle',\r\n                overrides: function (detail, spec) {\r\n                    return {\r\n                        behaviours: derive$1([Dragging.config({\r\n                                mode: 'mouse',\r\n                                getTarget: function (handle) {\r\n                                    return ancestor$2(handle, '[role=\"dialog\"]').getOr(handle);\r\n                                },\r\n                                blockerClass: detail.dragBlockClass.getOrDie(new Error('The drag blocker class was not specified for a dialog with a drag handle: \\n' + Json.stringify(spec, null, 2)).message)\r\n                            })])\r\n                    };\r\n                }\r\n            }),\r\n            required({\r\n                schema: [strict$1('dom')],\r\n                name: 'title'\r\n            }),\r\n            required({\r\n                factory: basic$1,\r\n                schema: [strict$1('dom')],\r\n                name: 'close'\r\n            }),\r\n            required({\r\n                factory: basic$1,\r\n                schema: [strict$1('dom')],\r\n                name: 'body'\r\n            }),\r\n            optional({\r\n                factory: basic$1,\r\n                schema: [strict$1('dom')],\r\n                name: 'footer'\r\n            }),\r\n            external$1({\r\n                factory: {\r\n                    sketch: function (spec, detail) {\r\n                        return __assign({}, spec, {\r\n                            dom: detail.dom,\r\n                            components: detail.components\r\n                        });\r\n                    }\r\n                },\r\n                schema: [\r\n                    defaulted$1('dom', {\r\n                        tag: 'div',\r\n                        styles: {\r\n                            position: 'fixed',\r\n                            left: '0px',\r\n                            top: '0px',\r\n                            right: '0px',\r\n                            bottom: '0px'\r\n                        }\r\n                    }),\r\n                    defaulted$1('components', [])\r\n                ],\r\n                name: 'blocker'\r\n            })\r\n        ]);\r\n        var describedBy = function (describedElement, describeElement) {\r\n            var describeId = Option.from(get$2(describedElement, 'id')).fold(function () {\r\n                var id = generate$1('dialog-describe');\r\n                set$1(describeElement, 'id', id);\r\n                return id;\r\n            }, identity);\r\n            set$1(describedElement, 'aria-describedby', describeId);\r\n        };\r\n        var factory$g = function (detail, components, spec, externals) {\r\n            var dialogBusyEvent = generate$1('alloy.dialog.busy');\r\n            var dialogIdleEvent = generate$1('alloy.dialog.idle');\r\n            var busyBehaviours = derive$1([\r\n                Keying.config({\r\n                    mode: 'special',\r\n                    onTab: function () {\r\n                        return Option.some(true);\r\n                    },\r\n                    onShiftTab: function () {\r\n                        return Option.some(true);\r\n                    }\r\n                }),\r\n                Focusing.config({})\r\n            ]);\r\n            var showDialog = function (dialog) {\r\n                var sink = detail.lazySink(dialog).getOrDie();\r\n                var busyComp = Cell(Option.none());\r\n                var externalBlocker = externals.blocker();\r\n                var blocker = sink.getSystem().build(__assign({}, externalBlocker, {\r\n                    components: externalBlocker.components.concat([premade$1(dialog)]),\r\n                    behaviours: derive$1([config('dialog-blocker-events', [\r\n                            run(dialogIdleEvent, function (blocker, se) {\r\n                                if (has$1(dialog.element(), 'aria-busy')) {\r\n                                    remove$1(dialog.element(), 'aria-busy');\r\n                                    busyComp.get().each(function (bc) {\r\n                                        return Replacing.remove(dialog, bc);\r\n                                    });\r\n                                }\r\n                            }),\r\n                            run(dialogBusyEvent, function (blocker, se) {\r\n                                set$1(dialog.element(), 'aria-busy', 'true');\r\n                                var getBusySpec = se.event().getBusySpec();\r\n                                busyComp.get().each(function (bc) {\r\n                                    Replacing.remove(dialog, bc);\r\n                                });\r\n                                var busySpec = getBusySpec(dialog, busyBehaviours);\r\n                                var busy = blocker.getSystem().build(busySpec);\r\n                                busyComp.set(Option.some(busy));\r\n                                Replacing.append(dialog, premade$1(busy));\r\n                                if (busy.hasConfigured(Keying)) {\r\n                                    Keying.focusIn(busy);\r\n                                }\r\n                            })\r\n                        ])])\r\n                }));\r\n                attach(sink, blocker);\r\n                Keying.focusIn(dialog);\r\n            };\r\n            var hideDialog = function (dialog) {\r\n                parent(dialog.element()).each(function (blockerDom) {\r\n                    dialog.getSystem().getByDom(blockerDom).each(function (blocker) {\r\n                        detach(blocker);\r\n                    });\r\n                });\r\n            };\r\n            var getDialogBody = function (dialog) {\r\n                return getPartOrDie(dialog, detail, 'body');\r\n            };\r\n            var getDialogFooter = function (dialog) {\r\n                return getPartOrDie(dialog, detail, 'footer');\r\n            };\r\n            var setBusy = function (dialog, getBusySpec) {\r\n                emitWith(dialog, dialogBusyEvent, { getBusySpec: getBusySpec });\r\n            };\r\n            var setIdle = function (dialog) {\r\n                emit(dialog, dialogIdleEvent);\r\n            };\r\n            var modalEventsId = generate$1('modal-events');\r\n            var eventOrder = __assign({}, detail.eventOrder, { 'alloy.system.attached': [modalEventsId].concat(detail.eventOrder['alloy.system.attached'] || []) });\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                apis: {\r\n                    show: showDialog,\r\n                    hide: hideDialog,\r\n                    getBody: getDialogBody,\r\n                    getFooter: getDialogFooter,\r\n                    setIdle: setIdle,\r\n                    setBusy: setBusy\r\n                },\r\n                eventOrder: eventOrder,\r\n                domModification: {\r\n                    attributes: {\r\n                        'role': 'dialog',\r\n                        'aria-modal': 'true'\r\n                    }\r\n                },\r\n                behaviours: augment(detail.modalBehaviours, [\r\n                    Replacing.config({}),\r\n                    Keying.config({\r\n                        mode: 'cyclic',\r\n                        onEnter: detail.onExecute,\r\n                        onEscape: detail.onEscape,\r\n                        useTabstopAt: detail.useTabstopAt\r\n                    }),\r\n                    config(modalEventsId, [runOnAttached(function (c) {\r\n                            AriaLabel.labelledBy(c.element(), getPartOrDie(c, detail, 'title').element());\r\n                            describedBy(c.element(), getPartOrDie(c, detail, 'body').element());\r\n                        })])\r\n                ])\r\n            };\r\n        };\r\n        var ModalDialog = composite$1({\r\n            name: 'ModalDialog',\r\n            configFields: schema$s(),\r\n            partFields: parts$d(),\r\n            factory: factory$g,\r\n            apis: {\r\n                show: function (apis, dialog) {\r\n                    apis.show(dialog);\r\n                },\r\n                hide: function (apis, dialog) {\r\n                    apis.hide(dialog);\r\n                },\r\n                getBody: function (apis, dialog) {\r\n                    return apis.getBody(dialog);\r\n                },\r\n                getFooter: function (apis, dialog) {\r\n                    return apis.getFooter(dialog);\r\n                },\r\n                setBusy: function (apis, dialog, getBusySpec) {\r\n                    apis.setBusy(dialog, getBusySpec);\r\n                },\r\n                setIdle: function (apis, dialog) {\r\n                    apis.setIdle(dialog);\r\n                }\r\n            }\r\n        });\r\n        var alertBannerFields = [\r\n            strictString('type'),\r\n            strictString('text'),\r\n            strictStringEnum('level', [\r\n                'info',\r\n                'warn',\r\n                'error',\r\n                'success'\r\n            ]),\r\n            strictString('icon'),\r\n            defaulted$1('url', '')\r\n        ];\r\n        var createBarFields = function (itemsField) {\r\n            return [\r\n                strictString('type'),\r\n                itemsField\r\n            ];\r\n        };\r\n        var buttonFields = [\r\n            strictString('type'),\r\n            strictString('text'),\r\n            defaultedBoolean('primary', false),\r\n            field('name', 'name', defaultedThunk(function () {\r\n                return generate$1('button-name');\r\n            }), string),\r\n            optionString('icon')\r\n        ];\r\n        var checkboxFields = [\r\n            strictString('type'),\r\n            strictString('name'),\r\n            strictString('label')\r\n        ];\r\n        var checkboxDataProcessor = boolean;\r\n        var formComponentFields = [\r\n            strictString('type'),\r\n            strictString('name'),\r\n            optionString('label')\r\n        ];\r\n        var colorInputFields = formComponentFields;\r\n        var colorInputDataProcessor = string;\r\n        var colorPickerFields = formComponentFields;\r\n        var colorPickerDataProcessor = string;\r\n        var dropZoneFields = formComponentFields;\r\n        var dropZoneDataProcessor = arrOfVal();\r\n        var createGridFields = function (itemsField) {\r\n            return [\r\n                strictString('type'),\r\n                strictNumber('columns'),\r\n                itemsField\r\n            ];\r\n        };\r\n        var iframeFields = formComponentFields.concat([defaultedBoolean('sandboxed', true)]);\r\n        var iframeDataProcessor = string;\r\n        var inputFields = formComponentFields.concat([optionString('placeholder')]);\r\n        var inputDataProcessor = string;\r\n        var selectBoxFields = formComponentFields.concat([\r\n            strictArrayOfObj('items', [\r\n                strictString('text'),\r\n                strictString('value')\r\n            ]),\r\n            defaultedNumber('size', 1)\r\n        ]);\r\n        var selectBoxDataProcessor = string;\r\n        var sizeInputFields = formComponentFields.concat([defaultedBoolean('constrain', true)]);\r\n        var sizeInputDataProcessor = objOf([\r\n            strictString('width'),\r\n            strictString('height')\r\n        ]);\r\n        var textAreaFields = formComponentFields.concat([optionString('placeholder')]);\r\n        var textAreaDataProcessor = string;\r\n        var urlInputFields = formComponentFields.concat([defaultedStringEnum('filetype', 'file', [\r\n                'image',\r\n                'media',\r\n                'file'\r\n            ])]);\r\n        var urlInputDataProcessor = objOf([\r\n            strictString('value'),\r\n            defaulted$1('meta', {})\r\n        ]);\r\n        var customEditorFields = formComponentFields.concat([\r\n            strictString('type'),\r\n            defaultedString('tag', 'textarea'),\r\n            strictFunction('init')\r\n        ]);\r\n        var customEditorDataProcessor = string;\r\n        var htmlPanelFields = [\r\n            strictString('type'),\r\n            strictString('html'),\r\n            defaultedStringEnum('presets', 'presentation', [\r\n                'presentation',\r\n                'document'\r\n            ])\r\n        ];\r\n        var imageToolsFields = formComponentFields.concat([strictOf('currentState', objOf([\r\n                strict$1('blob'),\r\n                strictString('url')\r\n            ]))]);\r\n        var collectionFields = formComponentFields.concat([defaulted$1('columns', 'auto')]);\r\n        var collectionDataProcessor = arrOfObj$1([\r\n            strictString('value'),\r\n            strictString('text'),\r\n            strictString('icon')\r\n        ]);\r\n        var createLabelFields = function (itemsField) {\r\n            return [\r\n                strictString('type'),\r\n                strictString('label'),\r\n                itemsField\r\n            ];\r\n        };\r\n        var tableFields = [\r\n            strictString('type'),\r\n            strictArrayOf('header', string),\r\n            strictArrayOf('cells', arrOf(string))\r\n        ];\r\n        var createItemsField = function (name) {\r\n            return field('items', 'items', strict(), arrOf(valueOf(function (v) {\r\n                return asRaw('Checking item of ' + name, itemSchema$2, v).fold(function (sErr) {\r\n                    return Result.error(formatError(sErr));\r\n                }, function (passValue) {\r\n                    return Result.value(passValue);\r\n                });\r\n            })));\r\n        };\r\n        var itemSchema$2 = choose$1('type', {\r\n            alertbanner: alertBannerFields,\r\n            bar: createBarFields(createItemsField('bar')),\r\n            button: buttonFields,\r\n            checkbox: checkboxFields,\r\n            colorinput: colorInputFields,\r\n            colorpicker: colorPickerFields,\r\n            dropzone: dropZoneFields,\r\n            grid: createGridFields(createItemsField('grid')),\r\n            iframe: iframeFields,\r\n            input: inputFields,\r\n            selectbox: selectBoxFields,\r\n            sizeinput: sizeInputFields,\r\n            textarea: textAreaFields,\r\n            urlinput: urlInputFields,\r\n            customeditor: customEditorFields,\r\n            htmlpanel: htmlPanelFields,\r\n            imagetools: imageToolsFields,\r\n            collection: collectionFields,\r\n            label: createLabelFields(createItemsField('label')),\r\n            table: tableFields\r\n        });\r\n        var panelFields = [\r\n            strictString('type'),\r\n            strictArrayOf('items', itemSchema$2)\r\n        ];\r\n        var tabFields = [\r\n            strictString('title'),\r\n            strictArrayOf('items', itemSchema$2)\r\n        ];\r\n        var tabPanelFields = [\r\n            strictString('type'),\r\n            strictArrayOfObj('tabs', tabFields)\r\n        ];\r\n        var dialogButtonFields = [\r\n            field('name', 'name', defaultedThunk(function () {\r\n                return generate$1('button-name');\r\n            }), string),\r\n            strictString('text'),\r\n            optionString('icon'),\r\n            defaultedStringEnum('align', 'end', [\r\n                'start',\r\n                'end'\r\n            ]),\r\n            defaultedBoolean('primary', false),\r\n            defaultedBoolean('disabled', false)\r\n        ];\r\n        var dialogButtonSchema = objOf([strictStringEnum('type', [\r\n                'submit',\r\n                'cancel',\r\n                'custom'\r\n            ])].concat(dialogButtonFields));\r\n        var dialogSchema = objOf([\r\n            strictString('title'),\r\n            strictOf('body', choose$1('type', {\r\n                panel: panelFields,\r\n                tabpanel: tabPanelFields\r\n            })),\r\n            defaultedString('size', 'normal'),\r\n            strictArrayOf('buttons', dialogButtonSchema),\r\n            defaulted$1('initialData', {}),\r\n            defaultedFunction('onAction', noop),\r\n            defaultedFunction('onChange', noop),\r\n            defaultedFunction('onSubmit', noop),\r\n            defaultedFunction('onClose', noop),\r\n            defaultedFunction('onCancel', noop),\r\n            defaulted$1('onTabChange', noop)\r\n        ]);\r\n        var createDialog = function (spec) {\r\n            return asRaw('dialog', dialogSchema, spec);\r\n        };\r\n        var getAllObjects = function (obj) {\r\n            if (isObject(obj)) {\r\n                return [obj].concat(bind(values(obj), getAllObjects));\r\n            }\r\n            else if (isArray(obj)) {\r\n                return bind(obj, getAllObjects);\r\n            }\r\n            else {\r\n                return [];\r\n            }\r\n        };\r\n        var isNamedItem = function (obj) {\r\n            return isString(obj.type) && isString(obj.name);\r\n        };\r\n        var dataProcessors = {\r\n            checkbox: checkboxDataProcessor,\r\n            colorinput: colorInputDataProcessor,\r\n            colorpicker: colorPickerDataProcessor,\r\n            dropzone: dropZoneDataProcessor,\r\n            input: inputDataProcessor,\r\n            iframe: iframeDataProcessor,\r\n            sizeinput: sizeInputDataProcessor,\r\n            selectbox: selectBoxDataProcessor,\r\n            size: sizeInputDataProcessor,\r\n            textarea: textAreaDataProcessor,\r\n            urlinput: urlInputDataProcessor,\r\n            customeditor: customEditorDataProcessor,\r\n            collection: collectionDataProcessor\r\n        };\r\n        var getDataProcessor = function (item) {\r\n            return Option.from(dataProcessors[item.type]);\r\n        };\r\n        var getNamedItems = function (structure) {\r\n            return filter(getAllObjects(structure), isNamedItem);\r\n        };\r\n        var createDataValidator = function (structure) {\r\n            var fields = bind(getNamedItems(structure), function (item) {\r\n                return getDataProcessor(item).fold(function () {\r\n                    return [];\r\n                }, function (schema) {\r\n                    return [strictOf(item.name, schema)];\r\n                });\r\n            });\r\n            return objOf(fields);\r\n        };\r\n        var urlDialogButtonSchema = objOf([strictStringEnum('type', [\r\n                'cancel',\r\n                'custom'\r\n            ])].concat(dialogButtonFields));\r\n        var urlDialogSchema = objOf([\r\n            strictString('title'),\r\n            strictString('url'),\r\n            optionNumber('height'),\r\n            optionNumber('width'),\r\n            optionArrayOf('buttons', urlDialogButtonSchema),\r\n            defaultedFunction('onAction', noop),\r\n            defaultedFunction('onCancel', noop),\r\n            defaultedFunction('onClose', noop),\r\n            defaultedFunction('onMessage', noop)\r\n        ]);\r\n        var createUrlDialog = function (spec) {\r\n            return asRaw('dialog', urlDialogSchema, spec);\r\n        };\r\n        var extract$1 = function (structure) {\r\n            var internalDialog = getOrDie$1(createDialog(structure));\r\n            var dataValidator = createDataValidator(structure);\r\n            var initialData = structure.initialData;\r\n            return {\r\n                internalDialog: internalDialog,\r\n                dataValidator: dataValidator,\r\n                initialData: initialData\r\n            };\r\n        };\r\n        var DialogManager = {\r\n            open: function (factory, structure) {\r\n                var extraction = extract$1(structure);\r\n                return factory(extraction.internalDialog, extraction.initialData, extraction.dataValidator);\r\n            },\r\n            openUrl: function (factory, structure) {\r\n                var internalDialog = getOrDie$1(createUrlDialog(structure));\r\n                return factory(internalDialog);\r\n            },\r\n            redial: function (structure) {\r\n                return extract$1(structure);\r\n            }\r\n        };\r\n        var toValidValues = function (values) {\r\n            var errors = [];\r\n            var result = {};\r\n            each$1(values, function (value, name) {\r\n                value.fold(function () {\r\n                    errors.push(name);\r\n                }, function (v) {\r\n                    result[name] = v;\r\n                });\r\n            });\r\n            return errors.length > 0 ? Result.error(errors) : Result.value(result);\r\n        };\r\n        var renderBodyPanel = function (spec, backstage) {\r\n            var memForm = record(Form.sketch(function (parts) {\r\n                return {\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-form']\r\n                    },\r\n                    components: map(spec.items, function (item) {\r\n                        return interpretInForm(parts, item, backstage);\r\n                    })\r\n                };\r\n            }));\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__body']\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-dialog__body-content']\r\n                        },\r\n                        components: [memForm.asSpec()]\r\n                    }],\r\n                behaviours: derive$1([\r\n                    Keying.config({\r\n                        mode: 'acyclic',\r\n                        useTabstopAt: not(NavigableObject.isPseudoStop)\r\n                    }),\r\n                    ComposingConfigs.memento(memForm),\r\n                    RepresentingConfigs.memento(memForm, {\r\n                        postprocess: function (formValue) {\r\n                            return toValidValues(formValue).fold(function (err) {\r\n                                domGlobals.console.error(err);\r\n                                return {};\r\n                            }, function (vals) {\r\n                                return vals;\r\n                            });\r\n                        }\r\n                    })\r\n                ])\r\n            };\r\n        };\r\n        var factory$h = function (detail, spec) {\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: detail.components,\r\n                events: events$7(detail.action),\r\n                behaviours: augment(detail.tabButtonBehaviours, [\r\n                    Focusing.config({}),\r\n                    Keying.config({\r\n                        mode: 'execution',\r\n                        useSpace: true,\r\n                        useEnter: true\r\n                    }),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'memory',\r\n                            initialValue: detail.value\r\n                        }\r\n                    })\r\n                ]),\r\n                domModification: detail.domModification\r\n            };\r\n        };\r\n        var TabButton = single$2({\r\n            name: 'TabButton',\r\n            configFields: [\r\n                defaulted$1('uid', undefined),\r\n                strict$1('value'),\r\n                field('dom', 'dom', mergeWithThunk(function (spec) {\r\n                    return {\r\n                        attributes: {\r\n                            'role': 'tab',\r\n                            'id': generate$1('aria'),\r\n                            'aria-selected': 'false'\r\n                        }\r\n                    };\r\n                }), anyValue$1()),\r\n                option('action'),\r\n                defaulted$1('domModification', {}),\r\n                field$1('tabButtonBehaviours', [\r\n                    Focusing,\r\n                    Keying,\r\n                    Representing\r\n                ]),\r\n                strict$1('view')\r\n            ],\r\n            factory: factory$h\r\n        });\r\n        var schema$t = constant([\r\n            strict$1('tabs'),\r\n            strict$1('dom'),\r\n            defaulted$1('clickToDismiss', false),\r\n            field$1('tabbarBehaviours', [\r\n                Highlighting,\r\n                Keying\r\n            ]),\r\n            markers([\r\n                'tabClass',\r\n                'selectedClass'\r\n            ])\r\n        ]);\r\n        var tabsPart = group({\r\n            factory: TabButton,\r\n            name: 'tabs',\r\n            unit: 'tab',\r\n            overrides: function (barDetail, tabSpec) {\r\n                var dismissTab$1 = function (tabbar, button) {\r\n                    Highlighting.dehighlight(tabbar, button);\r\n                    emitWith(tabbar, dismissTab(), {\r\n                        tabbar: tabbar,\r\n                        button: button\r\n                    });\r\n                };\r\n                var changeTab$1 = function (tabbar, button) {\r\n                    Highlighting.highlight(tabbar, button);\r\n                    emitWith(tabbar, changeTab(), {\r\n                        tabbar: tabbar,\r\n                        button: button\r\n                    });\r\n                };\r\n                return {\r\n                    action: function (button) {\r\n                        var tabbar = button.getSystem().getByUid(barDetail.uid).getOrDie();\r\n                        var activeButton = Highlighting.isHighlighted(tabbar, button);\r\n                        var response = function () {\r\n                            if (activeButton && barDetail.clickToDismiss) {\r\n                                return dismissTab$1;\r\n                            }\r\n                            else if (!activeButton) {\r\n                                return changeTab$1;\r\n                            }\r\n                            else {\r\n                                return noop;\r\n                            }\r\n                        }();\r\n                        response(tabbar, button);\r\n                    },\r\n                    domModification: { classes: [barDetail.markers.tabClass] }\r\n                };\r\n            }\r\n        });\r\n        var parts$e = constant([tabsPart]);\r\n        var factory$i = function (detail, components, spec, externals) {\r\n            return {\r\n                'uid': detail.uid,\r\n                'dom': detail.dom,\r\n                'components': components,\r\n                'debug.sketcher': 'Tabbar',\r\n                domModification: { attributes: { role: 'tablist' } },\r\n                'behaviours': augment(detail.tabbarBehaviours, [\r\n                    Highlighting.config({\r\n                        highlightClass: detail.markers.selectedClass,\r\n                        itemClass: detail.markers.tabClass,\r\n                        onHighlight: function (tabbar, tab) {\r\n                            set$1(tab.element(), 'aria-selected', 'true');\r\n                        },\r\n                        onDehighlight: function (tabbar, tab) {\r\n                            set$1(tab.element(), 'aria-selected', 'false');\r\n                        }\r\n                    }),\r\n                    Keying.config({\r\n                        mode: 'flow',\r\n                        getInitial: function (tabbar) {\r\n                            return Highlighting.getHighlighted(tabbar).map(function (tab) {\r\n                                return tab.element();\r\n                            });\r\n                        },\r\n                        selector: '.' + detail.markers.tabClass,\r\n                        executeOnMove: true\r\n                    })\r\n                ])\r\n            };\r\n        };\r\n        var Tabbar = composite$1({\r\n            name: 'Tabbar',\r\n            configFields: schema$t(),\r\n            partFields: parts$e(),\r\n            factory: factory$i\r\n        });\r\n        var factory$j = function (detail, spec) {\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                behaviours: augment(detail.tabviewBehaviours, [Replacing.config({})]),\r\n                domModification: { attributes: { role: 'tabpanel' } }\r\n            };\r\n        };\r\n        var Tabview = single$2({\r\n            name: 'Tabview',\r\n            configFields: [field$1('tabviewBehaviours', [Replacing])],\r\n            factory: factory$j\r\n        });\r\n        var schema$u = constant([\r\n            defaulted$1('selectFirst', true),\r\n            onHandler('onChangeTab'),\r\n            onHandler('onDismissTab'),\r\n            defaulted$1('tabs', []),\r\n            field$1('tabSectionBehaviours', [])\r\n        ]);\r\n        var barPart = required({\r\n            factory: Tabbar,\r\n            schema: [\r\n                strict$1('dom'),\r\n                strictObjOf('markers', [\r\n                    strict$1('tabClass'),\r\n                    strict$1('selectedClass')\r\n                ])\r\n            ],\r\n            name: 'tabbar',\r\n            defaults: function (detail) {\r\n                return { tabs: detail.tabs };\r\n            }\r\n        });\r\n        var viewPart = required({\r\n            factory: Tabview,\r\n            name: 'tabview'\r\n        });\r\n        var parts$f = constant([\r\n            barPart,\r\n            viewPart\r\n        ]);\r\n        var factory$k = function (detail, components, spec, externals) {\r\n            var changeTab$1 = function (button) {\r\n                var tabValue = Representing.getValue(button);\r\n                getPart(button, detail, 'tabview').each(function (tabview) {\r\n                    var tabWithValue = find(detail.tabs, function (t) {\r\n                        return t.value === tabValue;\r\n                    });\r\n                    tabWithValue.each(function (tabData) {\r\n                        var panel = tabData.view();\r\n                        set$1(tabview.element(), 'aria-labelledby', get$2(button.element(), 'id'));\r\n                        Replacing.set(tabview, panel);\r\n                        detail.onChangeTab(tabview, button, panel);\r\n                    });\r\n                });\r\n            };\r\n            var changeTabBy = function (section, byPred) {\r\n                getPart(section, detail, 'tabbar').each(function (tabbar) {\r\n                    byPred(tabbar).each(emitExecute);\r\n                });\r\n            };\r\n            return {\r\n                uid: detail.uid,\r\n                dom: detail.dom,\r\n                components: components,\r\n                behaviours: get$b(detail.tabSectionBehaviours),\r\n                events: derive(flatten([\r\n                    detail.selectFirst ? [runOnAttached(function (section, simulatedEvent) {\r\n                            changeTabBy(section, Highlighting.getFirst);\r\n                        })] : [],\r\n                    [\r\n                        run(changeTab(), function (section, simulatedEvent) {\r\n                            var button = simulatedEvent.event().button();\r\n                            changeTab$1(button);\r\n                        }),\r\n                        run(dismissTab(), function (section, simulatedEvent) {\r\n                            var button = simulatedEvent.event().button();\r\n                            detail.onDismissTab(section, button);\r\n                        })\r\n                    ]\r\n                ])),\r\n                apis: {\r\n                    getViewItems: function (section) {\r\n                        return getPart(section, detail, 'tabview').map(function (tabview) {\r\n                            return Replacing.contents(tabview);\r\n                        }).getOr([]);\r\n                    },\r\n                    showTab: function (section, tabKey) {\r\n                        var getTabIfNotActive = function (tabbar) {\r\n                            var candidates = Highlighting.getCandidates(tabbar);\r\n                            var optTab = find(candidates, function (c) {\r\n                                return Representing.getValue(c) === tabKey;\r\n                            });\r\n                            return optTab.filter(function (tab) {\r\n                                return !Highlighting.isHighlighted(tabbar, tab);\r\n                            });\r\n                        };\r\n                        changeTabBy(section, getTabIfNotActive);\r\n                    }\r\n                }\r\n            };\r\n        };\r\n        var TabSection = composite$1({\r\n            name: 'TabSection',\r\n            configFields: schema$u(),\r\n            partFields: parts$f(),\r\n            factory: factory$k,\r\n            apis: {\r\n                getViewItems: function (apis, component) {\r\n                    return apis.getViewItems(component);\r\n                },\r\n                showTab: function (apis, component, tabKey) {\r\n                    apis.showTab(component, tabKey);\r\n                }\r\n            }\r\n        });\r\n        var measureHeights = function (allTabs, tabview, tabviewComp) {\r\n            return map(allTabs, function (tab, i) {\r\n                Replacing.set(tabviewComp, allTabs[i].view());\r\n                var rect = tabview.dom().getBoundingClientRect();\r\n                Replacing.set(tabviewComp, []);\r\n                return rect.height;\r\n            });\r\n        };\r\n        var getMaxHeight = function (heights) {\r\n            return head(sort(heights, function (a, b) {\r\n                if (a > b) {\r\n                    return -1;\r\n                }\r\n                else if (a < b) {\r\n                    return +1;\r\n                }\r\n                else {\r\n                    return 0;\r\n                }\r\n            }));\r\n        };\r\n        var getMaxTabviewHeight = function (dialog, dialogBody) {\r\n            var rootElm = ancestor$2(dialog, '.tox-dialog-wrap').getOr(dialog);\r\n            var isFixed = get$4(rootElm, 'position') === 'fixed';\r\n            var maxHeight;\r\n            if (isFixed) {\r\n                maxHeight = Math.max(domGlobals.document.documentElement.clientHeight, domGlobals.window.innerHeight);\r\n            }\r\n            else {\r\n                maxHeight = Math.max(domGlobals.document.documentElement.offsetHeight, domGlobals.document.documentElement.scrollHeight);\r\n            }\r\n            var dialogChrome = dialog.dom().getBoundingClientRect().height - dialogBody.dom().getBoundingClientRect().height;\r\n            return maxHeight - dialogChrome;\r\n        };\r\n        var showTab = function (allTabs, comp) {\r\n            head(allTabs).each(function (tab) {\r\n                return TabSection.showTab(comp, tab.value);\r\n            });\r\n        };\r\n        var updateTabviewHeight = function (dialogBody, tabview, maxTabHeight) {\r\n            ancestor$2(dialogBody, '[role=\"dialog\"]').each(function (dialog) {\r\n                maxTabHeight.get().map(function (height) {\r\n                    set$2(tabview, 'height', '0');\r\n                    return Math.min(height, getMaxTabviewHeight(dialog, dialogBody));\r\n                }).each(function (height) {\r\n                    set$2(tabview, 'height', height + 'px');\r\n                });\r\n            });\r\n        };\r\n        var setMode = function (allTabs) {\r\n            var smartTabHeight = function () {\r\n                var maxTabHeight = Cell(Option.none());\r\n                var extraEvents = [\r\n                    runOnAttached(function (comp) {\r\n                        descendant$2(comp.element(), '[role=\"tabpanel\"]').each(function (tabview) {\r\n                            set$2(tabview, 'visibility', 'hidden');\r\n                            comp.getSystem().getByDom(tabview).toOption().each(function (tabviewComp) {\r\n                                var heights = measureHeights(allTabs, tabview, tabviewComp);\r\n                                var maxTabHeightOpt = getMaxHeight(heights);\r\n                                maxTabHeight.set(maxTabHeightOpt);\r\n                            });\r\n                            updateTabviewHeight(comp.element(), tabview, maxTabHeight);\r\n                            remove$6(tabview, 'visibility');\r\n                            showTab(allTabs, comp);\r\n                            global$1.requestAnimationFrame(function () {\r\n                                updateTabviewHeight(comp.element(), tabview, maxTabHeight);\r\n                            });\r\n                        });\r\n                    }),\r\n                    run(windowResize(), function (comp) {\r\n                        descendant$2(comp.element(), '[role=\"tabpanel\"]').each(function (tabview) {\r\n                            updateTabviewHeight(comp.element(), tabview, maxTabHeight);\r\n                        });\r\n                    }),\r\n                    run(formResizeEvent, function (comp, se) {\r\n                        descendant$2(comp.element(), '[role=\"tabpanel\"]').each(function (tabview) {\r\n                            var oldFocus = active();\r\n                            set$2(tabview, 'visibility', 'hidden');\r\n                            var oldHeight = getRaw(tabview, 'height').map(function (h) {\r\n                                return parseInt(h, 10);\r\n                            });\r\n                            remove$6(tabview, 'height');\r\n                            var newHeight = tabview.dom().getBoundingClientRect().height;\r\n                            var hasGrown = oldHeight.forall(function (h) {\r\n                                return newHeight > h;\r\n                            });\r\n                            if (hasGrown) {\r\n                                maxTabHeight.set(Option.from(newHeight));\r\n                                updateTabviewHeight(comp.element(), tabview, maxTabHeight);\r\n                            }\r\n                            else {\r\n                                oldHeight.each(function (h) {\r\n                                    set$2(tabview, 'height', h + 'px');\r\n                                });\r\n                            }\r\n                            remove$6(tabview, 'visibility');\r\n                            oldFocus.each(focus$1);\r\n                        });\r\n                    })\r\n                ];\r\n                var selectFirst = false;\r\n                return {\r\n                    extraEvents: extraEvents,\r\n                    selectFirst: selectFirst\r\n                };\r\n            }();\r\n            var naiveTabHeight = function () {\r\n                var extraEvents = [];\r\n                var selectFirst = true;\r\n                return {\r\n                    extraEvents: extraEvents,\r\n                    selectFirst: selectFirst\r\n                };\r\n            }();\r\n            return {\r\n                smartTabHeight: smartTabHeight,\r\n                naiveTabHeight: naiveTabHeight\r\n            };\r\n        };\r\n        var SendDataToSectionChannel = 'send-data-to-section';\r\n        var SendDataToViewChannel = 'send-data-to-view';\r\n        var renderTabPanel = function (spec, backstage) {\r\n            var storedValue = Cell({});\r\n            var updateDataWithForm = function (form) {\r\n                var formData = Representing.getValue(form);\r\n                var validData = toValidValues(formData).getOr({});\r\n                var currentData = storedValue.get();\r\n                var newData = deepMerge(currentData, validData);\r\n                storedValue.set(newData);\r\n            };\r\n            var setDataOnForm = function (form) {\r\n                var tabData = storedValue.get();\r\n                Representing.setValue(form, tabData);\r\n            };\r\n            var oldTab = Cell(null);\r\n            var allTabs = map(spec.tabs, function (tab) {\r\n                return {\r\n                    value: tab.title,\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-dialog__body-nav-item'],\r\n                        innerHtml: backstage.shared.providers.translate(tab.title)\r\n                    },\r\n                    view: function () {\r\n                        return [Form.sketch(function (parts) {\r\n                                return {\r\n                                    dom: {\r\n                                        tag: 'div',\r\n                                        classes: ['tox-form']\r\n                                    },\r\n                                    components: map(tab.items, function (item) {\r\n                                        return interpretInForm(parts, item, backstage);\r\n                                    }),\r\n                                    formBehaviours: derive$1([\r\n                                        Keying.config({\r\n                                            mode: 'acyclic',\r\n                                            useTabstopAt: not(NavigableObject.isPseudoStop)\r\n                                        }),\r\n                                        config('TabView.form.events', [\r\n                                            runOnAttached(setDataOnForm),\r\n                                            runOnDetached(updateDataWithForm)\r\n                                        ]),\r\n                                        Receiving.config({\r\n                                            channels: wrapAll$1([\r\n                                                {\r\n                                                    key: SendDataToSectionChannel,\r\n                                                    value: { onReceive: updateDataWithForm }\r\n                                                },\r\n                                                {\r\n                                                    key: SendDataToViewChannel,\r\n                                                    value: { onReceive: setDataOnForm }\r\n                                                }\r\n                                            ])\r\n                                        })\r\n                                    ])\r\n                                };\r\n                            })];\r\n                    }\r\n                };\r\n            });\r\n            var tabMode = setMode(allTabs).smartTabHeight;\r\n            return TabSection.sketch({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__body']\r\n                },\r\n                onChangeTab: function (section, button, _viewItems) {\r\n                    var title = Representing.getValue(button);\r\n                    emitWith(section, formTabChangeEvent, {\r\n                        title: title,\r\n                        oldTitle: oldTab.get()\r\n                    });\r\n                    oldTab.set(title);\r\n                },\r\n                tabs: allTabs,\r\n                components: [\r\n                    TabSection.parts().tabbar({\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-dialog__body-nav']\r\n                        },\r\n                        components: [Tabbar.parts().tabs({})],\r\n                        markers: {\r\n                            tabClass: 'tox-tab',\r\n                            selectedClass: 'tox-dialog__body-nav-item--active'\r\n                        },\r\n                        tabbarBehaviours: derive$1([Tabstopping.config({})])\r\n                    }),\r\n                    TabSection.parts().tabview({\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-dialog__body-content']\r\n                        }\r\n                    })\r\n                ],\r\n                selectFirst: tabMode.selectFirst,\r\n                tabSectionBehaviours: derive$1([\r\n                    config('tabpanel', tabMode.extraEvents),\r\n                    Keying.config({ mode: 'acyclic' }),\r\n                    Composing.config({\r\n                        find: function (comp) {\r\n                            return head(TabSection.getViewItems(comp));\r\n                        }\r\n                    }),\r\n                    Representing.config({\r\n                        store: {\r\n                            mode: 'manual',\r\n                            getValue: function (tsection) {\r\n                                tsection.getSystem().broadcastOn([SendDataToSectionChannel], {});\r\n                                return storedValue.get();\r\n                            },\r\n                            setValue: function (tsection, value) {\r\n                                storedValue.set(value);\r\n                                tsection.getSystem().broadcastOn([SendDataToViewChannel], {});\r\n                            }\r\n                        }\r\n                    })\r\n                ])\r\n            });\r\n        };\r\n        var dialogChannel = generate$1('update-dialog');\r\n        var titleChannel = generate$1('update-title');\r\n        var bodyChannel = generate$1('update-body');\r\n        var footerChannel = generate$1('update-footer');\r\n        var bodySendMessageChannel = generate$1('body-send-message');\r\n        var renderBody = function (foo, id, backstage, ariaAttrs) {\r\n            var renderComponents = function (incoming) {\r\n                switch (incoming.body.type) {\r\n                    case 'tabpanel': {\r\n                        return [renderTabPanel({ tabs: incoming.body.tabs }, backstage)];\r\n                    }\r\n                    default: {\r\n                        return [renderBodyPanel({ items: incoming.body.items }, backstage)];\r\n                    }\r\n                }\r\n            };\r\n            var updateState = function (_comp, incoming) {\r\n                return Option.some({\r\n                    isTabPanel: function () {\r\n                        return incoming.body.type === 'tabpanel';\r\n                    }\r\n                });\r\n            };\r\n            var ariaAttributes = { 'aria-live': 'polite' };\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__content-js'],\r\n                    attributes: __assign({}, id.map(function (x) {\r\n                        return { id: x };\r\n                    }).getOr({}), ariaAttrs ? ariaAttributes : {})\r\n                },\r\n                components: [],\r\n                behaviours: derive$1([\r\n                    ComposingConfigs.childAt(0),\r\n                    Reflecting.config({\r\n                        channel: bodyChannel,\r\n                        updateState: updateState,\r\n                        renderComponents: renderComponents,\r\n                        initialData: foo\r\n                    })\r\n                ])\r\n            };\r\n        };\r\n        var renderInlineBody = function (foo, contentId, backstage, ariaAttrs) {\r\n            return renderBody(foo, Option.some(contentId), backstage, ariaAttrs);\r\n        };\r\n        var renderModalBody = function (foo, backstage) {\r\n            var bodySpec = renderBody(foo, Option.none(), backstage, false);\r\n            return ModalDialog.parts().body(bodySpec);\r\n        };\r\n        var renderIframeBody = function (spec) {\r\n            var bodySpec = {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__content-js']\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-dialog__body-iframe']\r\n                        },\r\n                        components: [NavigableObject.craft({\r\n                                dom: {\r\n                                    tag: 'iframe',\r\n                                    attributes: { src: spec.url }\r\n                                },\r\n                                behaviours: derive$1([\r\n                                    Tabstopping.config({}),\r\n                                    Focusing.config({})\r\n                                ])\r\n                            })]\r\n                    }],\r\n                behaviours: derive$1([Keying.config({\r\n                        mode: 'acyclic',\r\n                        useTabstopAt: not(NavigableObject.isPseudoStop)\r\n                    })])\r\n            };\r\n            return ModalDialog.parts().body(bodySpec);\r\n        };\r\n        var initCommonEvents = function (fireApiEvent, extras) {\r\n            return [\r\n                runWithTarget(focusin(), NavigableObject.onFocus),\r\n                fireApiEvent(formCloseEvent, function (api, spec) {\r\n                    extras.onClose();\r\n                    spec.onClose();\r\n                }),\r\n                fireApiEvent(formCancelEvent, function (api, spec, _event, self) {\r\n                    spec.onCancel(api);\r\n                    emit(self, formCloseEvent);\r\n                }),\r\n                run(formUnblockEvent, function (c, se) {\r\n                    return extras.onUnblock();\r\n                }),\r\n                run(formBlockEvent, function (c, se) {\r\n                    return extras.onBlock(se.event());\r\n                })\r\n            ];\r\n        };\r\n        var initUrlDialog = function (getInstanceApi, extras) {\r\n            var fireApiEvent = function (eventName, f) {\r\n                return run(eventName, function (c, se) {\r\n                    withSpec(c, function (spec, _c) {\r\n                        f(getInstanceApi(), spec, se.event(), c);\r\n                    });\r\n                });\r\n            };\r\n            var withSpec = function (c, f) {\r\n                Reflecting.getState(c).get().each(function (currentDialog) {\r\n                    f(currentDialog, c);\r\n                });\r\n            };\r\n            return initCommonEvents(fireApiEvent, extras).concat([fireApiEvent(formActionEvent, function (api, spec, event) {\r\n                    spec.onAction(api, { name: event.name() });\r\n                })]);\r\n        };\r\n        var initDialog = function (getInstanceApi, extras) {\r\n            var fireApiEvent = function (eventName, f) {\r\n                return run(eventName, function (c, se) {\r\n                    withSpec(c, function (spec, _c) {\r\n                        f(getInstanceApi(), spec, se.event(), c);\r\n                    });\r\n                });\r\n            };\r\n            var withSpec = function (c, f) {\r\n                Reflecting.getState(c).get().each(function (currentDialogInit) {\r\n                    f(currentDialogInit.internalDialog, c);\r\n                });\r\n            };\r\n            return initCommonEvents(fireApiEvent, extras).concat([\r\n                fireApiEvent(formSubmitEvent, function (api, spec) {\r\n                    return spec.onSubmit(api);\r\n                }),\r\n                fireApiEvent(formChangeEvent, function (api, spec, event) {\r\n                    spec.onChange(api, { name: event.name() });\r\n                }),\r\n                fireApiEvent(formActionEvent, function (api, spec, event) {\r\n                    spec.onAction(api, {\r\n                        name: event.name(),\r\n                        value: event.value()\r\n                    });\r\n                }),\r\n                fireApiEvent(formTabChangeEvent, function (api, spec, event) {\r\n                    spec.onTabChange(api, event.title());\r\n                }),\r\n                runOnDetached(function (component) {\r\n                    var api = getInstanceApi();\r\n                    Representing.setValue(component, api.getData());\r\n                })\r\n            ]);\r\n        };\r\n        var SilverDialogEvents = {\r\n            initUrlDialog: initUrlDialog,\r\n            initDialog: initDialog\r\n        };\r\n        var makeButton = function (button, providersBackstage) {\r\n            return renderFooterButton(button, button.type, providersBackstage);\r\n        };\r\n        var lookup$2 = function (compInSystem, footerButtons, buttonName) {\r\n            return find(footerButtons, function (button) {\r\n                return button.name === buttonName;\r\n            }).bind(function (memButton) {\r\n                return memButton.memento.getOpt(compInSystem);\r\n            });\r\n        };\r\n        var renderComponents = function (_data, state) {\r\n            var footerButtons = state.map(function (s) {\r\n                return s.footerButtons;\r\n            }).getOr([]);\r\n            var buttonGroups = partition(footerButtons, function (button) {\r\n                return button.align === 'start';\r\n            });\r\n            var makeGroup = function (edge, buttons) {\r\n                return Container.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-dialog__footer-' + edge]\r\n                    },\r\n                    components: map(buttons, function (button) {\r\n                        return button.memento.asSpec();\r\n                    })\r\n                });\r\n            };\r\n            var startButtons = makeGroup('start', buttonGroups.pass);\r\n            var endButtons = makeGroup('end', buttonGroups.fail);\r\n            return [\r\n                startButtons,\r\n                endButtons\r\n            ];\r\n        };\r\n        var renderFooter = function (initFoo, providersBackstage) {\r\n            var updateState = function (_comp, data) {\r\n                var footerButtons = map(data.buttons, function (button) {\r\n                    var memButton = record(makeButton(button, providersBackstage));\r\n                    return {\r\n                        name: button.name,\r\n                        align: button.align,\r\n                        memento: memButton\r\n                    };\r\n                });\r\n                var lookupByName = function (compInSystem, buttonName) {\r\n                    return lookup$2(compInSystem, footerButtons, buttonName);\r\n                };\r\n                return Option.some({\r\n                    lookupByName: lookupByName,\r\n                    footerButtons: footerButtons\r\n                });\r\n            };\r\n            return {\r\n                dom: fromHtml$2('<div class=\"tox-dialog__footer\"></div>'),\r\n                components: [],\r\n                behaviours: derive$1([Reflecting.config({\r\n                        channel: footerChannel,\r\n                        initialData: initFoo,\r\n                        updateState: updateState,\r\n                        renderComponents: renderComponents\r\n                    })])\r\n            };\r\n        };\r\n        var renderInlineFooter = function (initFoo, providersBackstage) {\r\n            return renderFooter(initFoo, providersBackstage);\r\n        };\r\n        var renderModalFooter = function (initFoo, providersBackstage) {\r\n            return ModalDialog.parts().footer(renderFooter(initFoo, providersBackstage));\r\n        };\r\n        var getCompByName = function (access, name) {\r\n            var root = access.getRoot();\r\n            if (root.getSystem().isConnected()) {\r\n                var form_1 = Composing.getCurrent(access.getFormWrapper()).getOr(access.getFormWrapper());\r\n                return Form.getField(form_1, name).fold(function () {\r\n                    var footer = access.getFooter();\r\n                    var footerState = Reflecting.getState(footer);\r\n                    return footerState.get().bind(function (f) {\r\n                        return f.lookupByName(form_1, name);\r\n                    });\r\n                }, function (comp) {\r\n                    return Option.some(comp);\r\n                });\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var validateData = function (access, data) {\r\n            var root = access.getRoot();\r\n            return Reflecting.getState(root).get().map(function (dialogState) {\r\n                return getOrDie$1(asRaw('data', dialogState.dataValidator, data));\r\n            }).getOr(data);\r\n        };\r\n        var getDialogApi = function (access, doRedial) {\r\n            var withRoot = function (f) {\r\n                var root = access.getRoot();\r\n                if (root.getSystem().isConnected()) {\r\n                    f(root);\r\n                }\r\n            };\r\n            var getData = function () {\r\n                var root = access.getRoot();\r\n                var valueComp = root.getSystem().isConnected() ? access.getFormWrapper() : root;\r\n                return Representing.getValue(valueComp);\r\n            };\r\n            var setData = function (newData) {\r\n                withRoot(function (_) {\r\n                    var prevData = instanceApi.getData();\r\n                    var mergedData = merge(prevData, newData);\r\n                    var newInternalData = validateData(access, mergedData);\r\n                    var form = access.getFormWrapper();\r\n                    Representing.setValue(form, newInternalData);\r\n                });\r\n            };\r\n            var disable = function (name) {\r\n                getCompByName(access, name).each(Disabling.disable);\r\n            };\r\n            var enable = function (name) {\r\n                getCompByName(access, name).each(Disabling.enable);\r\n            };\r\n            var focus = function (name) {\r\n                getCompByName(access, name).each(Focusing.focus);\r\n            };\r\n            var block = function (message) {\r\n                if (!isString(message)) {\r\n                    throw new Error('The dialogInstanceAPI.block function should be passed a blocking message of type string as an argument');\r\n                }\r\n                withRoot(function (root) {\r\n                    emitWith(root, formBlockEvent, { message: message });\r\n                });\r\n            };\r\n            var unblock = function () {\r\n                withRoot(function (root) {\r\n                    emit(root, formUnblockEvent);\r\n                });\r\n            };\r\n            var showTab = function (title) {\r\n                withRoot(function (_) {\r\n                    var body = access.getBody();\r\n                    var bodyState = Reflecting.getState(body);\r\n                    if (bodyState.get().exists(function (b) {\r\n                        return b.isTabPanel();\r\n                    })) {\r\n                        Composing.getCurrent(body).each(function (tabSection) {\r\n                            TabSection.showTab(tabSection, title);\r\n                        });\r\n                    }\r\n                });\r\n            };\r\n            var redial = function (d) {\r\n                withRoot(function (root) {\r\n                    var dialogInit = doRedial(d);\r\n                    root.getSystem().broadcastOn([dialogChannel], dialogInit);\r\n                    root.getSystem().broadcastOn([titleChannel], dialogInit.internalDialog);\r\n                    root.getSystem().broadcastOn([bodyChannel], dialogInit.internalDialog);\r\n                    root.getSystem().broadcastOn([footerChannel], dialogInit.internalDialog);\r\n                    instanceApi.setData(dialogInit.initialData);\r\n                });\r\n            };\r\n            var close = function () {\r\n                withRoot(function (root) {\r\n                    emit(root, formCloseEvent);\r\n                });\r\n            };\r\n            var instanceApi = {\r\n                getData: getData,\r\n                setData: setData,\r\n                disable: disable,\r\n                enable: enable,\r\n                focus: focus,\r\n                block: block,\r\n                unblock: unblock,\r\n                showTab: showTab,\r\n                redial: redial,\r\n                close: close\r\n            };\r\n            return instanceApi;\r\n        };\r\n        var renderClose = function (providersBackstage) {\r\n            return Button.sketch({\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: [\r\n                        'tox-button',\r\n                        'tox-button--icon',\r\n                        'tox-button--naked'\r\n                    ],\r\n                    attributes: {\r\n                        'type': 'button',\r\n                        'aria-label': providersBackstage.translate('Close'),\r\n                        'title': providersBackstage.translate('Close')\r\n                    }\r\n                },\r\n                components: [{\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-icon'],\r\n                            innerHtml: '<svg width=\"24\" height=\"24\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M17.953 7.453L13.422 12l4.531 4.547-1.406 1.406L12 13.422l-4.547 4.531-1.406-1.406L10.578 12 6.047 7.453l1.406-1.406L12 10.578l4.547-4.531z\" fill-rule=\"evenodd\"></path></svg>'\r\n                        }\r\n                    }],\r\n                action: function (comp) {\r\n                    emit(comp, formCancelEvent);\r\n                }\r\n            });\r\n        };\r\n        var renderTitle = function (foo, id, providersBackstage) {\r\n            var renderComponents = function (data) {\r\n                return [text(providersBackstage.translate(data.title))];\r\n            };\r\n            return {\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__title'],\r\n                    attributes: __assign({}, id.map(function (x) {\r\n                        return { id: x };\r\n                    }).getOr({}))\r\n                },\r\n                components: renderComponents(foo),\r\n                behaviours: derive$1([Reflecting.config({\r\n                        channel: titleChannel,\r\n                        renderComponents: renderComponents\r\n                    })])\r\n            };\r\n        };\r\n        var renderInlineHeader = function (foo, titleId, providersBackstage) {\r\n            return Container.sketch({\r\n                dom: fromHtml$2('<div class=\"tox-dialog__header\"></div>'),\r\n                components: [\r\n                    renderTitle(foo, Option.some(titleId), providersBackstage),\r\n                    renderClose(providersBackstage)\r\n                ],\r\n                containerBehaviours: derive$1([Dragging.config({\r\n                        mode: 'mouse',\r\n                        blockerClass: 'blocker',\r\n                        getTarget: function (handle) {\r\n                            return closest$3(handle, '[role=\"dialog\"]').getOrDie();\r\n                        },\r\n                        snaps: {\r\n                            getSnapPoints: function () {\r\n                                return [];\r\n                            },\r\n                            leftAttr: 'data-drag-left',\r\n                            topAttr: 'data-drag-top'\r\n                        }\r\n                    })])\r\n            });\r\n        };\r\n        var renderModalHeader = function (foo, providersBackstage) {\r\n            var pTitle = ModalDialog.parts().title(renderTitle(foo, Option.none(), providersBackstage));\r\n            var pHandle = ModalDialog.parts().draghandle({ dom: fromHtml$2('<div class=\"tox-dialog__draghandle\"></div>') });\r\n            var pClose = ModalDialog.parts().close(renderClose(providersBackstage));\r\n            var components = [pTitle].concat(foo.draggable ? [pHandle] : []).concat([pClose]);\r\n            return Container.sketch({\r\n                dom: fromHtml$2('<div class=\"tox-dialog__header\"></div>'),\r\n                components: components\r\n            });\r\n        };\r\n        var getHeader = function (title, backstage) {\r\n            return renderModalHeader({\r\n                title: backstage.shared.providers.translate(title),\r\n                draggable: true\r\n            }, backstage.shared.providers);\r\n        };\r\n        var getEventExtras = function (lazyDialog, extra) {\r\n            return {\r\n                onClose: function () {\r\n                    return extra.closeWindow();\r\n                },\r\n                onBlock: function (blockEvent) {\r\n                    ModalDialog.setBusy(lazyDialog(), function (d, bs) {\r\n                        return {\r\n                            dom: {\r\n                                tag: 'div',\r\n                                classes: ['tox-dialog__busy-spinner'],\r\n                                attributes: { 'aria-label': blockEvent.message() },\r\n                                styles: {\r\n                                    left: '0px',\r\n                                    right: '0px',\r\n                                    bottom: '0px',\r\n                                    top: '0px',\r\n                                    position: 'absolute'\r\n                                }\r\n                            },\r\n                            behaviours: bs,\r\n                            components: [{ dom: fromHtml$2('<div class=\"tox-spinner\"><div></div><div></div><div></div></div>') }]\r\n                        };\r\n                    });\r\n                },\r\n                onUnblock: function () {\r\n                    ModalDialog.setIdle(lazyDialog());\r\n                }\r\n            };\r\n        };\r\n        var renderModalDialog = function (spec, initialData, dialogEvents, backstage) {\r\n            var _a;\r\n            var updateState = function (_comp, incoming) {\r\n                return Option.some(incoming);\r\n            };\r\n            return build$1(ModalDialog.sketch({\r\n                lazySink: backstage.shared.getSink,\r\n                onEscape: function (c) {\r\n                    emit(c, formCancelEvent);\r\n                    return Option.some(true);\r\n                },\r\n                useTabstopAt: function (elem) {\r\n                    return !NavigableObject.isPseudoStop(elem) && (name(elem) !== 'button' || get$2(elem, 'disabled') !== 'disabled');\r\n                },\r\n                modalBehaviours: derive$1([\r\n                    Reflecting.config({\r\n                        channel: dialogChannel,\r\n                        updateState: updateState,\r\n                        initialData: initialData\r\n                    }),\r\n                    RepresentingConfigs.memory({}),\r\n                    Focusing.config({}),\r\n                    config('execute-on-form', dialogEvents.concat([runOnSource(focusin(), function (comp, se) {\r\n                            Keying.focusIn(comp);\r\n                        })])),\r\n                    config('scroll-lock', [\r\n                        runOnAttached(function () {\r\n                            add$2(body(), 'tox-dialog__disable-scroll');\r\n                        }),\r\n                        runOnDetached(function () {\r\n                            remove$4(body(), 'tox-dialog__disable-scroll');\r\n                        })\r\n                    ])\r\n                ].concat(spec.extraBehaviours)),\r\n                eventOrder: (_a = {}, _a[execute()] = ['execute-on-form'], _a[receive()] = [\r\n                    'reflecting',\r\n                    'receiving'\r\n                ], _a[attachedToDom()] = [\r\n                    'scroll-lock',\r\n                    'reflecting',\r\n                    'messages',\r\n                    'execute-on-form',\r\n                    'alloy.base.behaviour'\r\n                ], _a[detachedFromDom()] = [\r\n                    'alloy.base.behaviour',\r\n                    'execute-on-form',\r\n                    'messages',\r\n                    'reflecting',\r\n                    'scroll-lock'\r\n                ], _a),\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog'].concat(spec.extraClasses),\r\n                    styles: __assign({ position: 'relative' }, spec.extraStyles)\r\n                },\r\n                components: [\r\n                    spec.header,\r\n                    spec.body\r\n                ].concat(spec.footer.toArray()),\r\n                dragBlockClass: 'tox-dialog-wrap',\r\n                parts: {\r\n                    blocker: {\r\n                        dom: fromHtml$2('<div class=\"tox-dialog-wrap\"></div>'),\r\n                        components: [{\r\n                                dom: {\r\n                                    tag: 'div',\r\n                                    classes: ['tox-dialog-wrap__backdrop']\r\n                                }\r\n                            }]\r\n                    }\r\n                }\r\n            }));\r\n        };\r\n        var renderDialog = function (dialogInit, extra, backstage) {\r\n            var header = getHeader(dialogInit.internalDialog.title, backstage);\r\n            var body = renderModalBody({ body: dialogInit.internalDialog.body }, backstage);\r\n            var footer = renderModalFooter({ buttons: dialogInit.internalDialog.buttons }, backstage.shared.providers);\r\n            var dialogEvents = SilverDialogEvents.initDialog(function () {\r\n                return instanceApi;\r\n            }, getEventExtras(function () {\r\n                return dialog;\r\n            }, extra));\r\n            var dialogSize = dialogInit.internalDialog.size !== 'normal' ? dialogInit.internalDialog.size === 'large' ? ['tox-dialog--width-lg'] : ['tox-dialog--width-md'] : [];\r\n            var spec = {\r\n                header: header,\r\n                body: body,\r\n                footer: Option.some(footer),\r\n                extraClasses: dialogSize,\r\n                extraBehaviours: [],\r\n                extraStyles: {}\r\n            };\r\n            var dialog = renderModalDialog(spec, dialogInit, dialogEvents, backstage);\r\n            var modalAccess = function () {\r\n                var getForm = function () {\r\n                    var outerForm = ModalDialog.getBody(dialog);\r\n                    return Composing.getCurrent(outerForm).getOr(outerForm);\r\n                };\r\n                return {\r\n                    getRoot: function () {\r\n                        return dialog;\r\n                    },\r\n                    getBody: function () {\r\n                        return ModalDialog.getBody(dialog);\r\n                    },\r\n                    getFooter: function () {\r\n                        return ModalDialog.getFooter(dialog);\r\n                    },\r\n                    getFormWrapper: getForm\r\n                };\r\n            }();\r\n            var instanceApi = getDialogApi(modalAccess, extra.redial);\r\n            return {\r\n                dialog: dialog,\r\n                instanceApi: instanceApi\r\n            };\r\n        };\r\n        var global$d = tinymce.util.Tools.resolve('tinymce.util.URI');\r\n        var getUrlDialogApi = function (root) {\r\n            var withRoot = function (f) {\r\n                if (root.getSystem().isConnected()) {\r\n                    f(root);\r\n                }\r\n            };\r\n            var block = function (message) {\r\n                if (!isString(message)) {\r\n                    throw new Error('The urlDialogInstanceAPI.block function should be passed a blocking message of type string as an argument');\r\n                }\r\n                withRoot(function (root) {\r\n                    emitWith(root, formBlockEvent, { message: message });\r\n                });\r\n            };\r\n            var unblock = function () {\r\n                withRoot(function (root) {\r\n                    emit(root, formUnblockEvent);\r\n                });\r\n            };\r\n            var close = function () {\r\n                withRoot(function (root) {\r\n                    emit(root, formCloseEvent);\r\n                });\r\n            };\r\n            var sendMessage = function (data) {\r\n                withRoot(function (root) {\r\n                    root.getSystem().broadcastOn([bodySendMessageChannel], data);\r\n                });\r\n            };\r\n            return {\r\n                block: block,\r\n                unblock: unblock,\r\n                close: close,\r\n                sendMessage: sendMessage\r\n            };\r\n        };\r\n        var SUPPORTED_MESSAGE_ACTIONS = [\r\n            'insertContent',\r\n            'setContent',\r\n            'execCommand',\r\n            'close',\r\n            'block',\r\n            'unblock'\r\n        ];\r\n        var isSupportedMessage = function (data) {\r\n            return isObject(data) && SUPPORTED_MESSAGE_ACTIONS.indexOf(data.mceAction) !== -1;\r\n        };\r\n        var isCustomMessage = function (data) {\r\n            return !isSupportedMessage(data) && isObject(data) && has(data, 'mceAction');\r\n        };\r\n        var handleMessage = function (editor, api, data) {\r\n            switch (data.mceAction) {\r\n                case 'insertContent':\r\n                    editor.insertContent(data.content);\r\n                    break;\r\n                case 'setContent':\r\n                    editor.setContent(data.content);\r\n                    break;\r\n                case 'execCommand':\r\n                    var ui = isBoolean(data.ui) ? data.ui : false;\r\n                    editor.execCommand(data.cmd, ui, data.value);\r\n                    break;\r\n                case 'close':\r\n                    api.close();\r\n                    break;\r\n                case 'block':\r\n                    api.block(data.message);\r\n                    break;\r\n                case 'unblock':\r\n                    api.unblock();\r\n                    break;\r\n            }\r\n        };\r\n        var renderUrlDialog = function (internalDialog, extra, editor, backstage) {\r\n            var _a;\r\n            var header = getHeader(internalDialog.title, backstage);\r\n            var body = renderIframeBody(internalDialog);\r\n            var footer = internalDialog.buttons.bind(function (buttons) {\r\n                if (buttons.length === 0) {\r\n                    return Option.none();\r\n                }\r\n                else {\r\n                    return Option.some(renderModalFooter({ buttons: buttons }, backstage.shared.providers));\r\n                }\r\n            });\r\n            var dialogEvents = SilverDialogEvents.initUrlDialog(function () {\r\n                return instanceApi;\r\n            }, getEventExtras(function () {\r\n                return dialog;\r\n            }, extra));\r\n            var styles = __assign({}, internalDialog.height.fold(function () {\r\n                return {};\r\n            }, function (height) {\r\n                return {\r\n                    'height': height + 'px',\r\n                    'max-height': height + 'px'\r\n                };\r\n            }), internalDialog.width.fold(function () {\r\n                return {};\r\n            }, function (width) {\r\n                return {\r\n                    'width': width + 'px',\r\n                    'max-width': width + 'px'\r\n                };\r\n            }));\r\n            var classes = internalDialog.width.isNone() && internalDialog.height.isNone() ? ['tox-dialog--width-lg'] : [];\r\n            var iframeUri = new global$d(internalDialog.url, { base_uri: new global$d(domGlobals.window.location.href) });\r\n            var iframeDomain = iframeUri.protocol + '://' + iframeUri.host + (iframeUri.port ? ':' + iframeUri.port : '');\r\n            var messageHandlerUnbinder = Cell(Option.none());\r\n            var extraBehaviours = [\r\n                config('messages', [\r\n                    runOnAttached(function () {\r\n                        var unbind = bind$3(Element.fromDom(domGlobals.window), 'message', function (e) {\r\n                            if (iframeUri.isSameOrigin(new global$d(e.raw().origin))) {\r\n                                var data = e.raw().data;\r\n                                if (isSupportedMessage(data)) {\r\n                                    handleMessage(editor, instanceApi, data);\r\n                                }\r\n                                else if (isCustomMessage(data)) {\r\n                                    internalDialog.onMessage(instanceApi, data);\r\n                                }\r\n                            }\r\n                        });\r\n                        messageHandlerUnbinder.set(Option.some(unbind));\r\n                    }),\r\n                    runOnDetached(function () {\r\n                        messageHandlerUnbinder.get().each(function (unbinder) {\r\n                            return unbinder.unbind();\r\n                        });\r\n                    })\r\n                ]),\r\n                Receiving.config({\r\n                    channels: (_a = {}, _a[bodySendMessageChannel] = {\r\n                        onReceive: function (comp, data) {\r\n                            descendant$2(comp.element(), 'iframe').each(function (iframeEle) {\r\n                                var iframeWin = iframeEle.dom().contentWindow;\r\n                                iframeWin.postMessage(data, iframeDomain);\r\n                            });\r\n                        }\r\n                    }, _a)\r\n                })\r\n            ];\r\n            var spec = {\r\n                header: header,\r\n                body: body,\r\n                footer: footer,\r\n                extraClasses: classes,\r\n                extraBehaviours: extraBehaviours,\r\n                extraStyles: styles\r\n            };\r\n            var dialog = renderModalDialog(spec, internalDialog, dialogEvents, backstage);\r\n            var instanceApi = getUrlDialogApi(dialog);\r\n            return {\r\n                dialog: dialog,\r\n                instanceApi: instanceApi\r\n            };\r\n        };\r\n        var renderInlineDialog = function (dialogInit, extra, backstage, ariaAttrs) {\r\n            var _a, _b;\r\n            var dialogLabelId = generate$1('dialog-label');\r\n            var dialogContentId = generate$1('dialog-content');\r\n            var updateState = function (_comp, incoming) {\r\n                return Option.some(incoming);\r\n            };\r\n            var memHeader = record(renderInlineHeader({\r\n                title: dialogInit.internalDialog.title,\r\n                draggable: true\r\n            }, dialogLabelId, backstage.shared.providers));\r\n            var memBody = record(renderInlineBody({ body: dialogInit.internalDialog.body }, dialogContentId, backstage, ariaAttrs));\r\n            var memFooter = record(renderInlineFooter({ buttons: dialogInit.internalDialog.buttons }, backstage.shared.providers));\r\n            var dialogEvents = SilverDialogEvents.initDialog(function () {\r\n                return instanceApi;\r\n            }, {\r\n                onBlock: function () {\r\n                },\r\n                onUnblock: function () {\r\n                },\r\n                onClose: function () {\r\n                    return extra.closeWindow();\r\n                }\r\n            });\r\n            var dialog = build$1({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog'],\r\n                    attributes: (_a = { role: 'dialog' }, _a['aria-labelledby'] = dialogLabelId, _a['aria-describedby'] = '' + dialogContentId, _a)\r\n                },\r\n                eventOrder: (_b = {}, _b[receive()] = [\r\n                    Reflecting.name(),\r\n                    Receiving.name()\r\n                ], _b[execute()] = ['execute-on-form'], _b[attachedToDom()] = [\r\n                    'reflecting',\r\n                    'execute-on-form'\r\n                ], _b),\r\n                behaviours: derive$1([\r\n                    Keying.config({\r\n                        mode: 'cyclic',\r\n                        onEscape: function (c) {\r\n                            emit(c, formCloseEvent);\r\n                            return Option.some(true);\r\n                        },\r\n                        useTabstopAt: function (elem) {\r\n                            return !NavigableObject.isPseudoStop(elem) && (name(elem) !== 'button' || get$2(elem, 'disabled') !== 'disabled');\r\n                        }\r\n                    }),\r\n                    Reflecting.config({\r\n                        channel: dialogChannel,\r\n                        updateState: updateState,\r\n                        initialData: dialogInit\r\n                    }),\r\n                    config('execute-on-form', dialogEvents),\r\n                    RepresentingConfigs.memory({})\r\n                ]),\r\n                components: [\r\n                    memHeader.asSpec(),\r\n                    memBody.asSpec(),\r\n                    memFooter.asSpec()\r\n                ]\r\n            });\r\n            var instanceApi = getDialogApi({\r\n                getRoot: function () {\r\n                    return dialog;\r\n                },\r\n                getFooter: function () {\r\n                    return memFooter.get(dialog);\r\n                },\r\n                getBody: function () {\r\n                    return memBody.get(dialog);\r\n                },\r\n                getFormWrapper: function () {\r\n                    var body = memBody.get(dialog);\r\n                    return Composing.getCurrent(body).getOr(body);\r\n                }\r\n            }, extra.redial);\r\n            return {\r\n                dialog: dialog,\r\n                instanceApi: instanceApi\r\n            };\r\n        };\r\n        var pClose = function (onClose, providersBackstage) {\r\n            return ModalDialog.parts().close(Button.sketch({\r\n                dom: {\r\n                    tag: 'button',\r\n                    classes: [\r\n                        'tox-button',\r\n                        'tox-button--icon',\r\n                        'tox-button--naked'\r\n                    ],\r\n                    attributes: {\r\n                        'type': 'button',\r\n                        'aria-label': providersBackstage.translate('Close')\r\n                    }\r\n                },\r\n                action: onClose,\r\n                buttonBehaviours: derive$1([Tabstopping.config({})])\r\n            }));\r\n        };\r\n        var pUntitled = function () {\r\n            return ModalDialog.parts().title({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__title'],\r\n                    innerHtml: '',\r\n                    styles: { display: 'none' }\r\n                }\r\n            });\r\n        };\r\n        var pBodyMessage = function (message, providersBackstage) {\r\n            return ModalDialog.parts().body({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: [\r\n                        'tox-dialog__body',\r\n                        'todo-tox-fit'\r\n                    ]\r\n                },\r\n                components: [{ dom: fromHtml$2('<p>' + providersBackstage.translate(message) + '</p>') }]\r\n            });\r\n        };\r\n        var pFooter = function (buttons) {\r\n            return ModalDialog.parts().footer({\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog__footer']\r\n                },\r\n                components: buttons\r\n            });\r\n        };\r\n        var pFooterGroup = function (startButtons, endButtons) {\r\n            return [\r\n                Container.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-dialog__footer-start']\r\n                    },\r\n                    components: startButtons\r\n                }),\r\n                Container.sketch({\r\n                    dom: {\r\n                        tag: 'div',\r\n                        classes: ['tox-dialog__footer-end']\r\n                    },\r\n                    components: endButtons\r\n                })\r\n            ];\r\n        };\r\n        var renderDialog$1 = function (spec) {\r\n            return ModalDialog.sketch({\r\n                lazySink: spec.lazySink,\r\n                onEscape: function () {\r\n                    spec.onCancel();\r\n                    return Option.some(true);\r\n                },\r\n                dom: {\r\n                    tag: 'div',\r\n                    classes: ['tox-dialog'].concat(spec.extraClasses)\r\n                },\r\n                components: [\r\n                    {\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: ['tox-dialog__header']\r\n                        },\r\n                        components: [\r\n                            spec.partSpecs.title,\r\n                            spec.partSpecs.close\r\n                        ]\r\n                    },\r\n                    spec.partSpecs.body,\r\n                    spec.partSpecs.footer\r\n                ],\r\n                parts: {\r\n                    blocker: {\r\n                        dom: fromHtml$2('<div class=\"tox-dialog-wrap\"></div>'),\r\n                        components: [{\r\n                                dom: {\r\n                                    tag: 'div',\r\n                                    classes: ['tox-dialog-wrap__backdrop']\r\n                                }\r\n                            }]\r\n                    }\r\n                },\r\n                modalBehaviours: derive$1([config('basic-dialog-events', [\r\n                        run(formCancelEvent, function (comp, se) {\r\n                            spec.onCancel();\r\n                        }),\r\n                        run(formSubmitEvent, function (comp, se) {\r\n                            spec.onSubmit();\r\n                        })\r\n                    ])])\r\n            });\r\n        };\r\n        var setup$9 = function (extras) {\r\n            var sharedBackstage = extras.backstage.shared;\r\n            var open = function (message, callback) {\r\n                var closeDialog = function () {\r\n                    ModalDialog.hide(alertDialog);\r\n                    callback();\r\n                };\r\n                var memFooterClose = record(renderFooterButton({\r\n                    name: 'close-alert',\r\n                    text: 'OK',\r\n                    primary: true,\r\n                    icon: Option.none()\r\n                }, 'cancel', sharedBackstage.providers));\r\n                var alertDialog = build$1(renderDialog$1({\r\n                    lazySink: function () {\r\n                        return sharedBackstage.getSink();\r\n                    },\r\n                    partSpecs: {\r\n                        title: pUntitled(),\r\n                        close: pClose(function () {\r\n                            closeDialog();\r\n                        }, sharedBackstage.providers),\r\n                        body: pBodyMessage(message, sharedBackstage.providers),\r\n                        footer: pFooter(pFooterGroup([], [memFooterClose.asSpec()]))\r\n                    },\r\n                    onCancel: function () {\r\n                        return closeDialog();\r\n                    },\r\n                    onSubmit: noop,\r\n                    extraClasses: ['tox-alert-dialog']\r\n                }));\r\n                ModalDialog.show(alertDialog);\r\n                var footerCloseButton = memFooterClose.get(alertDialog);\r\n                Focusing.focus(footerCloseButton);\r\n            };\r\n            return { open: open };\r\n        };\r\n        var setup$a = function (extras) {\r\n            var sharedBackstage = extras.backstage.shared;\r\n            var open = function (message, callback) {\r\n                var closeDialog = function (state) {\r\n                    ModalDialog.hide(confirmDialog);\r\n                    callback(state);\r\n                };\r\n                var memFooterYes = record(renderFooterButton({\r\n                    name: 'yes',\r\n                    text: 'Yes',\r\n                    primary: true,\r\n                    icon: Option.none()\r\n                }, 'submit', sharedBackstage.providers));\r\n                var footerNo = renderFooterButton({\r\n                    name: 'no',\r\n                    text: 'No',\r\n                    primary: true,\r\n                    icon: Option.none()\r\n                }, 'cancel', sharedBackstage.providers);\r\n                var confirmDialog = build$1(renderDialog$1({\r\n                    lazySink: function () {\r\n                        return sharedBackstage.getSink();\r\n                    },\r\n                    partSpecs: {\r\n                        title: pUntitled(),\r\n                        close: pClose(function () {\r\n                            closeDialog(false);\r\n                        }, sharedBackstage.providers),\r\n                        body: pBodyMessage(message, sharedBackstage.providers),\r\n                        footer: pFooter(pFooterGroup([], [\r\n                            footerNo,\r\n                            memFooterYes.asSpec()\r\n                        ]))\r\n                    },\r\n                    onCancel: function () {\r\n                        return closeDialog(false);\r\n                    },\r\n                    onSubmit: function () {\r\n                        return closeDialog(true);\r\n                    },\r\n                    extraClasses: ['tox-confirm-dialog']\r\n                }));\r\n                ModalDialog.show(confirmDialog);\r\n                var footerYesButton = memFooterYes.get(confirmDialog);\r\n                Focusing.focus(footerYesButton);\r\n            };\r\n            return { open: open };\r\n        };\r\n        var validateData$1 = function (data, validator) {\r\n            return getOrDie$1(asRaw('data', validator, data));\r\n        };\r\n        var setup$b = function (extras) {\r\n            var alertDialog = setup$9(extras);\r\n            var confirmDialog = setup$a(extras);\r\n            var open = function (config, params, closeWindow) {\r\n                if (params !== undefined && params.inline === 'toolbar') {\r\n                    return openInlineDialog(config, extras.backstage.shared.anchors.toolbar(), closeWindow, params.ariaAttrs);\r\n                }\r\n                else if (params !== undefined && params.inline === 'cursor') {\r\n                    return openInlineDialog(config, extras.backstage.shared.anchors.cursor(), closeWindow, params.ariaAttrs);\r\n                }\r\n                else {\r\n                    return openModalDialog(config, closeWindow);\r\n                }\r\n            };\r\n            var openUrl = function (config, closeWindow) {\r\n                return openModalUrlDialog(config, closeWindow);\r\n            };\r\n            var openModalUrlDialog = function (config, closeWindow) {\r\n                var factory = function (contents) {\r\n                    var dialog = renderUrlDialog(contents, {\r\n                        closeWindow: function () {\r\n                            ModalDialog.hide(dialog.dialog);\r\n                            closeWindow(dialog.instanceApi);\r\n                        }\r\n                    }, extras.editor, extras.backstage);\r\n                    ModalDialog.show(dialog.dialog);\r\n                    return dialog.instanceApi;\r\n                };\r\n                return DialogManager.openUrl(factory, config);\r\n            };\r\n            var openModalDialog = function (config, closeWindow) {\r\n                var factory = function (contents, internalInitialData, dataValidator) {\r\n                    var initialData = internalInitialData;\r\n                    var dialogInit = {\r\n                        dataValidator: dataValidator,\r\n                        initialData: initialData,\r\n                        internalDialog: contents\r\n                    };\r\n                    var dialog = renderDialog(dialogInit, {\r\n                        redial: DialogManager.redial,\r\n                        closeWindow: function () {\r\n                            ModalDialog.hide(dialog.dialog);\r\n                            closeWindow(dialog.instanceApi);\r\n                        }\r\n                    }, extras.backstage);\r\n                    ModalDialog.show(dialog.dialog);\r\n                    dialog.instanceApi.setData(initialData);\r\n                    return dialog.instanceApi;\r\n                };\r\n                return DialogManager.open(factory, config);\r\n            };\r\n            var openInlineDialog = function (config$1, anchor, closeWindow, ariaAttrs) {\r\n                var factory = function (contents, internalInitialData, dataValidator) {\r\n                    var initialData = validateData$1(internalInitialData, dataValidator);\r\n                    var dialogInit = {\r\n                        dataValidator: dataValidator,\r\n                        initialData: initialData,\r\n                        internalDialog: contents\r\n                    };\r\n                    var dialogUi = renderInlineDialog(dialogInit, {\r\n                        redial: DialogManager.redial,\r\n                        closeWindow: function () {\r\n                            InlineView.hide(inlineDialog);\r\n                            closeWindow(dialogUi.instanceApi);\r\n                        }\r\n                    }, extras.backstage, ariaAttrs);\r\n                    var inlineDialog = build$1(InlineView.sketch({\r\n                        lazySink: extras.backstage.shared.getSink,\r\n                        dom: {\r\n                            tag: 'div',\r\n                            classes: []\r\n                        },\r\n                        fireDismissalEventInstead: {},\r\n                        inlineBehaviours: derive$1([config('window-manager-inline-events', [run(dismissRequested(), function (comp, se) {\r\n                                    emit(dialogUi.dialog, formCancelEvent);\r\n                                })])])\r\n                    }));\r\n                    InlineView.showAt(inlineDialog, anchor, premade$1(dialogUi.dialog));\r\n                    dialogUi.instanceApi.setData(initialData);\r\n                    Keying.focusIn(dialogUi.dialog);\r\n                    return dialogUi.instanceApi;\r\n                };\r\n                return DialogManager.open(factory, config$1);\r\n            };\r\n            var confirm = function (message, callback) {\r\n                confirmDialog.open(message, function (state) {\r\n                    callback(state);\r\n                });\r\n            };\r\n            var alert = function (message, callback) {\r\n                alertDialog.open(message, function () {\r\n                    callback();\r\n                });\r\n            };\r\n            var close = function (instanceApi) {\r\n                instanceApi.close();\r\n            };\r\n            return {\r\n                open: open,\r\n                openUrl: openUrl,\r\n                alert: alert,\r\n                close: close,\r\n                confirm: confirm\r\n            };\r\n        };\r\n        var WindowManager = { setup: setup$b };\r\n        global.add('silver', function (editor) {\r\n            var _a = Render.setup(editor), mothership = _a.mothership, uiMothership = _a.uiMothership, backstage = _a.backstage, renderUI = _a.renderUI, getUi = _a.getUi;\r\n            FormatControls.setup(editor, backstage);\r\n            registerInspector(generate$1('silver-demo'), mothership);\r\n            registerInspector(generate$1('silver-ui-demo'), uiMothership);\r\n            Autocompleter.register(editor, backstage.shared);\r\n            var windowMgr = WindowManager.setup({\r\n                editor: editor,\r\n                backstage: backstage\r\n            });\r\n            return {\r\n                renderUI: renderUI,\r\n                getWindowManagerImpl: constant(windowMgr),\r\n                getNotificationManagerImpl: function () {\r\n                    return NotificationManagerImpl(editor, { backstage: backstage }, uiMothership);\r\n                },\r\n                ui: getUi()\r\n            };\r\n        });\r\n        function Theme() {\r\n        }\r\n        return Theme;\r\n    }(window));\r\n})();\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/themes/silver/theme.js?");

/***/ }),

/***/ "./node_modules/tinymce/tinymce.js":
/*!*****************************************!*\
  !*** ./node_modules/tinymce/tinymce.js ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\n(function () {\r\n    (function (domGlobals) {\r\n        'use strict';\r\n        var noop = function () {\r\n            var args = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                args[_i] = arguments[_i];\r\n            }\r\n        };\r\n        var noarg = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return f();\r\n            };\r\n        };\r\n        var compose = function (fa, fb) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return fa(fb.apply(null, args));\r\n            };\r\n        };\r\n        var constant = function (value) {\r\n            return function () {\r\n                return value;\r\n            };\r\n        };\r\n        var identity = function (x) {\r\n            return x;\r\n        };\r\n        var tripleEquals = function (a, b) {\r\n            return a === b;\r\n        };\r\n        function curry(fn) {\r\n            var initialArgs = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                initialArgs[_i - 1] = arguments[_i];\r\n            }\r\n            return function () {\r\n                var restArgs = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    restArgs[_i] = arguments[_i];\r\n                }\r\n                var all = initialArgs.concat(restArgs);\r\n                return fn.apply(null, all);\r\n            };\r\n        }\r\n        var not = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                return !f.apply(null, args);\r\n            };\r\n        };\r\n        var die = function (msg) {\r\n            return function () {\r\n                throw new Error(msg);\r\n            };\r\n        };\r\n        var apply = function (f) {\r\n            return f();\r\n        };\r\n        var call = function (f) {\r\n            f();\r\n        };\r\n        var never = constant(false);\r\n        var always = constant(true);\r\n        var Fun = Object.freeze({\r\n            noop: noop,\r\n            noarg: noarg,\r\n            compose: compose,\r\n            constant: constant,\r\n            identity: identity,\r\n            tripleEquals: tripleEquals,\r\n            curry: curry,\r\n            not: not,\r\n            die: die,\r\n            apply: apply,\r\n            call: call,\r\n            never: never,\r\n            always: always\r\n        });\r\n        var never$1 = never;\r\n        var always$1 = always;\r\n        var none = function () {\r\n            return NONE;\r\n        };\r\n        var NONE = function () {\r\n            var eq = function (o) {\r\n                return o.isNone();\r\n            };\r\n            var call = function (thunk) {\r\n                return thunk();\r\n            };\r\n            var id = function (n) {\r\n                return n;\r\n            };\r\n            var noop = function () {\r\n            };\r\n            var nul = function () {\r\n                return null;\r\n            };\r\n            var undef = function () {\r\n                return undefined;\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return n();\r\n                },\r\n                is: never$1,\r\n                isSome: never$1,\r\n                isNone: always$1,\r\n                getOr: id,\r\n                getOrThunk: call,\r\n                getOrDie: function (msg) {\r\n                    throw new Error(msg || 'error: getOrDie called on none.');\r\n                },\r\n                getOrNull: nul,\r\n                getOrUndefined: undef,\r\n                or: id,\r\n                orThunk: call,\r\n                map: none,\r\n                ap: none,\r\n                each: noop,\r\n                bind: none,\r\n                flatten: none,\r\n                exists: never$1,\r\n                forall: always$1,\r\n                filter: none,\r\n                equals: eq,\r\n                equals_: eq,\r\n                toArray: function () {\r\n                    return [];\r\n                },\r\n                toString: constant('none()')\r\n            };\r\n            if (Object.freeze)\r\n                Object.freeze(me);\r\n            return me;\r\n        }();\r\n        var some = function (a) {\r\n            var constant_a = function () {\r\n                return a;\r\n            };\r\n            var self = function () {\r\n                return me;\r\n            };\r\n            var map = function (f) {\r\n                return some(f(a));\r\n            };\r\n            var bind = function (f) {\r\n                return f(a);\r\n            };\r\n            var me = {\r\n                fold: function (n, s) {\r\n                    return s(a);\r\n                },\r\n                is: function (v) {\r\n                    return a === v;\r\n                },\r\n                isSome: always$1,\r\n                isNone: never$1,\r\n                getOr: constant_a,\r\n                getOrThunk: constant_a,\r\n                getOrDie: constant_a,\r\n                getOrNull: constant_a,\r\n                getOrUndefined: constant_a,\r\n                or: self,\r\n                orThunk: self,\r\n                map: map,\r\n                ap: function (optfab) {\r\n                    return optfab.fold(none, function (fab) {\r\n                        return some(fab(a));\r\n                    });\r\n                },\r\n                each: function (f) {\r\n                    f(a);\r\n                },\r\n                bind: bind,\r\n                flatten: constant_a,\r\n                exists: bind,\r\n                forall: bind,\r\n                filter: function (f) {\r\n                    return f(a) ? me : NONE;\r\n                },\r\n                equals: function (o) {\r\n                    return o.is(a);\r\n                },\r\n                equals_: function (o, elementEq) {\r\n                    return o.fold(never$1, function (b) {\r\n                        return elementEq(a, b);\r\n                    });\r\n                },\r\n                toArray: function () {\r\n                    return [a];\r\n                },\r\n                toString: function () {\r\n                    return 'some(' + a + ')';\r\n                }\r\n            };\r\n            return me;\r\n        };\r\n        var from = function (value) {\r\n            return value === null || value === undefined ? NONE : some(value);\r\n        };\r\n        var Option = {\r\n            some: some,\r\n            none: none,\r\n            from: from\r\n        };\r\n        var typeOf = function (x) {\r\n            if (x === null)\r\n                return 'null';\r\n            var t = typeof x;\r\n            if (t === 'object' && Array.prototype.isPrototypeOf(x))\r\n                return 'array';\r\n            if (t === 'object' && String.prototype.isPrototypeOf(x))\r\n                return 'string';\r\n            return t;\r\n        };\r\n        var isType = function (type) {\r\n            return function (value) {\r\n                return typeOf(value) === type;\r\n            };\r\n        };\r\n        var isString = isType('string');\r\n        var isObject = isType('object');\r\n        var isArray = isType('array');\r\n        var isNull = isType('null');\r\n        var isBoolean = isType('boolean');\r\n        var isFunction = isType('function');\r\n        var isNumber = isType('number');\r\n        var rawIndexOf = function () {\r\n            var pIndexOf = Array.prototype.indexOf;\r\n            var fastIndex = function (xs, x) {\r\n                return pIndexOf.call(xs, x);\r\n            };\r\n            var slowIndex = function (xs, x) {\r\n                return slowIndexOf(xs, x);\r\n            };\r\n            return pIndexOf === undefined ? slowIndex : fastIndex;\r\n        }();\r\n        var indexOf = function (xs, x) {\r\n            var r = rawIndexOf(xs, x);\r\n            return r === -1 ? Option.none() : Option.some(r);\r\n        };\r\n        var contains = function (xs, x) {\r\n            return rawIndexOf(xs, x) > -1;\r\n        };\r\n        var exists = function (xs, pred) {\r\n            return findIndex(xs, pred).isSome();\r\n        };\r\n        var range = function (num, f) {\r\n            var r = [];\r\n            for (var i = 0; i < num; i++) {\r\n                r.push(f(i));\r\n            }\r\n            return r;\r\n        };\r\n        var chunk = function (array, size) {\r\n            var r = [];\r\n            for (var i = 0; i < array.length; i += size) {\r\n                var s = array.slice(i, i + size);\r\n                r.push(s);\r\n            }\r\n            return r;\r\n        };\r\n        var map = function (xs, f) {\r\n            var len = xs.length;\r\n            var r = new Array(len);\r\n            for (var i = 0; i < len; i++) {\r\n                var x = xs[i];\r\n                r[i] = f(x, i, xs);\r\n            }\r\n            return r;\r\n        };\r\n        var each = function (xs, f) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                f(x, i, xs);\r\n            }\r\n        };\r\n        var eachr = function (xs, f) {\r\n            for (var i = xs.length - 1; i >= 0; i--) {\r\n                var x = xs[i];\r\n                f(x, i, xs);\r\n            }\r\n        };\r\n        var partition = function (xs, pred) {\r\n            var pass = [];\r\n            var fail = [];\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                var arr = pred(x, i, xs) ? pass : fail;\r\n                arr.push(x);\r\n            }\r\n            return {\r\n                pass: pass,\r\n                fail: fail\r\n            };\r\n        };\r\n        var filter = function (xs, pred) {\r\n            var r = [];\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    r.push(x);\r\n                }\r\n            }\r\n            return r;\r\n        };\r\n        var groupBy = function (xs, f) {\r\n            if (xs.length === 0) {\r\n                return [];\r\n            }\r\n            else {\r\n                var wasType = f(xs[0]);\r\n                var r = [];\r\n                var group = [];\r\n                for (var i = 0, len = xs.length; i < len; i++) {\r\n                    var x = xs[i];\r\n                    var type = f(x);\r\n                    if (type !== wasType) {\r\n                        r.push(group);\r\n                        group = [];\r\n                    }\r\n                    wasType = type;\r\n                    group.push(x);\r\n                }\r\n                if (group.length !== 0) {\r\n                    r.push(group);\r\n                }\r\n                return r;\r\n            }\r\n        };\r\n        var foldr = function (xs, f, acc) {\r\n            eachr(xs, function (x) {\r\n                acc = f(acc, x);\r\n            });\r\n            return acc;\r\n        };\r\n        var foldl = function (xs, f, acc) {\r\n            each(xs, function (x) {\r\n                acc = f(acc, x);\r\n            });\r\n            return acc;\r\n        };\r\n        var find = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    return Option.some(x);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var findIndex = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs)) {\r\n                    return Option.some(i);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var slowIndexOf = function (xs, x) {\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (xs[i] === x) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var push = Array.prototype.push;\r\n        var flatten = function (xs) {\r\n            var r = [];\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                if (!Array.prototype.isPrototypeOf(xs[i]))\r\n                    throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\r\n                push.apply(r, xs[i]);\r\n            }\r\n            return r;\r\n        };\r\n        var bind = function (xs, f) {\r\n            var output = map(xs, f);\r\n            return flatten(output);\r\n        };\r\n        var forall = function (xs, pred) {\r\n            for (var i = 0, len = xs.length; i < len; ++i) {\r\n                var x = xs[i];\r\n                if (pred(x, i, xs) !== true) {\r\n                    return false;\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        var equal = function (a1, a2) {\r\n            return a1.length === a2.length && forall(a1, function (x, i) {\r\n                return x === a2[i];\r\n            });\r\n        };\r\n        var slice = Array.prototype.slice;\r\n        var reverse = function (xs) {\r\n            var r = slice.call(xs, 0);\r\n            r.reverse();\r\n            return r;\r\n        };\r\n        var difference = function (a1, a2) {\r\n            return filter(a1, function (x) {\r\n                return !contains(a2, x);\r\n            });\r\n        };\r\n        var mapToObject = function (xs, f) {\r\n            var r = {};\r\n            for (var i = 0, len = xs.length; i < len; i++) {\r\n                var x = xs[i];\r\n                r[String(x)] = f(x, i);\r\n            }\r\n            return r;\r\n        };\r\n        var pure = function (x) {\r\n            return [x];\r\n        };\r\n        var sort = function (xs, comparator) {\r\n            var copy = slice.call(xs, 0);\r\n            copy.sort(comparator);\r\n            return copy;\r\n        };\r\n        var head = function (xs) {\r\n            return xs.length === 0 ? Option.none() : Option.some(xs[0]);\r\n        };\r\n        var last = function (xs) {\r\n            return xs.length === 0 ? Option.none() : Option.some(xs[xs.length - 1]);\r\n        };\r\n        var from$1 = isFunction(Array.from) ? Array.from : function (x) {\r\n            return slice.call(x);\r\n        };\r\n        var Arr = Object.freeze({\r\n            indexOf: indexOf,\r\n            contains: contains,\r\n            exists: exists,\r\n            range: range,\r\n            chunk: chunk,\r\n            map: map,\r\n            each: each,\r\n            eachr: eachr,\r\n            partition: partition,\r\n            filter: filter,\r\n            groupBy: groupBy,\r\n            foldr: foldr,\r\n            foldl: foldl,\r\n            find: find,\r\n            findIndex: findIndex,\r\n            flatten: flatten,\r\n            bind: bind,\r\n            forall: forall,\r\n            equal: equal,\r\n            reverse: reverse,\r\n            difference: difference,\r\n            mapToObject: mapToObject,\r\n            pure: pure,\r\n            sort: sort,\r\n            head: head,\r\n            last: last,\r\n            from: from$1\r\n        });\r\n        var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\r\n        var path = function (parts, scope) {\r\n            var o = scope !== undefined && scope !== null ? scope : Global;\r\n            for (var i = 0; i < parts.length && o !== undefined && o !== null; ++i)\r\n                o = o[parts[i]];\r\n            return o;\r\n        };\r\n        var resolve = function (p, scope) {\r\n            var parts = p.split('.');\r\n            return path(parts, scope);\r\n        };\r\n        var unsafe = function (name, scope) {\r\n            return resolve(name, scope);\r\n        };\r\n        var getOrDie = function (name, scope) {\r\n            var actual = unsafe(name, scope);\r\n            if (actual === undefined || actual === null)\r\n                throw name + ' not available on this browser';\r\n            return actual;\r\n        };\r\n        var Global$1 = { getOrDie: getOrDie };\r\n        var url = function () {\r\n            return Global$1.getOrDie('URL');\r\n        };\r\n        var createObjectURL = function (blob) {\r\n            return url().createObjectURL(blob);\r\n        };\r\n        var revokeObjectURL = function (u) {\r\n            url().revokeObjectURL(u);\r\n        };\r\n        var URL = {\r\n            createObjectURL: createObjectURL,\r\n            revokeObjectURL: revokeObjectURL\r\n        };\r\n        var nav = domGlobals.navigator, userAgent = nav.userAgent;\r\n        var opera, webkit, ie, ie11, ie12, gecko, mac, iDevice, android, fileApi, phone, tablet, windowsPhone;\r\n        var matchMediaQuery = function (query) {\r\n            return 'matchMedia' in domGlobals.window ? domGlobals.matchMedia(query).matches : false;\r\n        };\r\n        opera = false;\r\n        android = /Android/.test(userAgent);\r\n        webkit = /WebKit/.test(userAgent);\r\n        ie = !webkit && !opera && /MSIE/gi.test(userAgent) && /Explorer/gi.test(nav.appName);\r\n        ie = ie && /MSIE (\\w+)\\./.exec(userAgent)[1];\r\n        ie11 = userAgent.indexOf('Trident/') !== -1 && (userAgent.indexOf('rv:') !== -1 || nav.appName.indexOf('Netscape') !== -1) ? 11 : false;\r\n        ie12 = userAgent.indexOf('Edge/') !== -1 && !ie && !ie11 ? 12 : false;\r\n        ie = ie || ie11 || ie12;\r\n        gecko = !webkit && !ie11 && /Gecko/.test(userAgent);\r\n        mac = userAgent.indexOf('Mac') !== -1;\r\n        iDevice = /(iPad|iPhone)/.test(userAgent);\r\n        fileApi = 'FormData' in domGlobals.window && 'FileReader' in domGlobals.window && 'URL' in domGlobals.window && !!URL.createObjectURL;\r\n        phone = matchMediaQuery('only screen and (max-device-width: 480px)') && (android || iDevice);\r\n        tablet = matchMediaQuery('only screen and (min-width: 800px)') && (android || iDevice);\r\n        windowsPhone = userAgent.indexOf('Windows Phone') !== -1;\r\n        if (ie12) {\r\n            webkit = false;\r\n        }\r\n        var contentEditable = !iDevice || fileApi || parseInt(userAgent.match(/AppleWebKit\\/(\\d*)/)[1], 10) >= 534;\r\n        var Env = {\r\n            opera: opera,\r\n            webkit: webkit,\r\n            ie: ie,\r\n            gecko: gecko,\r\n            mac: mac,\r\n            iOS: iDevice,\r\n            android: android,\r\n            contentEditable: contentEditable,\r\n            transparentSrc: 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7',\r\n            caretAfter: ie !== 8,\r\n            range: domGlobals.window.getSelection && 'Range' in domGlobals.window,\r\n            documentMode: ie && !ie12 ? domGlobals.document.documentMode || 7 : 10,\r\n            fileApi: fileApi,\r\n            ceFalse: ie === false || ie > 8,\r\n            cacheSuffix: null,\r\n            container: null,\r\n            experimentalShadowDom: false,\r\n            canHaveCSP: ie === false || ie > 11,\r\n            desktop: !phone && !tablet,\r\n            windowsPhone: windowsPhone\r\n        };\r\n        var promise = function () {\r\n            function bind(fn, thisArg) {\r\n                return function () {\r\n                    fn.apply(thisArg, arguments);\r\n                };\r\n            }\r\n            var isArray = Array.isArray || function (value) {\r\n                return Object.prototype.toString.call(value) === '[object Array]';\r\n            };\r\n            var Promise = function (fn) {\r\n                if (typeof this !== 'object') {\r\n                    throw new TypeError('Promises must be constructed via new');\r\n                }\r\n                if (typeof fn !== 'function') {\r\n                    throw new TypeError('not a function');\r\n                }\r\n                this._state = null;\r\n                this._value = null;\r\n                this._deferreds = [];\r\n                doResolve(fn, bind(resolve, this), bind(reject, this));\r\n            };\r\n            var asap = Promise.immediateFn || typeof domGlobals.setImmediate === 'function' && domGlobals.setImmediate || function (fn) {\r\n                domGlobals.setTimeout(fn, 1);\r\n            };\r\n            function handle(deferred) {\r\n                var me = this;\r\n                if (this._state === null) {\r\n                    this._deferreds.push(deferred);\r\n                    return;\r\n                }\r\n                asap(function () {\r\n                    var cb = me._state ? deferred.onFulfilled : deferred.onRejected;\r\n                    if (cb === null) {\r\n                        (me._state ? deferred.resolve : deferred.reject)(me._value);\r\n                        return;\r\n                    }\r\n                    var ret;\r\n                    try {\r\n                        ret = cb(me._value);\r\n                    }\r\n                    catch (e) {\r\n                        deferred.reject(e);\r\n                        return;\r\n                    }\r\n                    deferred.resolve(ret);\r\n                });\r\n            }\r\n            function resolve(newValue) {\r\n                try {\r\n                    if (newValue === this) {\r\n                        throw new TypeError('A promise cannot be resolved with itself.');\r\n                    }\r\n                    if (newValue && (typeof newValue === 'object' || typeof newValue === 'function')) {\r\n                        var then = newValue.then;\r\n                        if (typeof then === 'function') {\r\n                            doResolve(bind(then, newValue), bind(resolve, this), bind(reject, this));\r\n                            return;\r\n                        }\r\n                    }\r\n                    this._state = true;\r\n                    this._value = newValue;\r\n                    finale.call(this);\r\n                }\r\n                catch (e) {\r\n                    reject.call(this, e);\r\n                }\r\n            }\r\n            function reject(newValue) {\r\n                this._state = false;\r\n                this._value = newValue;\r\n                finale.call(this);\r\n            }\r\n            function finale() {\r\n                for (var i = 0, len = this._deferreds.length; i < len; i++) {\r\n                    handle.call(this, this._deferreds[i]);\r\n                }\r\n                this._deferreds = null;\r\n            }\r\n            function Handler(onFulfilled, onRejected, resolve, reject) {\r\n                this.onFulfilled = typeof onFulfilled === 'function' ? onFulfilled : null;\r\n                this.onRejected = typeof onRejected === 'function' ? onRejected : null;\r\n                this.resolve = resolve;\r\n                this.reject = reject;\r\n            }\r\n            function doResolve(fn, onFulfilled, onRejected) {\r\n                var done = false;\r\n                try {\r\n                    fn(function (value) {\r\n                        if (done) {\r\n                            return;\r\n                        }\r\n                        done = true;\r\n                        onFulfilled(value);\r\n                    }, function (reason) {\r\n                        if (done) {\r\n                            return;\r\n                        }\r\n                        done = true;\r\n                        onRejected(reason);\r\n                    });\r\n                }\r\n                catch (ex) {\r\n                    if (done) {\r\n                        return;\r\n                    }\r\n                    done = true;\r\n                    onRejected(ex);\r\n                }\r\n            }\r\n            Promise.prototype.catch = function (onRejected) {\r\n                return this.then(null, onRejected);\r\n            };\r\n            Promise.prototype.then = function (onFulfilled, onRejected) {\r\n                var me = this;\r\n                return new Promise(function (resolve, reject) {\r\n                    handle.call(me, new Handler(onFulfilled, onRejected, resolve, reject));\r\n                });\r\n            };\r\n            Promise.all = function () {\r\n                var args = Array.prototype.slice.call(arguments.length === 1 && isArray(arguments[0]) ? arguments[0] : arguments);\r\n                return new Promise(function (resolve, reject) {\r\n                    if (args.length === 0) {\r\n                        return resolve([]);\r\n                    }\r\n                    var remaining = args.length;\r\n                    function res(i, val) {\r\n                        try {\r\n                            if (val && (typeof val === 'object' || typeof val === 'function')) {\r\n                                var then = val.then;\r\n                                if (typeof then === 'function') {\r\n                                    then.call(val, function (val) {\r\n                                        res(i, val);\r\n                                    }, reject);\r\n                                    return;\r\n                                }\r\n                            }\r\n                            args[i] = val;\r\n                            if (--remaining === 0) {\r\n                                resolve(args);\r\n                            }\r\n                        }\r\n                        catch (ex) {\r\n                            reject(ex);\r\n                        }\r\n                    }\r\n                    for (var i = 0; i < args.length; i++) {\r\n                        res(i, args[i]);\r\n                    }\r\n                });\r\n            };\r\n            Promise.resolve = function (value) {\r\n                if (value && typeof value === 'object' && value.constructor === Promise) {\r\n                    return value;\r\n                }\r\n                return new Promise(function (resolve) {\r\n                    resolve(value);\r\n                });\r\n            };\r\n            Promise.reject = function (value) {\r\n                return new Promise(function (resolve, reject) {\r\n                    reject(value);\r\n                });\r\n            };\r\n            Promise.race = function (values) {\r\n                return new Promise(function (resolve, reject) {\r\n                    for (var i = 0, len = values.length; i < len; i++) {\r\n                        values[i].then(resolve, reject);\r\n                    }\r\n                });\r\n            };\r\n            return Promise;\r\n        };\r\n        var promiseObj = window.Promise ? window.Promise : promise();\r\n        var requestAnimationFramePromise;\r\n        var requestAnimationFrame = function (callback, element) {\r\n            var i, requestAnimationFrameFunc = domGlobals.window.requestAnimationFrame;\r\n            var vendors = [\r\n                'ms',\r\n                'moz',\r\n                'webkit'\r\n            ];\r\n            var featurefill = function (callback) {\r\n                domGlobals.window.setTimeout(callback, 0);\r\n            };\r\n            for (i = 0; i < vendors.length && !requestAnimationFrameFunc; i++) {\r\n                requestAnimationFrameFunc = domGlobals.window[vendors[i] + 'RequestAnimationFrame'];\r\n            }\r\n            if (!requestAnimationFrameFunc) {\r\n                requestAnimationFrameFunc = featurefill;\r\n            }\r\n            requestAnimationFrameFunc(callback, element);\r\n        };\r\n        var wrappedSetTimeout = function (callback, time) {\r\n            if (typeof time !== 'number') {\r\n                time = 0;\r\n            }\r\n            return domGlobals.setTimeout(callback, time);\r\n        };\r\n        var wrappedSetInterval = function (callback, time) {\r\n            if (typeof time !== 'number') {\r\n                time = 1;\r\n            }\r\n            return domGlobals.setInterval(callback, time);\r\n        };\r\n        var wrappedClearTimeout = function (id) {\r\n            return domGlobals.clearTimeout(id);\r\n        };\r\n        var wrappedClearInterval = function (id) {\r\n            return domGlobals.clearInterval(id);\r\n        };\r\n        var debounce = function (callback, time) {\r\n            var timer, func;\r\n            func = function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                domGlobals.clearTimeout(timer);\r\n                timer = wrappedSetTimeout(function () {\r\n                    callback.apply(this, args);\r\n                }, time);\r\n            };\r\n            func.stop = function () {\r\n                domGlobals.clearTimeout(timer);\r\n            };\r\n            return func;\r\n        };\r\n        var Delay = {\r\n            requestAnimationFrame: function (callback, element) {\r\n                if (requestAnimationFramePromise) {\r\n                    requestAnimationFramePromise.then(callback);\r\n                    return;\r\n                }\r\n                requestAnimationFramePromise = new promiseObj(function (resolve) {\r\n                    if (!element) {\r\n                        element = domGlobals.document.body;\r\n                    }\r\n                    requestAnimationFrame(resolve, element);\r\n                }).then(callback);\r\n            },\r\n            setTimeout: wrappedSetTimeout,\r\n            setInterval: wrappedSetInterval,\r\n            setEditorTimeout: function (editor, callback, time) {\r\n                return wrappedSetTimeout(function () {\r\n                    if (!editor.removed) {\r\n                        callback();\r\n                    }\r\n                }, time);\r\n            },\r\n            setEditorInterval: function (editor, callback, time) {\r\n                var timer;\r\n                timer = wrappedSetInterval(function () {\r\n                    if (!editor.removed) {\r\n                        callback();\r\n                    }\r\n                    else {\r\n                        domGlobals.clearInterval(timer);\r\n                    }\r\n                }, time);\r\n                return timer;\r\n            },\r\n            debounce: debounce,\r\n            throttle: debounce,\r\n            clearInterval: wrappedClearInterval,\r\n            clearTimeout: wrappedClearTimeout\r\n        };\r\n        var eventExpandoPrefix = 'mce-data-';\r\n        var mouseEventRe = /^(?:mouse|contextmenu)|click/;\r\n        var deprecated = {\r\n            keyLocation: 1,\r\n            layerX: 1,\r\n            layerY: 1,\r\n            returnValue: 1,\r\n            webkitMovementX: 1,\r\n            webkitMovementY: 1,\r\n            keyIdentifier: 1\r\n        };\r\n        var hasIsDefaultPrevented = function (event) {\r\n            return event.isDefaultPrevented === returnTrue || event.isDefaultPrevented === returnFalse;\r\n        };\r\n        var returnFalse = function () {\r\n            return false;\r\n        };\r\n        var returnTrue = function () {\r\n            return true;\r\n        };\r\n        var addEvent = function (target, name, callback, capture) {\r\n            if (target.addEventListener) {\r\n                target.addEventListener(name, callback, capture || false);\r\n            }\r\n            else if (target.attachEvent) {\r\n                target.attachEvent('on' + name, callback);\r\n            }\r\n        };\r\n        var removeEvent = function (target, name, callback, capture) {\r\n            if (target.removeEventListener) {\r\n                target.removeEventListener(name, callback, capture || false);\r\n            }\r\n            else if (target.detachEvent) {\r\n                target.detachEvent('on' + name, callback);\r\n            }\r\n        };\r\n        var getTargetFromShadowDom = function (event, defaultTarget) {\r\n            if (event.composedPath) {\r\n                var composedPath = event.composedPath();\r\n                if (composedPath && composedPath.length > 0) {\r\n                    return composedPath[0];\r\n                }\r\n            }\r\n            return defaultTarget;\r\n        };\r\n        var fix = function (originalEvent, data) {\r\n            var name;\r\n            var event = data || {};\r\n            for (name in originalEvent) {\r\n                if (!deprecated[name]) {\r\n                    event[name] = originalEvent[name];\r\n                }\r\n            }\r\n            if (!event.target) {\r\n                event.target = event.srcElement || domGlobals.document;\r\n            }\r\n            if (Env.experimentalShadowDom) {\r\n                event.target = getTargetFromShadowDom(originalEvent, event.target);\r\n            }\r\n            if (originalEvent && mouseEventRe.test(originalEvent.type) && originalEvent.pageX === undefined && originalEvent.clientX !== undefined) {\r\n                var eventDoc = event.target.ownerDocument || domGlobals.document;\r\n                var doc = eventDoc.documentElement;\r\n                var body = eventDoc.body;\r\n                event.pageX = originalEvent.clientX + (doc && doc.scrollLeft || body && body.scrollLeft || 0) - (doc && doc.clientLeft || body && body.clientLeft || 0);\r\n                event.pageY = originalEvent.clientY + (doc && doc.scrollTop || body && body.scrollTop || 0) - (doc && doc.clientTop || body && body.clientTop || 0);\r\n            }\r\n            event.preventDefault = function () {\r\n                event.isDefaultPrevented = returnTrue;\r\n                if (originalEvent) {\r\n                    if (originalEvent.preventDefault) {\r\n                        originalEvent.preventDefault();\r\n                    }\r\n                    else {\r\n                        originalEvent.returnValue = false;\r\n                    }\r\n                }\r\n            };\r\n            event.stopPropagation = function () {\r\n                event.isPropagationStopped = returnTrue;\r\n                if (originalEvent) {\r\n                    if (originalEvent.stopPropagation) {\r\n                        originalEvent.stopPropagation();\r\n                    }\r\n                    else {\r\n                        originalEvent.cancelBubble = true;\r\n                    }\r\n                }\r\n            };\r\n            event.stopImmediatePropagation = function () {\r\n                event.isImmediatePropagationStopped = returnTrue;\r\n                event.stopPropagation();\r\n            };\r\n            if (hasIsDefaultPrevented(event) === false) {\r\n                event.isDefaultPrevented = returnFalse;\r\n                event.isPropagationStopped = returnFalse;\r\n                event.isImmediatePropagationStopped = returnFalse;\r\n            }\r\n            if (typeof event.metaKey === 'undefined') {\r\n                event.metaKey = false;\r\n            }\r\n            return event;\r\n        };\r\n        var bindOnReady = function (win, callback, eventUtils) {\r\n            var doc = win.document, event = { type: 'ready' };\r\n            if (eventUtils.domLoaded) {\r\n                callback(event);\r\n                return;\r\n            }\r\n            var isDocReady = function () {\r\n                return doc.readyState === 'complete' || doc.readyState === 'interactive' && doc.body;\r\n            };\r\n            var readyHandler = function () {\r\n                removeEvent(win, 'DOMContentLoaded', readyHandler);\r\n                removeEvent(win, 'load', readyHandler);\r\n                if (!eventUtils.domLoaded) {\r\n                    eventUtils.domLoaded = true;\r\n                    callback(event);\r\n                }\r\n            };\r\n            var waitForDomLoaded = function () {\r\n                if (isDocReady()) {\r\n                    removeEvent(doc, 'readystatechange', waitForDomLoaded);\r\n                    readyHandler();\r\n                }\r\n            };\r\n            var tryScroll = function () {\r\n                try {\r\n                    doc.documentElement.doScroll('left');\r\n                }\r\n                catch (ex) {\r\n                    Delay.setTimeout(tryScroll);\r\n                    return;\r\n                }\r\n                readyHandler();\r\n            };\r\n            if (doc.addEventListener && !(Env.ie && Env.ie < 11)) {\r\n                if (isDocReady()) {\r\n                    readyHandler();\r\n                }\r\n                else {\r\n                    addEvent(win, 'DOMContentLoaded', readyHandler);\r\n                }\r\n            }\r\n            else {\r\n                addEvent(doc, 'readystatechange', waitForDomLoaded);\r\n                if (doc.documentElement.doScroll && win.self === win.top) {\r\n                    tryScroll();\r\n                }\r\n            }\r\n            addEvent(win, 'load', readyHandler);\r\n        };\r\n        var EventUtils = function () {\r\n            function EventUtils() {\r\n                this.domLoaded = false;\r\n                this.events = {};\r\n                this.count = 1;\r\n                this.expando = eventExpandoPrefix + (+new Date()).toString(32);\r\n                this.hasMouseEnterLeave = 'onmouseenter' in domGlobals.document.documentElement;\r\n                this.hasFocusIn = 'onfocusin' in domGlobals.document.documentElement;\r\n                this.count = 1;\r\n            }\r\n            EventUtils.prototype.bind = function (target, names, callback, scope) {\r\n                var self = this;\r\n                var id, callbackList, i, name, fakeName, nativeHandler, capture;\r\n                var win = domGlobals.window;\r\n                var defaultNativeHandler = function (evt) {\r\n                    self.executeHandlers(fix(evt || win.event), id);\r\n                };\r\n                if (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n                    return;\r\n                }\r\n                if (!target[self.expando]) {\r\n                    id = self.count++;\r\n                    target[self.expando] = id;\r\n                    self.events[id] = {};\r\n                }\r\n                else {\r\n                    id = target[self.expando];\r\n                }\r\n                scope = scope || target;\r\n                var namesList = names.split(' ');\r\n                i = namesList.length;\r\n                while (i--) {\r\n                    name = namesList[i];\r\n                    nativeHandler = defaultNativeHandler;\r\n                    fakeName = capture = false;\r\n                    if (name === 'DOMContentLoaded') {\r\n                        name = 'ready';\r\n                    }\r\n                    if (self.domLoaded && name === 'ready' && target.readyState === 'complete') {\r\n                        callback.call(scope, fix({ type: name }));\r\n                        continue;\r\n                    }\r\n                    if (!self.hasMouseEnterLeave) {\r\n                        fakeName = self.mouseEnterLeave[name];\r\n                        if (fakeName) {\r\n                            nativeHandler = function (evt) {\r\n                                var current, related;\r\n                                current = evt.currentTarget;\r\n                                related = evt.relatedTarget;\r\n                                if (related && current.contains) {\r\n                                    related = current.contains(related);\r\n                                }\r\n                                else {\r\n                                    while (related && related !== current) {\r\n                                        related = related.parentNode;\r\n                                    }\r\n                                }\r\n                                if (!related) {\r\n                                    evt = fix(evt || win.event);\r\n                                    evt.type = evt.type === 'mouseout' ? 'mouseleave' : 'mouseenter';\r\n                                    evt.target = current;\r\n                                    self.executeHandlers(evt, id);\r\n                                }\r\n                            };\r\n                        }\r\n                    }\r\n                    if (!self.hasFocusIn && (name === 'focusin' || name === 'focusout')) {\r\n                        capture = true;\r\n                        fakeName = name === 'focusin' ? 'focus' : 'blur';\r\n                        nativeHandler = function (evt) {\r\n                            evt = fix(evt || win.event);\r\n                            evt.type = evt.type === 'focus' ? 'focusin' : 'focusout';\r\n                            self.executeHandlers(evt, id);\r\n                        };\r\n                    }\r\n                    callbackList = self.events[id][name];\r\n                    if (!callbackList) {\r\n                        self.events[id][name] = callbackList = [{\r\n                                func: callback,\r\n                                scope: scope\r\n                            }];\r\n                        callbackList.fakeName = fakeName;\r\n                        callbackList.capture = capture;\r\n                        callbackList.nativeHandler = nativeHandler;\r\n                        if (name === 'ready') {\r\n                            bindOnReady(target, nativeHandler, self);\r\n                        }\r\n                        else {\r\n                            addEvent(target, fakeName || name, nativeHandler, capture);\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (name === 'ready' && self.domLoaded) {\r\n                            callback(fix({ type: name }));\r\n                        }\r\n                        else {\r\n                            callbackList.push({\r\n                                func: callback,\r\n                                scope: scope\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                target = callbackList = 0;\r\n                return callback;\r\n            };\r\n            EventUtils.prototype.unbind = function (target, names, callback) {\r\n                var id, callbackList, i, ci, name, eventMap;\r\n                if (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n                    return this;\r\n                }\r\n                id = target[this.expando];\r\n                if (id) {\r\n                    eventMap = this.events[id];\r\n                    if (names) {\r\n                        var namesList = names.split(' ');\r\n                        i = namesList.length;\r\n                        while (i--) {\r\n                            name = namesList[i];\r\n                            callbackList = eventMap[name];\r\n                            if (callbackList) {\r\n                                if (callback) {\r\n                                    ci = callbackList.length;\r\n                                    while (ci--) {\r\n                                        if (callbackList[ci].func === callback) {\r\n                                            var nativeHandler = callbackList.nativeHandler;\r\n                                            var fakeName = callbackList.fakeName, capture = callbackList.capture;\r\n                                            callbackList = callbackList.slice(0, ci).concat(callbackList.slice(ci + 1));\r\n                                            callbackList.nativeHandler = nativeHandler;\r\n                                            callbackList.fakeName = fakeName;\r\n                                            callbackList.capture = capture;\r\n                                            eventMap[name] = callbackList;\r\n                                        }\r\n                                    }\r\n                                }\r\n                                if (!callback || callbackList.length === 0) {\r\n                                    delete eventMap[name];\r\n                                    removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        for (name in eventMap) {\r\n                            callbackList = eventMap[name];\r\n                            removeEvent(target, callbackList.fakeName || name, callbackList.nativeHandler, callbackList.capture);\r\n                        }\r\n                        eventMap = {};\r\n                    }\r\n                    for (name in eventMap) {\r\n                        return this;\r\n                    }\r\n                    delete this.events[id];\r\n                    try {\r\n                        delete target[this.expando];\r\n                    }\r\n                    catch (ex) {\r\n                        target[this.expando] = null;\r\n                    }\r\n                }\r\n                return this;\r\n            };\r\n            EventUtils.prototype.fire = function (target, name, args) {\r\n                var id;\r\n                if (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n                    return this;\r\n                }\r\n                var event = fix(null, args);\r\n                event.type = name;\r\n                event.target = target;\r\n                do {\r\n                    id = target[this.expando];\r\n                    if (id) {\r\n                        this.executeHandlers(event, id);\r\n                    }\r\n                    target = target.parentNode || target.ownerDocument || target.defaultView || target.parentWindow;\r\n                } while (target && !event.isPropagationStopped());\r\n                return this;\r\n            };\r\n            EventUtils.prototype.clean = function (target) {\r\n                var i, children;\r\n                if (!target || target.nodeType === 3 || target.nodeType === 8) {\r\n                    return this;\r\n                }\r\n                if (target[this.expando]) {\r\n                    this.unbind(target);\r\n                }\r\n                if (!target.getElementsByTagName) {\r\n                    target = target.document;\r\n                }\r\n                if (target && target.getElementsByTagName) {\r\n                    this.unbind(target);\r\n                    children = target.getElementsByTagName('*');\r\n                    i = children.length;\r\n                    while (i--) {\r\n                        target = children[i];\r\n                        if (target[this.expando]) {\r\n                            this.unbind(target);\r\n                        }\r\n                    }\r\n                }\r\n                return this;\r\n            };\r\n            EventUtils.prototype.destroy = function () {\r\n                this.events = {};\r\n            };\r\n            EventUtils.prototype.cancel = function (e) {\r\n                if (e) {\r\n                    e.preventDefault();\r\n                    e.stopImmediatePropagation();\r\n                }\r\n                return false;\r\n            };\r\n            EventUtils.prototype.executeHandlers = function (evt, id) {\r\n                var callbackList, i, l, callback;\r\n                var container = this.events[id];\r\n                callbackList = container && container[evt.type];\r\n                if (callbackList) {\r\n                    for (i = 0, l = callbackList.length; i < l; i++) {\r\n                        callback = callbackList[i];\r\n                        if (callback && callback.func.call(callback.scope, evt) === false) {\r\n                            evt.preventDefault();\r\n                        }\r\n                        if (evt.isImmediatePropagationStopped()) {\r\n                            return;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            EventUtils.Event = new EventUtils();\r\n            return EventUtils;\r\n        }();\r\n        var i, support, Expr, getText, isXML, tokenize, compile, select, outermostContext, sortInput, hasDuplicate, setDocument, document, docElem, documentIsHTML, rbuggyQSA, rbuggyMatches, matches, contains$1, expando = 'sizzle' + -new Date(), preferredDoc = domGlobals.window.document, dirruns = 0, done = 0, classCache = createCache(), tokenCache = createCache(), compilerCache = createCache(), sortOrder = function (a, b) {\r\n            if (a === b) {\r\n                hasDuplicate = true;\r\n            }\r\n            return 0;\r\n        }, strundefined = typeof undefined, MAX_NEGATIVE = 1 << 31, hasOwn = {}.hasOwnProperty, arr = [], pop = arr.pop, push_native = arr.push, push$1 = arr.push, slice$1 = arr.slice, indexOf$1 = arr.indexOf || function (elem) {\r\n            var i = 0, len = this.length;\r\n            for (; i < len; i++) {\r\n                if (this[i] === elem) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        }, booleans = 'checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped', whitespace = '[\\\\x20\\\\t\\\\r\\\\n\\\\f]', identifier = '(?:\\\\\\\\.|[\\\\w-]|[^\\\\x00-\\\\xa0])+', attributes = '\\\\[' + whitespace + '*(' + identifier + ')(?:' + whitespace + '*([*^$|!~]?=)' + whitespace + '*(?:\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\"|(' + identifier + '))|)' + whitespace + '*\\\\]', pseudos = ':(' + identifier + ')(?:\\\\((' + '(\\'((?:\\\\\\\\.|[^\\\\\\\\\\'])*)\\'|\"((?:\\\\\\\\.|[^\\\\\\\\\"])*)\")|' + '((?:\\\\\\\\.|[^\\\\\\\\()[\\\\]]|' + attributes + ')*)|' + '.*' + ')\\\\)|)', rtrim = new RegExp('^' + whitespace + '+|((?:^|[^\\\\\\\\])(?:\\\\\\\\.)*)' + whitespace + '+$', 'g'), rcomma = new RegExp('^' + whitespace + '*,' + whitespace + '*'), rcombinators = new RegExp('^' + whitespace + '*([>+~]|' + whitespace + ')' + whitespace + '*'), rattributeQuotes = new RegExp('=' + whitespace + '*([^\\\\]\\'\"]*?)' + whitespace + '*\\\\]', 'g'), rpseudo = new RegExp(pseudos), ridentifier = new RegExp('^' + identifier + '$'), matchExpr = {\r\n            ID: new RegExp('^#(' + identifier + ')'),\r\n            CLASS: new RegExp('^\\\\.(' + identifier + ')'),\r\n            TAG: new RegExp('^(' + identifier + '|[*])'),\r\n            ATTR: new RegExp('^' + attributes),\r\n            PSEUDO: new RegExp('^' + pseudos),\r\n            CHILD: new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\\\(' + whitespace + '*(even|odd|(([+-]|)(\\\\d*)n|)' + whitespace + '*(?:([+-]|)' + whitespace + '*(\\\\d+)|))' + whitespace + '*\\\\)|)', 'i'),\r\n            bool: new RegExp('^(?:' + booleans + ')$', 'i'),\r\n            needsContext: new RegExp('^' + whitespace + '*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\\\(' + whitespace + '*((?:-\\\\d)?\\\\d*)' + whitespace + '*\\\\)|)(?=[^-]|$)', 'i')\r\n        }, rinputs = /^(?:input|select|textarea|button)$/i, rheader = /^h\\d$/i, rnative = /^[^{]+\\{\\s*\\[native \\w/, rquickExpr = /^(?:#([\\w-]+)|(\\w+)|\\.([\\w-]+))$/, rsibling = /[+~]/, rescape = /'|\\\\/g, runescape = new RegExp('\\\\\\\\([\\\\da-f]{1,6}' + whitespace + '?|(' + whitespace + ')|.)', 'ig'), funescape = function (_, escaped, escapedWhitespace) {\r\n            var high = '0x' + escaped - 65536;\r\n            return high !== high || escapedWhitespace ? escaped : high < 0 ? String.fromCharCode(high + 65536) : String.fromCharCode(high >> 10 | 55296, high & 1023 | 56320);\r\n        };\r\n        try {\r\n            push$1.apply(arr = slice$1.call(preferredDoc.childNodes), preferredDoc.childNodes);\r\n            arr[preferredDoc.childNodes.length].nodeType;\r\n        }\r\n        catch (e) {\r\n            push$1 = {\r\n                apply: arr.length ? function (target, els) {\r\n                    push_native.apply(target, slice$1.call(els));\r\n                } : function (target, els) {\r\n                    var j = target.length, i = 0;\r\n                    while (target[j++] = els[i++]) {\r\n                    }\r\n                    target.length = j - 1;\r\n                }\r\n            };\r\n        }\r\n        var Sizzle = function (selector, context, results, seed) {\r\n            var match, elem, m, nodeType, i, groups, old, nid, newContext, newSelector;\r\n            if ((context ? context.ownerDocument || context : preferredDoc) !== document) {\r\n                setDocument(context);\r\n            }\r\n            context = context || document;\r\n            results = results || [];\r\n            if (!selector || typeof selector !== 'string') {\r\n                return results;\r\n            }\r\n            if ((nodeType = context.nodeType) !== 1 && nodeType !== 9) {\r\n                return [];\r\n            }\r\n            if (documentIsHTML && !seed) {\r\n                if (match = rquickExpr.exec(selector)) {\r\n                    if (m = match[1]) {\r\n                        if (nodeType === 9) {\r\n                            elem = context.getElementById(m);\r\n                            if (elem && elem.parentNode) {\r\n                                if (elem.id === m) {\r\n                                    results.push(elem);\r\n                                    return results;\r\n                                }\r\n                            }\r\n                            else {\r\n                                return results;\r\n                            }\r\n                        }\r\n                        else {\r\n                            if (context.ownerDocument && (elem = context.ownerDocument.getElementById(m)) && contains$1(context, elem) && elem.id === m) {\r\n                                results.push(elem);\r\n                                return results;\r\n                            }\r\n                        }\r\n                    }\r\n                    else if (match[2]) {\r\n                        push$1.apply(results, context.getElementsByTagName(selector));\r\n                        return results;\r\n                    }\r\n                    else if ((m = match[3]) && support.getElementsByClassName) {\r\n                        push$1.apply(results, context.getElementsByClassName(m));\r\n                        return results;\r\n                    }\r\n                }\r\n                if (support.qsa && (!rbuggyQSA || !rbuggyQSA.test(selector))) {\r\n                    nid = old = expando;\r\n                    newContext = context;\r\n                    newSelector = nodeType === 9 && selector;\r\n                    if (nodeType === 1 && context.nodeName.toLowerCase() !== 'object') {\r\n                        groups = tokenize(selector);\r\n                        if (old = context.getAttribute('id')) {\r\n                            nid = old.replace(rescape, '\\\\$&');\r\n                        }\r\n                        else {\r\n                            context.setAttribute('id', nid);\r\n                        }\r\n                        nid = '[id=\\'' + nid + '\\'] ';\r\n                        i = groups.length;\r\n                        while (i--) {\r\n                            groups[i] = nid + toSelector(groups[i]);\r\n                        }\r\n                        newContext = rsibling.test(selector) && testContext(context.parentNode) || context;\r\n                        newSelector = groups.join(',');\r\n                    }\r\n                    if (newSelector) {\r\n                        try {\r\n                            push$1.apply(results, newContext.querySelectorAll(newSelector));\r\n                            return results;\r\n                        }\r\n                        catch (qsaError) {\r\n                        }\r\n                        finally {\r\n                            if (!old) {\r\n                                context.removeAttribute('id');\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return select(selector.replace(rtrim, '$1'), context, results, seed);\r\n        };\r\n        function createCache() {\r\n            var keys = [];\r\n            function cache(key, value) {\r\n                if (keys.push(key + ' ') > Expr.cacheLength) {\r\n                    delete cache[keys.shift()];\r\n                }\r\n                return cache[key + ' '] = value;\r\n            }\r\n            return cache;\r\n        }\r\n        function markFunction(fn) {\r\n            fn[expando] = true;\r\n            return fn;\r\n        }\r\n        function siblingCheck(a, b) {\r\n            var cur = b && a, diff = cur && a.nodeType === 1 && b.nodeType === 1 && (~b.sourceIndex || MAX_NEGATIVE) - (~a.sourceIndex || MAX_NEGATIVE);\r\n            if (diff) {\r\n                return diff;\r\n            }\r\n            if (cur) {\r\n                while (cur = cur.nextSibling) {\r\n                    if (cur === b) {\r\n                        return -1;\r\n                    }\r\n                }\r\n            }\r\n            return a ? 1 : -1;\r\n        }\r\n        function createInputPseudo(type) {\r\n            return function (elem) {\r\n                var name = elem.nodeName.toLowerCase();\r\n                return name === 'input' && elem.type === type;\r\n            };\r\n        }\r\n        function createButtonPseudo(type) {\r\n            return function (elem) {\r\n                var name = elem.nodeName.toLowerCase();\r\n                return (name === 'input' || name === 'button') && elem.type === type;\r\n            };\r\n        }\r\n        function createPositionalPseudo(fn) {\r\n            return markFunction(function (argument) {\r\n                argument = +argument;\r\n                return markFunction(function (seed, matches) {\r\n                    var j, matchIndexes = fn([], seed.length, argument), i = matchIndexes.length;\r\n                    while (i--) {\r\n                        if (seed[j = matchIndexes[i]]) {\r\n                            seed[j] = !(matches[j] = seed[j]);\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n        }\r\n        function testContext(context) {\r\n            return context && typeof context.getElementsByTagName !== strundefined && context;\r\n        }\r\n        support = Sizzle.support = {};\r\n        isXML = Sizzle.isXML = function (elem) {\r\n            var documentElement = elem && (elem.ownerDocument || elem).documentElement;\r\n            return documentElement ? documentElement.nodeName !== 'HTML' : false;\r\n        };\r\n        setDocument = Sizzle.setDocument = function (node) {\r\n            var hasCompare, doc = node ? node.ownerDocument || node : preferredDoc, parent = doc.defaultView;\r\n            function getTop(win) {\r\n                try {\r\n                    return win.top;\r\n                }\r\n                catch (ex) {\r\n                }\r\n                return null;\r\n            }\r\n            if (doc === document || doc.nodeType !== 9 || !doc.documentElement) {\r\n                return document;\r\n            }\r\n            document = doc;\r\n            docElem = doc.documentElement;\r\n            documentIsHTML = !isXML(doc);\r\n            if (parent && parent !== getTop(parent)) {\r\n                if (parent.addEventListener) {\r\n                    parent.addEventListener('unload', function () {\r\n                        setDocument();\r\n                    }, false);\r\n                }\r\n                else if (parent.attachEvent) {\r\n                    parent.attachEvent('onunload', function () {\r\n                        setDocument();\r\n                    });\r\n                }\r\n            }\r\n            support.attributes = true;\r\n            support.getElementsByTagName = true;\r\n            support.getElementsByClassName = rnative.test(doc.getElementsByClassName);\r\n            support.getById = true;\r\n            Expr.find.ID = function (id, context) {\r\n                if (typeof context.getElementById !== strundefined && documentIsHTML) {\r\n                    var m = context.getElementById(id);\r\n                    return m && m.parentNode ? [m] : [];\r\n                }\r\n            };\r\n            Expr.filter.ID = function (id) {\r\n                var attrId = id.replace(runescape, funescape);\r\n                return function (elem) {\r\n                    return elem.getAttribute('id') === attrId;\r\n                };\r\n            };\r\n            Expr.find.TAG = support.getElementsByTagName ? function (tag, context) {\r\n                if (typeof context.getElementsByTagName !== strundefined) {\r\n                    return context.getElementsByTagName(tag);\r\n                }\r\n            } : function (tag, context) {\r\n                var elem, tmp = [], i = 0, results = context.getElementsByTagName(tag);\r\n                if (tag === '*') {\r\n                    while (elem = results[i++]) {\r\n                        if (elem.nodeType === 1) {\r\n                            tmp.push(elem);\r\n                        }\r\n                    }\r\n                    return tmp;\r\n                }\r\n                return results;\r\n            };\r\n            Expr.find.CLASS = support.getElementsByClassName && function (className, context) {\r\n                if (documentIsHTML) {\r\n                    return context.getElementsByClassName(className);\r\n                }\r\n            };\r\n            rbuggyMatches = [];\r\n            rbuggyQSA = [];\r\n            support.disconnectedMatch = true;\r\n            rbuggyQSA = rbuggyQSA.length && new RegExp(rbuggyQSA.join('|'));\r\n            rbuggyMatches = rbuggyMatches.length && new RegExp(rbuggyMatches.join('|'));\r\n            hasCompare = rnative.test(docElem.compareDocumentPosition);\r\n            contains$1 = hasCompare || rnative.test(docElem.contains) ? function (a, b) {\r\n                var adown = a.nodeType === 9 ? a.documentElement : a, bup = b && b.parentNode;\r\n                return a === bup || !!(bup && bup.nodeType === 1 && (adown.contains ? adown.contains(bup) : a.compareDocumentPosition && a.compareDocumentPosition(bup) & 16));\r\n            } : function (a, b) {\r\n                if (b) {\r\n                    while (b = b.parentNode) {\r\n                        if (b === a) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n            sortOrder = hasCompare ? function (a, b) {\r\n                if (a === b) {\r\n                    hasDuplicate = true;\r\n                    return 0;\r\n                }\r\n                var compare = !a.compareDocumentPosition - !b.compareDocumentPosition;\r\n                if (compare) {\r\n                    return compare;\r\n                }\r\n                compare = (a.ownerDocument || a) === (b.ownerDocument || b) ? a.compareDocumentPosition(b) : 1;\r\n                if (compare & 1 || !support.sortDetached && b.compareDocumentPosition(a) === compare) {\r\n                    if (a === doc || a.ownerDocument === preferredDoc && contains$1(preferredDoc, a)) {\r\n                        return -1;\r\n                    }\r\n                    if (b === doc || b.ownerDocument === preferredDoc && contains$1(preferredDoc, b)) {\r\n                        return 1;\r\n                    }\r\n                    return sortInput ? indexOf$1.call(sortInput, a) - indexOf$1.call(sortInput, b) : 0;\r\n                }\r\n                return compare & 4 ? -1 : 1;\r\n            } : function (a, b) {\r\n                if (a === b) {\r\n                    hasDuplicate = true;\r\n                    return 0;\r\n                }\r\n                var cur, i = 0, aup = a.parentNode, bup = b.parentNode, ap = [a], bp = [b];\r\n                if (!aup || !bup) {\r\n                    return a === doc ? -1 : b === doc ? 1 : aup ? -1 : bup ? 1 : sortInput ? indexOf$1.call(sortInput, a) - indexOf$1.call(sortInput, b) : 0;\r\n                }\r\n                else if (aup === bup) {\r\n                    return siblingCheck(a, b);\r\n                }\r\n                cur = a;\r\n                while (cur = cur.parentNode) {\r\n                    ap.unshift(cur);\r\n                }\r\n                cur = b;\r\n                while (cur = cur.parentNode) {\r\n                    bp.unshift(cur);\r\n                }\r\n                while (ap[i] === bp[i]) {\r\n                    i++;\r\n                }\r\n                return i ? siblingCheck(ap[i], bp[i]) : ap[i] === preferredDoc ? -1 : bp[i] === preferredDoc ? 1 : 0;\r\n            };\r\n            return doc;\r\n        };\r\n        Sizzle.matches = function (expr, elements) {\r\n            return Sizzle(expr, null, null, elements);\r\n        };\r\n        Sizzle.matchesSelector = function (elem, expr) {\r\n            if ((elem.ownerDocument || elem) !== document) {\r\n                setDocument(elem);\r\n            }\r\n            expr = expr.replace(rattributeQuotes, '=\\'$1\\']');\r\n            if (support.matchesSelector && documentIsHTML && (!rbuggyMatches || !rbuggyMatches.test(expr)) && (!rbuggyQSA || !rbuggyQSA.test(expr))) {\r\n                try {\r\n                    var ret = matches.call(elem, expr);\r\n                    if (ret || support.disconnectedMatch || elem.document && elem.document.nodeType !== 11) {\r\n                        return ret;\r\n                    }\r\n                }\r\n                catch (e) {\r\n                }\r\n            }\r\n            return Sizzle(expr, document, null, [elem]).length > 0;\r\n        };\r\n        Sizzle.contains = function (context, elem) {\r\n            if ((context.ownerDocument || context) !== document) {\r\n                setDocument(context);\r\n            }\r\n            return contains$1(context, elem);\r\n        };\r\n        Sizzle.attr = function (elem, name) {\r\n            if ((elem.ownerDocument || elem) !== document) {\r\n                setDocument(elem);\r\n            }\r\n            var fn = Expr.attrHandle[name.toLowerCase()], val = fn && hasOwn.call(Expr.attrHandle, name.toLowerCase()) ? fn(elem, name, !documentIsHTML) : undefined;\r\n            return val !== undefined ? val : support.attributes || !documentIsHTML ? elem.getAttribute(name) : (val = elem.getAttributeNode(name)) && val.specified ? val.value : null;\r\n        };\r\n        Sizzle.error = function (msg) {\r\n            throw new Error('Syntax error, unrecognized expression: ' + msg);\r\n        };\r\n        Sizzle.uniqueSort = function (results) {\r\n            var elem, duplicates = [], j = 0, i = 0;\r\n            hasDuplicate = !support.detectDuplicates;\r\n            sortInput = !support.sortStable && results.slice(0);\r\n            results.sort(sortOrder);\r\n            if (hasDuplicate) {\r\n                while (elem = results[i++]) {\r\n                    if (elem === results[i]) {\r\n                        j = duplicates.push(i);\r\n                    }\r\n                }\r\n                while (j--) {\r\n                    results.splice(duplicates[j], 1);\r\n                }\r\n            }\r\n            sortInput = null;\r\n            return results;\r\n        };\r\n        getText = Sizzle.getText = function (elem) {\r\n            var node, ret = '', i = 0, nodeType = elem.nodeType;\r\n            if (!nodeType) {\r\n                while (node = elem[i++]) {\r\n                    ret += getText(node);\r\n                }\r\n            }\r\n            else if (nodeType === 1 || nodeType === 9 || nodeType === 11) {\r\n                if (typeof elem.textContent === 'string') {\r\n                    return elem.textContent;\r\n                }\r\n                else {\r\n                    for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\r\n                        ret += getText(elem);\r\n                    }\r\n                }\r\n            }\r\n            else if (nodeType === 3 || nodeType === 4) {\r\n                return elem.nodeValue;\r\n            }\r\n            return ret;\r\n        };\r\n        Expr = Sizzle.selectors = {\r\n            cacheLength: 50,\r\n            createPseudo: markFunction,\r\n            match: matchExpr,\r\n            attrHandle: {},\r\n            find: {},\r\n            relative: {\r\n                '>': {\r\n                    dir: 'parentNode',\r\n                    first: true\r\n                },\r\n                ' ': { dir: 'parentNode' },\r\n                '+': {\r\n                    dir: 'previousSibling',\r\n                    first: true\r\n                },\r\n                '~': { dir: 'previousSibling' }\r\n            },\r\n            preFilter: {\r\n                ATTR: function (match) {\r\n                    match[1] = match[1].replace(runescape, funescape);\r\n                    match[3] = (match[3] || match[4] || match[5] || '').replace(runescape, funescape);\r\n                    if (match[2] === '~=') {\r\n                        match[3] = ' ' + match[3] + ' ';\r\n                    }\r\n                    return match.slice(0, 4);\r\n                },\r\n                CHILD: function (match) {\r\n                    match[1] = match[1].toLowerCase();\r\n                    if (match[1].slice(0, 3) === 'nth') {\r\n                        if (!match[3]) {\r\n                            Sizzle.error(match[0]);\r\n                        }\r\n                        match[4] = +(match[4] ? match[5] + (match[6] || 1) : 2 * (match[3] === 'even' || match[3] === 'odd'));\r\n                        match[5] = +(match[7] + match[8] || match[3] === 'odd');\r\n                    }\r\n                    else if (match[3]) {\r\n                        Sizzle.error(match[0]);\r\n                    }\r\n                    return match;\r\n                },\r\n                PSEUDO: function (match) {\r\n                    var excess, unquoted = !match[6] && match[2];\r\n                    if (matchExpr.CHILD.test(match[0])) {\r\n                        return null;\r\n                    }\r\n                    if (match[3]) {\r\n                        match[2] = match[4] || match[5] || '';\r\n                    }\r\n                    else if (unquoted && rpseudo.test(unquoted) && (excess = tokenize(unquoted, true)) && (excess = unquoted.indexOf(')', unquoted.length - excess) - unquoted.length)) {\r\n                        match[0] = match[0].slice(0, excess);\r\n                        match[2] = unquoted.slice(0, excess);\r\n                    }\r\n                    return match.slice(0, 3);\r\n                }\r\n            },\r\n            filter: {\r\n                TAG: function (nodeNameSelector) {\r\n                    var nodeName = nodeNameSelector.replace(runescape, funescape).toLowerCase();\r\n                    return nodeNameSelector === '*' ? function () {\r\n                        return true;\r\n                    } : function (elem) {\r\n                        return elem.nodeName && elem.nodeName.toLowerCase() === nodeName;\r\n                    };\r\n                },\r\n                CLASS: function (className) {\r\n                    var pattern = classCache[className + ' '];\r\n                    return pattern || (pattern = new RegExp('(^|' + whitespace + ')' + className + '(' + whitespace + '|$)')) && classCache(className, function (elem) {\r\n                        return pattern.test(typeof elem.className === 'string' && elem.className || typeof elem.getAttribute !== strundefined && elem.getAttribute('class') || '');\r\n                    });\r\n                },\r\n                ATTR: function (name, operator, check) {\r\n                    return function (elem) {\r\n                        var result = Sizzle.attr(elem, name);\r\n                        if (result == null) {\r\n                            return operator === '!=';\r\n                        }\r\n                        if (!operator) {\r\n                            return true;\r\n                        }\r\n                        result += '';\r\n                        return operator === '=' ? result === check : operator === '!=' ? result !== check : operator === '^=' ? check && result.indexOf(check) === 0 : operator === '*=' ? check && result.indexOf(check) > -1 : operator === '$=' ? check && result.slice(-check.length) === check : operator === '~=' ? (' ' + result + ' ').indexOf(check) > -1 : operator === '|=' ? result === check || result.slice(0, check.length + 1) === check + '-' : false;\r\n                    };\r\n                },\r\n                CHILD: function (type, what, argument, first, last) {\r\n                    var simple = type.slice(0, 3) !== 'nth', forward = type.slice(-4) !== 'last', ofType = what === 'of-type';\r\n                    return first === 1 && last === 0 ? function (elem) {\r\n                        return !!elem.parentNode;\r\n                    } : function (elem, context, xml) {\r\n                        var cache, outerCache, node, diff, nodeIndex, start, dir = simple !== forward ? 'nextSibling' : 'previousSibling', parent = elem.parentNode, name = ofType && elem.nodeName.toLowerCase(), useCache = !xml && !ofType;\r\n                        if (parent) {\r\n                            if (simple) {\r\n                                while (dir) {\r\n                                    node = elem;\r\n                                    while (node = node[dir]) {\r\n                                        if (ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) {\r\n                                            return false;\r\n                                        }\r\n                                    }\r\n                                    start = dir = type === 'only' && !start && 'nextSibling';\r\n                                }\r\n                                return true;\r\n                            }\r\n                            start = [forward ? parent.firstChild : parent.lastChild];\r\n                            if (forward && useCache) {\r\n                                outerCache = parent[expando] || (parent[expando] = {});\r\n                                cache = outerCache[type] || [];\r\n                                nodeIndex = cache[0] === dirruns && cache[1];\r\n                                diff = cache[0] === dirruns && cache[2];\r\n                                node = nodeIndex && parent.childNodes[nodeIndex];\r\n                                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\r\n                                    if (node.nodeType === 1 && ++diff && node === elem) {\r\n                                        outerCache[type] = [\r\n                                            dirruns,\r\n                                            nodeIndex,\r\n                                            diff\r\n                                        ];\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            }\r\n                            else if (useCache && (cache = (elem[expando] || (elem[expando] = {}))[type]) && cache[0] === dirruns) {\r\n                                diff = cache[1];\r\n                            }\r\n                            else {\r\n                                while (node = ++nodeIndex && node && node[dir] || (diff = nodeIndex = 0) || start.pop()) {\r\n                                    if ((ofType ? node.nodeName.toLowerCase() === name : node.nodeType === 1) && ++diff) {\r\n                                        if (useCache) {\r\n                                            (node[expando] || (node[expando] = {}))[type] = [\r\n                                                dirruns,\r\n                                                diff\r\n                                            ];\r\n                                        }\r\n                                        if (node === elem) {\r\n                                            break;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            diff -= last;\r\n                            return diff === first || diff % first === 0 && diff / first >= 0;\r\n                        }\r\n                    };\r\n                },\r\n                PSEUDO: function (pseudo, argument) {\r\n                    var args, fn = Expr.pseudos[pseudo] || Expr.setFilters[pseudo.toLowerCase()] || Sizzle.error('unsupported pseudo: ' + pseudo);\r\n                    if (fn[expando]) {\r\n                        return fn(argument);\r\n                    }\r\n                    if (fn.length > 1) {\r\n                        args = [\r\n                            pseudo,\r\n                            pseudo,\r\n                            '',\r\n                            argument\r\n                        ];\r\n                        return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase()) ? markFunction(function (seed, matches) {\r\n                            var idx, matched = fn(seed, argument), i = matched.length;\r\n                            while (i--) {\r\n                                idx = indexOf$1.call(seed, matched[i]);\r\n                                seed[idx] = !(matches[idx] = matched[i]);\r\n                            }\r\n                        }) : function (elem) {\r\n                            return fn(elem, 0, args);\r\n                        };\r\n                    }\r\n                    return fn;\r\n                }\r\n            },\r\n            pseudos: {\r\n                not: markFunction(function (selector) {\r\n                    var input = [], results = [], matcher = compile(selector.replace(rtrim, '$1'));\r\n                    return matcher[expando] ? markFunction(function (seed, matches, context, xml) {\r\n                        var elem, unmatched = matcher(seed, null, xml, []), i = seed.length;\r\n                        while (i--) {\r\n                            if (elem = unmatched[i]) {\r\n                                seed[i] = !(matches[i] = elem);\r\n                            }\r\n                        }\r\n                    }) : function (elem, context, xml) {\r\n                        input[0] = elem;\r\n                        matcher(input, null, xml, results);\r\n                        return !results.pop();\r\n                    };\r\n                }),\r\n                has: markFunction(function (selector) {\r\n                    return function (elem) {\r\n                        return Sizzle(selector, elem).length > 0;\r\n                    };\r\n                }),\r\n                contains: markFunction(function (text) {\r\n                    text = text.replace(runescape, funescape);\r\n                    return function (elem) {\r\n                        return (elem.textContent || elem.innerText || getText(elem)).indexOf(text) > -1;\r\n                    };\r\n                }),\r\n                lang: markFunction(function (lang) {\r\n                    if (!ridentifier.test(lang || '')) {\r\n                        Sizzle.error('unsupported lang: ' + lang);\r\n                    }\r\n                    lang = lang.replace(runescape, funescape).toLowerCase();\r\n                    return function (elem) {\r\n                        var elemLang;\r\n                        do {\r\n                            if (elemLang = documentIsHTML ? elem.lang : elem.getAttribute('xml:lang') || elem.getAttribute('lang')) {\r\n                                elemLang = elemLang.toLowerCase();\r\n                                return elemLang === lang || elemLang.indexOf(lang + '-') === 0;\r\n                            }\r\n                        } while ((elem = elem.parentNode) && elem.nodeType === 1);\r\n                        return false;\r\n                    };\r\n                }),\r\n                target: function (elem) {\r\n                    var hash = domGlobals.window.location && domGlobals.window.location.hash;\r\n                    return hash && hash.slice(1) === elem.id;\r\n                },\r\n                root: function (elem) {\r\n                    return elem === docElem;\r\n                },\r\n                focus: function (elem) {\r\n                    return elem === document.activeElement && (!document.hasFocus || document.hasFocus()) && !!(elem.type || elem.href || ~elem.tabIndex);\r\n                },\r\n                enabled: function (elem) {\r\n                    return elem.disabled === false;\r\n                },\r\n                disabled: function (elem) {\r\n                    return elem.disabled === true;\r\n                },\r\n                checked: function (elem) {\r\n                    var nodeName = elem.nodeName.toLowerCase();\r\n                    return nodeName === 'input' && !!elem.checked || nodeName === 'option' && !!elem.selected;\r\n                },\r\n                selected: function (elem) {\r\n                    if (elem.parentNode) {\r\n                        elem.parentNode.selectedIndex;\r\n                    }\r\n                    return elem.selected === true;\r\n                },\r\n                empty: function (elem) {\r\n                    for (elem = elem.firstChild; elem; elem = elem.nextSibling) {\r\n                        if (elem.nodeType < 6) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                    return true;\r\n                },\r\n                parent: function (elem) {\r\n                    return !Expr.pseudos.empty(elem);\r\n                },\r\n                header: function (elem) {\r\n                    return rheader.test(elem.nodeName);\r\n                },\r\n                input: function (elem) {\r\n                    return rinputs.test(elem.nodeName);\r\n                },\r\n                button: function (elem) {\r\n                    var name = elem.nodeName.toLowerCase();\r\n                    return name === 'input' && elem.type === 'button' || name === 'button';\r\n                },\r\n                text: function (elem) {\r\n                    var attr;\r\n                    return elem.nodeName.toLowerCase() === 'input' && elem.type === 'text' && ((attr = elem.getAttribute('type')) == null || attr.toLowerCase() === 'text');\r\n                },\r\n                first: createPositionalPseudo(function () {\r\n                    return [0];\r\n                }),\r\n                last: createPositionalPseudo(function (matchIndexes, length) {\r\n                    return [length - 1];\r\n                }),\r\n                eq: createPositionalPseudo(function (matchIndexes, length, argument) {\r\n                    return [argument < 0 ? argument + length : argument];\r\n                }),\r\n                even: createPositionalPseudo(function (matchIndexes, length) {\r\n                    var i = 0;\r\n                    for (; i < length; i += 2) {\r\n                        matchIndexes.push(i);\r\n                    }\r\n                    return matchIndexes;\r\n                }),\r\n                odd: createPositionalPseudo(function (matchIndexes, length) {\r\n                    var i = 1;\r\n                    for (; i < length; i += 2) {\r\n                        matchIndexes.push(i);\r\n                    }\r\n                    return matchIndexes;\r\n                }),\r\n                lt: createPositionalPseudo(function (matchIndexes, length, argument) {\r\n                    var i = argument < 0 ? argument + length : argument;\r\n                    for (; --i >= 0;) {\r\n                        matchIndexes.push(i);\r\n                    }\r\n                    return matchIndexes;\r\n                }),\r\n                gt: createPositionalPseudo(function (matchIndexes, length, argument) {\r\n                    var i = argument < 0 ? argument + length : argument;\r\n                    for (; ++i < length;) {\r\n                        matchIndexes.push(i);\r\n                    }\r\n                    return matchIndexes;\r\n                })\r\n            }\r\n        };\r\n        Expr.pseudos.nth = Expr.pseudos.eq;\r\n        for (i in {\r\n            radio: true,\r\n            checkbox: true,\r\n            file: true,\r\n            password: true,\r\n            image: true\r\n        }) {\r\n            Expr.pseudos[i] = createInputPseudo(i);\r\n        }\r\n        for (i in {\r\n            submit: true,\r\n            reset: true\r\n        }) {\r\n            Expr.pseudos[i] = createButtonPseudo(i);\r\n        }\r\n        function setFilters() {\r\n        }\r\n        setFilters.prototype = Expr.filters = Expr.pseudos;\r\n        Expr.setFilters = new setFilters();\r\n        tokenize = Sizzle.tokenize = function (selector, parseOnly) {\r\n            var matched, match, tokens, type, soFar, groups, preFilters, cached = tokenCache[selector + ' '];\r\n            if (cached) {\r\n                return parseOnly ? 0 : cached.slice(0);\r\n            }\r\n            soFar = selector;\r\n            groups = [];\r\n            preFilters = Expr.preFilter;\r\n            while (soFar) {\r\n                if (!matched || (match = rcomma.exec(soFar))) {\r\n                    if (match) {\r\n                        soFar = soFar.slice(match[0].length) || soFar;\r\n                    }\r\n                    groups.push(tokens = []);\r\n                }\r\n                matched = false;\r\n                if (match = rcombinators.exec(soFar)) {\r\n                    matched = match.shift();\r\n                    tokens.push({\r\n                        value: matched,\r\n                        type: match[0].replace(rtrim, ' ')\r\n                    });\r\n                    soFar = soFar.slice(matched.length);\r\n                }\r\n                for (type in Expr.filter) {\r\n                    if (!Expr.filter.hasOwnProperty(type))\r\n                        continue;\r\n                    if ((match = matchExpr[type].exec(soFar)) && (!preFilters[type] || (match = preFilters[type](match)))) {\r\n                        matched = match.shift();\r\n                        tokens.push({\r\n                            value: matched,\r\n                            type: type,\r\n                            matches: match\r\n                        });\r\n                        soFar = soFar.slice(matched.length);\r\n                    }\r\n                }\r\n                if (!matched) {\r\n                    break;\r\n                }\r\n            }\r\n            return parseOnly ? soFar.length : soFar ? Sizzle.error(selector) : tokenCache(selector, groups).slice(0);\r\n        };\r\n        function toSelector(tokens) {\r\n            var i = 0, len = tokens.length, selector = '';\r\n            for (; i < len; i++) {\r\n                selector += tokens[i].value;\r\n            }\r\n            return selector;\r\n        }\r\n        function addCombinator(matcher, combinator, base) {\r\n            var dir = combinator.dir, checkNonElements = base && dir === 'parentNode', doneName = done++;\r\n            return combinator.first ? function (elem, context, xml) {\r\n                while (elem = elem[dir]) {\r\n                    if (elem.nodeType === 1 || checkNonElements) {\r\n                        return matcher(elem, context, xml);\r\n                    }\r\n                }\r\n            } : function (elem, context, xml) {\r\n                var oldCache, outerCache, newCache = [\r\n                    dirruns,\r\n                    doneName\r\n                ];\r\n                if (xml) {\r\n                    while (elem = elem[dir]) {\r\n                        if (elem.nodeType === 1 || checkNonElements) {\r\n                            if (matcher(elem, context, xml)) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    while (elem = elem[dir]) {\r\n                        if (elem.nodeType === 1 || checkNonElements) {\r\n                            outerCache = elem[expando] || (elem[expando] = {});\r\n                            if ((oldCache = outerCache[dir]) && oldCache[0] === dirruns && oldCache[1] === doneName) {\r\n                                return newCache[2] = oldCache[2];\r\n                            }\r\n                            else {\r\n                                outerCache[dir] = newCache;\r\n                                if (newCache[2] = matcher(elem, context, xml)) {\r\n                                    return true;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n        }\r\n        function elementMatcher(matchers) {\r\n            return matchers.length > 1 ? function (elem, context, xml) {\r\n                var i = matchers.length;\r\n                while (i--) {\r\n                    if (!matchers[i](elem, context, xml)) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            } : matchers[0];\r\n        }\r\n        function multipleContexts(selector, contexts, results) {\r\n            var i = 0, len = contexts.length;\r\n            for (; i < len; i++) {\r\n                Sizzle(selector, contexts[i], results);\r\n            }\r\n            return results;\r\n        }\r\n        function condense(unmatched, map, filter, context, xml) {\r\n            var elem, newUnmatched = [], i = 0, len = unmatched.length, mapped = map != null;\r\n            for (; i < len; i++) {\r\n                if (elem = unmatched[i]) {\r\n                    if (!filter || filter(elem, context, xml)) {\r\n                        newUnmatched.push(elem);\r\n                        if (mapped) {\r\n                            map.push(i);\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return newUnmatched;\r\n        }\r\n        function setMatcher(preFilter, selector, matcher, postFilter, postFinder, postSelector) {\r\n            if (postFilter && !postFilter[expando]) {\r\n                postFilter = setMatcher(postFilter);\r\n            }\r\n            if (postFinder && !postFinder[expando]) {\r\n                postFinder = setMatcher(postFinder, postSelector);\r\n            }\r\n            return markFunction(function (seed, results, context, xml) {\r\n                var temp, i, elem, preMap = [], postMap = [], preexisting = results.length, elems = seed || multipleContexts(selector || '*', context.nodeType ? [context] : context, []), matcherIn = preFilter && (seed || !selector) ? condense(elems, preMap, preFilter, context, xml) : elems, matcherOut = matcher ? postFinder || (seed ? preFilter : preexisting || postFilter) ? [] : results : matcherIn;\r\n                if (matcher) {\r\n                    matcher(matcherIn, matcherOut, context, xml);\r\n                }\r\n                if (postFilter) {\r\n                    temp = condense(matcherOut, postMap);\r\n                    postFilter(temp, [], context, xml);\r\n                    i = temp.length;\r\n                    while (i--) {\r\n                        if (elem = temp[i]) {\r\n                            matcherOut[postMap[i]] = !(matcherIn[postMap[i]] = elem);\r\n                        }\r\n                    }\r\n                }\r\n                if (seed) {\r\n                    if (postFinder || preFilter) {\r\n                        if (postFinder) {\r\n                            temp = [];\r\n                            i = matcherOut.length;\r\n                            while (i--) {\r\n                                if (elem = matcherOut[i]) {\r\n                                    temp.push(matcherIn[i] = elem);\r\n                                }\r\n                            }\r\n                            postFinder(null, matcherOut = [], temp, xml);\r\n                        }\r\n                        i = matcherOut.length;\r\n                        while (i--) {\r\n                            if ((elem = matcherOut[i]) && (temp = postFinder ? indexOf$1.call(seed, elem) : preMap[i]) > -1) {\r\n                                seed[temp] = !(results[temp] = elem);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    matcherOut = condense(matcherOut === results ? matcherOut.splice(preexisting, matcherOut.length) : matcherOut);\r\n                    if (postFinder) {\r\n                        postFinder(null, results, matcherOut, xml);\r\n                    }\r\n                    else {\r\n                        push$1.apply(results, matcherOut);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        function matcherFromTokens(tokens) {\r\n            var checkContext, matcher, j, len = tokens.length, leadingRelative = Expr.relative[tokens[0].type], implicitRelative = leadingRelative || Expr.relative[' '], i = leadingRelative ? 1 : 0, matchContext = addCombinator(function (elem) {\r\n                return elem === checkContext;\r\n            }, implicitRelative, true), matchAnyContext = addCombinator(function (elem) {\r\n                return indexOf$1.call(checkContext, elem) > -1;\r\n            }, implicitRelative, true), matchers = [function (elem, context, xml) {\r\n                    return !leadingRelative && (xml || context !== outermostContext) || ((checkContext = context).nodeType ? matchContext(elem, context, xml) : matchAnyContext(elem, context, xml));\r\n                }];\r\n            for (; i < len; i++) {\r\n                if (matcher = Expr.relative[tokens[i].type]) {\r\n                    matchers = [addCombinator(elementMatcher(matchers), matcher)];\r\n                }\r\n                else {\r\n                    matcher = Expr.filter[tokens[i].type].apply(null, tokens[i].matches);\r\n                    if (matcher[expando]) {\r\n                        j = ++i;\r\n                        for (; j < len; j++) {\r\n                            if (Expr.relative[tokens[j].type]) {\r\n                                break;\r\n                            }\r\n                        }\r\n                        return setMatcher(i > 1 && elementMatcher(matchers), i > 1 && toSelector(tokens.slice(0, i - 1).concat({ value: tokens[i - 2].type === ' ' ? '*' : '' })).replace(rtrim, '$1'), matcher, i < j && matcherFromTokens(tokens.slice(i, j)), j < len && matcherFromTokens(tokens = tokens.slice(j)), j < len && toSelector(tokens));\r\n                    }\r\n                    matchers.push(matcher);\r\n                }\r\n            }\r\n            return elementMatcher(matchers);\r\n        }\r\n        function matcherFromGroupMatchers(elementMatchers, setMatchers) {\r\n            var bySet = setMatchers.length > 0, byElement = elementMatchers.length > 0, superMatcher = function (seed, context, xml, results, outermost) {\r\n                var elem, j, matcher, matchedCount = 0, i = '0', unmatched = seed && [], setMatched = [], contextBackup = outermostContext, elems = seed || byElement && Expr.find.TAG('*', outermost), dirrunsUnique = dirruns += contextBackup == null ? 1 : Math.random() || 0.1, len = elems.length;\r\n                if (outermost) {\r\n                    outermostContext = context !== document && context;\r\n                }\r\n                for (; i !== len && (elem = elems[i]) != null; i++) {\r\n                    if (byElement && elem) {\r\n                        j = 0;\r\n                        while (matcher = elementMatchers[j++]) {\r\n                            if (matcher(elem, context, xml)) {\r\n                                results.push(elem);\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (outermost) {\r\n                            dirruns = dirrunsUnique;\r\n                        }\r\n                    }\r\n                    if (bySet) {\r\n                        if (elem = !matcher && elem) {\r\n                            matchedCount--;\r\n                        }\r\n                        if (seed) {\r\n                            unmatched.push(elem);\r\n                        }\r\n                    }\r\n                }\r\n                matchedCount += i;\r\n                if (bySet && i !== matchedCount) {\r\n                    j = 0;\r\n                    while (matcher = setMatchers[j++]) {\r\n                        matcher(unmatched, setMatched, context, xml);\r\n                    }\r\n                    if (seed) {\r\n                        if (matchedCount > 0) {\r\n                            while (i--) {\r\n                                if (!(unmatched[i] || setMatched[i])) {\r\n                                    setMatched[i] = pop.call(results);\r\n                                }\r\n                            }\r\n                        }\r\n                        setMatched = condense(setMatched);\r\n                    }\r\n                    push$1.apply(results, setMatched);\r\n                    if (outermost && !seed && setMatched.length > 0 && matchedCount + setMatchers.length > 1) {\r\n                        Sizzle.uniqueSort(results);\r\n                    }\r\n                }\r\n                if (outermost) {\r\n                    dirruns = dirrunsUnique;\r\n                    outermostContext = contextBackup;\r\n                }\r\n                return unmatched;\r\n            };\r\n            return bySet ? markFunction(superMatcher) : superMatcher;\r\n        }\r\n        compile = Sizzle.compile = function (selector, match) {\r\n            var i, setMatchers = [], elementMatchers = [], cached = compilerCache[selector + ' '];\r\n            if (!cached) {\r\n                if (!match) {\r\n                    match = tokenize(selector);\r\n                }\r\n                i = match.length;\r\n                while (i--) {\r\n                    cached = matcherFromTokens(match[i]);\r\n                    if (cached[expando]) {\r\n                        setMatchers.push(cached);\r\n                    }\r\n                    else {\r\n                        elementMatchers.push(cached);\r\n                    }\r\n                }\r\n                cached = compilerCache(selector, matcherFromGroupMatchers(elementMatchers, setMatchers));\r\n                cached.selector = selector;\r\n            }\r\n            return cached;\r\n        };\r\n        select = Sizzle.select = function (selector, context, results, seed) {\r\n            var i, tokens, token, type, find, compiled = typeof selector === 'function' && selector, match = !seed && tokenize(selector = compiled.selector || selector);\r\n            results = results || [];\r\n            if (match.length === 1) {\r\n                tokens = match[0] = match[0].slice(0);\r\n                if (tokens.length > 2 && (token = tokens[0]).type === 'ID' && support.getById && context.nodeType === 9 && documentIsHTML && Expr.relative[tokens[1].type]) {\r\n                    context = (Expr.find.ID(token.matches[0].replace(runescape, funescape), context) || [])[0];\r\n                    if (!context) {\r\n                        return results;\r\n                    }\r\n                    else if (compiled) {\r\n                        context = context.parentNode;\r\n                    }\r\n                    selector = selector.slice(tokens.shift().value.length);\r\n                }\r\n                i = matchExpr.needsContext.test(selector) ? 0 : tokens.length;\r\n                while (i--) {\r\n                    token = tokens[i];\r\n                    if (Expr.relative[type = token.type]) {\r\n                        break;\r\n                    }\r\n                    if (find = Expr.find[type]) {\r\n                        if (seed = find(token.matches[0].replace(runescape, funescape), rsibling.test(tokens[0].type) && testContext(context.parentNode) || context)) {\r\n                            tokens.splice(i, 1);\r\n                            selector = seed.length && toSelector(tokens);\r\n                            if (!selector) {\r\n                                push$1.apply(results, seed);\r\n                                return results;\r\n                            }\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            (compiled || compile(selector, match))(seed, context, !documentIsHTML, results, rsibling.test(selector) && testContext(context.parentNode) || context);\r\n            return results;\r\n        };\r\n        support.sortStable = expando.split('').sort(sortOrder).join('') === expando;\r\n        support.detectDuplicates = !!hasDuplicate;\r\n        setDocument();\r\n        support.sortDetached = true;\r\n        var isArray$1 = Array.isArray;\r\n        var toArray = function (obj) {\r\n            var array = obj, i, l;\r\n            if (!isArray$1(obj)) {\r\n                array = [];\r\n                for (i = 0, l = obj.length; i < l; i++) {\r\n                    array[i] = obj[i];\r\n                }\r\n            }\r\n            return array;\r\n        };\r\n        var each$1 = function (o, cb, s) {\r\n            var n, l;\r\n            if (!o) {\r\n                return 0;\r\n            }\r\n            s = s || o;\r\n            if (o.length !== undefined) {\r\n                for (n = 0, l = o.length; n < l; n++) {\r\n                    if (cb.call(s, o[n], n, o) === false) {\r\n                        return 0;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                for (n in o) {\r\n                    if (o.hasOwnProperty(n)) {\r\n                        if (cb.call(s, o[n], n, o) === false) {\r\n                            return 0;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return 1;\r\n        };\r\n        var map$1 = function (array, callback) {\r\n            var out = [];\r\n            each$1(array, function (item, index) {\r\n                out.push(callback(item, index, array));\r\n            });\r\n            return out;\r\n        };\r\n        var filter$1 = function (a, f) {\r\n            var o = [];\r\n            each$1(a, function (v, index) {\r\n                if (!f || f(v, index, a)) {\r\n                    o.push(v);\r\n                }\r\n            });\r\n            return o;\r\n        };\r\n        var indexOf$2 = function (a, v) {\r\n            var i, l;\r\n            if (a) {\r\n                for (i = 0, l = a.length; i < l; i++) {\r\n                    if (a[i] === v) {\r\n                        return i;\r\n                    }\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var reduce = function (collection, iteratee, accumulator, thisArg) {\r\n            var i = 0;\r\n            if (arguments.length < 3) {\r\n                accumulator = collection[0];\r\n            }\r\n            for (; i < collection.length; i++) {\r\n                accumulator = iteratee.call(thisArg, accumulator, collection[i], i);\r\n            }\r\n            return accumulator;\r\n        };\r\n        var findIndex$1 = function (array, predicate, thisArg) {\r\n            var i, l;\r\n            for (i = 0, l = array.length; i < l; i++) {\r\n                if (predicate.call(thisArg, array[i], i, array)) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var find$1 = function (array, predicate, thisArg) {\r\n            var idx = findIndex$1(array, predicate, thisArg);\r\n            if (idx !== -1) {\r\n                return array[idx];\r\n            }\r\n            return undefined;\r\n        };\r\n        var last$1 = function (collection) {\r\n            return collection[collection.length - 1];\r\n        };\r\n        var ArrUtils = {\r\n            isArray: isArray$1,\r\n            toArray: toArray,\r\n            each: each$1,\r\n            map: map$1,\r\n            filter: filter$1,\r\n            indexOf: indexOf$2,\r\n            reduce: reduce,\r\n            findIndex: findIndex$1,\r\n            find: find$1,\r\n            last: last$1\r\n        };\r\n        var whiteSpaceRegExp = /^\\s*|\\s*$/g;\r\n        var trim = function (str) {\r\n            return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp, '');\r\n        };\r\n        var is = function (obj, type) {\r\n            if (!type) {\r\n                return obj !== undefined;\r\n            }\r\n            if (type === 'array' && ArrUtils.isArray(obj)) {\r\n                return true;\r\n            }\r\n            return typeof obj === type;\r\n        };\r\n        var makeMap = function (items, delim, map) {\r\n            var i;\r\n            items = items || [];\r\n            delim = delim || ',';\r\n            if (typeof items === 'string') {\r\n                items = items.split(delim);\r\n            }\r\n            map = map || {};\r\n            i = items.length;\r\n            while (i--) {\r\n                map[items[i]] = {};\r\n            }\r\n            return map;\r\n        };\r\n        var hasOwnProperty = function (obj, prop) {\r\n            return Object.prototype.hasOwnProperty.call(obj, prop);\r\n        };\r\n        var create = function (s, p, root) {\r\n            var self = this;\r\n            var sp, ns, cn, scn, c, de = 0;\r\n            s = /^((static) )?([\\w.]+)(:([\\w.]+))?/.exec(s);\r\n            cn = s[3].match(/(^|\\.)(\\w+)$/i)[2];\r\n            ns = self.createNS(s[3].replace(/\\.\\w+$/, ''), root);\r\n            if (ns[cn]) {\r\n                return;\r\n            }\r\n            if (s[2] === 'static') {\r\n                ns[cn] = p;\r\n                if (this.onCreate) {\r\n                    this.onCreate(s[2], s[3], ns[cn]);\r\n                }\r\n                return;\r\n            }\r\n            if (!p[cn]) {\r\n                p[cn] = function () {\r\n                };\r\n                de = 1;\r\n            }\r\n            ns[cn] = p[cn];\r\n            self.extend(ns[cn].prototype, p);\r\n            if (s[5]) {\r\n                sp = self.resolve(s[5]).prototype;\r\n                scn = s[5].match(/\\.(\\w+)$/i)[1];\r\n                c = ns[cn];\r\n                if (de) {\r\n                    ns[cn] = function () {\r\n                        return sp[scn].apply(this, arguments);\r\n                    };\r\n                }\r\n                else {\r\n                    ns[cn] = function () {\r\n                        this.parent = sp[scn];\r\n                        return c.apply(this, arguments);\r\n                    };\r\n                }\r\n                ns[cn].prototype[cn] = ns[cn];\r\n                self.each(sp, function (f, n) {\r\n                    ns[cn].prototype[n] = sp[n];\r\n                });\r\n                self.each(p, function (f, n) {\r\n                    if (sp[n]) {\r\n                        ns[cn].prototype[n] = function () {\r\n                            this.parent = sp[n];\r\n                            return f.apply(this, arguments);\r\n                        };\r\n                    }\r\n                    else {\r\n                        if (n !== cn) {\r\n                            ns[cn].prototype[n] = f;\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            self.each(p.static, function (f, n) {\r\n                ns[cn][n] = f;\r\n            });\r\n        };\r\n        var extend = function (obj, ext) {\r\n            var x = [];\r\n            for (var _i = 2; _i < arguments.length; _i++) {\r\n                x[_i - 2] = arguments[_i];\r\n            }\r\n            var i, l, name;\r\n            var args = arguments;\r\n            var value;\r\n            for (i = 1, l = args.length; i < l; i++) {\r\n                ext = args[i];\r\n                for (name in ext) {\r\n                    if (ext.hasOwnProperty(name)) {\r\n                        value = ext[name];\r\n                        if (value !== undefined) {\r\n                            obj[name] = value;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return obj;\r\n        };\r\n        var walk = function (o, f, n, s) {\r\n            s = s || this;\r\n            if (o) {\r\n                if (n) {\r\n                    o = o[n];\r\n                }\r\n                ArrUtils.each(o, function (o, i) {\r\n                    if (f.call(s, o, i, n) === false) {\r\n                        return false;\r\n                    }\r\n                    walk(o, f, n, s);\r\n                });\r\n            }\r\n        };\r\n        var createNS = function (n, o) {\r\n            var i, v;\r\n            o = o || domGlobals.window;\r\n            n = n.split('.');\r\n            for (i = 0; i < n.length; i++) {\r\n                v = n[i];\r\n                if (!o[v]) {\r\n                    o[v] = {};\r\n                }\r\n                o = o[v];\r\n            }\r\n            return o;\r\n        };\r\n        var resolve$1 = function (n, o) {\r\n            var i, l;\r\n            o = o || domGlobals.window;\r\n            n = n.split('.');\r\n            for (i = 0, l = n.length; i < l; i++) {\r\n                o = o[n[i]];\r\n                if (!o) {\r\n                    break;\r\n                }\r\n            }\r\n            return o;\r\n        };\r\n        var explode = function (s, d) {\r\n            if (!s || is(s, 'array')) {\r\n                return s;\r\n            }\r\n            return ArrUtils.map(s.split(d || ','), trim);\r\n        };\r\n        var _addCacheSuffix = function (url) {\r\n            var cacheSuffix = Env.cacheSuffix;\r\n            if (cacheSuffix) {\r\n                url += (url.indexOf('?') === -1 ? '?' : '&') + cacheSuffix;\r\n            }\r\n            return url;\r\n        };\r\n        var Tools = {\r\n            trim: trim,\r\n            isArray: ArrUtils.isArray,\r\n            is: is,\r\n            toArray: ArrUtils.toArray,\r\n            makeMap: makeMap,\r\n            each: ArrUtils.each,\r\n            map: ArrUtils.map,\r\n            grep: ArrUtils.filter,\r\n            inArray: ArrUtils.indexOf,\r\n            hasOwn: hasOwnProperty,\r\n            extend: extend,\r\n            create: create,\r\n            walk: walk,\r\n            createNS: createNS,\r\n            resolve: resolve$1,\r\n            explode: explode,\r\n            _addCacheSuffix: _addCacheSuffix\r\n        };\r\n        var doc = domGlobals.document, push$2 = Array.prototype.push, slice$2 = Array.prototype.slice;\r\n        var rquickExpr$1 = /^(?:[^#<]*(<[\\w\\W]+>)[^>]*$|#([\\w\\-]*)$)/;\r\n        var Event = EventUtils.Event;\r\n        var skipUniques = Tools.makeMap('children,contents,next,prev');\r\n        var isDefined = function (obj) {\r\n            return typeof obj !== 'undefined';\r\n        };\r\n        var isString$1 = function (obj) {\r\n            return typeof obj === 'string';\r\n        };\r\n        var isWindow = function (obj) {\r\n            return obj && obj === obj.window;\r\n        };\r\n        var createFragment = function (html, fragDoc) {\r\n            var frag, node, container;\r\n            fragDoc = fragDoc || doc;\r\n            container = fragDoc.createElement('div');\r\n            frag = fragDoc.createDocumentFragment();\r\n            container.innerHTML = html;\r\n            while (node = container.firstChild) {\r\n                frag.appendChild(node);\r\n            }\r\n            return frag;\r\n        };\r\n        var domManipulate = function (targetNodes, sourceItem, callback, reverse) {\r\n            var i;\r\n            if (isString$1(sourceItem)) {\r\n                sourceItem = createFragment(sourceItem, getElementDocument(targetNodes[0]));\r\n            }\r\n            else if (sourceItem.length && !sourceItem.nodeType) {\r\n                sourceItem = DomQuery.makeArray(sourceItem);\r\n                if (reverse) {\r\n                    for (i = sourceItem.length - 1; i >= 0; i--) {\r\n                        domManipulate(targetNodes, sourceItem[i], callback, reverse);\r\n                    }\r\n                }\r\n                else {\r\n                    for (i = 0; i < sourceItem.length; i++) {\r\n                        domManipulate(targetNodes, sourceItem[i], callback, reverse);\r\n                    }\r\n                }\r\n                return targetNodes;\r\n            }\r\n            if (sourceItem.nodeType) {\r\n                i = targetNodes.length;\r\n                while (i--) {\r\n                    callback.call(targetNodes[i], sourceItem);\r\n                }\r\n            }\r\n            return targetNodes;\r\n        };\r\n        var hasClass = function (node, className) {\r\n            return node && className && (' ' + node.className + ' ').indexOf(' ' + className + ' ') !== -1;\r\n        };\r\n        var wrap = function (elements, wrapper, all) {\r\n            var lastParent, newWrapper;\r\n            wrapper = DomQuery(wrapper)[0];\r\n            elements.each(function () {\r\n                var self = this;\r\n                if (!all || lastParent !== self.parentNode) {\r\n                    lastParent = self.parentNode;\r\n                    newWrapper = wrapper.cloneNode(false);\r\n                    self.parentNode.insertBefore(newWrapper, self);\r\n                    newWrapper.appendChild(self);\r\n                }\r\n                else {\r\n                    newWrapper.appendChild(self);\r\n                }\r\n            });\r\n            return elements;\r\n        };\r\n        var numericCssMap = Tools.makeMap('fillOpacity fontWeight lineHeight opacity orphans widows zIndex zoom', ' ');\r\n        var booleanMap = Tools.makeMap('checked compact declare defer disabled ismap multiple nohref noshade nowrap readonly selected', ' ');\r\n        var propFix = {\r\n            for: 'htmlFor',\r\n            class: 'className',\r\n            readonly: 'readOnly'\r\n        };\r\n        var cssFix = { float: 'cssFloat' };\r\n        var attrHooks = {}, cssHooks = {};\r\n        var DomQueryConstructor = function (selector, context) {\r\n            return new DomQuery.fn.init(selector, context);\r\n        };\r\n        var inArray = function (item, array) {\r\n            var i;\r\n            if (array.indexOf) {\r\n                return array.indexOf(item);\r\n            }\r\n            i = array.length;\r\n            while (i--) {\r\n                if (array[i] === item) {\r\n                    return i;\r\n                }\r\n            }\r\n            return -1;\r\n        };\r\n        var whiteSpaceRegExp$1 = /^\\s*|\\s*$/g;\r\n        var trim$1 = function (str) {\r\n            return str === null || str === undefined ? '' : ('' + str).replace(whiteSpaceRegExp$1, '');\r\n        };\r\n        var each$2 = function (obj, callback) {\r\n            var length, key, i, value;\r\n            if (obj) {\r\n                length = obj.length;\r\n                if (length === undefined) {\r\n                    for (key in obj) {\r\n                        if (obj.hasOwnProperty(key)) {\r\n                            value = obj[key];\r\n                            if (callback.call(value, key, value) === false) {\r\n                                break;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    for (i = 0; i < length; i++) {\r\n                        value = obj[i];\r\n                        if (callback.call(value, i, value) === false) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return obj;\r\n        };\r\n        var grep = function (array, callback) {\r\n            var out = [];\r\n            each$2(array, function (i, item) {\r\n                if (callback(item, i)) {\r\n                    out.push(item);\r\n                }\r\n            });\r\n            return out;\r\n        };\r\n        var getElementDocument = function (element) {\r\n            if (!element) {\r\n                return doc;\r\n            }\r\n            if (element.nodeType === 9) {\r\n                return element;\r\n            }\r\n            return element.ownerDocument;\r\n        };\r\n        DomQueryConstructor.fn = DomQueryConstructor.prototype = {\r\n            constructor: DomQueryConstructor,\r\n            selector: '',\r\n            context: null,\r\n            length: 0,\r\n            init: function (selector, context) {\r\n                var self = this;\r\n                var match, node;\r\n                if (!selector) {\r\n                    return self;\r\n                }\r\n                if (selector.nodeType) {\r\n                    self.context = self[0] = selector;\r\n                    self.length = 1;\r\n                    return self;\r\n                }\r\n                if (context && context.nodeType) {\r\n                    self.context = context;\r\n                }\r\n                else {\r\n                    if (context) {\r\n                        return DomQuery(selector).attr(context);\r\n                    }\r\n                    self.context = context = domGlobals.document;\r\n                }\r\n                if (isString$1(selector)) {\r\n                    self.selector = selector;\r\n                    if (selector.charAt(0) === '<' && selector.charAt(selector.length - 1) === '>' && selector.length >= 3) {\r\n                        match = [\r\n                            null,\r\n                            selector,\r\n                            null\r\n                        ];\r\n                    }\r\n                    else {\r\n                        match = rquickExpr$1.exec(selector);\r\n                    }\r\n                    if (match) {\r\n                        if (match[1]) {\r\n                            node = createFragment(selector, getElementDocument(context)).firstChild;\r\n                            while (node) {\r\n                                push$2.call(self, node);\r\n                                node = node.nextSibling;\r\n                            }\r\n                        }\r\n                        else {\r\n                            node = getElementDocument(context).getElementById(match[2]);\r\n                            if (!node) {\r\n                                return self;\r\n                            }\r\n                            if (node.id !== match[2]) {\r\n                                return self.find(selector);\r\n                            }\r\n                            self.length = 1;\r\n                            self[0] = node;\r\n                        }\r\n                    }\r\n                    else {\r\n                        return DomQuery(context).find(selector);\r\n                    }\r\n                }\r\n                else {\r\n                    this.add(selector, false);\r\n                }\r\n                return self;\r\n            },\r\n            toArray: function () {\r\n                return Tools.toArray(this);\r\n            },\r\n            add: function (items, sort) {\r\n                var self = this;\r\n                var nodes, i;\r\n                if (isString$1(items)) {\r\n                    return self.add(DomQuery(items));\r\n                }\r\n                if (sort !== false) {\r\n                    nodes = DomQuery.unique(self.toArray().concat(DomQuery.makeArray(items)));\r\n                    self.length = nodes.length;\r\n                    for (i = 0; i < nodes.length; i++) {\r\n                        self[i] = nodes[i];\r\n                    }\r\n                }\r\n                else {\r\n                    push$2.apply(self, DomQuery.makeArray(items));\r\n                }\r\n                return self;\r\n            },\r\n            attr: function (name, value) {\r\n                var self = this;\r\n                var hook;\r\n                if (typeof name === 'object') {\r\n                    each$2(name, function (name, value) {\r\n                        self.attr(name, value);\r\n                    });\r\n                }\r\n                else if (isDefined(value)) {\r\n                    this.each(function () {\r\n                        var hook;\r\n                        if (this.nodeType === 1) {\r\n                            hook = attrHooks[name];\r\n                            if (hook && hook.set) {\r\n                                hook.set(this, value);\r\n                                return;\r\n                            }\r\n                            if (value === null) {\r\n                                this.removeAttribute(name, 2);\r\n                            }\r\n                            else {\r\n                                this.setAttribute(name, value, 2);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    if (self[0] && self[0].nodeType === 1) {\r\n                        hook = attrHooks[name];\r\n                        if (hook && hook.get) {\r\n                            return hook.get(self[0], name);\r\n                        }\r\n                        if (booleanMap[name]) {\r\n                            return self.prop(name) ? name : undefined;\r\n                        }\r\n                        value = self[0].getAttribute(name, 2);\r\n                        if (value === null) {\r\n                            value = undefined;\r\n                        }\r\n                    }\r\n                    return value;\r\n                }\r\n                return self;\r\n            },\r\n            removeAttr: function (name) {\r\n                return this.attr(name, null);\r\n            },\r\n            prop: function (name, value) {\r\n                var self = this;\r\n                name = propFix[name] || name;\r\n                if (typeof name === 'object') {\r\n                    each$2(name, function (name, value) {\r\n                        self.prop(name, value);\r\n                    });\r\n                }\r\n                else if (isDefined(value)) {\r\n                    this.each(function () {\r\n                        if (this.nodeType === 1) {\r\n                            this[name] = value;\r\n                        }\r\n                    });\r\n                }\r\n                else {\r\n                    if (self[0] && self[0].nodeType && name in self[0]) {\r\n                        return self[0][name];\r\n                    }\r\n                    return value;\r\n                }\r\n                return self;\r\n            },\r\n            css: function (name, value) {\r\n                var self = this;\r\n                var elm, hook;\r\n                var camel = function (name) {\r\n                    return name.replace(/-(\\D)/g, function (a, b) {\r\n                        return b.toUpperCase();\r\n                    });\r\n                };\r\n                var dashed = function (name) {\r\n                    return name.replace(/[A-Z]/g, function (a) {\r\n                        return '-' + a;\r\n                    });\r\n                };\r\n                if (typeof name === 'object') {\r\n                    each$2(name, function (name, value) {\r\n                        self.css(name, value);\r\n                    });\r\n                }\r\n                else {\r\n                    if (isDefined(value)) {\r\n                        name = camel(name);\r\n                        if (typeof value === 'number' && !numericCssMap[name]) {\r\n                            value = value.toString() + 'px';\r\n                        }\r\n                        self.each(function () {\r\n                            var style = this.style;\r\n                            hook = cssHooks[name];\r\n                            if (hook && hook.set) {\r\n                                hook.set(this, value);\r\n                                return;\r\n                            }\r\n                            try {\r\n                                this.style[cssFix[name] || name] = value;\r\n                            }\r\n                            catch (ex) {\r\n                            }\r\n                            if (value === null || value === '') {\r\n                                if (style.removeProperty) {\r\n                                    style.removeProperty(dashed(name));\r\n                                }\r\n                                else {\r\n                                    style.removeAttribute(name);\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                    else {\r\n                        elm = self[0];\r\n                        hook = cssHooks[name];\r\n                        if (hook && hook.get) {\r\n                            return hook.get(elm);\r\n                        }\r\n                        if (elm.ownerDocument.defaultView) {\r\n                            try {\r\n                                return elm.ownerDocument.defaultView.getComputedStyle(elm, null).getPropertyValue(dashed(name));\r\n                            }\r\n                            catch (ex) {\r\n                                return undefined;\r\n                            }\r\n                        }\r\n                        else if (elm.currentStyle) {\r\n                            return elm.currentStyle[camel(name)];\r\n                        }\r\n                        else {\r\n                            return '';\r\n                        }\r\n                    }\r\n                }\r\n                return self;\r\n            },\r\n            remove: function () {\r\n                var self = this;\r\n                var node, i = this.length;\r\n                while (i--) {\r\n                    node = self[i];\r\n                    Event.clean(node);\r\n                    if (node.parentNode) {\r\n                        node.parentNode.removeChild(node);\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n            empty: function () {\r\n                var self = this;\r\n                var node, i = this.length;\r\n                while (i--) {\r\n                    node = self[i];\r\n                    while (node.firstChild) {\r\n                        node.removeChild(node.firstChild);\r\n                    }\r\n                }\r\n                return this;\r\n            },\r\n            html: function (value) {\r\n                var self = this;\r\n                var i;\r\n                if (isDefined(value)) {\r\n                    i = self.length;\r\n                    try {\r\n                        while (i--) {\r\n                            self[i].innerHTML = value;\r\n                        }\r\n                    }\r\n                    catch (ex) {\r\n                        DomQuery(self[i]).empty().append(value);\r\n                    }\r\n                    return self;\r\n                }\r\n                return self[0] ? self[0].innerHTML : '';\r\n            },\r\n            text: function (value) {\r\n                var self = this;\r\n                var i;\r\n                if (isDefined(value)) {\r\n                    i = self.length;\r\n                    while (i--) {\r\n                        if ('innerText' in self[i]) {\r\n                            self[i].innerText = value;\r\n                        }\r\n                        else {\r\n                            self[0].textContent = value;\r\n                        }\r\n                    }\r\n                    return self;\r\n                }\r\n                return self[0] ? self[0].innerText || self[0].textContent : '';\r\n            },\r\n            append: function () {\r\n                return domManipulate(this, arguments, function (node) {\r\n                    if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\r\n                        this.appendChild(node);\r\n                    }\r\n                });\r\n            },\r\n            prepend: function () {\r\n                return domManipulate(this, arguments, function (node) {\r\n                    if (this.nodeType === 1 || this.host && this.host.nodeType === 1) {\r\n                        this.insertBefore(node, this.firstChild);\r\n                    }\r\n                }, true);\r\n            },\r\n            before: function () {\r\n                var self = this;\r\n                if (self[0] && self[0].parentNode) {\r\n                    return domManipulate(self, arguments, function (node) {\r\n                        this.parentNode.insertBefore(node, this);\r\n                    });\r\n                }\r\n                return self;\r\n            },\r\n            after: function () {\r\n                var self = this;\r\n                if (self[0] && self[0].parentNode) {\r\n                    return domManipulate(self, arguments, function (node) {\r\n                        this.parentNode.insertBefore(node, this.nextSibling);\r\n                    }, true);\r\n                }\r\n                return self;\r\n            },\r\n            appendTo: function (val) {\r\n                DomQuery(val).append(this);\r\n                return this;\r\n            },\r\n            prependTo: function (val) {\r\n                DomQuery(val).prepend(this);\r\n                return this;\r\n            },\r\n            replaceWith: function (content) {\r\n                return this.before(content).remove();\r\n            },\r\n            wrap: function (content) {\r\n                return wrap(this, content);\r\n            },\r\n            wrapAll: function (content) {\r\n                return wrap(this, content, true);\r\n            },\r\n            wrapInner: function (content) {\r\n                this.each(function () {\r\n                    DomQuery(this).contents().wrapAll(content);\r\n                });\r\n                return this;\r\n            },\r\n            unwrap: function () {\r\n                return this.parent().each(function () {\r\n                    DomQuery(this).replaceWith(this.childNodes);\r\n                });\r\n            },\r\n            clone: function () {\r\n                var result = [];\r\n                this.each(function () {\r\n                    result.push(this.cloneNode(true));\r\n                });\r\n                return DomQuery(result);\r\n            },\r\n            addClass: function (className) {\r\n                return this.toggleClass(className, true);\r\n            },\r\n            removeClass: function (className) {\r\n                return this.toggleClass(className, false);\r\n            },\r\n            toggleClass: function (className, state) {\r\n                var self = this;\r\n                if (typeof className !== 'string') {\r\n                    return self;\r\n                }\r\n                if (className.indexOf(' ') !== -1) {\r\n                    each$2(className.split(' '), function () {\r\n                        self.toggleClass(this, state);\r\n                    });\r\n                }\r\n                else {\r\n                    self.each(function (index, node) {\r\n                        var existingClassName, classState;\r\n                        classState = hasClass(node, className);\r\n                        if (classState !== state) {\r\n                            existingClassName = node.className;\r\n                            if (classState) {\r\n                                node.className = trim$1((' ' + existingClassName + ' ').replace(' ' + className + ' ', ' '));\r\n                            }\r\n                            else {\r\n                                node.className += existingClassName ? ' ' + className : className;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                return self;\r\n            },\r\n            hasClass: function (className) {\r\n                return hasClass(this[0], className);\r\n            },\r\n            each: function (callback) {\r\n                return each$2(this, callback);\r\n            },\r\n            on: function (name, callback) {\r\n                return this.each(function () {\r\n                    Event.bind(this, name, callback);\r\n                });\r\n            },\r\n            off: function (name, callback) {\r\n                return this.each(function () {\r\n                    Event.unbind(this, name, callback);\r\n                });\r\n            },\r\n            trigger: function (name) {\r\n                return this.each(function () {\r\n                    if (typeof name === 'object') {\r\n                        Event.fire(this, name.type, name);\r\n                    }\r\n                    else {\r\n                        Event.fire(this, name);\r\n                    }\r\n                });\r\n            },\r\n            show: function () {\r\n                return this.css('display', '');\r\n            },\r\n            hide: function () {\r\n                return this.css('display', 'none');\r\n            },\r\n            slice: function () {\r\n                return new DomQuery(slice$2.apply(this, arguments));\r\n            },\r\n            eq: function (index) {\r\n                return index === -1 ? this.slice(index) : this.slice(index, +index + 1);\r\n            },\r\n            first: function () {\r\n                return this.eq(0);\r\n            },\r\n            last: function () {\r\n                return this.eq(-1);\r\n            },\r\n            find: function (selector) {\r\n                var i, l;\r\n                var ret = [];\r\n                for (i = 0, l = this.length; i < l; i++) {\r\n                    DomQuery.find(selector, this[i], ret);\r\n                }\r\n                return DomQuery(ret);\r\n            },\r\n            filter: function (selector) {\r\n                if (typeof selector === 'function') {\r\n                    return DomQuery(grep(this.toArray(), function (item, i) {\r\n                        return selector(i, item);\r\n                    }));\r\n                }\r\n                return DomQuery(DomQuery.filter(selector, this.toArray()));\r\n            },\r\n            closest: function (selector) {\r\n                var result = [];\r\n                if (selector instanceof DomQuery) {\r\n                    selector = selector[0];\r\n                }\r\n                this.each(function (i, node) {\r\n                    while (node) {\r\n                        if (typeof selector === 'string' && DomQuery(node).is(selector)) {\r\n                            result.push(node);\r\n                            break;\r\n                        }\r\n                        else if (node === selector) {\r\n                            result.push(node);\r\n                            break;\r\n                        }\r\n                        node = node.parentNode;\r\n                    }\r\n                });\r\n                return DomQuery(result);\r\n            },\r\n            offset: function (offset) {\r\n                var elm, doc, docElm;\r\n                var x = 0, y = 0, pos;\r\n                if (!offset) {\r\n                    elm = this[0];\r\n                    if (elm) {\r\n                        doc = elm.ownerDocument;\r\n                        docElm = doc.documentElement;\r\n                        if (elm.getBoundingClientRect) {\r\n                            pos = elm.getBoundingClientRect();\r\n                            x = pos.left + (docElm.scrollLeft || doc.body.scrollLeft) - docElm.clientLeft;\r\n                            y = pos.top + (docElm.scrollTop || doc.body.scrollTop) - docElm.clientTop;\r\n                        }\r\n                    }\r\n                    return {\r\n                        left: x,\r\n                        top: y\r\n                    };\r\n                }\r\n                return this.css(offset);\r\n            },\r\n            push: push$2,\r\n            sort: Array.prototype.sort,\r\n            splice: Array.prototype.splice\r\n        };\r\n        Tools.extend(DomQueryConstructor, {\r\n            extend: Tools.extend,\r\n            makeArray: function (object) {\r\n                if (isWindow(object) || object.nodeType) {\r\n                    return [object];\r\n                }\r\n                return Tools.toArray(object);\r\n            },\r\n            inArray: inArray,\r\n            isArray: Tools.isArray,\r\n            each: each$2,\r\n            trim: trim$1,\r\n            grep: grep,\r\n            find: Sizzle,\r\n            expr: Sizzle.selectors,\r\n            unique: Sizzle.uniqueSort,\r\n            text: Sizzle.getText,\r\n            contains: Sizzle.contains,\r\n            filter: function (expr, elems, not) {\r\n                var i = elems.length;\r\n                if (not) {\r\n                    expr = ':not(' + expr + ')';\r\n                }\r\n                while (i--) {\r\n                    if (elems[i].nodeType !== 1) {\r\n                        elems.splice(i, 1);\r\n                    }\r\n                }\r\n                if (elems.length === 1) {\r\n                    elems = DomQuery.find.matchesSelector(elems[0], expr) ? [elems[0]] : [];\r\n                }\r\n                else {\r\n                    elems = DomQuery.find.matches(expr, elems);\r\n                }\r\n                return elems;\r\n            }\r\n        });\r\n        var dir = function (el, prop, until) {\r\n            var matched = [];\r\n            var cur = el[prop];\r\n            if (typeof until !== 'string' && until instanceof DomQuery) {\r\n                until = until[0];\r\n            }\r\n            while (cur && cur.nodeType !== 9) {\r\n                if (until !== undefined) {\r\n                    if (cur === until) {\r\n                        break;\r\n                    }\r\n                    if (typeof until === 'string' && DomQuery(cur).is(until)) {\r\n                        break;\r\n                    }\r\n                }\r\n                if (cur.nodeType === 1) {\r\n                    matched.push(cur);\r\n                }\r\n                cur = cur[prop];\r\n            }\r\n            return matched;\r\n        };\r\n        var sibling = function (node, siblingName, nodeType, until) {\r\n            var result = [];\r\n            if (until instanceof DomQuery) {\r\n                until = until[0];\r\n            }\r\n            for (; node; node = node[siblingName]) {\r\n                if (nodeType && node.nodeType !== nodeType) {\r\n                    continue;\r\n                }\r\n                if (until !== undefined) {\r\n                    if (node === until) {\r\n                        break;\r\n                    }\r\n                    if (typeof until === 'string' && DomQuery(node).is(until)) {\r\n                        break;\r\n                    }\r\n                }\r\n                result.push(node);\r\n            }\r\n            return result;\r\n        };\r\n        var firstSibling = function (node, siblingName, nodeType) {\r\n            for (node = node[siblingName]; node; node = node[siblingName]) {\r\n                if (node.nodeType === nodeType) {\r\n                    return node;\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        each$2({\r\n            parent: function (node) {\r\n                var parent = node.parentNode;\r\n                return parent && parent.nodeType !== 11 ? parent : null;\r\n            },\r\n            parents: function (node) {\r\n                return dir(node, 'parentNode');\r\n            },\r\n            next: function (node) {\r\n                return firstSibling(node, 'nextSibling', 1);\r\n            },\r\n            prev: function (node) {\r\n                return firstSibling(node, 'previousSibling', 1);\r\n            },\r\n            children: function (node) {\r\n                return sibling(node.firstChild, 'nextSibling', 1);\r\n            },\r\n            contents: function (node) {\r\n                return Tools.toArray((node.nodeName === 'iframe' ? node.contentDocument || node.contentWindow.document : node).childNodes);\r\n            }\r\n        }, function (name, fn) {\r\n            DomQueryConstructor.fn[name] = function (selector) {\r\n                var self = this;\r\n                var result = [];\r\n                self.each(function () {\r\n                    var nodes = fn.call(result, this, selector, result);\r\n                    if (nodes) {\r\n                        if (DomQuery.isArray(nodes)) {\r\n                            result.push.apply(result, nodes);\r\n                        }\r\n                        else {\r\n                            result.push(nodes);\r\n                        }\r\n                    }\r\n                });\r\n                if (this.length > 1) {\r\n                    if (!skipUniques[name]) {\r\n                        result = DomQuery.unique(result);\r\n                    }\r\n                    if (name.indexOf('parents') === 0) {\r\n                        result = result.reverse();\r\n                    }\r\n                }\r\n                var wrappedResult = DomQuery(result);\r\n                if (selector) {\r\n                    return wrappedResult.filter(selector);\r\n                }\r\n                return wrappedResult;\r\n            };\r\n        });\r\n        each$2({\r\n            parentsUntil: function (node, until) {\r\n                return dir(node, 'parentNode', until);\r\n            },\r\n            nextUntil: function (node, until) {\r\n                return sibling(node, 'nextSibling', 1, until).slice(1);\r\n            },\r\n            prevUntil: function (node, until) {\r\n                return sibling(node, 'previousSibling', 1, until).slice(1);\r\n            }\r\n        }, function (name, fn) {\r\n            DomQueryConstructor.fn[name] = function (selector, filter) {\r\n                var self = this;\r\n                var result = [];\r\n                self.each(function () {\r\n                    var nodes = fn.call(result, this, selector, result);\r\n                    if (nodes) {\r\n                        if (DomQuery.isArray(nodes)) {\r\n                            result.push.apply(result, nodes);\r\n                        }\r\n                        else {\r\n                            result.push(nodes);\r\n                        }\r\n                    }\r\n                });\r\n                if (this.length > 1) {\r\n                    result = DomQuery.unique(result);\r\n                    if (name.indexOf('parents') === 0 || name === 'prevUntil') {\r\n                        result = result.reverse();\r\n                    }\r\n                }\r\n                var wrappedResult = DomQuery(result);\r\n                if (filter) {\r\n                    return wrappedResult.filter(filter);\r\n                }\r\n                return wrappedResult;\r\n            };\r\n        });\r\n        DomQueryConstructor.fn.is = function (selector) {\r\n            return !!selector && this.filter(selector).length > 0;\r\n        };\r\n        DomQueryConstructor.fn.init.prototype = DomQueryConstructor.fn;\r\n        DomQueryConstructor.overrideDefaults = function (callback) {\r\n            var defaults;\r\n            var sub = function (selector, context) {\r\n                defaults = defaults || callback();\r\n                if (arguments.length === 0) {\r\n                    selector = defaults.element;\r\n                }\r\n                if (!context) {\r\n                    context = defaults.context;\r\n                }\r\n                return new sub.fn.init(selector, context);\r\n            };\r\n            DomQuery.extend(sub, this);\r\n            return sub;\r\n        };\r\n        var appendHooks = function (targetHooks, prop, hooks) {\r\n            each$2(hooks, function (name, func) {\r\n                targetHooks[name] = targetHooks[name] || {};\r\n                targetHooks[name][prop] = func;\r\n            });\r\n        };\r\n        if (Env.ie && Env.ie < 8) {\r\n            appendHooks(attrHooks, 'get', {\r\n                maxlength: function (elm) {\r\n                    var value = elm.maxLength;\r\n                    if (value === 2147483647) {\r\n                        return undefined;\r\n                    }\r\n                    return value;\r\n                },\r\n                size: function (elm) {\r\n                    var value = elm.size;\r\n                    if (value === 20) {\r\n                        return undefined;\r\n                    }\r\n                    return value;\r\n                },\r\n                class: function (elm) {\r\n                    return elm.className;\r\n                },\r\n                style: function (elm) {\r\n                    var value = elm.style.cssText;\r\n                    if (value.length === 0) {\r\n                        return undefined;\r\n                    }\r\n                    return value;\r\n                }\r\n            });\r\n            appendHooks(attrHooks, 'set', {\r\n                class: function (elm, value) {\r\n                    elm.className = value;\r\n                },\r\n                style: function (elm, value) {\r\n                    elm.style.cssText = value;\r\n                }\r\n            });\r\n        }\r\n        if (Env.ie && Env.ie < 9) {\r\n            cssFix.float = 'styleFloat';\r\n            appendHooks(cssHooks, 'set', {\r\n                opacity: function (elm, value) {\r\n                    var style = elm.style;\r\n                    if (value === null || value === '') {\r\n                        style.removeAttribute('filter');\r\n                    }\r\n                    else {\r\n                        style.zoom = 1;\r\n                        style.filter = 'alpha(opacity=' + value * 100 + ')';\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        DomQueryConstructor.attrHooks = attrHooks;\r\n        DomQueryConstructor.cssHooks = cssHooks;\r\n        var DomQuery = DomQueryConstructor;\r\n        var cached = function (f) {\r\n            var called = false;\r\n            var r;\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                if (!called) {\r\n                    called = true;\r\n                    r = f.apply(null, args);\r\n                }\r\n                return r;\r\n            };\r\n        };\r\n        var firstMatch = function (regexes, s) {\r\n            for (var i = 0; i < regexes.length; i++) {\r\n                var x = regexes[i];\r\n                if (x.test(s))\r\n                    return x;\r\n            }\r\n            return undefined;\r\n        };\r\n        var find$2 = function (regexes, agent) {\r\n            var r = firstMatch(regexes, agent);\r\n            if (!r)\r\n                return {\r\n                    major: 0,\r\n                    minor: 0\r\n                };\r\n            var group = function (i) {\r\n                return Number(agent.replace(r, '$' + i));\r\n            };\r\n            return nu(group(1), group(2));\r\n        };\r\n        var detect = function (versionRegexes, agent) {\r\n            var cleanedAgent = String(agent).toLowerCase();\r\n            if (versionRegexes.length === 0)\r\n                return unknown();\r\n            return find$2(versionRegexes, cleanedAgent);\r\n        };\r\n        var unknown = function () {\r\n            return nu(0, 0);\r\n        };\r\n        var nu = function (major, minor) {\r\n            return {\r\n                major: major,\r\n                minor: minor\r\n            };\r\n        };\r\n        var Version = {\r\n            nu: nu,\r\n            detect: detect,\r\n            unknown: unknown\r\n        };\r\n        var edge = 'Edge';\r\n        var chrome = 'Chrome';\r\n        var ie$1 = 'IE';\r\n        var opera$1 = 'Opera';\r\n        var firefox = 'Firefox';\r\n        var safari = 'Safari';\r\n        var isBrowser = function (name, current) {\r\n            return function () {\r\n                return current === name;\r\n            };\r\n        };\r\n        var unknown$1 = function () {\r\n            return nu$1({\r\n                current: undefined,\r\n                version: Version.unknown()\r\n            });\r\n        };\r\n        var nu$1 = function (info) {\r\n            var current = info.current;\r\n            var version = info.version;\r\n            return {\r\n                current: current,\r\n                version: version,\r\n                isEdge: isBrowser(edge, current),\r\n                isChrome: isBrowser(chrome, current),\r\n                isIE: isBrowser(ie$1, current),\r\n                isOpera: isBrowser(opera$1, current),\r\n                isFirefox: isBrowser(firefox, current),\r\n                isSafari: isBrowser(safari, current)\r\n            };\r\n        };\r\n        var Browser = {\r\n            unknown: unknown$1,\r\n            nu: nu$1,\r\n            edge: constant(edge),\r\n            chrome: constant(chrome),\r\n            ie: constant(ie$1),\r\n            opera: constant(opera$1),\r\n            firefox: constant(firefox),\r\n            safari: constant(safari)\r\n        };\r\n        var windows = 'Windows';\r\n        var ios = 'iOS';\r\n        var android$1 = 'Android';\r\n        var linux = 'Linux';\r\n        var osx = 'OSX';\r\n        var solaris = 'Solaris';\r\n        var freebsd = 'FreeBSD';\r\n        var isOS = function (name, current) {\r\n            return function () {\r\n                return current === name;\r\n            };\r\n        };\r\n        var unknown$2 = function () {\r\n            return nu$2({\r\n                current: undefined,\r\n                version: Version.unknown()\r\n            });\r\n        };\r\n        var nu$2 = function (info) {\r\n            var current = info.current;\r\n            var version = info.version;\r\n            return {\r\n                current: current,\r\n                version: version,\r\n                isWindows: isOS(windows, current),\r\n                isiOS: isOS(ios, current),\r\n                isAndroid: isOS(android$1, current),\r\n                isOSX: isOS(osx, current),\r\n                isLinux: isOS(linux, current),\r\n                isSolaris: isOS(solaris, current),\r\n                isFreeBSD: isOS(freebsd, current)\r\n            };\r\n        };\r\n        var OperatingSystem = {\r\n            unknown: unknown$2,\r\n            nu: nu$2,\r\n            windows: constant(windows),\r\n            ios: constant(ios),\r\n            android: constant(android$1),\r\n            linux: constant(linux),\r\n            osx: constant(osx),\r\n            solaris: constant(solaris),\r\n            freebsd: constant(freebsd)\r\n        };\r\n        var DeviceType = function (os, browser, userAgent) {\r\n            var isiPad = os.isiOS() && /ipad/i.test(userAgent) === true;\r\n            var isiPhone = os.isiOS() && !isiPad;\r\n            var isAndroid3 = os.isAndroid() && os.version.major === 3;\r\n            var isAndroid4 = os.isAndroid() && os.version.major === 4;\r\n            var isTablet = isiPad || isAndroid3 || isAndroid4 && /mobile/i.test(userAgent) === true;\r\n            var isTouch = os.isiOS() || os.isAndroid();\r\n            var isPhone = isTouch && !isTablet;\r\n            var iOSwebview = browser.isSafari() && os.isiOS() && /safari/i.test(userAgent) === false;\r\n            return {\r\n                isiPad: constant(isiPad),\r\n                isiPhone: constant(isiPhone),\r\n                isTablet: constant(isTablet),\r\n                isPhone: constant(isPhone),\r\n                isTouch: constant(isTouch),\r\n                isAndroid: os.isAndroid,\r\n                isiOS: os.isiOS,\r\n                isWebView: constant(iOSwebview)\r\n            };\r\n        };\r\n        var detect$1 = function (candidates, userAgent) {\r\n            var agent = String(userAgent).toLowerCase();\r\n            return find(candidates, function (candidate) {\r\n                return candidate.search(agent);\r\n            });\r\n        };\r\n        var detectBrowser = function (browsers, userAgent) {\r\n            return detect$1(browsers, userAgent).map(function (browser) {\r\n                var version = Version.detect(browser.versionRegexes, userAgent);\r\n                return {\r\n                    current: browser.name,\r\n                    version: version\r\n                };\r\n            });\r\n        };\r\n        var detectOs = function (oses, userAgent) {\r\n            return detect$1(oses, userAgent).map(function (os) {\r\n                var version = Version.detect(os.versionRegexes, userAgent);\r\n                return {\r\n                    current: os.name,\r\n                    version: version\r\n                };\r\n            });\r\n        };\r\n        var UaString = {\r\n            detectBrowser: detectBrowser,\r\n            detectOs: detectOs\r\n        };\r\n        var contains$2 = function (str, substr) {\r\n            return str.indexOf(substr) !== -1;\r\n        };\r\n        var trim$2 = function (str) {\r\n            return str.replace(/^\\s+|\\s+$/g, '');\r\n        };\r\n        var lTrim = function (str) {\r\n            return str.replace(/^\\s+/g, '');\r\n        };\r\n        var rTrim = function (str) {\r\n            return str.replace(/\\s+$/g, '');\r\n        };\r\n        var normalVersionRegex = /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/;\r\n        var checkContains = function (target) {\r\n            return function (uastring) {\r\n                return contains$2(uastring, target);\r\n            };\r\n        };\r\n        var browsers = [\r\n            {\r\n                name: 'Edge',\r\n                versionRegexes: [/.*?edge\\/ ?([0-9]+)\\.([0-9]+)$/],\r\n                search: function (uastring) {\r\n                    var monstrosity = contains$2(uastring, 'edge/') && contains$2(uastring, 'chrome') && contains$2(uastring, 'safari') && contains$2(uastring, 'applewebkit');\r\n                    return monstrosity;\r\n                }\r\n            },\r\n            {\r\n                name: 'Chrome',\r\n                versionRegexes: [\r\n                    /.*?chrome\\/([0-9]+)\\.([0-9]+).*/,\r\n                    normalVersionRegex\r\n                ],\r\n                search: function (uastring) {\r\n                    return contains$2(uastring, 'chrome') && !contains$2(uastring, 'chromeframe');\r\n                }\r\n            },\r\n            {\r\n                name: 'IE',\r\n                versionRegexes: [\r\n                    /.*?msie\\ ?([0-9]+)\\.([0-9]+).*/,\r\n                    /.*?rv:([0-9]+)\\.([0-9]+).*/\r\n                ],\r\n                search: function (uastring) {\r\n                    return contains$2(uastring, 'msie') || contains$2(uastring, 'trident');\r\n                }\r\n            },\r\n            {\r\n                name: 'Opera',\r\n                versionRegexes: [\r\n                    normalVersionRegex,\r\n                    /.*?opera\\/([0-9]+)\\.([0-9]+).*/\r\n                ],\r\n                search: checkContains('opera')\r\n            },\r\n            {\r\n                name: 'Firefox',\r\n                versionRegexes: [/.*?firefox\\/\\ ?([0-9]+)\\.([0-9]+).*/],\r\n                search: checkContains('firefox')\r\n            },\r\n            {\r\n                name: 'Safari',\r\n                versionRegexes: [\r\n                    normalVersionRegex,\r\n                    /.*?cpu os ([0-9]+)_([0-9]+).*/\r\n                ],\r\n                search: function (uastring) {\r\n                    return (contains$2(uastring, 'safari') || contains$2(uastring, 'mobile/')) && contains$2(uastring, 'applewebkit');\r\n                }\r\n            }\r\n        ];\r\n        var oses = [\r\n            {\r\n                name: 'Windows',\r\n                search: checkContains('win'),\r\n                versionRegexes: [/.*?windows\\ nt\\ ?([0-9]+)\\.([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'iOS',\r\n                search: function (uastring) {\r\n                    return contains$2(uastring, 'iphone') || contains$2(uastring, 'ipad');\r\n                },\r\n                versionRegexes: [\r\n                    /.*?version\\/\\ ?([0-9]+)\\.([0-9]+).*/,\r\n                    /.*cpu os ([0-9]+)_([0-9]+).*/,\r\n                    /.*cpu iphone os ([0-9]+)_([0-9]+).*/\r\n                ]\r\n            },\r\n            {\r\n                name: 'Android',\r\n                search: checkContains('android'),\r\n                versionRegexes: [/.*?android\\ ?([0-9]+)\\.([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'OSX',\r\n                search: checkContains('os x'),\r\n                versionRegexes: [/.*?os\\ x\\ ?([0-9]+)_([0-9]+).*/]\r\n            },\r\n            {\r\n                name: 'Linux',\r\n                search: checkContains('linux'),\r\n                versionRegexes: []\r\n            },\r\n            {\r\n                name: 'Solaris',\r\n                search: checkContains('sunos'),\r\n                versionRegexes: []\r\n            },\r\n            {\r\n                name: 'FreeBSD',\r\n                search: checkContains('freebsd'),\r\n                versionRegexes: []\r\n            }\r\n        ];\r\n        var PlatformInfo = {\r\n            browsers: constant(browsers),\r\n            oses: constant(oses)\r\n        };\r\n        var detect$2 = function (userAgent) {\r\n            var browsers = PlatformInfo.browsers();\r\n            var oses = PlatformInfo.oses();\r\n            var browser = UaString.detectBrowser(browsers, userAgent).fold(Browser.unknown, Browser.nu);\r\n            var os = UaString.detectOs(oses, userAgent).fold(OperatingSystem.unknown, OperatingSystem.nu);\r\n            var deviceType = DeviceType(os, browser, userAgent);\r\n            return {\r\n                browser: browser,\r\n                os: os,\r\n                deviceType: deviceType\r\n            };\r\n        };\r\n        var PlatformDetection = { detect: detect$2 };\r\n        var detect$3 = cached(function () {\r\n            var userAgent = domGlobals.navigator.userAgent;\r\n            return PlatformDetection.detect(userAgent);\r\n        });\r\n        var PlatformDetection$1 = { detect: detect$3 };\r\n        var fromHtml = function (html, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var div = doc.createElement('div');\r\n            div.innerHTML = html;\r\n            if (!div.hasChildNodes() || div.childNodes.length > 1) {\r\n                domGlobals.console.error('HTML does not have a single root node', html);\r\n                throw new Error('HTML must have a single root node');\r\n            }\r\n            return fromDom(div.childNodes[0]);\r\n        };\r\n        var fromTag = function (tag, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var node = doc.createElement(tag);\r\n            return fromDom(node);\r\n        };\r\n        var fromText = function (text, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var node = doc.createTextNode(text);\r\n            return fromDom(node);\r\n        };\r\n        var fromDom = function (node) {\r\n            if (node === null || node === undefined) {\r\n                throw new Error('Node cannot be null or undefined');\r\n            }\r\n            return { dom: constant(node) };\r\n        };\r\n        var fromPoint = function (docElm, x, y) {\r\n            var doc = docElm.dom();\r\n            return Option.from(doc.elementFromPoint(x, y)).map(fromDom);\r\n        };\r\n        var Element = {\r\n            fromHtml: fromHtml,\r\n            fromTag: fromTag,\r\n            fromText: fromText,\r\n            fromDom: fromDom,\r\n            fromPoint: fromPoint\r\n        };\r\n        var ATTRIBUTE = domGlobals.Node.ATTRIBUTE_NODE;\r\n        var CDATA_SECTION = domGlobals.Node.CDATA_SECTION_NODE;\r\n        var COMMENT = domGlobals.Node.COMMENT_NODE;\r\n        var DOCUMENT = domGlobals.Node.DOCUMENT_NODE;\r\n        var DOCUMENT_TYPE = domGlobals.Node.DOCUMENT_TYPE_NODE;\r\n        var DOCUMENT_FRAGMENT = domGlobals.Node.DOCUMENT_FRAGMENT_NODE;\r\n        var ELEMENT = domGlobals.Node.ELEMENT_NODE;\r\n        var TEXT = domGlobals.Node.TEXT_NODE;\r\n        var PROCESSING_INSTRUCTION = domGlobals.Node.PROCESSING_INSTRUCTION_NODE;\r\n        var ENTITY_REFERENCE = domGlobals.Node.ENTITY_REFERENCE_NODE;\r\n        var ENTITY = domGlobals.Node.ENTITY_NODE;\r\n        var NOTATION = domGlobals.Node.NOTATION_NODE;\r\n        var name = function (element) {\r\n            var r = element.dom().nodeName;\r\n            return r.toLowerCase();\r\n        };\r\n        var type = function (element) {\r\n            return element.dom().nodeType;\r\n        };\r\n        var isType$1 = function (t) {\r\n            return function (element) {\r\n                return type(element) === t;\r\n            };\r\n        };\r\n        var isElement = isType$1(ELEMENT);\r\n        var isText = isType$1(TEXT);\r\n        var keys = Object.keys;\r\n        var hasOwnProperty$1 = Object.hasOwnProperty;\r\n        var each$3 = function (obj, f) {\r\n            var props = keys(obj);\r\n            for (var k = 0, len = props.length; k < len; k++) {\r\n                var i = props[k];\r\n                var x = obj[i];\r\n                f(x, i, obj);\r\n            }\r\n        };\r\n        var map$2 = function (obj, f) {\r\n            return tupleMap(obj, function (x, i, obj) {\r\n                return {\r\n                    k: i,\r\n                    v: f(x, i, obj)\r\n                };\r\n            });\r\n        };\r\n        var tupleMap = function (obj, f) {\r\n            var r = {};\r\n            each$3(obj, function (x, i) {\r\n                var tuple = f(x, i, obj);\r\n                r[tuple.k] = tuple.v;\r\n            });\r\n            return r;\r\n        };\r\n        var bifilter = function (obj, pred) {\r\n            var t = {};\r\n            var f = {};\r\n            each$3(obj, function (x, i) {\r\n                var branch = pred(x, i) ? t : f;\r\n                branch[i] = x;\r\n            });\r\n            return {\r\n                t: t,\r\n                f: f\r\n            };\r\n        };\r\n        var get = function (obj, key) {\r\n            return has(obj, key) ? Option.from(obj[key]) : Option.none();\r\n        };\r\n        var has = function (obj, key) {\r\n            return hasOwnProperty$1.call(obj, key);\r\n        };\r\n        var isSupported = function (dom) {\r\n            return dom.style !== undefined;\r\n        };\r\n        var inBody = function (element) {\r\n            var dom = isText(element) ? element.dom().parentNode : element.dom();\r\n            return dom !== undefined && dom !== null && dom.ownerDocument.body.contains(dom);\r\n        };\r\n        var rawSet = function (dom, key, value) {\r\n            if (isString(value) || isBoolean(value) || isNumber(value)) {\r\n                dom.setAttribute(key, value + '');\r\n            }\r\n            else {\r\n                domGlobals.console.error('Invalid call to Attr.set. Key ', key, ':: Value ', value, ':: Element ', dom);\r\n                throw new Error('Attribute value was not simple');\r\n            }\r\n        };\r\n        var set = function (element, key, value) {\r\n            rawSet(element.dom(), key, value);\r\n        };\r\n        var setAll = function (element, attrs) {\r\n            var dom = element.dom();\r\n            each$3(attrs, function (v, k) {\r\n                rawSet(dom, k, v);\r\n            });\r\n        };\r\n        var get$1 = function (element, key) {\r\n            var v = element.dom().getAttribute(key);\r\n            return v === null ? undefined : v;\r\n        };\r\n        var has$1 = function (element, key) {\r\n            var dom = element.dom();\r\n            return dom && dom.hasAttribute ? dom.hasAttribute(key) : false;\r\n        };\r\n        var remove = function (element, key) {\r\n            element.dom().removeAttribute(key);\r\n        };\r\n        var get$2 = function (element, property) {\r\n            var dom = element.dom();\r\n            var styles = domGlobals.window.getComputedStyle(dom);\r\n            var r = styles.getPropertyValue(property);\r\n            var v = r === '' && !inBody(element) ? getUnsafeProperty(dom, property) : r;\r\n            return v === null ? undefined : v;\r\n        };\r\n        var getUnsafeProperty = function (dom, property) {\r\n            return isSupported(dom) ? dom.style.getPropertyValue(property) : '';\r\n        };\r\n        var getRaw = function (element, property) {\r\n            var dom = element.dom();\r\n            var raw = getUnsafeProperty(dom, property);\r\n            return Option.from(raw).filter(function (r) {\r\n                return r.length > 0;\r\n            });\r\n        };\r\n        var Immutable = function () {\r\n            var fields = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                fields[_i] = arguments[_i];\r\n            }\r\n            return function () {\r\n                var values = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    values[_i] = arguments[_i];\r\n                }\r\n                if (fields.length !== values.length) {\r\n                    throw new Error('Wrong number of arguments to struct. Expected \"[' + fields.length + ']\", got ' + values.length + ' arguments');\r\n                }\r\n                var struct = {};\r\n                each(fields, function (name, i) {\r\n                    struct[name] = constant(values[i]);\r\n                });\r\n                return struct;\r\n            };\r\n        };\r\n        var toArray$1 = function (target, f) {\r\n            var r = [];\r\n            var recurse = function (e) {\r\n                r.push(e);\r\n                return f(e);\r\n            };\r\n            var cur = f(target);\r\n            do {\r\n                cur = cur.bind(recurse);\r\n            } while (cur.isSome());\r\n            return r;\r\n        };\r\n        var Recurse = { toArray: toArray$1 };\r\n        var node = function () {\r\n            var f = Global$1.getOrDie('Node');\r\n            return f;\r\n        };\r\n        var compareDocumentPosition = function (a, b, match) {\r\n            return (a.compareDocumentPosition(b) & match) !== 0;\r\n        };\r\n        var documentPositionPreceding = function (a, b) {\r\n            return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_PRECEDING);\r\n        };\r\n        var documentPositionContainedBy = function (a, b) {\r\n            return compareDocumentPosition(a, b, node().DOCUMENT_POSITION_CONTAINED_BY);\r\n        };\r\n        var Node = {\r\n            documentPositionPreceding: documentPositionPreceding,\r\n            documentPositionContainedBy: documentPositionContainedBy\r\n        };\r\n        var ELEMENT$1 = ELEMENT;\r\n        var DOCUMENT$1 = DOCUMENT;\r\n        var is$1 = function (element, selector) {\r\n            var elem = element.dom();\r\n            if (elem.nodeType !== ELEMENT$1) {\r\n                return false;\r\n            }\r\n            else if (elem.matches !== undefined) {\r\n                return elem.matches(selector);\r\n            }\r\n            else if (elem.msMatchesSelector !== undefined) {\r\n                return elem.msMatchesSelector(selector);\r\n            }\r\n            else if (elem.webkitMatchesSelector !== undefined) {\r\n                return elem.webkitMatchesSelector(selector);\r\n            }\r\n            else if (elem.mozMatchesSelector !== undefined) {\r\n                return elem.mozMatchesSelector(selector);\r\n            }\r\n            else {\r\n                throw new Error('Browser lacks native selectors');\r\n            }\r\n        };\r\n        var bypassSelector = function (dom) {\r\n            return dom.nodeType !== ELEMENT$1 && dom.nodeType !== DOCUMENT$1 || dom.childElementCount === 0;\r\n        };\r\n        var all = function (selector, scope) {\r\n            var base = scope === undefined ? domGlobals.document : scope.dom();\r\n            return bypassSelector(base) ? [] : map(base.querySelectorAll(selector), Element.fromDom);\r\n        };\r\n        var one = function (selector, scope) {\r\n            var base = scope === undefined ? domGlobals.document : scope.dom();\r\n            return bypassSelector(base) ? Option.none() : Option.from(base.querySelector(selector)).map(Element.fromDom);\r\n        };\r\n        var eq = function (e1, e2) {\r\n            return e1.dom() === e2.dom();\r\n        };\r\n        var regularContains = function (e1, e2) {\r\n            var d1 = e1.dom();\r\n            var d2 = e2.dom();\r\n            return d1 === d2 ? false : d1.contains(d2);\r\n        };\r\n        var ieContains = function (e1, e2) {\r\n            return Node.documentPositionContainedBy(e1.dom(), e2.dom());\r\n        };\r\n        var browser = PlatformDetection$1.detect().browser;\r\n        var contains$3 = browser.isIE() ? ieContains : regularContains;\r\n        var owner = function (element) {\r\n            return Element.fromDom(element.dom().ownerDocument);\r\n        };\r\n        var documentElement = function (element) {\r\n            return Element.fromDom(element.dom().ownerDocument.documentElement);\r\n        };\r\n        var defaultView = function (element) {\r\n            var el = element.dom();\r\n            var defView = el.ownerDocument.defaultView;\r\n            return Element.fromDom(defView);\r\n        };\r\n        var parent = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.parentNode).map(Element.fromDom);\r\n        };\r\n        var parents = function (element, isRoot) {\r\n            var stop = isFunction(isRoot) ? isRoot : constant(false);\r\n            var dom = element.dom();\r\n            var ret = [];\r\n            while (dom.parentNode !== null && dom.parentNode !== undefined) {\r\n                var rawParent = dom.parentNode;\r\n                var p = Element.fromDom(rawParent);\r\n                ret.push(p);\r\n                if (stop(p) === true) {\r\n                    break;\r\n                }\r\n                else {\r\n                    dom = rawParent;\r\n                }\r\n            }\r\n            return ret;\r\n        };\r\n        var siblings = function (element) {\r\n            var filterSelf = function (elements) {\r\n                return filter(elements, function (x) {\r\n                    return !eq(element, x);\r\n                });\r\n            };\r\n            return parent(element).map(children).map(filterSelf).getOr([]);\r\n        };\r\n        var prevSibling = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.previousSibling).map(Element.fromDom);\r\n        };\r\n        var nextSibling = function (element) {\r\n            var dom = element.dom();\r\n            return Option.from(dom.nextSibling).map(Element.fromDom);\r\n        };\r\n        var prevSiblings = function (element) {\r\n            return reverse(Recurse.toArray(element, prevSibling));\r\n        };\r\n        var nextSiblings = function (element) {\r\n            return Recurse.toArray(element, nextSibling);\r\n        };\r\n        var children = function (element) {\r\n            var dom = element.dom();\r\n            return map(dom.childNodes, Element.fromDom);\r\n        };\r\n        var child = function (element, index) {\r\n            var cs = element.dom().childNodes;\r\n            return Option.from(cs[index]).map(Element.fromDom);\r\n        };\r\n        var firstChild = function (element) {\r\n            return child(element, 0);\r\n        };\r\n        var lastChild = function (element) {\r\n            return child(element, element.dom().childNodes.length - 1);\r\n        };\r\n        var childNodesCount = function (element) {\r\n            return element.dom().childNodes.length;\r\n        };\r\n        var spot = Immutable('element', 'offset');\r\n        var browser$1 = PlatformDetection$1.detect().browser;\r\n        var firstElement = function (nodes) {\r\n            return find(nodes, isElement);\r\n        };\r\n        var getTableCaptionDeltaY = function (elm) {\r\n            if (browser$1.isFirefox() && name(elm) === 'table') {\r\n                return firstElement(children(elm)).filter(function (elm) {\r\n                    return name(elm) === 'caption';\r\n                }).bind(function (caption) {\r\n                    return firstElement(nextSiblings(caption)).map(function (body) {\r\n                        var bodyTop = body.dom().offsetTop;\r\n                        var captionTop = caption.dom().offsetTop;\r\n                        var captionHeight = caption.dom().offsetHeight;\r\n                        return bodyTop <= captionTop ? -captionHeight : 0;\r\n                    });\r\n                }).getOr(0);\r\n            }\r\n            else {\r\n                return 0;\r\n            }\r\n        };\r\n        var getPos = function (body, elm, rootElm) {\r\n            var x = 0, y = 0, offsetParent;\r\n            var doc = body.ownerDocument;\r\n            var pos;\r\n            rootElm = rootElm ? rootElm : body;\r\n            if (elm) {\r\n                if (rootElm === body && elm.getBoundingClientRect && get$2(Element.fromDom(body), 'position') === 'static') {\r\n                    pos = elm.getBoundingClientRect();\r\n                    x = pos.left + (doc.documentElement.scrollLeft || body.scrollLeft) - doc.documentElement.clientLeft;\r\n                    y = pos.top + (doc.documentElement.scrollTop || body.scrollTop) - doc.documentElement.clientTop;\r\n                    return {\r\n                        x: x,\r\n                        y: y\r\n                    };\r\n                }\r\n                offsetParent = elm;\r\n                while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType) {\r\n                    x += offsetParent.offsetLeft || 0;\r\n                    y += offsetParent.offsetTop || 0;\r\n                    offsetParent = offsetParent.offsetParent;\r\n                }\r\n                offsetParent = elm.parentNode;\r\n                while (offsetParent && offsetParent !== rootElm && offsetParent.nodeType) {\r\n                    x -= offsetParent.scrollLeft || 0;\r\n                    y -= offsetParent.scrollTop || 0;\r\n                    offsetParent = offsetParent.parentNode;\r\n                }\r\n                y += getTableCaptionDeltaY(Element.fromDom(elm));\r\n            }\r\n            return {\r\n                x: x,\r\n                y: y\r\n            };\r\n        };\r\n        var Position = { getPos: getPos };\r\n        var nu$3 = function (baseFn) {\r\n            var data = Option.none();\r\n            var callbacks = [];\r\n            var map = function (f) {\r\n                return nu$3(function (nCallback) {\r\n                    get(function (data) {\r\n                        nCallback(f(data));\r\n                    });\r\n                });\r\n            };\r\n            var get = function (nCallback) {\r\n                if (isReady())\r\n                    call(nCallback);\r\n                else\r\n                    callbacks.push(nCallback);\r\n            };\r\n            var set = function (x) {\r\n                data = Option.some(x);\r\n                run(callbacks);\r\n                callbacks = [];\r\n            };\r\n            var isReady = function () {\r\n                return data.isSome();\r\n            };\r\n            var run = function (cbs) {\r\n                each(cbs, call);\r\n            };\r\n            var call = function (cb) {\r\n                data.each(function (x) {\r\n                    domGlobals.setTimeout(function () {\r\n                        cb(x);\r\n                    }, 0);\r\n                });\r\n            };\r\n            baseFn(set);\r\n            return {\r\n                get: get,\r\n                map: map,\r\n                isReady: isReady\r\n            };\r\n        };\r\n        var pure$1 = function (a) {\r\n            return nu$3(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var LazyValue = {\r\n            nu: nu$3,\r\n            pure: pure$1\r\n        };\r\n        var bounce = function (f) {\r\n            return function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                var me = this;\r\n                domGlobals.setTimeout(function () {\r\n                    f.apply(me, args);\r\n                }, 0);\r\n            };\r\n        };\r\n        var nu$4 = function (baseFn) {\r\n            var get = function (callback) {\r\n                baseFn(bounce(callback));\r\n            };\r\n            var map = function (fab) {\r\n                return nu$4(function (callback) {\r\n                    get(function (a) {\r\n                        var value = fab(a);\r\n                        callback(value);\r\n                    });\r\n                });\r\n            };\r\n            var bind = function (aFutureB) {\r\n                return nu$4(function (callback) {\r\n                    get(function (a) {\r\n                        aFutureB(a).get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var anonBind = function (futureB) {\r\n                return nu$4(function (callback) {\r\n                    get(function (a) {\r\n                        futureB.get(callback);\r\n                    });\r\n                });\r\n            };\r\n            var toLazy = function () {\r\n                return LazyValue.nu(get);\r\n            };\r\n            var toCached = function () {\r\n                var cache = null;\r\n                return nu$4(function (callback) {\r\n                    if (cache === null) {\r\n                        cache = toLazy();\r\n                    }\r\n                    cache.get(callback);\r\n                });\r\n            };\r\n            return {\r\n                map: map,\r\n                bind: bind,\r\n                anonBind: anonBind,\r\n                toLazy: toLazy,\r\n                toCached: toCached,\r\n                get: get\r\n            };\r\n        };\r\n        var pure$2 = function (a) {\r\n            return nu$4(function (callback) {\r\n                callback(a);\r\n            });\r\n        };\r\n        var Future = {\r\n            nu: nu$4,\r\n            pure: pure$2\r\n        };\r\n        var par = function (asyncValues, nu) {\r\n            return nu(function (callback) {\r\n                var r = [];\r\n                var count = 0;\r\n                var cb = function (i) {\r\n                    return function (value) {\r\n                        r[i] = value;\r\n                        count++;\r\n                        if (count >= asyncValues.length) {\r\n                            callback(r);\r\n                        }\r\n                    };\r\n                };\r\n                if (asyncValues.length === 0) {\r\n                    callback([]);\r\n                }\r\n                else {\r\n                    each(asyncValues, function (asyncValue, i) {\r\n                        asyncValue.get(cb(i));\r\n                    });\r\n                }\r\n            });\r\n        };\r\n        var par$1 = function (futures) {\r\n            return par(futures, Future.nu);\r\n        };\r\n        var value = function (o) {\r\n            var is = function (v) {\r\n                return o === v;\r\n            };\r\n            var or = function (opt) {\r\n                return value(o);\r\n            };\r\n            var orThunk = function (f) {\r\n                return value(o);\r\n            };\r\n            var map = function (f) {\r\n                return value(f(o));\r\n            };\r\n            var mapError = function (f) {\r\n                return value(o);\r\n            };\r\n            var each = function (f) {\r\n                f(o);\r\n            };\r\n            var bind = function (f) {\r\n                return f(o);\r\n            };\r\n            var fold = function (_, onValue) {\r\n                return onValue(o);\r\n            };\r\n            var exists = function (f) {\r\n                return f(o);\r\n            };\r\n            var forall = function (f) {\r\n                return f(o);\r\n            };\r\n            var toOption = function () {\r\n                return Option.some(o);\r\n            };\r\n            return {\r\n                is: is,\r\n                isValue: always,\r\n                isError: never,\r\n                getOr: constant(o),\r\n                getOrThunk: constant(o),\r\n                getOrDie: constant(o),\r\n                or: or,\r\n                orThunk: orThunk,\r\n                fold: fold,\r\n                map: map,\r\n                mapError: mapError,\r\n                each: each,\r\n                bind: bind,\r\n                exists: exists,\r\n                forall: forall,\r\n                toOption: toOption\r\n            };\r\n        };\r\n        var error = function (message) {\r\n            var getOrThunk = function (f) {\r\n                return f();\r\n            };\r\n            var getOrDie = function () {\r\n                return die(String(message))();\r\n            };\r\n            var or = function (opt) {\r\n                return opt;\r\n            };\r\n            var orThunk = function (f) {\r\n                return f();\r\n            };\r\n            var map = function (f) {\r\n                return error(message);\r\n            };\r\n            var mapError = function (f) {\r\n                return error(f(message));\r\n            };\r\n            var bind = function (f) {\r\n                return error(message);\r\n            };\r\n            var fold = function (onError, _) {\r\n                return onError(message);\r\n            };\r\n            return {\r\n                is: never,\r\n                isValue: never,\r\n                isError: always,\r\n                getOr: identity,\r\n                getOrThunk: getOrThunk,\r\n                getOrDie: getOrDie,\r\n                or: or,\r\n                orThunk: orThunk,\r\n                fold: fold,\r\n                map: map,\r\n                mapError: mapError,\r\n                each: noop,\r\n                bind: bind,\r\n                exists: never,\r\n                forall: always,\r\n                toOption: Option.none\r\n            };\r\n        };\r\n        var fromOption = function (opt, err) {\r\n            return opt.fold(function () {\r\n                return error(err);\r\n            }, value);\r\n        };\r\n        var Result = {\r\n            value: value,\r\n            error: error,\r\n            fromOption: fromOption\r\n        };\r\n        function StyleSheetLoader(document, settings) {\r\n            if (settings === void 0) {\r\n                settings = {};\r\n            }\r\n            var idCount = 0;\r\n            var loadedStates = {};\r\n            var maxLoadTime;\r\n            maxLoadTime = settings.maxLoadTime || 5000;\r\n            var appendToHead = function (node) {\r\n                document.getElementsByTagName('head')[0].appendChild(node);\r\n            };\r\n            var load = function (url, loadedCallback, errorCallback) {\r\n                var link, style, startTime, state;\r\n                var resolve = function (status) {\r\n                    state.status = status;\r\n                    state.passed = [];\r\n                    state.failed = [];\r\n                    if (link) {\r\n                        link.onload = null;\r\n                        link.onerror = null;\r\n                        link = null;\r\n                    }\r\n                };\r\n                var passed = function () {\r\n                    var callbacks = state.passed;\r\n                    var i = callbacks.length;\r\n                    while (i--) {\r\n                        callbacks[i]();\r\n                    }\r\n                    resolve(2);\r\n                };\r\n                var failed = function () {\r\n                    var callbacks = state.failed;\r\n                    var i = callbacks.length;\r\n                    while (i--) {\r\n                        callbacks[i]();\r\n                    }\r\n                    resolve(3);\r\n                };\r\n                var isOldWebKit = function () {\r\n                    var webKitChunks = domGlobals.navigator.userAgent.match(/WebKit\\/(\\d*)/);\r\n                    return !!(webKitChunks && parseInt(webKitChunks[1], 10) < 536);\r\n                };\r\n                var wait = function (testCallback, waitCallback) {\r\n                    if (!testCallback()) {\r\n                        if (new Date().getTime() - startTime < maxLoadTime) {\r\n                            Delay.setTimeout(waitCallback);\r\n                        }\r\n                        else {\r\n                            failed();\r\n                        }\r\n                    }\r\n                };\r\n                var waitForWebKitLinkLoaded = function () {\r\n                    wait(function () {\r\n                        var styleSheets = document.styleSheets;\r\n                        var styleSheet, i = styleSheets.length, owner;\r\n                        while (i--) {\r\n                            styleSheet = styleSheets[i];\r\n                            owner = styleSheet.ownerNode ? styleSheet.ownerNode : styleSheet.owningElement;\r\n                            if (owner && owner.id === link.id) {\r\n                                passed();\r\n                                return true;\r\n                            }\r\n                        }\r\n                    }, waitForWebKitLinkLoaded);\r\n                };\r\n                var waitForGeckoLinkLoaded = function () {\r\n                    wait(function () {\r\n                        try {\r\n                            var cssRules = style.sheet.cssRules;\r\n                            passed();\r\n                            return !!cssRules;\r\n                        }\r\n                        catch (ex) {\r\n                        }\r\n                    }, waitForGeckoLinkLoaded);\r\n                };\r\n                url = Tools._addCacheSuffix(url);\r\n                if (!loadedStates[url]) {\r\n                    state = {\r\n                        passed: [],\r\n                        failed: []\r\n                    };\r\n                    loadedStates[url] = state;\r\n                }\r\n                else {\r\n                    state = loadedStates[url];\r\n                }\r\n                if (loadedCallback) {\r\n                    state.passed.push(loadedCallback);\r\n                }\r\n                if (errorCallback) {\r\n                    state.failed.push(errorCallback);\r\n                }\r\n                if (state.status === 1) {\r\n                    return;\r\n                }\r\n                if (state.status === 2) {\r\n                    passed();\r\n                    return;\r\n                }\r\n                if (state.status === 3) {\r\n                    failed();\r\n                    return;\r\n                }\r\n                state.status = 1;\r\n                link = document.createElement('link');\r\n                link.rel = 'stylesheet';\r\n                link.type = 'text/css';\r\n                link.id = 'u' + idCount++;\r\n                link.async = false;\r\n                link.defer = false;\r\n                startTime = new Date().getTime();\r\n                if (settings.contentCssCors) {\r\n                    link.crossOrigin = 'anonymous';\r\n                }\r\n                if ('onload' in link && !isOldWebKit()) {\r\n                    link.onload = waitForWebKitLinkLoaded;\r\n                    link.onerror = failed;\r\n                }\r\n                else {\r\n                    if (domGlobals.navigator.userAgent.indexOf('Firefox') > 0) {\r\n                        style = document.createElement('style');\r\n                        style.textContent = '@import \"' + url + '\"';\r\n                        waitForGeckoLinkLoaded();\r\n                        appendToHead(style);\r\n                        return;\r\n                    }\r\n                    waitForWebKitLinkLoaded();\r\n                }\r\n                appendToHead(link);\r\n                link.href = url;\r\n            };\r\n            var loadF = function (url) {\r\n                return Future.nu(function (resolve) {\r\n                    load(url, compose(resolve, constant(Result.value(url))), compose(resolve, constant(Result.error(url))));\r\n                });\r\n            };\r\n            var unbox = function (result) {\r\n                return result.fold(identity, identity);\r\n            };\r\n            var loadAll = function (urls, success, failure) {\r\n                par$1(map(urls, loadF)).get(function (result) {\r\n                    var parts = partition(result, function (r) {\r\n                        return r.isValue();\r\n                    });\r\n                    if (parts.fail.length > 0) {\r\n                        failure(parts.fail.map(unbox));\r\n                    }\r\n                    else {\r\n                        success(parts.pass.map(unbox));\r\n                    }\r\n                });\r\n            };\r\n            return {\r\n                load: load,\r\n                loadAll: loadAll\r\n            };\r\n        }\r\n        var isNodeType = function (type) {\r\n            return function (node) {\r\n                return !!node && node.nodeType === type;\r\n            };\r\n        };\r\n        var isElement$1 = isNodeType(1);\r\n        var matchNodeNames = function (names) {\r\n            var items = names.toLowerCase().split(' ');\r\n            return function (node) {\r\n                var i, name;\r\n                if (node && node.nodeType) {\r\n                    name = node.nodeName.toLowerCase();\r\n                    for (i = 0; i < items.length; i++) {\r\n                        if (name === items[i]) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n        };\r\n        var matchStyleValues = function (name, values) {\r\n            var items = values.toLowerCase().split(' ');\r\n            return function (node) {\r\n                var i, cssValue;\r\n                if (isElement$1(node)) {\r\n                    for (i = 0; i < items.length; i++) {\r\n                        var computed = node.ownerDocument.defaultView.getComputedStyle(node, null);\r\n                        cssValue = computed ? computed.getPropertyValue(name) : null;\r\n                        if (cssValue === items[i]) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n        };\r\n        var hasPropValue = function (propName, propValue) {\r\n            return function (node) {\r\n                return isElement$1(node) && node[propName] === propValue;\r\n            };\r\n        };\r\n        var hasAttribute = function (attrName, attrValue) {\r\n            return function (node) {\r\n                return isElement$1(node) && node.hasAttribute(attrName);\r\n            };\r\n        };\r\n        var hasAttributeValue = function (attrName, attrValue) {\r\n            return function (node) {\r\n                return isElement$1(node) && node.getAttribute(attrName) === attrValue;\r\n            };\r\n        };\r\n        var isBogus = function (node) {\r\n            return isElement$1(node) && node.hasAttribute('data-mce-bogus');\r\n        };\r\n        var isBogusAll = function (node) {\r\n            return isElement$1(node) && node.getAttribute('data-mce-bogus') === 'all';\r\n        };\r\n        var isTable = function (node) {\r\n            return isElement$1(node) && node.tagName === 'TABLE';\r\n        };\r\n        var hasContentEditableState = function (value) {\r\n            return function (node) {\r\n                if (isElement$1(node)) {\r\n                    if (node.contentEditable === value) {\r\n                        return true;\r\n                    }\r\n                    if (node.getAttribute('data-mce-contenteditable') === value) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n        };\r\n        var isText$1 = isNodeType(3);\r\n        var isComment = isNodeType(8);\r\n        var isDocument = isNodeType(9);\r\n        var isDocumentFragment = isNodeType(11);\r\n        var isBr = matchNodeNames('br');\r\n        var isContentEditableTrue = hasContentEditableState('true');\r\n        var isContentEditableFalse = hasContentEditableState('false');\r\n        var NodeType = {\r\n            isText: isText$1,\r\n            isElement: isElement$1,\r\n            isComment: isComment,\r\n            isDocument: isDocument,\r\n            isDocumentFragment: isDocumentFragment,\r\n            isBr: isBr,\r\n            isContentEditableTrue: isContentEditableTrue,\r\n            isContentEditableFalse: isContentEditableFalse,\r\n            matchNodeNames: matchNodeNames,\r\n            hasPropValue: hasPropValue,\r\n            hasAttribute: hasAttribute,\r\n            hasAttributeValue: hasAttributeValue,\r\n            matchStyleValues: matchStyleValues,\r\n            isBogus: isBogus,\r\n            isBogusAll: isBogusAll,\r\n            isTable: isTable\r\n        };\r\n        var TreeWalker = function () {\r\n            function TreeWalker(startNode, rootNode) {\r\n                this.node = startNode;\r\n                this.rootNode = rootNode;\r\n                this.current = this.current.bind(this);\r\n                this.next = this.next.bind(this);\r\n                this.prev = this.prev.bind(this);\r\n                this.prev2 = this.prev2.bind(this);\r\n            }\r\n            TreeWalker.prototype.current = function () {\r\n                return this.node;\r\n            };\r\n            TreeWalker.prototype.next = function (shallow) {\r\n                this.node = this.findSibling(this.node, 'firstChild', 'nextSibling', shallow);\r\n                return this.node;\r\n            };\r\n            TreeWalker.prototype.prev = function (shallow) {\r\n                this.node = this.findSibling(this.node, 'lastChild', 'previousSibling', shallow);\r\n                return this.node;\r\n            };\r\n            TreeWalker.prototype.prev2 = function (shallow) {\r\n                this.node = this.findPreviousNode(this.node, 'lastChild', 'previousSibling', shallow);\r\n                return this.node;\r\n            };\r\n            TreeWalker.prototype.findSibling = function (node, startName, siblingName, shallow) {\r\n                var sibling, parent;\r\n                if (node) {\r\n                    if (!shallow && node[startName]) {\r\n                        return node[startName];\r\n                    }\r\n                    if (node !== this.rootNode) {\r\n                        sibling = node[siblingName];\r\n                        if (sibling) {\r\n                            return sibling;\r\n                        }\r\n                        for (parent = node.parentNode; parent && parent !== this.rootNode; parent = parent.parentNode) {\r\n                            sibling = parent[siblingName];\r\n                            if (sibling) {\r\n                                return sibling;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            TreeWalker.prototype.findPreviousNode = function (node, startName, siblingName, shallow) {\r\n                var sibling, parent, child;\r\n                if (node) {\r\n                    sibling = node[siblingName];\r\n                    if (this.rootNode && sibling === this.rootNode) {\r\n                        return;\r\n                    }\r\n                    if (sibling) {\r\n                        if (!shallow) {\r\n                            for (child = sibling[startName]; child; child = child[startName]) {\r\n                                if (!child[startName]) {\r\n                                    return child;\r\n                                }\r\n                            }\r\n                        }\r\n                        return sibling;\r\n                    }\r\n                    parent = node.parentNode;\r\n                    if (parent && parent !== this.rootNode) {\r\n                        return parent;\r\n                    }\r\n                }\r\n            };\r\n            return TreeWalker;\r\n        }();\r\n        var blocks = [\r\n            'article',\r\n            'aside',\r\n            'details',\r\n            'div',\r\n            'dt',\r\n            'figcaption',\r\n            'footer',\r\n            'form',\r\n            'fieldset',\r\n            'header',\r\n            'hgroup',\r\n            'html',\r\n            'main',\r\n            'nav',\r\n            'section',\r\n            'summary',\r\n            'body',\r\n            'p',\r\n            'dl',\r\n            'multicol',\r\n            'dd',\r\n            'figure',\r\n            'address',\r\n            'center',\r\n            'blockquote',\r\n            'h1',\r\n            'h2',\r\n            'h3',\r\n            'h4',\r\n            'h5',\r\n            'h6',\r\n            'listing',\r\n            'xmp',\r\n            'pre',\r\n            'plaintext',\r\n            'menu',\r\n            'dir',\r\n            'ul',\r\n            'ol',\r\n            'li',\r\n            'hr',\r\n            'table',\r\n            'tbody',\r\n            'thead',\r\n            'tfoot',\r\n            'th',\r\n            'tr',\r\n            'td',\r\n            'caption'\r\n        ];\r\n        var voids = [\r\n            'area',\r\n            'base',\r\n            'basefont',\r\n            'br',\r\n            'col',\r\n            'frame',\r\n            'hr',\r\n            'img',\r\n            'input',\r\n            'isindex',\r\n            'link',\r\n            'meta',\r\n            'param',\r\n            'embed',\r\n            'source',\r\n            'wbr',\r\n            'track'\r\n        ];\r\n        var tableCells = [\r\n            'td',\r\n            'th'\r\n        ];\r\n        var tableSections = [\r\n            'thead',\r\n            'tbody',\r\n            'tfoot'\r\n        ];\r\n        var textBlocks = [\r\n            'h1',\r\n            'h2',\r\n            'h3',\r\n            'h4',\r\n            'h5',\r\n            'h6',\r\n            'p',\r\n            'div',\r\n            'address',\r\n            'pre',\r\n            'form',\r\n            'blockquote',\r\n            'center',\r\n            'dir',\r\n            'fieldset',\r\n            'header',\r\n            'footer',\r\n            'article',\r\n            'section',\r\n            'hgroup',\r\n            'aside',\r\n            'nav',\r\n            'figure'\r\n        ];\r\n        var headings = [\r\n            'h1',\r\n            'h2',\r\n            'h3',\r\n            'h4',\r\n            'h5',\r\n            'h6'\r\n        ];\r\n        var listItems = [\r\n            'li',\r\n            'dd',\r\n            'dt'\r\n        ];\r\n        var lists = [\r\n            'ul',\r\n            'ol',\r\n            'dl'\r\n        ];\r\n        var wsElements = [\r\n            'pre',\r\n            'script',\r\n            'textarea',\r\n            'style'\r\n        ];\r\n        var lazyLookup = function (items) {\r\n            var lookup;\r\n            return function (node) {\r\n                lookup = lookup ? lookup : mapToObject(items, constant(true));\r\n                return lookup.hasOwnProperty(name(node));\r\n            };\r\n        };\r\n        var isHeading = lazyLookup(headings);\r\n        var isBlock = lazyLookup(blocks);\r\n        var isTable$1 = function (node) {\r\n            return name(node) === 'table';\r\n        };\r\n        var isInline = function (node) {\r\n            return isElement(node) && !isBlock(node);\r\n        };\r\n        var isBr$1 = function (node) {\r\n            return isElement(node) && name(node) === 'br';\r\n        };\r\n        var isTextBlock = lazyLookup(textBlocks);\r\n        var isList = lazyLookup(lists);\r\n        var isListItem = lazyLookup(listItems);\r\n        var isVoid = lazyLookup(voids);\r\n        var isTableSection = lazyLookup(tableSections);\r\n        var isTableCell = lazyLookup(tableCells);\r\n        var isWsPreserveElement = lazyLookup(wsElements);\r\n        var surroundedBySpans = function (node) {\r\n            var previousIsSpan = node.previousSibling && node.previousSibling.nodeName === 'SPAN';\r\n            var nextIsSpan = node.nextSibling && node.nextSibling.nodeName === 'SPAN';\r\n            return previousIsSpan && nextIsSpan;\r\n        };\r\n        var isBookmarkNode = function (node) {\r\n            return node && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\r\n        };\r\n        var trimNode = function (dom, node) {\r\n            var i, children = node.childNodes;\r\n            if (NodeType.isElement(node) && isBookmarkNode(node)) {\r\n                return;\r\n            }\r\n            for (i = children.length - 1; i >= 0; i--) {\r\n                trimNode(dom, children[i]);\r\n            }\r\n            if (NodeType.isDocument(node) === false) {\r\n                if (NodeType.isText(node) && node.nodeValue.length > 0) {\r\n                    var trimmedLength = Tools.trim(node.nodeValue).length;\r\n                    if (dom.isBlock(node.parentNode) || trimmedLength > 0) {\r\n                        return;\r\n                    }\r\n                    if (trimmedLength === 0 && surroundedBySpans(node)) {\r\n                        return;\r\n                    }\r\n                }\r\n                else if (NodeType.isElement(node)) {\r\n                    children = node.childNodes;\r\n                    if (children.length === 1 && isBookmarkNode(children[0])) {\r\n                        node.parentNode.insertBefore(children[0], node);\r\n                    }\r\n                    if (children.length || isVoid(Element.fromDom(node))) {\r\n                        return;\r\n                    }\r\n                }\r\n                dom.remove(node);\r\n            }\r\n            return node;\r\n        };\r\n        var TrimNode = { trimNode: trimNode };\r\n        var makeMap$1 = Tools.makeMap;\r\n        var namedEntities, baseEntities, reverseEntities;\r\n        var attrsCharsRegExp = /[&<>\\\"\\u0060\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\r\n        var textCharsRegExp = /[<>&\\u007E-\\uD7FF\\uE000-\\uFFEF]|[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g;\r\n        var rawCharsRegExp = /[<>&\\\"\\']/g;\r\n        var entityRegExp = /&#([a-z0-9]+);?|&([a-z0-9]+);/gi;\r\n        var asciiMap = {\r\n            128: '\\u20AC',\r\n            130: '\\u201A',\r\n            131: '\\u0192',\r\n            132: '\\u201E',\r\n            133: '\\u2026',\r\n            134: '\\u2020',\r\n            135: '\\u2021',\r\n            136: '\\u02c6',\r\n            137: '\\u2030',\r\n            138: '\\u0160',\r\n            139: '\\u2039',\r\n            140: '\\u0152',\r\n            142: '\\u017d',\r\n            145: '\\u2018',\r\n            146: '\\u2019',\r\n            147: '\\u201C',\r\n            148: '\\u201D',\r\n            149: '\\u2022',\r\n            150: '\\u2013',\r\n            151: '\\u2014',\r\n            152: '\\u02DC',\r\n            153: '\\u2122',\r\n            154: '\\u0161',\r\n            155: '\\u203A',\r\n            156: '\\u0153',\r\n            158: '\\u017e',\r\n            159: '\\u0178'\r\n        };\r\n        baseEntities = {\r\n            '\"': '&quot;',\r\n            '\\'': '&#39;',\r\n            '<': '&lt;',\r\n            '>': '&gt;',\r\n            '&': '&amp;',\r\n            '`': '&#96;'\r\n        };\r\n        reverseEntities = {\r\n            '&lt;': '<',\r\n            '&gt;': '>',\r\n            '&amp;': '&',\r\n            '&quot;': '\"',\r\n            '&apos;': '\\''\r\n        };\r\n        var nativeDecode = function (text) {\r\n            var elm;\r\n            elm = Element.fromTag('div').dom();\r\n            elm.innerHTML = text;\r\n            return elm.textContent || elm.innerText || text;\r\n        };\r\n        var buildEntitiesLookup = function (items, radix) {\r\n            var i, chr, entity;\r\n            var lookup = {};\r\n            if (items) {\r\n                items = items.split(',');\r\n                radix = radix || 10;\r\n                for (i = 0; i < items.length; i += 2) {\r\n                    chr = String.fromCharCode(parseInt(items[i], radix));\r\n                    if (!baseEntities[chr]) {\r\n                        entity = '&' + items[i + 1] + ';';\r\n                        lookup[chr] = entity;\r\n                        lookup[entity] = chr;\r\n                    }\r\n                }\r\n                return lookup;\r\n            }\r\n        };\r\n        namedEntities = buildEntitiesLookup('50,nbsp,51,iexcl,52,cent,53,pound,54,curren,55,yen,56,brvbar,57,sect,58,uml,59,copy,' + '5a,ordf,5b,laquo,5c,not,5d,shy,5e,reg,5f,macr,5g,deg,5h,plusmn,5i,sup2,5j,sup3,5k,acute,' + '5l,micro,5m,para,5n,middot,5o,cedil,5p,sup1,5q,ordm,5r,raquo,5s,frac14,5t,frac12,5u,frac34,' + '5v,iquest,60,Agrave,61,Aacute,62,Acirc,63,Atilde,64,Auml,65,Aring,66,AElig,67,Ccedil,' + '68,Egrave,69,Eacute,6a,Ecirc,6b,Euml,6c,Igrave,6d,Iacute,6e,Icirc,6f,Iuml,6g,ETH,6h,Ntilde,' + '6i,Ograve,6j,Oacute,6k,Ocirc,6l,Otilde,6m,Ouml,6n,times,6o,Oslash,6p,Ugrave,6q,Uacute,' + '6r,Ucirc,6s,Uuml,6t,Yacute,6u,THORN,6v,szlig,70,agrave,71,aacute,72,acirc,73,atilde,74,auml,' + '75,aring,76,aelig,77,ccedil,78,egrave,79,eacute,7a,ecirc,7b,euml,7c,igrave,7d,iacute,7e,icirc,' + '7f,iuml,7g,eth,7h,ntilde,7i,ograve,7j,oacute,7k,ocirc,7l,otilde,7m,ouml,7n,divide,7o,oslash,' + '7p,ugrave,7q,uacute,7r,ucirc,7s,uuml,7t,yacute,7u,thorn,7v,yuml,ci,fnof,sh,Alpha,si,Beta,' + 'sj,Gamma,sk,Delta,sl,Epsilon,sm,Zeta,sn,Eta,so,Theta,sp,Iota,sq,Kappa,sr,Lambda,ss,Mu,' + 'st,Nu,su,Xi,sv,Omicron,t0,Pi,t1,Rho,t3,Sigma,t4,Tau,t5,Upsilon,t6,Phi,t7,Chi,t8,Psi,' + 't9,Omega,th,alpha,ti,beta,tj,gamma,tk,delta,tl,epsilon,tm,zeta,tn,eta,to,theta,tp,iota,' + 'tq,kappa,tr,lambda,ts,mu,tt,nu,tu,xi,tv,omicron,u0,pi,u1,rho,u2,sigmaf,u3,sigma,u4,tau,' + 'u5,upsilon,u6,phi,u7,chi,u8,psi,u9,omega,uh,thetasym,ui,upsih,um,piv,812,bull,816,hellip,' + '81i,prime,81j,Prime,81u,oline,824,frasl,88o,weierp,88h,image,88s,real,892,trade,89l,alefsym,' + '8cg,larr,8ch,uarr,8ci,rarr,8cj,darr,8ck,harr,8dl,crarr,8eg,lArr,8eh,uArr,8ei,rArr,8ej,dArr,' + '8ek,hArr,8g0,forall,8g2,part,8g3,exist,8g5,empty,8g7,nabla,8g8,isin,8g9,notin,8gb,ni,8gf,prod,' + '8gh,sum,8gi,minus,8gn,lowast,8gq,radic,8gt,prop,8gu,infin,8h0,ang,8h7,and,8h8,or,8h9,cap,8ha,cup,' + '8hb,int,8hk,there4,8hs,sim,8i5,cong,8i8,asymp,8j0,ne,8j1,equiv,8j4,le,8j5,ge,8k2,sub,8k3,sup,8k4,' + 'nsub,8k6,sube,8k7,supe,8kl,oplus,8kn,otimes,8l5,perp,8m5,sdot,8o8,lceil,8o9,rceil,8oa,lfloor,8ob,' + 'rfloor,8p9,lang,8pa,rang,9ea,loz,9j0,spades,9j3,clubs,9j5,hearts,9j6,diams,ai,OElig,aj,oelig,b0,' + 'Scaron,b1,scaron,bo,Yuml,m6,circ,ms,tilde,802,ensp,803,emsp,809,thinsp,80c,zwnj,80d,zwj,80e,lrm,' + '80f,rlm,80j,ndash,80k,mdash,80o,lsquo,80p,rsquo,80q,sbquo,80s,ldquo,80t,rdquo,80u,bdquo,810,dagger,' + '811,Dagger,81g,permil,81p,lsaquo,81q,rsaquo,85c,euro', 32);\r\n        var encodeRaw = function (text, attr) {\r\n            return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\r\n                return baseEntities[chr] || chr;\r\n            });\r\n        };\r\n        var encodeAllRaw = function (text) {\r\n            return ('' + text).replace(rawCharsRegExp, function (chr) {\r\n                return baseEntities[chr] || chr;\r\n            });\r\n        };\r\n        var encodeNumeric = function (text, attr) {\r\n            return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\r\n                if (chr.length > 1) {\r\n                    return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\r\n                }\r\n                return baseEntities[chr] || '&#' + chr.charCodeAt(0) + ';';\r\n            });\r\n        };\r\n        var encodeNamed = function (text, attr, entities) {\r\n            entities = entities || namedEntities;\r\n            return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\r\n                return baseEntities[chr] || entities[chr] || chr;\r\n            });\r\n        };\r\n        var getEncodeFunc = function (name, entities) {\r\n            var entitiesMap = buildEntitiesLookup(entities) || namedEntities;\r\n            var encodeNamedAndNumeric = function (text, attr) {\r\n                return text.replace(attr ? attrsCharsRegExp : textCharsRegExp, function (chr) {\r\n                    if (baseEntities[chr] !== undefined) {\r\n                        return baseEntities[chr];\r\n                    }\r\n                    if (entitiesMap[chr] !== undefined) {\r\n                        return entitiesMap[chr];\r\n                    }\r\n                    if (chr.length > 1) {\r\n                        return '&#' + ((chr.charCodeAt(0) - 55296) * 1024 + (chr.charCodeAt(1) - 56320) + 65536) + ';';\r\n                    }\r\n                    return '&#' + chr.charCodeAt(0) + ';';\r\n                });\r\n            };\r\n            var encodeCustomNamed = function (text, attr) {\r\n                return encodeNamed(text, attr, entitiesMap);\r\n            };\r\n            var nameMap = makeMap$1(name.replace(/\\+/g, ','));\r\n            if (nameMap.named && nameMap.numeric) {\r\n                return encodeNamedAndNumeric;\r\n            }\r\n            if (nameMap.named) {\r\n                if (entities) {\r\n                    return encodeCustomNamed;\r\n                }\r\n                return encodeNamed;\r\n            }\r\n            if (nameMap.numeric) {\r\n                return encodeNumeric;\r\n            }\r\n            return encodeRaw;\r\n        };\r\n        var decode = function (text) {\r\n            return text.replace(entityRegExp, function (all, numeric) {\r\n                if (numeric) {\r\n                    if (numeric.charAt(0).toLowerCase() === 'x') {\r\n                        numeric = parseInt(numeric.substr(1), 16);\r\n                    }\r\n                    else {\r\n                        numeric = parseInt(numeric, 10);\r\n                    }\r\n                    if (numeric > 65535) {\r\n                        numeric -= 65536;\r\n                        return String.fromCharCode(55296 + (numeric >> 10), 56320 + (numeric & 1023));\r\n                    }\r\n                    return asciiMap[numeric] || String.fromCharCode(numeric);\r\n                }\r\n                return reverseEntities[all] || namedEntities[all] || nativeDecode(all);\r\n            });\r\n        };\r\n        var Entities = {\r\n            encodeRaw: encodeRaw,\r\n            encodeAllRaw: encodeAllRaw,\r\n            encodeNumeric: encodeNumeric,\r\n            encodeNamed: encodeNamed,\r\n            getEncodeFunc: getEncodeFunc,\r\n            decode: decode\r\n        };\r\n        var mapCache = {}, dummyObj = {};\r\n        var makeMap$2 = Tools.makeMap, each$4 = Tools.each, extend$1 = Tools.extend, explode$1 = Tools.explode, inArray$1 = Tools.inArray;\r\n        var split = function (items, delim) {\r\n            items = Tools.trim(items);\r\n            return items ? items.split(delim || ' ') : [];\r\n        };\r\n        var compileSchema = function (type) {\r\n            var schema = {};\r\n            var globalAttributes, blockContent;\r\n            var phrasingContent, flowContent, html4BlockContent, html4PhrasingContent;\r\n            var add = function (name, attributes, children) {\r\n                var ni, attributesOrder, element;\r\n                var arrayToMap = function (array, obj) {\r\n                    var map = {};\r\n                    var i, l;\r\n                    for (i = 0, l = array.length; i < l; i++) {\r\n                        map[array[i]] = obj || {};\r\n                    }\r\n                    return map;\r\n                };\r\n                children = children || [];\r\n                attributes = attributes || '';\r\n                if (typeof children === 'string') {\r\n                    children = split(children);\r\n                }\r\n                name = split(name);\r\n                ni = name.length;\r\n                while (ni--) {\r\n                    attributesOrder = split([\r\n                        globalAttributes,\r\n                        attributes\r\n                    ].join(' '));\r\n                    element = {\r\n                        attributes: arrayToMap(attributesOrder),\r\n                        attributesOrder: attributesOrder,\r\n                        children: arrayToMap(children, dummyObj)\r\n                    };\r\n                    schema[name[ni]] = element;\r\n                }\r\n            };\r\n            var addAttrs = function (name, attributes) {\r\n                var ni, schemaItem, i, l;\r\n                name = split(name);\r\n                ni = name.length;\r\n                attributes = split(attributes);\r\n                while (ni--) {\r\n                    schemaItem = schema[name[ni]];\r\n                    for (i = 0, l = attributes.length; i < l; i++) {\r\n                        schemaItem.attributes[attributes[i]] = {};\r\n                        schemaItem.attributesOrder.push(attributes[i]);\r\n                    }\r\n                }\r\n            };\r\n            if (mapCache[type]) {\r\n                return mapCache[type];\r\n            }\r\n            globalAttributes = 'id accesskey class dir lang style tabindex title role';\r\n            blockContent = 'address blockquote div dl fieldset form h1 h2 h3 h4 h5 h6 hr menu ol p pre table ul';\r\n            phrasingContent = 'a abbr b bdo br button cite code del dfn em embed i iframe img input ins kbd ' + 'label map noscript object q s samp script select small span strong sub sup ' + 'textarea u var #text #comment';\r\n            if (type !== 'html4') {\r\n                globalAttributes += ' contenteditable contextmenu draggable dropzone ' + 'hidden spellcheck translate';\r\n                blockContent += ' article aside details dialog figure main header footer hgroup section nav';\r\n                phrasingContent += ' audio canvas command datalist mark meter output picture ' + 'progress time wbr video ruby bdi keygen';\r\n            }\r\n            if (type !== 'html5-strict') {\r\n                globalAttributes += ' xml:lang';\r\n                html4PhrasingContent = 'acronym applet basefont big font strike tt';\r\n                phrasingContent = [\r\n                    phrasingContent,\r\n                    html4PhrasingContent\r\n                ].join(' ');\r\n                each$4(split(html4PhrasingContent), function (name) {\r\n                    add(name, '', phrasingContent);\r\n                });\r\n                html4BlockContent = 'center dir isindex noframes';\r\n                blockContent = [\r\n                    blockContent,\r\n                    html4BlockContent\r\n                ].join(' ');\r\n                flowContent = [\r\n                    blockContent,\r\n                    phrasingContent\r\n                ].join(' ');\r\n                each$4(split(html4BlockContent), function (name) {\r\n                    add(name, '', flowContent);\r\n                });\r\n            }\r\n            flowContent = flowContent || [\r\n                blockContent,\r\n                phrasingContent\r\n            ].join(' ');\r\n            add('html', 'manifest', 'head body');\r\n            add('head', '', 'base command link meta noscript script style title');\r\n            add('title hr noscript br');\r\n            add('base', 'href target');\r\n            add('link', 'href rel media hreflang type sizes hreflang');\r\n            add('meta', 'name http-equiv content charset');\r\n            add('style', 'media type scoped');\r\n            add('script', 'src async defer type charset');\r\n            add('body', 'onafterprint onbeforeprint onbeforeunload onblur onerror onfocus ' + 'onhashchange onload onmessage onoffline ononline onpagehide onpageshow ' + 'onpopstate onresize onscroll onstorage onunload', flowContent);\r\n            add('address dt dd div caption', '', flowContent);\r\n            add('h1 h2 h3 h4 h5 h6 pre p abbr code var samp kbd sub sup i b u bdo span legend em strong small s cite dfn', '', phrasingContent);\r\n            add('blockquote', 'cite', flowContent);\r\n            add('ol', 'reversed start type', 'li');\r\n            add('ul', '', 'li');\r\n            add('li', 'value', flowContent);\r\n            add('dl', '', 'dt dd');\r\n            add('a', 'href target rel media hreflang type', phrasingContent);\r\n            add('q', 'cite', phrasingContent);\r\n            add('ins del', 'cite datetime', flowContent);\r\n            add('img', 'src sizes srcset alt usemap ismap width height');\r\n            add('iframe', 'src name width height', flowContent);\r\n            add('embed', 'src type width height');\r\n            add('object', 'data type typemustmatch name usemap form width height', [\r\n                flowContent,\r\n                'param'\r\n            ].join(' '));\r\n            add('param', 'name value');\r\n            add('map', 'name', [\r\n                flowContent,\r\n                'area'\r\n            ].join(' '));\r\n            add('area', 'alt coords shape href target rel media hreflang type');\r\n            add('table', 'border', 'caption colgroup thead tfoot tbody tr' + (type === 'html4' ? ' col' : ''));\r\n            add('colgroup', 'span', 'col');\r\n            add('col', 'span');\r\n            add('tbody thead tfoot', '', 'tr');\r\n            add('tr', '', 'td th');\r\n            add('td', 'colspan rowspan headers', flowContent);\r\n            add('th', 'colspan rowspan headers scope abbr', flowContent);\r\n            add('form', 'accept-charset action autocomplete enctype method name novalidate target', flowContent);\r\n            add('fieldset', 'disabled form name', [\r\n                flowContent,\r\n                'legend'\r\n            ].join(' '));\r\n            add('label', 'form for', phrasingContent);\r\n            add('input', 'accept alt autocomplete checked dirname disabled form formaction formenctype formmethod formnovalidate ' + 'formtarget height list max maxlength min multiple name pattern readonly required size src step type value width');\r\n            add('button', 'disabled form formaction formenctype formmethod formnovalidate formtarget name type value', type === 'html4' ? flowContent : phrasingContent);\r\n            add('select', 'disabled form multiple name required size', 'option optgroup');\r\n            add('optgroup', 'disabled label', 'option');\r\n            add('option', 'disabled label selected value');\r\n            add('textarea', 'cols dirname disabled form maxlength name readonly required rows wrap');\r\n            add('menu', 'type label', [\r\n                flowContent,\r\n                'li'\r\n            ].join(' '));\r\n            add('noscript', '', flowContent);\r\n            if (type !== 'html4') {\r\n                add('wbr');\r\n                add('ruby', '', [\r\n                    phrasingContent,\r\n                    'rt rp'\r\n                ].join(' '));\r\n                add('figcaption', '', flowContent);\r\n                add('mark rt rp summary bdi', '', phrasingContent);\r\n                add('canvas', 'width height', flowContent);\r\n                add('video', 'src crossorigin poster preload autoplay mediagroup loop ' + 'muted controls width height buffered', [\r\n                    flowContent,\r\n                    'track source'\r\n                ].join(' '));\r\n                add('audio', 'src crossorigin preload autoplay mediagroup loop muted controls ' + 'buffered volume', [\r\n                    flowContent,\r\n                    'track source'\r\n                ].join(' '));\r\n                add('picture', '', 'img source');\r\n                add('source', 'src srcset type media sizes');\r\n                add('track', 'kind src srclang label default');\r\n                add('datalist', '', [\r\n                    phrasingContent,\r\n                    'option'\r\n                ].join(' '));\r\n                add('article section nav aside main header footer', '', flowContent);\r\n                add('hgroup', '', 'h1 h2 h3 h4 h5 h6');\r\n                add('figure', '', [\r\n                    flowContent,\r\n                    'figcaption'\r\n                ].join(' '));\r\n                add('time', 'datetime', phrasingContent);\r\n                add('dialog', 'open', flowContent);\r\n                add('command', 'type label icon disabled checked radiogroup command');\r\n                add('output', 'for form name', phrasingContent);\r\n                add('progress', 'value max', phrasingContent);\r\n                add('meter', 'value min max low high optimum', phrasingContent);\r\n                add('details', 'open', [\r\n                    flowContent,\r\n                    'summary'\r\n                ].join(' '));\r\n                add('keygen', 'autofocus challenge disabled form keytype name');\r\n            }\r\n            if (type !== 'html5-strict') {\r\n                addAttrs('script', 'language xml:space');\r\n                addAttrs('style', 'xml:space');\r\n                addAttrs('object', 'declare classid code codebase codetype archive standby align border hspace vspace');\r\n                addAttrs('embed', 'align name hspace vspace');\r\n                addAttrs('param', 'valuetype type');\r\n                addAttrs('a', 'charset name rev shape coords');\r\n                addAttrs('br', 'clear');\r\n                addAttrs('applet', 'codebase archive code object alt name width height align hspace vspace');\r\n                addAttrs('img', 'name longdesc align border hspace vspace');\r\n                addAttrs('iframe', 'longdesc frameborder marginwidth marginheight scrolling align');\r\n                addAttrs('font basefont', 'size color face');\r\n                addAttrs('input', 'usemap align');\r\n                addAttrs('select', 'onchange');\r\n                addAttrs('textarea');\r\n                addAttrs('h1 h2 h3 h4 h5 h6 div p legend caption', 'align');\r\n                addAttrs('ul', 'type compact');\r\n                addAttrs('li', 'type');\r\n                addAttrs('ol dl menu dir', 'compact');\r\n                addAttrs('pre', 'width xml:space');\r\n                addAttrs('hr', 'align noshade size width');\r\n                addAttrs('isindex', 'prompt');\r\n                addAttrs('table', 'summary width frame rules cellspacing cellpadding align bgcolor');\r\n                addAttrs('col', 'width align char charoff valign');\r\n                addAttrs('colgroup', 'width align char charoff valign');\r\n                addAttrs('thead', 'align char charoff valign');\r\n                addAttrs('tr', 'align char charoff valign bgcolor');\r\n                addAttrs('th', 'axis align char charoff valign nowrap bgcolor width height');\r\n                addAttrs('form', 'accept');\r\n                addAttrs('td', 'abbr axis scope align char charoff valign nowrap bgcolor width height');\r\n                addAttrs('tfoot', 'align char charoff valign');\r\n                addAttrs('tbody', 'align char charoff valign');\r\n                addAttrs('area', 'nohref');\r\n                addAttrs('body', 'background bgcolor text link vlink alink');\r\n            }\r\n            if (type !== 'html4') {\r\n                addAttrs('input button select textarea', 'autofocus');\r\n                addAttrs('input textarea', 'placeholder');\r\n                addAttrs('a', 'download');\r\n                addAttrs('link script img', 'crossorigin');\r\n                addAttrs('iframe', 'sandbox seamless allowfullscreen');\r\n            }\r\n            each$4(split('a form meter progress dfn'), function (name) {\r\n                if (schema[name]) {\r\n                    delete schema[name].children[name];\r\n                }\r\n            });\r\n            delete schema.caption.children.table;\r\n            delete schema.script;\r\n            mapCache[type] = schema;\r\n            return schema;\r\n        };\r\n        var compileElementMap = function (value, mode) {\r\n            var styles;\r\n            if (value) {\r\n                styles = {};\r\n                if (typeof value === 'string') {\r\n                    value = { '*': value };\r\n                }\r\n                each$4(value, function (value, key) {\r\n                    styles[key] = styles[key.toUpperCase()] = mode === 'map' ? makeMap$2(value, /[, ]/) : explode$1(value, /[, ]/);\r\n                });\r\n            }\r\n            return styles;\r\n        };\r\n        function Schema(settings) {\r\n            var elements = {};\r\n            var children = {};\r\n            var patternElements = [];\r\n            var validStyles;\r\n            var invalidStyles;\r\n            var schemaItems;\r\n            var whiteSpaceElementsMap, selfClosingElementsMap, shortEndedElementsMap, boolAttrMap, validClasses;\r\n            var blockElementsMap, nonEmptyElementsMap, moveCaretBeforeOnEnterElementsMap, textBlockElementsMap, textInlineElementsMap;\r\n            var customElementsMap = {}, specialElements = {};\r\n            var createLookupTable = function (option, defaultValue, extendWith) {\r\n                var value = settings[option];\r\n                if (!value) {\r\n                    value = mapCache[option];\r\n                    if (!value) {\r\n                        value = makeMap$2(defaultValue, ' ', makeMap$2(defaultValue.toUpperCase(), ' '));\r\n                        value = extend$1(value, extendWith);\r\n                        mapCache[option] = value;\r\n                    }\r\n                }\r\n                else {\r\n                    value = makeMap$2(value, /[, ]/, makeMap$2(value.toUpperCase(), /[, ]/));\r\n                }\r\n                return value;\r\n            };\r\n            settings = settings || {};\r\n            schemaItems = compileSchema(settings.schema);\r\n            if (settings.verify_html === false) {\r\n                settings.valid_elements = '*[*]';\r\n            }\r\n            validStyles = compileElementMap(settings.valid_styles);\r\n            invalidStyles = compileElementMap(settings.invalid_styles, 'map');\r\n            validClasses = compileElementMap(settings.valid_classes, 'map');\r\n            whiteSpaceElementsMap = createLookupTable('whitespace_elements', 'pre script noscript style textarea video audio iframe object code');\r\n            selfClosingElementsMap = createLookupTable('self_closing_elements', 'colgroup dd dt li option p td tfoot th thead tr');\r\n            shortEndedElementsMap = createLookupTable('short_ended_elements', 'area base basefont br col frame hr img input isindex link ' + 'meta param embed source wbr track');\r\n            boolAttrMap = createLookupTable('boolean_attributes', 'checked compact declare defer disabled ismap multiple nohref noresize ' + 'noshade nowrap readonly selected autoplay loop controls');\r\n            nonEmptyElementsMap = createLookupTable('non_empty_elements', 'td th iframe video audio object ' + 'script pre code', shortEndedElementsMap);\r\n            moveCaretBeforeOnEnterElementsMap = createLookupTable('move_caret_before_on_enter_elements', 'table', nonEmptyElementsMap);\r\n            textBlockElementsMap = createLookupTable('text_block_elements', 'h1 h2 h3 h4 h5 h6 p div address pre form ' + 'blockquote center dir fieldset header footer article section hgroup aside main nav figure');\r\n            blockElementsMap = createLookupTable('block_elements', 'hr table tbody thead tfoot ' + 'th tr td li ol ul caption dl dt dd noscript menu isindex option ' + 'datalist select optgroup figcaption details summary', textBlockElementsMap);\r\n            textInlineElementsMap = createLookupTable('text_inline_elements', 'span strong b em i font strike u var cite ' + 'dfn code mark q sup sub samp');\r\n            each$4((settings.special || 'script noscript noframes noembed title style textarea xmp').split(' '), function (name) {\r\n                specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\r\n            });\r\n            var patternToRegExp = function (str) {\r\n                return new RegExp('^' + str.replace(/([?+*])/g, '.$1') + '$');\r\n            };\r\n            var addValidElements = function (validElements) {\r\n                var ei, el, ai, al, matches, element, attr, attrData, elementName, attrName, attrType, attributes, attributesOrder, prefix, outputName, globalAttributes, globalAttributesOrder, key, value;\r\n                var elementRuleRegExp = /^([#+\\-])?([^\\[!\\/]+)(?:\\/([^\\[!]+))?(?:(!?)\\[([^\\]]+)\\])?$/, attrRuleRegExp = /^([!\\-])?(\\w+[\\\\:]:\\w+|[^=:<]+)?(?:([=:<])(.*))?$/, hasPatternsRegExp = /[*?+]/;\r\n                if (validElements) {\r\n                    validElements = split(validElements, ',');\r\n                    if (elements['@']) {\r\n                        globalAttributes = elements['@'].attributes;\r\n                        globalAttributesOrder = elements['@'].attributesOrder;\r\n                    }\r\n                    for (ei = 0, el = validElements.length; ei < el; ei++) {\r\n                        matches = elementRuleRegExp.exec(validElements[ei]);\r\n                        if (matches) {\r\n                            prefix = matches[1];\r\n                            elementName = matches[2];\r\n                            outputName = matches[3];\r\n                            attrData = matches[5];\r\n                            attributes = {};\r\n                            attributesOrder = [];\r\n                            element = {\r\n                                attributes: attributes,\r\n                                attributesOrder: attributesOrder\r\n                            };\r\n                            if (prefix === '#') {\r\n                                element.paddEmpty = true;\r\n                            }\r\n                            if (prefix === '-') {\r\n                                element.removeEmpty = true;\r\n                            }\r\n                            if (matches[4] === '!') {\r\n                                element.removeEmptyAttrs = true;\r\n                            }\r\n                            if (globalAttributes) {\r\n                                for (key in globalAttributes) {\r\n                                    attributes[key] = globalAttributes[key];\r\n                                }\r\n                                attributesOrder.push.apply(attributesOrder, globalAttributesOrder);\r\n                            }\r\n                            if (attrData) {\r\n                                attrData = split(attrData, '|');\r\n                                for (ai = 0, al = attrData.length; ai < al; ai++) {\r\n                                    matches = attrRuleRegExp.exec(attrData[ai]);\r\n                                    if (matches) {\r\n                                        attr = {};\r\n                                        attrType = matches[1];\r\n                                        attrName = matches[2].replace(/[\\\\:]:/g, ':');\r\n                                        prefix = matches[3];\r\n                                        value = matches[4];\r\n                                        if (attrType === '!') {\r\n                                            element.attributesRequired = element.attributesRequired || [];\r\n                                            element.attributesRequired.push(attrName);\r\n                                            attr.required = true;\r\n                                        }\r\n                                        if (attrType === '-') {\r\n                                            delete attributes[attrName];\r\n                                            attributesOrder.splice(inArray$1(attributesOrder, attrName), 1);\r\n                                            continue;\r\n                                        }\r\n                                        if (prefix) {\r\n                                            if (prefix === '=') {\r\n                                                element.attributesDefault = element.attributesDefault || [];\r\n                                                element.attributesDefault.push({\r\n                                                    name: attrName,\r\n                                                    value: value\r\n                                                });\r\n                                                attr.defaultValue = value;\r\n                                            }\r\n                                            if (prefix === ':') {\r\n                                                element.attributesForced = element.attributesForced || [];\r\n                                                element.attributesForced.push({\r\n                                                    name: attrName,\r\n                                                    value: value\r\n                                                });\r\n                                                attr.forcedValue = value;\r\n                                            }\r\n                                            if (prefix === '<') {\r\n                                                attr.validValues = makeMap$2(value, '?');\r\n                                            }\r\n                                        }\r\n                                        if (hasPatternsRegExp.test(attrName)) {\r\n                                            element.attributePatterns = element.attributePatterns || [];\r\n                                            attr.pattern = patternToRegExp(attrName);\r\n                                            element.attributePatterns.push(attr);\r\n                                        }\r\n                                        else {\r\n                                            if (!attributes[attrName]) {\r\n                                                attributesOrder.push(attrName);\r\n                                            }\r\n                                            attributes[attrName] = attr;\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (!globalAttributes && elementName === '@') {\r\n                                globalAttributes = attributes;\r\n                                globalAttributesOrder = attributesOrder;\r\n                            }\r\n                            if (outputName) {\r\n                                element.outputName = elementName;\r\n                                elements[outputName] = element;\r\n                            }\r\n                            if (hasPatternsRegExp.test(elementName)) {\r\n                                element.pattern = patternToRegExp(elementName);\r\n                                patternElements.push(element);\r\n                            }\r\n                            else {\r\n                                elements[elementName] = element;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var setValidElements = function (validElements) {\r\n                elements = {};\r\n                patternElements = [];\r\n                addValidElements(validElements);\r\n                each$4(schemaItems, function (element, name) {\r\n                    children[name] = element.children;\r\n                });\r\n            };\r\n            var addCustomElements = function (customElements) {\r\n                var customElementRegExp = /^(~)?(.+)$/;\r\n                if (customElements) {\r\n                    mapCache.text_block_elements = mapCache.block_elements = null;\r\n                    each$4(split(customElements, ','), function (rule) {\r\n                        var matches = customElementRegExp.exec(rule), inline = matches[1] === '~', cloneName = inline ? 'span' : 'div', name = matches[2];\r\n                        children[name] = children[cloneName];\r\n                        customElementsMap[name] = cloneName;\r\n                        if (!inline) {\r\n                            blockElementsMap[name.toUpperCase()] = {};\r\n                            blockElementsMap[name] = {};\r\n                        }\r\n                        if (!elements[name]) {\r\n                            var customRule = elements[cloneName];\r\n                            customRule = extend$1({}, customRule);\r\n                            delete customRule.removeEmptyAttrs;\r\n                            delete customRule.removeEmpty;\r\n                            elements[name] = customRule;\r\n                        }\r\n                        each$4(children, function (element, elmName) {\r\n                            if (element[cloneName]) {\r\n                                children[elmName] = element = extend$1({}, children[elmName]);\r\n                                element[name] = element[cloneName];\r\n                            }\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n            var addValidChildren = function (validChildren) {\r\n                var childRuleRegExp = /^([+\\-]?)(\\w+)\\[([^\\]]+)\\]$/;\r\n                mapCache[settings.schema] = null;\r\n                if (validChildren) {\r\n                    each$4(split(validChildren, ','), function (rule) {\r\n                        var matches = childRuleRegExp.exec(rule);\r\n                        var parent, prefix;\r\n                        if (matches) {\r\n                            prefix = matches[1];\r\n                            if (prefix) {\r\n                                parent = children[matches[2]];\r\n                            }\r\n                            else {\r\n                                parent = children[matches[2]] = { '#comment': {} };\r\n                            }\r\n                            parent = children[matches[2]];\r\n                            each$4(split(matches[3], '|'), function (child) {\r\n                                if (prefix === '-') {\r\n                                    delete parent[child];\r\n                                }\r\n                                else {\r\n                                    parent[child] = {};\r\n                                }\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var getElementRule = function (name) {\r\n                var element = elements[name], i;\r\n                if (element) {\r\n                    return element;\r\n                }\r\n                i = patternElements.length;\r\n                while (i--) {\r\n                    element = patternElements[i];\r\n                    if (element.pattern.test(name)) {\r\n                        return element;\r\n                    }\r\n                }\r\n            };\r\n            if (!settings.valid_elements) {\r\n                each$4(schemaItems, function (element, name) {\r\n                    elements[name] = {\r\n                        attributes: element.attributes,\r\n                        attributesOrder: element.attributesOrder\r\n                    };\r\n                    children[name] = element.children;\r\n                });\r\n                if (settings.schema !== 'html5') {\r\n                    each$4(split('strong/b em/i'), function (item) {\r\n                        item = split(item, '/');\r\n                        elements[item[1]].outputName = item[0];\r\n                    });\r\n                }\r\n                each$4(split('ol ul sub sup blockquote span font a table tbody tr strong em b i'), function (name) {\r\n                    if (elements[name]) {\r\n                        elements[name].removeEmpty = true;\r\n                    }\r\n                });\r\n                each$4(split('p h1 h2 h3 h4 h5 h6 th td pre div address caption li'), function (name) {\r\n                    elements[name].paddEmpty = true;\r\n                });\r\n                each$4(split('span'), function (name) {\r\n                    elements[name].removeEmptyAttrs = true;\r\n                });\r\n            }\r\n            else {\r\n                setValidElements(settings.valid_elements);\r\n            }\r\n            addCustomElements(settings.custom_elements);\r\n            addValidChildren(settings.valid_children);\r\n            addValidElements(settings.extended_valid_elements);\r\n            addValidChildren('+ol[ul|ol],+ul[ul|ol]');\r\n            each$4({\r\n                dd: 'dl',\r\n                dt: 'dl',\r\n                li: 'ul ol',\r\n                td: 'tr',\r\n                th: 'tr',\r\n                tr: 'tbody thead tfoot',\r\n                tbody: 'table',\r\n                thead: 'table',\r\n                tfoot: 'table',\r\n                legend: 'fieldset',\r\n                area: 'map',\r\n                param: 'video audio object'\r\n            }, function (parents, item) {\r\n                if (elements[item]) {\r\n                    elements[item].parentsRequired = split(parents);\r\n                }\r\n            });\r\n            if (settings.invalid_elements) {\r\n                each$4(explode$1(settings.invalid_elements), function (item) {\r\n                    if (elements[item]) {\r\n                        delete elements[item];\r\n                    }\r\n                });\r\n            }\r\n            if (!getElementRule('span')) {\r\n                addValidElements('span[!data-mce-type|*]');\r\n            }\r\n            var getValidStyles = function () {\r\n                return validStyles;\r\n            };\r\n            var getInvalidStyles = function () {\r\n                return invalidStyles;\r\n            };\r\n            var getValidClasses = function () {\r\n                return validClasses;\r\n            };\r\n            var getBoolAttrs = function () {\r\n                return boolAttrMap;\r\n            };\r\n            var getBlockElements = function () {\r\n                return blockElementsMap;\r\n            };\r\n            var getTextBlockElements = function () {\r\n                return textBlockElementsMap;\r\n            };\r\n            var getTextInlineElements = function () {\r\n                return textInlineElementsMap;\r\n            };\r\n            var getShortEndedElements = function () {\r\n                return shortEndedElementsMap;\r\n            };\r\n            var getSelfClosingElements = function () {\r\n                return selfClosingElementsMap;\r\n            };\r\n            var getNonEmptyElements = function () {\r\n                return nonEmptyElementsMap;\r\n            };\r\n            var getMoveCaretBeforeOnEnterElements = function () {\r\n                return moveCaretBeforeOnEnterElementsMap;\r\n            };\r\n            var getWhiteSpaceElements = function () {\r\n                return whiteSpaceElementsMap;\r\n            };\r\n            var getSpecialElements = function () {\r\n                return specialElements;\r\n            };\r\n            var isValidChild = function (name, child) {\r\n                var parent = children[name.toLowerCase()];\r\n                return !!(parent && parent[child.toLowerCase()]);\r\n            };\r\n            var isValid = function (name, attr) {\r\n                var attrPatterns, i;\r\n                var rule = getElementRule(name);\r\n                if (rule) {\r\n                    if (attr) {\r\n                        if (rule.attributes[attr]) {\r\n                            return true;\r\n                        }\r\n                        attrPatterns = rule.attributePatterns;\r\n                        if (attrPatterns) {\r\n                            i = attrPatterns.length;\r\n                            while (i--) {\r\n                                if (attrPatterns[i].pattern.test(name)) {\r\n                                    return true;\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                    else {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n            var getCustomElements = function () {\r\n                return customElementsMap;\r\n            };\r\n            return {\r\n                children: children,\r\n                elements: elements,\r\n                getValidStyles: getValidStyles,\r\n                getValidClasses: getValidClasses,\r\n                getBlockElements: getBlockElements,\r\n                getInvalidStyles: getInvalidStyles,\r\n                getShortEndedElements: getShortEndedElements,\r\n                getTextBlockElements: getTextBlockElements,\r\n                getTextInlineElements: getTextInlineElements,\r\n                getBoolAttrs: getBoolAttrs,\r\n                getElementRule: getElementRule,\r\n                getSelfClosingElements: getSelfClosingElements,\r\n                getNonEmptyElements: getNonEmptyElements,\r\n                getMoveCaretBeforeOnEnterElements: getMoveCaretBeforeOnEnterElements,\r\n                getWhiteSpaceElements: getWhiteSpaceElements,\r\n                getSpecialElements: getSpecialElements,\r\n                isValidChild: isValidChild,\r\n                isValid: isValid,\r\n                getCustomElements: getCustomElements,\r\n                addValidElements: addValidElements,\r\n                setValidElements: setValidElements,\r\n                addCustomElements: addCustomElements,\r\n                addValidChildren: addValidChildren\r\n            };\r\n        }\r\n        var toHex = function (match, r, g, b) {\r\n            var hex = function (val) {\r\n                val = parseInt(val, 10).toString(16);\r\n                return val.length > 1 ? val : '0' + val;\r\n            };\r\n            return '#' + hex(r) + hex(g) + hex(b);\r\n        };\r\n        var Styles = function (settings, schema) {\r\n            var rgbRegExp = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*\\)/gi;\r\n            var urlOrStrRegExp = /(?:url(?:(?:\\(\\s*\\\"([^\\\"]+)\\\"\\s*\\))|(?:\\(\\s*\\'([^\\']+)\\'\\s*\\))|(?:\\(\\s*([^)\\s]+)\\s*\\))))|(?:\\'([^\\']+)\\')|(?:\\\"([^\\\"]+)\\\")/gi;\r\n            var styleRegExp = /\\s*([^:]+):\\s*([^;]+);?/g;\r\n            var trimRightRegExp = /\\s+$/;\r\n            var i;\r\n            var encodingLookup = {};\r\n            var encodingItems;\r\n            var validStyles;\r\n            var invalidStyles;\r\n            var invisibleChar = '\\uFEFF';\r\n            settings = settings || {};\r\n            if (schema) {\r\n                validStyles = schema.getValidStyles();\r\n                invalidStyles = schema.getInvalidStyles();\r\n            }\r\n            encodingItems = ('\\\\\" \\\\\\' \\\\; \\\\: ; : ' + invisibleChar).split(' ');\r\n            for (i = 0; i < encodingItems.length; i++) {\r\n                encodingLookup[encodingItems[i]] = invisibleChar + i;\r\n                encodingLookup[invisibleChar + i] = encodingItems[i];\r\n            }\r\n            return {\r\n                toHex: function (color) {\r\n                    return color.replace(rgbRegExp, toHex);\r\n                },\r\n                parse: function (css) {\r\n                    var styles = {};\r\n                    var matches, name, value, isEncoded;\r\n                    var urlConverter = settings.url_converter;\r\n                    var urlConverterScope = settings.url_converter_scope || this;\r\n                    var compress = function (prefix, suffix, noJoin) {\r\n                        var top, right, bottom, left;\r\n                        top = styles[prefix + '-top' + suffix];\r\n                        if (!top) {\r\n                            return;\r\n                        }\r\n                        right = styles[prefix + '-right' + suffix];\r\n                        if (!right) {\r\n                            return;\r\n                        }\r\n                        bottom = styles[prefix + '-bottom' + suffix];\r\n                        if (!bottom) {\r\n                            return;\r\n                        }\r\n                        left = styles[prefix + '-left' + suffix];\r\n                        if (!left) {\r\n                            return;\r\n                        }\r\n                        var box = [\r\n                            top,\r\n                            right,\r\n                            bottom,\r\n                            left\r\n                        ];\r\n                        i = box.length - 1;\r\n                        while (i--) {\r\n                            if (box[i] !== box[i + 1]) {\r\n                                break;\r\n                            }\r\n                        }\r\n                        if (i > -1 && noJoin) {\r\n                            return;\r\n                        }\r\n                        styles[prefix + suffix] = i === -1 ? box[0] : box.join(' ');\r\n                        delete styles[prefix + '-top' + suffix];\r\n                        delete styles[prefix + '-right' + suffix];\r\n                        delete styles[prefix + '-bottom' + suffix];\r\n                        delete styles[prefix + '-left' + suffix];\r\n                    };\r\n                    var canCompress = function (key) {\r\n                        var value = styles[key], i;\r\n                        if (!value) {\r\n                            return;\r\n                        }\r\n                        value = value.split(' ');\r\n                        i = value.length;\r\n                        while (i--) {\r\n                            if (value[i] !== value[0]) {\r\n                                return false;\r\n                            }\r\n                        }\r\n                        styles[key] = value[0];\r\n                        return true;\r\n                    };\r\n                    var compress2 = function (target, a, b, c) {\r\n                        if (!canCompress(a)) {\r\n                            return;\r\n                        }\r\n                        if (!canCompress(b)) {\r\n                            return;\r\n                        }\r\n                        if (!canCompress(c)) {\r\n                            return;\r\n                        }\r\n                        styles[target] = styles[a] + ' ' + styles[b] + ' ' + styles[c];\r\n                        delete styles[a];\r\n                        delete styles[b];\r\n                        delete styles[c];\r\n                    };\r\n                    var encode = function (str) {\r\n                        isEncoded = true;\r\n                        return encodingLookup[str];\r\n                    };\r\n                    var decode = function (str, keepSlashes) {\r\n                        if (isEncoded) {\r\n                            str = str.replace(/\\uFEFF[0-9]/g, function (str) {\r\n                                return encodingLookup[str];\r\n                            });\r\n                        }\r\n                        if (!keepSlashes) {\r\n                            str = str.replace(/\\\\([\\'\\\";:])/g, '$1');\r\n                        }\r\n                        return str;\r\n                    };\r\n                    var decodeSingleHexSequence = function (escSeq) {\r\n                        return String.fromCharCode(parseInt(escSeq.slice(1), 16));\r\n                    };\r\n                    var decodeHexSequences = function (value) {\r\n                        return value.replace(/\\\\[0-9a-f]+/gi, decodeSingleHexSequence);\r\n                    };\r\n                    var processUrl = function (match, url, url2, url3, str, str2) {\r\n                        str = str || str2;\r\n                        if (str) {\r\n                            str = decode(str);\r\n                            return '\\'' + str.replace(/\\'/g, '\\\\\\'') + '\\'';\r\n                        }\r\n                        url = decode(url || url2 || url3);\r\n                        if (!settings.allow_script_urls) {\r\n                            var scriptUrl = url.replace(/[\\s\\r\\n]+/g, '');\r\n                            if (/(java|vb)script:/i.test(scriptUrl)) {\r\n                                return '';\r\n                            }\r\n                            if (!settings.allow_svg_data_urls && /^data:image\\/svg/i.test(scriptUrl)) {\r\n                                return '';\r\n                            }\r\n                        }\r\n                        if (urlConverter) {\r\n                            url = urlConverter.call(urlConverterScope, url, 'style');\r\n                        }\r\n                        return 'url(\\'' + url.replace(/\\'/g, '\\\\\\'') + '\\')';\r\n                    };\r\n                    if (css) {\r\n                        css = css.replace(/[\\u0000-\\u001F]/g, '');\r\n                        css = css.replace(/\\\\[\\\"\\';:\\uFEFF]/g, encode).replace(/\\\"[^\\\"]+\\\"|\\'[^\\']+\\'/g, function (str) {\r\n                            return str.replace(/[;:]/g, encode);\r\n                        });\r\n                        while (matches = styleRegExp.exec(css)) {\r\n                            styleRegExp.lastIndex = matches.index + matches[0].length;\r\n                            name = matches[1].replace(trimRightRegExp, '').toLowerCase();\r\n                            value = matches[2].replace(trimRightRegExp, '');\r\n                            if (name && value) {\r\n                                name = decodeHexSequences(name);\r\n                                value = decodeHexSequences(value);\r\n                                if (name.indexOf(invisibleChar) !== -1 || name.indexOf('\"') !== -1) {\r\n                                    continue;\r\n                                }\r\n                                if (!settings.allow_script_urls && (name === 'behavior' || /expression\\s*\\(|\\/\\*|\\*\\//.test(value))) {\r\n                                    continue;\r\n                                }\r\n                                if (name === 'font-weight' && value === '700') {\r\n                                    value = 'bold';\r\n                                }\r\n                                else if (name === 'color' || name === 'background-color') {\r\n                                    value = value.toLowerCase();\r\n                                }\r\n                                value = value.replace(rgbRegExp, toHex);\r\n                                value = value.replace(urlOrStrRegExp, processUrl);\r\n                                styles[name] = isEncoded ? decode(value, true) : value;\r\n                            }\r\n                        }\r\n                        compress('border', '', true);\r\n                        compress('border', '-width');\r\n                        compress('border', '-color');\r\n                        compress('border', '-style');\r\n                        compress('padding', '');\r\n                        compress('margin', '');\r\n                        compress2('border', 'border-width', 'border-style', 'border-color');\r\n                        if (styles.border === 'medium none') {\r\n                            delete styles.border;\r\n                        }\r\n                        if (styles['border-image'] === 'none') {\r\n                            delete styles['border-image'];\r\n                        }\r\n                    }\r\n                    return styles;\r\n                },\r\n                serialize: function (styles, elementName) {\r\n                    var css = '', name, value;\r\n                    var serializeStyles = function (name) {\r\n                        var styleList, i, l, value;\r\n                        styleList = validStyles[name];\r\n                        if (styleList) {\r\n                            for (i = 0, l = styleList.length; i < l; i++) {\r\n                                name = styleList[i];\r\n                                value = styles[name];\r\n                                if (value) {\r\n                                    css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\r\n                                }\r\n                            }\r\n                        }\r\n                    };\r\n                    var isValid = function (name, elementName) {\r\n                        var styleMap;\r\n                        styleMap = invalidStyles['*'];\r\n                        if (styleMap && styleMap[name]) {\r\n                            return false;\r\n                        }\r\n                        styleMap = invalidStyles[elementName];\r\n                        if (styleMap && styleMap[name]) {\r\n                            return false;\r\n                        }\r\n                        return true;\r\n                    };\r\n                    if (elementName && validStyles) {\r\n                        serializeStyles('*');\r\n                        serializeStyles(elementName);\r\n                    }\r\n                    else {\r\n                        for (name in styles) {\r\n                            value = styles[name];\r\n                            if (value && (!invalidStyles || isValid(name, elementName))) {\r\n                                css += (css.length > 0 ? ' ' : '') + name + ': ' + value + ';';\r\n                            }\r\n                        }\r\n                    }\r\n                    return css;\r\n                }\r\n            };\r\n        };\r\n        var each$5 = Tools.each;\r\n        var grep$1 = Tools.grep;\r\n        var isIE = Env.ie;\r\n        var simpleSelectorRe = /^([a-z0-9],?)+$/i;\r\n        var whiteSpaceRegExp$2 = /^[ \\t\\r\\n]*$/;\r\n        var setupAttrHooks = function (styles, settings, getContext) {\r\n            var keepValues = settings.keep_values;\r\n            var keepUrlHook = {\r\n                set: function ($elm, value, name) {\r\n                    if (settings.url_converter) {\r\n                        value = settings.url_converter.call(settings.url_converter_scope || getContext(), value, name, $elm[0]);\r\n                    }\r\n                    $elm.attr('data-mce-' + name, value).attr(name, value);\r\n                },\r\n                get: function ($elm, name) {\r\n                    return $elm.attr('data-mce-' + name) || $elm.attr(name);\r\n                }\r\n            };\r\n            var attrHooks = {\r\n                style: {\r\n                    set: function ($elm, value) {\r\n                        if (value !== null && typeof value === 'object') {\r\n                            $elm.css(value);\r\n                            return;\r\n                        }\r\n                        if (keepValues) {\r\n                            $elm.attr('data-mce-style', value);\r\n                        }\r\n                        $elm.attr('style', value);\r\n                    },\r\n                    get: function ($elm) {\r\n                        var value = $elm.attr('data-mce-style') || $elm.attr('style');\r\n                        value = styles.serialize(styles.parse(value), $elm[0].nodeName);\r\n                        return value;\r\n                    }\r\n                }\r\n            };\r\n            if (keepValues) {\r\n                attrHooks.href = attrHooks.src = keepUrlHook;\r\n            }\r\n            return attrHooks;\r\n        };\r\n        var updateInternalStyleAttr = function (styles, $elm) {\r\n            var rawValue = $elm.attr('style');\r\n            var value = styles.serialize(styles.parse(rawValue), $elm[0].nodeName);\r\n            if (!value) {\r\n                value = null;\r\n            }\r\n            $elm.attr('data-mce-style', value);\r\n        };\r\n        var findNodeIndex = function (node, normalized) {\r\n            var idx = 0, lastNodeType, nodeType;\r\n            if (node) {\r\n                for (lastNodeType = node.nodeType, node = node.previousSibling; node; node = node.previousSibling) {\r\n                    nodeType = node.nodeType;\r\n                    if (normalized && nodeType === 3) {\r\n                        if (nodeType === lastNodeType || !node.nodeValue.length) {\r\n                            continue;\r\n                        }\r\n                    }\r\n                    idx++;\r\n                    lastNodeType = nodeType;\r\n                }\r\n            }\r\n            return idx;\r\n        };\r\n        function DOMUtils(doc, settings) {\r\n            var _this = this;\r\n            if (settings === void 0) {\r\n                settings = {};\r\n            }\r\n            var attrHooks;\r\n            var addedStyles = {};\r\n            var win = domGlobals.window;\r\n            var files = {};\r\n            var counter = 0;\r\n            var stdMode = true;\r\n            var boxModel = true;\r\n            var styleSheetLoader = StyleSheetLoader(doc, { contentCssCors: settings.contentCssCors });\r\n            var boundEvents = [];\r\n            var schema = settings.schema ? settings.schema : Schema({});\r\n            var styles = Styles({\r\n                url_converter: settings.url_converter,\r\n                url_converter_scope: settings.url_converter_scope\r\n            }, settings.schema);\r\n            var events = settings.ownEvents ? new EventUtils() : EventUtils.Event;\r\n            var blockElementsMap = schema.getBlockElements();\r\n            var $ = DomQuery.overrideDefaults(function () {\r\n                return {\r\n                    context: doc,\r\n                    element: self.getRoot()\r\n                };\r\n            });\r\n            var isBlock = function (node) {\r\n                if (typeof node === 'string') {\r\n                    return !!blockElementsMap[node];\r\n                }\r\n                else if (node) {\r\n                    var type = node.nodeType;\r\n                    if (type) {\r\n                        return !!(type === 1 && blockElementsMap[node.nodeName]);\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n            var get = function (elm) {\r\n                if (elm && doc && typeof elm === 'string') {\r\n                    var node = doc.getElementById(elm);\r\n                    if (node && node.id !== elm) {\r\n                        return doc.getElementsByName(elm)[1];\r\n                    }\r\n                    else {\r\n                        return node;\r\n                    }\r\n                }\r\n                return elm;\r\n            };\r\n            var $$ = function (elm) {\r\n                if (typeof elm === 'string') {\r\n                    elm = get(elm);\r\n                }\r\n                return $(elm);\r\n            };\r\n            var getAttrib = function (elm, name, defaultVal) {\r\n                var hook, value;\r\n                var $elm = $$(elm);\r\n                if ($elm.length) {\r\n                    hook = attrHooks[name];\r\n                    if (hook && hook.get) {\r\n                        value = hook.get($elm, name);\r\n                    }\r\n                    else {\r\n                        value = $elm.attr(name);\r\n                    }\r\n                }\r\n                if (typeof value === 'undefined') {\r\n                    value = defaultVal || '';\r\n                }\r\n                return value;\r\n            };\r\n            var getAttribs = function (elm) {\r\n                var node = get(elm);\r\n                if (!node) {\r\n                    return [];\r\n                }\r\n                return node.attributes;\r\n            };\r\n            var setAttrib = function (elm, name, value) {\r\n                var originalValue, hook;\r\n                if (value === '') {\r\n                    value = null;\r\n                }\r\n                var $elm = $$(elm);\r\n                originalValue = $elm.attr(name);\r\n                if (!$elm.length) {\r\n                    return;\r\n                }\r\n                hook = attrHooks[name];\r\n                if (hook && hook.set) {\r\n                    hook.set($elm, value, name);\r\n                }\r\n                else {\r\n                    $elm.attr(name, value);\r\n                }\r\n                if (originalValue !== value && settings.onSetAttrib) {\r\n                    settings.onSetAttrib({\r\n                        attrElm: $elm,\r\n                        attrName: name,\r\n                        attrValue: value\r\n                    });\r\n                }\r\n            };\r\n            var clone = function (node, deep) {\r\n                if (!isIE || node.nodeType !== 1 || deep) {\r\n                    return node.cloneNode(deep);\r\n                }\r\n                if (!deep) {\r\n                    var clone_1 = doc.createElement(node.nodeName);\r\n                    each$5(getAttribs(node), function (attr) {\r\n                        setAttrib(clone_1, attr.nodeName, getAttrib(node, attr.nodeName));\r\n                    });\r\n                    return clone_1;\r\n                }\r\n                return null;\r\n            };\r\n            var getRoot = function () {\r\n                return settings.root_element || doc.body;\r\n            };\r\n            var getViewPort = function (argWin) {\r\n                var actWin = !argWin ? win : argWin;\r\n                var doc = actWin.document;\r\n                var rootElm = doc.documentElement;\r\n                return {\r\n                    x: actWin.pageXOffset || rootElm.scrollLeft,\r\n                    y: actWin.pageYOffset || rootElm.scrollTop,\r\n                    w: actWin.innerWidth || rootElm.clientWidth,\r\n                    h: actWin.innerHeight || rootElm.clientHeight\r\n                };\r\n            };\r\n            var getPos = function (elm, rootElm) {\r\n                return Position.getPos(doc.body, get(elm), rootElm);\r\n            };\r\n            var setStyle = function (elm, name, value) {\r\n                var $elm = isString(name) ? $$(elm).css(name, value) : $$(elm).css(name);\r\n                if (settings.update_styles) {\r\n                    updateInternalStyleAttr(styles, $elm);\r\n                }\r\n            };\r\n            var setStyles = function (elm, stylesArg) {\r\n                var $elm = $$(elm).css(stylesArg);\r\n                if (settings.update_styles) {\r\n                    updateInternalStyleAttr(styles, $elm);\r\n                }\r\n            };\r\n            var getStyle = function (elm, name, computed) {\r\n                var $elm = $$(elm);\r\n                if (computed) {\r\n                    return $elm.css(name);\r\n                }\r\n                name = name.replace(/-(\\D)/g, function (a, b) {\r\n                    return b.toUpperCase();\r\n                });\r\n                if (name === 'float') {\r\n                    name = Env.ie && Env.ie < 12 ? 'styleFloat' : 'cssFloat';\r\n                }\r\n                return $elm[0] && $elm[0].style ? $elm[0].style[name] : undefined;\r\n            };\r\n            var getSize = function (elm) {\r\n                var w, h;\r\n                elm = get(elm);\r\n                w = getStyle(elm, 'width');\r\n                h = getStyle(elm, 'height');\r\n                if (w.indexOf('px') === -1) {\r\n                    w = 0;\r\n                }\r\n                if (h.indexOf('px') === -1) {\r\n                    h = 0;\r\n                }\r\n                return {\r\n                    w: parseInt(w, 10) || elm.offsetWidth || elm.clientWidth,\r\n                    h: parseInt(h, 10) || elm.offsetHeight || elm.clientHeight\r\n                };\r\n            };\r\n            var getRect = function (elm) {\r\n                var pos, size;\r\n                elm = get(elm);\r\n                pos = getPos(elm);\r\n                size = getSize(elm);\r\n                return {\r\n                    x: pos.x,\r\n                    y: pos.y,\r\n                    w: size.w,\r\n                    h: size.h\r\n                };\r\n            };\r\n            var is = function (elm, selector) {\r\n                var i;\r\n                if (!elm) {\r\n                    return false;\r\n                }\r\n                if (!Array.isArray(elm)) {\r\n                    if (selector === '*') {\r\n                        return elm.nodeType === 1;\r\n                    }\r\n                    if (simpleSelectorRe.test(selector)) {\r\n                        var selectors = selector.toLowerCase().split(/,/);\r\n                        var elmName = elm.nodeName.toLowerCase();\r\n                        for (i = selectors.length - 1; i >= 0; i--) {\r\n                            if (selectors[i] === elmName) {\r\n                                return true;\r\n                            }\r\n                        }\r\n                        return false;\r\n                    }\r\n                    if (elm.nodeType && elm.nodeType !== 1) {\r\n                        return false;\r\n                    }\r\n                }\r\n                var elms = !Array.isArray(elm) ? [elm] : elm;\r\n                return Sizzle(selector, elms[0].ownerDocument || elms[0], null, elms).length > 0;\r\n            };\r\n            var getParents = function (elm, selector, root, collect) {\r\n                var result = [];\r\n                var selectorVal;\r\n                var node = get(elm);\r\n                collect = collect === undefined;\r\n                root = root || (getRoot().nodeName !== 'BODY' ? getRoot().parentNode : null);\r\n                if (Tools.is(selector, 'string')) {\r\n                    selectorVal = selector;\r\n                    if (selector === '*') {\r\n                        selector = function (node) {\r\n                            return node.nodeType === 1;\r\n                        };\r\n                    }\r\n                    else {\r\n                        selector = function (node) {\r\n                            return is(node, selectorVal);\r\n                        };\r\n                    }\r\n                }\r\n                while (node) {\r\n                    if (node === root || !node.nodeType || node.nodeType === 9) {\r\n                        break;\r\n                    }\r\n                    if (!selector || typeof selector === 'function' && selector(node)) {\r\n                        if (collect) {\r\n                            result.push(node);\r\n                        }\r\n                        else {\r\n                            return [node];\r\n                        }\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n                return collect ? result : null;\r\n            };\r\n            var getParent = function (node, selector, root) {\r\n                var parents = getParents(node, selector, root, false);\r\n                return parents && parents.length > 0 ? parents[0] : null;\r\n            };\r\n            var _findSib = function (node, selector, name) {\r\n                var func = selector;\r\n                if (node) {\r\n                    if (typeof selector === 'string') {\r\n                        func = function (node) {\r\n                            return is(node, selector);\r\n                        };\r\n                    }\r\n                    for (node = node[name]; node; node = node[name]) {\r\n                        if (typeof func === 'function' && func(node)) {\r\n                            return node;\r\n                        }\r\n                    }\r\n                }\r\n                return null;\r\n            };\r\n            var getNext = function (node, selector) {\r\n                return _findSib(node, selector, 'nextSibling');\r\n            };\r\n            var getPrev = function (node, selector) {\r\n                return _findSib(node, selector, 'previousSibling');\r\n            };\r\n            var select = function (selector, scope) {\r\n                return Sizzle(selector, get(scope) || settings.root_element || doc, []);\r\n            };\r\n            var run = function (elm, func, scope) {\r\n                var result;\r\n                var node = typeof elm === 'string' ? get(elm) : elm;\r\n                if (!node) {\r\n                    return false;\r\n                }\r\n                if (Tools.isArray(node) && (node.length || node.length === 0)) {\r\n                    result = [];\r\n                    each$5(node, function (elm, i) {\r\n                        if (elm) {\r\n                            if (typeof elm === 'string') {\r\n                                elm = get(elm);\r\n                            }\r\n                            result.push(func.call(scope, elm, i));\r\n                        }\r\n                    });\r\n                    return result;\r\n                }\r\n                var context = scope ? scope : _this;\r\n                return func.call(context, node);\r\n            };\r\n            var setAttribs = function (elm, attrs) {\r\n                $$(elm).each(function (i, node) {\r\n                    each$5(attrs, function (value, name) {\r\n                        setAttrib(node, name, value);\r\n                    });\r\n                });\r\n            };\r\n            var setHTML = function (elm, html) {\r\n                var $elm = $$(elm);\r\n                if (isIE) {\r\n                    $elm.each(function (i, target) {\r\n                        if (target.canHaveHTML === false) {\r\n                            return;\r\n                        }\r\n                        while (target.firstChild) {\r\n                            target.removeChild(target.firstChild);\r\n                        }\r\n                        try {\r\n                            target.innerHTML = '<br>' + html;\r\n                            target.removeChild(target.firstChild);\r\n                        }\r\n                        catch (ex) {\r\n                            DomQuery('<div></div>').html('<br>' + html).contents().slice(1).appendTo(target);\r\n                        }\r\n                        return html;\r\n                    });\r\n                }\r\n                else {\r\n                    $elm.html(html);\r\n                }\r\n            };\r\n            var add = function (parentElm, name, attrs, html, create) {\r\n                return run(parentElm, function (parentElm) {\r\n                    var newElm = typeof name === 'string' ? doc.createElement(name) : name;\r\n                    setAttribs(newElm, attrs);\r\n                    if (html) {\r\n                        if (typeof html !== 'string' && html.nodeType) {\r\n                            newElm.appendChild(html);\r\n                        }\r\n                        else if (typeof html === 'string') {\r\n                            setHTML(newElm, html);\r\n                        }\r\n                    }\r\n                    return !create ? parentElm.appendChild(newElm) : newElm;\r\n                });\r\n            };\r\n            var create = function (name, attrs, html) {\r\n                return add(doc.createElement(name), name, attrs, html, true);\r\n            };\r\n            var decode = Entities.decode;\r\n            var encode = Entities.encodeAllRaw;\r\n            var createHTML = function (name, attrs, html) {\r\n                var outHtml = '', key;\r\n                outHtml += '<' + name;\r\n                for (key in attrs) {\r\n                    if (attrs.hasOwnProperty(key) && attrs[key] !== null && typeof attrs[key] !== 'undefined') {\r\n                        outHtml += ' ' + key + '=\"' + encode(attrs[key]) + '\"';\r\n                    }\r\n                }\r\n                if (typeof html !== 'undefined') {\r\n                    return outHtml + '>' + html + '</' + name + '>';\r\n                }\r\n                return outHtml + ' />';\r\n            };\r\n            var createFragment = function (html) {\r\n                var node;\r\n                var container = doc.createElement('div');\r\n                var frag = doc.createDocumentFragment();\r\n                if (html) {\r\n                    container.innerHTML = html;\r\n                }\r\n                while (node = container.firstChild) {\r\n                    frag.appendChild(node);\r\n                }\r\n                return frag;\r\n            };\r\n            var remove = function (node, keepChildren) {\r\n                var $node = $$(node);\r\n                if (keepChildren) {\r\n                    $node.each(function () {\r\n                        var child;\r\n                        while (child = this.firstChild) {\r\n                            if (child.nodeType === 3 && child.data.length === 0) {\r\n                                this.removeChild(child);\r\n                            }\r\n                            else {\r\n                                this.parentNode.insertBefore(child, this);\r\n                            }\r\n                        }\r\n                    }).remove();\r\n                }\r\n                else {\r\n                    $node.remove();\r\n                }\r\n                return $node.length > 1 ? $node.toArray() : $node[0];\r\n            };\r\n            var removeAllAttribs = function (e) {\r\n                return run(e, function (e) {\r\n                    var i;\r\n                    var attrs = e.attributes;\r\n                    for (i = attrs.length - 1; i >= 0; i--) {\r\n                        e.removeAttributeNode(attrs.item(i));\r\n                    }\r\n                });\r\n            };\r\n            var parseStyle = function (cssText) {\r\n                return styles.parse(cssText);\r\n            };\r\n            var serializeStyle = function (stylesArg, name) {\r\n                return styles.serialize(stylesArg, name);\r\n            };\r\n            var addStyle = function (cssText) {\r\n                var head, styleElm;\r\n                if (self !== DOMUtils.DOM && doc === domGlobals.document) {\r\n                    if (addedStyles[cssText]) {\r\n                        return;\r\n                    }\r\n                    addedStyles[cssText] = true;\r\n                }\r\n                styleElm = doc.getElementById('mceDefaultStyles');\r\n                if (!styleElm) {\r\n                    styleElm = doc.createElement('style');\r\n                    styleElm.id = 'mceDefaultStyles';\r\n                    styleElm.type = 'text/css';\r\n                    head = doc.getElementsByTagName('head')[0];\r\n                    if (head.firstChild) {\r\n                        head.insertBefore(styleElm, head.firstChild);\r\n                    }\r\n                    else {\r\n                        head.appendChild(styleElm);\r\n                    }\r\n                }\r\n                if (styleElm.styleSheet) {\r\n                    styleElm.styleSheet.cssText += cssText;\r\n                }\r\n                else {\r\n                    styleElm.appendChild(doc.createTextNode(cssText));\r\n                }\r\n            };\r\n            var loadCSS = function (url) {\r\n                var head;\r\n                if (self !== DOMUtils.DOM && doc === domGlobals.document) {\r\n                    DOMUtils.DOM.loadCSS(url);\r\n                    return;\r\n                }\r\n                if (!url) {\r\n                    url = '';\r\n                }\r\n                head = doc.getElementsByTagName('head')[0];\r\n                each$5(url.split(','), function (url) {\r\n                    var link;\r\n                    url = Tools._addCacheSuffix(url);\r\n                    if (files[url]) {\r\n                        return;\r\n                    }\r\n                    files[url] = true;\r\n                    link = create('link', {\r\n                        rel: 'stylesheet',\r\n                        href: url\r\n                    });\r\n                    head.appendChild(link);\r\n                });\r\n            };\r\n            var toggleClass = function (elm, cls, state) {\r\n                $$(elm).toggleClass(cls, state).each(function () {\r\n                    if (this.className === '') {\r\n                        DomQuery(this).attr('class', null);\r\n                    }\r\n                });\r\n            };\r\n            var addClass = function (elm, cls) {\r\n                $$(elm).addClass(cls);\r\n            };\r\n            var removeClass = function (elm, cls) {\r\n                toggleClass(elm, cls, false);\r\n            };\r\n            var hasClass = function (elm, cls) {\r\n                return $$(elm).hasClass(cls);\r\n            };\r\n            var show = function (elm) {\r\n                $$(elm).show();\r\n            };\r\n            var hide = function (elm) {\r\n                $$(elm).hide();\r\n            };\r\n            var isHidden = function (elm) {\r\n                return $$(elm).css('display') === 'none';\r\n            };\r\n            var uniqueId = function (prefix) {\r\n                return (!prefix ? 'mce_' : prefix) + counter++;\r\n            };\r\n            var getOuterHTML = function (elm) {\r\n                var node = typeof elm === 'string' ? get(elm) : elm;\r\n                return NodeType.isElement(node) ? node.outerHTML : DomQuery('<div></div>').append(DomQuery(node).clone()).html();\r\n            };\r\n            var setOuterHTML = function (elm, html) {\r\n                $$(elm).each(function () {\r\n                    try {\r\n                        if ('outerHTML' in this) {\r\n                            this.outerHTML = html;\r\n                            return;\r\n                        }\r\n                    }\r\n                    catch (ex) {\r\n                    }\r\n                    remove(DomQuery(this).html(html), true);\r\n                });\r\n            };\r\n            var insertAfter = function (node, reference) {\r\n                var referenceNode = get(reference);\r\n                return run(node, function (node) {\r\n                    var parent, nextSibling;\r\n                    parent = referenceNode.parentNode;\r\n                    nextSibling = referenceNode.nextSibling;\r\n                    if (nextSibling) {\r\n                        parent.insertBefore(node, nextSibling);\r\n                    }\r\n                    else {\r\n                        parent.appendChild(node);\r\n                    }\r\n                    return node;\r\n                });\r\n            };\r\n            var replace = function (newElm, oldElm, keepChildren) {\r\n                return run(oldElm, function (oldElm) {\r\n                    if (Tools.is(oldElm, 'array')) {\r\n                        newElm = newElm.cloneNode(true);\r\n                    }\r\n                    if (keepChildren) {\r\n                        each$5(grep$1(oldElm.childNodes), function (node) {\r\n                            newElm.appendChild(node);\r\n                        });\r\n                    }\r\n                    return oldElm.parentNode.replaceChild(newElm, oldElm);\r\n                });\r\n            };\r\n            var rename = function (elm, name) {\r\n                var newElm;\r\n                if (elm.nodeName !== name.toUpperCase()) {\r\n                    newElm = create(name);\r\n                    each$5(getAttribs(elm), function (attrNode) {\r\n                        setAttrib(newElm, attrNode.nodeName, getAttrib(elm, attrNode.nodeName));\r\n                    });\r\n                    replace(newElm, elm, true);\r\n                }\r\n                return newElm || elm;\r\n            };\r\n            var findCommonAncestor = function (a, b) {\r\n                var ps = a, pe;\r\n                while (ps) {\r\n                    pe = b;\r\n                    while (pe && ps !== pe) {\r\n                        pe = pe.parentNode;\r\n                    }\r\n                    if (ps === pe) {\r\n                        break;\r\n                    }\r\n                    ps = ps.parentNode;\r\n                }\r\n                if (!ps && a.ownerDocument) {\r\n                    return a.ownerDocument.documentElement;\r\n                }\r\n                return ps;\r\n            };\r\n            var toHex = function (rgbVal) {\r\n                return styles.toHex(Tools.trim(rgbVal));\r\n            };\r\n            var isEmpty = function (node, elements) {\r\n                var i, attributes, type, name, brCount = 0;\r\n                node = node.firstChild;\r\n                if (node) {\r\n                    var walker = new TreeWalker(node, node.parentNode);\r\n                    var whitespace = schema ? schema.getWhiteSpaceElements() : {};\r\n                    elements = elements || (schema ? schema.getNonEmptyElements() : null);\r\n                    do {\r\n                        type = node.nodeType;\r\n                        if (NodeType.isElement(node)) {\r\n                            var bogusVal = node.getAttribute('data-mce-bogus');\r\n                            if (bogusVal) {\r\n                                node = walker.next(bogusVal === 'all');\r\n                                continue;\r\n                            }\r\n                            name = node.nodeName.toLowerCase();\r\n                            if (elements && elements[name]) {\r\n                                if (name === 'br') {\r\n                                    brCount++;\r\n                                    node = walker.next();\r\n                                    continue;\r\n                                }\r\n                                return false;\r\n                            }\r\n                            attributes = getAttribs(node);\r\n                            i = attributes.length;\r\n                            while (i--) {\r\n                                name = attributes[i].nodeName;\r\n                                if (name === 'name' || name === 'data-mce-bookmark') {\r\n                                    return false;\r\n                                }\r\n                            }\r\n                        }\r\n                        if (type === 8) {\r\n                            return false;\r\n                        }\r\n                        if (type === 3 && !whiteSpaceRegExp$2.test(node.nodeValue)) {\r\n                            return false;\r\n                        }\r\n                        if (type === 3 && node.parentNode && whitespace[node.parentNode.nodeName] && whiteSpaceRegExp$2.test(node.nodeValue)) {\r\n                            return false;\r\n                        }\r\n                        node = walker.next();\r\n                    } while (node);\r\n                }\r\n                return brCount <= 1;\r\n            };\r\n            var createRng = function () {\r\n                return doc.createRange();\r\n            };\r\n            var split = function (parentElm, splitElm, replacementElm) {\r\n                var r = createRng(), bef, aft, pa;\r\n                if (parentElm && splitElm) {\r\n                    r.setStart(parentElm.parentNode, findNodeIndex(parentElm));\r\n                    r.setEnd(splitElm.parentNode, findNodeIndex(splitElm));\r\n                    bef = r.extractContents();\r\n                    r = createRng();\r\n                    r.setStart(splitElm.parentNode, findNodeIndex(splitElm) + 1);\r\n                    r.setEnd(parentElm.parentNode, findNodeIndex(parentElm) + 1);\r\n                    aft = r.extractContents();\r\n                    pa = parentElm.parentNode;\r\n                    pa.insertBefore(TrimNode.trimNode(self, bef), parentElm);\r\n                    if (replacementElm) {\r\n                        pa.insertBefore(replacementElm, parentElm);\r\n                    }\r\n                    else {\r\n                        pa.insertBefore(splitElm, parentElm);\r\n                    }\r\n                    pa.insertBefore(TrimNode.trimNode(self, aft), parentElm);\r\n                    remove(parentElm);\r\n                    return replacementElm || splitElm;\r\n                }\r\n            };\r\n            var bind = function (target, name, func, scope) {\r\n                if (Tools.isArray(target)) {\r\n                    var i = target.length;\r\n                    var rv = [];\r\n                    while (i--) {\r\n                        rv[i] = bind(target[i], name, func, scope);\r\n                    }\r\n                    return rv;\r\n                }\r\n                if (settings.collect && (target === doc || target === win)) {\r\n                    boundEvents.push([\r\n                        target,\r\n                        name,\r\n                        func,\r\n                        scope\r\n                    ]);\r\n                }\r\n                return events.bind(target, name, func, scope || self);\r\n            };\r\n            var unbind = function (target, name, func) {\r\n                var i;\r\n                if (Tools.isArray(target)) {\r\n                    i = target.length;\r\n                    var rv = [];\r\n                    while (i--) {\r\n                        rv[i] = unbind(target[i], name, func);\r\n                    }\r\n                    return rv;\r\n                }\r\n                if (boundEvents && (target === doc || target === win)) {\r\n                    i = boundEvents.length;\r\n                    while (i--) {\r\n                        var item = boundEvents[i];\r\n                        if (target === item[0] && (!name || name === item[1]) && (!func || func === item[2])) {\r\n                            events.unbind(item[0], item[1], item[2]);\r\n                        }\r\n                    }\r\n                }\r\n                return events.unbind(target, name, func);\r\n            };\r\n            var fire = function (target, name, evt) {\r\n                return events.fire(target, name, evt);\r\n            };\r\n            var getContentEditable = function (node) {\r\n                if (node && NodeType.isElement(node)) {\r\n                    var contentEditable = node.getAttribute('data-mce-contenteditable');\r\n                    if (contentEditable && contentEditable !== 'inherit') {\r\n                        return contentEditable;\r\n                    }\r\n                    return node.contentEditable !== 'inherit' ? node.contentEditable : null;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            };\r\n            var getContentEditableParent = function (node) {\r\n                var root = getRoot();\r\n                var state = null;\r\n                for (; node && node !== root; node = node.parentNode) {\r\n                    state = getContentEditable(node);\r\n                    if (state !== null) {\r\n                        break;\r\n                    }\r\n                }\r\n                return state;\r\n            };\r\n            var destroy = function () {\r\n                if (boundEvents) {\r\n                    var i = boundEvents.length;\r\n                    while (i--) {\r\n                        var item = boundEvents[i];\r\n                        events.unbind(item[0], item[1], item[2]);\r\n                    }\r\n                }\r\n                if (Sizzle.setDocument) {\r\n                    Sizzle.setDocument();\r\n                }\r\n            };\r\n            var isChildOf = function (node, parent) {\r\n                while (node) {\r\n                    if (parent === node) {\r\n                        return true;\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n                return false;\r\n            };\r\n            var dumpRng = function (r) {\r\n                return 'startContainer: ' + r.startContainer.nodeName + ', startOffset: ' + r.startOffset + ', endContainer: ' + r.endContainer.nodeName + ', endOffset: ' + r.endOffset;\r\n            };\r\n            var self = {\r\n                doc: doc,\r\n                settings: settings,\r\n                win: win,\r\n                files: files,\r\n                stdMode: stdMode,\r\n                boxModel: boxModel,\r\n                styleSheetLoader: styleSheetLoader,\r\n                boundEvents: boundEvents,\r\n                styles: styles,\r\n                schema: schema,\r\n                events: events,\r\n                isBlock: isBlock,\r\n                $: $,\r\n                $$: $$,\r\n                root: null,\r\n                clone: clone,\r\n                getRoot: getRoot,\r\n                getViewPort: getViewPort,\r\n                getRect: getRect,\r\n                getSize: getSize,\r\n                getParent: getParent,\r\n                getParents: getParents,\r\n                get: get,\r\n                getNext: getNext,\r\n                getPrev: getPrev,\r\n                select: select,\r\n                is: is,\r\n                add: add,\r\n                create: create,\r\n                createHTML: createHTML,\r\n                createFragment: createFragment,\r\n                remove: remove,\r\n                setStyle: setStyle,\r\n                getStyle: getStyle,\r\n                setStyles: setStyles,\r\n                removeAllAttribs: removeAllAttribs,\r\n                setAttrib: setAttrib,\r\n                setAttribs: setAttribs,\r\n                getAttrib: getAttrib,\r\n                getPos: getPos,\r\n                parseStyle: parseStyle,\r\n                serializeStyle: serializeStyle,\r\n                addStyle: addStyle,\r\n                loadCSS: loadCSS,\r\n                addClass: addClass,\r\n                removeClass: removeClass,\r\n                hasClass: hasClass,\r\n                toggleClass: toggleClass,\r\n                show: show,\r\n                hide: hide,\r\n                isHidden: isHidden,\r\n                uniqueId: uniqueId,\r\n                setHTML: setHTML,\r\n                getOuterHTML: getOuterHTML,\r\n                setOuterHTML: setOuterHTML,\r\n                decode: decode,\r\n                encode: encode,\r\n                insertAfter: insertAfter,\r\n                replace: replace,\r\n                rename: rename,\r\n                findCommonAncestor: findCommonAncestor,\r\n                toHex: toHex,\r\n                run: run,\r\n                getAttribs: getAttribs,\r\n                isEmpty: isEmpty,\r\n                createRng: createRng,\r\n                nodeIndex: findNodeIndex,\r\n                split: split,\r\n                bind: bind,\r\n                unbind: unbind,\r\n                fire: fire,\r\n                getContentEditable: getContentEditable,\r\n                getContentEditableParent: getContentEditableParent,\r\n                destroy: destroy,\r\n                isChildOf: isChildOf,\r\n                dumpRng: dumpRng\r\n            };\r\n            attrHooks = setupAttrHooks(styles, settings, function () {\r\n                return self;\r\n            });\r\n            return self;\r\n        }\r\n        (function (DOMUtils) {\r\n            DOMUtils.DOM = DOMUtils(domGlobals.document);\r\n            DOMUtils.nodeIndex = findNodeIndex;\r\n        }(DOMUtils || (DOMUtils = {})));\r\n        var DOMUtils$1 = DOMUtils;\r\n        var DOM = DOMUtils$1.DOM;\r\n        var each$6 = Tools.each, grep$2 = Tools.grep;\r\n        var QUEUED = 0;\r\n        var LOADING = 1;\r\n        var LOADED = 2;\r\n        var FAILED = 3;\r\n        var ScriptLoader = function () {\r\n            function ScriptLoader() {\r\n                this.states = {};\r\n                this.queue = [];\r\n                this.scriptLoadedCallbacks = {};\r\n                this.queueLoadedCallbacks = [];\r\n                this.loading = 0;\r\n            }\r\n            ScriptLoader.prototype.loadScript = function (url, success, failure) {\r\n                var dom = DOM;\r\n                var elm, id;\r\n                var done = function () {\r\n                    dom.remove(id);\r\n                    if (elm) {\r\n                        elm.onreadystatechange = elm.onload = elm = null;\r\n                    }\r\n                    success();\r\n                };\r\n                var error = function () {\r\n                    if (isFunction(failure)) {\r\n                        failure();\r\n                    }\r\n                    else {\r\n                        if (typeof domGlobals.console !== 'undefined' && domGlobals.console.log) {\r\n                            domGlobals.console.log('Failed to load script: ' + url);\r\n                        }\r\n                    }\r\n                };\r\n                id = dom.uniqueId();\r\n                elm = domGlobals.document.createElement('script');\r\n                elm.id = id;\r\n                elm.type = 'text/javascript';\r\n                elm.src = Tools._addCacheSuffix(url);\r\n                elm.onload = done;\r\n                elm.onerror = error;\r\n                (domGlobals.document.getElementsByTagName('head')[0] || domGlobals.document.body).appendChild(elm);\r\n            };\r\n            ScriptLoader.prototype.isDone = function (url) {\r\n                return this.states[url] === LOADED;\r\n            };\r\n            ScriptLoader.prototype.markDone = function (url) {\r\n                this.states[url] = LOADED;\r\n            };\r\n            ScriptLoader.prototype.add = function (url, success, scope, failure) {\r\n                var state = this.states[url];\r\n                if (state === undefined) {\r\n                    this.queue.push(url);\r\n                    this.states[url] = QUEUED;\r\n                }\r\n                if (success) {\r\n                    if (!this.scriptLoadedCallbacks[url]) {\r\n                        this.scriptLoadedCallbacks[url] = [];\r\n                    }\r\n                    this.scriptLoadedCallbacks[url].push({\r\n                        success: success,\r\n                        failure: failure,\r\n                        scope: scope || this\r\n                    });\r\n                }\r\n            };\r\n            ScriptLoader.prototype.load = function (url, success, scope, failure) {\r\n                return this.add(url, success, scope, failure);\r\n            };\r\n            ScriptLoader.prototype.remove = function (url) {\r\n                delete this.states[url];\r\n                delete this.scriptLoadedCallbacks[url];\r\n            };\r\n            ScriptLoader.prototype.loadQueue = function (success, scope, failure) {\r\n                this.loadScripts(this.queue, success, scope, failure);\r\n            };\r\n            ScriptLoader.prototype.loadScripts = function (scripts, success, scope, failure) {\r\n                var self = this;\r\n                var loadScripts;\r\n                var failures = [];\r\n                var execCallbacks = function (name, url) {\r\n                    each$6(self.scriptLoadedCallbacks[url], function (callback) {\r\n                        if (isFunction(callback[name])) {\r\n                            callback[name].call(callback.scope);\r\n                        }\r\n                    });\r\n                    self.scriptLoadedCallbacks[url] = undefined;\r\n                };\r\n                self.queueLoadedCallbacks.push({\r\n                    success: success,\r\n                    failure: failure,\r\n                    scope: scope || this\r\n                });\r\n                loadScripts = function () {\r\n                    var loadingScripts = grep$2(scripts);\r\n                    scripts.length = 0;\r\n                    each$6(loadingScripts, function (url) {\r\n                        if (self.states[url] === LOADED) {\r\n                            execCallbacks('success', url);\r\n                            return;\r\n                        }\r\n                        if (self.states[url] === FAILED) {\r\n                            execCallbacks('failure', url);\r\n                            return;\r\n                        }\r\n                        if (self.states[url] !== LOADING) {\r\n                            self.states[url] = LOADING;\r\n                            self.loading++;\r\n                            self.loadScript(url, function () {\r\n                                self.states[url] = LOADED;\r\n                                self.loading--;\r\n                                execCallbacks('success', url);\r\n                                loadScripts();\r\n                            }, function () {\r\n                                self.states[url] = FAILED;\r\n                                self.loading--;\r\n                                failures.push(url);\r\n                                execCallbacks('failure', url);\r\n                                loadScripts();\r\n                            });\r\n                        }\r\n                    });\r\n                    if (!self.loading) {\r\n                        var notifyCallbacks = self.queueLoadedCallbacks.slice(0);\r\n                        self.queueLoadedCallbacks.length = 0;\r\n                        each$6(notifyCallbacks, function (callback) {\r\n                            if (failures.length === 0) {\r\n                                if (isFunction(callback.success)) {\r\n                                    callback.success.call(callback.scope);\r\n                                }\r\n                            }\r\n                            else {\r\n                                if (isFunction(callback.failure)) {\r\n                                    callback.failure.call(callback.scope, failures);\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n                loadScripts();\r\n            };\r\n            ScriptLoader.ScriptLoader = new ScriptLoader();\r\n            return ScriptLoader;\r\n        }();\r\n        var extendStatics = function (d, b) {\r\n            extendStatics = Object.setPrototypeOf || { __proto__: [] } instanceof Array && function (d, b) {\r\n                d.__proto__ = b;\r\n            } || function (d, b) {\r\n                for (var p in b)\r\n                    if (b.hasOwnProperty(p))\r\n                        d[p] = b[p];\r\n            };\r\n            return extendStatics(d, b);\r\n        };\r\n        function __extends(d, b) {\r\n            extendStatics(d, b);\r\n            function __() {\r\n                this.constructor = d;\r\n            }\r\n            d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n        }\r\n        var __assign = function () {\r\n            __assign = Object.assign || function __assign(t) {\r\n                for (var s, i = 1, n = arguments.length; i < n; i++) {\r\n                    s = arguments[i];\r\n                    for (var p in s)\r\n                        if (Object.prototype.hasOwnProperty.call(s, p))\r\n                            t[p] = s[p];\r\n                }\r\n                return t;\r\n            };\r\n            return __assign.apply(this, arguments);\r\n        };\r\n        function __rest(s, e) {\r\n            var t = {};\r\n            for (var p in s)\r\n                if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)\r\n                    t[p] = s[p];\r\n            if (s != null && typeof Object.getOwnPropertySymbols === 'function')\r\n                for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++)\r\n                    if (e.indexOf(p[i]) < 0)\r\n                        t[p[i]] = s[p[i]];\r\n            return t;\r\n        }\r\n        function __decorate(decorators, target, key, desc) {\r\n            var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n            if (typeof Reflect === 'object' && typeof Reflect.decorate === 'function')\r\n                r = Reflect.decorate(decorators, target, key, desc);\r\n            else\r\n                for (var i = decorators.length - 1; i >= 0; i--)\r\n                    if (d = decorators[i])\r\n                        r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n            return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n        }\r\n        function __param(paramIndex, decorator) {\r\n            return function (target, key) {\r\n                decorator(target, key, paramIndex);\r\n            };\r\n        }\r\n        function __metadata(metadataKey, metadataValue) {\r\n            if (typeof Reflect === 'object' && typeof Reflect.metadata === 'function')\r\n                return Reflect.metadata(metadataKey, metadataValue);\r\n        }\r\n        function __awaiter(thisArg, _arguments, P, generator) {\r\n            return new (P || (P = Promise))(function (resolve, reject) {\r\n                function fulfilled(value) {\r\n                    try {\r\n                        step(generator.next(value));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\r\n                }\r\n                function rejected(value) {\r\n                    try {\r\n                        step(generator['throw'](value));\r\n                    }\r\n                    catch (e) {\r\n                        reject(e);\r\n                    }\r\n                }\r\n                function step(result) {\r\n                    result.done ? resolve(result.value) : new P(function (resolve) {\r\n                        resolve(result.value);\r\n                    }).then(fulfilled, rejected);\r\n                }\r\n                step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n            });\r\n        }\r\n        function __generator(thisArg, body) {\r\n            var _ = {\r\n                label: 0,\r\n                sent: function () {\r\n                    if (t[0] & 1)\r\n                        throw t[1];\r\n                    return t[1];\r\n                },\r\n                trys: [],\r\n                ops: []\r\n            }, f, y, t, g;\r\n            return g = {\r\n                next: verb(0),\r\n                'throw': verb(1),\r\n                'return': verb(2)\r\n            }, typeof Symbol === 'function' && (g[Symbol.iterator] = function () {\r\n                return this;\r\n            }), g;\r\n            function verb(n) {\r\n                return function (v) {\r\n                    return step([\r\n                        n,\r\n                        v\r\n                    ]);\r\n                };\r\n            }\r\n            function step(op) {\r\n                if (f)\r\n                    throw new TypeError('Generator is already executing.');\r\n                while (_)\r\n                    try {\r\n                        if (f = 1, y && (t = op[0] & 2 ? y['return'] : op[0] ? y['throw'] || ((t = y['return']) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done)\r\n                            return t;\r\n                        if (y = 0, t)\r\n                            op = [\r\n                                op[0] & 2,\r\n                                t.value\r\n                            ];\r\n                        switch (op[0]) {\r\n                            case 0:\r\n                            case 1:\r\n                                t = op;\r\n                                break;\r\n                            case 4:\r\n                                _.label++;\r\n                                return {\r\n                                    value: op[1],\r\n                                    done: false\r\n                                };\r\n                            case 5:\r\n                                _.label++;\r\n                                y = op[1];\r\n                                op = [0];\r\n                                continue;\r\n                            case 7:\r\n                                op = _.ops.pop();\r\n                                _.trys.pop();\r\n                                continue;\r\n                            default:\r\n                                if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\r\n                                    _ = 0;\r\n                                    continue;\r\n                                }\r\n                                if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\r\n                                    _.label = op[1];\r\n                                    break;\r\n                                }\r\n                                if (op[0] === 6 && _.label < t[1]) {\r\n                                    _.label = t[1];\r\n                                    t = op;\r\n                                    break;\r\n                                }\r\n                                if (t && _.label < t[2]) {\r\n                                    _.label = t[2];\r\n                                    _.ops.push(op);\r\n                                    break;\r\n                                }\r\n                                if (t[2])\r\n                                    _.ops.pop();\r\n                                _.trys.pop();\r\n                                continue;\r\n                        }\r\n                        op = body.call(thisArg, _);\r\n                    }\r\n                    catch (e) {\r\n                        op = [\r\n                            6,\r\n                            e\r\n                        ];\r\n                        y = 0;\r\n                    }\r\n                    finally {\r\n                        f = t = 0;\r\n                    }\r\n                if (op[0] & 5)\r\n                    throw op[1];\r\n                return {\r\n                    value: op[0] ? op[1] : void 0,\r\n                    done: true\r\n                };\r\n            }\r\n        }\r\n        function __exportStar(m, exports) {\r\n            for (var p in m)\r\n                if (!exports.hasOwnProperty(p))\r\n                    exports[p] = m[p];\r\n        }\r\n        function __values(o) {\r\n            var m = typeof Symbol === 'function' && o[Symbol.iterator], i = 0;\r\n            if (m)\r\n                return m.call(o);\r\n            return {\r\n                next: function () {\r\n                    if (o && i >= o.length)\r\n                        o = void 0;\r\n                    return {\r\n                        value: o && o[i++],\r\n                        done: !o\r\n                    };\r\n                }\r\n            };\r\n        }\r\n        function __read(o, n) {\r\n            var m = typeof Symbol === 'function' && o[Symbol.iterator];\r\n            if (!m)\r\n                return o;\r\n            var i = m.call(o), r, ar = [], e;\r\n            try {\r\n                while ((n === void 0 || n-- > 0) && !(r = i.next()).done)\r\n                    ar.push(r.value);\r\n            }\r\n            catch (error) {\r\n                e = { error: error };\r\n            }\r\n            finally {\r\n                try {\r\n                    if (r && !r.done && (m = i['return']))\r\n                        m.call(i);\r\n                }\r\n                finally {\r\n                    if (e)\r\n                        throw e.error;\r\n                }\r\n            }\r\n            return ar;\r\n        }\r\n        function __spread() {\r\n            for (var ar = [], i = 0; i < arguments.length; i++)\r\n                ar = ar.concat(__read(arguments[i]));\r\n            return ar;\r\n        }\r\n        function __await(v) {\r\n            return this instanceof __await ? (this.v = v, this) : new __await(v);\r\n        }\r\n        function __asyncGenerator(thisArg, _arguments, generator) {\r\n            if (!Symbol.asyncIterator)\r\n                throw new TypeError('Symbol.asyncIterator is not defined.');\r\n            var g = generator.apply(thisArg, _arguments || []), i, q = [];\r\n            return i = {}, verb('next'), verb('throw'), verb('return'), i[Symbol.asyncIterator] = function () {\r\n                return this;\r\n            }, i;\r\n            function verb(n) {\r\n                if (g[n])\r\n                    i[n] = function (v) {\r\n                        return new Promise(function (a, b) {\r\n                            q.push([\r\n                                n,\r\n                                v,\r\n                                a,\r\n                                b\r\n                            ]) > 1 || resume(n, v);\r\n                        });\r\n                    };\r\n            }\r\n            function resume(n, v) {\r\n                try {\r\n                    step(g[n](v));\r\n                }\r\n                catch (e) {\r\n                    settle(q[0][3], e);\r\n                }\r\n            }\r\n            function step(r) {\r\n                r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r);\r\n            }\r\n            function fulfill(value) {\r\n                resume('next', value);\r\n            }\r\n            function reject(value) {\r\n                resume('throw', value);\r\n            }\r\n            function settle(f, v) {\r\n                if (f(v), q.shift(), q.length)\r\n                    resume(q[0][0], q[0][1]);\r\n            }\r\n        }\r\n        function __asyncDelegator(o) {\r\n            var i, p;\r\n            return i = {}, verb('next'), verb('throw', function (e) {\r\n                throw e;\r\n            }), verb('return'), i[Symbol.iterator] = function () {\r\n                return this;\r\n            }, i;\r\n            function verb(n, f) {\r\n                i[n] = o[n] ? function (v) {\r\n                    return (p = !p) ? {\r\n                        value: __await(o[n](v)),\r\n                        done: n === 'return'\r\n                    } : f ? f(v) : v;\r\n                } : f;\r\n            }\r\n        }\r\n        function __asyncValues(o) {\r\n            if (!Symbol.asyncIterator)\r\n                throw new TypeError('Symbol.asyncIterator is not defined.');\r\n            var m = o[Symbol.asyncIterator], i;\r\n            return m ? m.call(o) : (o = typeof __values === 'function' ? __values(o) : o[Symbol.iterator](), i = {}, verb('next'), verb('throw'), verb('return'), i[Symbol.asyncIterator] = function () {\r\n                return this;\r\n            }, i);\r\n            function verb(n) {\r\n                i[n] = o[n] && function (v) {\r\n                    return new Promise(function (resolve, reject) {\r\n                        v = o[n](v), settle(resolve, reject, v.done, v.value);\r\n                    });\r\n                };\r\n            }\r\n            function settle(resolve, reject, d, v) {\r\n                Promise.resolve(v).then(function (v) {\r\n                    resolve({\r\n                        value: v,\r\n                        done: d\r\n                    });\r\n                }, reject);\r\n            }\r\n        }\r\n        function __makeTemplateObject(cooked, raw) {\r\n            if (Object.defineProperty) {\r\n                Object.defineProperty(cooked, 'raw', { value: raw });\r\n            }\r\n            else {\r\n                cooked.raw = raw;\r\n            }\r\n            return cooked;\r\n        }\r\n        function __importStar(mod) {\r\n            if (mod && mod.__esModule)\r\n                return mod;\r\n            var result = {};\r\n            if (mod != null)\r\n                for (var k in mod)\r\n                    if (Object.hasOwnProperty.call(mod, k))\r\n                        result[k] = mod[k];\r\n            result.default = mod;\r\n            return result;\r\n        }\r\n        function __importDefault(mod) {\r\n            return mod && mod.__esModule ? mod : { default: mod };\r\n        }\r\n        var tslib_1 = Object.freeze({\r\n            __extends: __extends,\r\n            get __assign() { return __assign; },\r\n            __rest: __rest,\r\n            __decorate: __decorate,\r\n            __param: __param,\r\n            __metadata: __metadata,\r\n            __awaiter: __awaiter,\r\n            __generator: __generator,\r\n            __exportStar: __exportStar,\r\n            __values: __values,\r\n            __read: __read,\r\n            __spread: __spread,\r\n            __await: __await,\r\n            __asyncGenerator: __asyncGenerator,\r\n            __asyncDelegator: __asyncDelegator,\r\n            __asyncValues: __asyncValues,\r\n            __makeTemplateObject: __makeTemplateObject,\r\n            __importStar: __importStar,\r\n            __importDefault: __importDefault\r\n        });\r\n        var Cell = function (initial) {\r\n            var value = initial;\r\n            var get = function () {\r\n                return value;\r\n            };\r\n            var set = function (v) {\r\n                value = v;\r\n            };\r\n            var clone = function () {\r\n                return Cell(get());\r\n            };\r\n            return {\r\n                get: get,\r\n                set: set,\r\n                clone: clone\r\n            };\r\n        };\r\n        var isRaw = function (str) {\r\n            return isObject(str) && has(str, 'raw');\r\n        };\r\n        var isTokenised = function (str) {\r\n            return isArray(str) && str.length > 1;\r\n        };\r\n        var data = {};\r\n        var currentCode = Cell('en');\r\n        var getData = function () {\r\n            return map$2(data, function (value) {\r\n                return __assign({}, value);\r\n            });\r\n        };\r\n        var setCode = function (newCode) {\r\n            if (newCode) {\r\n                currentCode.set(newCode);\r\n            }\r\n        };\r\n        var getCode = function () {\r\n            return currentCode.get();\r\n        };\r\n        var add = function (code, items) {\r\n            var langData = data[code];\r\n            if (!langData) {\r\n                data[code] = langData = {};\r\n            }\r\n            for (var name in items) {\r\n                langData[name.toLowerCase()] = items[name];\r\n            }\r\n        };\r\n        var translate = function (text) {\r\n            var langData = data[currentCode.get()] || {};\r\n            var toString = function (obj) {\r\n                if (isFunction(obj)) {\r\n                    return Object.prototype.toString.call(obj);\r\n                }\r\n                return !isEmpty(obj) ? '' + obj : '';\r\n            };\r\n            var isEmpty = function (text) {\r\n                return text === '' || text === null || text === undefined;\r\n            };\r\n            var getLangData = function (text) {\r\n                var textstr = toString(text);\r\n                var lowercaseTextstr = textstr.toLowerCase();\r\n                return has(langData, lowercaseTextstr) ? toString(langData[lowercaseTextstr]) : textstr;\r\n            };\r\n            var removeContext = function (str) {\r\n                return str.replace(/{context:\\w+}$/, '');\r\n            };\r\n            var translated = function (text) {\r\n                return text;\r\n            };\r\n            if (isEmpty(text)) {\r\n                return translated('');\r\n            }\r\n            if (isRaw(text)) {\r\n                return translated(toString(text.raw));\r\n            }\r\n            if (isTokenised(text)) {\r\n                var values_1 = text.slice(1);\r\n                var substitued = getLangData(text[0]).replace(/\\{([0-9]+)\\}/g, function ($1, $2) {\r\n                    return has(values_1, $2) ? toString(values_1[$2]) : $1;\r\n                });\r\n                return translated(removeContext(substitued));\r\n            }\r\n            return translated(removeContext(getLangData(text)));\r\n        };\r\n        var isRtl = function () {\r\n            return get(data, currentCode.get()).bind(function (items) {\r\n                return get(items, '_dir');\r\n            }).exists(function (dir) {\r\n                return dir === 'rtl';\r\n            });\r\n        };\r\n        var hasCode = function (code) {\r\n            return has(data, code);\r\n        };\r\n        var I18n = {\r\n            getData: getData,\r\n            setCode: setCode,\r\n            getCode: getCode,\r\n            add: add,\r\n            translate: translate,\r\n            isRtl: isRtl,\r\n            hasCode: hasCode\r\n        };\r\n        var each$7 = Tools.each;\r\n        function AddOnManager() {\r\n            var _this = this;\r\n            var items = [];\r\n            var urls = {};\r\n            var lookup = {};\r\n            var _listeners = [];\r\n            var get = function (name) {\r\n                if (lookup[name]) {\r\n                    return lookup[name].instance;\r\n                }\r\n                return undefined;\r\n            };\r\n            var dependencies = function (name) {\r\n                var result;\r\n                if (lookup[name]) {\r\n                    result = lookup[name].dependencies;\r\n                }\r\n                return result || [];\r\n            };\r\n            var requireLangPack = function (name, languages) {\r\n                var language = I18n.getCode();\r\n                if (language && AddOnManager.languageLoad !== false) {\r\n                    if (languages) {\r\n                        languages = ',' + languages + ',';\r\n                        if (languages.indexOf(',' + language.substr(0, 2) + ',') !== -1) {\r\n                            language = language.substr(0, 2);\r\n                        }\r\n                        else if (languages.indexOf(',' + language + ',') === -1) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    ScriptLoader.ScriptLoader.add(urls[name] + '/langs/' + language + '.js');\r\n                }\r\n            };\r\n            var add = function (id, addOn, dependencies) {\r\n                items.push(addOn);\r\n                lookup[id] = {\r\n                    instance: addOn,\r\n                    dependencies: dependencies\r\n                };\r\n                var result = partition(_listeners, function (listener) {\r\n                    return listener.name === id;\r\n                });\r\n                _listeners = result.fail;\r\n                each$7(result.pass, function (listener) {\r\n                    listener.callback();\r\n                });\r\n                return addOn;\r\n            };\r\n            var remove = function (name) {\r\n                delete urls[name];\r\n                delete lookup[name];\r\n            };\r\n            var createUrl = function (baseUrl, dep) {\r\n                if (typeof dep === 'object') {\r\n                    return dep;\r\n                }\r\n                return typeof baseUrl === 'string' ? {\r\n                    prefix: '',\r\n                    resource: dep,\r\n                    suffix: ''\r\n                } : {\r\n                    prefix: baseUrl.prefix,\r\n                    resource: dep,\r\n                    suffix: baseUrl.suffix\r\n                };\r\n            };\r\n            var addComponents = function (pluginName, scripts) {\r\n                var pluginUrl = _this.urls[pluginName];\r\n                each$7(scripts, function (script) {\r\n                    ScriptLoader.ScriptLoader.add(pluginUrl + '/' + script);\r\n                });\r\n            };\r\n            var loadDependencies = function (name, addOnUrl, success, scope) {\r\n                var deps = dependencies(name);\r\n                each$7(deps, function (dep) {\r\n                    var newUrl = createUrl(addOnUrl, dep);\r\n                    load(newUrl.resource, newUrl, undefined, undefined);\r\n                });\r\n                if (success) {\r\n                    if (scope) {\r\n                        success.call(scope);\r\n                    }\r\n                    else {\r\n                        success.call(ScriptLoader);\r\n                    }\r\n                }\r\n            };\r\n            var load = function (name, addOnUrl, success, scope, failure) {\r\n                if (urls[name]) {\r\n                    return;\r\n                }\r\n                var urlString = typeof addOnUrl === 'string' ? addOnUrl : addOnUrl.prefix + addOnUrl.resource + addOnUrl.suffix;\r\n                if (urlString.indexOf('/') !== 0 && urlString.indexOf('://') === -1) {\r\n                    urlString = AddOnManager.baseURL + '/' + urlString;\r\n                }\r\n                urls[name] = urlString.substring(0, urlString.lastIndexOf('/'));\r\n                if (lookup[name]) {\r\n                    loadDependencies(name, addOnUrl, success, scope);\r\n                }\r\n                else {\r\n                    ScriptLoader.ScriptLoader.add(urlString, function () {\r\n                        return loadDependencies(name, addOnUrl, success, scope);\r\n                    }, scope, failure);\r\n                }\r\n            };\r\n            var waitFor = function (name, callback) {\r\n                if (lookup.hasOwnProperty(name)) {\r\n                    callback();\r\n                }\r\n                else {\r\n                    _listeners.push({\r\n                        name: name,\r\n                        callback: callback\r\n                    });\r\n                }\r\n            };\r\n            return {\r\n                items: items,\r\n                urls: urls,\r\n                lookup: lookup,\r\n                _listeners: _listeners,\r\n                get: get,\r\n                dependencies: dependencies,\r\n                requireLangPack: requireLangPack,\r\n                add: add,\r\n                remove: remove,\r\n                createUrl: createUrl,\r\n                addComponents: addComponents,\r\n                load: load,\r\n                waitFor: waitFor\r\n            };\r\n        }\r\n        (function (AddOnManager) {\r\n            AddOnManager.PluginManager = AddOnManager();\r\n            AddOnManager.ThemeManager = AddOnManager();\r\n        }(AddOnManager || (AddOnManager = {})));\r\n        var AddOnManager$1 = AddOnManager;\r\n        var before = function (marker, element) {\r\n            var parent$1 = parent(marker);\r\n            parent$1.each(function (v) {\r\n                v.dom().insertBefore(element.dom(), marker.dom());\r\n            });\r\n        };\r\n        var after = function (marker, element) {\r\n            var sibling = nextSibling(marker);\r\n            sibling.fold(function () {\r\n                var parent$1 = parent(marker);\r\n                parent$1.each(function (v) {\r\n                    append(v, element);\r\n                });\r\n            }, function (v) {\r\n                before(v, element);\r\n            });\r\n        };\r\n        var prepend = function (parent, element) {\r\n            var firstChild$1 = firstChild(parent);\r\n            firstChild$1.fold(function () {\r\n                append(parent, element);\r\n            }, function (v) {\r\n                parent.dom().insertBefore(element.dom(), v.dom());\r\n            });\r\n        };\r\n        var append = function (parent, element) {\r\n            parent.dom().appendChild(element.dom());\r\n        };\r\n        var wrap$1 = function (element, wrapper) {\r\n            before(element, wrapper);\r\n            append(wrapper, element);\r\n        };\r\n        var before$1 = function (marker, elements) {\r\n            each(elements, function (x) {\r\n                before(marker, x);\r\n            });\r\n        };\r\n        var append$1 = function (parent, elements) {\r\n            each(elements, function (x) {\r\n                append(parent, x);\r\n            });\r\n        };\r\n        var empty = function (element) {\r\n            element.dom().textContent = '';\r\n            each(children(element), function (rogue) {\r\n                remove$1(rogue);\r\n            });\r\n        };\r\n        var remove$1 = function (element) {\r\n            var dom = element.dom();\r\n            if (dom.parentNode !== null) {\r\n                dom.parentNode.removeChild(dom);\r\n            }\r\n        };\r\n        var unwrap = function (wrapper) {\r\n            var children$1 = children(wrapper);\r\n            if (children$1.length > 0) {\r\n                before$1(wrapper, children$1);\r\n            }\r\n            remove$1(wrapper);\r\n        };\r\n        var first = function (fn, rate) {\r\n            var timer = null;\r\n            var cancel = function () {\r\n                if (timer !== null) {\r\n                    domGlobals.clearTimeout(timer);\r\n                    timer = null;\r\n                }\r\n            };\r\n            var throttle = function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                if (timer === null) {\r\n                    timer = domGlobals.setTimeout(function () {\r\n                        fn.apply(null, args);\r\n                        timer = null;\r\n                    }, rate);\r\n                }\r\n            };\r\n            return {\r\n                cancel: cancel,\r\n                throttle: throttle\r\n            };\r\n        };\r\n        var last$2 = function (fn, rate) {\r\n            var timer = null;\r\n            var cancel = function () {\r\n                if (timer !== null) {\r\n                    domGlobals.clearTimeout(timer);\r\n                    timer = null;\r\n                }\r\n            };\r\n            var throttle = function () {\r\n                var args = [];\r\n                for (var _i = 0; _i < arguments.length; _i++) {\r\n                    args[_i] = arguments[_i];\r\n                }\r\n                if (timer !== null)\r\n                    domGlobals.clearTimeout(timer);\r\n                timer = domGlobals.setTimeout(function () {\r\n                    fn.apply(null, args);\r\n                    timer = null;\r\n                }, rate);\r\n            };\r\n            return {\r\n                cancel: cancel,\r\n                throttle: throttle\r\n            };\r\n        };\r\n        var read = function (element, attr) {\r\n            var value = get$1(element, attr);\r\n            return value === undefined || value === '' ? [] : value.split(' ');\r\n        };\r\n        var add$1 = function (element, attr, id) {\r\n            var old = read(element, attr);\r\n            var nu = old.concat([id]);\r\n            set(element, attr, nu.join(' '));\r\n            return true;\r\n        };\r\n        var remove$2 = function (element, attr, id) {\r\n            var nu = filter(read(element, attr), function (v) {\r\n                return v !== id;\r\n            });\r\n            if (nu.length > 0) {\r\n                set(element, attr, nu.join(' '));\r\n            }\r\n            else {\r\n                remove(element, attr);\r\n            }\r\n            return false;\r\n        };\r\n        var supports = function (element) {\r\n            return element.dom().classList !== undefined;\r\n        };\r\n        var get$3 = function (element) {\r\n            return read(element, 'class');\r\n        };\r\n        var add$2 = function (element, clazz) {\r\n            return add$1(element, 'class', clazz);\r\n        };\r\n        var remove$3 = function (element, clazz) {\r\n            return remove$2(element, 'class', clazz);\r\n        };\r\n        var toggle = function (element, clazz) {\r\n            if (contains(get$3(element), clazz)) {\r\n                return remove$3(element, clazz);\r\n            }\r\n            else {\r\n                return add$2(element, clazz);\r\n            }\r\n        };\r\n        var ClassList = Object.freeze({\r\n            get: get$3,\r\n            add: add$2,\r\n            remove: remove$3,\r\n            toggle: toggle,\r\n            supports: supports\r\n        });\r\n        var add$3 = function (element, clazz) {\r\n            if (supports(element)) {\r\n                element.dom().classList.add(clazz);\r\n            }\r\n            else {\r\n                add$2(element, clazz);\r\n            }\r\n        };\r\n        var cleanClass = function (element) {\r\n            var classList = supports(element) ? element.dom().classList : get$3(element);\r\n            if (classList.length === 0) {\r\n                remove(element, 'class');\r\n            }\r\n        };\r\n        var remove$4 = function (element, clazz) {\r\n            if (supports(element)) {\r\n                var classList = element.dom().classList;\r\n                classList.remove(clazz);\r\n            }\r\n            else {\r\n                remove$3(element, clazz);\r\n            }\r\n            cleanClass(element);\r\n        };\r\n        var has$2 = function (element, clazz) {\r\n            return supports(element) && element.dom().classList.contains(clazz);\r\n        };\r\n        var ancestors = function (scope, predicate, isRoot) {\r\n            return filter(parents(scope, isRoot), predicate);\r\n        };\r\n        var siblings$1 = function (scope, predicate) {\r\n            return filter(siblings(scope), predicate);\r\n        };\r\n        var children$1 = function (scope, predicate) {\r\n            return filter(children(scope), predicate);\r\n        };\r\n        var descendants = function (scope, predicate) {\r\n            var result = [];\r\n            each(children(scope), function (x) {\r\n                if (predicate(x)) {\r\n                    result = result.concat([x]);\r\n                }\r\n                result = result.concat(descendants(x, predicate));\r\n            });\r\n            return result;\r\n        };\r\n        var all$1 = function (selector) {\r\n            return all(selector);\r\n        };\r\n        var ancestors$1 = function (scope, selector, isRoot) {\r\n            return ancestors(scope, function (e) {\r\n                return is$1(e, selector);\r\n            }, isRoot);\r\n        };\r\n        var siblings$2 = function (scope, selector) {\r\n            return siblings$1(scope, function (e) {\r\n                return is$1(e, selector);\r\n            });\r\n        };\r\n        var children$2 = function (scope, selector) {\r\n            return children$1(scope, function (e) {\r\n                return is$1(e, selector);\r\n            });\r\n        };\r\n        var descendants$1 = function (scope, selector) {\r\n            return all(selector, scope);\r\n        };\r\n        var SelectorFilter = Object.freeze({\r\n            all: all$1,\r\n            ancestors: ancestors$1,\r\n            siblings: siblings$2,\r\n            children: children$2,\r\n            descendants: descendants$1\r\n        });\r\n        function ClosestOrAncestor(is, ancestor, scope, a, isRoot) {\r\n            return is(scope, a) ? Option.some(scope) : isFunction(isRoot) && isRoot(scope) ? Option.none() : ancestor(scope, a, isRoot);\r\n        }\r\n        var ancestor = function (scope, predicate, isRoot) {\r\n            var element = scope.dom();\r\n            var stop = isFunction(isRoot) ? isRoot : constant(false);\r\n            while (element.parentNode) {\r\n                element = element.parentNode;\r\n                var el = Element.fromDom(element);\r\n                if (predicate(el)) {\r\n                    return Option.some(el);\r\n                }\r\n                else if (stop(el)) {\r\n                    break;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var closest = function (scope, predicate, isRoot) {\r\n            var is = function (s) {\r\n                return predicate(s);\r\n            };\r\n            return ClosestOrAncestor(is, ancestor, scope, predicate, isRoot);\r\n        };\r\n        var ancestor$1 = function (scope, selector, isRoot) {\r\n            return ancestor(scope, function (e) {\r\n                return is$1(e, selector);\r\n            }, isRoot);\r\n        };\r\n        var descendant = function (scope, selector) {\r\n            return one(selector, scope);\r\n        };\r\n        var closest$1 = function (scope, selector, isRoot) {\r\n            return ClosestOrAncestor(is$1, ancestor$1, scope, selector, isRoot);\r\n        };\r\n        var annotation = constant('mce-annotation');\r\n        var dataAnnotation = constant('data-mce-annotation');\r\n        var dataAnnotationId = constant('data-mce-annotation-uid');\r\n        var identify = function (editor, annotationName) {\r\n            var rng = editor.selection.getRng();\r\n            var start = Element.fromDom(rng.startContainer);\r\n            var root = Element.fromDom(editor.getBody());\r\n            var selector = annotationName.fold(function () {\r\n                return '.' + annotation();\r\n            }, function (an) {\r\n                return '[' + dataAnnotation() + '=\"' + an + '\"]';\r\n            });\r\n            var newStart = child(start, rng.startOffset).getOr(start);\r\n            var closest = closest$1(newStart, selector, function (n) {\r\n                return eq(n, root);\r\n            });\r\n            var getAttr = function (c, property) {\r\n                if (has$1(c, property)) {\r\n                    return Option.some(get$1(c, property));\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            };\r\n            return closest.bind(function (c) {\r\n                return getAttr(c, '' + dataAnnotationId()).bind(function (uid) {\r\n                    return getAttr(c, '' + dataAnnotation()).map(function (name) {\r\n                        var elements = findMarkers(editor, uid);\r\n                        return {\r\n                            uid: uid,\r\n                            name: name,\r\n                            elements: elements\r\n                        };\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var isAnnotation = function (elem) {\r\n            return isElement(elem) && has$2(elem, annotation());\r\n        };\r\n        var findMarkers = function (editor, uid) {\r\n            var body = Element.fromDom(editor.getBody());\r\n            return descendants$1(body, '[' + dataAnnotationId() + '=\"' + uid + '\"]');\r\n        };\r\n        var findAll = function (editor, name) {\r\n            var body = Element.fromDom(editor.getBody());\r\n            var markers = descendants$1(body, '[' + dataAnnotation() + '=\"' + name + '\"]');\r\n            var directory = {};\r\n            each(markers, function (m) {\r\n                var uid = get$1(m, dataAnnotationId());\r\n                var nodesAlready = directory.hasOwnProperty(uid) ? directory[uid] : [];\r\n                directory[uid] = nodesAlready.concat([m]);\r\n            });\r\n            return directory;\r\n        };\r\n        var setup = function (editor, registry) {\r\n            var changeCallbacks = Cell({});\r\n            var initData = function () {\r\n                return {\r\n                    listeners: [],\r\n                    previous: Cell(Option.none())\r\n                };\r\n            };\r\n            var withCallbacks = function (name, f) {\r\n                updateCallbacks(name, function (data) {\r\n                    f(data);\r\n                    return data;\r\n                });\r\n            };\r\n            var updateCallbacks = function (name, f) {\r\n                var callbackMap = changeCallbacks.get();\r\n                var data = callbackMap.hasOwnProperty(name) ? callbackMap[name] : initData();\r\n                var outputData = f(data);\r\n                callbackMap[name] = outputData;\r\n                changeCallbacks.set(callbackMap);\r\n            };\r\n            var fireCallbacks = function (name, uid, elements) {\r\n                withCallbacks(name, function (data) {\r\n                    each(data.listeners, function (f) {\r\n                        return f(true, name, {\r\n                            uid: uid,\r\n                            nodes: map(elements, function (elem) {\r\n                                return elem.dom();\r\n                            })\r\n                        });\r\n                    });\r\n                });\r\n            };\r\n            var fireNoAnnotation = function (name) {\r\n                withCallbacks(name, function (data) {\r\n                    each(data.listeners, function (f) {\r\n                        return f(false, name);\r\n                    });\r\n                });\r\n            };\r\n            var onNodeChange = last$2(function () {\r\n                var callbackMap = changeCallbacks.get();\r\n                var annotations = sort(keys(callbackMap));\r\n                each(annotations, function (name) {\r\n                    updateCallbacks(name, function (data) {\r\n                        var prev = data.previous.get();\r\n                        identify(editor, Option.some(name)).fold(function () {\r\n                            if (prev.isSome()) {\r\n                                fireNoAnnotation(name);\r\n                                data.previous.set(Option.none());\r\n                            }\r\n                        }, function (_a) {\r\n                            var uid = _a.uid, name = _a.name, elements = _a.elements;\r\n                            if (!prev.is(uid)) {\r\n                                fireCallbacks(name, uid, elements);\r\n                                data.previous.set(Option.some(uid));\r\n                            }\r\n                        });\r\n                        return {\r\n                            previous: data.previous,\r\n                            listeners: data.listeners\r\n                        };\r\n                    });\r\n                });\r\n            }, 30);\r\n            editor.on('remove', function () {\r\n                onNodeChange.cancel();\r\n            });\r\n            editor.on('NodeChange', function () {\r\n                onNodeChange.throttle();\r\n            });\r\n            var addListener = function (name, f) {\r\n                updateCallbacks(name, function (data) {\r\n                    return {\r\n                        previous: data.previous,\r\n                        listeners: data.listeners.concat([f])\r\n                    };\r\n                });\r\n            };\r\n            return { addListener: addListener };\r\n        };\r\n        var setup$1 = function (editor, registry) {\r\n            var identifyParserNode = function (span) {\r\n                return Option.from(span.attr(dataAnnotation())).bind(registry.lookup);\r\n            };\r\n            editor.on('init', function () {\r\n                editor.serializer.addNodeFilter('span', function (spans) {\r\n                    each(spans, function (span) {\r\n                        identifyParserNode(span).each(function (settings) {\r\n                            if (settings.persistent === false) {\r\n                                span.unwrap();\r\n                            }\r\n                        });\r\n                    });\r\n                });\r\n            });\r\n        };\r\n        var create$1 = function () {\r\n            var annotations = {};\r\n            var register = function (name, settings) {\r\n                annotations[name] = {\r\n                    name: name,\r\n                    settings: settings\r\n                };\r\n            };\r\n            var lookup = function (name) {\r\n                return annotations.hasOwnProperty(name) ? Option.from(annotations[name]).map(function (a) {\r\n                    return a.settings;\r\n                }) : Option.none();\r\n            };\r\n            return {\r\n                register: register,\r\n                lookup: lookup\r\n            };\r\n        };\r\n        var unique = 0;\r\n        var generate = function (prefix) {\r\n            var date = new Date();\r\n            var time = date.getTime();\r\n            var random = Math.floor(Math.random() * 1000000000);\r\n            unique++;\r\n            return prefix + '_' + random + unique + String(time);\r\n        };\r\n        var add$4 = function (element, classes) {\r\n            each(classes, function (x) {\r\n                add$3(element, x);\r\n            });\r\n        };\r\n        var clone = function (original, isDeep) {\r\n            return Element.fromDom(original.dom().cloneNode(isDeep));\r\n        };\r\n        var shallow = function (original) {\r\n            return clone(original, false);\r\n        };\r\n        var deep = function (original) {\r\n            return clone(original, true);\r\n        };\r\n        var fromHtml$1 = function (html, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var div = doc.createElement('div');\r\n            div.innerHTML = html;\r\n            return children(Element.fromDom(div));\r\n        };\r\n        var get$4 = function (element) {\r\n            return element.dom().innerHTML;\r\n        };\r\n        var set$1 = function (element, content) {\r\n            var owner$1 = owner(element);\r\n            var docDom = owner$1.dom();\r\n            var fragment = Element.fromDom(docDom.createDocumentFragment());\r\n            var contentElements = fromHtml$1(content, docDom);\r\n            append$1(fragment, contentElements);\r\n            empty(element);\r\n            append(element, fragment);\r\n        };\r\n        var ZWSP = '\\uFEFF';\r\n        var isZwsp = function (chr) {\r\n            return chr === ZWSP;\r\n        };\r\n        var trim$3 = function (text) {\r\n            return text.replace(new RegExp(ZWSP, 'g'), '');\r\n        };\r\n        var Zwsp = {\r\n            isZwsp: isZwsp,\r\n            ZWSP: ZWSP,\r\n            trim: trim$3\r\n        };\r\n        var isElement$2 = NodeType.isElement;\r\n        var isText$2 = NodeType.isText;\r\n        var isCaretContainerBlock = function (node) {\r\n            if (isText$2(node)) {\r\n                node = node.parentNode;\r\n            }\r\n            return isElement$2(node) && node.hasAttribute('data-mce-caret');\r\n        };\r\n        var isCaretContainerInline = function (node) {\r\n            return isText$2(node) && Zwsp.isZwsp(node.data);\r\n        };\r\n        var isCaretContainer = function (node) {\r\n            return isCaretContainerBlock(node) || isCaretContainerInline(node);\r\n        };\r\n        var hasContent = function (node) {\r\n            return node.firstChild !== node.lastChild || !NodeType.isBr(node.firstChild);\r\n        };\r\n        var insertInline = function (node, before) {\r\n            var doc, sibling, textNode, parentNode;\r\n            doc = node.ownerDocument;\r\n            textNode = doc.createTextNode(Zwsp.ZWSP);\r\n            parentNode = node.parentNode;\r\n            if (!before) {\r\n                sibling = node.nextSibling;\r\n                if (isText$2(sibling)) {\r\n                    if (isCaretContainer(sibling)) {\r\n                        return sibling;\r\n                    }\r\n                    if (startsWithCaretContainer(sibling)) {\r\n                        sibling.splitText(1);\r\n                        return sibling;\r\n                    }\r\n                }\r\n                if (node.nextSibling) {\r\n                    parentNode.insertBefore(textNode, node.nextSibling);\r\n                }\r\n                else {\r\n                    parentNode.appendChild(textNode);\r\n                }\r\n            }\r\n            else {\r\n                sibling = node.previousSibling;\r\n                if (isText$2(sibling)) {\r\n                    if (isCaretContainer(sibling)) {\r\n                        return sibling;\r\n                    }\r\n                    if (endsWithCaretContainer(sibling)) {\r\n                        return sibling.splitText(sibling.data.length - 1);\r\n                    }\r\n                }\r\n                parentNode.insertBefore(textNode, node);\r\n            }\r\n            return textNode;\r\n        };\r\n        var prependInline = function (node) {\r\n            if (NodeType.isText(node)) {\r\n                var data = node.data;\r\n                if (data.length > 0 && data.charAt(0) !== Zwsp.ZWSP) {\r\n                    node.insertData(0, Zwsp.ZWSP);\r\n                }\r\n                return node;\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        };\r\n        var appendInline = function (node) {\r\n            if (NodeType.isText(node)) {\r\n                var data = node.data;\r\n                if (data.length > 0 && data.charAt(data.length - 1) !== Zwsp.ZWSP) {\r\n                    node.insertData(data.length, Zwsp.ZWSP);\r\n                }\r\n                return node;\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        };\r\n        var isBeforeInline = function (pos) {\r\n            var container = pos.container();\r\n            if (!pos || !NodeType.isText(container)) {\r\n                return false;\r\n            }\r\n            return container.data.charAt(pos.offset()) === Zwsp.ZWSP || pos.isAtStart() && isCaretContainerInline(container.previousSibling);\r\n        };\r\n        var isAfterInline = function (pos) {\r\n            var container = pos.container();\r\n            if (!pos || !NodeType.isText(container)) {\r\n                return false;\r\n            }\r\n            return container.data.charAt(pos.offset() - 1) === Zwsp.ZWSP || pos.isAtEnd() && isCaretContainerInline(container.nextSibling);\r\n        };\r\n        var createBogusBr = function () {\r\n            var br = domGlobals.document.createElement('br');\r\n            br.setAttribute('data-mce-bogus', '1');\r\n            return br;\r\n        };\r\n        var insertBlock = function (blockName, node, before) {\r\n            var doc, blockNode, parentNode;\r\n            doc = node.ownerDocument;\r\n            blockNode = doc.createElement(blockName);\r\n            blockNode.setAttribute('data-mce-caret', before ? 'before' : 'after');\r\n            blockNode.setAttribute('data-mce-bogus', 'all');\r\n            blockNode.appendChild(createBogusBr());\r\n            parentNode = node.parentNode;\r\n            if (!before) {\r\n                if (node.nextSibling) {\r\n                    parentNode.insertBefore(blockNode, node.nextSibling);\r\n                }\r\n                else {\r\n                    parentNode.appendChild(blockNode);\r\n                }\r\n            }\r\n            else {\r\n                parentNode.insertBefore(blockNode, node);\r\n            }\r\n            return blockNode;\r\n        };\r\n        var startsWithCaretContainer = function (node) {\r\n            return isText$2(node) && node.data[0] === Zwsp.ZWSP;\r\n        };\r\n        var endsWithCaretContainer = function (node) {\r\n            return isText$2(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;\r\n        };\r\n        var trimBogusBr = function (elm) {\r\n            var brs = elm.getElementsByTagName('br');\r\n            var lastBr = brs[brs.length - 1];\r\n            if (NodeType.isBogus(lastBr)) {\r\n                lastBr.parentNode.removeChild(lastBr);\r\n            }\r\n        };\r\n        var showCaretContainerBlock = function (caretContainer) {\r\n            if (caretContainer && caretContainer.hasAttribute('data-mce-caret')) {\r\n                trimBogusBr(caretContainer);\r\n                caretContainer.removeAttribute('data-mce-caret');\r\n                caretContainer.removeAttribute('data-mce-bogus');\r\n                caretContainer.removeAttribute('style');\r\n                caretContainer.removeAttribute('_moz_abspos');\r\n                return caretContainer;\r\n            }\r\n            return null;\r\n        };\r\n        var isRangeInCaretContainerBlock = function (range) {\r\n            return isCaretContainerBlock(range.startContainer);\r\n        };\r\n        var CaretContainer = Object.freeze({\r\n            isCaretContainer: isCaretContainer,\r\n            isCaretContainerBlock: isCaretContainerBlock,\r\n            isCaretContainerInline: isCaretContainerInline,\r\n            showCaretContainerBlock: showCaretContainerBlock,\r\n            insertInline: insertInline,\r\n            prependInline: prependInline,\r\n            appendInline: appendInline,\r\n            isBeforeInline: isBeforeInline,\r\n            isAfterInline: isAfterInline,\r\n            insertBlock: insertBlock,\r\n            hasContent: hasContent,\r\n            startsWithCaretContainer: startsWithCaretContainer,\r\n            endsWithCaretContainer: endsWithCaretContainer,\r\n            isRangeInCaretContainerBlock: isRangeInCaretContainerBlock\r\n        });\r\n        var isContentEditableTrue$1 = NodeType.isContentEditableTrue;\r\n        var isContentEditableFalse$1 = NodeType.isContentEditableFalse;\r\n        var isBr$2 = NodeType.isBr;\r\n        var isText$3 = NodeType.isText;\r\n        var isInvalidTextElement = NodeType.matchNodeNames('script style textarea');\r\n        var isAtomicInline = NodeType.matchNodeNames('img input textarea hr iframe video audio object');\r\n        var isTable$2 = NodeType.matchNodeNames('table');\r\n        var isCaretContainer$1 = isCaretContainer;\r\n        var isCaretCandidate = function (node) {\r\n            if (isCaretContainer$1(node)) {\r\n                return false;\r\n            }\r\n            if (isText$3(node)) {\r\n                if (isInvalidTextElement(node.parentNode)) {\r\n                    return false;\r\n                }\r\n                return true;\r\n            }\r\n            return isAtomicInline(node) || isBr$2(node) || isTable$2(node) || isNonUiContentEditableFalse(node);\r\n        };\r\n        var isUnselectable = function (node) {\r\n            return NodeType.isElement(node) && node.getAttribute('unselectable') === 'true';\r\n        };\r\n        var isNonUiContentEditableFalse = function (node) {\r\n            return isUnselectable(node) === false && isContentEditableFalse$1(node);\r\n        };\r\n        var isInEditable = function (node, root) {\r\n            for (node = node.parentNode; node && node !== root; node = node.parentNode) {\r\n                if (isNonUiContentEditableFalse(node)) {\r\n                    return false;\r\n                }\r\n                if (isContentEditableTrue$1(node)) {\r\n                    return true;\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        var isAtomicContentEditableFalse = function (node) {\r\n            if (!isNonUiContentEditableFalse(node)) {\r\n                return false;\r\n            }\r\n            return foldl(from$1(node.getElementsByTagName('*')), function (result, elm) {\r\n                return result || isContentEditableTrue$1(elm);\r\n            }, false) !== true;\r\n        };\r\n        var isAtomic = function (node) {\r\n            return isAtomicInline(node) || isAtomicContentEditableFalse(node);\r\n        };\r\n        var isEditableCaretCandidate = function (node, root) {\r\n            return isCaretCandidate(node) && isInEditable(node, root);\r\n        };\r\n        var round = Math.round;\r\n        var clone$1 = function (rect) {\r\n            if (!rect) {\r\n                return {\r\n                    left: 0,\r\n                    top: 0,\r\n                    bottom: 0,\r\n                    right: 0,\r\n                    width: 0,\r\n                    height: 0\r\n                };\r\n            }\r\n            return {\r\n                left: round(rect.left),\r\n                top: round(rect.top),\r\n                bottom: round(rect.bottom),\r\n                right: round(rect.right),\r\n                width: round(rect.width),\r\n                height: round(rect.height)\r\n            };\r\n        };\r\n        var collapse = function (rect, toStart) {\r\n            rect = clone$1(rect);\r\n            if (toStart) {\r\n                rect.right = rect.left;\r\n            }\r\n            else {\r\n                rect.left = rect.left + rect.width;\r\n                rect.right = rect.left;\r\n            }\r\n            rect.width = 0;\r\n            return rect;\r\n        };\r\n        var isEqual = function (rect1, rect2) {\r\n            return rect1.left === rect2.left && rect1.top === rect2.top && rect1.bottom === rect2.bottom && rect1.right === rect2.right;\r\n        };\r\n        var isValidOverflow = function (overflowY, rect1, rect2) {\r\n            return overflowY >= 0 && overflowY <= Math.min(rect1.height, rect2.height) / 2;\r\n        };\r\n        var isAbove = function (rect1, rect2) {\r\n            if (rect1.bottom - rect1.height / 2 < rect2.top) {\r\n                return true;\r\n            }\r\n            if (rect1.top > rect2.bottom) {\r\n                return false;\r\n            }\r\n            return isValidOverflow(rect2.top - rect1.bottom, rect1, rect2);\r\n        };\r\n        var isBelow = function (rect1, rect2) {\r\n            if (rect1.top > rect2.bottom) {\r\n                return true;\r\n            }\r\n            if (rect1.bottom < rect2.top) {\r\n                return false;\r\n            }\r\n            return isValidOverflow(rect2.bottom - rect1.top, rect1, rect2);\r\n        };\r\n        var containsXY = function (rect, clientX, clientY) {\r\n            return clientX >= rect.left && clientX <= rect.right && clientY >= rect.top && clientY <= rect.bottom;\r\n        };\r\n        var overflowX = function (outer, inner) {\r\n            if (inner.left > outer.left && inner.right < outer.right) {\r\n                return 0;\r\n            }\r\n            else {\r\n                return inner.left < outer.left ? inner.left - outer.left : inner.right - outer.right;\r\n            }\r\n        };\r\n        var overflowY = function (outer, inner) {\r\n            if (inner.top > outer.top && inner.bottom < outer.bottom) {\r\n                return 0;\r\n            }\r\n            else {\r\n                return inner.top < outer.top ? inner.top - outer.top : inner.bottom - outer.bottom;\r\n            }\r\n        };\r\n        var getOverflow = function (outer, inner) {\r\n            return {\r\n                x: overflowX(outer, inner),\r\n                y: overflowY(outer, inner)\r\n            };\r\n        };\r\n        var getSelectedNode = function (range) {\r\n            var startContainer = range.startContainer, startOffset = range.startOffset;\r\n            if (startContainer.hasChildNodes() && range.endOffset === startOffset + 1) {\r\n                return startContainer.childNodes[startOffset];\r\n            }\r\n            return null;\r\n        };\r\n        var getNode = function (container, offset) {\r\n            if (container.nodeType === 1 && container.hasChildNodes()) {\r\n                if (offset >= container.childNodes.length) {\r\n                    offset = container.childNodes.length - 1;\r\n                }\r\n                container = container.childNodes[offset];\r\n            }\r\n            return container;\r\n        };\r\n        var extendingChars = new RegExp('[\\u0300-\\u036f\\u0483-\\u0487\\u0488-\\u0489\\u0591-\\u05bd\\u05bf\\u05c1-\\u05c2\\u05c4-\\u05c5\\u05c7\\u0610-\\u061a' + '\\u064b-\\u065f\\u0670\\u06d6-\\u06dc\\u06df-\\u06e4\\u06e7-\\u06e8\\u06ea-\\u06ed\\u0711\\u0730-\\u074a\\u07a6-\\u07b0' + '\\u07eb-\\u07f3\\u0816-\\u0819\\u081b-\\u0823\\u0825-\\u0827\\u0829-\\u082d\\u0859-\\u085b\\u08E3-\\u0902\\u093a\\u093c' + '\\u0941-\\u0948\\u094d\\u0951-\\u0957\\u0962-\\u0963\\u0981\\u09bc\\u09be\\u09c1-\\u09c4\\u09cd\\u09d7\\u09e2-\\u09e3' + '\\u0a01-\\u0a02\\u0a3c\\u0a41-\\u0a42\\u0a47-\\u0a48\\u0a4b-\\u0a4d\\u0a51\\u0a70-\\u0a71\\u0a75\\u0a81-\\u0a82\\u0abc' + '\\u0ac1-\\u0ac5\\u0ac7-\\u0ac8\\u0acd\\u0ae2-\\u0ae3\\u0b01\\u0b3c\\u0b3e\\u0b3f\\u0b41-\\u0b44\\u0b4d\\u0b56\\u0b57' + '\\u0b62-\\u0b63\\u0b82\\u0bbe\\u0bc0\\u0bcd\\u0bd7\\u0c00\\u0c3e-\\u0c40\\u0c46-\\u0c48\\u0c4a-\\u0c4d\\u0c55-\\u0c56' + '\\u0c62-\\u0c63\\u0c81\\u0cbc\\u0cbf\\u0cc2\\u0cc6\\u0ccc-\\u0ccd\\u0cd5-\\u0cd6\\u0ce2-\\u0ce3\\u0d01\\u0d3e\\u0d41-\\u0d44' + '\\u0d4d\\u0d57\\u0d62-\\u0d63\\u0dca\\u0dcf\\u0dd2-\\u0dd4\\u0dd6\\u0ddf\\u0e31\\u0e34-\\u0e3a\\u0e47-\\u0e4e\\u0eb1\\u0eb4-\\u0eb9' + '\\u0ebb-\\u0ebc\\u0ec8-\\u0ecd\\u0f18-\\u0f19\\u0f35\\u0f37\\u0f39\\u0f71-\\u0f7e\\u0f80-\\u0f84\\u0f86-\\u0f87\\u0f8d-\\u0f97' + '\\u0f99-\\u0fbc\\u0fc6\\u102d-\\u1030\\u1032-\\u1037\\u1039-\\u103a\\u103d-\\u103e\\u1058-\\u1059\\u105e-\\u1060\\u1071-\\u1074' + '\\u1082\\u1085-\\u1086\\u108d\\u109d\\u135d-\\u135f\\u1712-\\u1714\\u1732-\\u1734\\u1752-\\u1753\\u1772-\\u1773\\u17b4-\\u17b5' + '\\u17b7-\\u17bd\\u17c6\\u17c9-\\u17d3\\u17dd\\u180b-\\u180d\\u18a9\\u1920-\\u1922\\u1927-\\u1928\\u1932\\u1939-\\u193b\\u1a17-\\u1a18' + '\\u1a1b\\u1a56\\u1a58-\\u1a5e\\u1a60\\u1a62\\u1a65-\\u1a6c\\u1a73-\\u1a7c\\u1a7f\\u1ab0-\\u1abd\\u1ABE\\u1b00-\\u1b03\\u1b34' + '\\u1b36-\\u1b3a\\u1b3c\\u1b42\\u1b6b-\\u1b73\\u1b80-\\u1b81\\u1ba2-\\u1ba5\\u1ba8-\\u1ba9\\u1bab-\\u1bad\\u1be6\\u1be8-\\u1be9' + '\\u1bed\\u1bef-\\u1bf1\\u1c2c-\\u1c33\\u1c36-\\u1c37\\u1cd0-\\u1cd2\\u1cd4-\\u1ce0\\u1ce2-\\u1ce8\\u1ced\\u1cf4\\u1cf8-\\u1cf9' + '\\u1dc0-\\u1df5\\u1dfc-\\u1dff\\u200c-\\u200d\\u20d0-\\u20dc\\u20DD-\\u20E0\\u20e1\\u20E2-\\u20E4\\u20e5-\\u20f0\\u2cef-\\u2cf1' + '\\u2d7f\\u2de0-\\u2dff\\u302a-\\u302d\\u302e-\\u302f\\u3099-\\u309a\\ua66f\\uA670-\\uA672\\ua674-\\ua67d\\uA69E-\\ua69f\\ua6f0-\\ua6f1' + '\\ua802\\ua806\\ua80b\\ua825-\\ua826\\ua8c4\\ua8e0-\\ua8f1\\ua926-\\ua92d\\ua947-\\ua951\\ua980-\\ua982\\ua9b3\\ua9b6-\\ua9b9\\ua9bc' + '\\ua9e5\\uaa29-\\uaa2e\\uaa31-\\uaa32\\uaa35-\\uaa36\\uaa43\\uaa4c\\uaa7c\\uaab0\\uaab2-\\uaab4\\uaab7-\\uaab8\\uaabe-\\uaabf\\uaac1' + '\\uaaec-\\uaaed\\uaaf6\\uabe5\\uabe8\\uabed\\ufb1e\\ufe00-\\ufe0f\\ufe20-\\uFE2F\\uff9e-\\uff9f]');\r\n        var isExtendingChar = function (ch) {\r\n            return typeof ch === 'string' && ch.charCodeAt(0) >= 768 && extendingChars.test(ch);\r\n        };\r\n        var liftN = function (arr, f) {\r\n            var r = [];\r\n            for (var i = 0; i < arr.length; i++) {\r\n                var x = arr[i];\r\n                if (x.isSome()) {\r\n                    r.push(x.getOrDie());\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            }\r\n            return Option.some(f.apply(null, r));\r\n        };\r\n        var slice$3 = [].slice;\r\n        var or = function () {\r\n            var x = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                x[_i] = arguments[_i];\r\n            }\r\n            var args = slice$3.call(arguments);\r\n            return function (x) {\r\n                for (var i = 0; i < args.length; i++) {\r\n                    if (args[i](x)) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n        };\r\n        var and = function () {\r\n            var x = [];\r\n            for (var _i = 0; _i < arguments.length; _i++) {\r\n                x[_i] = arguments[_i];\r\n            }\r\n            var args = slice$3.call(arguments);\r\n            return function (x) {\r\n                for (var i = 0; i < args.length; i++) {\r\n                    if (!args[i](x)) {\r\n                        return false;\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n        };\r\n        var Predicate = {\r\n            and: and,\r\n            or: or\r\n        };\r\n        var isElement$3 = NodeType.isElement;\r\n        var isCaretCandidate$1 = isCaretCandidate;\r\n        var isBlock$1 = NodeType.matchStyleValues('display', 'block table');\r\n        var isFloated = NodeType.matchStyleValues('float', 'left right');\r\n        var isValidElementCaretCandidate = Predicate.and(isElement$3, isCaretCandidate$1, not(isFloated));\r\n        var isNotPre = not(NodeType.matchStyleValues('white-space', 'pre pre-line pre-wrap'));\r\n        var isText$4 = NodeType.isText;\r\n        var isBr$3 = NodeType.isBr;\r\n        var nodeIndex = DOMUtils$1.nodeIndex;\r\n        var resolveIndex = getNode;\r\n        var createRange = function (doc) {\r\n            return 'createRange' in doc ? doc.createRange() : DOMUtils$1.DOM.createRng();\r\n        };\r\n        var isWhiteSpace = function (chr) {\r\n            return chr && /[\\r\\n\\t ]/.test(chr);\r\n        };\r\n        var isRange = function (rng) {\r\n            return !!rng.setStart && !!rng.setEnd;\r\n        };\r\n        var isHiddenWhiteSpaceRange = function (range) {\r\n            var container = range.startContainer;\r\n            var offset = range.startOffset;\r\n            var text;\r\n            if (isWhiteSpace(range.toString()) && isNotPre(container.parentNode) && NodeType.isText(container)) {\r\n                text = container.data;\r\n                if (isWhiteSpace(text[offset - 1]) || isWhiteSpace(text[offset + 1])) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var getBrClientRect = function (brNode) {\r\n            var doc = brNode.ownerDocument;\r\n            var rng = createRange(doc);\r\n            var nbsp = doc.createTextNode('\\xA0');\r\n            var parentNode = brNode.parentNode;\r\n            var clientRect;\r\n            parentNode.insertBefore(nbsp, brNode);\r\n            rng.setStart(nbsp, 0);\r\n            rng.setEnd(nbsp, 1);\r\n            clientRect = clone$1(rng.getBoundingClientRect());\r\n            parentNode.removeChild(nbsp);\r\n            return clientRect;\r\n        };\r\n        var getBoundingClientRectWebKitText = function (rng) {\r\n            var sc = rng.startContainer;\r\n            var ec = rng.endContainer;\r\n            var so = rng.startOffset;\r\n            var eo = rng.endOffset;\r\n            if (sc === ec && NodeType.isText(ec) && so === 0 && eo === 1) {\r\n                var newRng = rng.cloneRange();\r\n                newRng.setEndAfter(ec);\r\n                return getBoundingClientRect(newRng);\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        };\r\n        var isZeroRect = function (r) {\r\n            return r.left === 0 && r.right === 0 && r.top === 0 && r.bottom === 0;\r\n        };\r\n        var getBoundingClientRect = function (item) {\r\n            var clientRect, clientRects;\r\n            clientRects = item.getClientRects();\r\n            if (clientRects.length > 0) {\r\n                clientRect = clone$1(clientRects[0]);\r\n            }\r\n            else {\r\n                clientRect = clone$1(item.getBoundingClientRect());\r\n            }\r\n            if (!isRange(item) && isBr$3(item) && isZeroRect(clientRect)) {\r\n                return getBrClientRect(item);\r\n            }\r\n            if (isZeroRect(clientRect) && isRange(item)) {\r\n                return getBoundingClientRectWebKitText(item);\r\n            }\r\n            return clientRect;\r\n        };\r\n        var collapseAndInflateWidth = function (clientRect, toStart) {\r\n            var newClientRect = collapse(clientRect, toStart);\r\n            newClientRect.width = 1;\r\n            newClientRect.right = newClientRect.left + 1;\r\n            return newClientRect;\r\n        };\r\n        var getCaretPositionClientRects = function (caretPosition) {\r\n            var clientRects = [];\r\n            var beforeNode, node;\r\n            var addUniqueAndValidRect = function (clientRect) {\r\n                if (clientRect.height === 0) {\r\n                    return;\r\n                }\r\n                if (clientRects.length > 0) {\r\n                    if (isEqual(clientRect, clientRects[clientRects.length - 1])) {\r\n                        return;\r\n                    }\r\n                }\r\n                clientRects.push(clientRect);\r\n            };\r\n            var addCharacterOffset = function (container, offset) {\r\n                var range = createRange(container.ownerDocument);\r\n                if (offset < container.data.length) {\r\n                    if (isExtendingChar(container.data[offset])) {\r\n                        return clientRects;\r\n                    }\r\n                    if (isExtendingChar(container.data[offset - 1])) {\r\n                        range.setStart(container, offset);\r\n                        range.setEnd(container, offset + 1);\r\n                        if (!isHiddenWhiteSpaceRange(range)) {\r\n                            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\r\n                            return clientRects;\r\n                        }\r\n                    }\r\n                }\r\n                if (offset > 0) {\r\n                    range.setStart(container, offset - 1);\r\n                    range.setEnd(container, offset);\r\n                    if (!isHiddenWhiteSpaceRange(range)) {\r\n                        addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), false));\r\n                    }\r\n                }\r\n                if (offset < container.data.length) {\r\n                    range.setStart(container, offset);\r\n                    range.setEnd(container, offset + 1);\r\n                    if (!isHiddenWhiteSpaceRange(range)) {\r\n                        addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(range), true));\r\n                    }\r\n                }\r\n            };\r\n            if (isText$4(caretPosition.container())) {\r\n                addCharacterOffset(caretPosition.container(), caretPosition.offset());\r\n                return clientRects;\r\n            }\r\n            if (isElement$3(caretPosition.container())) {\r\n                if (caretPosition.isAtEnd()) {\r\n                    node = resolveIndex(caretPosition.container(), caretPosition.offset());\r\n                    if (isText$4(node)) {\r\n                        addCharacterOffset(node, node.data.length);\r\n                    }\r\n                    if (isValidElementCaretCandidate(node) && !isBr$3(node)) {\r\n                        addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\r\n                    }\r\n                }\r\n                else {\r\n                    node = resolveIndex(caretPosition.container(), caretPosition.offset());\r\n                    if (isText$4(node)) {\r\n                        addCharacterOffset(node, 0);\r\n                    }\r\n                    if (isValidElementCaretCandidate(node) && caretPosition.isAtEnd()) {\r\n                        addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), false));\r\n                        return clientRects;\r\n                    }\r\n                    beforeNode = resolveIndex(caretPosition.container(), caretPosition.offset() - 1);\r\n                    if (isValidElementCaretCandidate(beforeNode) && !isBr$3(beforeNode)) {\r\n                        if (isBlock$1(beforeNode) || isBlock$1(node) || !isValidElementCaretCandidate(node)) {\r\n                            addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(beforeNode), false));\r\n                        }\r\n                    }\r\n                    if (isValidElementCaretCandidate(node)) {\r\n                        addUniqueAndValidRect(collapseAndInflateWidth(getBoundingClientRect(node), true));\r\n                    }\r\n                }\r\n            }\r\n            return clientRects;\r\n        };\r\n        function CaretPosition(container, offset, clientRects) {\r\n            var isAtStart = function () {\r\n                if (isText$4(container)) {\r\n                    return offset === 0;\r\n                }\r\n                return offset === 0;\r\n            };\r\n            var isAtEnd = function () {\r\n                if (isText$4(container)) {\r\n                    return offset >= container.data.length;\r\n                }\r\n                return offset >= container.childNodes.length;\r\n            };\r\n            var toRange = function () {\r\n                var range;\r\n                range = createRange(container.ownerDocument);\r\n                range.setStart(container, offset);\r\n                range.setEnd(container, offset);\r\n                return range;\r\n            };\r\n            var getClientRects = function () {\r\n                if (!clientRects) {\r\n                    clientRects = getCaretPositionClientRects(CaretPosition(container, offset));\r\n                }\r\n                return clientRects;\r\n            };\r\n            var isVisible = function () {\r\n                return getClientRects().length > 0;\r\n            };\r\n            var isEqual = function (caretPosition) {\r\n                return caretPosition && container === caretPosition.container() && offset === caretPosition.offset();\r\n            };\r\n            var getNode = function (before) {\r\n                return resolveIndex(container, before ? offset - 1 : offset);\r\n            };\r\n            return {\r\n                container: constant(container),\r\n                offset: constant(offset),\r\n                toRange: toRange,\r\n                getClientRects: getClientRects,\r\n                isVisible: isVisible,\r\n                isAtStart: isAtStart,\r\n                isAtEnd: isAtEnd,\r\n                isEqual: isEqual,\r\n                getNode: getNode\r\n            };\r\n        }\r\n        (function (CaretPosition) {\r\n            CaretPosition.fromRangeStart = function (range) {\r\n                return CaretPosition(range.startContainer, range.startOffset);\r\n            };\r\n            CaretPosition.fromRangeEnd = function (range) {\r\n                return CaretPosition(range.endContainer, range.endOffset);\r\n            };\r\n            CaretPosition.after = function (node) {\r\n                return CaretPosition(node.parentNode, nodeIndex(node) + 1);\r\n            };\r\n            CaretPosition.before = function (node) {\r\n                return CaretPosition(node.parentNode, nodeIndex(node));\r\n            };\r\n            CaretPosition.isAbove = function (pos1, pos2) {\r\n                return liftN([\r\n                    head(pos2.getClientRects()),\r\n                    last(pos1.getClientRects())\r\n                ], isAbove).getOr(false);\r\n            };\r\n            CaretPosition.isBelow = function (pos1, pos2) {\r\n                return liftN([\r\n                    last(pos2.getClientRects()),\r\n                    head(pos1.getClientRects())\r\n                ], isBelow).getOr(false);\r\n            };\r\n            CaretPosition.isAtStart = function (pos) {\r\n                return pos ? pos.isAtStart() : false;\r\n            };\r\n            CaretPosition.isAtEnd = function (pos) {\r\n                return pos ? pos.isAtEnd() : false;\r\n            };\r\n            CaretPosition.isTextPosition = function (pos) {\r\n                return pos ? NodeType.isText(pos.container()) : false;\r\n            };\r\n            CaretPosition.isElementPosition = function (pos) {\r\n                return CaretPosition.isTextPosition(pos) === false;\r\n            };\r\n        }(CaretPosition || (CaretPosition = {})));\r\n        var CaretPosition$1 = CaretPosition;\r\n        var isText$5 = NodeType.isText;\r\n        var isBogus$1 = NodeType.isBogus;\r\n        var nodeIndex$1 = DOMUtils$1.nodeIndex;\r\n        var normalizedParent = function (node) {\r\n            var parentNode = node.parentNode;\r\n            if (isBogus$1(parentNode)) {\r\n                return normalizedParent(parentNode);\r\n            }\r\n            return parentNode;\r\n        };\r\n        var getChildNodes = function (node) {\r\n            if (!node) {\r\n                return [];\r\n            }\r\n            return ArrUtils.reduce(node.childNodes, function (result, node) {\r\n                if (isBogus$1(node) && node.nodeName !== 'BR') {\r\n                    result = result.concat(getChildNodes(node));\r\n                }\r\n                else {\r\n                    result.push(node);\r\n                }\r\n                return result;\r\n            }, []);\r\n        };\r\n        var normalizedTextOffset = function (node, offset) {\r\n            while (node = node.previousSibling) {\r\n                if (!isText$5(node)) {\r\n                    break;\r\n                }\r\n                offset += node.data.length;\r\n            }\r\n            return offset;\r\n        };\r\n        var equal$1 = function (a) {\r\n            return function (b) {\r\n                return a === b;\r\n            };\r\n        };\r\n        var normalizedNodeIndex = function (node) {\r\n            var nodes, index, numTextFragments;\r\n            nodes = getChildNodes(normalizedParent(node));\r\n            index = ArrUtils.findIndex(nodes, equal$1(node), node);\r\n            nodes = nodes.slice(0, index + 1);\r\n            numTextFragments = ArrUtils.reduce(nodes, function (result, node, i) {\r\n                if (isText$5(node) && isText$5(nodes[i - 1])) {\r\n                    result++;\r\n                }\r\n                return result;\r\n            }, 0);\r\n            nodes = ArrUtils.filter(nodes, NodeType.matchNodeNames(node.nodeName));\r\n            index = ArrUtils.findIndex(nodes, equal$1(node), node);\r\n            return index - numTextFragments;\r\n        };\r\n        var createPathItem = function (node) {\r\n            var name;\r\n            if (isText$5(node)) {\r\n                name = 'text()';\r\n            }\r\n            else {\r\n                name = node.nodeName.toLowerCase();\r\n            }\r\n            return name + '[' + normalizedNodeIndex(node) + ']';\r\n        };\r\n        var parentsUntil = function (root, node, predicate) {\r\n            var parents = [];\r\n            for (node = node.parentNode; node !== root; node = node.parentNode) {\r\n                if (predicate && predicate(node)) {\r\n                    break;\r\n                }\r\n                parents.push(node);\r\n            }\r\n            return parents;\r\n        };\r\n        var create$2 = function (root, caretPosition) {\r\n            var container, offset, path = [], outputOffset, childNodes, parents;\r\n            container = caretPosition.container();\r\n            offset = caretPosition.offset();\r\n            if (isText$5(container)) {\r\n                outputOffset = normalizedTextOffset(container, offset);\r\n            }\r\n            else {\r\n                childNodes = container.childNodes;\r\n                if (offset >= childNodes.length) {\r\n                    outputOffset = 'after';\r\n                    offset = childNodes.length - 1;\r\n                }\r\n                else {\r\n                    outputOffset = 'before';\r\n                }\r\n                container = childNodes[offset];\r\n            }\r\n            path.push(createPathItem(container));\r\n            parents = parentsUntil(root, container);\r\n            parents = ArrUtils.filter(parents, not(NodeType.isBogus));\r\n            path = path.concat(ArrUtils.map(parents, function (node) {\r\n                return createPathItem(node);\r\n            }));\r\n            return path.reverse().join('/') + ',' + outputOffset;\r\n        };\r\n        var resolvePathItem = function (node, name, index) {\r\n            var nodes = getChildNodes(node);\r\n            nodes = ArrUtils.filter(nodes, function (node, index) {\r\n                return !isText$5(node) || !isText$5(nodes[index - 1]);\r\n            });\r\n            nodes = ArrUtils.filter(nodes, NodeType.matchNodeNames(name));\r\n            return nodes[index];\r\n        };\r\n        var findTextPosition = function (container, offset) {\r\n            var node = container, targetOffset = 0, dataLen;\r\n            while (isText$5(node)) {\r\n                dataLen = node.data.length;\r\n                if (offset >= targetOffset && offset <= targetOffset + dataLen) {\r\n                    container = node;\r\n                    offset = offset - targetOffset;\r\n                    break;\r\n                }\r\n                if (!isText$5(node.nextSibling)) {\r\n                    container = node;\r\n                    offset = dataLen;\r\n                    break;\r\n                }\r\n                targetOffset += dataLen;\r\n                node = node.nextSibling;\r\n            }\r\n            if (isText$5(container) && offset > container.data.length) {\r\n                offset = container.data.length;\r\n            }\r\n            return CaretPosition$1(container, offset);\r\n        };\r\n        var resolve$2 = function (root, path) {\r\n            var parts, container, offset;\r\n            if (!path) {\r\n                return null;\r\n            }\r\n            parts = path.split(',');\r\n            path = parts[0].split('/');\r\n            offset = parts.length > 1 ? parts[1] : 'before';\r\n            container = ArrUtils.reduce(path, function (result, value) {\r\n                value = /([\\w\\-\\(\\)]+)\\[([0-9]+)\\]/.exec(value);\r\n                if (!value) {\r\n                    return null;\r\n                }\r\n                if (value[1] === 'text()') {\r\n                    value[1] = '#text';\r\n                }\r\n                return resolvePathItem(result, value[1], parseInt(value[2], 10));\r\n            }, root);\r\n            if (!container) {\r\n                return null;\r\n            }\r\n            if (!isText$5(container)) {\r\n                if (offset === 'after') {\r\n                    offset = nodeIndex$1(container) + 1;\r\n                }\r\n                else {\r\n                    offset = nodeIndex$1(container);\r\n                }\r\n                return CaretPosition$1(container.parentNode, offset);\r\n            }\r\n            return findTextPosition(container, parseInt(offset, 10));\r\n        };\r\n        var trimEmptyTextNode = function (dom, node) {\r\n            if (NodeType.isText(node) && node.data.length === 0) {\r\n                dom.remove(node);\r\n            }\r\n        };\r\n        var insertNode = function (dom, rng, node) {\r\n            rng.insertNode(node);\r\n            trimEmptyTextNode(dom, node.previousSibling);\r\n            trimEmptyTextNode(dom, node.nextSibling);\r\n        };\r\n        var insertFragment = function (dom, rng, frag) {\r\n            var firstChild = Option.from(frag.firstChild);\r\n            var lastChild = Option.from(frag.lastChild);\r\n            rng.insertNode(frag);\r\n            firstChild.each(function (child) {\r\n                return trimEmptyTextNode(dom, child.previousSibling);\r\n            });\r\n            lastChild.each(function (child) {\r\n                return trimEmptyTextNode(dom, child.nextSibling);\r\n            });\r\n        };\r\n        var rangeInsertNode = function (dom, rng, node) {\r\n            if (NodeType.isDocumentFragment(node)) {\r\n                insertFragment(dom, rng, node);\r\n            }\r\n            else {\r\n                insertNode(dom, rng, node);\r\n            }\r\n        };\r\n        var isContentEditableFalse$2 = NodeType.isContentEditableFalse;\r\n        var getNormalizedTextOffset = function (trim, container, offset) {\r\n            var node, trimmedOffset;\r\n            trimmedOffset = trim(container.data.slice(0, offset)).length;\r\n            for (node = container.previousSibling; node && NodeType.isText(node); node = node.previousSibling) {\r\n                trimmedOffset += trim(node.data).length;\r\n            }\r\n            return trimmedOffset;\r\n        };\r\n        var getPoint = function (dom, trim, normalized, rng, start) {\r\n            var container = rng[start ? 'startContainer' : 'endContainer'];\r\n            var offset = rng[start ? 'startOffset' : 'endOffset'];\r\n            var point = [];\r\n            var childNodes, after = 0;\r\n            var root = dom.getRoot();\r\n            if (NodeType.isText(container)) {\r\n                point.push(normalized ? getNormalizedTextOffset(trim, container, offset) : offset);\r\n            }\r\n            else {\r\n                childNodes = container.childNodes;\r\n                if (offset >= childNodes.length && childNodes.length) {\r\n                    after = 1;\r\n                    offset = Math.max(0, childNodes.length - 1);\r\n                }\r\n                point.push(dom.nodeIndex(childNodes[offset], normalized) + after);\r\n            }\r\n            for (; container && container !== root; container = container.parentNode) {\r\n                point.push(dom.nodeIndex(container, normalized));\r\n            }\r\n            return point;\r\n        };\r\n        var getLocation = function (trim, selection, normalized, rng) {\r\n            var dom = selection.dom, bookmark = {};\r\n            bookmark.start = getPoint(dom, trim, normalized, rng, true);\r\n            if (!selection.isCollapsed()) {\r\n                bookmark.end = getPoint(dom, trim, normalized, rng, false);\r\n            }\r\n            return bookmark;\r\n        };\r\n        var findIndex$2 = function (dom, name, element) {\r\n            var count = 0;\r\n            Tools.each(dom.select(name), function (node) {\r\n                if (node.getAttribute('data-mce-bogus') === 'all') {\r\n                    return;\r\n                }\r\n                if (node === element) {\r\n                    return false;\r\n                }\r\n                count++;\r\n            });\r\n            return count;\r\n        };\r\n        var moveEndPoint = function (rng, start) {\r\n            var container, offset, childNodes;\r\n            var prefix = start ? 'start' : 'end';\r\n            container = rng[prefix + 'Container'];\r\n            offset = rng[prefix + 'Offset'];\r\n            if (NodeType.isElement(container) && container.nodeName === 'TR') {\r\n                childNodes = container.childNodes;\r\n                container = childNodes[Math.min(start ? offset : offset - 1, childNodes.length - 1)];\r\n                if (container) {\r\n                    offset = start ? 0 : container.childNodes.length;\r\n                    rng['set' + (start ? 'Start' : 'End')](container, offset);\r\n                }\r\n            }\r\n        };\r\n        var normalizeTableCellSelection = function (rng) {\r\n            moveEndPoint(rng, true);\r\n            moveEndPoint(rng, false);\r\n            return rng;\r\n        };\r\n        var findSibling = function (node, offset) {\r\n            var sibling;\r\n            if (NodeType.isElement(node)) {\r\n                node = getNode(node, offset);\r\n                if (isContentEditableFalse$2(node)) {\r\n                    return node;\r\n                }\r\n            }\r\n            if (isCaretContainer(node)) {\r\n                if (NodeType.isText(node) && isCaretContainerBlock(node)) {\r\n                    node = node.parentNode;\r\n                }\r\n                sibling = node.previousSibling;\r\n                if (isContentEditableFalse$2(sibling)) {\r\n                    return sibling;\r\n                }\r\n                sibling = node.nextSibling;\r\n                if (isContentEditableFalse$2(sibling)) {\r\n                    return sibling;\r\n                }\r\n            }\r\n        };\r\n        var findAdjacentContentEditableFalseElm = function (rng) {\r\n            return findSibling(rng.startContainer, rng.startOffset) || findSibling(rng.endContainer, rng.endOffset);\r\n        };\r\n        var getOffsetBookmark = function (trim, normalized, selection) {\r\n            var element = selection.getNode();\r\n            var name = element ? element.nodeName : null;\r\n            var rng = selection.getRng();\r\n            if (isContentEditableFalse$2(element) || name === 'IMG') {\r\n                return {\r\n                    name: name,\r\n                    index: findIndex$2(selection.dom, name, element)\r\n                };\r\n            }\r\n            var sibling = findAdjacentContentEditableFalseElm(rng);\r\n            if (sibling) {\r\n                name = sibling.tagName;\r\n                return {\r\n                    name: name,\r\n                    index: findIndex$2(selection.dom, name, sibling)\r\n                };\r\n            }\r\n            return getLocation(trim, selection, normalized, rng);\r\n        };\r\n        var getCaretBookmark = function (selection) {\r\n            var rng = selection.getRng();\r\n            return {\r\n                start: create$2(selection.dom.getRoot(), CaretPosition$1.fromRangeStart(rng)),\r\n                end: create$2(selection.dom.getRoot(), CaretPosition$1.fromRangeEnd(rng))\r\n            };\r\n        };\r\n        var getRangeBookmark = function (selection) {\r\n            return { rng: selection.getRng() };\r\n        };\r\n        var createBookmarkSpan = function (dom, id, filled) {\r\n            var args = {\r\n                'data-mce-type': 'bookmark',\r\n                'id': id,\r\n                'style': 'overflow:hidden;line-height:0px'\r\n            };\r\n            return filled ? dom.create('span', args, '&#xFEFF;') : dom.create('span', args);\r\n        };\r\n        var getPersistentBookmark = function (selection, filled) {\r\n            var dom = selection.dom;\r\n            var rng = selection.getRng();\r\n            var id = dom.uniqueId();\r\n            var collapsed = selection.isCollapsed();\r\n            var element = selection.getNode();\r\n            var name = element.nodeName;\r\n            if (name === 'IMG') {\r\n                return {\r\n                    name: name,\r\n                    index: findIndex$2(dom, name, element)\r\n                };\r\n            }\r\n            var rng2 = normalizeTableCellSelection(rng.cloneRange());\r\n            if (!collapsed) {\r\n                rng2.collapse(false);\r\n                var endBookmarkNode = createBookmarkSpan(dom, id + '_end', filled);\r\n                rangeInsertNode(dom, rng2, endBookmarkNode);\r\n            }\r\n            rng = normalizeTableCellSelection(rng);\r\n            rng.collapse(true);\r\n            var startBookmarkNode = createBookmarkSpan(dom, id + '_start', filled);\r\n            rangeInsertNode(dom, rng, startBookmarkNode);\r\n            selection.moveToBookmark({\r\n                id: id,\r\n                keep: 1\r\n            });\r\n            return { id: id };\r\n        };\r\n        var getBookmark = function (selection, type, normalized) {\r\n            if (type === 2) {\r\n                return getOffsetBookmark(Zwsp.trim, normalized, selection);\r\n            }\r\n            else if (type === 3) {\r\n                return getCaretBookmark(selection);\r\n            }\r\n            else if (type) {\r\n                return getRangeBookmark(selection);\r\n            }\r\n            else {\r\n                return getPersistentBookmark(selection, false);\r\n            }\r\n        };\r\n        var GetBookmark = {\r\n            getBookmark: getBookmark,\r\n            getUndoBookmark: curry(getOffsetBookmark, identity, true),\r\n            getPersistentBookmark: getPersistentBookmark\r\n        };\r\n        var CARET_ID = '_mce_caret';\r\n        var isCaretNode = function (node) {\r\n            return NodeType.isElement(node) && node.id === CARET_ID;\r\n        };\r\n        var getParentCaretContainer = function (body, node) {\r\n            while (node && node !== body) {\r\n                if (node.id === CARET_ID) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var isElement$4 = NodeType.isElement;\r\n        var isText$6 = NodeType.isText;\r\n        var removeNode = function (node) {\r\n            var parentNode = node.parentNode;\r\n            if (parentNode) {\r\n                parentNode.removeChild(node);\r\n            }\r\n        };\r\n        var getNodeValue = function (node) {\r\n            try {\r\n                return node.nodeValue;\r\n            }\r\n            catch (ex) {\r\n                return '';\r\n            }\r\n        };\r\n        var setNodeValue = function (node, text) {\r\n            if (text.length === 0) {\r\n                removeNode(node);\r\n            }\r\n            else {\r\n                node.nodeValue = text;\r\n            }\r\n        };\r\n        var trimCount = function (text) {\r\n            var trimmedText = Zwsp.trim(text);\r\n            return {\r\n                count: text.length - trimmedText.length,\r\n                text: trimmedText\r\n            };\r\n        };\r\n        var removeUnchanged = function (caretContainer, pos) {\r\n            remove$5(caretContainer);\r\n            return pos;\r\n        };\r\n        var removeTextAndReposition = function (caretContainer, pos) {\r\n            var before = trimCount(caretContainer.data.substr(0, pos.offset()));\r\n            var after = trimCount(caretContainer.data.substr(pos.offset()));\r\n            var text = before.text + after.text;\r\n            if (text.length > 0) {\r\n                setNodeValue(caretContainer, text);\r\n                return CaretPosition$1(caretContainer, pos.offset() - before.count);\r\n            }\r\n            else {\r\n                return pos;\r\n            }\r\n        };\r\n        var removeElementAndReposition = function (caretContainer, pos) {\r\n            var parentNode = pos.container();\r\n            var newPosition = indexOf(from$1(parentNode.childNodes), caretContainer).map(function (index) {\r\n                return index < pos.offset() ? CaretPosition$1(parentNode, pos.offset() - 1) : pos;\r\n            }).getOr(pos);\r\n            remove$5(caretContainer);\r\n            return newPosition;\r\n        };\r\n        var removeTextCaretContainer = function (caretContainer, pos) {\r\n            return isText$6(caretContainer) && pos.container() === caretContainer ? removeTextAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\r\n        };\r\n        var removeElementCaretContainer = function (caretContainer, pos) {\r\n            return pos.container() === caretContainer.parentNode ? removeElementAndReposition(caretContainer, pos) : removeUnchanged(caretContainer, pos);\r\n        };\r\n        var removeAndReposition = function (container, pos) {\r\n            return CaretPosition$1.isTextPosition(pos) ? removeTextCaretContainer(container, pos) : removeElementCaretContainer(container, pos);\r\n        };\r\n        var remove$5 = function (caretContainerNode) {\r\n            if (isElement$4(caretContainerNode) && isCaretContainer(caretContainerNode)) {\r\n                if (hasContent(caretContainerNode)) {\r\n                    caretContainerNode.removeAttribute('data-mce-caret');\r\n                }\r\n                else {\r\n                    removeNode(caretContainerNode);\r\n                }\r\n            }\r\n            if (isText$6(caretContainerNode)) {\r\n                var text = Zwsp.trim(getNodeValue(caretContainerNode));\r\n                setNodeValue(caretContainerNode, text);\r\n            }\r\n        };\r\n        var CaretContainerRemove = {\r\n            removeAndReposition: removeAndReposition,\r\n            remove: remove$5\r\n        };\r\n        var browser$2 = PlatformDetection$1.detect().browser;\r\n        var isContentEditableFalse$3 = NodeType.isContentEditableFalse;\r\n        var isTableCell$1 = function (node) {\r\n            return NodeType.isElement(node) && /^(TD|TH)$/i.test(node.tagName);\r\n        };\r\n        var getAbsoluteClientRect = function (root, element, before) {\r\n            var clientRect = collapse(element.getBoundingClientRect(), before);\r\n            var docElm, scrollX, scrollY, margin, rootRect;\r\n            if (root.tagName === 'BODY') {\r\n                docElm = root.ownerDocument.documentElement;\r\n                scrollX = root.scrollLeft || docElm.scrollLeft;\r\n                scrollY = root.scrollTop || docElm.scrollTop;\r\n            }\r\n            else {\r\n                rootRect = root.getBoundingClientRect();\r\n                scrollX = root.scrollLeft - rootRect.left;\r\n                scrollY = root.scrollTop - rootRect.top;\r\n            }\r\n            clientRect.left += scrollX;\r\n            clientRect.right += scrollX;\r\n            clientRect.top += scrollY;\r\n            clientRect.bottom += scrollY;\r\n            clientRect.width = 1;\r\n            margin = element.offsetWidth - element.clientWidth;\r\n            if (margin > 0) {\r\n                if (before) {\r\n                    margin *= -1;\r\n                }\r\n                clientRect.left += margin;\r\n                clientRect.right += margin;\r\n            }\r\n            return clientRect;\r\n        };\r\n        var trimInlineCaretContainers = function (root) {\r\n            var contentEditableFalseNodes, node, sibling, i, data;\r\n            contentEditableFalseNodes = DomQuery('*[contentEditable=false]', root);\r\n            for (i = 0; i < contentEditableFalseNodes.length; i++) {\r\n                node = contentEditableFalseNodes[i];\r\n                sibling = node.previousSibling;\r\n                if (endsWithCaretContainer(sibling)) {\r\n                    data = sibling.data;\r\n                    if (data.length === 1) {\r\n                        sibling.parentNode.removeChild(sibling);\r\n                    }\r\n                    else {\r\n                        sibling.deleteData(data.length - 1, 1);\r\n                    }\r\n                }\r\n                sibling = node.nextSibling;\r\n                if (startsWithCaretContainer(sibling)) {\r\n                    data = sibling.data;\r\n                    if (data.length === 1) {\r\n                        sibling.parentNode.removeChild(sibling);\r\n                    }\r\n                    else {\r\n                        sibling.deleteData(0, 1);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var FakeCaret = function (root, isBlock, hasFocus) {\r\n            var lastVisualCaret = Cell(Option.none());\r\n            var cursorInterval, caretContainerNode;\r\n            var show = function (before, element) {\r\n                var clientRect, rng;\r\n                hide();\r\n                if (isTableCell$1(element)) {\r\n                    return null;\r\n                }\r\n                if (isBlock(element)) {\r\n                    caretContainerNode = insertBlock('p', element, before);\r\n                    clientRect = getAbsoluteClientRect(root, element, before);\r\n                    DomQuery(caretContainerNode).css('top', clientRect.top);\r\n                    var caret = DomQuery('<div class=\"mce-visual-caret\" data-mce-bogus=\"all\"></div>').css(clientRect).appendTo(root)[0];\r\n                    lastVisualCaret.set(Option.some({\r\n                        caret: caret,\r\n                        element: element,\r\n                        before: before\r\n                    }));\r\n                    lastVisualCaret.get().each(function (caretState) {\r\n                        if (before) {\r\n                            DomQuery(caretState.caret).addClass('mce-visual-caret-before');\r\n                        }\r\n                    });\r\n                    startBlink();\r\n                    rng = element.ownerDocument.createRange();\r\n                    rng.setStart(caretContainerNode, 0);\r\n                    rng.setEnd(caretContainerNode, 0);\r\n                }\r\n                else {\r\n                    caretContainerNode = insertInline(element, before);\r\n                    rng = element.ownerDocument.createRange();\r\n                    if (isContentEditableFalse$3(caretContainerNode.nextSibling)) {\r\n                        rng.setStart(caretContainerNode, 0);\r\n                        rng.setEnd(caretContainerNode, 0);\r\n                    }\r\n                    else {\r\n                        rng.setStart(caretContainerNode, 1);\r\n                        rng.setEnd(caretContainerNode, 1);\r\n                    }\r\n                    return rng;\r\n                }\r\n                return rng;\r\n            };\r\n            var hide = function () {\r\n                trimInlineCaretContainers(root);\r\n                if (caretContainerNode) {\r\n                    CaretContainerRemove.remove(caretContainerNode);\r\n                    caretContainerNode = null;\r\n                }\r\n                lastVisualCaret.get().each(function (caretState) {\r\n                    DomQuery(caretState.caret).remove();\r\n                    lastVisualCaret.set(Option.none());\r\n                });\r\n                Delay.clearInterval(cursorInterval);\r\n            };\r\n            var startBlink = function () {\r\n                cursorInterval = Delay.setInterval(function () {\r\n                    if (hasFocus()) {\r\n                        DomQuery('div.mce-visual-caret', root).toggleClass('mce-visual-caret-hidden');\r\n                    }\r\n                    else {\r\n                        DomQuery('div.mce-visual-caret', root).addClass('mce-visual-caret-hidden');\r\n                    }\r\n                }, 500);\r\n            };\r\n            var reposition = function () {\r\n                lastVisualCaret.get().each(function (caretState) {\r\n                    var clientRect = getAbsoluteClientRect(root, caretState.element, caretState.before);\r\n                    DomQuery(caretState.caret).css(__assign({}, clientRect));\r\n                });\r\n            };\r\n            var destroy = function () {\r\n                return Delay.clearInterval(cursorInterval);\r\n            };\r\n            var getCss = function () {\r\n                return '.mce-visual-caret {' + 'position: absolute;' + 'background-color: black;' + 'background-color: currentcolor;' + '}' + '.mce-visual-caret-hidden {' + 'display: none;' + '}' + '*[data-mce-caret] {' + 'position: absolute;' + 'left: -1000px;' + 'right: auto;' + 'top: 0;' + 'margin: 0;' + 'padding: 0;' + '}';\r\n            };\r\n            return {\r\n                show: show,\r\n                hide: hide,\r\n                getCss: getCss,\r\n                reposition: reposition,\r\n                destroy: destroy\r\n            };\r\n        };\r\n        var isFakeCaretTableBrowser = function () {\r\n            return browser$2.isIE() || browser$2.isEdge() || browser$2.isFirefox();\r\n        };\r\n        var isFakeCaretTarget = function (node) {\r\n            return isContentEditableFalse$3(node) || NodeType.isTable(node) && isFakeCaretTableBrowser();\r\n        };\r\n        var isContentEditableFalse$4 = NodeType.isContentEditableFalse;\r\n        var isBlockLike = NodeType.matchStyleValues('display', 'block table table-cell table-caption list-item');\r\n        var isCaretContainer$2 = isCaretContainer;\r\n        var isCaretContainerBlock$1 = isCaretContainerBlock;\r\n        var isElement$5 = NodeType.isElement;\r\n        var isCaretCandidate$2 = isCaretCandidate;\r\n        var isForwards = function (direction) {\r\n            return direction > 0;\r\n        };\r\n        var isBackwards = function (direction) {\r\n            return direction < 0;\r\n        };\r\n        var skipCaretContainers = function (walk, shallow) {\r\n            var node;\r\n            while (node = walk(shallow)) {\r\n                if (!isCaretContainerBlock$1(node)) {\r\n                    return node;\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        var findNode = function (node, direction, predicateFn, rootNode, shallow) {\r\n            var walker = new TreeWalker(node, rootNode);\r\n            if (isBackwards(direction)) {\r\n                if (isContentEditableFalse$4(node) || isCaretContainerBlock$1(node)) {\r\n                    node = skipCaretContainers(walker.prev, true);\r\n                    if (predicateFn(node)) {\r\n                        return node;\r\n                    }\r\n                }\r\n                while (node = skipCaretContainers(walker.prev, shallow)) {\r\n                    if (predicateFn(node)) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n            if (isForwards(direction)) {\r\n                if (isContentEditableFalse$4(node) || isCaretContainerBlock$1(node)) {\r\n                    node = skipCaretContainers(walker.next, true);\r\n                    if (predicateFn(node)) {\r\n                        return node;\r\n                    }\r\n                }\r\n                while (node = skipCaretContainers(walker.next, shallow)) {\r\n                    if (predicateFn(node)) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        var getParentBlock = function (node, rootNode) {\r\n            while (node && node !== rootNode) {\r\n                if (isBlockLike(node)) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var isInSameBlock = function (caretPosition1, caretPosition2, rootNode) {\r\n            return getParentBlock(caretPosition1.container(), rootNode) === getParentBlock(caretPosition2.container(), rootNode);\r\n        };\r\n        var getChildNodeAtRelativeOffset = function (relativeOffset, caretPosition) {\r\n            var container, offset;\r\n            if (!caretPosition) {\r\n                return null;\r\n            }\r\n            container = caretPosition.container();\r\n            offset = caretPosition.offset();\r\n            if (!isElement$5(container)) {\r\n                return null;\r\n            }\r\n            return container.childNodes[offset + relativeOffset];\r\n        };\r\n        var beforeAfter = function (before, node) {\r\n            var range = node.ownerDocument.createRange();\r\n            if (before) {\r\n                range.setStartBefore(node);\r\n                range.setEndBefore(node);\r\n            }\r\n            else {\r\n                range.setStartAfter(node);\r\n                range.setEndAfter(node);\r\n            }\r\n            return range;\r\n        };\r\n        var isNodesInSameBlock = function (root, node1, node2) {\r\n            return getParentBlock(node1, root) === getParentBlock(node2, root);\r\n        };\r\n        var lean = function (left, root, node) {\r\n            var sibling, siblingName;\r\n            if (left) {\r\n                siblingName = 'previousSibling';\r\n            }\r\n            else {\r\n                siblingName = 'nextSibling';\r\n            }\r\n            while (node && node !== root) {\r\n                sibling = node[siblingName];\r\n                if (isCaretContainer$2(sibling)) {\r\n                    sibling = sibling[siblingName];\r\n                }\r\n                if (isContentEditableFalse$4(sibling)) {\r\n                    if (isNodesInSameBlock(root, sibling, node)) {\r\n                        return sibling;\r\n                    }\r\n                    break;\r\n                }\r\n                if (isCaretCandidate$2(sibling)) {\r\n                    break;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var before$2 = curry(beforeAfter, true);\r\n        var after$1 = curry(beforeAfter, false);\r\n        var normalizeRange = function (direction, root, range) {\r\n            var node, container, offset, location;\r\n            var leanLeft = curry(lean, true, root);\r\n            var leanRight = curry(lean, false, root);\r\n            container = range.startContainer;\r\n            offset = range.startOffset;\r\n            if (isCaretContainerBlock(container)) {\r\n                if (!isElement$5(container)) {\r\n                    container = container.parentNode;\r\n                }\r\n                location = container.getAttribute('data-mce-caret');\r\n                if (location === 'before') {\r\n                    node = container.nextSibling;\r\n                    if (isFakeCaretTarget(node)) {\r\n                        return before$2(node);\r\n                    }\r\n                }\r\n                if (location === 'after') {\r\n                    node = container.previousSibling;\r\n                    if (isFakeCaretTarget(node)) {\r\n                        return after$1(node);\r\n                    }\r\n                }\r\n            }\r\n            if (!range.collapsed) {\r\n                return range;\r\n            }\r\n            if (NodeType.isText(container)) {\r\n                if (isCaretContainer$2(container)) {\r\n                    if (direction === 1) {\r\n                        node = leanRight(container);\r\n                        if (node) {\r\n                            return before$2(node);\r\n                        }\r\n                        node = leanLeft(container);\r\n                        if (node) {\r\n                            return after$1(node);\r\n                        }\r\n                    }\r\n                    if (direction === -1) {\r\n                        node = leanLeft(container);\r\n                        if (node) {\r\n                            return after$1(node);\r\n                        }\r\n                        node = leanRight(container);\r\n                        if (node) {\r\n                            return before$2(node);\r\n                        }\r\n                    }\r\n                    return range;\r\n                }\r\n                if (endsWithCaretContainer(container) && offset >= container.data.length - 1) {\r\n                    if (direction === 1) {\r\n                        node = leanRight(container);\r\n                        if (node) {\r\n                            return before$2(node);\r\n                        }\r\n                    }\r\n                    return range;\r\n                }\r\n                if (startsWithCaretContainer(container) && offset <= 1) {\r\n                    if (direction === -1) {\r\n                        node = leanLeft(container);\r\n                        if (node) {\r\n                            return after$1(node);\r\n                        }\r\n                    }\r\n                    return range;\r\n                }\r\n                if (offset === container.data.length) {\r\n                    node = leanRight(container);\r\n                    if (node) {\r\n                        return before$2(node);\r\n                    }\r\n                    return range;\r\n                }\r\n                if (offset === 0) {\r\n                    node = leanLeft(container);\r\n                    if (node) {\r\n                        return after$1(node);\r\n                    }\r\n                    return range;\r\n                }\r\n            }\r\n            return range;\r\n        };\r\n        var getRelativeCefElm = function (forward, caretPosition) {\r\n            return Option.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, caretPosition)).filter(isContentEditableFalse$4);\r\n        };\r\n        var getNormalizedRangeEndPoint = function (direction, root, range) {\r\n            var normalizedRange = normalizeRange(direction, root, range);\r\n            if (direction === -1) {\r\n                return CaretPosition.fromRangeStart(normalizedRange);\r\n            }\r\n            return CaretPosition.fromRangeEnd(normalizedRange);\r\n        };\r\n        var getElementFromPosition = function (pos) {\r\n            return Option.from(pos.getNode()).map(Element.fromDom);\r\n        };\r\n        var getElementFromPrevPosition = function (pos) {\r\n            return Option.from(pos.getNode(true)).map(Element.fromDom);\r\n        };\r\n        var getVisualCaretPosition = function (walkFn, caretPosition) {\r\n            while (caretPosition = walkFn(caretPosition)) {\r\n                if (caretPosition.isVisible()) {\r\n                    return caretPosition;\r\n                }\r\n            }\r\n            return caretPosition;\r\n        };\r\n        var isMoveInsideSameBlock = function (from, to) {\r\n            var inSameBlock = isInSameBlock(from, to);\r\n            if (!inSameBlock && NodeType.isBr(from.getNode())) {\r\n                return true;\r\n            }\r\n            return inSameBlock;\r\n        };\r\n        var HDirection;\r\n        (function (HDirection) {\r\n            HDirection[HDirection['Backwards'] = -1] = 'Backwards';\r\n            HDirection[HDirection['Forwards'] = 1] = 'Forwards';\r\n        }(HDirection || (HDirection = {})));\r\n        var isContentEditableFalse$5 = NodeType.isContentEditableFalse;\r\n        var isText$7 = NodeType.isText;\r\n        var isElement$6 = NodeType.isElement;\r\n        var isBr$4 = NodeType.isBr;\r\n        var isCaretCandidate$3 = isCaretCandidate;\r\n        var isAtomic$1 = isAtomic;\r\n        var isEditableCaretCandidate$1 = isEditableCaretCandidate;\r\n        var getParents = function (node, root) {\r\n            var parents = [];\r\n            while (node && node !== root) {\r\n                parents.push(node);\r\n                node = node.parentNode;\r\n            }\r\n            return parents;\r\n        };\r\n        var nodeAtIndex = function (container, offset) {\r\n            if (container.hasChildNodes() && offset < container.childNodes.length) {\r\n                return container.childNodes[offset];\r\n            }\r\n            return null;\r\n        };\r\n        var getCaretCandidatePosition = function (direction, node) {\r\n            if (isForwards(direction)) {\r\n                if (isCaretCandidate$3(node.previousSibling) && !isText$7(node.previousSibling)) {\r\n                    return CaretPosition$1.before(node);\r\n                }\r\n                if (isText$7(node)) {\r\n                    return CaretPosition$1(node, 0);\r\n                }\r\n            }\r\n            if (isBackwards(direction)) {\r\n                if (isCaretCandidate$3(node.nextSibling) && !isText$7(node.nextSibling)) {\r\n                    return CaretPosition$1.after(node);\r\n                }\r\n                if (isText$7(node)) {\r\n                    return CaretPosition$1(node, node.data.length);\r\n                }\r\n            }\r\n            if (isBackwards(direction)) {\r\n                if (isBr$4(node)) {\r\n                    return CaretPosition$1.before(node);\r\n                }\r\n                return CaretPosition$1.after(node);\r\n            }\r\n            return CaretPosition$1.before(node);\r\n        };\r\n        var moveForwardFromBr = function (root, nextNode) {\r\n            var nextSibling = nextNode.nextSibling;\r\n            if (nextSibling && isCaretCandidate$3(nextSibling)) {\r\n                if (isText$7(nextSibling)) {\r\n                    return CaretPosition$1(nextSibling, 0);\r\n                }\r\n                else {\r\n                    return CaretPosition$1.before(nextSibling);\r\n                }\r\n            }\r\n            else {\r\n                return findCaretPosition(HDirection.Forwards, CaretPosition$1.after(nextNode), root);\r\n            }\r\n        };\r\n        var findCaretPosition = function (direction, startPos, root) {\r\n            var node, nextNode, innerNode;\r\n            var rootContentEditableFalseElm, caretPosition;\r\n            if (!isElement$6(root) || !startPos) {\r\n                return null;\r\n            }\r\n            if (startPos.isEqual(CaretPosition$1.after(root)) && root.lastChild) {\r\n                caretPosition = CaretPosition$1.after(root.lastChild);\r\n                if (isBackwards(direction) && isCaretCandidate$3(root.lastChild) && isElement$6(root.lastChild)) {\r\n                    return isBr$4(root.lastChild) ? CaretPosition$1.before(root.lastChild) : caretPosition;\r\n                }\r\n            }\r\n            else {\r\n                caretPosition = startPos;\r\n            }\r\n            var container = caretPosition.container();\r\n            var offset = caretPosition.offset();\r\n            if (isText$7(container)) {\r\n                if (isBackwards(direction) && offset > 0) {\r\n                    return CaretPosition$1(container, --offset);\r\n                }\r\n                if (isForwards(direction) && offset < container.length) {\r\n                    return CaretPosition$1(container, ++offset);\r\n                }\r\n                node = container;\r\n            }\r\n            else {\r\n                if (isBackwards(direction) && offset > 0) {\r\n                    nextNode = nodeAtIndex(container, offset - 1);\r\n                    if (isCaretCandidate$3(nextNode)) {\r\n                        if (!isAtomic$1(nextNode)) {\r\n                            innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\r\n                            if (innerNode) {\r\n                                if (isText$7(innerNode)) {\r\n                                    return CaretPosition$1(innerNode, innerNode.data.length);\r\n                                }\r\n                                return CaretPosition$1.after(innerNode);\r\n                            }\r\n                        }\r\n                        if (isText$7(nextNode)) {\r\n                            return CaretPosition$1(nextNode, nextNode.data.length);\r\n                        }\r\n                        return CaretPosition$1.before(nextNode);\r\n                    }\r\n                }\r\n                if (isForwards(direction) && offset < container.childNodes.length) {\r\n                    nextNode = nodeAtIndex(container, offset);\r\n                    if (isCaretCandidate$3(nextNode)) {\r\n                        if (isBr$4(nextNode)) {\r\n                            return moveForwardFromBr(root, nextNode);\r\n                        }\r\n                        if (!isAtomic$1(nextNode)) {\r\n                            innerNode = findNode(nextNode, direction, isEditableCaretCandidate$1, nextNode);\r\n                            if (innerNode) {\r\n                                if (isText$7(innerNode)) {\r\n                                    return CaretPosition$1(innerNode, 0);\r\n                                }\r\n                                return CaretPosition$1.before(innerNode);\r\n                            }\r\n                        }\r\n                        if (isText$7(nextNode)) {\r\n                            return CaretPosition$1(nextNode, 0);\r\n                        }\r\n                        return CaretPosition$1.after(nextNode);\r\n                    }\r\n                }\r\n                node = nextNode ? nextNode : caretPosition.getNode();\r\n            }\r\n            if (isForwards(direction) && caretPosition.isAtEnd() || isBackwards(direction) && caretPosition.isAtStart()) {\r\n                node = findNode(node, direction, constant(true), root, true);\r\n                if (isEditableCaretCandidate$1(node, root)) {\r\n                    return getCaretCandidatePosition(direction, node);\r\n                }\r\n            }\r\n            nextNode = findNode(node, direction, isEditableCaretCandidate$1, root);\r\n            rootContentEditableFalseElm = ArrUtils.last(filter(getParents(container, root), isContentEditableFalse$5));\r\n            if (rootContentEditableFalseElm && (!nextNode || !rootContentEditableFalseElm.contains(nextNode))) {\r\n                if (isForwards(direction)) {\r\n                    caretPosition = CaretPosition$1.after(rootContentEditableFalseElm);\r\n                }\r\n                else {\r\n                    caretPosition = CaretPosition$1.before(rootContentEditableFalseElm);\r\n                }\r\n                return caretPosition;\r\n            }\r\n            if (nextNode) {\r\n                return getCaretCandidatePosition(direction, nextNode);\r\n            }\r\n            return null;\r\n        };\r\n        var CaretWalker = function (root) {\r\n            return {\r\n                next: function (caretPosition) {\r\n                    return findCaretPosition(HDirection.Forwards, caretPosition, root);\r\n                },\r\n                prev: function (caretPosition) {\r\n                    return findCaretPosition(HDirection.Backwards, caretPosition, root);\r\n                }\r\n            };\r\n        };\r\n        var walkToPositionIn = function (forward, root, start) {\r\n            var position = forward ? CaretPosition$1.before(start) : CaretPosition$1.after(start);\r\n            return fromPosition(forward, root, position);\r\n        };\r\n        var afterElement = function (node) {\r\n            return NodeType.isBr(node) ? CaretPosition$1.before(node) : CaretPosition$1.after(node);\r\n        };\r\n        var isBeforeOrStart = function (position) {\r\n            if (CaretPosition$1.isTextPosition(position)) {\r\n                return position.offset() === 0;\r\n            }\r\n            else {\r\n                return isCaretCandidate(position.getNode());\r\n            }\r\n        };\r\n        var isAfterOrEnd = function (position) {\r\n            if (CaretPosition$1.isTextPosition(position)) {\r\n                var container = position.container();\r\n                return position.offset() === container.data.length;\r\n            }\r\n            else {\r\n                return isCaretCandidate(position.getNode(true));\r\n            }\r\n        };\r\n        var isBeforeAfterSameElement = function (from, to) {\r\n            return !CaretPosition$1.isTextPosition(from) && !CaretPosition$1.isTextPosition(to) && from.getNode() === to.getNode(true);\r\n        };\r\n        var isAtBr = function (position) {\r\n            return !CaretPosition$1.isTextPosition(position) && NodeType.isBr(position.getNode());\r\n        };\r\n        var shouldSkipPosition = function (forward, from, to) {\r\n            if (forward) {\r\n                return !isBeforeAfterSameElement(from, to) && !isAtBr(from) && isAfterOrEnd(from) && isBeforeOrStart(to);\r\n            }\r\n            else {\r\n                return !isBeforeAfterSameElement(to, from) && isBeforeOrStart(from) && isAfterOrEnd(to);\r\n            }\r\n        };\r\n        var fromPosition = function (forward, root, pos) {\r\n            var walker = CaretWalker(root);\r\n            return Option.from(forward ? walker.next(pos) : walker.prev(pos));\r\n        };\r\n        var navigate = function (forward, root, from) {\r\n            return fromPosition(forward, root, from).bind(function (to) {\r\n                if (isInSameBlock(from, to, root) && shouldSkipPosition(forward, from, to)) {\r\n                    return fromPosition(forward, root, to);\r\n                }\r\n                else {\r\n                    return Option.some(to);\r\n                }\r\n            });\r\n        };\r\n        var navigateIgnore = function (forward, root, from, ignoreFilter) {\r\n            return navigate(forward, root, from).bind(function (pos) {\r\n                return ignoreFilter(pos) ? navigateIgnore(forward, root, pos, ignoreFilter) : Option.some(pos);\r\n            });\r\n        };\r\n        var positionIn = function (forward, element) {\r\n            var startNode = forward ? element.firstChild : element.lastChild;\r\n            if (NodeType.isText(startNode)) {\r\n                return Option.some(CaretPosition$1(startNode, forward ? 0 : startNode.data.length));\r\n            }\r\n            else if (startNode) {\r\n                if (isCaretCandidate(startNode)) {\r\n                    return Option.some(forward ? CaretPosition$1.before(startNode) : afterElement(startNode));\r\n                }\r\n                else {\r\n                    return walkToPositionIn(forward, element, startNode);\r\n                }\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var nextPosition = curry(fromPosition, true);\r\n        var prevPosition = curry(fromPosition, false);\r\n        var CaretFinder = {\r\n            fromPosition: fromPosition,\r\n            nextPosition: nextPosition,\r\n            prevPosition: prevPosition,\r\n            navigate: navigate,\r\n            navigateIgnore: navigateIgnore,\r\n            positionIn: positionIn,\r\n            firstPositionIn: curry(positionIn, true),\r\n            lastPositionIn: curry(positionIn, false)\r\n        };\r\n        var isStringPathBookmark = function (bookmark) {\r\n            return typeof bookmark.start === 'string';\r\n        };\r\n        var isRangeBookmark = function (bookmark) {\r\n            return bookmark.hasOwnProperty('rng');\r\n        };\r\n        var isIdBookmark = function (bookmark) {\r\n            return bookmark.hasOwnProperty('id');\r\n        };\r\n        var isIndexBookmark = function (bookmark) {\r\n            return bookmark.hasOwnProperty('name');\r\n        };\r\n        var isPathBookmark = function (bookmark) {\r\n            return Tools.isArray(bookmark.start);\r\n        };\r\n        var addBogus = function (dom, node) {\r\n            if (dom.isBlock(node) && !node.innerHTML && !Env.ie) {\r\n                node.innerHTML = '<br data-mce-bogus=\"1\" />';\r\n            }\r\n            return node;\r\n        };\r\n        var resolveCaretPositionBookmark = function (dom, bookmark) {\r\n            var rng, pos;\r\n            rng = dom.createRng();\r\n            pos = resolve$2(dom.getRoot(), bookmark.start);\r\n            rng.setStart(pos.container(), pos.offset());\r\n            pos = resolve$2(dom.getRoot(), bookmark.end);\r\n            rng.setEnd(pos.container(), pos.offset());\r\n            return rng;\r\n        };\r\n        var insertZwsp = function (node, rng) {\r\n            var textNode = node.ownerDocument.createTextNode(Zwsp.ZWSP);\r\n            node.appendChild(textNode);\r\n            rng.setStart(textNode, 0);\r\n            rng.setEnd(textNode, 0);\r\n        };\r\n        var isEmpty = function (node) {\r\n            return node.hasChildNodes() === false;\r\n        };\r\n        var tryFindRangePosition = function (node, rng) {\r\n            return CaretFinder.lastPositionIn(node).fold(function () {\r\n                return false;\r\n            }, function (pos) {\r\n                rng.setStart(pos.container(), pos.offset());\r\n                rng.setEnd(pos.container(), pos.offset());\r\n                return true;\r\n            });\r\n        };\r\n        var padEmptyCaretContainer = function (root, node, rng) {\r\n            if (isEmpty(node) && getParentCaretContainer(root, node)) {\r\n                insertZwsp(node, rng);\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var setEndPoint = function (dom, start, bookmark, rng) {\r\n            var point = bookmark[start ? 'start' : 'end'];\r\n            var i, node, offset, children;\r\n            var root = dom.getRoot();\r\n            if (point) {\r\n                offset = point[0];\r\n                for (node = root, i = point.length - 1; i >= 1; i--) {\r\n                    children = node.childNodes;\r\n                    if (padEmptyCaretContainer(root, node, rng)) {\r\n                        return true;\r\n                    }\r\n                    if (point[i] > children.length - 1) {\r\n                        if (padEmptyCaretContainer(root, node, rng)) {\r\n                            return true;\r\n                        }\r\n                        return tryFindRangePosition(node, rng);\r\n                    }\r\n                    node = children[point[i]];\r\n                }\r\n                if (node.nodeType === 3) {\r\n                    offset = Math.min(point[0], node.nodeValue.length);\r\n                }\r\n                if (node.nodeType === 1) {\r\n                    offset = Math.min(point[0], node.childNodes.length);\r\n                }\r\n                if (start) {\r\n                    rng.setStart(node, offset);\r\n                }\r\n                else {\r\n                    rng.setEnd(node, offset);\r\n                }\r\n            }\r\n            return true;\r\n        };\r\n        var isValidTextNode = function (node) {\r\n            return NodeType.isText(node) && node.data.length > 0;\r\n        };\r\n        var restoreEndPoint = function (dom, suffix, bookmark) {\r\n            var marker = dom.get(bookmark.id + '_' + suffix), node, idx, next, prev;\r\n            var keep = bookmark.keep;\r\n            var container, offset;\r\n            if (marker) {\r\n                node = marker.parentNode;\r\n                if (suffix === 'start') {\r\n                    if (!keep) {\r\n                        idx = dom.nodeIndex(marker);\r\n                    }\r\n                    else {\r\n                        if (marker.hasChildNodes()) {\r\n                            node = marker.firstChild;\r\n                            idx = 1;\r\n                        }\r\n                        else if (isValidTextNode(marker.nextSibling)) {\r\n                            node = marker.nextSibling;\r\n                            idx = 0;\r\n                        }\r\n                        else if (isValidTextNode(marker.previousSibling)) {\r\n                            node = marker.previousSibling;\r\n                            idx = marker.previousSibling.data.length;\r\n                        }\r\n                        else {\r\n                            node = marker.parentNode;\r\n                            idx = dom.nodeIndex(marker) + 1;\r\n                        }\r\n                    }\r\n                    container = node;\r\n                    offset = idx;\r\n                }\r\n                else {\r\n                    if (!keep) {\r\n                        idx = dom.nodeIndex(marker);\r\n                    }\r\n                    else {\r\n                        if (marker.hasChildNodes()) {\r\n                            node = marker.firstChild;\r\n                            idx = 1;\r\n                        }\r\n                        else if (isValidTextNode(marker.previousSibling)) {\r\n                            node = marker.previousSibling;\r\n                            idx = marker.previousSibling.data.length;\r\n                        }\r\n                        else {\r\n                            node = marker.parentNode;\r\n                            idx = dom.nodeIndex(marker);\r\n                        }\r\n                    }\r\n                    container = node;\r\n                    offset = idx;\r\n                }\r\n                if (!keep) {\r\n                    prev = marker.previousSibling;\r\n                    next = marker.nextSibling;\r\n                    Tools.each(Tools.grep(marker.childNodes), function (node) {\r\n                        if (NodeType.isText(node)) {\r\n                            node.nodeValue = node.nodeValue.replace(/\\uFEFF/g, '');\r\n                        }\r\n                    });\r\n                    while (marker = dom.get(bookmark.id + '_' + suffix)) {\r\n                        dom.remove(marker, true);\r\n                    }\r\n                    if (prev && next && prev.nodeType === next.nodeType && NodeType.isText(prev) && !Env.opera) {\r\n                        idx = prev.nodeValue.length;\r\n                        prev.appendData(next.nodeValue);\r\n                        dom.remove(next);\r\n                        if (suffix === 'start') {\r\n                            container = prev;\r\n                            offset = idx;\r\n                        }\r\n                        else {\r\n                            container = prev;\r\n                            offset = idx;\r\n                        }\r\n                    }\r\n                }\r\n                return Option.some(CaretPosition$1(container, offset));\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var alt = function (o1, o2) {\r\n            return o1.isSome() ? o1 : o2;\r\n        };\r\n        var resolvePaths = function (dom, bookmark) {\r\n            var rng = dom.createRng();\r\n            if (setEndPoint(dom, true, bookmark, rng) && setEndPoint(dom, false, bookmark, rng)) {\r\n                return Option.some(rng);\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var resolveId = function (dom, bookmark) {\r\n            var startPos = restoreEndPoint(dom, 'start', bookmark);\r\n            var endPos = restoreEndPoint(dom, 'end', bookmark);\r\n            return liftN([\r\n                startPos,\r\n                alt(endPos, startPos)\r\n            ], function (spos, epos) {\r\n                var rng = dom.createRng();\r\n                rng.setStart(addBogus(dom, spos.container()), spos.offset());\r\n                rng.setEnd(addBogus(dom, epos.container()), epos.offset());\r\n                return rng;\r\n            });\r\n        };\r\n        var resolveIndex$1 = function (dom, bookmark) {\r\n            return Option.from(dom.select(bookmark.name)[bookmark.index]).map(function (elm) {\r\n                var rng = dom.createRng();\r\n                rng.selectNode(elm);\r\n                return rng;\r\n            });\r\n        };\r\n        var resolve$3 = function (selection, bookmark) {\r\n            var dom = selection.dom;\r\n            if (bookmark) {\r\n                if (isPathBookmark(bookmark)) {\r\n                    return resolvePaths(dom, bookmark);\r\n                }\r\n                else if (isStringPathBookmark(bookmark)) {\r\n                    return Option.some(resolveCaretPositionBookmark(dom, bookmark));\r\n                }\r\n                else if (isIdBookmark(bookmark)) {\r\n                    return resolveId(dom, bookmark);\r\n                }\r\n                else if (isIndexBookmark(bookmark)) {\r\n                    return resolveIndex$1(dom, bookmark);\r\n                }\r\n                else if (isRangeBookmark(bookmark)) {\r\n                    return Option.some(bookmark.rng);\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var ResolveBookmark = { resolve: resolve$3 };\r\n        var getBookmark$1 = function (selection, type, normalized) {\r\n            return GetBookmark.getBookmark(selection, type, normalized);\r\n        };\r\n        var moveToBookmark = function (selection, bookmark) {\r\n            ResolveBookmark.resolve(selection, bookmark).each(function (rng) {\r\n                selection.setRng(rng);\r\n            });\r\n        };\r\n        var isBookmarkNode$1 = function (node) {\r\n            return NodeType.isElement(node) && node.tagName === 'SPAN' && node.getAttribute('data-mce-type') === 'bookmark';\r\n        };\r\n        var Bookmarks = {\r\n            getBookmark: getBookmark$1,\r\n            moveToBookmark: moveToBookmark,\r\n            isBookmarkNode: isBookmarkNode$1\r\n        };\r\n        var isInlineBlock = function (node) {\r\n            return node && /^(IMG)$/.test(node.nodeName);\r\n        };\r\n        var moveStart = function (dom, selection, rng) {\r\n            var offset = rng.startOffset;\r\n            var container = rng.startContainer, walker, node, nodes;\r\n            if (rng.startContainer === rng.endContainer) {\r\n                if (isInlineBlock(rng.startContainer.childNodes[rng.startOffset])) {\r\n                    return;\r\n                }\r\n            }\r\n            if (container.nodeType === 1) {\r\n                nodes = container.childNodes;\r\n                if (offset < nodes.length) {\r\n                    container = nodes[offset];\r\n                    walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\r\n                }\r\n                else {\r\n                    container = nodes[nodes.length - 1];\r\n                    walker = new TreeWalker(container, dom.getParent(container, dom.isBlock));\r\n                    walker.next(true);\r\n                }\r\n                for (node = walker.current(); node; node = walker.next()) {\r\n                    if (node.nodeType === 3 && !isWhiteSpaceNode(node)) {\r\n                        rng.setStart(node, 0);\r\n                        selection.setRng(rng);\r\n                        return;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var getNonWhiteSpaceSibling = function (node, next, inc) {\r\n            if (node) {\r\n                next = next ? 'nextSibling' : 'previousSibling';\r\n                for (node = inc ? node : node[next]; node; node = node[next]) {\r\n                    if (node.nodeType === 1 || !isWhiteSpaceNode(node)) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var isTextBlock$1 = function (editor, name) {\r\n            if (name.nodeType) {\r\n                name = name.nodeName;\r\n            }\r\n            return !!editor.schema.getTextBlockElements()[name.toLowerCase()];\r\n        };\r\n        var isValid = function (ed, parent, child) {\r\n            return ed.schema.isValidChild(parent, child);\r\n        };\r\n        var isWhiteSpaceNode = function (node) {\r\n            return node && node.nodeType === 3 && /^([\\t \\r\\n]+|)$/.test(node.nodeValue);\r\n        };\r\n        var replaceVars = function (value, vars) {\r\n            if (typeof value !== 'string') {\r\n                value = value(vars);\r\n            }\r\n            else if (vars) {\r\n                value = value.replace(/%(\\w+)/g, function (str, name) {\r\n                    return vars[name] || str;\r\n                });\r\n            }\r\n            return value;\r\n        };\r\n        var isEq = function (str1, str2) {\r\n            str1 = str1 || '';\r\n            str2 = str2 || '';\r\n            str1 = '' + (str1.nodeName || str1);\r\n            str2 = '' + (str2.nodeName || str2);\r\n            return str1.toLowerCase() === str2.toLowerCase();\r\n        };\r\n        var normalizeStyleValue = function (dom, value, name) {\r\n            if (name === 'color' || name === 'backgroundColor') {\r\n                value = dom.toHex(value);\r\n            }\r\n            if (name === 'fontWeight' && value === 700) {\r\n                value = 'bold';\r\n            }\r\n            if (name === 'fontFamily') {\r\n                value = value.replace(/[\\'\\\"]/g, '').replace(/,\\s+/g, ',');\r\n            }\r\n            return '' + value;\r\n        };\r\n        var getStyle = function (dom, node, name) {\r\n            return normalizeStyleValue(dom, dom.getStyle(node, name), name);\r\n        };\r\n        var getTextDecoration = function (dom, node) {\r\n            var decoration;\r\n            dom.getParent(node, function (n) {\r\n                decoration = dom.getStyle(n, 'text-decoration');\r\n                return decoration && decoration !== 'none';\r\n            });\r\n            return decoration;\r\n        };\r\n        var getParents$1 = function (dom, node, selector) {\r\n            return dom.getParents(node, selector, dom.getRoot());\r\n        };\r\n        var FormatUtils = {\r\n            isInlineBlock: isInlineBlock,\r\n            moveStart: moveStart,\r\n            getNonWhiteSpaceSibling: getNonWhiteSpaceSibling,\r\n            isTextBlock: isTextBlock$1,\r\n            isValid: isValid,\r\n            isWhiteSpaceNode: isWhiteSpaceNode,\r\n            replaceVars: replaceVars,\r\n            isEq: isEq,\r\n            normalizeStyleValue: normalizeStyleValue,\r\n            getStyle: getStyle,\r\n            getTextDecoration: getTextDecoration,\r\n            getParents: getParents$1\r\n        };\r\n        var isBookmarkNode$2 = Bookmarks.isBookmarkNode;\r\n        var getParents$2 = FormatUtils.getParents, isWhiteSpaceNode$1 = FormatUtils.isWhiteSpaceNode, isTextBlock$2 = FormatUtils.isTextBlock;\r\n        var findLeaf = function (node, offset) {\r\n            if (typeof offset === 'undefined') {\r\n                offset = node.nodeType === 3 ? node.length : node.childNodes.length;\r\n            }\r\n            while (node && node.hasChildNodes()) {\r\n                node = node.childNodes[offset];\r\n                if (node) {\r\n                    offset = node.nodeType === 3 ? node.length : node.childNodes.length;\r\n                }\r\n            }\r\n            return {\r\n                node: node,\r\n                offset: offset\r\n            };\r\n        };\r\n        var excludeTrailingWhitespace = function (endContainer, endOffset) {\r\n            var leaf = findLeaf(endContainer, endOffset);\r\n            if (leaf.node) {\r\n                while (leaf.node && leaf.offset === 0 && leaf.node.previousSibling) {\r\n                    leaf = findLeaf(leaf.node.previousSibling);\r\n                }\r\n                if (leaf.node && leaf.offset > 0 && leaf.node.nodeType === 3 && leaf.node.nodeValue.charAt(leaf.offset - 1) === ' ') {\r\n                    if (leaf.offset > 1) {\r\n                        endContainer = leaf.node;\r\n                        endContainer.splitText(leaf.offset - 1);\r\n                    }\r\n                }\r\n            }\r\n            return endContainer;\r\n        };\r\n        var isBogusBr = function (node) {\r\n            return node.nodeName === 'BR' && node.getAttribute('data-mce-bogus') && !node.nextSibling;\r\n        };\r\n        var findParentContentEditable = function (dom, node) {\r\n            var parent = node;\r\n            while (parent) {\r\n                if (parent.nodeType === 1 && dom.getContentEditable(parent)) {\r\n                    return dom.getContentEditable(parent) === 'false' ? parent : node;\r\n                }\r\n                parent = parent.parentNode;\r\n            }\r\n            return node;\r\n        };\r\n        var findSpace = function (start, remove, node, offset) {\r\n            var pos, pos2;\r\n            var str = node.nodeValue;\r\n            if (typeof offset === 'undefined') {\r\n                offset = start ? str.length : 0;\r\n            }\r\n            if (start) {\r\n                pos = str.lastIndexOf(' ', offset);\r\n                pos2 = str.lastIndexOf('\\xA0', offset);\r\n                pos = pos > pos2 ? pos : pos2;\r\n                if (pos !== -1 && !remove && (pos < offset || !start) && pos <= str.length) {\r\n                    pos++;\r\n                }\r\n            }\r\n            else {\r\n                pos = str.indexOf(' ', offset);\r\n                pos2 = str.indexOf('\\xA0', offset);\r\n                pos = pos !== -1 && (pos2 === -1 || pos < pos2) ? pos : pos2;\r\n            }\r\n            return pos;\r\n        };\r\n        var findWordEndPoint = function (dom, body, container, offset, start, remove) {\r\n            var node, pos, lastTextNode;\r\n            if (container.nodeType === 3) {\r\n                pos = findSpace(start, remove, container, offset);\r\n                if (pos !== -1) {\r\n                    return {\r\n                        container: container,\r\n                        offset: pos\r\n                    };\r\n                }\r\n                lastTextNode = container;\r\n            }\r\n            var walker = new TreeWalker(container, dom.getParent(container, dom.isBlock) || body);\r\n            while (node = walker[start ? 'prev' : 'next']()) {\r\n                if (node.nodeType === 3 && !isBookmarkNode$2(node.parentNode)) {\r\n                    lastTextNode = node;\r\n                    pos = findSpace(start, remove, node);\r\n                    if (pos !== -1) {\r\n                        return {\r\n                            container: node,\r\n                            offset: pos\r\n                        };\r\n                    }\r\n                }\r\n                else if (dom.isBlock(node) || FormatUtils.isEq(node, 'BR')) {\r\n                    break;\r\n                }\r\n            }\r\n            if (lastTextNode) {\r\n                if (start) {\r\n                    offset = 0;\r\n                }\r\n                else {\r\n                    offset = lastTextNode.length;\r\n                }\r\n                return {\r\n                    container: lastTextNode,\r\n                    offset: offset\r\n                };\r\n            }\r\n        };\r\n        var findSelectorEndPoint = function (dom, format, rng, container, siblingName) {\r\n            var parents, i, y, curFormat;\r\n            if (container.nodeType === 3 && container.nodeValue.length === 0 && container[siblingName]) {\r\n                container = container[siblingName];\r\n            }\r\n            parents = getParents$2(dom, container);\r\n            for (i = 0; i < parents.length; i++) {\r\n                for (y = 0; y < format.length; y++) {\r\n                    curFormat = format[y];\r\n                    if ('collapsed' in curFormat && curFormat.collapsed !== rng.collapsed) {\r\n                        continue;\r\n                    }\r\n                    if (dom.is(parents[i], curFormat.selector)) {\r\n                        return parents[i];\r\n                    }\r\n                }\r\n            }\r\n            return container;\r\n        };\r\n        var findBlockEndPoint = function (editor, format, container, siblingName) {\r\n            var node;\r\n            var dom = editor.dom;\r\n            var root = dom.getRoot();\r\n            if (!format[0].wrapper) {\r\n                node = dom.getParent(container, format[0].block, root);\r\n            }\r\n            if (!node) {\r\n                var scopeRoot = dom.getParent(container, 'LI,TD,TH');\r\n                node = dom.getParent(container.nodeType === 3 ? container.parentNode : container, function (node) {\r\n                    return node !== root && isTextBlock$2(editor, node);\r\n                }, scopeRoot);\r\n            }\r\n            if (node && format[0].wrapper) {\r\n                node = getParents$2(dom, node, 'ul,ol').reverse()[0] || node;\r\n            }\r\n            if (!node) {\r\n                node = container;\r\n                while (node[siblingName] && !dom.isBlock(node[siblingName])) {\r\n                    node = node[siblingName];\r\n                    if (FormatUtils.isEq(node, 'br')) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            return node || container;\r\n        };\r\n        var findParentContainer = function (dom, format, startContainer, startOffset, endContainer, endOffset, start) {\r\n            var container, parent, sibling, siblingName, root;\r\n            container = parent = start ? startContainer : endContainer;\r\n            siblingName = start ? 'previousSibling' : 'nextSibling';\r\n            root = dom.getRoot();\r\n            if (container.nodeType === 3 && !isWhiteSpaceNode$1(container)) {\r\n                if (start ? startOffset > 0 : endOffset < container.nodeValue.length) {\r\n                    return container;\r\n                }\r\n            }\r\n            while (true) {\r\n                if (!format[0].block_expand && dom.isBlock(parent)) {\r\n                    return parent;\r\n                }\r\n                for (sibling = parent[siblingName]; sibling; sibling = sibling[siblingName]) {\r\n                    if (!isBookmarkNode$2(sibling) && !isWhiteSpaceNode$1(sibling) && !isBogusBr(sibling)) {\r\n                        return parent;\r\n                    }\r\n                }\r\n                if (parent === root || parent.parentNode === root) {\r\n                    container = parent;\r\n                    break;\r\n                }\r\n                parent = parent.parentNode;\r\n            }\r\n            return container;\r\n        };\r\n        var expandRng = function (editor, rng, format, remove) {\r\n            var endPoint, startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\r\n            var dom = editor.dom;\r\n            if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\r\n                startContainer = getNode(startContainer, startOffset);\r\n                if (startContainer.nodeType === 3) {\r\n                    startOffset = 0;\r\n                }\r\n            }\r\n            if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\r\n                endContainer = getNode(endContainer, rng.collapsed ? endOffset : endOffset - 1);\r\n                if (endContainer.nodeType === 3) {\r\n                    endOffset = endContainer.nodeValue.length;\r\n                }\r\n            }\r\n            startContainer = findParentContentEditable(dom, startContainer);\r\n            endContainer = findParentContentEditable(dom, endContainer);\r\n            if (isBookmarkNode$2(startContainer.parentNode) || isBookmarkNode$2(startContainer)) {\r\n                startContainer = isBookmarkNode$2(startContainer) ? startContainer : startContainer.parentNode;\r\n                if (rng.collapsed) {\r\n                    startContainer = startContainer.previousSibling || startContainer;\r\n                }\r\n                else {\r\n                    startContainer = startContainer.nextSibling || startContainer;\r\n                }\r\n                if (startContainer.nodeType === 3) {\r\n                    startOffset = rng.collapsed ? startContainer.length : 0;\r\n                }\r\n            }\r\n            if (isBookmarkNode$2(endContainer.parentNode) || isBookmarkNode$2(endContainer)) {\r\n                endContainer = isBookmarkNode$2(endContainer) ? endContainer : endContainer.parentNode;\r\n                if (rng.collapsed) {\r\n                    endContainer = endContainer.nextSibling || endContainer;\r\n                }\r\n                else {\r\n                    endContainer = endContainer.previousSibling || endContainer;\r\n                }\r\n                if (endContainer.nodeType === 3) {\r\n                    endOffset = rng.collapsed ? 0 : endContainer.length;\r\n                }\r\n            }\r\n            if (rng.collapsed) {\r\n                endPoint = findWordEndPoint(dom, editor.getBody(), startContainer, startOffset, true, remove);\r\n                if (endPoint) {\r\n                    startContainer = endPoint.container;\r\n                    startOffset = endPoint.offset;\r\n                }\r\n                endPoint = findWordEndPoint(dom, editor.getBody(), endContainer, endOffset, false, remove);\r\n                if (endPoint) {\r\n                    endContainer = endPoint.container;\r\n                    endOffset = endPoint.offset;\r\n                }\r\n            }\r\n            if (format[0].inline) {\r\n                endContainer = remove ? endContainer : excludeTrailingWhitespace(endContainer, endOffset);\r\n            }\r\n            if (format[0].inline || format[0].block_expand) {\r\n                if (!format[0].inline || (startContainer.nodeType !== 3 || startOffset === 0)) {\r\n                    startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\r\n                }\r\n                if (!format[0].inline || (endContainer.nodeType !== 3 || endOffset === endContainer.nodeValue.length)) {\r\n                    endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\r\n                }\r\n            }\r\n            if (format[0].selector && format[0].expand !== false && !format[0].inline) {\r\n                startContainer = findSelectorEndPoint(dom, format, rng, startContainer, 'previousSibling');\r\n                endContainer = findSelectorEndPoint(dom, format, rng, endContainer, 'nextSibling');\r\n            }\r\n            if (format[0].block || format[0].selector) {\r\n                startContainer = findBlockEndPoint(editor, format, startContainer, 'previousSibling');\r\n                endContainer = findBlockEndPoint(editor, format, endContainer, 'nextSibling');\r\n                if (format[0].block) {\r\n                    if (!dom.isBlock(startContainer)) {\r\n                        startContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, true);\r\n                    }\r\n                    if (!dom.isBlock(endContainer)) {\r\n                        endContainer = findParentContainer(dom, format, startContainer, startOffset, endContainer, endOffset, false);\r\n                    }\r\n                }\r\n            }\r\n            if (startContainer.nodeType === 1) {\r\n                startOffset = dom.nodeIndex(startContainer);\r\n                startContainer = startContainer.parentNode;\r\n            }\r\n            if (endContainer.nodeType === 1) {\r\n                endOffset = dom.nodeIndex(endContainer) + 1;\r\n                endContainer = endContainer.parentNode;\r\n            }\r\n            return {\r\n                startContainer: startContainer,\r\n                startOffset: startOffset,\r\n                endContainer: endContainer,\r\n                endOffset: endOffset\r\n            };\r\n        };\r\n        var ExpandRange = { expandRng: expandRng };\r\n        var each$8 = Tools.each;\r\n        var getEndChild = function (container, index) {\r\n            var childNodes = container.childNodes;\r\n            index--;\r\n            if (index > childNodes.length - 1) {\r\n                index = childNodes.length - 1;\r\n            }\r\n            else if (index < 0) {\r\n                index = 0;\r\n            }\r\n            return childNodes[index] || container;\r\n        };\r\n        var walk$1 = function (dom, rng, callback) {\r\n            var startContainer = rng.startContainer;\r\n            var startOffset = rng.startOffset;\r\n            var endContainer = rng.endContainer;\r\n            var endOffset = rng.endOffset;\r\n            var ancestor;\r\n            var startPoint;\r\n            var endPoint;\r\n            var node;\r\n            var parent;\r\n            var siblings;\r\n            var nodes;\r\n            nodes = dom.select('td[data-mce-selected],th[data-mce-selected]');\r\n            if (nodes.length > 0) {\r\n                each$8(nodes, function (node) {\r\n                    callback([node]);\r\n                });\r\n                return;\r\n            }\r\n            var exclude = function (nodes) {\r\n                var node;\r\n                node = nodes[0];\r\n                if (node.nodeType === 3 && node === startContainer && startOffset >= node.nodeValue.length) {\r\n                    nodes.splice(0, 1);\r\n                }\r\n                node = nodes[nodes.length - 1];\r\n                if (endOffset === 0 && nodes.length > 0 && node === endContainer && node.nodeType === 3) {\r\n                    nodes.splice(nodes.length - 1, 1);\r\n                }\r\n                return nodes;\r\n            };\r\n            var collectSiblings = function (node, name, endNode) {\r\n                var siblings = [];\r\n                for (; node && node !== endNode; node = node[name]) {\r\n                    siblings.push(node);\r\n                }\r\n                return siblings;\r\n            };\r\n            var findEndPoint = function (node, root) {\r\n                do {\r\n                    if (node.parentNode === root) {\r\n                        return node;\r\n                    }\r\n                    node = node.parentNode;\r\n                } while (node);\r\n            };\r\n            var walkBoundary = function (startNode, endNode, next) {\r\n                var siblingName = next ? 'nextSibling' : 'previousSibling';\r\n                for (node = startNode, parent = node.parentNode; node && node !== endNode; node = parent) {\r\n                    parent = node.parentNode;\r\n                    siblings = collectSiblings(node === startNode ? node : node[siblingName], siblingName);\r\n                    if (siblings.length) {\r\n                        if (!next) {\r\n                            siblings.reverse();\r\n                        }\r\n                        callback(exclude(siblings));\r\n                    }\r\n                }\r\n            };\r\n            if (startContainer.nodeType === 1 && startContainer.hasChildNodes()) {\r\n                startContainer = startContainer.childNodes[startOffset];\r\n            }\r\n            if (endContainer.nodeType === 1 && endContainer.hasChildNodes()) {\r\n                endContainer = getEndChild(endContainer, endOffset);\r\n            }\r\n            if (startContainer === endContainer) {\r\n                return callback(exclude([startContainer]));\r\n            }\r\n            ancestor = dom.findCommonAncestor(startContainer, endContainer);\r\n            for (node = startContainer; node; node = node.parentNode) {\r\n                if (node === endContainer) {\r\n                    return walkBoundary(startContainer, ancestor, true);\r\n                }\r\n                if (node === ancestor) {\r\n                    break;\r\n                }\r\n            }\r\n            for (node = endContainer; node; node = node.parentNode) {\r\n                if (node === startContainer) {\r\n                    return walkBoundary(endContainer, ancestor);\r\n                }\r\n                if (node === ancestor) {\r\n                    break;\r\n                }\r\n            }\r\n            startPoint = findEndPoint(startContainer, ancestor) || startContainer;\r\n            endPoint = findEndPoint(endContainer, ancestor) || endContainer;\r\n            walkBoundary(startContainer, startPoint, true);\r\n            siblings = collectSiblings(startPoint === startContainer ? startPoint : startPoint.nextSibling, 'nextSibling', endPoint === endContainer ? endPoint.nextSibling : endPoint);\r\n            if (siblings.length) {\r\n                callback(exclude(siblings));\r\n            }\r\n            walkBoundary(endContainer, endPoint);\r\n        };\r\n        var RangeWalk = { walk: walk$1 };\r\n        var zeroWidth = function () {\r\n            return '\\uFEFF';\r\n        };\r\n        function NodeValue(is, name) {\r\n            var get = function (element) {\r\n                if (!is(element)) {\r\n                    throw new Error('Can only get ' + name + ' value of a ' + name + ' node');\r\n                }\r\n                return getOption(element).getOr('');\r\n            };\r\n            var getOptionIE10 = function (element) {\r\n                try {\r\n                    return getOptionSafe(element);\r\n                }\r\n                catch (e) {\r\n                    return Option.none();\r\n                }\r\n            };\r\n            var getOptionSafe = function (element) {\r\n                return is(element) ? Option.from(element.dom().nodeValue) : Option.none();\r\n            };\r\n            var browser = PlatformDetection$1.detect().browser;\r\n            var getOption = browser.isIE() && browser.version.major === 10 ? getOptionIE10 : getOptionSafe;\r\n            var set = function (element, value) {\r\n                if (!is(element)) {\r\n                    throw new Error('Can only set raw ' + name + ' value of a ' + name + ' node');\r\n                }\r\n                element.dom().nodeValue = value;\r\n            };\r\n            return {\r\n                get: get,\r\n                getOption: getOption,\r\n                set: set\r\n            };\r\n        }\r\n        var api = NodeValue(isText, 'text');\r\n        var get$5 = function (element) {\r\n            return api.get(element);\r\n        };\r\n        var isZeroWidth = function (elem) {\r\n            return isText(elem) && get$5(elem) === zeroWidth();\r\n        };\r\n        var context = function (editor, elem, wrapName, nodeName) {\r\n            return parent(elem).fold(function () {\r\n                return 'skipping';\r\n            }, function (parent) {\r\n                if (nodeName === 'br' || isZeroWidth(elem)) {\r\n                    return 'valid';\r\n                }\r\n                else if (isAnnotation(elem)) {\r\n                    return 'existing';\r\n                }\r\n                else if (isCaretNode(elem)) {\r\n                    return 'caret';\r\n                }\r\n                else if (!FormatUtils.isValid(editor, wrapName, nodeName) || !FormatUtils.isValid(editor, name(parent), wrapName)) {\r\n                    return 'invalid-child';\r\n                }\r\n                else {\r\n                    return 'valid';\r\n                }\r\n            });\r\n        };\r\n        var shouldApplyToTrailingSpaces = function (rng) {\r\n            return rng.startContainer.nodeType === 3 && rng.startContainer.nodeValue.length >= rng.startOffset && rng.startContainer.nodeValue[rng.startOffset] === '\\xA0';\r\n        };\r\n        var applyWordGrab = function (editor, rng) {\r\n            var r = ExpandRange.expandRng(editor, rng, [{ inline: true }], shouldApplyToTrailingSpaces(rng));\r\n            rng.setStart(r.startContainer, r.startOffset);\r\n            rng.setEnd(r.endContainer, r.endOffset);\r\n            editor.selection.setRng(rng);\r\n        };\r\n        var makeAnnotation = function (eDoc, _a, annotationName, decorate) {\r\n            var _b = _a.uid, uid = _b === void 0 ? generate('mce-annotation') : _b, data = __rest(_a, ['uid']);\r\n            var master = Element.fromTag('span', eDoc);\r\n            add$3(master, annotation());\r\n            set(master, '' + dataAnnotationId(), uid);\r\n            set(master, '' + dataAnnotation(), annotationName);\r\n            var _c = decorate(uid, data), _d = _c.attributes, attributes = _d === void 0 ? {} : _d, _e = _c.classes, classes = _e === void 0 ? [] : _e;\r\n            setAll(master, attributes);\r\n            add$4(master, classes);\r\n            return master;\r\n        };\r\n        var annotate = function (editor, rng, annotationName, decorate, data) {\r\n            var newWrappers = [];\r\n            var master = makeAnnotation(editor.getDoc(), data, annotationName, decorate);\r\n            var wrapper = Cell(Option.none());\r\n            var finishWrapper = function () {\r\n                wrapper.set(Option.none());\r\n            };\r\n            var getOrOpenWrapper = function () {\r\n                return wrapper.get().getOrThunk(function () {\r\n                    var nu = shallow(master);\r\n                    newWrappers.push(nu);\r\n                    wrapper.set(Option.some(nu));\r\n                    return nu;\r\n                });\r\n            };\r\n            var processElements = function (elems) {\r\n                each(elems, processElement);\r\n            };\r\n            var processElement = function (elem) {\r\n                var ctx = context(editor, elem, 'span', name(elem));\r\n                switch (ctx) {\r\n                    case 'invalid-child': {\r\n                        finishWrapper();\r\n                        var children$1 = children(elem);\r\n                        processElements(children$1);\r\n                        finishWrapper();\r\n                        break;\r\n                    }\r\n                    case 'valid': {\r\n                        var w = getOrOpenWrapper();\r\n                        wrap$1(elem, w);\r\n                        break;\r\n                    }\r\n                    case 'skipping':\r\n                    case 'existing':\r\n                    case 'caret':\r\n                }\r\n            };\r\n            var processNodes = function (nodes) {\r\n                var elems = map(nodes, Element.fromDom);\r\n                processElements(elems);\r\n            };\r\n            RangeWalk.walk(editor.dom, rng, function (nodes) {\r\n                finishWrapper();\r\n                processNodes(nodes);\r\n            });\r\n            return newWrappers;\r\n        };\r\n        var annotateWithBookmark = function (editor, name, settings, data) {\r\n            editor.undoManager.transact(function () {\r\n                var initialRng = editor.selection.getRng();\r\n                if (initialRng.collapsed) {\r\n                    applyWordGrab(editor, initialRng);\r\n                }\r\n                if (editor.selection.getRng().collapsed) {\r\n                    var wrapper = makeAnnotation(editor.getDoc(), data, name, settings.decorate);\r\n                    set$1(wrapper, '\\xA0');\r\n                    editor.selection.getRng().insertNode(wrapper.dom());\r\n                    editor.selection.select(wrapper.dom());\r\n                }\r\n                else {\r\n                    var bookmark = GetBookmark.getPersistentBookmark(editor.selection, false);\r\n                    var rng = editor.selection.getRng();\r\n                    annotate(editor, rng, name, settings.decorate, data);\r\n                    editor.selection.moveToBookmark(bookmark);\r\n                }\r\n            });\r\n        };\r\n        var Annotator = function (editor) {\r\n            var registry = create$1();\r\n            setup$1(editor, registry);\r\n            var changes = setup(editor, registry);\r\n            return {\r\n                register: function (name, settings) {\r\n                    registry.register(name, settings);\r\n                },\r\n                annotate: function (name, data) {\r\n                    registry.lookup(name).each(function (settings) {\r\n                        annotateWithBookmark(editor, name, settings, data);\r\n                    });\r\n                },\r\n                annotationChanged: function (name, callback) {\r\n                    changes.addListener(name, callback);\r\n                },\r\n                remove: function (name) {\r\n                    identify(editor, Option.some(name)).each(function (_a) {\r\n                        var elements = _a.elements;\r\n                        each(elements, unwrap);\r\n                    });\r\n                },\r\n                getAll: function (name) {\r\n                    var directory = findAll(editor, name);\r\n                    return map$2(directory, function (elems) {\r\n                        return map(elems, function (elem) {\r\n                            return elem.dom();\r\n                        });\r\n                    });\r\n                }\r\n            };\r\n        };\r\n        var whiteSpaceRegExp$3 = /^[ \\t\\r\\n]*$/;\r\n        var typeLookup = {\r\n            '#text': 3,\r\n            '#comment': 8,\r\n            '#cdata': 4,\r\n            '#pi': 7,\r\n            '#doctype': 10,\r\n            '#document-fragment': 11\r\n        };\r\n        var walk$2 = function (node, root, prev) {\r\n            var sibling;\r\n            var parent;\r\n            var startName = prev ? 'lastChild' : 'firstChild';\r\n            var siblingName = prev ? 'prev' : 'next';\r\n            if (node[startName]) {\r\n                return node[startName];\r\n            }\r\n            if (node !== root) {\r\n                sibling = node[siblingName];\r\n                if (sibling) {\r\n                    return sibling;\r\n                }\r\n                for (parent = node.parent; parent && parent !== root; parent = parent.parent) {\r\n                    sibling = parent[siblingName];\r\n                    if (sibling) {\r\n                        return sibling;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var Node$1 = function () {\r\n            function Node(name, type) {\r\n                this.name = name;\r\n                this.type = type;\r\n                if (type === 1) {\r\n                    this.attributes = [];\r\n                    this.attributes.map = {};\r\n                }\r\n            }\r\n            Node.create = function (name, attrs) {\r\n                var node, attrName;\r\n                node = new Node(name, typeLookup[name] || 1);\r\n                if (attrs) {\r\n                    for (attrName in attrs) {\r\n                        node.attr(attrName, attrs[attrName]);\r\n                    }\r\n                }\r\n                return node;\r\n            };\r\n            Node.prototype.replace = function (node) {\r\n                var self = this;\r\n                if (node.parent) {\r\n                    node.remove();\r\n                }\r\n                self.insert(node, self);\r\n                self.remove();\r\n                return self;\r\n            };\r\n            Node.prototype.attr = function (name, value) {\r\n                var self = this;\r\n                var attrs, i;\r\n                if (typeof name !== 'string') {\r\n                    for (i in name) {\r\n                        self.attr(i, name[i]);\r\n                    }\r\n                    return self;\r\n                }\r\n                if (attrs = self.attributes) {\r\n                    if (value !== undefined) {\r\n                        if (value === null) {\r\n                            if (name in attrs.map) {\r\n                                delete attrs.map[name];\r\n                                i = attrs.length;\r\n                                while (i--) {\r\n                                    if (attrs[i].name === name) {\r\n                                        attrs = attrs.splice(i, 1);\r\n                                        return self;\r\n                                    }\r\n                                }\r\n                            }\r\n                            return self;\r\n                        }\r\n                        if (name in attrs.map) {\r\n                            i = attrs.length;\r\n                            while (i--) {\r\n                                if (attrs[i].name === name) {\r\n                                    attrs[i].value = value;\r\n                                    break;\r\n                                }\r\n                            }\r\n                        }\r\n                        else {\r\n                            attrs.push({\r\n                                name: name,\r\n                                value: value\r\n                            });\r\n                        }\r\n                        attrs.map[name] = value;\r\n                        return self;\r\n                    }\r\n                    return attrs.map[name];\r\n                }\r\n            };\r\n            Node.prototype.clone = function () {\r\n                var self = this;\r\n                var clone = new Node(self.name, self.type);\r\n                var i, l, selfAttrs, selfAttr, cloneAttrs;\r\n                if (selfAttrs = self.attributes) {\r\n                    cloneAttrs = [];\r\n                    cloneAttrs.map = {};\r\n                    for (i = 0, l = selfAttrs.length; i < l; i++) {\r\n                        selfAttr = selfAttrs[i];\r\n                        if (selfAttr.name !== 'id') {\r\n                            cloneAttrs[cloneAttrs.length] = {\r\n                                name: selfAttr.name,\r\n                                value: selfAttr.value\r\n                            };\r\n                            cloneAttrs.map[selfAttr.name] = selfAttr.value;\r\n                        }\r\n                    }\r\n                    clone.attributes = cloneAttrs;\r\n                }\r\n                clone.value = self.value;\r\n                clone.shortEnded = self.shortEnded;\r\n                return clone;\r\n            };\r\n            Node.prototype.wrap = function (wrapper) {\r\n                var self = this;\r\n                self.parent.insert(wrapper, self);\r\n                wrapper.append(self);\r\n                return self;\r\n            };\r\n            Node.prototype.unwrap = function () {\r\n                var self = this;\r\n                var node, next;\r\n                for (node = self.firstChild; node;) {\r\n                    next = node.next;\r\n                    self.insert(node, self, true);\r\n                    node = next;\r\n                }\r\n                self.remove();\r\n            };\r\n            Node.prototype.remove = function () {\r\n                var self = this, parent = self.parent, next = self.next, prev = self.prev;\r\n                if (parent) {\r\n                    if (parent.firstChild === self) {\r\n                        parent.firstChild = next;\r\n                        if (next) {\r\n                            next.prev = null;\r\n                        }\r\n                    }\r\n                    else {\r\n                        prev.next = next;\r\n                    }\r\n                    if (parent.lastChild === self) {\r\n                        parent.lastChild = prev;\r\n                        if (prev) {\r\n                            prev.next = null;\r\n                        }\r\n                    }\r\n                    else {\r\n                        next.prev = prev;\r\n                    }\r\n                    self.parent = self.next = self.prev = null;\r\n                }\r\n                return self;\r\n            };\r\n            Node.prototype.append = function (node) {\r\n                var self = this;\r\n                var last;\r\n                if (node.parent) {\r\n                    node.remove();\r\n                }\r\n                last = self.lastChild;\r\n                if (last) {\r\n                    last.next = node;\r\n                    node.prev = last;\r\n                    self.lastChild = node;\r\n                }\r\n                else {\r\n                    self.lastChild = self.firstChild = node;\r\n                }\r\n                node.parent = self;\r\n                return node;\r\n            };\r\n            Node.prototype.insert = function (node, refNode, before) {\r\n                var parent;\r\n                if (node.parent) {\r\n                    node.remove();\r\n                }\r\n                parent = refNode.parent || this;\r\n                if (before) {\r\n                    if (refNode === parent.firstChild) {\r\n                        parent.firstChild = node;\r\n                    }\r\n                    else {\r\n                        refNode.prev.next = node;\r\n                    }\r\n                    node.prev = refNode.prev;\r\n                    node.next = refNode;\r\n                    refNode.prev = node;\r\n                }\r\n                else {\r\n                    if (refNode === parent.lastChild) {\r\n                        parent.lastChild = node;\r\n                    }\r\n                    else {\r\n                        refNode.next.prev = node;\r\n                    }\r\n                    node.next = refNode.next;\r\n                    node.prev = refNode;\r\n                    refNode.next = node;\r\n                }\r\n                node.parent = parent;\r\n                return node;\r\n            };\r\n            Node.prototype.getAll = function (name) {\r\n                var self = this;\r\n                var node;\r\n                var collection = [];\r\n                for (node = self.firstChild; node; node = walk$2(node, self)) {\r\n                    if (node.name === name) {\r\n                        collection.push(node);\r\n                    }\r\n                }\r\n                return collection;\r\n            };\r\n            Node.prototype.empty = function () {\r\n                var self = this;\r\n                var nodes, i, node;\r\n                if (self.firstChild) {\r\n                    nodes = [];\r\n                    for (node = self.firstChild; node; node = walk$2(node, self)) {\r\n                        nodes.push(node);\r\n                    }\r\n                    i = nodes.length;\r\n                    while (i--) {\r\n                        node = nodes[i];\r\n                        node.parent = node.firstChild = node.lastChild = node.next = node.prev = null;\r\n                    }\r\n                }\r\n                self.firstChild = self.lastChild = null;\r\n                return self;\r\n            };\r\n            Node.prototype.isEmpty = function (elements, whitespace, predicate) {\r\n                var self = this;\r\n                var node = self.firstChild, i, name;\r\n                whitespace = whitespace || {};\r\n                if (node) {\r\n                    do {\r\n                        if (node.type === 1) {\r\n                            if (node.attr('data-mce-bogus')) {\r\n                                continue;\r\n                            }\r\n                            if (elements[node.name]) {\r\n                                return false;\r\n                            }\r\n                            i = node.attributes.length;\r\n                            while (i--) {\r\n                                name = node.attributes[i].name;\r\n                                if (name === 'name' || name.indexOf('data-mce-bookmark') === 0) {\r\n                                    return false;\r\n                                }\r\n                            }\r\n                        }\r\n                        if (node.type === 8) {\r\n                            return false;\r\n                        }\r\n                        if (node.type === 3 && !whiteSpaceRegExp$3.test(node.value)) {\r\n                            return false;\r\n                        }\r\n                        if (node.type === 3 && node.parent && whitespace[node.parent.name] && whiteSpaceRegExp$3.test(node.value)) {\r\n                            return false;\r\n                        }\r\n                        if (predicate && predicate(node)) {\r\n                            return false;\r\n                        }\r\n                    } while (node = walk$2(node, self));\r\n                }\r\n                return true;\r\n            };\r\n            Node.prototype.walk = function (prev) {\r\n                return walk$2(this, null, prev);\r\n            };\r\n            return Node;\r\n        }();\r\n        var isValidPrefixAttrName = function (name) {\r\n            return name.indexOf('data-') === 0 || name.indexOf('aria-') === 0;\r\n        };\r\n        var trimComments = function (text) {\r\n            return text.replace(/<!--|-->/g, '');\r\n        };\r\n        var isInvalidUri = function (settings, uri) {\r\n            if (settings.allow_html_data_urls) {\r\n                return false;\r\n            }\r\n            else if (/^data:image\\//i.test(uri)) {\r\n                return settings.allow_svg_data_urls === false && /^data:image\\/svg\\+xml/i.test(uri);\r\n            }\r\n            else {\r\n                return /^data:/i.test(uri);\r\n            }\r\n        };\r\n        var findEndTagIndex = function (schema, html, startIndex) {\r\n            var count = 1, index, matches, tokenRegExp, shortEndedElements;\r\n            shortEndedElements = schema.getShortEndedElements();\r\n            tokenRegExp = /<([!?\\/])?([A-Za-z0-9\\-_\\:\\.]+)((?:\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\/|\\s+)>/g;\r\n            tokenRegExp.lastIndex = index = startIndex;\r\n            while (matches = tokenRegExp.exec(html)) {\r\n                index = tokenRegExp.lastIndex;\r\n                if (matches[1] === '/') {\r\n                    count--;\r\n                }\r\n                else if (!matches[1]) {\r\n                    if (matches[2] in shortEndedElements) {\r\n                        continue;\r\n                    }\r\n                    count++;\r\n                }\r\n                if (count === 0) {\r\n                    break;\r\n                }\r\n            }\r\n            return index;\r\n        };\r\n        var checkBogusAttribute = function (regExp, attrString) {\r\n            var matches = regExp.exec(attrString);\r\n            if (matches) {\r\n                var name = matches[1];\r\n                var value = matches[2];\r\n                return typeof name === 'string' && name.toLowerCase() === 'data-mce-bogus' ? value : null;\r\n            }\r\n            else {\r\n                return null;\r\n            }\r\n        };\r\n        function SaxParser(settings, schema) {\r\n            if (schema === void 0) {\r\n                schema = Schema();\r\n            }\r\n            var noop = function () {\r\n            };\r\n            settings = settings || {};\r\n            if (settings.fix_self_closing !== false) {\r\n                settings.fix_self_closing = true;\r\n            }\r\n            var comment = settings.comment ? settings.comment : noop;\r\n            var cdata = settings.cdata ? settings.cdata : noop;\r\n            var text = settings.text ? settings.text : noop;\r\n            var start = settings.start ? settings.start : noop;\r\n            var end = settings.end ? settings.end : noop;\r\n            var pi = settings.pi ? settings.pi : noop;\r\n            var doctype = settings.doctype ? settings.doctype : noop;\r\n            var parse = function (html) {\r\n                var matches, index = 0, value, endRegExp;\r\n                var stack = [];\r\n                var attrList, i, textData, name;\r\n                var isInternalElement, removeInternalElements, shortEndedElements, fillAttrsMap, isShortEnded;\r\n                var validate, elementRule, isValidElement, attr, attribsValue, validAttributesMap, validAttributePatterns;\r\n                var attributesRequired, attributesDefault, attributesForced, processHtml;\r\n                var anyAttributesRequired, selfClosing, tokenRegExp, attrRegExp, specialElements, attrValue, idCount = 0;\r\n                var decode = Entities.decode;\r\n                var fixSelfClosing;\r\n                var filteredUrlAttrs = Tools.makeMap('src,href,data,background,formaction,poster,xlink:href');\r\n                var scriptUriRegExp = /((java|vb)script|mhtml):/i;\r\n                var processEndTag = function (name) {\r\n                    var pos, i;\r\n                    pos = stack.length;\r\n                    while (pos--) {\r\n                        if (stack[pos].name === name) {\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (pos >= 0) {\r\n                        for (i = stack.length - 1; i >= pos; i--) {\r\n                            name = stack[i];\r\n                            if (name.valid) {\r\n                                end(name.name);\r\n                            }\r\n                        }\r\n                        stack.length = pos;\r\n                    }\r\n                };\r\n                var parseAttribute = function (match, name, value, val2, val3) {\r\n                    var attrRule, i;\r\n                    var trimRegExp = /[\\s\\u0000-\\u001F]+/g;\r\n                    name = name.toLowerCase();\r\n                    value = name in fillAttrsMap ? name : decode(value || val2 || val3 || '');\r\n                    if (validate && !isInternalElement && isValidPrefixAttrName(name) === false) {\r\n                        attrRule = validAttributesMap[name];\r\n                        if (!attrRule && validAttributePatterns) {\r\n                            i = validAttributePatterns.length;\r\n                            while (i--) {\r\n                                attrRule = validAttributePatterns[i];\r\n                                if (attrRule.pattern.test(name)) {\r\n                                    break;\r\n                                }\r\n                            }\r\n                            if (i === -1) {\r\n                                attrRule = null;\r\n                            }\r\n                        }\r\n                        if (!attrRule) {\r\n                            return;\r\n                        }\r\n                        if (attrRule.validValues && !(value in attrRule.validValues)) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    if (filteredUrlAttrs[name] && !settings.allow_script_urls) {\r\n                        var uri = value.replace(trimRegExp, '');\r\n                        try {\r\n                            uri = decodeURIComponent(uri);\r\n                        }\r\n                        catch (ex) {\r\n                            uri = unescape(uri);\r\n                        }\r\n                        if (scriptUriRegExp.test(uri)) {\r\n                            return;\r\n                        }\r\n                        if (isInvalidUri(settings, uri)) {\r\n                            return;\r\n                        }\r\n                    }\r\n                    if (isInternalElement && (name in filteredUrlAttrs || name.indexOf('on') === 0)) {\r\n                        return;\r\n                    }\r\n                    attrList.map[name] = value;\r\n                    attrList.push({\r\n                        name: name,\r\n                        value: value\r\n                    });\r\n                };\r\n                tokenRegExp = new RegExp('<(?:' + '(?:!--([\\\\w\\\\W]*?)-->)|' + '(?:!\\\\[CDATA\\\\[([\\\\w\\\\W]*?)\\\\]\\\\]>)|' + '(?:!DOCTYPE([\\\\w\\\\W]*?)>)|' + '(?:\\\\?([^\\\\s\\\\/<>]+) ?([\\\\w\\\\W]*?)[?/]>)|' + '(?:\\\\/([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)>)|' + '(?:([A-Za-z][A-Za-z0-9\\\\-_\\\\:\\\\.]*)((?:\\\\s+[^\"\\'>]+(?:(?:\"[^\"]*\")|(?:\\'[^\\']*\\')|[^>]*))*|\\\\/|\\\\s+)>)' + ')', 'g');\r\n                attrRegExp = /([\\w:\\-]+)(?:\\s*=\\s*(?:(?:\\\"((?:[^\\\"])*)\\\")|(?:\\'((?:[^\\'])*)\\')|([^>\\s]+)))?/g;\r\n                shortEndedElements = schema.getShortEndedElements();\r\n                selfClosing = settings.self_closing_elements || schema.getSelfClosingElements();\r\n                fillAttrsMap = schema.getBoolAttrs();\r\n                validate = settings.validate;\r\n                removeInternalElements = settings.remove_internals;\r\n                fixSelfClosing = settings.fix_self_closing;\r\n                specialElements = schema.getSpecialElements();\r\n                processHtml = html + '>';\r\n                while (matches = tokenRegExp.exec(processHtml)) {\r\n                    if (index < matches.index) {\r\n                        text(decode(html.substr(index, matches.index - index)));\r\n                    }\r\n                    if (value = matches[6]) {\r\n                        value = value.toLowerCase();\r\n                        if (value.charAt(0) === ':') {\r\n                            value = value.substr(1);\r\n                        }\r\n                        processEndTag(value);\r\n                    }\r\n                    else if (value = matches[7]) {\r\n                        if (matches.index + matches[0].length > html.length) {\r\n                            text(decode(html.substr(matches.index)));\r\n                            index = matches.index + matches[0].length;\r\n                            continue;\r\n                        }\r\n                        value = value.toLowerCase();\r\n                        if (value.charAt(0) === ':') {\r\n                            value = value.substr(1);\r\n                        }\r\n                        isShortEnded = value in shortEndedElements;\r\n                        if (fixSelfClosing && selfClosing[value] && stack.length > 0 && stack[stack.length - 1].name === value) {\r\n                            processEndTag(value);\r\n                        }\r\n                        var bogusValue = checkBogusAttribute(attrRegExp, matches[8]);\r\n                        if (bogusValue !== null) {\r\n                            if (bogusValue === 'all') {\r\n                                index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\r\n                                tokenRegExp.lastIndex = index;\r\n                                continue;\r\n                            }\r\n                            isValidElement = false;\r\n                        }\r\n                        if (!validate || (elementRule = schema.getElementRule(value))) {\r\n                            isValidElement = true;\r\n                            if (validate) {\r\n                                validAttributesMap = elementRule.attributes;\r\n                                validAttributePatterns = elementRule.attributePatterns;\r\n                            }\r\n                            if (attribsValue = matches[8]) {\r\n                                isInternalElement = attribsValue.indexOf('data-mce-type') !== -1;\r\n                                if (isInternalElement && removeInternalElements) {\r\n                                    isValidElement = false;\r\n                                }\r\n                                attrList = [];\r\n                                attrList.map = {};\r\n                                attribsValue.replace(attrRegExp, parseAttribute);\r\n                            }\r\n                            else {\r\n                                attrList = [];\r\n                                attrList.map = {};\r\n                            }\r\n                            if (validate && !isInternalElement) {\r\n                                attributesRequired = elementRule.attributesRequired;\r\n                                attributesDefault = elementRule.attributesDefault;\r\n                                attributesForced = elementRule.attributesForced;\r\n                                anyAttributesRequired = elementRule.removeEmptyAttrs;\r\n                                if (anyAttributesRequired && !attrList.length) {\r\n                                    isValidElement = false;\r\n                                }\r\n                                if (attributesForced) {\r\n                                    i = attributesForced.length;\r\n                                    while (i--) {\r\n                                        attr = attributesForced[i];\r\n                                        name = attr.name;\r\n                                        attrValue = attr.value;\r\n                                        if (attrValue === '{$uid}') {\r\n                                            attrValue = 'mce_' + idCount++;\r\n                                        }\r\n                                        attrList.map[name] = attrValue;\r\n                                        attrList.push({\r\n                                            name: name,\r\n                                            value: attrValue\r\n                                        });\r\n                                    }\r\n                                }\r\n                                if (attributesDefault) {\r\n                                    i = attributesDefault.length;\r\n                                    while (i--) {\r\n                                        attr = attributesDefault[i];\r\n                                        name = attr.name;\r\n                                        if (!(name in attrList.map)) {\r\n                                            attrValue = attr.value;\r\n                                            if (attrValue === '{$uid}') {\r\n                                                attrValue = 'mce_' + idCount++;\r\n                                            }\r\n                                            attrList.map[name] = attrValue;\r\n                                            attrList.push({\r\n                                                name: name,\r\n                                                value: attrValue\r\n                                            });\r\n                                        }\r\n                                    }\r\n                                }\r\n                                if (attributesRequired) {\r\n                                    i = attributesRequired.length;\r\n                                    while (i--) {\r\n                                        if (attributesRequired[i] in attrList.map) {\r\n                                            break;\r\n                                        }\r\n                                    }\r\n                                    if (i === -1) {\r\n                                        isValidElement = false;\r\n                                    }\r\n                                }\r\n                                if (attr = attrList.map['data-mce-bogus']) {\r\n                                    if (attr === 'all') {\r\n                                        index = findEndTagIndex(schema, html, tokenRegExp.lastIndex);\r\n                                        tokenRegExp.lastIndex = index;\r\n                                        continue;\r\n                                    }\r\n                                    isValidElement = false;\r\n                                }\r\n                            }\r\n                            if (isValidElement) {\r\n                                start(value, attrList, isShortEnded);\r\n                            }\r\n                        }\r\n                        else {\r\n                            isValidElement = false;\r\n                        }\r\n                        if (endRegExp = specialElements[value]) {\r\n                            endRegExp.lastIndex = index = matches.index + matches[0].length;\r\n                            if (matches = endRegExp.exec(html)) {\r\n                                if (isValidElement) {\r\n                                    textData = html.substr(index, matches.index - index);\r\n                                }\r\n                                index = matches.index + matches[0].length;\r\n                            }\r\n                            else {\r\n                                textData = html.substr(index);\r\n                                index = html.length;\r\n                            }\r\n                            if (isValidElement) {\r\n                                if (textData.length > 0) {\r\n                                    text(textData, true);\r\n                                }\r\n                                end(value);\r\n                            }\r\n                            tokenRegExp.lastIndex = index;\r\n                            continue;\r\n                        }\r\n                        if (!isShortEnded) {\r\n                            if (!attribsValue || attribsValue.indexOf('/') !== attribsValue.length - 1) {\r\n                                stack.push({\r\n                                    name: value,\r\n                                    valid: isValidElement\r\n                                });\r\n                            }\r\n                            else if (isValidElement) {\r\n                                end(value);\r\n                            }\r\n                        }\r\n                    }\r\n                    else if (value = matches[1]) {\r\n                        if (value.charAt(0) === '>') {\r\n                            value = ' ' + value;\r\n                        }\r\n                        if (!settings.allow_conditional_comments && value.substr(0, 3).toLowerCase() === '[if') {\r\n                            value = ' ' + value;\r\n                        }\r\n                        comment(value);\r\n                    }\r\n                    else if (value = matches[2]) {\r\n                        cdata(trimComments(value));\r\n                    }\r\n                    else if (value = matches[3]) {\r\n                        doctype(value);\r\n                    }\r\n                    else if (value = matches[4]) {\r\n                        pi(value, matches[5]);\r\n                    }\r\n                    index = matches.index + matches[0].length;\r\n                }\r\n                if (index < html.length) {\r\n                    text(decode(html.substr(index)));\r\n                }\r\n                for (i = stack.length - 1; i >= 0; i--) {\r\n                    value = stack[i];\r\n                    if (value.valid) {\r\n                        end(value.name);\r\n                    }\r\n                }\r\n            };\r\n            return { parse: parse };\r\n        }\r\n        (function (SaxParser) {\r\n            SaxParser.findEndTag = findEndTagIndex;\r\n        }(SaxParser || (SaxParser = {})));\r\n        var SaxParser$1 = SaxParser;\r\n        var trimHtml = function (tempAttrs, html) {\r\n            var trimContentRegExp = new RegExp(['\\\\s?(' + tempAttrs.join('|') + ')=\"[^\"]+\"'].join('|'), 'gi');\r\n            return html.replace(trimContentRegExp, '');\r\n        };\r\n        var trimInternal = function (serializer, html) {\r\n            var content = html;\r\n            var bogusAllRegExp = /<(\\w+) [^>]*data-mce-bogus=\"all\"[^>]*>/g;\r\n            var endTagIndex, index, matchLength, matches, shortEndedElements;\r\n            var schema = serializer.schema;\r\n            content = trimHtml(serializer.getTempAttrs(), content);\r\n            shortEndedElements = schema.getShortEndedElements();\r\n            while (matches = bogusAllRegExp.exec(content)) {\r\n                index = bogusAllRegExp.lastIndex;\r\n                matchLength = matches[0].length;\r\n                if (shortEndedElements[matches[1]]) {\r\n                    endTagIndex = index;\r\n                }\r\n                else {\r\n                    endTagIndex = SaxParser$1.findEndTag(schema, content, index);\r\n                }\r\n                content = content.substring(0, index - matchLength) + content.substring(endTagIndex);\r\n                bogusAllRegExp.lastIndex = index - matchLength;\r\n            }\r\n            return Zwsp.trim(content);\r\n        };\r\n        var trimExternal = trimInternal;\r\n        var TrimHtml = {\r\n            trimExternal: trimExternal,\r\n            trimInternal: trimInternal\r\n        };\r\n        var getBodySetting = function (editor, name, defaultValue) {\r\n            var value = editor.getParam(name, defaultValue);\r\n            if (value.indexOf('=') !== -1) {\r\n                var bodyObj = editor.getParam(name, '', 'hash');\r\n                return bodyObj.hasOwnProperty(editor.id) ? bodyObj[editor.id] : defaultValue;\r\n            }\r\n            else {\r\n                return value;\r\n            }\r\n        };\r\n        var getIframeAttrs = function (editor) {\r\n            return editor.getParam('iframe_attrs', {});\r\n        };\r\n        var getDocType = function (editor) {\r\n            return editor.getParam('doctype', '<!DOCTYPE html>');\r\n        };\r\n        var getDocumentBaseUrl = function (editor) {\r\n            return editor.getParam('document_base_url', '');\r\n        };\r\n        var getBodyId = function (editor) {\r\n            return getBodySetting(editor, 'body_id', 'tinymce');\r\n        };\r\n        var getBodyClass = function (editor) {\r\n            return getBodySetting(editor, 'body_class', '');\r\n        };\r\n        var getContentSecurityPolicy = function (editor) {\r\n            return editor.getParam('content_security_policy', '');\r\n        };\r\n        var shouldPutBrInPre = function (editor) {\r\n            return editor.getParam('br_in_pre', true);\r\n        };\r\n        var getForcedRootBlock = function (editor) {\r\n            if (editor.getParam('force_p_newlines', false)) {\r\n                return 'p';\r\n            }\r\n            var block = editor.getParam('forced_root_block', 'p');\r\n            if (block === false) {\r\n                return '';\r\n            }\r\n            else if (block === true) {\r\n                return 'p';\r\n            }\r\n            else {\r\n                return block;\r\n            }\r\n        };\r\n        var getForcedRootBlockAttrs = function (editor) {\r\n            return editor.getParam('forced_root_block_attrs', {});\r\n        };\r\n        var getBrNewLineSelector = function (editor) {\r\n            return editor.getParam('br_newline_selector', '.mce-toc h2,figcaption,caption');\r\n        };\r\n        var getNoNewLineSelector = function (editor) {\r\n            return editor.getParam('no_newline_selector', '');\r\n        };\r\n        var shouldKeepStyles = function (editor) {\r\n            return editor.getParam('keep_styles', true);\r\n        };\r\n        var shouldEndContainerOnEmptyBlock = function (editor) {\r\n            return editor.getParam('end_container_on_empty_block', false);\r\n        };\r\n        var getFontStyleValues = function (editor) {\r\n            return Tools.explode(editor.getParam('font_size_style_values', 'xx-small,x-small,small,medium,large,x-large,xx-large'));\r\n        };\r\n        var getFontSizeClasses = function (editor) {\r\n            return Tools.explode(editor.getParam('font_size_classes', ''));\r\n        };\r\n        var getImagesDataImgFilter = function (editor) {\r\n            return editor.getParam('images_dataimg_filter', constant(true), 'function');\r\n        };\r\n        var isAutomaticUploadsEnabled = function (editor) {\r\n            return editor.getParam('automatic_uploads', true, 'boolean');\r\n        };\r\n        var shouldReuseFileName = function (editor) {\r\n            return editor.getParam('images_reuse_filename', false, 'boolean');\r\n        };\r\n        var shouldReplaceBlobUris = function (editor) {\r\n            return editor.getParam('images_replace_blob_uris', true, 'boolean');\r\n        };\r\n        var getIconPackName = function (editor) {\r\n            return editor.getParam('icons', '', 'string');\r\n        };\r\n        var getIconsUrl = function (editor) {\r\n            return editor.getParam('icons_url', '', 'string');\r\n        };\r\n        var getImageUploadUrl = function (editor) {\r\n            return editor.getParam('images_upload_url', '', 'string');\r\n        };\r\n        var getImageUploadBasePath = function (editor) {\r\n            return editor.getParam('images_upload_base_path', '', 'string');\r\n        };\r\n        var getImagesUploadCredentials = function (editor) {\r\n            return editor.getParam('images_upload_credentials', false, 'boolean');\r\n        };\r\n        var getImagesUploadHandler = function (editor) {\r\n            return editor.getParam('images_upload_handler', null, 'function');\r\n        };\r\n        var shouldUseContentCssCors = function (editor) {\r\n            return editor.getParam('content_css_cors', false, 'boolean');\r\n        };\r\n        var getLanguageCode = function (editor) {\r\n            return editor.getParam('language', 'en', 'string');\r\n        };\r\n        var getLanguageUrl = function (editor) {\r\n            return editor.getParam('language_url', '', 'string');\r\n        };\r\n        var shouldIndentUseMargin = function (editor) {\r\n            return editor.getParam('indent_use_margin', false);\r\n        };\r\n        var getIndentation = function (editor) {\r\n            return editor.getParam('indentation', '40px', 'string');\r\n        };\r\n        var getContentCss = function (editor) {\r\n            var contentCss = editor.settings.content_css;\r\n            if (isString(contentCss)) {\r\n                return map(contentCss.split(','), trim$2);\r\n            }\r\n            else if (isArray(contentCss)) {\r\n                return contentCss;\r\n            }\r\n            else if (contentCss === false || editor.inline) {\r\n                return [];\r\n            }\r\n            else {\r\n                return ['default'];\r\n            }\r\n        };\r\n        var getDirectionality = function (editor) {\r\n            return editor.getParam('directionality', I18n.isRtl() ? 'rtl' : undefined);\r\n        };\r\n        var Settings = {\r\n            getIframeAttrs: getIframeAttrs,\r\n            getDocType: getDocType,\r\n            getDocumentBaseUrl: getDocumentBaseUrl,\r\n            getBodyId: getBodyId,\r\n            getBodyClass: getBodyClass,\r\n            getContentSecurityPolicy: getContentSecurityPolicy,\r\n            shouldPutBrInPre: shouldPutBrInPre,\r\n            getForcedRootBlock: getForcedRootBlock,\r\n            getForcedRootBlockAttrs: getForcedRootBlockAttrs,\r\n            getBrNewLineSelector: getBrNewLineSelector,\r\n            getNoNewLineSelector: getNoNewLineSelector,\r\n            shouldKeepStyles: shouldKeepStyles,\r\n            shouldEndContainerOnEmptyBlock: shouldEndContainerOnEmptyBlock,\r\n            getFontStyleValues: getFontStyleValues,\r\n            getFontSizeClasses: getFontSizeClasses,\r\n            getIconPackName: getIconPackName,\r\n            getIconsUrl: getIconsUrl,\r\n            getImagesDataImgFilter: getImagesDataImgFilter,\r\n            isAutomaticUploadsEnabled: isAutomaticUploadsEnabled,\r\n            shouldReuseFileName: shouldReuseFileName,\r\n            shouldReplaceBlobUris: shouldReplaceBlobUris,\r\n            getImageUploadUrl: getImageUploadUrl,\r\n            getImageUploadBasePath: getImageUploadBasePath,\r\n            getImagesUploadCredentials: getImagesUploadCredentials,\r\n            getImagesUploadHandler: getImagesUploadHandler,\r\n            shouldUseContentCssCors: shouldUseContentCssCors,\r\n            getLanguageCode: getLanguageCode,\r\n            getLanguageUrl: getLanguageUrl,\r\n            shouldIndentUseMargin: shouldIndentUseMargin,\r\n            getIndentation: getIndentation,\r\n            getContentCss: getContentCss,\r\n            getDirectionality: getDirectionality\r\n        };\r\n        var defaultFormat = 'html';\r\n        var trimEmptyContents = function (editor, html) {\r\n            var blockName = Settings.getForcedRootBlock(editor);\r\n            var emptyRegExp = new RegExp('^(<' + blockName + '[^>]*>(&nbsp;|&#160;|\\\\s|\\xA0|<br \\\\/>|)<\\\\/' + blockName + '>[\\r\\n]*|<br \\\\/>[\\r\\n]*)$');\r\n            return html.replace(emptyRegExp, '');\r\n        };\r\n        var getContentFromBody = function (editor, args, body) {\r\n            var content;\r\n            args.format = args.format ? args.format : defaultFormat;\r\n            args.get = true;\r\n            args.getInner = true;\r\n            if (!args.no_events) {\r\n                editor.fire('BeforeGetContent', args);\r\n            }\r\n            if (args.format === 'raw') {\r\n                content = Tools.trim(TrimHtml.trimExternal(editor.serializer, body.innerHTML));\r\n            }\r\n            else if (args.format === 'text') {\r\n                content = Zwsp.trim(body.innerText || body.textContent);\r\n            }\r\n            else if (args.format === 'tree') {\r\n                return editor.serializer.serialize(body, args);\r\n            }\r\n            else {\r\n                content = trimEmptyContents(editor, editor.serializer.serialize(body, args));\r\n            }\r\n            if (args.format !== 'text' && !isWsPreserveElement(Element.fromDom(body))) {\r\n                args.content = Tools.trim(content);\r\n            }\r\n            else {\r\n                args.content = content;\r\n            }\r\n            if (!args.no_events) {\r\n                editor.fire('GetContent', args);\r\n            }\r\n            return args.content;\r\n        };\r\n        var getContent = function (editor, args) {\r\n            if (args === void 0) {\r\n                args = {};\r\n            }\r\n            return Option.from(editor.getBody()).fold(constant(args.format === 'tree' ? new Node$1('body', 11) : ''), function (body) {\r\n                return getContentFromBody(editor, args, body);\r\n            });\r\n        };\r\n        var makeMap$3 = Tools.makeMap;\r\n        var Writer = function (settings) {\r\n            var html = [];\r\n            var indent, indentBefore, indentAfter, encode, htmlOutput;\r\n            settings = settings || {};\r\n            indent = settings.indent;\r\n            indentBefore = makeMap$3(settings.indent_before || '');\r\n            indentAfter = makeMap$3(settings.indent_after || '');\r\n            encode = Entities.getEncodeFunc(settings.entity_encoding || 'raw', settings.entities);\r\n            htmlOutput = settings.element_format === 'html';\r\n            return {\r\n                start: function (name, attrs, empty) {\r\n                    var i, l, attr, value;\r\n                    if (indent && indentBefore[name] && html.length > 0) {\r\n                        value = html[html.length - 1];\r\n                        if (value.length > 0 && value !== '\\n') {\r\n                            html.push('\\n');\r\n                        }\r\n                    }\r\n                    html.push('<', name);\r\n                    if (attrs) {\r\n                        for (i = 0, l = attrs.length; i < l; i++) {\r\n                            attr = attrs[i];\r\n                            html.push(' ', attr.name, '=\"', encode(attr.value, true), '\"');\r\n                        }\r\n                    }\r\n                    if (!empty || htmlOutput) {\r\n                        html[html.length] = '>';\r\n                    }\r\n                    else {\r\n                        html[html.length] = ' />';\r\n                    }\r\n                    if (empty && indent && indentAfter[name] && html.length > 0) {\r\n                        value = html[html.length - 1];\r\n                        if (value.length > 0 && value !== '\\n') {\r\n                            html.push('\\n');\r\n                        }\r\n                    }\r\n                },\r\n                end: function (name) {\r\n                    var value;\r\n                    html.push('</', name, '>');\r\n                    if (indent && indentAfter[name] && html.length > 0) {\r\n                        value = html[html.length - 1];\r\n                        if (value.length > 0 && value !== '\\n') {\r\n                            html.push('\\n');\r\n                        }\r\n                    }\r\n                },\r\n                text: function (text, raw) {\r\n                    if (text.length > 0) {\r\n                        html[html.length] = raw ? text : encode(text);\r\n                    }\r\n                },\r\n                cdata: function (text) {\r\n                    html.push('<![CDATA[', text, ']]>');\r\n                },\r\n                comment: function (text) {\r\n                    html.push('<!--', text, '-->');\r\n                },\r\n                pi: function (name, text) {\r\n                    if (text) {\r\n                        html.push('<?', name, ' ', encode(text), '?>');\r\n                    }\r\n                    else {\r\n                        html.push('<?', name, '?>');\r\n                    }\r\n                    if (indent) {\r\n                        html.push('\\n');\r\n                    }\r\n                },\r\n                doctype: function (text) {\r\n                    html.push('<!DOCTYPE', text, '>', indent ? '\\n' : '');\r\n                },\r\n                reset: function () {\r\n                    html.length = 0;\r\n                },\r\n                getContent: function () {\r\n                    return html.join('').replace(/\\n$/, '');\r\n                }\r\n            };\r\n        };\r\n        var Serializer = function (settings, schema) {\r\n            if (schema === void 0) {\r\n                schema = Schema();\r\n            }\r\n            var writer = Writer(settings);\r\n            settings = settings || {};\r\n            settings.validate = 'validate' in settings ? settings.validate : true;\r\n            var serialize = function (node) {\r\n                var handlers, validate;\r\n                validate = settings.validate;\r\n                handlers = {\r\n                    3: function (node) {\r\n                        writer.text(node.value, node.raw);\r\n                    },\r\n                    8: function (node) {\r\n                        writer.comment(node.value);\r\n                    },\r\n                    7: function (node) {\r\n                        writer.pi(node.name, node.value);\r\n                    },\r\n                    10: function (node) {\r\n                        writer.doctype(node.value);\r\n                    },\r\n                    4: function (node) {\r\n                        writer.cdata(node.value);\r\n                    },\r\n                    11: function (node) {\r\n                        if (node = node.firstChild) {\r\n                            do {\r\n                                walk(node);\r\n                            } while (node = node.next);\r\n                        }\r\n                    }\r\n                };\r\n                writer.reset();\r\n                var walk = function (node) {\r\n                    var handler = handlers[node.type];\r\n                    var name, isEmpty, attrs, attrName, attrValue, sortedAttrs, i, l, elementRule;\r\n                    if (!handler) {\r\n                        name = node.name;\r\n                        isEmpty = node.shortEnded;\r\n                        attrs = node.attributes;\r\n                        if (validate && attrs && attrs.length > 1) {\r\n                            sortedAttrs = [];\r\n                            sortedAttrs.map = {};\r\n                            elementRule = schema.getElementRule(node.name);\r\n                            if (elementRule) {\r\n                                for (i = 0, l = elementRule.attributesOrder.length; i < l; i++) {\r\n                                    attrName = elementRule.attributesOrder[i];\r\n                                    if (attrName in attrs.map) {\r\n                                        attrValue = attrs.map[attrName];\r\n                                        sortedAttrs.map[attrName] = attrValue;\r\n                                        sortedAttrs.push({\r\n                                            name: attrName,\r\n                                            value: attrValue\r\n                                        });\r\n                                    }\r\n                                }\r\n                                for (i = 0, l = attrs.length; i < l; i++) {\r\n                                    attrName = attrs[i].name;\r\n                                    if (!(attrName in sortedAttrs.map)) {\r\n                                        attrValue = attrs.map[attrName];\r\n                                        sortedAttrs.map[attrName] = attrValue;\r\n                                        sortedAttrs.push({\r\n                                            name: attrName,\r\n                                            value: attrValue\r\n                                        });\r\n                                    }\r\n                                }\r\n                                attrs = sortedAttrs;\r\n                            }\r\n                        }\r\n                        writer.start(node.name, attrs, isEmpty);\r\n                        if (!isEmpty) {\r\n                            if (node = node.firstChild) {\r\n                                do {\r\n                                    walk(node);\r\n                                } while (node = node.next);\r\n                            }\r\n                            writer.end(name);\r\n                        }\r\n                    }\r\n                    else {\r\n                        handler(node);\r\n                    }\r\n                };\r\n                if (node.type === 1 && !settings.inner) {\r\n                    walk(node);\r\n                }\r\n                else {\r\n                    handlers[11](node);\r\n                }\r\n                return writer.getContent();\r\n            };\r\n            return { serialize: serialize };\r\n        };\r\n        var traverse = function (node, fn) {\r\n            fn(node);\r\n            if (node.firstChild) {\r\n                traverse(node.firstChild, fn);\r\n            }\r\n            if (node.next) {\r\n                traverse(node.next, fn);\r\n            }\r\n        };\r\n        var findMatchingNodes = function (nodeFilters, attributeFilters, node) {\r\n            var nodeMatches = {};\r\n            var attrMatches = {};\r\n            var matches = [];\r\n            if (node.firstChild) {\r\n                traverse(node.firstChild, function (node) {\r\n                    each(nodeFilters, function (filter) {\r\n                        if (filter.name === node.name) {\r\n                            if (nodeMatches[filter.name]) {\r\n                                nodeMatches[filter.name].nodes.push(node);\r\n                            }\r\n                            else {\r\n                                nodeMatches[filter.name] = {\r\n                                    filter: filter,\r\n                                    nodes: [node]\r\n                                };\r\n                            }\r\n                        }\r\n                    });\r\n                    each(attributeFilters, function (filter) {\r\n                        if (typeof node.attr(filter.name) === 'string') {\r\n                            if (attrMatches[filter.name]) {\r\n                                attrMatches[filter.name].nodes.push(node);\r\n                            }\r\n                            else {\r\n                                attrMatches[filter.name] = {\r\n                                    filter: filter,\r\n                                    nodes: [node]\r\n                                };\r\n                            }\r\n                        }\r\n                    });\r\n                });\r\n            }\r\n            for (var name in nodeMatches) {\r\n                if (nodeMatches.hasOwnProperty(name)) {\r\n                    matches.push(nodeMatches[name]);\r\n                }\r\n            }\r\n            for (var name in attrMatches) {\r\n                if (attrMatches.hasOwnProperty(name)) {\r\n                    matches.push(attrMatches[name]);\r\n                }\r\n            }\r\n            return matches;\r\n        };\r\n        var filter$2 = function (nodeFilters, attributeFilters, node) {\r\n            var matches = findMatchingNodes(nodeFilters, attributeFilters, node);\r\n            each(matches, function (match) {\r\n                each(match.filter.callbacks, function (callback) {\r\n                    callback(match.nodes, match.filter.name, {});\r\n                });\r\n            });\r\n        };\r\n        var hasFocus = function (element) {\r\n            var doc = owner(element).dom();\r\n            return element.dom() === doc.activeElement;\r\n        };\r\n        var active = function (_DOC) {\r\n            var doc = _DOC !== undefined ? _DOC.dom() : domGlobals.document;\r\n            return Option.from(doc.activeElement).map(Element.fromDom);\r\n        };\r\n        var search = function (element) {\r\n            return active(owner(element)).filter(function (e) {\r\n                return element.dom().contains(e.dom());\r\n            });\r\n        };\r\n        var generate$1 = function (cases) {\r\n            if (!isArray(cases)) {\r\n                throw new Error('cases must be an array');\r\n            }\r\n            if (cases.length === 0) {\r\n                throw new Error('there must be at least one case');\r\n            }\r\n            var constructors = [];\r\n            var adt = {};\r\n            each(cases, function (acase, count) {\r\n                var keys$1 = keys(acase);\r\n                if (keys$1.length !== 1) {\r\n                    throw new Error('one and only one name per case');\r\n                }\r\n                var key = keys$1[0];\r\n                var value = acase[key];\r\n                if (adt[key] !== undefined) {\r\n                    throw new Error('duplicate key detected:' + key);\r\n                }\r\n                else if (key === 'cata') {\r\n                    throw new Error('cannot have a case named cata (sorry)');\r\n                }\r\n                else if (!isArray(value)) {\r\n                    throw new Error('case arguments must be an array');\r\n                }\r\n                constructors.push(key);\r\n                adt[key] = function () {\r\n                    var argLength = arguments.length;\r\n                    if (argLength !== value.length) {\r\n                        throw new Error('Wrong number of arguments to case ' + key + '. Expected ' + value.length + ' (' + value + '), got ' + argLength);\r\n                    }\r\n                    var args = new Array(argLength);\r\n                    for (var i = 0; i < args.length; i++)\r\n                        args[i] = arguments[i];\r\n                    var match = function (branches) {\r\n                        var branchKeys = keys(branches);\r\n                        if (constructors.length !== branchKeys.length) {\r\n                            throw new Error('Wrong number of arguments to match. Expected: ' + constructors.join(',') + '\\nActual: ' + branchKeys.join(','));\r\n                        }\r\n                        var allReqd = forall(constructors, function (reqKey) {\r\n                            return contains(branchKeys, reqKey);\r\n                        });\r\n                        if (!allReqd)\r\n                            throw new Error('Not all branches were specified when using match. Specified: ' + branchKeys.join(', ') + '\\nRequired: ' + constructors.join(', '));\r\n                        return branches[key].apply(null, args);\r\n                    };\r\n                    return {\r\n                        fold: function () {\r\n                            if (arguments.length !== cases.length) {\r\n                                throw new Error('Wrong number of arguments to fold. Expected ' + cases.length + ', got ' + arguments.length);\r\n                            }\r\n                            var target = arguments[count];\r\n                            return target.apply(null, args);\r\n                        },\r\n                        match: match,\r\n                        log: function (label) {\r\n                            domGlobals.console.log(label, {\r\n                                constructors: constructors,\r\n                                constructor: key,\r\n                                params: args\r\n                            });\r\n                        }\r\n                    };\r\n                };\r\n            });\r\n            return adt;\r\n        };\r\n        var Adt = { generate: generate$1 };\r\n        var adt = Adt.generate([\r\n            { before: ['element'] },\r\n            {\r\n                on: [\r\n                    'element',\r\n                    'offset'\r\n                ]\r\n            },\r\n            { after: ['element'] }\r\n        ]);\r\n        var type$1 = Adt.generate([\r\n            { domRange: ['rng'] },\r\n            {\r\n                relative: [\r\n                    'startSitu',\r\n                    'finishSitu'\r\n                ]\r\n            },\r\n            {\r\n                exact: [\r\n                    'start',\r\n                    'soffset',\r\n                    'finish',\r\n                    'foffset'\r\n                ]\r\n            }\r\n        ]);\r\n        var range$1 = Immutable('start', 'soffset', 'finish', 'foffset');\r\n        var browser$3 = PlatformDetection$1.detect().browser;\r\n        var clamp = function (offset, element) {\r\n            var max = isText(element) ? get$5(element).length : children(element).length + 1;\r\n            if (offset > max) {\r\n                return max;\r\n            }\r\n            else if (offset < 0) {\r\n                return 0;\r\n            }\r\n            return offset;\r\n        };\r\n        var normalizeRng = function (rng) {\r\n            return range$1(rng.start(), clamp(rng.soffset(), rng.start()), rng.finish(), clamp(rng.foffset(), rng.finish()));\r\n        };\r\n        var isOrContains = function (root, elm) {\r\n            return contains$3(root, elm) || eq(root, elm);\r\n        };\r\n        var isRngInRoot = function (root) {\r\n            return function (rng) {\r\n                return isOrContains(root, rng.start()) && isOrContains(root, rng.finish());\r\n            };\r\n        };\r\n        var shouldStore = function (editor) {\r\n            return editor.inline === true || browser$3.isIE();\r\n        };\r\n        var nativeRangeToSelectionRange = function (r) {\r\n            return range$1(Element.fromDom(r.startContainer), r.startOffset, Element.fromDom(r.endContainer), r.endOffset);\r\n        };\r\n        var readRange = function (win) {\r\n            var selection = win.getSelection();\r\n            var rng = !selection || selection.rangeCount === 0 ? Option.none() : Option.from(selection.getRangeAt(0));\r\n            return rng.map(nativeRangeToSelectionRange);\r\n        };\r\n        var getBookmark$2 = function (root) {\r\n            var win = defaultView(root);\r\n            return readRange(win.dom()).filter(isRngInRoot(root));\r\n        };\r\n        var validate = function (root, bookmark) {\r\n            return Option.from(bookmark).filter(isRngInRoot(root)).map(normalizeRng);\r\n        };\r\n        var bookmarkToNativeRng = function (bookmark) {\r\n            var rng = domGlobals.document.createRange();\r\n            try {\r\n                rng.setStart(bookmark.start().dom(), bookmark.soffset());\r\n                rng.setEnd(bookmark.finish().dom(), bookmark.foffset());\r\n                return Option.some(rng);\r\n            }\r\n            catch (_) {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var store = function (editor) {\r\n            var newBookmark = shouldStore(editor) ? getBookmark$2(Element.fromDom(editor.getBody())) : Option.none();\r\n            editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\r\n        };\r\n        var storeNative = function (editor, rng) {\r\n            var root = Element.fromDom(editor.getBody());\r\n            var range = shouldStore(editor) ? Option.from(rng) : Option.none();\r\n            var newBookmark = range.map(nativeRangeToSelectionRange).filter(isRngInRoot(root));\r\n            editor.bookmark = newBookmark.isSome() ? newBookmark : editor.bookmark;\r\n        };\r\n        var getRng = function (editor) {\r\n            var bookmark = editor.bookmark ? editor.bookmark : Option.none();\r\n            return bookmark.bind(curry(validate, Element.fromDom(editor.getBody()))).bind(bookmarkToNativeRng);\r\n        };\r\n        var restore = function (editor) {\r\n            getRng(editor).each(function (rng) {\r\n                editor.selection.setRng(rng);\r\n            });\r\n        };\r\n        var SelectionBookmark = {\r\n            store: store,\r\n            storeNative: storeNative,\r\n            readRange: readRange,\r\n            restore: restore,\r\n            getRng: getRng,\r\n            getBookmark: getBookmark$2,\r\n            validate: validate\r\n        };\r\n        var getContentEditableHost = function (editor, node) {\r\n            return editor.dom.getParent(node, function (node) {\r\n                return editor.dom.getContentEditable(node) === 'true';\r\n            });\r\n        };\r\n        var getCollapsedNode = function (rng) {\r\n            return rng.collapsed ? Option.from(getNode(rng.startContainer, rng.startOffset)).map(Element.fromDom) : Option.none();\r\n        };\r\n        var getFocusInElement = function (root, rng) {\r\n            return getCollapsedNode(rng).bind(function (node) {\r\n                if (isTableSection(node)) {\r\n                    return Option.some(node);\r\n                }\r\n                else if (contains$3(root, node) === false) {\r\n                    return Option.some(root);\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            });\r\n        };\r\n        var normalizeSelection = function (editor, rng) {\r\n            getFocusInElement(Element.fromDom(editor.getBody()), rng).bind(function (elm) {\r\n                return CaretFinder.firstPositionIn(elm.dom());\r\n            }).fold(function () {\r\n                editor.selection.normalize();\r\n                return;\r\n            }, function (caretPos) {\r\n                return editor.selection.setRng(caretPos.toRange());\r\n            });\r\n        };\r\n        var focusBody = function (body) {\r\n            if (body.setActive) {\r\n                try {\r\n                    body.setActive();\r\n                }\r\n                catch (ex) {\r\n                    body.focus();\r\n                }\r\n            }\r\n            else {\r\n                body.focus();\r\n            }\r\n        };\r\n        var hasElementFocus = function (elm) {\r\n            return hasFocus(elm) || search(elm).isSome();\r\n        };\r\n        var hasIframeFocus = function (editor) {\r\n            return editor.iframeElement && hasFocus(Element.fromDom(editor.iframeElement));\r\n        };\r\n        var hasInlineFocus = function (editor) {\r\n            var rawBody = editor.getBody();\r\n            return rawBody && hasElementFocus(Element.fromDom(rawBody));\r\n        };\r\n        var hasFocus$1 = function (editor) {\r\n            return editor.inline ? hasInlineFocus(editor) : hasIframeFocus(editor);\r\n        };\r\n        var focusEditor = function (editor) {\r\n            var selection = editor.selection;\r\n            var body = editor.getBody();\r\n            var rng = selection.getRng();\r\n            editor.quirks.refreshContentEditable();\r\n            var contentEditableHost = getContentEditableHost(editor, selection.getNode());\r\n            if (editor.$.contains(body, contentEditableHost)) {\r\n                focusBody(contentEditableHost);\r\n                normalizeSelection(editor, rng);\r\n                activateEditor(editor);\r\n                return;\r\n            }\r\n            if (editor.bookmark !== undefined && hasFocus$1(editor) === false) {\r\n                SelectionBookmark.getRng(editor).each(function (bookmarkRng) {\r\n                    editor.selection.setRng(bookmarkRng);\r\n                    rng = bookmarkRng;\r\n                });\r\n            }\r\n            if (!editor.inline) {\r\n                if (!Env.opera) {\r\n                    focusBody(body);\r\n                }\r\n                editor.getWin().focus();\r\n            }\r\n            if (Env.gecko || editor.inline) {\r\n                focusBody(body);\r\n                normalizeSelection(editor, rng);\r\n            }\r\n            activateEditor(editor);\r\n        };\r\n        var activateEditor = function (editor) {\r\n            return editor.editorManager.setActive(editor);\r\n        };\r\n        var focus = function (editor, skipFocus) {\r\n            if (editor.removed) {\r\n                return;\r\n            }\r\n            skipFocus ? activateEditor(editor) : focusEditor(editor);\r\n        };\r\n        var EditorFocus = {\r\n            focus: focus,\r\n            hasFocus: hasFocus$1\r\n        };\r\n        var defaultFormat$1 = 'html';\r\n        var isTreeNode = function (content) {\r\n            return content instanceof Node$1;\r\n        };\r\n        var moveSelection = function (editor) {\r\n            if (EditorFocus.hasFocus(editor)) {\r\n                CaretFinder.firstPositionIn(editor.getBody()).each(function (pos) {\r\n                    var node = pos.getNode();\r\n                    var caretPos = NodeType.isTable(node) ? CaretFinder.firstPositionIn(node).getOr(pos) : pos;\r\n                    editor.selection.setRng(caretPos.toRange());\r\n                });\r\n            }\r\n        };\r\n        var setEditorHtml = function (editor, html) {\r\n            editor.dom.setHTML(editor.getBody(), html);\r\n            moveSelection(editor);\r\n        };\r\n        var setContentString = function (editor, body, content, args) {\r\n            var forcedRootBlockName, padd;\r\n            if (content.length === 0 || /^\\s+$/.test(content)) {\r\n                padd = '<br data-mce-bogus=\"1\">';\r\n                if (body.nodeName === 'TABLE') {\r\n                    content = '<tr><td>' + padd + '</td></tr>';\r\n                }\r\n                else if (/^(UL|OL)$/.test(body.nodeName)) {\r\n                    content = '<li>' + padd + '</li>';\r\n                }\r\n                forcedRootBlockName = Settings.getForcedRootBlock(editor);\r\n                if (forcedRootBlockName && editor.schema.isValidChild(body.nodeName.toLowerCase(), forcedRootBlockName.toLowerCase())) {\r\n                    content = padd;\r\n                    content = editor.dom.createHTML(forcedRootBlockName, editor.settings.forced_root_block_attrs, content);\r\n                }\r\n                else if (!content) {\r\n                    content = '<br data-mce-bogus=\"1\">';\r\n                }\r\n                setEditorHtml(editor, content);\r\n                editor.fire('SetContent', args);\r\n            }\r\n            else {\r\n                if (args.format !== 'raw') {\r\n                    content = Serializer({ validate: editor.validate }, editor.schema).serialize(editor.parser.parse(content, {\r\n                        isRootContent: true,\r\n                        insert: true\r\n                    }));\r\n                }\r\n                args.content = isWsPreserveElement(Element.fromDom(body)) ? content : Tools.trim(content);\r\n                setEditorHtml(editor, args.content);\r\n                if (!args.no_events) {\r\n                    editor.fire('SetContent', args);\r\n                }\r\n            }\r\n            return args.content;\r\n        };\r\n        var setContentTree = function (editor, body, content, args) {\r\n            filter$2(editor.parser.getNodeFilters(), editor.parser.getAttributeFilters(), content);\r\n            var html = Serializer({ validate: editor.validate }, editor.schema).serialize(content);\r\n            args.content = isWsPreserveElement(Element.fromDom(body)) ? html : Tools.trim(html);\r\n            setEditorHtml(editor, args.content);\r\n            if (!args.no_events) {\r\n                editor.fire('SetContent', args);\r\n            }\r\n            return content;\r\n        };\r\n        var setContent = function (editor, content, args) {\r\n            if (args === void 0) {\r\n                args = {};\r\n            }\r\n            args.format = args.format ? args.format : defaultFormat$1;\r\n            args.set = true;\r\n            args.content = isTreeNode(content) ? '' : content;\r\n            if (!isTreeNode(content) && !args.no_events) {\r\n                editor.fire('BeforeSetContent', args);\r\n                content = args.content;\r\n            }\r\n            return Option.from(editor.getBody()).fold(constant(content), function (body) {\r\n                return isTreeNode(content) ? setContentTree(editor, body, content, args) : setContentString(editor, body, content, args);\r\n            });\r\n        };\r\n        var firePreProcess = function (editor, args) {\r\n            return editor.fire('PreProcess', args);\r\n        };\r\n        var firePostProcess = function (editor, args) {\r\n            return editor.fire('PostProcess', args);\r\n        };\r\n        var fireRemove = function (editor) {\r\n            return editor.fire('remove');\r\n        };\r\n        var fireDetach = function (editor) {\r\n            return editor.fire('detach');\r\n        };\r\n        var fireSwitchMode = function (editor, mode) {\r\n            return editor.fire('SwitchMode', { mode: mode });\r\n        };\r\n        var fireObjectResizeStart = function (editor, target, width, height) {\r\n            editor.fire('ObjectResizeStart', {\r\n                target: target,\r\n                width: width,\r\n                height: height\r\n            });\r\n        };\r\n        var fireObjectResized = function (editor, target, width, height) {\r\n            editor.fire('ObjectResized', {\r\n                target: target,\r\n                width: width,\r\n                height: height\r\n            });\r\n        };\r\n        var Events = {\r\n            firePreProcess: firePreProcess,\r\n            firePostProcess: firePostProcess,\r\n            fireRemove: fireRemove,\r\n            fireDetach: fireDetach,\r\n            fireSwitchMode: fireSwitchMode,\r\n            fireObjectResizeStart: fireObjectResizeStart,\r\n            fireObjectResized: fireObjectResized\r\n        };\r\n        var DOM$1 = DOMUtils$1.DOM;\r\n        var restoreOriginalStyles = function (editor) {\r\n            DOM$1.setStyle(editor.id, 'display', editor.orgDisplay);\r\n        };\r\n        var safeDestroy = function (x) {\r\n            return Option.from(x).each(function (x) {\r\n                return x.destroy();\r\n            });\r\n        };\r\n        var clearDomReferences = function (editor) {\r\n            editor.contentAreaContainer = editor.formElement = editor.container = editor.editorContainer = null;\r\n            editor.bodyElement = editor.contentDocument = editor.contentWindow = null;\r\n            editor.iframeElement = editor.targetElm = null;\r\n            if (editor.selection) {\r\n                editor.selection = editor.selection.win = editor.selection.dom = editor.selection.dom.doc = null;\r\n            }\r\n        };\r\n        var restoreForm = function (editor) {\r\n            var form = editor.formElement;\r\n            if (form) {\r\n                if (form._mceOldSubmit) {\r\n                    form.submit = form._mceOldSubmit;\r\n                    form._mceOldSubmit = null;\r\n                }\r\n                DOM$1.unbind(form, 'submit reset', editor.formEventDelegate);\r\n            }\r\n        };\r\n        var remove$6 = function (editor) {\r\n            if (!editor.removed) {\r\n                var _selectionOverrides = editor._selectionOverrides, editorUpload = editor.editorUpload;\r\n                var body = editor.getBody();\r\n                var element = editor.getElement();\r\n                if (body) {\r\n                    editor.save({ is_removing: true });\r\n                }\r\n                editor.removed = true;\r\n                editor.unbindAllNativeEvents();\r\n                if (editor.hasHiddenInput && element) {\r\n                    DOM$1.remove(element.nextSibling);\r\n                }\r\n                Events.fireRemove(editor);\r\n                editor.editorManager.remove(editor);\r\n                if (!editor.inline && body) {\r\n                    restoreOriginalStyles(editor);\r\n                }\r\n                Events.fireDetach(editor);\r\n                DOM$1.remove(editor.getContainer());\r\n                safeDestroy(_selectionOverrides);\r\n                safeDestroy(editorUpload);\r\n                editor.destroy();\r\n            }\r\n        };\r\n        var destroy = function (editor, automatic) {\r\n            var selection = editor.selection, dom = editor.dom;\r\n            if (editor.destroyed) {\r\n                return;\r\n            }\r\n            if (!automatic && !editor.removed) {\r\n                editor.remove();\r\n                return;\r\n            }\r\n            if (!automatic) {\r\n                editor.editorManager.off('beforeunload', editor._beforeUnload);\r\n                if (editor.theme && editor.theme.destroy) {\r\n                    editor.theme.destroy();\r\n                }\r\n                safeDestroy(selection);\r\n                safeDestroy(dom);\r\n            }\r\n            restoreForm(editor);\r\n            clearDomReferences(editor);\r\n            editor.destroyed = true;\r\n        };\r\n        var sectionResult = Immutable('sections', 'settings');\r\n        var detection = PlatformDetection$1.detect();\r\n        var isTouch = detection.deviceType.isTouch();\r\n        var isPhone = detection.deviceType.isPhone();\r\n        var mobilePlugins = [\r\n            'lists',\r\n            'autolink',\r\n            'autosave'\r\n        ];\r\n        var defaultMobileSettings = isPhone ? { theme: 'mobile' } : {};\r\n        var normalizePlugins = function (plugins) {\r\n            var pluginNames = isArray(plugins) ? plugins.join(' ') : plugins;\r\n            var trimmedPlugins = map(isString(pluginNames) ? pluginNames.split(' ') : [], trim$2);\r\n            return filter(trimmedPlugins, function (item) {\r\n                return item.length > 0;\r\n            });\r\n        };\r\n        var filterMobilePlugins = function (plugins) {\r\n            return filter(plugins, curry(contains, mobilePlugins));\r\n        };\r\n        var extractSections = function (keys, settings) {\r\n            var result = bifilter(settings, function (value, key) {\r\n                return contains(keys, key);\r\n            });\r\n            return sectionResult(result.t, result.f);\r\n        };\r\n        var getSection = function (sectionResult, name, defaults) {\r\n            var sections = sectionResult.sections();\r\n            var sectionSettings = sections.hasOwnProperty(name) ? sections[name] : {};\r\n            return Tools.extend({}, defaults, sectionSettings);\r\n        };\r\n        var hasSection = function (sectionResult, name) {\r\n            return sectionResult.sections().hasOwnProperty(name);\r\n        };\r\n        var getDefaultSettings = function (id, documentBaseUrl, editor) {\r\n            return {\r\n                id: id,\r\n                theme: 'silver',\r\n                plugins: '',\r\n                document_base_url: documentBaseUrl,\r\n                add_form_submit_trigger: true,\r\n                submit_patch: true,\r\n                add_unload_trigger: true,\r\n                convert_urls: true,\r\n                relative_urls: true,\r\n                remove_script_host: true,\r\n                object_resizing: true,\r\n                doctype: '<!DOCTYPE html>',\r\n                visual: true,\r\n                font_size_legacy_values: 'xx-small,small,medium,large,x-large,xx-large,300%',\r\n                forced_root_block: 'p',\r\n                hidden_input: true,\r\n                inline_styles: true,\r\n                convert_fonts_to_spans: true,\r\n                indent: true,\r\n                indent_before: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\r\n                indent_after: 'p,h1,h2,h3,h4,h5,h6,blockquote,div,title,style,pre,script,td,th,ul,ol,li,dl,dt,dd,area,table,thead,' + 'tfoot,tbody,tr,section,summary,article,hgroup,aside,figure,figcaption,option,optgroup,datalist',\r\n                entity_encoding: 'named',\r\n                url_converter: editor.convertURL,\r\n                url_converter_scope: editor\r\n            };\r\n        };\r\n        var getExternalPlugins = function (overrideSettings, settings) {\r\n            var userDefinedExternalPlugins = settings.external_plugins ? settings.external_plugins : {};\r\n            if (overrideSettings && overrideSettings.external_plugins) {\r\n                return Tools.extend({}, overrideSettings.external_plugins, userDefinedExternalPlugins);\r\n            }\r\n            else {\r\n                return userDefinedExternalPlugins;\r\n            }\r\n        };\r\n        var combinePlugins = function (forcedPlugins, plugins) {\r\n            return [].concat(normalizePlugins(forcedPlugins)).concat(normalizePlugins(plugins));\r\n        };\r\n        var processPlugins = function (isTouchDevice, sectionResult, defaultOverrideSettings, settings) {\r\n            var forcedPlugins = normalizePlugins(defaultOverrideSettings.forced_plugins);\r\n            var plugins = normalizePlugins(settings.plugins);\r\n            var platformPlugins = isTouchDevice && hasSection(sectionResult, 'mobile') ? filterMobilePlugins(plugins) : plugins;\r\n            var combinedPlugins = combinePlugins(forcedPlugins, platformPlugins);\r\n            return Tools.extend(settings, { plugins: combinedPlugins.join(' ') });\r\n        };\r\n        var isOnMobile = function (isTouchDevice, sectionResult) {\r\n            var isInline = sectionResult.settings().inline;\r\n            return isTouchDevice && !isInline;\r\n        };\r\n        var combineSettings = function (isTouchDevice, defaultSettings, defaultOverrideSettings, settings) {\r\n            var sectionResult = extractSections(['mobile'], settings);\r\n            var extendedSettings = Tools.extend(defaultSettings, defaultOverrideSettings, sectionResult.settings(), isOnMobile(isTouchDevice, sectionResult) ? getSection(sectionResult, 'mobile', defaultMobileSettings) : {}, {\r\n                validate: true,\r\n                external_plugins: getExternalPlugins(defaultOverrideSettings, sectionResult.settings())\r\n            });\r\n            return processPlugins(isTouchDevice, sectionResult, defaultOverrideSettings, extendedSettings);\r\n        };\r\n        var getEditorSettings = function (editor, id, documentBaseUrl, defaultOverrideSettings, settings) {\r\n            var defaultSettings = getDefaultSettings(id, documentBaseUrl, editor);\r\n            return combineSettings(isTouch, defaultSettings, defaultOverrideSettings, settings);\r\n        };\r\n        var getFiltered = function (predicate, editor, name) {\r\n            return Option.from(editor.settings[name]).filter(predicate);\r\n        };\r\n        var getString = curry(getFiltered, isString);\r\n        var getParamObject = function (value) {\r\n            var output = {};\r\n            if (typeof value === 'string') {\r\n                each(value.indexOf('=') > 0 ? value.split(/[;,](?![^=;,]*(?:[;,]|$))/) : value.split(','), function (val) {\r\n                    var arr = val.split('=');\r\n                    if (arr.length > 1) {\r\n                        output[Tools.trim(arr[0])] = Tools.trim(arr[1]);\r\n                    }\r\n                    else {\r\n                        output[Tools.trim(arr[0])] = Tools.trim(arr[0]);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                output = value;\r\n            }\r\n            return output;\r\n        };\r\n        var isArrayOf = function (p) {\r\n            return function (a) {\r\n                return isArray(a) && forall(a, p);\r\n            };\r\n        };\r\n        var getParam = function (editor, name, defaultVal, type) {\r\n            var value = name in editor.settings ? editor.settings[name] : defaultVal;\r\n            if (type === 'hash') {\r\n                return getParamObject(value);\r\n            }\r\n            else if (type === 'string') {\r\n                return getFiltered(isString, editor, name).getOr(defaultVal);\r\n            }\r\n            else if (type === 'number') {\r\n                return getFiltered(isNumber, editor, name).getOr(defaultVal);\r\n            }\r\n            else if (type === 'boolean') {\r\n                return getFiltered(isBoolean, editor, name).getOr(defaultVal);\r\n            }\r\n            else if (type === 'object') {\r\n                return getFiltered(isObject, editor, name).getOr(defaultVal);\r\n            }\r\n            else if (type === 'array') {\r\n                return getFiltered(isArray, editor, name).getOr(defaultVal);\r\n            }\r\n            else if (type === 'string[]') {\r\n                return getFiltered(isArrayOf(isString), editor, name).getOr(defaultVal);\r\n            }\r\n            else if (type === 'function') {\r\n                return getFiltered(isFunction, editor, name).getOr(defaultVal);\r\n            }\r\n            else {\r\n                return value;\r\n            }\r\n        };\r\n        var getProp = function (propName, elm) {\r\n            var rawElm = elm.dom();\r\n            return rawElm[propName];\r\n        };\r\n        var getComputedSizeProp = function (propName, elm) {\r\n            return parseInt(get$2(elm, propName), 10);\r\n        };\r\n        var getClientWidth = curry(getProp, 'clientWidth');\r\n        var getClientHeight = curry(getProp, 'clientHeight');\r\n        var getMarginTop = curry(getComputedSizeProp, 'margin-top');\r\n        var getMarginLeft = curry(getComputedSizeProp, 'margin-left');\r\n        var getBoundingClientRect$1 = function (elm) {\r\n            return elm.dom().getBoundingClientRect();\r\n        };\r\n        var isInsideElementContentArea = function (bodyElm, clientX, clientY) {\r\n            var clientWidth = getClientWidth(bodyElm);\r\n            var clientHeight = getClientHeight(bodyElm);\r\n            return clientX >= 0 && clientY >= 0 && clientX <= clientWidth && clientY <= clientHeight;\r\n        };\r\n        var transpose = function (inline, elm, clientX, clientY) {\r\n            var clientRect = getBoundingClientRect$1(elm);\r\n            var deltaX = inline ? clientRect.left + elm.dom().clientLeft + getMarginLeft(elm) : 0;\r\n            var deltaY = inline ? clientRect.top + elm.dom().clientTop + getMarginTop(elm) : 0;\r\n            var x = clientX - deltaX;\r\n            var y = clientY - deltaY;\r\n            return {\r\n                x: x,\r\n                y: y\r\n            };\r\n        };\r\n        var isXYInContentArea = function (editor, clientX, clientY) {\r\n            var bodyElm = Element.fromDom(editor.getBody());\r\n            var targetElm = editor.inline ? bodyElm : documentElement(bodyElm);\r\n            var transposedPoint = transpose(editor.inline, targetElm, clientX, clientY);\r\n            return isInsideElementContentArea(targetElm, transposedPoint.x, transposedPoint.y);\r\n        };\r\n        var fromDomSafe = function (node) {\r\n            return Option.from(node).map(Element.fromDom);\r\n        };\r\n        var isEditorAttachedToDom = function (editor) {\r\n            var rawContainer = editor.inline ? editor.getBody() : editor.getContentAreaContainer();\r\n            return fromDomSafe(rawContainer).map(function (container) {\r\n                return contains$3(owner(container), container);\r\n            }).getOr(false);\r\n        };\r\n        var EditorView = {\r\n            isXYInContentArea: isXYInContentArea,\r\n            isEditorAttachedToDom: isEditorAttachedToDom\r\n        };\r\n        function NotificationManagerImpl() {\r\n            var unimplemented = function () {\r\n                throw new Error('Theme did not provide a NotificationManager implementation.');\r\n            };\r\n            return {\r\n                open: unimplemented,\r\n                close: unimplemented,\r\n                reposition: unimplemented,\r\n                getArgs: unimplemented\r\n            };\r\n        }\r\n        function NotificationManager(editor) {\r\n            var notifications = [];\r\n            var getImplementation = function () {\r\n                var theme = editor.theme;\r\n                return theme && theme.getNotificationManagerImpl ? theme.getNotificationManagerImpl() : NotificationManagerImpl();\r\n            };\r\n            var getTopNotification = function () {\r\n                return Option.from(notifications[0]);\r\n            };\r\n            var isEqual = function (a, b) {\r\n                return a.type === b.type && a.text === b.text && !a.progressBar && !a.timeout && !b.progressBar && !b.timeout;\r\n            };\r\n            var reposition = function () {\r\n                if (notifications.length > 0) {\r\n                    getImplementation().reposition(notifications);\r\n                }\r\n            };\r\n            var addNotification = function (notification) {\r\n                notifications.push(notification);\r\n            };\r\n            var closeNotification = function (notification) {\r\n                findIndex(notifications, function (otherNotification) {\r\n                    return otherNotification === notification;\r\n                }).each(function (index) {\r\n                    notifications.splice(index, 1);\r\n                });\r\n            };\r\n            var open = function (spec) {\r\n                if (editor.removed || !EditorView.isEditorAttachedToDom(editor)) {\r\n                    return;\r\n                }\r\n                return find(notifications, function (notification) {\r\n                    return isEqual(getImplementation().getArgs(notification), spec);\r\n                }).getOrThunk(function () {\r\n                    editor.editorManager.setActive(editor);\r\n                    var notification = getImplementation().open(spec, function () {\r\n                        closeNotification(notification);\r\n                        reposition();\r\n                    });\r\n                    addNotification(notification);\r\n                    reposition();\r\n                    return notification;\r\n                });\r\n            };\r\n            var close = function () {\r\n                getTopNotification().each(function (notification) {\r\n                    getImplementation().close(notification);\r\n                    closeNotification(notification);\r\n                    reposition();\r\n                });\r\n            };\r\n            var getNotifications = function () {\r\n                return notifications;\r\n            };\r\n            var registerEvents = function (editor) {\r\n                editor.on('SkinLoaded', function () {\r\n                    var serviceMessage = editor.settings.service_message;\r\n                    if (serviceMessage) {\r\n                        open({\r\n                            text: serviceMessage,\r\n                            type: 'warn',\r\n                            timeout: 0\r\n                        });\r\n                    }\r\n                });\r\n                editor.on('ResizeEditor ResizeWindow NodeChange', function () {\r\n                    Delay.requestAnimationFrame(reposition);\r\n                });\r\n                editor.on('remove', function () {\r\n                    each(notifications.slice(), function (notification) {\r\n                        getImplementation().close(notification);\r\n                    });\r\n                });\r\n            };\r\n            registerEvents(editor);\r\n            return {\r\n                open: open,\r\n                close: close,\r\n                getNotifications: getNotifications\r\n            };\r\n        }\r\n        function WindowManagerImpl() {\r\n            var unimplemented = function () {\r\n                throw new Error('Theme did not provide a WindowManager implementation.');\r\n            };\r\n            return {\r\n                open: unimplemented,\r\n                openUrl: unimplemented,\r\n                alert: unimplemented,\r\n                confirm: unimplemented,\r\n                close: unimplemented,\r\n                getParams: unimplemented,\r\n                setParams: unimplemented\r\n            };\r\n        }\r\n        var WindowManager = function (editor) {\r\n            var dialogs = [];\r\n            var getImplementation = function () {\r\n                var theme = editor.theme;\r\n                return theme && theme.getWindowManagerImpl ? theme.getWindowManagerImpl() : WindowManagerImpl();\r\n            };\r\n            var funcBind = function (scope, f) {\r\n                return function () {\r\n                    return f ? f.apply(scope, arguments) : undefined;\r\n                };\r\n            };\r\n            var fireOpenEvent = function (dialog) {\r\n                editor.fire('OpenWindow', { dialog: dialog });\r\n            };\r\n            var fireCloseEvent = function (dialog) {\r\n                editor.fire('CloseWindow', { dialog: dialog });\r\n            };\r\n            var addDialog = function (dialog) {\r\n                dialogs.push(dialog);\r\n                fireOpenEvent(dialog);\r\n            };\r\n            var closeDialog = function (dialog) {\r\n                fireCloseEvent(dialog);\r\n                dialogs = filter(dialogs, function (otherDialog) {\r\n                    return otherDialog !== dialog;\r\n                });\r\n                if (dialogs.length === 0) {\r\n                    editor.focus();\r\n                }\r\n            };\r\n            var getTopDialog = function () {\r\n                return Option.from(dialogs[dialogs.length - 1]);\r\n            };\r\n            var storeSelectionAndOpenDialog = function (openDialog) {\r\n                editor.editorManager.setActive(editor);\r\n                SelectionBookmark.store(editor);\r\n                var dialog = openDialog();\r\n                addDialog(dialog);\r\n                return dialog;\r\n            };\r\n            var open = function (args, params) {\r\n                return storeSelectionAndOpenDialog(function () {\r\n                    return getImplementation().open(args, params, closeDialog);\r\n                });\r\n            };\r\n            var openUrl = function (args) {\r\n                return storeSelectionAndOpenDialog(function () {\r\n                    return getImplementation().openUrl(args, closeDialog);\r\n                });\r\n            };\r\n            var alert = function (message, callback, scope) {\r\n                getImplementation().alert(message, funcBind(scope ? scope : this, callback));\r\n            };\r\n            var confirm = function (message, callback, scope) {\r\n                getImplementation().confirm(message, funcBind(scope ? scope : this, callback));\r\n            };\r\n            var close = function () {\r\n                getTopDialog().each(function (dialog) {\r\n                    getImplementation().close(dialog);\r\n                    closeDialog(dialog);\r\n                });\r\n            };\r\n            editor.on('remove', function () {\r\n                each(dialogs, function (dialog) {\r\n                    getImplementation().close(dialog);\r\n                });\r\n            });\r\n            return {\r\n                open: open,\r\n                openUrl: openUrl,\r\n                alert: alert,\r\n                confirm: confirm,\r\n                close: close\r\n            };\r\n        };\r\n        var displayNotification = function (editor, message) {\r\n            editor.notificationManager.open({\r\n                type: 'error',\r\n                text: message\r\n            });\r\n        };\r\n        var displayError = function (editor, message) {\r\n            if (editor._skinLoaded) {\r\n                displayNotification(editor, message);\r\n            }\r\n            else {\r\n                editor.on('SkinLoaded', function () {\r\n                    displayNotification(editor, message);\r\n                });\r\n            }\r\n        };\r\n        var uploadError = function (editor, message) {\r\n            displayError(editor, I18n.translate([\r\n                'Failed to upload image: {0}',\r\n                message\r\n            ]));\r\n        };\r\n        var logError = function (msg) {\r\n            domGlobals.console.error(msg);\r\n        };\r\n        var createLoadError = function (type, url, name) {\r\n            return name ? 'Failed to load ' + type + ': ' + name + ' from url ' + url : 'Failed to load ' + type + ' url: ' + url;\r\n        };\r\n        var pluginLoadError = function (url, name) {\r\n            logError(createLoadError('plugin', url, name));\r\n        };\r\n        var iconsLoadError = function (url, name) {\r\n            logError(createLoadError('icons', url, name));\r\n        };\r\n        var languageLoadError = function (url, name) {\r\n            logError(createLoadError('language', url, name));\r\n        };\r\n        var pluginInitError = function (editor, name, err) {\r\n            var message = I18n.translate([\r\n                'Failed to initialize plugin: {0}',\r\n                name\r\n            ]);\r\n            initError(message, err);\r\n            displayError(editor, message);\r\n        };\r\n        var initError = function (message) {\r\n            var x = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                x[_i - 1] = arguments[_i];\r\n            }\r\n            var console = domGlobals.window.console;\r\n            if (console) {\r\n                if (console.error) {\r\n                    console.error.apply(console, arguments);\r\n                }\r\n                else {\r\n                    console.log.apply(console, arguments);\r\n                }\r\n            }\r\n        };\r\n        var ErrorReporter = {\r\n            pluginLoadError: pluginLoadError,\r\n            iconsLoadError: iconsLoadError,\r\n            languageLoadError: languageLoadError,\r\n            pluginInitError: pluginInitError,\r\n            uploadError: uploadError,\r\n            displayError: displayError,\r\n            initError: initError\r\n        };\r\n        var getAll = function () {\r\n            return {\r\n                'accessibility-check': '<svg width=\"24\" height=\"24\"><path d=\"M12 2a2 2 0 0 1 2 2 2 2 0 0 1-2 2 2 2 0 0 1-2-2c0-1.1.9-2 2-2zm8 7h-5v12c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-5c0-.6-.4-1-1-1a1 1 0 0 0-1 1v5c0 .6-.4 1-1 1a1 1 0 0 1-1-1V9H4a1 1 0 1 1 0-2h16c.6 0 1 .4 1 1s-.4 1-1 1z\" fill-rule=\"nonzero\"/></svg>',\r\n                'align-center': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm3 4h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 1 1 0-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2zm-3-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'align-justify': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2zm0 4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'align-left': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm0 4h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2zm0-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'align-none': '<svg width=\"24\" height=\"24\"><path d=\"M14.2 5L13 7H5a1 1 0 1 1 0-2h9.2zm4 0h.8a1 1 0 0 1 0 2h-2l1.2-2zm-6.4 4l-1.2 2H5a1 1 0 0 1 0-2h6.8zm4 0H19a1 1 0 0 1 0 2h-4.4l1.2-2zm-6.4 4l-1.2 2H5a1 1 0 0 1 0-2h4.4zm4 0H19a1 1 0 0 1 0 2h-6.8l1.2-2zM7 17l-1.2 2H5a1 1 0 0 1 0-2h2zm4 0h8a1 1 0 0 1 0 2H9.8l1.2-2zm5.2-13.5l1.3.7-9.7 16.3-1.3-.7 9.7-16.3z\" fill-rule=\"evenodd\"/></svg>',\r\n                'align-right': '<svg width=\"24\" height=\"24\"><path d=\"M5 5h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm6 4h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0 8h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm-6-4h14c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'arrow-left': '<svg width=\"24\" height=\"24\"><path d=\"M5.6 13l12 6a1 1 0 0 0 1.4-1V6a1 1 0 0 0-1.4-.9l-12 6a1 1 0 0 0 0 1.8z\" fill-rule=\"evenodd\"/></svg>',\r\n                'arrow-right': '<svg width=\"24\" height=\"24\"><path d=\"M18.5 13l-12 6A1 1 0 0 1 5 18V6a1 1 0 0 1 1.4-.9l12 6a1 1 0 0 1 0 1.8z\" fill-rule=\"evenodd\"/></svg>',\r\n                'bold': '<svg width=\"24\" height=\"24\"><path d=\"M7.8 19c-.3 0-.5 0-.6-.2l-.2-.5V5.7c0-.2 0-.4.2-.5l.6-.2h5c1.5 0 2.7.3 3.5 1 .7.6 1.1 1.4 1.1 2.5a3 3 0 0 1-.6 1.9c-.4.6-1 1-1.6 1.2.4.1.9.3 1.3.6s.8.7 1 1.2c.4.4.5 1 .5 1.6 0 1.3-.4 2.3-1.3 3-.8.7-2.1 1-3.8 1H7.8zm5-8.3c.6 0 1.2-.1 1.6-.5.4-.3.6-.7.6-1.3 0-1.1-.8-1.7-2.3-1.7H9.3v3.5h3.4zm.5 6c.7 0 1.3-.1 1.7-.4.4-.4.6-.9.6-1.5s-.2-1-.7-1.4c-.4-.3-1-.4-2-.4H9.4v3.8h4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'bookmark': '<svg width=\"24\" height=\"24\"><path d=\"M6 4v17l6-4 6 4V4c0-.6-.4-1-1-1H7a1 1 0 0 0-1 1z\" fill-rule=\"nonzero\"/></svg>',\r\n                'border-width': '<svg width=\"24\" height=\"24\"><path d=\"M5 14.8h14a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2zm-.5 3.7h15c.3 0 .5.2.5.5s-.2.5-.5.5h-15a.5.5 0 1 1 0-1zm.5-8.3h14c.6 0 1 .4 1 1v1c0 .5-.4 1-1 1H5a1 1 0 0 1-1-1v-1c0-.6.4-1 1-1zm0-5.7h14c.6 0 1 .4 1 1v2c0 .6-.4 1-1 1H5a1 1 0 0 1-1-1v-2c0-.6.4-1 1-1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'brightness': '<svg width=\"24\" height=\"24\"><path d=\"M12 17c.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3 1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7v-1c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3zm0-10a1 1 0 0 1-.7-.3A1 1 0 0 1 11 6V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v1c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3zm7 4c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 0 1-.7.3h-1a1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1zM7 12c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3H5a1 1 0 0 1-.7-.3A1 1 0 0 1 4 12c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h1c.3 0 .5.1.7.3.2.2.3.4.3.7zm10 3.5l.7.8c.2.1.3.4.3.6 0 .3-.1.6-.3.8a1 1 0 0 1-.8.3 1 1 0 0 1-.6-.3l-.8-.7a1 1 0 0 1-.3-.8c0-.2.1-.5.3-.7a1 1 0 0 1 1.4 0zm-10-7l-.7-.8a1 1 0 0 1-.3-.6c0-.3.1-.6.3-.8.2-.2.5-.3.8-.3.2 0 .5.1.7.3l.7.7c.2.2.3.5.3.8 0 .2-.1.5-.3.7a1 1 0 0 1-.7.3 1 1 0 0 1-.8-.3zm10 0a1 1 0 0 1-.8.3 1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7c0-.3.1-.6.3-.8l.8-.7c.1-.2.4-.3.6-.3.3 0 .6.1.8.3.2.2.3.5.3.8 0 .2-.1.5-.3.7l-.7.7zm-10 7c.2-.2.5-.3.8-.3.2 0 .5.1.7.3a1 1 0 0 1 0 1.4l-.8.8a1 1 0 0 1-.6.3 1 1 0 0 1-.8-.3 1 1 0 0 1-.3-.8c0-.2.1-.5.3-.6l.7-.8zM12 8a4 4 0 0 1 3.7 2.4 4 4 0 0 1 0 3.2A4 4 0 0 1 12 16a4 4 0 0 1-3.7-2.4 4 4 0 0 1 0-3.2A4 4 0 0 1 12 8zm0 6.5c.7 0 1.3-.2 1.8-.7.5-.5.7-1.1.7-1.8s-.2-1.3-.7-1.8c-.5-.5-1.1-.7-1.8-.7s-1.3.2-1.8.7c-.5.5-.7 1.1-.7 1.8s.2 1.3.7 1.8c.5.5 1.1.7 1.8.7z\" fill-rule=\"evenodd\"/></svg>',\r\n                'browse': '<svg width=\"24\" height=\"24\"><path d=\"M19 4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2h-4v-2h4V8H5v10h4v2H5a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2h14zm-8 9.4l-2.3 2.3a1 1 0 1 1-1.4-1.4l4-4a1 1 0 0 1 1.4 0l4 4a1 1 0 0 1-1.4 1.4L13 13.4V20a1 1 0 0 1-2 0v-6.6z\" fill-rule=\"nonzero\"/></svg>',\r\n                'cancel': '<svg width=\"24\" height=\"24\"><path d=\"M12 4.6a7.4 7.4 0 1 1 0 14.8 7.4 7.4 0 0 1 0-14.8zM12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18zm0 8L14.8 8l1 1.1-2.7 2.8 2.7 2.7-1.1 1.1-2.7-2.7-2.7 2.7-1-1.1 2.6-2.7-2.7-2.7 1-1.1 2.8 2.7z\" fill-rule=\"nonzero\"/></svg>',\r\n                'change-case': '<svg width=\"24\" height=\"24\"><path d=\"M18.4 18.2v-.6c-.5.8-1.3 1.2-2.4 1.2-2.2 0-3.3-1.6-3.3-4.8 0-3.1 1-4.7 3.3-4.7 1.1 0 1.8.3 2.4 1.1v-.6c0-.5.4-.8.8-.8s.8.3.8.8v8.4c0 .5-.4.8-.8.8a.8.8 0 0 1-.8-.8zm-2-7.4c-1.3 0-1.8.9-1.8 3.2 0 2.4.5 3.3 1.7 3.3 1.3 0 1.8-.9 1.8-3.2 0-2.4-.5-3.3-1.7-3.3zM10 15.7H5.5l-.8 2.6a1 1 0 0 1-1 .7h-.2a.7.7 0 0 1-.7-1l4-12a1 1 0 1 1 2 0l4 12a.7.7 0 0 1-.8 1h-.2a1 1 0 0 1-1-.7l-.8-2.6zm-.3-1.5l-2-6.5-1.9 6.5h3.9z\" fill-rule=\"evenodd\"/></svg>',\r\n                'character-count': '<svg width=\"24\" height=\"24\"><path d=\"M4 11.5h16v1H4v-1zm4.8-6.8V10H7.7V5.8h-1v-1h2zM11 8.3V9h2v1h-3V7.7l2-1v-.9h-2v-1h3v2.4l-2 1zm6.3-3.4V10h-3.1V9h2.1V8h-2.1V6.8h2.1v-1h-2.1v-1h3.1zM5.8 16.4c0-.5.2-.8.5-1 .2-.2.6-.3 1.2-.3l.8.1c.2 0 .4.2.5.3l.4.4v2.8l.2.3H8.2v-.1-.2l-.6.3H7c-.4 0-.7 0-1-.2a1 1 0 0 1-.3-.9c0-.3 0-.6.3-.8.3-.2.7-.4 1.2-.4l.6-.2h.3v-.2l-.1-.2a.8.8 0 0 0-.5-.1 1 1 0 0 0-.4 0l-.3.4h-1zm2.3.8h-.2l-.2.1-.4.1a1 1 0 0 0-.4.2l-.2.2.1.3.5.1h.4l.4-.4v-.6zm2-3.4h1.2v1.7l.5-.3h.5c.5 0 .9.1 1.2.5.3.4.5.8.5 1.4 0 .6-.2 1.1-.5 1.5-.3.4-.7.6-1.3.6l-.6-.1-.4-.4v.4h-1.1v-5.4zm1.1 3.3c0 .3 0 .6.2.8a.7.7 0 0 0 1.2 0l.2-.8c0-.4 0-.6-.2-.8a.7.7 0 0 0-.6-.3l-.6.3-.2.8zm6.1-.5c0-.2 0-.3-.2-.4a.8.8 0 0 0-.5-.2c-.3 0-.5.1-.6.3l-.2.9c0 .3 0 .6.2.8.1.2.3.3.6.3.2 0 .4 0 .5-.2l.2-.4h1.1c0 .5-.3.8-.6 1.1a2 2 0 0 1-1.3.4c-.5 0-1-.2-1.3-.6a2 2 0 0 1-.5-1.4c0-.6.1-1.1.5-1.5.3-.4.8-.5 1.4-.5.5 0 1 0 1.2.3.4.3.5.7.5 1.2h-1v-.1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'checklist-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M5 17h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1H5a1 1 0 1 1 0-2zm14.2 11c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L18 8c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z\" fill-rule=\"evenodd\"/></svg>',\r\n                'checklist': '<svg width=\"24\" height=\"24\"><path d=\"M11 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0-6h8a1 1 0 0 1 0 2h-8a1 1 0 0 1 0-2zM7.2 16c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 20c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 14c-.2.3-.7.4-1 0l-1.3-1.3a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8zm0-6c.2-.4.6-.5.9-.3.3.2.4.6.2 1L6 8c-.2.3-.7.4-1 0L3.8 6.9a.7.7 0 0 1 0-1c.3-.2.7-.2 1 0l.7.9 1.7-2.8z\" fill-rule=\"evenodd\"/></svg>',\r\n                'checkmark': '<svg width=\"24\" height=\"24\"><path d=\"M18.2 5.4a1 1 0 0 1 1.6 1.2l-8 12a1 1 0 0 1-1.5.1l-5-5a1 1 0 1 1 1.4-1.4l4.1 4.1 7.4-11z\" fill-rule=\"nonzero\"/></svg>',\r\n                'chevron-down': '<svg width=\"10\" height=\"10\"><path d=\"M8.7 2.2c.3-.3.8-.3 1 0 .4.4.4.9 0 1.2L5.7 7.8c-.3.3-.9.3-1.2 0L.2 3.4a.8.8 0 0 1 0-1.2c.3-.3.8-.3 1.1 0L5 6l3.7-3.8z\" fill-rule=\"nonzero\"/></svg>',\r\n                'chevron-left': '<svg width=\"10\" height=\"10\"><path d=\"M7.8 1.3L4 5l3.8 3.7c.3.3.3.8 0 1-.4.4-.9.4-1.2 0L2.2 5.7a.8.8 0 0 1 0-1.2L6.6.2C7 0 7.4 0 7.8.2c.3.3.3.8 0 1.1z\" fill-rule=\"nonzero\"/></svg>',\r\n                'chevron-right': '<svg width=\"10\" height=\"10\"><path d=\"M2.2 1.3a.8.8 0 0 1 0-1c.4-.4.9-.4 1.2 0l4.4 4.1c.3.4.3.9 0 1.2L3.4 9.8c-.3.3-.8.3-1.2 0a.8.8 0 0 1 0-1.1L6 5 2.2 1.3z\" fill-rule=\"nonzero\"/></svg>',\r\n                'chevron-up': '<svg width=\"10\" height=\"10\"><path d=\"M8.7 7.8L5 4 1.3 7.8c-.3.3-.8.3-1 0a.8.8 0 0 1 0-1.2l4.1-4.4c.3-.3.9-.3 1.2 0l4.2 4.4c.3.3.3.9 0 1.2-.3.3-.8.3-1.1 0z\" fill-rule=\"nonzero\"/></svg>',\r\n                'close': '<svg width=\"24\" height=\"24\"><path d=\"M17.3 8.2L13.4 12l3.9 3.8a1 1 0 0 1-1.5 1.5L12 13.4l-3.8 3.9a1 1 0 0 1-1.5-1.5l3.9-3.8-3.9-3.8a1 1 0 0 1 1.5-1.5l3.8 3.9 3.8-3.9a1 1 0 0 1 1.5 1.5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'code-sample': '<svg width=\"24\" height=\"26\"><path d=\"M7.1 11a2.8 2.8 0 0 1-.8 2 2.8 2.8 0 0 1 .8 2v1.7c0 .3.1.6.4.8.2.3.5.4.8.4.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.7 0-1.4-.3-2-.8-.5-.6-.8-1.3-.8-2V15c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 0 1-.4-.4v-.8c0-.2.2-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V9.3c0-.7.3-1.4.8-2 .6-.5 1.3-.8 2-.8.3 0 .4.2.4.4v.8c0 .2-.1.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8V11zm9.8 0V9.3c0-.3-.1-.6-.4-.8-.2-.3-.5-.4-.8-.4a.4.4 0 0 1-.4-.4V7c0-.2.1-.4.4-.4.7 0 1.4.3 2 .8.5.6.8 1.3.8 2V11c0 .3.1.6.4.8.2.3.5.4.8.4.2 0 .4.2.4.4v.8c0 .2-.2.4-.4.4-.3 0-.6.1-.8.4-.3.2-.4.5-.4.8v1.7c0 .7-.3 1.4-.8 2-.6.5-1.3.8-2 .8a.4.4 0 0 1-.4-.4v-.8c0-.2.1-.4.4-.4.3 0 .6-.1.8-.4.3-.2.4-.5.4-.8V15a2.8 2.8 0 0 1 .8-2 2.8 2.8 0 0 1-.8-2zm-3.3-.4c0 .4-.1.8-.5 1.1-.3.3-.7.5-1.1.5-.4 0-.8-.2-1.1-.5-.4-.3-.5-.7-.5-1.1 0-.5.1-.9.5-1.2.3-.3.7-.4 1.1-.4.4 0 .8.1 1.1.4.4.3.5.7.5 1.2zM12 13c.4 0 .8.1 1.1.5.4.3.5.7.5 1.1 0 1-.1 1.6-.5 2a3 3 0 0 1-1.1 1c-.4.3-.8.4-1.1.4a.5.5 0 0 1-.5-.5V17a3 3 0 0 0 1-.2l.6-.6c-.6 0-1-.2-1.3-.5-.2-.3-.3-.7-.3-1 0-.5.1-1 .5-1.2.3-.4.7-.5 1.1-.5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'color-levels': '<svg width=\"24\" height=\"24\"><path d=\"M17.5 11.4A9 9 0 0 1 18 14c0 .5 0 1-.2 1.4 0 .4-.3.9-.5 1.3a6.2 6.2 0 0 1-3.7 3 5.7 5.7 0 0 1-3.2 0A5.9 5.9 0 0 1 7.6 18a6.2 6.2 0 0 1-1.4-2.6 6.7 6.7 0 0 1 0-2.8c0-.4.1-.9.3-1.3a13.6 13.6 0 0 1 2.3-4A20 20 0 0 1 12 4a26.4 26.4 0 0 1 3.2 3.4 18.2 18.2 0 0 1 2.3 4zm-2 4.5c.4-.7.5-1.4.5-2a7.3 7.3 0 0 0-1-3.2c.2.6.2 1.2.2 1.9a4.5 4.5 0 0 1-1.3 3 5.3 5.3 0 0 1-2.3 1.5 4.9 4.9 0 0 1-2 .1 4.3 4.3 0 0 0 2.4.8 4 4 0 0 0 2-.6 4 4 0 0 0 1.5-1.5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'color-picker': '<svg width=\"24\" height=\"24\"><path d=\"M12 3a9 9 0 0 0 0 18 1.5 1.5 0 0 0 1.1-2.5c-.2-.3-.4-.6-.4-1 0-.8.7-1.5 1.5-1.5H16a5 5 0 0 0 5-5c0-4.4-4-8-9-8zm-5.5 9a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3-4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm3 4a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z\" fill-rule=\"nonzero\"/></svg>',\r\n                'color-swatch-remove-color': '<svg width=\"24\" height=\"24\"><path stroke=\"#000\" stroke-width=\"2\" d=\"M21 3L3 21\" fill-rule=\"evenodd\"/></svg>',\r\n                'color-swatch': '<svg width=\"24\" height=\"24\"><rect x=\"3\" y=\"3\" width=\"18\" height=\"18\" rx=\"1\" fill-rule=\"evenodd\"/></svg>',\r\n                'comment-add': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M9 19l3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h4v2zm-2 4v-4H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3h-6.4L7 23z\"/><path d=\"M13 10h2a1 1 0 0 1 0 2h-2v2a1 1 0 0 1-2 0v-2H9a1 1 0 0 1 0-2h2V8a1 1 0 0 1 2 0v2z\"/></g></svg>',\r\n                'comment': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M9 19l3-2h7c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H5a1 1 0 0 0-1 1v10c0 .6.4 1 1 1h4v2zm-2 4v-4H5a3 3 0 0 1-3-3V6a3 3 0 0 1 3-3h14a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3h-6.4L7 23z\"/></svg>',\r\n                'contrast': '<svg width=\"24\" height=\"24\"><path d=\"M12 4a7.8 7.8 0 0 1 5.7 2.3A8 8 0 1 1 12 4zm-6 8a6 6 0 0 0 6 6V6a6 6 0 0 0-6 6z\" fill-rule=\"evenodd\"/></svg>',\r\n                'copy': '<svg width=\"24\" height=\"24\"><path d=\"M16 3H6a2 2 0 0 0-2 2v11h2V5h10V3zm1 4a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V9c0-1.2.9-2 2-2h7zm0 12V9h-7v10h7z\" fill-rule=\"nonzero\"/></svg>',\r\n                'crop': '<svg width=\"24\" height=\"24\"><path d=\"M17 8v7h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v2c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-2H7V9H5a1 1 0 1 1 0-2h2V5c0-.6.4-1 1-1s1 .4 1 1v2h7l3-3 1 1-3 3zM9 9v5l5-5H9zm1 6h5v-5l-5 5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'cut': '<svg width=\"24\" height=\"24\"><path d=\"M18 15c.6.7 1 1.4 1 2.3 0 .8-.2 1.5-.7 2l-.8.5-1 .2c-.4 0-.8 0-1.2-.3a3.9 3.9 0 0 1-2.1-2.2c-.2-.5-.3-1-.2-1.5l-1-1-1 1c0 .5 0 1-.2 1.5-.1.5-.4 1-.9 1.4-.3.4-.7.6-1.2.8l-1.2.3c-.4 0-.7 0-1-.2-.3 0-.6-.3-.8-.5-.5-.5-.8-1.2-.7-2 0-.9.4-1.6 1-2.2A3.7 3.7 0 0 1 8.6 14H9l1-1-4-4-.5-1a3.3 3.3 0 0 1 0-2c0-.4.3-.7.5-1l6 6 6-6 .5 1a3.3 3.3 0 0 1 0 2c0 .4-.3.7-.5 1l-4 4 1 1h.5c.4 0 .8 0 1.2.3.5.2.9.4 1.2.8zm-8.5 2.2l.1-.4v-.3-.4a1 1 0 0 0-.2-.5 1 1 0 0 0-.4-.2 1.6 1.6 0 0 0-.8 0 2.6 2.6 0 0 0-.8.3 2.5 2.5 0 0 0-.9 1.1l-.1.4v.7l.2.5.5.2h.7a2.5 2.5 0 0 0 .8-.3 2.8 2.8 0 0 0 1-1zm2.5-2.8c.4 0 .7-.1 1-.4.3-.3.4-.6.4-1s-.1-.7-.4-1c-.3-.3-.6-.4-1-.4s-.7.1-1 .4c-.3.3-.4.6-.4 1s.1.7.4 1c.3.3.6.4 1 .4zm5.4 4l.2-.5v-.4-.3a2.6 2.6 0 0 0-.3-.8 2.4 2.4 0 0 0-.7-.7 2.5 2.5 0 0 0-.8-.3 1.5 1.5 0 0 0-.8 0 1 1 0 0 0-.4.2 1 1 0 0 0-.2.5 1.5 1.5 0 0 0 0 .7v.4l.3.4.3.4a2.8 2.8 0 0 0 .8.5l.4.1h.7l.5-.2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'document-properties': '<svg width=\"24\" height=\"24\"><path d=\"M14.4 3H7a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V7.6L14.4 3zM17 19H7V5h6v4h4v10z\" fill-rule=\"nonzero\"/></svg>',\r\n                'drag': '<svg width=\"24\" height=\"24\"><path d=\"M13 5h2v2h-2V5zm0 4h2v2h-2V9zM9 9h2v2H9V9zm4 4h2v2h-2v-2zm-4 0h2v2H9v-2zm0 4h2v2H9v-2zm4 0h2v2h-2v-2zM9 5h2v2H9V5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'duplicate': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M16 3v2H6v11H4V5c0-1.1.9-2 2-2h10zm3 8h-2V9h-7v10h9a2 2 0 0 1-2 2h-7a2 2 0 0 1-2-2V9c0-1.2.9-2 2-2h7a2 2 0 0 1 2 2v2z\"/><path d=\"M17 14h1a1 1 0 0 1 0 2h-1v1a1 1 0 0 1-2 0v-1h-1a1 1 0 0 1 0-2h1v-1a1 1 0 0 1 2 0v1z\"/></g></svg>',\r\n                'edit-block': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M19.8 8.8l-9.4 9.4c-.2.2-.5.4-.9.4l-5.4 1.2 1.2-5.4.5-.8 9.4-9.4c.7-.7 1.8-.7 2.5 0l2.1 2.1c.7.7.7 1.8 0 2.5zm-2-.2l1-.9v-.3l-2.2-2.2a.3.3 0 0 0-.3 0l-1 1L18 8.5zm-1 1l-2.5-2.4-6 6 2.5 2.5 6-6zm-7 7.1l-2.6-2.4-.3.3-.1.2-.7 3 3.1-.6h.1l.4-.5z\"/></svg>',\r\n                'edit-image': '<svg width=\"24\" height=\"24\"><path d=\"M18 16h2V7a2 2 0 0 0-2-2H7v2h11v9zM6 17h15a1 1 0 0 1 0 2h-1v1a1 1 0 0 1-2 0v-1H6a2 2 0 0 1-2-2V7H3a1 1 0 1 1 0-2h1V4a1 1 0 1 1 2 0v13zm3-5.3l1.3 2 3-4.7 3.7 6H7l2-3.3z\" fill-rule=\"nonzero\"/></svg>',\r\n                'embed-page': '<svg width=\"24\" height=\"24\"><path d=\"M19 6V5H5v14h2A13 13 0 0 1 19 6zm0 1.4c-.8.8-1.6 2.4-2.2 4.6H19V7.4zm0 5.6h-2.4c-.4 1.8-.6 3.8-.6 6h3v-6zm-4 6c0-2.2.2-4.2.6-6H13c-.7 1.8-1.1 3.8-1.1 6h3zm-4 0c0-2.2.4-4.2 1-6H9.6A12 12 0 0 0 8 19h3zM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1zm11.8 9c.4-1.9 1-3.4 1.8-4.5a9.2 9.2 0 0 0-4 4.5h2.2zm-3.4 0a12 12 0 0 1 2.8-4 12 12 0 0 0-5 4h2.2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'embed': '<svg width=\"24\" height=\"24\"><path d=\"M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1zm1 2v14h14V5H5zm4.8 2.6l5.6 4a.5.5 0 0 1 0 .8l-5.6 4A.5.5 0 0 1 9 16V8a.5.5 0 0 1 .8-.4z\" fill-rule=\"nonzero\"/></svg>',\r\n                'emoji': '<svg width=\"24\" height=\"24\"><path d=\"M9 11c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 0 0-1 1c0 .6.4 1 1 1zm6 0c.6 0 1-.4 1-1s-.4-1-1-1a1 1 0 0 0-1 1c0 .6.4 1 1 1zm-3 5.5c2.1 0 4-1.5 4.4-3.5H7.6c.5 2 2.3 3.5 4.4 3.5zM12 4a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm0 14.5a6.5 6.5 0 1 1 0-13 6.5 6.5 0 0 1 0 13z\" fill-rule=\"nonzero\"/></svg>',\r\n                'fill': '<svg width=\"24\" height=\"26\"><path d=\"M16.6 12l-9-9-1.4 1.4 2.4 2.4-5.2 5.1c-.5.6-.5 1.6 0 2.2L9 19.6a1.5 1.5 0 0 0 2.2 0l5.5-5.5c.5-.6.5-1.6 0-2.2zM5.2 13L10 8.2l4.8 4.8H5.2zM19 14.5s-2 2.2-2 3.5c0 1.1.9 2 2 2a2 2 0 0 0 2-2c0-1.3-2-3.5-2-3.5z\" fill-rule=\"nonzero\"/></svg>',\r\n                'flip-horizontally': '<svg width=\"24\" height=\"24\"><path d=\"M14 19h2v-2h-2v2zm4-8h2V9h-2v2zM4 7v10c0 1.1.9 2 2 2h3v-2H6V7h3V5H6a2 2 0 0 0-2 2zm14-2v2h2a2 2 0 0 0-2-2zm-7 16h2V3h-2v18zm7-6h2v-2h-2v2zm-4-8h2V5h-2v2zm4 12a2 2 0 0 0 2-2h-2v2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'flip-vertically': '<svg width=\"24\" height=\"24\"><path d=\"M5 14v2h2v-2H5zm8 4v2h2v-2h-2zm4-14H7a2 2 0 0 0-2 2v3h2V6h10v3h2V6a2 2 0 0 0-2-2zm2 14h-2v2a2 2 0 0 0 2-2zM3 11v2h18v-2H3zm6 7v2h2v-2H9zm8-4v2h2v-2h-2zM5 18c0 1.1.9 2 2 2v-2H5z\" fill-rule=\"nonzero\"/></svg>',\r\n                'format-painter': '<svg width=\"24\" height=\"24\"><path d=\"M18 5V4c0-.5-.4-1-1-1H5a1 1 0 0 0-1 1v4c0 .6.5 1 1 1h12c.6 0 1-.4 1-1V7h1v4H9v9c0 .6.4 1 1 1h2c.6 0 1-.4 1-1v-7h8V5h-3z\" fill-rule=\"nonzero\"/></svg>',\r\n                'fullscreen': '<svg width=\"24\" height=\"24\"><path d=\"M15.3 10l-1.2-1.3 2.9-3h-2.3a.9.9 0 1 1 0-1.7H19c.5 0 .9.4.9.9v4.4a.9.9 0 1 1-1.8 0V7l-2.9 3zm0 4l3 3v-2.3a.9.9 0 1 1 1.7 0V19c0 .5-.4.9-.9.9h-4.4a.9.9 0 1 1 0-1.8H17l-3-2.9 1.3-1.2zM10 15.4l-2.9 3h2.3a.9.9 0 1 1 0 1.7H5a.9.9 0 0 1-.9-.9v-4.4a.9.9 0 1 1 1.8 0V17l2.9-3 1.2 1.3zM8.7 10L5.7 7v2.3a.9.9 0 0 1-1.7 0V5c0-.5.4-.9.9-.9h4.4a.9.9 0 0 1 0 1.8H7l3 2.9-1.3 1.2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'gallery': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M5 15.7l2.3-2.2c.3-.3.7-.3 1 0L11 16l5.1-5c.3-.4.8-.4 1 0l2 1.9V8H5v7.7zM5 18V19h3l1.8-1.9-2-2L5 17.9zm14-3l-2.5-2.4-6.4 6.5H19v-4zM4 6h16c.6 0 1 .4 1 1v13c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V7c0-.6.4-1 1-1zm6 7a2 2 0 1 1 0-4 2 2 0 0 1 0 4zM4.5 4h15a.5.5 0 1 1 0 1h-15a.5.5 0 0 1 0-1zm2-2h11a.5.5 0 1 1 0 1h-11a.5.5 0 0 1 0-1z\"/></svg>',\r\n                'gamma': '<svg width=\"24\" height=\"24\"><path d=\"M4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1zm1 2v14h14V5H5zm6.5 11.8V14L9.2 8.7a5.1 5.1 0 0 0-.4-.8l-.1-.2H8 8v-1l.3-.1.3-.1h.7a1 1 0 0 1 .6.5l.1.3a8.5 8.5 0 0 1 .3.6l1.9 4.6 2-5.2a1 1 0 0 1 1-.6.5.5 0 0 1 .5.6L13 14v2.8a.7.7 0 0 1-1.4 0z\" fill-rule=\"nonzero\"/></svg>',\r\n                'help': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M12 5.5a6.5 6.5 0 0 0-6 9 6.3 6.3 0 0 0 1.4 2l1 1a6.3 6.3 0 0 0 3.6 1 6.5 6.5 0 0 0 6-9 6.3 6.3 0 0 0-1.4-2l-1-1a6.3 6.3 0 0 0-3.6-1zM12 4a7.8 7.8 0 0 1 5.7 2.3A8 8 0 1 1 12 4z\"/><path d=\"M9.6 9.7a.7.7 0 0 1-.7-.8c0-1.1 1.5-1.8 3.2-1.8 1.8 0 3.2.8 3.2 2.4 0 1.4-.4 2.1-1.5 2.8-.2 0-.3.1-.3.2a2 2 0 0 0-.8.8.8.8 0 0 1-1.4-.6c.3-.7.8-1 1.3-1.5l.4-.2c.7-.4.8-.6.8-1.5 0-.5-.6-.9-1.7-.9-.5 0-1 .1-1.4.3-.2 0-.3.1-.3.2v-.2c0 .4-.4.8-.8.8z\" fill-rule=\"nonzero\"/><circle cx=\"12\" cy=\"16\" r=\"1\"/></g></svg>',\r\n                'highlight-bg-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path id=\"tox-icon-highlight-bg-color__color\" d=\"M3 18h18v3H3z\"/><path fill-rule=\"nonzero\" d=\"M7.7 16.7H3l3.3-3.3-.7-.8L10.2 8l4 4.1-4 4.2c-.2.2-.6.2-.8 0l-.6-.7-1.1 1.1zm5-7.5L11 7.4l3-2.9a2 2 0 0 1 2.6 0L18 6c.7.7.7 2 0 2.7l-2.9 2.9-1.8-1.8-.5-.6\"/></g></svg>',\r\n                'home': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z\"/></svg>',\r\n                'horizontal-rule': '<svg width=\"24\" height=\"24\"><path d=\"M4 11h16v2H4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'image-options': '<svg width=\"24\" height=\"24\"><path d=\"M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'image': '<svg width=\"24\" height=\"24\"><path d=\"M5 15.7l3.3-3.2c.3-.3.7-.3 1 0L12 15l4.1-4c.3-.4.8-.4 1 0l2 1.9V5H5v10.7zM5 18V19h3l2.8-2.9-2-2L5 17.9zm14-3l-2.5-2.4-6.4 6.5H19v-4zM4 3h16c.6 0 1 .4 1 1v16c0 .6-.4 1-1 1H4a1 1 0 0 1-1-1V4c0-.6.4-1 1-1zm6 8a2 2 0 1 0 0-4 2 2 0 0 0 0 4z\" fill-rule=\"nonzero\"/></svg>',\r\n                'indent': '<svg width=\"24\" height=\"24\"><path d=\"M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 1 1 0-2zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2zm-5 4h12a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2zm-2.6-3.8L6.2 12l-1.8-1.2a1 1 0 0 1 1.2-1.6l3 2a1 1 0 0 1 0 1.6l-3 2a1 1 0 1 1-1.2-1.6z\" fill-rule=\"evenodd\"/></svg>',\r\n                'info': '<svg width=\"24\" height=\"24\"><path d=\"M12 4a7.8 7.8 0 0 1 5.7 2.3A8 8 0 1 1 12 4zm-1 3v2h2V7h-2zm3 10v-1h-1v-5h-3v1h1v4h-1v1h4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'insert-character': '<svg width=\"24\" height=\"24\"><path d=\"M15 18h4l1-2v4h-6v-3.3l1.4-1a6 6 0 0 0 1.8-2.9 6.3 6.3 0 0 0-.1-4.1 5.8 5.8 0 0 0-3-3.2c-.6-.3-1.3-.5-2.1-.5a5.1 5.1 0 0 0-3.9 1.8 6.3 6.3 0 0 0-1.3 6 6.2 6.2 0 0 0 1.8 3l1.4.9V20H4v-4l1 2h4v-.5l-2-1L5.4 15A6.5 6.5 0 0 1 4 11c0-1 .2-1.9.6-2.7A7 7 0 0 1 6.3 6C7.1 5.4 8 5 9 4.5c1-.3 2-.5 3.1-.5a8.8 8.8 0 0 1 5.7 2 7 7 0 0 1 1.7 2.3 6 6 0 0 1 .2 4.8c-.2.7-.6 1.3-1 1.9a7.6 7.6 0 0 1-3.6 2.5v.5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'insert-time': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M12 19a7 7 0 1 0 0-14 7 7 0 0 0 0 14zm0 2a9 9 0 1 1 0-18 9 9 0 0 1 0 18z\"/><path d=\"M16 12h-3V7c0-.6-.4-1-1-1a1 1 0 0 0-1 1v7h5c.6 0 1-.4 1-1s-.4-1-1-1z\"/></g></svg>',\r\n                'invert': '<svg width=\"24\" height=\"24\"><path d=\"M18 19.3L16.5 18a5.8 5.8 0 0 1-3.1 1.9 6.1 6.1 0 0 1-5.5-1.6A5.8 5.8 0 0 1 6 14v-.3l.1-1.2A13.9 13.9 0 0 1 7.7 9l-3-3 .7-.8 2.8 2.9 9 8.9 1.5 1.6-.7.6zm0-5.5v.3l-.1 1.1-.4 1-1.2-1.2a4.3 4.3 0 0 0 .2-1v-.2c0-.4 0-.8-.2-1.3l-.5-1.4a14.8 14.8 0 0 0-3-4.2L12 6a26.1 26.1 0 0 0-2.2 2.5l-1-1a20.9 20.9 0 0 1 2.9-3.3L12 4l1 .8a22.2 22.2 0 0 1 4 5.4c.6 1.2 1 2.4 1 3.6z\" fill-rule=\"evenodd\"/></svg>',\r\n                'italic': '<svg width=\"24\" height=\"24\"><path d=\"M16.7 4.7l-.1.9h-.3c-.6 0-1 0-1.4.3-.3.3-.4.6-.5 1.1l-2.1 9.8v.6c0 .5.4.8 1.4.8h.2l-.2.8H8l.2-.8h.2c1.1 0 1.8-.5 2-1.5l2-9.8.1-.5c0-.6-.4-.8-1.4-.8h-.3l.2-.9h5.8z\" fill-rule=\"evenodd\"/></svg>',\r\n                'line': '<svg width=\"24\" height=\"24\"><path d=\"M15 9l-8 8H4v-3l8-8 3 3zm1-1l-3-3 1-1h1c-.2 0 0 0 0 0l2 2s0 .2 0 0v1l-1 1zM4 18h16v2H4v-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'link': '<svg width=\"24\" height=\"24\"><path d=\"M6.2 12.3a1 1 0 0 1 1.4 1.4l-2.1 2a2 2 0 1 0 2.7 2.8l4.8-4.8a1 1 0 0 0 0-1.4 1 1 0 1 1 1.4-1.3 2.9 2.9 0 0 1 0 4L9.6 20a3.9 3.9 0 0 1-5.5-5.5l2-2zm11.6-.6a1 1 0 0 1-1.4-1.4l2-2a2 2 0 1 0-2.6-2.8L11 10.3a1 1 0 0 0 0 1.4A1 1 0 1 1 9.6 13a2.9 2.9 0 0 1 0-4L14.4 4a3.9 3.9 0 0 1 5.5 5.5l-2 2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'list-bull-circle': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path d=\"M11 16a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 1a3 3 0 1 1 0-6 3 3 0 0 1 0 6zM11 26a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 1a3 3 0 1 1 0-6 3 3 0 0 1 0 6zM11 36a2 2 0 1 0 0-4 2 2 0 0 0 0 4zm0 1a3 3 0 1 1 0-6 3 3 0 0 1 0 6z\" fill-rule=\"nonzero\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\r\n                'list-bull-default': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><circle cx=\"11\" cy=\"14\" r=\"3\"/><circle cx=\"11\" cy=\"24\" r=\"3\"/><circle cx=\"11\" cy=\"34\" r=\"3\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\r\n                'list-bull-square': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path d=\"M8 11h6v6H8zM8 21h6v6H8zM8 31h6v6H8z\"/><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/></g></svg>',\r\n                'list-num-default-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M37.4 17v-4.8l-1.6 1v-1.1l1.6-1h1.2V17zM33.3 17.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm1.7 5.7c0-1.2 1-2 2.2-2 1.3 0 2.1.8 2.1 1.8 0 .7-.3 1.2-1.3 2.2l-1.2 1v.2h2.6v1h-4.3v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H35zm-1.7 4.3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm3.2 7.3v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H35c0-1.1 1-1.8 2.2-1.8 1.2 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.7.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .6 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm-3.3 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z\"/></g></svg>',\r\n                'list-num-default': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10 17v-4.8l-1.5 1v-1.1l1.6-1h1.2V17h-1.2zm3.6.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm-5 5.7c0-1.2.8-2 2.1-2s2.1.8 2.1 1.8c0 .7-.3 1.2-1.4 2.2l-1.1 1v.2h2.6v1H8.6v-.9l2-1.9c.8-.8 1-1.1 1-1.5 0-.5-.4-.8-1-.8-.5 0-.9.3-.9.9H8.5zm6.3 4.3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM10 34.4v-1h.7c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7s-1 .3-1 .8H8.6c0-1.1 1-1.8 2.2-1.8 1.3 0 2.1.6 2.1 1.6 0 .7-.4 1.2-1 1.3v.1c.8.1 1.3.7 1.3 1.4 0 1-1 1.9-2.4 1.9-1.3 0-2.2-.8-2.3-2h1.2c0 .6.5 1 1.1 1 .7 0 1-.4 1-1 0-.5-.3-.8-1-.8h-.7zm4.7 2.7c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7z\"/></g></svg>',\r\n                'list-num-lower-alpha-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M36.5 16c-.9 0-1.5-.5-1.5-1.3s.6-1.3 1.8-1.4h1v-.4c0-.4-.2-.6-.7-.6-.4 0-.7.1-.8.4h-1.1c0-.8.8-1.4 2-1.4S39 12 39 13V16h-1.2v-.6c-.3.4-.8.7-1.4.7zm.4-.8c.6 0 1-.4 1-.9V14h-1c-.5.1-.7.3-.7.6 0 .4.3.6.7.6zM33.1 16.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zM37.7 26c-.7 0-1.2-.2-1.5-.7v.7H35v-6.3h1.2v2.5c.3-.5.8-.9 1.5-.9 1.1 0 1.8 1 1.8 2.4 0 1.5-.7 2.4-1.8 2.4zm-.5-3.6c-.6 0-1 .5-1 1.3s.4 1.4 1 1.4c.7 0 1-.6 1-1.4 0-.8-.3-1.3-1-1.3zM33.2 26.1c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm6 7h-1c-.1-.5-.4-.8-1-.8s-1 .5-1 1.4c0 1 .4 1.4 1 1.4.5 0 .9-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm-6.1 3c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\r\n                'list-num-lower-alpha': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10.3 15.2c.5 0 1-.4 1-.9V14h-1c-.5.1-.8.3-.8.6 0 .4.3.6.8.6zm-.4.9c-1 0-1.5-.6-1.5-1.4 0-.8.6-1.3 1.7-1.4h1.1v-.4c0-.4-.2-.6-.7-.6-.5 0-.8.1-.9.4h-1c0-.8.8-1.4 2-1.4 1.1 0 1.8.6 1.8 1.6V16h-1.1v-.6h-.1c-.2.4-.7.7-1.3.7zm4.6 0c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-3.2 10c-.6 0-1.2-.3-1.4-.8v.7H8.5v-6.3H10v2.5c.3-.5.8-.9 1.4-.9 1.2 0 1.9 1 1.9 2.4 0 1.5-.7 2.4-1.9 2.4zm-.4-3.7c-.7 0-1 .5-1 1.3s.3 1.4 1 1.4c.6 0 1-.6 1-1.4 0-.8-.4-1.3-1-1.3zm4 3.7c-.5 0-.7-.3-.7-.7 0-.4.2-.7.7-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-2.2 7h-1.2c0-.5-.4-.8-.9-.8-.6 0-1 .5-1 1.4 0 1 .4 1.4 1 1.4.5 0 .8-.2 1-.7h1c0 1-.8 1.7-2 1.7-1.4 0-2.2-.9-2.2-2.4s.8-2.4 2.2-2.4c1.2 0 2 .7 2 1.7zm1.8 3c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\r\n                'list-num-lower-greek-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M37.4 16c-1.2 0-2-.8-2-2.3 0-1.5.8-2.4 2-2.4.6 0 1 .4 1.3 1v-.9H40v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1-.7h-.2c-.2.4-.7.8-1.3.8zm.3-1c.6 0 1-.5 1-1.3s-.4-1.3-1-1.3-1 .5-1 1.3.4 1.4 1 1.4zM33.3 16.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM36 21.9c0-1.5.8-2.3 2.1-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.9 1.3.9.3 1.3.8 1.3 1.7 0 1.2-.7 1.9-1.8 1.9-.6 0-1.1-.3-1.4-.8v2.2H36V22zm1.8 1.2v-1h.3c.5 0 .9-.2.9-.7 0-.5-.3-.8-.9-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1 1.3s1-.4 1-1-.4-1-1.2-1h-.3zM33.3 26.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zM37.1 34.6L34.8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.2.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2zm.7 1a2 2 0 0 0-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1zM33.3 36.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\r\n                'list-num-lower-greek': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M10.5 15c.7 0 1-.5 1-1.3s-.3-1.3-1-1.3c-.5 0-.9.5-.9 1.3s.4 1.4 1 1.4zm-.3 1c-1.1 0-1.8-.8-1.8-2.3 0-1.5.7-2.4 1.8-2.4.7 0 1.1.4 1.3 1h.1v-.9h1.2v3.2c0 .4.1.5.4.5h.2v.9h-.6c-.6 0-1-.2-1.1-.7h-.1c-.2.4-.7.8-1.4.8zm5 .1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.7-.7.5 0 .8.3.8.7 0 .4-.3.7-.8.7zm-4.9 7v-1h.3c.6 0 1-.2 1-.7 0-.5-.4-.8-1-.8-.5 0-.8.3-.8 1v2.2c0 .8.4 1.3 1.1 1.3.6 0 1-.4 1-1s-.5-1-1.3-1h-.3zM8.6 22c0-1.5.7-2.3 2-2.3 1.2 0 2 .6 2 1.6 0 .6-.3 1-.8 1.3.8.3 1.3.8 1.3 1.7 0 1.2-.8 1.9-1.9 1.9-.6 0-1.1-.3-1.3-.8v2.2H8.5V22zm6.2 4.2c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm-4.5 8.5L8 30h1.4l1.7 3.5 1.7-3.5h1.1l-2.2 4.6v.1c.5.8.7 1.4.7 1.8 0 .4-.1.8-.4 1-.2.2-.6.3-1 .3-.9 0-1.3-.4-1.3-1.2 0-.5.2-1 .5-1.7l.1-.2zm.7 1a2 2 0 0 0-.4.9c0 .3.1.4.4.4.3 0 .4-.1.4-.4 0-.2-.1-.6-.4-1zm4.5.5c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\r\n                'list-num-lower-roman-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M32.9 16v-1.2h-1.3V16H33zm0 10v-1.2h-1.3V26H33zm0 10v-1.2h-1.3V36H33z\"/><path fill-rule=\"nonzero\" d=\"M36 21h-1.5v5H36zM36 31h-1.5v5H36zM39 21h-1.5v5H39zM39 31h-1.5v5H39zM42 31h-1.5v5H42zM36 11h-1.5v5H36zM36 19h-1.5v1H36zM36 29h-1.5v1H36zM39 19h-1.5v1H39zM39 29h-1.5v1H39zM42 29h-1.5v1H42zM36 9h-1.5v1H36z\"/></g></svg>',\r\n                'list-num-lower-roman': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M15.1 16v-1.2h1.3V16H15zm0 10v-1.2h1.3V26H15zm0 10v-1.2h1.3V36H15z\"/><path fill-rule=\"nonzero\" d=\"M12 21h1.5v5H12zM12 31h1.5v5H12zM9 21h1.5v5H9zM9 31h1.5v5H9zM6 31h1.5v5H6zM12 11h1.5v5H12zM12 19h1.5v1H12zM12 29h1.5v1H12zM9 19h1.5v1H9zM9 29h1.5v1H9zM6 29h1.5v1H6zM12 9h1.5v1H12z\"/></g></svg>',\r\n                'list-num-upper-alpha-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M39.3 17l-.5-1.4h-2l-.5 1.4H35l2-6h1.6l2 6h-1.3zm-1.6-4.7l-.7 2.3h1.6l-.8-2.3zM33.4 17c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zm4.7 9.9h-2.7v-6H38c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7zm-1.4-5v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1zm0 4h1.1c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9h-1.1V26zM33 27.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm4.9 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2zm-4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\r\n                'list-num-upper-alpha': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M12.6 17l-.5-1.4h-2L9.5 17H8.3l2-6H12l2 6h-1.3zM11 12.3l-.7 2.3h1.6l-.8-2.3zm4.7 4.8c-.4 0-.7-.3-.7-.7 0-.4.3-.7.7-.7.5 0 .7.3.7.7 0 .4-.2.7-.7.7zM11.4 27H8.7v-6h2.6c1.2 0 1.9.6 1.9 1.5 0 .6-.5 1.2-1 1.3.7.1 1.3.7 1.3 1.5 0 1-.8 1.7-2 1.7zM10 22v1.5h1c.6 0 1-.3 1-.8 0-.4-.4-.7-1-.7h-1zm0 4H11c.7 0 1.1-.3 1.1-.8 0-.6-.4-.9-1.1-.9H10V26zm5.4 1.1c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7zm-4.1 10c-1.8 0-2.8-1.1-2.8-3.1s1-3.1 2.8-3.1c1.4 0 2.5.9 2.6 2.2h-1.3c0-.7-.6-1.1-1.3-1.1-1 0-1.6.7-1.6 2s.6 2 1.6 2c.7 0 1.2-.4 1.4-1h1.2c-.1 1.3-1.2 2.2-2.6 2.2zm4.5 0c-.5 0-.8-.3-.8-.7 0-.4.3-.7.8-.7.4 0 .7.3.7.7 0 .4-.3.7-.7.7z\"/></g></svg>',\r\n                'list-num-upper-roman-rtl': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M8 12h22v4H8zM8 22h22v4H8zM8 32h22v4H8z\"/><path d=\"M31.6 17v-1.2H33V17h-1.3zm0 10v-1.2H33V27h-1.3zm0 10v-1.2H33V37h-1.3z\"/><path fill-rule=\"nonzero\" d=\"M34.5 20H36v7h-1.5zM34.5 30H36v7h-1.5zM37.5 20H39v7h-1.5zM37.5 30H39v7h-1.5zM40.5 30H42v7h-1.5zM34.5 10H36v7h-1.5z\"/></g></svg>',\r\n                'list-num-upper-roman': '<svg width=\"48\" height=\"48\"><g fill-rule=\"evenodd\"><path opacity=\".2\" d=\"M18 12h22v4H18zM18 22h22v4H18zM18 32h22v4H18z\"/><path d=\"M15.1 17v-1.2h1.3V17H15zm0 10v-1.2h1.3V27H15zm0 10v-1.2h1.3V37H15z\"/><path fill-rule=\"nonzero\" d=\"M12 20h1.5v7H12zM12 30h1.5v7H12zM9 20h1.5v7H9zM9 30h1.5v7H9zM6 30h1.5v7H6zM12 10h1.5v7H12z\"/></g></svg>',\r\n                'lock': '<svg width=\"24\" height=\"24\"><path d=\"M16.3 11c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H8V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h.3zM10 8v3h4V8a1 1 0 0 0-.3-.7A1 1 0 0 0 13 7h-2a1 1 0 0 0-.7.3 1 1 0 0 0-.3.7z\" fill-rule=\"evenodd\"/></svg>',\r\n                'ltr': '<svg width=\"24\" height=\"24\"><path d=\"M11 5h7a1 1 0 0 1 0 2h-1v11a1 1 0 0 1-2 0V7h-2v11a1 1 0 0 1-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 7.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L11 5zM4.4 16.2L6.2 15l-1.8-1.2a1 1 0 0 1 1.2-1.6l3 2a1 1 0 0 1 0 1.6l-3 2a1 1 0 1 1-1.2-1.6z\" fill-rule=\"evenodd\"/></svg>',\r\n                'more-drawer': '<svg width=\"24\" height=\"24\"><path d=\"M6 10a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm12 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2zm-6 0a2 2 0 0 0-2 2c0 1.1.9 2 2 2a2 2 0 0 0 2-2 2 2 0 0 0-2-2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'new-document': '<svg width=\"24\" height=\"24\"><path d=\"M14.4 3H7a2 2 0 0 0-2 2v14c0 1.1.9 2 2 2h10a2 2 0 0 0 2-2V7.6L14.4 3zM17 19H7V5h6v4h4v10z\" fill-rule=\"nonzero\"/></svg>',\r\n                'new-tab': '<svg width=\"24\" height=\"24\"><path d=\"M15 13l2-2v8H5V7h8l-2 2H7v8h8v-4zm4-8v5.5l-2-2-5.6 5.5H10v-1.4L15.5 7l-2-2H19z\" fill-rule=\"evenodd\"/></svg>',\r\n                'non-breaking': '<svg width=\"24\" height=\"24\"><path d=\"M11 11H8a1 1 0 1 1 0-2h3V6c0-.6.4-1 1-1s1 .4 1 1v3h3c.6 0 1 .4 1 1s-.4 1-1 1h-3v3c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-3zm10 4v5H3v-5c0-.6.4-1 1-1s1 .4 1 1v3h14v-3c0-.6.4-1 1-1s1 .4 1 1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'notice': '<svg width=\"24\" height=\"24\"><path d=\"M17.8 9.8L15.4 4 20 8.5v7L15.5 20h-7L4 15.5v-7L8.5 4h7l2.3 5.8zm0 0l2.2 5.7-2.3-5.8zM13 17v-2h-2v2h2zm0-4V7h-2v6h2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'ordered-list-rtl': '<svg width=\"24\" height=\"24\"><path d=\"M6 17h8a1 1 0 0 1 0 2H6a1 1 0 0 1 0-2zm0-6h8a1 1 0 0 1 0 2H6a1 1 0 0 1 0-2zm0-6h8a1 1 0 0 1 0 2H6a1 1 0 1 1 0-2zm13-1v3.5a.5.5 0 1 1-1 0V5h-.5a.5.5 0 1 1 0-1H19zm-1 8.8l.2.2h1.3a.5.5 0 1 1 0 1h-1.6a1 1 0 0 1-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 0 0-.2-.2h-1.3a.5.5 0 0 1-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3zm2 4.2v2c0 .6-.4 1-1 1h-1.5a.5.5 0 0 1 0-1h1.2a.3.3 0 1 0 0-.6h-1.3a.4.4 0 1 1 0-.8h1.3a.3.3 0 0 0 0-.6h-1.2a.5.5 0 1 1 0-1H19c.6 0 1 .4 1 1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'ordered-list': '<svg width=\"24\" height=\"24\"><path d=\"M10 17h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0-6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 1 1 0-2zM6 4v3.5c0 .3-.2.5-.5.5a.5.5 0 0 1-.5-.5V5h-.5a.5.5 0 0 1 0-1H6zm-1 8.8l.2.2h1.3c.3 0 .5.2.5.5s-.2.5-.5.5H4.9a1 1 0 0 1-.9-1V13c0-.4.3-.8.6-1l1.2-.4.2-.3a.2.2 0 0 0-.2-.2H4.5a.5.5 0 0 1-.5-.5c0-.3.2-.5.5-.5h1.6c.5 0 .9.4.9 1v.1c0 .4-.3.8-.6 1l-1.2.4-.2.3zM7 17v2c0 .6-.4 1-1 1H4.5a.5.5 0 0 1 0-1h1.2c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.4a.4.4 0 1 1 0-.8h1.3c.2 0 .3-.1.3-.3 0-.2-.1-.3-.3-.3H4.5a.5.5 0 1 1 0-1H6c.6 0 1 .4 1 1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'orientation': '<svg width=\"24\" height=\"24\"><path d=\"M7.3 6.4L1 13l6.4 6.5 6.5-6.5-6.5-6.5zM3.7 13l3.6-3.7L11 13l-3.7 3.7-3.6-3.7zM12 6l2.8 2.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0L9.2 5.7a.8.8 0 0 1 0-1.2L13.6.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L12 4h1a9 9 0 1 1-4.3 16.9l1.5-1.5A7 7 0 1 0 13 6h-1z\" fill-rule=\"nonzero\"/></svg>',\r\n                'outdent': '<svg width=\"24\" height=\"24\"><path d=\"M7 5h12c.6 0 1 .4 1 1s-.4 1-1 1H7a1 1 0 1 1 0-2zm5 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2zm0 4h7c.6 0 1 .4 1 1s-.4 1-1 1h-7a1 1 0 0 1 0-2zm-5 4h12a1 1 0 0 1 0 2H7a1 1 0 0 1 0-2zm1.6-3.8a1 1 0 0 1-1.2 1.6l-3-2a1 1 0 0 1 0-1.6l3-2a1 1 0 0 1 1.2 1.6L6.8 12l1.8 1.2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'page-break': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M5 11c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2zm3 0h1c.6 0 1 .4 1 1s-.4 1-1 1h-1a1 1 0 0 1 0-2zm4 0c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2zM7 3v5h10V3c0-.6.4-1 1-1s1 .4 1 1v7H5V3c0-.6.4-1 1-1s1 .4 1 1zM6 22a1 1 0 0 1-1-1v-7h14v7c0 .6-.4 1-1 1a1 1 0 0 1-1-1v-5H7v5c0 .6-.4 1-1 1z\"/></g></svg>',\r\n                'paragraph': '<svg width=\"24\" height=\"24\"><path d=\"M10 5h7a1 1 0 0 1 0 2h-1v11a1 1 0 0 1-2 0V7h-2v11a1 1 0 0 1-2 0v-6c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 6.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L10 5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'paste-text': '<svg width=\"24\" height=\"24\"><path d=\"M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h3V9h9zM9 20H6a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0 1 12 1a3 3 0 0 1 2.8 2H18a2 2 0 0 1 2 2v4h1v12H9v-1zm1.5-9.5v9h9v-9h-9zM12 3a1 1 0 0 0-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1zm0 9h6v2h-.5l-.5-1h-1v4h.8v1h-3.6v-1h.8v-4h-1l-.5 1H12v-2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'paste': '<svg width=\"24\" height=\"24\"><path d=\"M18 9V5h-2v1c0 .6-.4 1-1 1H9a1 1 0 0 1-1-1V5H6v13h3V9h9zM9 20H6a2 2 0 0 1-2-2V5c0-1.1.9-2 2-2h3.2A3 3 0 0 1 12 1a3 3 0 0 1 2.8 2H18a2 2 0 0 1 2 2v4h1v12H9v-1zm1.5-9.5v9h9v-9h-9zM12 3a1 1 0 0 0-1 1c0 .5.4 1 1 1s1-.5 1-1-.4-1-1-1z\" fill-rule=\"nonzero\"/></svg>',\r\n                'permanent-pen': '<svg width=\"24\" height=\"24\"><path d=\"M10.5 17.5L8 20H3v-3l3.5-3.5a2 2 0 0 1 0-3L14 3l1 1-7.3 7.3a1 1 0 0 0 0 1.4l3.6 3.6c.4.4 1 .4 1.4 0L20 9l1 1-7.6 7.6a2 2 0 0 1-2.8 0l-.1-.1z\" fill-rule=\"nonzero\"/></svg>',\r\n                'plus': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\" stroke-linecap=\"round\" stroke-linejoin=\"round\" stroke=\"#000\" stroke-width=\"2\"><path d=\"M12 5v14M5 12h14\"/></g></svg>',\r\n                'preferences': '<svg width=\"24\" height=\"24\"><path d=\"M20.1 13.5l-1.9.2a5.8 5.8 0 0 1-.6 1.5l1.2 1.5c.4.4.3 1 0 1.4l-.7.7a1 1 0 0 1-1.4 0l-1.5-1.2a6.2 6.2 0 0 1-1.5.6l-.2 1.9c0 .5-.5.9-1 .9h-1a1 1 0 0 1-1-.9l-.2-1.9a5.8 5.8 0 0 1-1.5-.6l-1.5 1.2a1 1 0 0 1-1.4 0l-.7-.7a1 1 0 0 1 0-1.4l1.2-1.5a6.2 6.2 0 0 1-.6-1.5l-1.9-.2a1 1 0 0 1-.9-1v-1c0-.5.4-1 .9-1l1.9-.2a5.8 5.8 0 0 1 .6-1.5L5.2 7.3a1 1 0 0 1 0-1.4l.7-.7a1 1 0 0 1 1.4 0l1.5 1.2a6.2 6.2 0 0 1 1.5-.6l.2-1.9c0-.5.5-.9 1-.9h1c.5 0 1 .4 1 .9l.2 1.9a5.8 5.8 0 0 1 1.5.6l1.5-1.2a1 1 0 0 1 1.4 0l.7.7c.3.4.4 1 0 1.4l-1.2 1.5a6.2 6.2 0 0 1 .6 1.5l1.9.2c.5 0 .9.5.9 1v1c0 .5-.4 1-.9 1zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z\" fill-rule=\"evenodd\"/></svg>',\r\n                'preview': '<svg width=\"24\" height=\"24\"><path d=\"M3.5 12.5c.5.8 1.1 1.6 1.8 2.3 2 2 4.2 3.2 6.7 3.2s4.7-1.2 6.7-3.2a16.2 16.2 0 0 0 2.1-2.8 15.7 15.7 0 0 0-2.1-2.8c-2-2-4.2-3.2-6.7-3.2a9.3 9.3 0 0 0-6.7 3.2A16.2 16.2 0 0 0 3.2 12c0 .2.2.3.3.5zm-2.4-1l.7-1.2L4 7.8C6.2 5.4 8.9 4 12 4c3 0 5.8 1.4 8.1 3.8a18.2 18.2 0 0 1 2.8 3.7v1l-.7 1.2-2.1 2.5c-2.3 2.4-5 3.8-8.1 3.8-3 0-5.8-1.4-8.1-3.8a18.2 18.2 0 0 1-2.8-3.7 1 1 0 0 1 0-1zm12-3.3a2 2 0 1 0 2.7 2.6 4 4 0 1 1-2.6-2.6z\" fill-rule=\"nonzero\"/></svg>',\r\n                'print': '<svg width=\"24\" height=\"24\"><path d=\"M18 8H6a3 3 0 0 0-3 3v6h2v3h14v-3h2v-6a3 3 0 0 0-3-3zm-1 10H7v-4h10v4zm.5-5c-.8 0-1.5-.7-1.5-1.5s.7-1.5 1.5-1.5 1.5.7 1.5 1.5-.7 1.5-1.5 1.5zm.5-8H6v2h12V5z\" fill-rule=\"nonzero\"/></svg>',\r\n                'quote': '<svg width=\"24\" height=\"24\"><path d=\"M7.5 17h.9c.4 0 .7-.2.9-.6L11 13V8c0-.6-.4-1-1-1H6a1 1 0 0 0-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 0 0 .8 1.3zm8 0h.9c.4 0 .7-.2.9-.6L19 13V8c0-.6-.4-1-1-1h-4a1 1 0 0 0-1 1v4c0 .6.4 1 1 1h2l-1.3 2.7a1 1 0 0 0 .8 1.3z\" fill-rule=\"nonzero\"/></svg>',\r\n                'redo': '<svg width=\"24\" height=\"24\"><path d=\"M17.6 10H12c-2.8 0-4.4 1.4-4.9 3.5-.4 2 .3 4 1.4 4.6a1 1 0 1 1-1 1.8c-2-1.2-2.9-4.1-2.3-6.8.6-3 3-5.1 6.8-5.1h5.6l-3.3-3.3a1 1 0 1 1 1.4-1.4l5 5a1 1 0 0 1 0 1.4l-5 5a1 1 0 0 1-1.4-1.4l3.3-3.3z\" fill-rule=\"nonzero\"/></svg>',\r\n                'reload': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M5 22.1l-1.2-4.7v-.2a1 1 0 0 1 1-1l5 .4a1 1 0 1 1-.2 2l-2.2-.2a7.8 7.8 0 0 0 8.4.2 7.5 7.5 0 0 0 3.5-6.4 1 1 0 1 1 2 0 9.5 9.5 0 0 1-4.5 8 9.9 9.9 0 0 1-10.2 0l.4 1.4a1 1 0 1 1-2 .5zM13.6 7.4c0-.5.5-1 1-.9l2.8.2a8 8 0 0 0-9.5-1 7.5 7.5 0 0 0-3.6 7 1 1 0 0 1-2 0 9.5 9.5 0 0 1 4.5-8.6 10 10 0 0 1 10.9.3l-.3-1a1 1 0 0 1 2-.5l1.1 4.8a1 1 0 0 1-1 1.2l-5-.4a1 1 0 0 1-.9-1z\"/></g></svg>',\r\n                'remove-formatting': '<svg width=\"24\" height=\"24\"><path d=\"M13.2 6a1 1 0 0 1 0 .2l-2.6 10a1 1 0 0 1-1 .8h-.2a.8.8 0 0 1-.8-1l2.6-10H8a1 1 0 1 1 0-2h9a1 1 0 0 1 0 2h-3.8zM5 18h7a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2zm13 1.5L16.5 18 15 19.5a.7.7 0 0 1-1-1l1.5-1.5-1.5-1.5a.7.7 0 0 1 1-1l1.5 1.5 1.5-1.5a.7.7 0 0 1 1 1L17.5 17l1.5 1.5a.7.7 0 0 1-1 1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'remove': '<svg width=\"24\" height=\"24\"><path d=\"M16 7h3a1 1 0 0 1 0 2h-1v9a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3V9H5a1 1 0 1 1 0-2h3V6a3 3 0 0 1 3-3h2a3 3 0 0 1 3 3v1zm-2 0V6c0-.6-.4-1-1-1h-2a1 1 0 0 0-1 1v1h4zm2 2H8v9c0 .6.4 1 1 1h6c.6 0 1-.4 1-1V9zm-7 3a1 1 0 0 1 2 0v4a1 1 0 0 1-2 0v-4zm4 0a1 1 0 0 1 2 0v4a1 1 0 0 1-2 0v-4z\" fill-rule=\"nonzero\"/></svg>',\r\n                'resize-handle': '<svg width=\"10\" height=\"10\"><g fill-rule=\"nonzero\"><path d=\"M8.1 1.1A.5.5 0 1 1 9 2l-7 7A.5.5 0 1 1 1 8l7-7zM8.1 5.1A.5.5 0 1 1 9 6l-3 3A.5.5 0 1 1 5 8l3-3z\"/></g></svg>',\r\n                'resize': '<svg width=\"24\" height=\"24\"><path d=\"M4 5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h6c.3 0 .5.1.7.3.2.2.3.4.3.7 0 .3-.1.5-.3.7a1 1 0 0 1-.7.3H7.4L18 16.6V13c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3.3 0 .5.1.7.3.2.2.3.4.3.7v6c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3h-6a1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3.6L6 7.4V11c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3 1 1 0 0 1-.7-.3A1 1 0 0 1 4 11V5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'restore-draft': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M17 13c0 .6-.4 1-1 1h-4V8c0-.6.4-1 1-1s1 .4 1 1v4h2c.6 0 1 .4 1 1z\"/><path d=\"M4.7 10H9a1 1 0 0 1 0 2H3a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v3l2.5-2.4a9.2 9.2 0 0 1 10.8-1.5A9 9 0 0 1 13.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 1 1 1.3-1.5 7.2 7.2 0 0 0 11.6-3.7 7 7 0 0 0-3.5-7.7A7.2 7.2 0 0 0 8 7L4.7 10z\" fill-rule=\"nonzero\"/></g></svg>',\r\n                'rotate-left': '<svg width=\"24\" height=\"24\"><path d=\"M4.7 10H9a1 1 0 0 1 0 2H3a1 1 0 0 1-1-1V5a1 1 0 1 1 2 0v3l2.5-2.4a9.2 9.2 0 0 1 10.8-1.5A9 9 0 0 1 13.4 21c-2.4.1-4.7-.7-6.5-2.2a1 1 0 1 1 1.3-1.5 7.2 7.2 0 0 0 11.6-3.7 7 7 0 0 0-3.5-7.7A7.2 7.2 0 0 0 8 7L4.7 10z\" fill-rule=\"nonzero\"/></svg>',\r\n                'rotate-right': '<svg width=\"24\" height=\"24\"><path d=\"M20 8V5a1 1 0 0 1 2 0v6c0 .6-.4 1-1 1h-6a1 1 0 0 1 0-2h4.3L16 7A7.2 7.2 0 0 0 7.7 6a7 7 0 0 0 3 13.1c1.9.1 3.7-.5 5-1.7a1 1 0 0 1 1.4 1.5A9.2 9.2 0 0 1 2.2 14c-.9-3.9 1-8 4.5-9.9 3.5-1.9 8-1.3 10.8 1.5L20 8z\" fill-rule=\"nonzero\"/></svg>',\r\n                'rtl': '<svg width=\"24\" height=\"24\"><path d=\"M8 5h8v2h-2v12h-2V7h-2v12H8v-7c-.5 0-1 0-1.4-.3A3.4 3.4 0 0 1 4.8 10a3.3 3.3 0 0 1 0-2.8 3.4 3.4 0 0 1 1.8-1.8L8 5zm12 11.2a1 1 0 1 1-1 1.6l-3-2a1 1 0 0 1 0-1.6l3-2a1 1 0 1 1 1 1.6L18.4 15l1.8 1.2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'save': '<svg width=\"24\" height=\"24\"><path d=\"M5 16h14a2 2 0 0 1 2 2v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2c0-1.1.9-2 2-2zm0 2v2h14v-2H5zm10 0h2v2h-2v-2zm-4-6.4L8.7 9.3a1 1 0 1 0-1.4 1.4l4 4c.4.4 1 .4 1.4 0l4-4a1 1 0 1 0-1.4-1.4L13 11.6V4a1 1 0 0 0-2 0v7.6z\" fill-rule=\"nonzero\"/></svg>',\r\n                'search': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 1 1 1.4-1.4l4.3 4.4a1 1 0 0 1-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 1 0 0-12 6 6 0 0 0 0 12z\" fill-rule=\"nonzero\"/></svg>',\r\n                'select-all': '<svg width=\"24\" height=\"24\"><path d=\"M3 5h2V3a2 2 0 0 0-2 2zm0 8h2v-2H3v2zm4 8h2v-2H7v2zM3 9h2V7H3v2zm10-6h-2v2h2V3zm6 0v2h2a2 2 0 0 0-2-2zM5 21v-2H3c0 1.1.9 2 2 2zm-2-4h2v-2H3v2zM9 3H7v2h2V3zm2 18h2v-2h-2v2zm8-8h2v-2h-2v2zm0 8a2 2 0 0 0 2-2h-2v2zm0-12h2V7h-2v2zm0 8h2v-2h-2v2zm-4 4h2v-2h-2v2zm0-16h2V3h-2v2zM7 17h10V7H7v10zm2-8h6v6H9V9z\" fill-rule=\"nonzero\"/></svg>',\r\n                'selected': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2zm3.6 10.9L7 12.3a.7.7 0 0 0-1 1L9.6 17 18 8.6a.7.7 0 0 0 0-1 .7.7 0 0 0-1 0l-7.4 7.3z\"/></svg>',\r\n                'settings': '<svg width=\"24\" height=\"24\"><path d=\"M11 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6V8H5a1 1 0 1 1 0-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.5V6zM8 8h2V6H8v2zm9 2.8v.2h2c.6 0 1 .4 1 1s-.4 1-1 1h-2v.3c0 .2 0 .3-.2.5l-.6.2h-2.4c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6V13H5a1 1 0 0 1 0-2h8v-.3c0-.2 0-.3.2-.5l.6-.2h2.4c.3 0 .4 0 .6.2l.2.6zM14 13h2v-2h-2v2zm-3 2.8v.2h8c.6 0 1 .4 1 1s-.4 1-1 1h-8v.3c0 .2 0 .3-.2.5l-.6.2H7.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6V18H5a1 1 0 0 1 0-2h2v-.3c0-.2 0-.3.2-.5l.5-.2h2.5c.3 0 .4 0 .6.2l.2.6zM8 18h2v-2H8v2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'sharpen': '<svg width=\"24\" height=\"24\"><path d=\"M16 6l4 4-8 9-8-9 4-4h8zm-4 10.2l5.5-6.2-.1-.1H12v-.3h5.1l-.2-.2H12V9h4.6l-.2-.2H12v-.3h4.1l-.2-.2H12V8h3.6l-.2-.2H8.7L6.5 10l.1.1H12v.3H6.9l.2.2H12v.3H7.3l.2.2H12v.3H7.7l.3.2h4v.3H8.2l.2.2H12v.3H8.6l.3.2H12v.3H9l.3.2H12v.3H9.5l.2.2H12v.3h-2l.2.2H12v.3h-1.6l.2.2H12v.3h-1.1l.2.2h.9v.3h-.7l.2.2h.5v.3h-.3l.3.2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'sourcecode': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M9.8 15.7c.3.3.3.8 0 1-.3.4-.9.4-1.2 0l-4.4-4.1a.8.8 0 0 1 0-1.2l4.4-4.2c.3-.3.9-.3 1.2 0 .3.3.3.8 0 1.1L6 12l3.8 3.7zM14.2 15.7c-.3.3-.3.8 0 1 .4.4.9.4 1.2 0l4.4-4.1c.3-.3.3-.9 0-1.2l-4.4-4.2a.8.8 0 0 0-1.2 0c-.3.3-.3.8 0 1.1L18 12l-3.8 3.7z\"/></g></svg>',\r\n                'spell-check': '<svg width=\"24\" height=\"24\"><path d=\"M6 8v3H5V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h2c.3 0 .5.1.7.3.2.2.3.4.3.7v6H8V8H6zm0-3v2h2V5H6zm13 0h-3v5h3v1h-3a1 1 0 0 1-.7-.3 1 1 0 0 1-.3-.7V5c0-.3.1-.5.3-.7.2-.2.4-.3.7-.3h3v1zm-5 1.5l-.1.7c-.1.2-.3.3-.6.3.3 0 .5.1.6.3l.1.7V10c0 .3-.1.5-.3.7a1 1 0 0 1-.7.3h-3V4h3c.3 0 .5.1.7.3.2.2.3.4.3.7v1.5zM13 10V8h-2v2h2zm0-3V5h-2v2h2zm3 5l1 1-6.5 7L7 15.5l1.3-1 2.2 2.2L16 12z\" fill-rule=\"evenodd\"/></svg>',\r\n                'strike-through': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M15.6 8.5c-.5-.7-1-1.1-1.3-1.3-.6-.4-1.3-.6-2-.6-2.7 0-2.8 1.7-2.8 2.1 0 1.6 1.8 2 3.2 2.3 4.4.9 4.6 2.8 4.6 3.9 0 1.4-.7 4.1-5 4.1A6.2 6.2 0 0 1 7 16.4l1.5-1.1c.4.6 1.6 2 3.7 2 1.6 0 2.5-.4 3-1.2.4-.8.3-2-.8-2.6-.7-.4-1.6-.7-2.9-1-1-.2-3.9-.8-3.9-3.6C7.6 6 10.3 5 12.4 5c2.9 0 4.2 1.6 4.7 2.4l-1.5 1.1z\"/><path d=\"M5 11h14a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2z\" fill-rule=\"nonzero\"/></g></svg>',\r\n                'subscript': '<svg width=\"24\" height=\"24\"><path d=\"M10.4 10l4.6 4.6-1.4 1.4L9 11.4 4.4 16 3 14.6 7.6 10 3 5.4 4.4 4 9 8.6 13.6 4 15 5.4 10.4 10zM21 19h-5v-1l1-.8 1.7-1.6c.3-.4.5-.8.5-1.2 0-.3 0-.6-.2-.7-.2-.2-.5-.3-.9-.3a2 2 0 0 0-.8.2l-.7.3-.4-1.1 1-.6 1.2-.2c.8 0 1.4.3 1.8.7.4.4.6.9.6 1.5s-.2 1.1-.5 1.6a8 8 0 0 1-1.3 1.3l-.6.6h2.6V19z\" fill-rule=\"nonzero\"/></svg>',\r\n                'superscript': '<svg width=\"24\" height=\"24\"><path d=\"M15 9.4L10.4 14l4.6 4.6-1.4 1.4L9 15.4 4.4 20 3 18.6 7.6 14 3 9.4 4.4 8 9 12.6 13.6 8 15 9.4zm5.9 1.6h-5v-1l1-.8 1.7-1.6c.3-.5.5-.9.5-1.3 0-.3 0-.5-.2-.7-.2-.2-.5-.3-.9-.3l-.8.2-.7.4-.4-1.2c.2-.2.5-.4 1-.5.3-.2.8-.2 1.2-.2.8 0 1.4.2 1.8.6.4.4.6 1 .6 1.6 0 .5-.2 1-.5 1.5l-1.3 1.4-.6.5h2.6V11z\" fill-rule=\"nonzero\"/></svg>',\r\n                'table-cell-properties': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v14H4V5zm10 10h-4v3h4v-3zm0-8h-4v3h4V7zM9 7H5v3h4V7zm-4 4v3h4v-3H5zm10 0v3h4v-3h-4zm0-1h4V7h-4v3zM5 15v3h4v-3H5zm10 3h4v-3h-4v3z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-cell-select-all': '<svg width=\"24\" height=\"24\"><path d=\"M12.5 5.5v6h6v-6h-6zm-1 0h-6v6h6v-6zm1 13h6v-6h-6v6zm-1 0v-6h-6v6h6zm-7-14h15v15h-15v-15z\" fill-rule=\"nonzero\"/></svg>',\r\n                'table-cell-select-inner': '<svg width=\"24\" height=\"24\"><g fill-rule=\"nonzero\"><path d=\"M5.5 5.5v13h13v-13h-13zm-1-1h15v15h-15v-15z\" opacity=\".2\"/><path d=\"M11.5 11.5v-7h1v7h7v1h-7v7h-1v-7h-7v-1h7z\"/></g></svg>',\r\n                'table-delete-column': '<svg width=\"24\" height=\"24\"><path d=\"M9 11.2l1 1v.2l-1 1v-2.2zm5 1l1-1v2.2l-1-1v-.2zM20 5v14H4V5h16zm-1 2h-4v.8l-.2-.2-.8.8V7h-4v1.4l-.8-.8-.2.2V7H5v11h4v-1.8l.5.5.5-.4V18h4v-1.8l.8.8.2-.3V18h4V7zm-3.9 3.4l-1.8 1.9 1.8 1.9c.4.3.4.9 0 1.2-.3.3-.8.3-1.2 0L12 13.5l-1.8 1.9a.8.8 0 0 1-1.2 0 .9.9 0 0 1 0-1.2l1.8-1.9-1.9-2a.9.9 0 0 1 1.2-1.2l2 2 1.8-1.8c.3-.4.9-.4 1.2 0a.8.8 0 0 1 0 1.1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-delete-row': '<svg width=\"24\" height=\"24\"><path d=\"M16.7 8.8l1.1 1.2-2.4 2.5L18 15l-1.2 1.2-2.5-2.5-2.4 2.5-1.3-1.2 2.5-2.5-2.5-2.5 1.2-1.3 2.6 2.6 2.4-2.5zM4 5h16v14H4V5zm15 5V7H5v3h4.8l1 1H5v3h5.8l-1 1H5v3h14v-3h-.4l-1-1H19v-3h-1.3l1-1h.3z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-delete-table': '<svg width=\"24\" height=\"26\"><path d=\"M4 6h16v14H4V6zm1 2v11h14V8H5zm11.7 8.7l-1.5 1.5L12 15l-3.3 3.2-1.4-1.5 3.2-3.2-3.3-3.2 1.5-1.5L12 12l3.2-3.2 1.5 1.5-3.2 3.2 3.2 3.2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-insert-column-after': '<svg width=\"24\" height=\"24\"><path d=\"M14.3 9c.4 0 .7.3.7.6v2.2h2.1c.4 0 .7.3.7.7 0 .4-.3.7-.7.7H15v2.2c0 .3-.3.6-.7.6a.7.7 0 0 1-.6-.6v-2.2h-2.2a.7.7 0 0 1 0-1.4h2.2V9.6c0-.3.3-.6.6-.6zM4 5h16v14H4V5zm5 13v-3H5v3h4zm0-4v-3H5v3h4zm0-4V7H5v3h4zm10 8V7h-9v11h9z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-insert-column-before': '<svg width=\"24\" height=\"24\"><path d=\"M9.7 16a.7.7 0 0 1-.7-.6v-2.2H6.9a.7.7 0 0 1 0-1.4H9V9.6c0-.3.3-.6.7-.6.3 0 .6.3.6.6v2.2h2.2c.4 0 .8.3.8.7 0 .4-.4.7-.8.7h-2.2v2.2c0 .3-.3.6-.6.6zM4 5h16v14H4V5zm10 13V7H5v11h9zm5 0v-3h-4v3h4zm0-4v-3h-4v3h4zm0-4V7h-4v3h4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-insert-row-above': '<svg width=\"24\" height=\"24\"><path d=\"M14.8 10.5c0 .3-.2.5-.5.5h-1.8v1.8c0 .3-.2.5-.5.5a.5.5 0 0 1-.5-.6V11H9.7a.5.5 0 0 1 0-1h1.8V8.3c0-.3.2-.6.5-.6s.5.3.5.6V10h1.8c.3 0 .5.2.5.5zM4 5h16v14H4V5zm5 13v-3H5v3h4zm5 0v-3h-4v3h4zm5 0v-3h-4v3h4zm0-4V7H5v7h14z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-insert-row-after': '<svg width=\"24\" height=\"24\"><path d=\"M9.2 14.5c0-.3.2-.5.5-.5h1.8v-1.8c0-.3.2-.5.5-.5s.5.2.5.6V14h1.8c.3 0 .5.2.5.5s-.2.5-.5.5h-1.8v1.7c0 .3-.2.6-.5.6a.5.5 0 0 1-.5-.6V15H9.7a.5.5 0 0 1-.5-.5zM4 5h16v14H4V5zm6 2v3h4V7h-4zM5 7v3h4V7H5zm14 11v-7H5v7h14zm0-8V7h-4v3h4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-left-header': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v13H4V5zm10 12v-3h-4v3h4zm0-4v-3h-4v3h4zm0-4V6h-4v3h4zm5 8v-3h-4v3h4zm0-4v-3h-4v3h4zm0-4V6h-4v3h4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-merge-cells': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v14H4V5zm6 13h9v-7h-9v7zm4-11h-4v3h4V7zM9 7H5v3h4V7zm-4 4v3h4v-3H5zm10-1h4V7h-4v3zM5 15v3h4v-3H5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-row-properties': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v14H4V5zm10 10h-4v3h4v-3zm0-8h-4v3h4V7zM9 7H5v3h4V7zm6 3h4V7h-4v3zM5 15v3h4v-3H5zm10 3h4v-3h-4v3z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-split-cells': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v14H4V5zm6 2v3h4V7h-4zM9 18v-3H5v3h4zm0-4v-3H5v3h4zm0-4V7H5v3h4zm10 8v-7h-9v7h9zm0-8V7h-4v3h4zm-3.5 4.5l1.5 1.6c.3.2.3.7 0 1-.2.2-.7.2-1 0l-1.5-1.6-1.6 1.5c-.2.3-.7.3-1 0a.7.7 0 0 1 0-1l1.6-1.5-1.5-1.6a.7.7 0 0 1 1-1l1.5 1.6 1.6-1.5c.2-.3.7-.3 1 0 .2.2.2.7 0 1l-1.6 1.5z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table-top-header': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v13H4V5zm5 12v-3H5v3h4zm0-4v-3H5v3h4zm5 4v-3h-4v3h4zm0-4v-3h-4v3h4zm5 4v-3h-4v3h4zm0-4v-3h-4v3h4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'table': '<svg width=\"24\" height=\"24\"><path d=\"M4 5h16v14H4V5zm6 9h4v-3h-4v3zm4 1h-4v3h4v-3zm0-8h-4v3h4V7zM9 7H5v3h4V7zm-4 4v3h4v-3H5zm10 0v3h4v-3h-4zm0-1h4V7h-4v3zM5 15v3h4v-3H5zm10 3h4v-3h-4v3z\" fill-rule=\"evenodd\"/></svg>',\r\n                'template': '<svg width=\"24\" height=\"24\"><path d=\"M19 19v-1H5v1h14zM9 16v-4a5 5 0 1 1 6 0v4h4a2 2 0 0 1 2 2v3H3v-3c0-1.1.9-2 2-2h4zm4 0v-5l.8-.6a3 3 0 1 0-3.6 0l.8.6v5h2z\" fill-rule=\"nonzero\"/></svg>',\r\n                'temporary-placeholder': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path d=\"M9 7.6V6h2.5V4.5a.5.5 0 1 1 1 0V6H15v1.6a8 8 0 1 1-6 0zm-2.6 5.3a.5.5 0 0 0 .3.6c.3 0 .6 0 .6-.3l.1-.2a5 5 0 0 1 3.3-2.8c.3-.1.4-.4.4-.6-.1-.3-.4-.5-.6-.4a6 6 0 0 0-4.1 3.7z\"/><circle cx=\"14\" cy=\"4\" r=\"1\"/><circle cx=\"12\" cy=\"2\" r=\"1\"/><circle cx=\"10\" cy=\"4\" r=\"1\"/></g></svg>',\r\n                'text-color': '<svg width=\"24\" height=\"24\"><g fill-rule=\"evenodd\"><path id=\"tox-icon-text-color__color\" d=\"M3 18h18v3H3z\"/><path d=\"M8.7 16h-.8a.5.5 0 0 1-.5-.6l2.7-9c.1-.3.3-.4.5-.4h2.8c.2 0 .4.1.5.4l2.7 9a.5.5 0 0 1-.5.6h-.8a.5.5 0 0 1-.4-.4l-.7-2.2c0-.3-.3-.4-.5-.4h-3.4c-.2 0-.4.1-.5.4l-.7 2.2c0 .3-.2.4-.4.4zm2.6-7.6l-.6 2a.5.5 0 0 0 .5.6h1.6a.5.5 0 0 0 .5-.6l-.6-2c0-.3-.3-.4-.5-.4h-.4c-.2 0-.4.1-.5.4z\"/></g></svg>',\r\n                'toc': '<svg width=\"24\" height=\"24\"><path d=\"M5 5c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 1 1 0-2zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 1 1 0-2zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2zm3 0h11c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2zm0-4c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 1 1 0-2zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm-3 8c.6 0 1 .4 1 1s-.4 1-1 1a1 1 0 0 1 0-2zm3 0h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'translate': '<svg width=\"24\" height=\"24\"><path d=\"M12.7 14.3l-.3.7-.4.7-2.2-2.2-3.1 3c-.3.4-.8.4-1 0a.7.7 0 0 1 0-1l3.1-3A12.4 12.4 0 0 1 6.7 9H8a10.1 10.1 0 0 0 1.7 2.4c.5-.5 1-1.1 1.4-1.8l.9-2H4.7a.7.7 0 1 1 0-1.5h4.4v-.7c0-.4.3-.8.7-.8.4 0 .7.4.7.8v.7H15c.4 0 .8.3.8.7 0 .4-.4.8-.8.8h-1.4a12.3 12.3 0 0 1-1 2.4 13.5 13.5 0 0 1-1.7 2.3l1.9 1.8zm4.3-3l2.7 7.3a.5.5 0 0 1-.4.7 1 1 0 0 1-1-.7l-.6-1.5h-3.4l-.6 1.5a1 1 0 0 1-1 .7.5.5 0 0 1-.4-.7l2.7-7.4a1 1 0 1 1 2 0zm-2.2 4.4h2.4L16 12.5l-1.2 3.2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'underline': '<svg width=\"24\" height=\"24\"><path d=\"M16 5c.6 0 1 .4 1 1v5.5a4 4 0 0 1-.4 1.8l-1 1.4a5.3 5.3 0 0 1-5.5 1 5 5 0 0 1-1.6-1c-.5-.4-.8-.9-1.1-1.4a4 4 0 0 1-.4-1.8V6c0-.6.4-1 1-1s1 .4 1 1v5.5c0 .3 0 .6.2 1l.6.7a3.3 3.3 0 0 0 2.2.8 3.4 3.4 0 0 0 2.2-.8c.3-.2.4-.5.6-.8l.2-.9V6c0-.6.4-1 1-1zM8 17h8c.6 0 1 .4 1 1s-.4 1-1 1H8a1 1 0 0 1 0-2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'undo': '<svg width=\"24\" height=\"24\"><path d=\"M6.4 8H12c3.7 0 6.2 2 6.8 5.1.6 2.7-.4 5.6-2.3 6.8a1 1 0 0 1-1-1.8c1.1-.6 1.8-2.7 1.4-4.6-.5-2.1-2.1-3.5-4.9-3.5H6.4l3.3 3.3a1 1 0 1 1-1.4 1.4l-5-5a1 1 0 0 1 0-1.4l5-5a1 1 0 0 1 1.4 1.4L6.4 8z\" fill-rule=\"nonzero\"/></svg>',\r\n                'unlink': '<svg width=\"24\" height=\"24\"><path d=\"M6.2 12.3a1 1 0 0 1 1.4 1.4l-2 2a2 2 0 1 0 2.6 2.8l4.8-4.8a1 1 0 0 0 0-1.4 1 1 0 1 1 1.4-1.3 2.9 2.9 0 0 1 0 4L9.6 20a3.9 3.9 0 0 1-5.5-5.5l2-2zm11.6-.6a1 1 0 0 1-1.4-1.4l2.1-2a2 2 0 1 0-2.7-2.8L11 10.3a1 1 0 0 0 0 1.4A1 1 0 1 1 9.6 13a2.9 2.9 0 0 1 0-4L14.4 4a3.9 3.9 0 0 1 5.5 5.5l-2 2zM7.6 6.3a.8.8 0 0 1-1 1.1L3.3 4.2a.7.7 0 1 1 1-1l3.2 3.1zM5.1 8.6a.8.8 0 0 1 0 1.5H3a.8.8 0 0 1 0-1.5H5zm5-3.5a.8.8 0 0 1-1.5 0V3a.8.8 0 0 1 1.5 0V5zm6 11.8a.8.8 0 0 1 1-1l3.2 3.2a.8.8 0 0 1-1 1L16 17zm-2.2 2a.8.8 0 0 1 1.5 0V21a.8.8 0 0 1-1.5 0V19zm5-3.5a.7.7 0 1 1 0-1.5H21a.8.8 0 0 1 0 1.5H19z\" fill-rule=\"nonzero\"/></svg>',\r\n                'unlock': '<svg width=\"24\" height=\"24\"><path d=\"M16 5c.8 0 1.5.3 2.1.9.6.6.9 1.3.9 2.1v3h-2V8a1 1 0 0 0-.3-.7A1 1 0 0 0 16 7h-2a1 1 0 0 0-.7.3 1 1 0 0 0-.3.7v3h.3c.2 0 .3 0 .5.2l.2.6v7.4c0 .3 0 .4-.2.6l-.6.2H4.8c-.3 0-.4 0-.6-.2a.7.7 0 0 1-.2-.6v-7.4c0-.3 0-.4.2-.6l.5-.2H11V8c0-.8.3-1.5.9-2.1.6-.6 1.3-.9 2.1-.9h2z\" fill-rule=\"evenodd\"/></svg>',\r\n                'unordered-list': '<svg width=\"24\" height=\"24\"><path d=\"M11 5h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zm0 6h8c.6 0 1 .4 1 1s-.4 1-1 1h-8a1 1 0 0 1 0-2zM4.5 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1zm0 6c0-.4.1-.8.4-1 .3-.4.7-.5 1.1-.5.4 0 .8.1 1 .4.4.3.5.7.5 1.1 0 .4-.1.8-.4 1-.3.4-.7.5-1.1.5-.4 0-.8-.1-1-.4-.4-.3-.5-.7-.5-1.1z\" fill-rule=\"evenodd\"/></svg>',\r\n                'unselected': '<svg width=\"24\" height=\"24\"><path fill-rule=\"nonzero\" d=\"M6 4h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6c0-1.1.9-2 2-2zm0 1a1 1 0 0 0-1 1v12c0 .6.4 1 1 1h12c.6 0 1-.4 1-1V6c0-.6-.4-1-1-1H6z\"/></svg>',\r\n                'upload': '<svg width=\"24\" height=\"24\"><path d=\"M18 19v-2a1 1 0 0 1 2 0v3c0 .6-.4 1-1 1H5a1 1 0 0 1-1-1v-3a1 1 0 0 1 2 0v2h12zM11 6.4L8.7 8.7a1 1 0 0 1-1.4-1.4l4-4a1 1 0 0 1 1.4 0l4 4a1 1 0 1 1-1.4 1.4L13 6.4V16a1 1 0 0 1-2 0V6.4z\" fill-rule=\"nonzero\"/></svg>',\r\n                'user': '<svg width=\"24\" height=\"24\"><path d=\"M12 24a12 12 0 1 1 0-24 12 12 0 0 1 0 24zm-8.7-5.3a11 11 0 0 0 17.4 0C19.4 16.3 14.6 15 12 15c-2.6 0-7.4 1.3-8.7 3.7zM12 13c2.2 0 4-2 4-4.5S14.2 4 12 4 8 6 8 8.5 9.8 13 12 13z\" fill-rule=\"nonzero\"/></svg>',\r\n                'warning': '<svg width=\"24\" height=\"24\"><path d=\"M19.8 18.3c.2.5.3.9 0 1.2-.1.3-.5.5-1 .5H5.2c-.5 0-.9-.2-1-.5-.3-.3-.2-.7 0-1.2L11 4.7l.5-.5.5-.2c.2 0 .3 0 .5.2.2 0 .3.3.5.5l6.8 13.6zM12 18c.3 0 .5-.1.7-.3.2-.2.3-.4.3-.7a1 1 0 0 0-.3-.7 1 1 0 0 0-.7-.3 1 1 0 0 0-.7.3 1 1 0 0 0-.3.7c0 .3.1.5.3.7.2.2.4.3.7.3zm.7-3l.3-4a1 1 0 0 0-.3-.7 1 1 0 0 0-.7-.3 1 1 0 0 0-.7.3 1 1 0 0 0-.3.7l.3 4h1.4z\" fill-rule=\"evenodd\"/></svg>',\r\n                'zoom-in': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 1 1 1.4-1.4l4.3 4.4a1 1 0 0 1-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 1 0 0-12 6 6 0 0 0 0 12zm-1-9a1 1 0 0 1 2 0v6a1 1 0 0 1-2 0V8zm-2 4a1 1 0 0 1 0-2h6a1 1 0 0 1 0 2H8z\" fill-rule=\"nonzero\"/></svg>',\r\n                'zoom-out': '<svg width=\"24\" height=\"24\"><path d=\"M16 17.3a8 8 0 1 1 1.4-1.4l4.3 4.4a1 1 0 0 1-1.4 1.4l-4.4-4.3zm-5-.3a6 6 0 1 0 0-12 6 6 0 0 0 0 12zm-3-5a1 1 0 0 1 0-2h6a1 1 0 0 1 0 2H8z\" fill-rule=\"nonzero\"/></svg>'\r\n            };\r\n        };\r\n        var CreateIconManager = function () {\r\n            var lookup = {};\r\n            var add = function (id, iconPack) {\r\n                lookup[id] = iconPack;\r\n            };\r\n            var get = function (id) {\r\n                if (lookup[id]) {\r\n                    return lookup[id];\r\n                }\r\n                return { icons: {} };\r\n            };\r\n            var has$1 = function (id) {\r\n                return has(lookup, id);\r\n            };\r\n            return {\r\n                add: add,\r\n                get: get,\r\n                has: has$1\r\n            };\r\n        };\r\n        var IconManager = CreateIconManager();\r\n        var PluginManager = AddOnManager$1.PluginManager;\r\n        var ThemeManager = AddOnManager$1.ThemeManager;\r\n        function XMLHttpRequest() {\r\n            var f = Global$1.getOrDie('XMLHttpRequest');\r\n            return new f();\r\n        }\r\n        function Uploader(uploadStatus, settings) {\r\n            var pendingPromises = {};\r\n            var pathJoin = function (path1, path2) {\r\n                if (path1) {\r\n                    return path1.replace(/\\/$/, '') + '/' + path2.replace(/^\\//, '');\r\n                }\r\n                return path2;\r\n            };\r\n            var defaultHandler = function (blobInfo, success, failure, progress) {\r\n                var xhr, formData;\r\n                xhr = XMLHttpRequest();\r\n                xhr.open('POST', settings.url);\r\n                xhr.withCredentials = settings.credentials;\r\n                xhr.upload.onprogress = function (e) {\r\n                    progress(e.loaded / e.total * 100);\r\n                };\r\n                xhr.onerror = function () {\r\n                    failure('Image upload failed due to a XHR Transport error. Code: ' + xhr.status);\r\n                };\r\n                xhr.onload = function () {\r\n                    var json;\r\n                    if (xhr.status < 200 || xhr.status >= 300) {\r\n                        failure('HTTP Error: ' + xhr.status);\r\n                        return;\r\n                    }\r\n                    json = JSON.parse(xhr.responseText);\r\n                    if (!json || typeof json.location !== 'string') {\r\n                        failure('Invalid JSON: ' + xhr.responseText);\r\n                        return;\r\n                    }\r\n                    success(pathJoin(settings.basePath, json.location));\r\n                };\r\n                formData = new domGlobals.FormData();\r\n                formData.append('file', blobInfo.blob(), blobInfo.filename());\r\n                xhr.send(formData);\r\n            };\r\n            var noUpload = function () {\r\n                return new promiseObj(function (resolve) {\r\n                    resolve([]);\r\n                });\r\n            };\r\n            var handlerSuccess = function (blobInfo, url) {\r\n                return {\r\n                    url: url,\r\n                    blobInfo: blobInfo,\r\n                    status: true\r\n                };\r\n            };\r\n            var handlerFailure = function (blobInfo, error) {\r\n                return {\r\n                    url: '',\r\n                    blobInfo: blobInfo,\r\n                    status: false,\r\n                    error: error\r\n                };\r\n            };\r\n            var resolvePending = function (blobUri, result) {\r\n                Tools.each(pendingPromises[blobUri], function (resolve) {\r\n                    resolve(result);\r\n                });\r\n                delete pendingPromises[blobUri];\r\n            };\r\n            var uploadBlobInfo = function (blobInfo, handler, openNotification) {\r\n                uploadStatus.markPending(blobInfo.blobUri());\r\n                return new promiseObj(function (resolve) {\r\n                    var notification, progress;\r\n                    var noop = function () {\r\n                    };\r\n                    try {\r\n                        var closeNotification_1 = function () {\r\n                            if (notification) {\r\n                                notification.close();\r\n                                progress = noop;\r\n                            }\r\n                        };\r\n                        var success = function (url) {\r\n                            closeNotification_1();\r\n                            uploadStatus.markUploaded(blobInfo.blobUri(), url);\r\n                            resolvePending(blobInfo.blobUri(), handlerSuccess(blobInfo, url));\r\n                            resolve(handlerSuccess(blobInfo, url));\r\n                        };\r\n                        var failure = function (error) {\r\n                            closeNotification_1();\r\n                            uploadStatus.removeFailed(blobInfo.blobUri());\r\n                            resolvePending(blobInfo.blobUri(), handlerFailure(blobInfo, error));\r\n                            resolve(handlerFailure(blobInfo, error));\r\n                        };\r\n                        progress = function (percent) {\r\n                            if (percent < 0 || percent > 100) {\r\n                                return;\r\n                            }\r\n                            if (!notification) {\r\n                                notification = openNotification();\r\n                            }\r\n                            notification.progressBar.value(percent);\r\n                        };\r\n                        handler(blobInfo, success, failure, progress);\r\n                    }\r\n                    catch (ex) {\r\n                        resolve(handlerFailure(blobInfo, ex.message));\r\n                    }\r\n                });\r\n            };\r\n            var isDefaultHandler = function (handler) {\r\n                return handler === defaultHandler;\r\n            };\r\n            var pendingUploadBlobInfo = function (blobInfo) {\r\n                var blobUri = blobInfo.blobUri();\r\n                return new promiseObj(function (resolve) {\r\n                    pendingPromises[blobUri] = pendingPromises[blobUri] || [];\r\n                    pendingPromises[blobUri].push(resolve);\r\n                });\r\n            };\r\n            var uploadBlobs = function (blobInfos, openNotification) {\r\n                blobInfos = Tools.grep(blobInfos, function (blobInfo) {\r\n                    return !uploadStatus.isUploaded(blobInfo.blobUri());\r\n                });\r\n                return promiseObj.all(Tools.map(blobInfos, function (blobInfo) {\r\n                    return uploadStatus.isPending(blobInfo.blobUri()) ? pendingUploadBlobInfo(blobInfo) : uploadBlobInfo(blobInfo, settings.handler, openNotification);\r\n                }));\r\n            };\r\n            var upload = function (blobInfos, openNotification) {\r\n                return !settings.url && isDefaultHandler(settings.handler) ? noUpload() : uploadBlobs(blobInfos, openNotification);\r\n            };\r\n            if (isFunction(settings.handler) === false) {\r\n                settings.handler = defaultHandler;\r\n            }\r\n            return { upload: upload };\r\n        }\r\n        function FileReader() {\r\n            var f = Global$1.getOrDie('FileReader');\r\n            return new f();\r\n        }\r\n        function Uint8Array(arr) {\r\n            var f = Global$1.getOrDie('Uint8Array');\r\n            return new f(arr);\r\n        }\r\n        var requestAnimationFrame$1 = function (callback) {\r\n            var f = Global$1.getOrDie('requestAnimationFrame');\r\n            f(callback);\r\n        };\r\n        var atob = function (base64) {\r\n            var f = Global$1.getOrDie('atob');\r\n            return f(base64);\r\n        };\r\n        var Window = {\r\n            atob: atob,\r\n            requestAnimationFrame: requestAnimationFrame$1\r\n        };\r\n        var blobUriToBlob = function (url) {\r\n            return new promiseObj(function (resolve, reject) {\r\n                var rejectWithError = function () {\r\n                    reject('Cannot convert ' + url + ' to Blob. Resource might not exist or is inaccessible.');\r\n                };\r\n                try {\r\n                    var xhr = XMLHttpRequest();\r\n                    xhr.open('GET', url, true);\r\n                    xhr.responseType = 'blob';\r\n                    xhr.onload = function () {\r\n                        if (this.status === 200) {\r\n                            resolve(this.response);\r\n                        }\r\n                        else {\r\n                            rejectWithError();\r\n                        }\r\n                    };\r\n                    xhr.onerror = rejectWithError;\r\n                    xhr.send();\r\n                }\r\n                catch (ex) {\r\n                    rejectWithError();\r\n                }\r\n            });\r\n        };\r\n        var parseDataUri = function (uri) {\r\n            var type, matches;\r\n            var uriParts = decodeURIComponent(uri).split(',');\r\n            matches = /data:([^;]+)/.exec(uriParts[0]);\r\n            if (matches) {\r\n                type = matches[1];\r\n            }\r\n            return {\r\n                type: type,\r\n                data: uriParts[1]\r\n            };\r\n        };\r\n        var dataUriToBlob = function (uri) {\r\n            return new promiseObj(function (resolve) {\r\n                var str, arr, i;\r\n                var uriParts = parseDataUri(uri);\r\n                try {\r\n                    str = Window.atob(uriParts.data);\r\n                }\r\n                catch (e) {\r\n                    resolve(new domGlobals.Blob([]));\r\n                    return;\r\n                }\r\n                arr = Uint8Array(str.length);\r\n                for (i = 0; i < arr.length; i++) {\r\n                    arr[i] = str.charCodeAt(i);\r\n                }\r\n                resolve(new domGlobals.Blob([arr], { type: uriParts.type }));\r\n            });\r\n        };\r\n        var uriToBlob = function (url) {\r\n            if (url.indexOf('blob:') === 0) {\r\n                return blobUriToBlob(url);\r\n            }\r\n            if (url.indexOf('data:') === 0) {\r\n                return dataUriToBlob(url);\r\n            }\r\n            return null;\r\n        };\r\n        var blobToDataUri = function (blob) {\r\n            return new promiseObj(function (resolve) {\r\n                var reader = FileReader();\r\n                reader.onloadend = function () {\r\n                    resolve(reader.result);\r\n                };\r\n                reader.readAsDataURL(blob);\r\n            });\r\n        };\r\n        var Conversions = {\r\n            uriToBlob: uriToBlob,\r\n            blobToDataUri: blobToDataUri,\r\n            parseDataUri: parseDataUri\r\n        };\r\n        var count = 0;\r\n        var uniqueId = function (prefix) {\r\n            return (prefix || 'blobid') + count++;\r\n        };\r\n        var imageToBlobInfo = function (blobCache, img, resolve, reject) {\r\n            var base64, blobInfo;\r\n            if (img.src.indexOf('blob:') === 0) {\r\n                blobInfo = blobCache.getByUri(img.src);\r\n                if (blobInfo) {\r\n                    resolve({\r\n                        image: img,\r\n                        blobInfo: blobInfo\r\n                    });\r\n                }\r\n                else {\r\n                    Conversions.uriToBlob(img.src).then(function (blob) {\r\n                        Conversions.blobToDataUri(blob).then(function (dataUri) {\r\n                            base64 = Conversions.parseDataUri(dataUri).data;\r\n                            blobInfo = blobCache.create(uniqueId(), blob, base64);\r\n                            blobCache.add(blobInfo);\r\n                            resolve({\r\n                                image: img,\r\n                                blobInfo: blobInfo\r\n                            });\r\n                        });\r\n                    }, function (err) {\r\n                        reject(err);\r\n                    });\r\n                }\r\n                return;\r\n            }\r\n            base64 = Conversions.parseDataUri(img.src).data;\r\n            blobInfo = blobCache.findFirst(function (cachedBlobInfo) {\r\n                return cachedBlobInfo.base64() === base64;\r\n            });\r\n            if (blobInfo) {\r\n                resolve({\r\n                    image: img,\r\n                    blobInfo: blobInfo\r\n                });\r\n            }\r\n            else {\r\n                Conversions.uriToBlob(img.src).then(function (blob) {\r\n                    blobInfo = blobCache.create(uniqueId(), blob, base64);\r\n                    blobCache.add(blobInfo);\r\n                    resolve({\r\n                        image: img,\r\n                        blobInfo: blobInfo\r\n                    });\r\n                }, function (err) {\r\n                    reject(err);\r\n                });\r\n            }\r\n        };\r\n        var getAllImages = function (elm) {\r\n            return elm ? from$1(elm.getElementsByTagName('img')) : [];\r\n        };\r\n        function ImageScanner(uploadStatus, blobCache) {\r\n            var cachedPromises = {};\r\n            var findAll = function (elm, predicate) {\r\n                var images;\r\n                if (!predicate) {\r\n                    predicate = constant(true);\r\n                }\r\n                images = filter(getAllImages(elm), function (img) {\r\n                    var src = img.src;\r\n                    if (!Env.fileApi) {\r\n                        return false;\r\n                    }\r\n                    if (img.hasAttribute('data-mce-bogus')) {\r\n                        return false;\r\n                    }\r\n                    if (img.hasAttribute('data-mce-placeholder')) {\r\n                        return false;\r\n                    }\r\n                    if (!src || src === Env.transparentSrc) {\r\n                        return false;\r\n                    }\r\n                    if (src.indexOf('blob:') === 0) {\r\n                        return !uploadStatus.isUploaded(src) && predicate(img);\r\n                    }\r\n                    if (src.indexOf('data:') === 0) {\r\n                        return predicate(img);\r\n                    }\r\n                    return false;\r\n                });\r\n                var promises = map(images, function (img) {\r\n                    if (cachedPromises[img.src]) {\r\n                        return new promiseObj(function (resolve) {\r\n                            cachedPromises[img.src].then(function (imageInfo) {\r\n                                if (typeof imageInfo === 'string') {\r\n                                    return imageInfo;\r\n                                }\r\n                                resolve({\r\n                                    image: img,\r\n                                    blobInfo: imageInfo.blobInfo\r\n                                });\r\n                            });\r\n                        });\r\n                    }\r\n                    var newPromise = new promiseObj(function (resolve, reject) {\r\n                        imageToBlobInfo(blobCache, img, resolve, reject);\r\n                    }).then(function (result) {\r\n                        delete cachedPromises[result.image.src];\r\n                        return result;\r\n                    }).catch(function (error) {\r\n                        delete cachedPromises[img.src];\r\n                        return error;\r\n                    });\r\n                    cachedPromises[img.src] = newPromise;\r\n                    return newPromise;\r\n                });\r\n                return promiseObj.all(promises);\r\n            };\r\n            return { findAll: findAll };\r\n        }\r\n        var count$1 = 0;\r\n        var seed = function () {\r\n            var rnd = function () {\r\n                return Math.round(Math.random() * 4294967295).toString(36);\r\n            };\r\n            var now = new Date().getTime();\r\n            return 's' + now.toString(36) + rnd() + rnd() + rnd();\r\n        };\r\n        var uuid = function (prefix) {\r\n            return prefix + count$1++ + seed();\r\n        };\r\n        var Uuid = { uuid: uuid };\r\n        var BlobCache = function () {\r\n            var cache = [];\r\n            var mimeToExt = function (mime) {\r\n                var mimes = {\r\n                    'image/jpeg': 'jpg',\r\n                    'image/jpg': 'jpg',\r\n                    'image/gif': 'gif',\r\n                    'image/png': 'png'\r\n                };\r\n                return mimes[mime.toLowerCase()] || 'dat';\r\n            };\r\n            var create = function (o, blob, base64, filename) {\r\n                if (isString(o)) {\r\n                    var id = o;\r\n                    return toBlobInfo({\r\n                        id: id,\r\n                        name: filename,\r\n                        blob: blob,\r\n                        base64: base64\r\n                    });\r\n                }\r\n                else if (isObject(o)) {\r\n                    return toBlobInfo(o);\r\n                }\r\n                else {\r\n                    throw new Error('Unknown input type');\r\n                }\r\n            };\r\n            var toBlobInfo = function (o) {\r\n                var id, name;\r\n                if (!o.blob || !o.base64) {\r\n                    throw new Error('blob and base64 representations of the image are required for BlobInfo to be created');\r\n                }\r\n                id = o.id || Uuid.uuid('blobid');\r\n                name = o.name || id;\r\n                return {\r\n                    id: constant(id),\r\n                    name: constant(name),\r\n                    filename: constant(name + '.' + mimeToExt(o.blob.type)),\r\n                    blob: constant(o.blob),\r\n                    base64: constant(o.base64),\r\n                    blobUri: constant(o.blobUri || URL.createObjectURL(o.blob)),\r\n                    uri: constant(o.uri)\r\n                };\r\n            };\r\n            var add = function (blobInfo) {\r\n                if (!get(blobInfo.id())) {\r\n                    cache.push(blobInfo);\r\n                }\r\n            };\r\n            var get = function (id) {\r\n                return findFirst(function (cachedBlobInfo) {\r\n                    return cachedBlobInfo.id() === id;\r\n                });\r\n            };\r\n            var findFirst = function (predicate) {\r\n                return filter(cache, predicate)[0];\r\n            };\r\n            var getByUri = function (blobUri) {\r\n                return findFirst(function (blobInfo) {\r\n                    return blobInfo.blobUri() === blobUri;\r\n                });\r\n            };\r\n            var removeByUri = function (blobUri) {\r\n                cache = filter(cache, function (blobInfo) {\r\n                    if (blobInfo.blobUri() === blobUri) {\r\n                        URL.revokeObjectURL(blobInfo.blobUri());\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                });\r\n            };\r\n            var destroy = function () {\r\n                each(cache, function (cachedBlobInfo) {\r\n                    URL.revokeObjectURL(cachedBlobInfo.blobUri());\r\n                });\r\n                cache = [];\r\n            };\r\n            return {\r\n                create: create,\r\n                add: add,\r\n                get: get,\r\n                getByUri: getByUri,\r\n                findFirst: findFirst,\r\n                removeByUri: removeByUri,\r\n                destroy: destroy\r\n            };\r\n        };\r\n        function UploadStatus() {\r\n            var PENDING = 1, UPLOADED = 2;\r\n            var blobUriStatuses = {};\r\n            var createStatus = function (status, resultUri) {\r\n                return {\r\n                    status: status,\r\n                    resultUri: resultUri\r\n                };\r\n            };\r\n            var hasBlobUri = function (blobUri) {\r\n                return blobUri in blobUriStatuses;\r\n            };\r\n            var getResultUri = function (blobUri) {\r\n                var result = blobUriStatuses[blobUri];\r\n                return result ? result.resultUri : null;\r\n            };\r\n            var isPending = function (blobUri) {\r\n                return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === PENDING : false;\r\n            };\r\n            var isUploaded = function (blobUri) {\r\n                return hasBlobUri(blobUri) ? blobUriStatuses[blobUri].status === UPLOADED : false;\r\n            };\r\n            var markPending = function (blobUri) {\r\n                blobUriStatuses[blobUri] = createStatus(PENDING, null);\r\n            };\r\n            var markUploaded = function (blobUri, resultUri) {\r\n                blobUriStatuses[blobUri] = createStatus(UPLOADED, resultUri);\r\n            };\r\n            var removeFailed = function (blobUri) {\r\n                delete blobUriStatuses[blobUri];\r\n            };\r\n            var destroy = function () {\r\n                blobUriStatuses = {};\r\n            };\r\n            return {\r\n                hasBlobUri: hasBlobUri,\r\n                getResultUri: getResultUri,\r\n                isPending: isPending,\r\n                isUploaded: isUploaded,\r\n                markPending: markPending,\r\n                markUploaded: markUploaded,\r\n                removeFailed: removeFailed,\r\n                destroy: destroy\r\n            };\r\n        }\r\n        var EditorUpload = function (editor) {\r\n            var blobCache = BlobCache();\r\n            var uploader, imageScanner;\r\n            var uploadStatus = UploadStatus();\r\n            var urlFilters = [];\r\n            var aliveGuard = function (callback) {\r\n                return function (result) {\r\n                    if (editor.selection) {\r\n                        return callback(result);\r\n                    }\r\n                    return [];\r\n                };\r\n            };\r\n            var cacheInvalidator = function () {\r\n                return '?' + new Date().getTime();\r\n            };\r\n            var replaceString = function (content, search, replace) {\r\n                var index = 0;\r\n                do {\r\n                    index = content.indexOf(search, index);\r\n                    if (index !== -1) {\r\n                        content = content.substring(0, index) + replace + content.substr(index + search.length);\r\n                        index += replace.length - search.length + 1;\r\n                    }\r\n                } while (index !== -1);\r\n                return content;\r\n            };\r\n            var replaceImageUrl = function (content, targetUrl, replacementUrl) {\r\n                content = replaceString(content, 'src=\"' + targetUrl + '\"', 'src=\"' + replacementUrl + '\"');\r\n                content = replaceString(content, 'data-mce-src=\"' + targetUrl + '\"', 'data-mce-src=\"' + replacementUrl + '\"');\r\n                return content;\r\n            };\r\n            var replaceUrlInUndoStack = function (targetUrl, replacementUrl) {\r\n                each(editor.undoManager.data, function (level) {\r\n                    if (level.type === 'fragmented') {\r\n                        level.fragments = map(level.fragments, function (fragment) {\r\n                            return replaceImageUrl(fragment, targetUrl, replacementUrl);\r\n                        });\r\n                    }\r\n                    else {\r\n                        level.content = replaceImageUrl(level.content, targetUrl, replacementUrl);\r\n                    }\r\n                });\r\n            };\r\n            var openNotification = function () {\r\n                return editor.notificationManager.open({\r\n                    text: editor.translate('Image uploading...'),\r\n                    type: 'info',\r\n                    timeout: -1,\r\n                    progressBar: true\r\n                });\r\n            };\r\n            var replaceImageUri = function (image, resultUri) {\r\n                blobCache.removeByUri(image.src);\r\n                replaceUrlInUndoStack(image.src, resultUri);\r\n                editor.$(image).attr({\r\n                    'src': Settings.shouldReuseFileName(editor) ? resultUri + cacheInvalidator() : resultUri,\r\n                    'data-mce-src': editor.convertURL(resultUri, 'src')\r\n                });\r\n            };\r\n            var uploadImages = function (callback) {\r\n                if (!uploader) {\r\n                    uploader = Uploader(uploadStatus, {\r\n                        url: Settings.getImageUploadUrl(editor),\r\n                        basePath: Settings.getImageUploadBasePath(editor),\r\n                        credentials: Settings.getImagesUploadCredentials(editor),\r\n                        handler: Settings.getImagesUploadHandler(editor)\r\n                    });\r\n                }\r\n                return scanForImages().then(aliveGuard(function (imageInfos) {\r\n                    var blobInfos;\r\n                    blobInfos = map(imageInfos, function (imageInfo) {\r\n                        return imageInfo.blobInfo;\r\n                    });\r\n                    return uploader.upload(blobInfos, openNotification).then(aliveGuard(function (result) {\r\n                        var filteredResult = map(result, function (uploadInfo, index) {\r\n                            var image = imageInfos[index].image;\r\n                            if (uploadInfo.status && Settings.shouldReplaceBlobUris(editor)) {\r\n                                replaceImageUri(image, uploadInfo.url);\r\n                            }\r\n                            else if (uploadInfo.error) {\r\n                                ErrorReporter.uploadError(editor, uploadInfo.error);\r\n                            }\r\n                            return {\r\n                                element: image,\r\n                                status: uploadInfo.status\r\n                            };\r\n                        });\r\n                        if (callback) {\r\n                            callback(filteredResult);\r\n                        }\r\n                        return filteredResult;\r\n                    }));\r\n                }));\r\n            };\r\n            var uploadImagesAuto = function (callback) {\r\n                if (Settings.isAutomaticUploadsEnabled(editor)) {\r\n                    return uploadImages(callback);\r\n                }\r\n            };\r\n            var isValidDataUriImage = function (imgElm) {\r\n                if (forall(urlFilters, function (filter) {\r\n                    return filter(imgElm);\r\n                }) === false) {\r\n                    return false;\r\n                }\r\n                if (imgElm.getAttribute('src').indexOf('data:') === 0) {\r\n                    var dataImgFilter = Settings.getImagesDataImgFilter(editor);\r\n                    return dataImgFilter(imgElm);\r\n                }\r\n                return true;\r\n            };\r\n            var addFilter = function (filter) {\r\n                urlFilters.push(filter);\r\n            };\r\n            var scanForImages = function () {\r\n                if (!imageScanner) {\r\n                    imageScanner = ImageScanner(uploadStatus, blobCache);\r\n                }\r\n                return imageScanner.findAll(editor.getBody(), isValidDataUriImage).then(aliveGuard(function (result) {\r\n                    result = filter(result, function (resultItem) {\r\n                        if (typeof resultItem === 'string') {\r\n                            ErrorReporter.displayError(editor, resultItem);\r\n                            return false;\r\n                        }\r\n                        return true;\r\n                    });\r\n                    each(result, function (resultItem) {\r\n                        replaceUrlInUndoStack(resultItem.image.src, resultItem.blobInfo.blobUri());\r\n                        resultItem.image.src = resultItem.blobInfo.blobUri();\r\n                        resultItem.image.removeAttribute('data-mce-src');\r\n                    });\r\n                    return result;\r\n                }));\r\n            };\r\n            var destroy = function () {\r\n                blobCache.destroy();\r\n                uploadStatus.destroy();\r\n                imageScanner = uploader = null;\r\n            };\r\n            var replaceBlobUris = function (content) {\r\n                return content.replace(/src=\"(blob:[^\"]+)\"/g, function (match, blobUri) {\r\n                    var resultUri = uploadStatus.getResultUri(blobUri);\r\n                    if (resultUri) {\r\n                        return 'src=\"' + resultUri + '\"';\r\n                    }\r\n                    var blobInfo = blobCache.getByUri(blobUri);\r\n                    if (!blobInfo) {\r\n                        blobInfo = foldl(editor.editorManager.get(), function (result, editor) {\r\n                            return result || editor.editorUpload && editor.editorUpload.blobCache.getByUri(blobUri);\r\n                        }, null);\r\n                    }\r\n                    if (blobInfo) {\r\n                        var blob = blobInfo.blob();\r\n                        return 'src=\"data:' + blob.type + ';base64,' + blobInfo.base64() + '\"';\r\n                    }\r\n                    return match;\r\n                });\r\n            };\r\n            editor.on('SetContent', function () {\r\n                if (Settings.isAutomaticUploadsEnabled(editor)) {\r\n                    uploadImagesAuto();\r\n                }\r\n                else {\r\n                    scanForImages();\r\n                }\r\n            });\r\n            editor.on('RawSaveContent', function (e) {\r\n                e.content = replaceBlobUris(e.content);\r\n            });\r\n            editor.on('GetContent', function (e) {\r\n                if (e.source_view || e.format === 'raw') {\r\n                    return;\r\n                }\r\n                e.content = replaceBlobUris(e.content);\r\n            });\r\n            editor.on('PostRender', function () {\r\n                editor.parser.addNodeFilter('img', function (images) {\r\n                    each(images, function (img) {\r\n                        var src = img.attr('src');\r\n                        if (blobCache.getByUri(src)) {\r\n                            return;\r\n                        }\r\n                        var resultUri = uploadStatus.getResultUri(src);\r\n                        if (resultUri) {\r\n                            img.attr('src', resultUri);\r\n                        }\r\n                    });\r\n                });\r\n            });\r\n            return {\r\n                blobCache: blobCache,\r\n                addFilter: addFilter,\r\n                uploadImages: uploadImages,\r\n                uploadImagesAuto: uploadImagesAuto,\r\n                scanForImages: scanForImages,\r\n                destroy: destroy\r\n            };\r\n        };\r\n        var dropLast = function (xs) {\r\n            return xs.slice(0, -1);\r\n        };\r\n        var parentsUntil$1 = function (start, root, predicate) {\r\n            if (contains$3(root, start)) {\r\n                return dropLast(parents(start, function (elm) {\r\n                    return predicate(elm) || eq(elm, root);\r\n                }));\r\n            }\r\n            else {\r\n                return [];\r\n            }\r\n        };\r\n        var parents$1 = function (start, root) {\r\n            return parentsUntil$1(start, root, constant(false));\r\n        };\r\n        var parentsAndSelf = function (start, root) {\r\n            return [start].concat(parents$1(start, root));\r\n        };\r\n        var Parents = {\r\n            parentsUntil: parentsUntil$1,\r\n            parents: parents$1,\r\n            parentsAndSelf: parentsAndSelf\r\n        };\r\n        var isBlockElement = function (blockElements, node) {\r\n            return blockElements.hasOwnProperty(node.nodeName);\r\n        };\r\n        var isValidTarget = function (blockElements, node) {\r\n            if (NodeType.isText(node)) {\r\n                return true;\r\n            }\r\n            else if (NodeType.isElement(node)) {\r\n                return !isBlockElement(blockElements, node) && !Bookmarks.isBookmarkNode(node);\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var hasBlockParent = function (blockElements, root, node) {\r\n            return exists(Parents.parents(Element.fromDom(node), Element.fromDom(root)), function (elm) {\r\n                return isBlockElement(blockElements, elm.dom());\r\n            });\r\n        };\r\n        var shouldRemoveTextNode = function (blockElements, node) {\r\n            if (NodeType.isText(node)) {\r\n                if (node.nodeValue.length === 0) {\r\n                    return true;\r\n                }\r\n                else if (/^\\s+$/.test(node.nodeValue) && (!node.nextSibling || isBlockElement(blockElements, node.nextSibling))) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var addRootBlocks = function (editor) {\r\n            var dom = editor.dom, selection = editor.selection;\r\n            var schema = editor.schema, blockElements = schema.getBlockElements();\r\n            var node = selection.getStart();\r\n            var rootNode = editor.getBody();\r\n            var rng;\r\n            var startContainer, startOffset, endContainer, endOffset, rootBlockNode;\r\n            var tempNode, wrapped, restoreSelection;\r\n            var rootNodeName;\r\n            var forcedRootBlock = Settings.getForcedRootBlock(editor);\r\n            if (!node || !NodeType.isElement(node) || !forcedRootBlock) {\r\n                return;\r\n            }\r\n            rootNodeName = rootNode.nodeName.toLowerCase();\r\n            if (!schema.isValidChild(rootNodeName, forcedRootBlock.toLowerCase()) || hasBlockParent(blockElements, rootNode, node)) {\r\n                return;\r\n            }\r\n            rng = selection.getRng();\r\n            startContainer = rng.startContainer;\r\n            startOffset = rng.startOffset;\r\n            endContainer = rng.endContainer;\r\n            endOffset = rng.endOffset;\r\n            restoreSelection = EditorFocus.hasFocus(editor);\r\n            node = rootNode.firstChild;\r\n            while (node) {\r\n                if (isValidTarget(blockElements, node)) {\r\n                    if (shouldRemoveTextNode(blockElements, node)) {\r\n                        tempNode = node;\r\n                        node = node.nextSibling;\r\n                        dom.remove(tempNode);\r\n                        continue;\r\n                    }\r\n                    if (!rootBlockNode) {\r\n                        rootBlockNode = dom.create(forcedRootBlock, Settings.getForcedRootBlockAttrs(editor));\r\n                        node.parentNode.insertBefore(rootBlockNode, node);\r\n                        wrapped = true;\r\n                    }\r\n                    tempNode = node;\r\n                    node = node.nextSibling;\r\n                    rootBlockNode.appendChild(tempNode);\r\n                }\r\n                else {\r\n                    rootBlockNode = null;\r\n                    node = node.nextSibling;\r\n                }\r\n            }\r\n            if (wrapped && restoreSelection) {\r\n                rng.setStart(startContainer, startOffset);\r\n                rng.setEnd(endContainer, endOffset);\r\n                selection.setRng(rng);\r\n                editor.nodeChanged();\r\n            }\r\n        };\r\n        var setup$2 = function (editor) {\r\n            if (Settings.getForcedRootBlock(editor)) {\r\n                editor.on('NodeChange', curry(addRootBlocks, editor));\r\n            }\r\n        };\r\n        var ForceBlocks = { setup: setup$2 };\r\n        var isEq$1 = function (rng1, rng2) {\r\n            return rng1 && rng2 && (rng1.startContainer === rng2.startContainer && rng1.startOffset === rng2.startOffset) && (rng1.endContainer === rng2.endContainer && rng1.endOffset === rng2.endOffset);\r\n        };\r\n        var RangeCompare = { isEq: isEq$1 };\r\n        var getStartNode = function (rng) {\r\n            var sc = rng.startContainer, so = rng.startOffset;\r\n            if (NodeType.isText(sc)) {\r\n                return so === 0 ? Option.some(Element.fromDom(sc)) : Option.none();\r\n            }\r\n            else {\r\n                return Option.from(sc.childNodes[so]).map(Element.fromDom);\r\n            }\r\n        };\r\n        var getEndNode = function (rng) {\r\n            var ec = rng.endContainer, eo = rng.endOffset;\r\n            if (NodeType.isText(ec)) {\r\n                return eo === ec.data.length ? Option.some(Element.fromDom(ec)) : Option.none();\r\n            }\r\n            else {\r\n                return Option.from(ec.childNodes[eo - 1]).map(Element.fromDom);\r\n            }\r\n        };\r\n        var getFirstChildren = function (node) {\r\n            return firstChild(node).fold(constant([node]), function (child) {\r\n                return [node].concat(getFirstChildren(child));\r\n            });\r\n        };\r\n        var getLastChildren = function (node) {\r\n            return lastChild(node).fold(constant([node]), function (child) {\r\n                if (name(child) === 'br') {\r\n                    return prevSibling(child).map(function (sibling) {\r\n                        return [node].concat(getLastChildren(sibling));\r\n                    }).getOr([]);\r\n                }\r\n                else {\r\n                    return [node].concat(getLastChildren(child));\r\n                }\r\n            });\r\n        };\r\n        var hasAllContentsSelected = function (elm, rng) {\r\n            return liftN([\r\n                getStartNode(rng),\r\n                getEndNode(rng)\r\n            ], function (startNode, endNode) {\r\n                var start = find(getFirstChildren(elm), curry(eq, startNode));\r\n                var end = find(getLastChildren(elm), curry(eq, endNode));\r\n                return start.isSome() && end.isSome();\r\n            }).getOr(false);\r\n        };\r\n        var moveEndPoint$1 = function (dom, rng, node, start) {\r\n            var root = node, walker = new TreeWalker(node, root);\r\n            var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\r\n            do {\r\n                if (node.nodeType === 3 && Tools.trim(node.nodeValue).length !== 0) {\r\n                    if (start) {\r\n                        rng.setStart(node, 0);\r\n                    }\r\n                    else {\r\n                        rng.setEnd(node, node.nodeValue.length);\r\n                    }\r\n                    return;\r\n                }\r\n                if (nonEmptyElementsMap[node.nodeName] && !/^(TD|TH)$/.test(node.nodeName)) {\r\n                    if (start) {\r\n                        rng.setStartBefore(node);\r\n                    }\r\n                    else {\r\n                        if (node.nodeName === 'BR') {\r\n                            rng.setEndBefore(node);\r\n                        }\r\n                        else {\r\n                            rng.setEndAfter(node);\r\n                        }\r\n                    }\r\n                    return;\r\n                }\r\n                if (Env.ie && Env.ie < 11 && dom.isBlock(node) && dom.isEmpty(node)) {\r\n                    if (start) {\r\n                        rng.setStart(node, 0);\r\n                    }\r\n                    else {\r\n                        rng.setEnd(node, 0);\r\n                    }\r\n                    return;\r\n                }\r\n            } while (node = start ? walker.next() : walker.prev());\r\n            if (root.nodeName === 'BODY') {\r\n                if (start) {\r\n                    rng.setStart(root, 0);\r\n                }\r\n                else {\r\n                    rng.setEnd(root, root.childNodes.length);\r\n                }\r\n            }\r\n        };\r\n        var hasAnyRanges = function (editor) {\r\n            var sel = editor.selection.getSel();\r\n            return sel && sel.rangeCount > 0;\r\n        };\r\n        var NodeChange = function () {\r\n            function NodeChange(editor) {\r\n                this.lastPath = [];\r\n                this.editor = editor;\r\n                var lastRng;\r\n                var self = this;\r\n                if (!('onselectionchange' in editor.getDoc())) {\r\n                    editor.on('NodeChange click mouseup keyup focus', function (e) {\r\n                        var nativeRng, fakeRng;\r\n                        nativeRng = editor.selection.getRng();\r\n                        fakeRng = {\r\n                            startContainer: nativeRng.startContainer,\r\n                            startOffset: nativeRng.startOffset,\r\n                            endContainer: nativeRng.endContainer,\r\n                            endOffset: nativeRng.endOffset\r\n                        };\r\n                        if (e.type === 'nodechange' || !RangeCompare.isEq(fakeRng, lastRng)) {\r\n                            editor.fire('SelectionChange');\r\n                        }\r\n                        lastRng = fakeRng;\r\n                    });\r\n                }\r\n                editor.on('contextmenu', function () {\r\n                    editor.fire('SelectionChange');\r\n                });\r\n                editor.on('SelectionChange', function () {\r\n                    var startElm = editor.selection.getStart(true);\r\n                    if (!startElm || !Env.range && editor.selection.isCollapsed()) {\r\n                        return;\r\n                    }\r\n                    if (hasAnyRanges(editor) && !self.isSameElementPath(startElm) && editor.dom.isChildOf(startElm, editor.getBody())) {\r\n                        editor.nodeChanged({ selectionChange: true });\r\n                    }\r\n                });\r\n                editor.on('mouseup', function (e) {\r\n                    if (!e.isDefaultPrevented() && hasAnyRanges(editor)) {\r\n                        if (editor.selection.getNode().nodeName === 'IMG') {\r\n                            Delay.setEditorTimeout(editor, function () {\r\n                                editor.nodeChanged();\r\n                            });\r\n                        }\r\n                        else {\r\n                            editor.nodeChanged();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            NodeChange.prototype.nodeChanged = function (args) {\r\n                var selection = this.editor.selection;\r\n                var node, parents, root;\r\n                if (this.editor.initialized && selection && !this.editor.settings.disable_nodechange && !this.editor.readonly) {\r\n                    root = this.editor.getBody();\r\n                    node = selection.getStart(true) || root;\r\n                    if (node.ownerDocument !== this.editor.getDoc() || !this.editor.dom.isChildOf(node, root)) {\r\n                        node = root;\r\n                    }\r\n                    parents = [];\r\n                    this.editor.dom.getParent(node, function (node) {\r\n                        if (node === root) {\r\n                            return true;\r\n                        }\r\n                        parents.push(node);\r\n                    });\r\n                    args = args || {};\r\n                    args.element = node;\r\n                    args.parents = parents;\r\n                    this.editor.fire('NodeChange', args);\r\n                }\r\n            };\r\n            NodeChange.prototype.isSameElementPath = function (startElm) {\r\n                var i, currentPath;\r\n                currentPath = this.editor.$(startElm).parentsUntil(this.editor.getBody()).add(startElm);\r\n                if (currentPath.length === this.lastPath.length) {\r\n                    for (i = currentPath.length; i >= 0; i--) {\r\n                        if (currentPath[i] !== this.lastPath[i]) {\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (i === -1) {\r\n                        this.lastPath = currentPath;\r\n                        return true;\r\n                    }\r\n                }\r\n                this.lastPath = currentPath;\r\n                return false;\r\n            };\r\n            return NodeChange;\r\n        }();\r\n        var getAbsolutePosition = function (elm) {\r\n            var doc, docElem, win, clientRect;\r\n            clientRect = elm.getBoundingClientRect();\r\n            doc = elm.ownerDocument;\r\n            docElem = doc.documentElement;\r\n            win = doc.defaultView;\r\n            return {\r\n                top: clientRect.top + win.pageYOffset - docElem.clientTop,\r\n                left: clientRect.left + win.pageXOffset - docElem.clientLeft\r\n            };\r\n        };\r\n        var getBodyPosition = function (editor) {\r\n            return editor.inline ? getAbsolutePosition(editor.getBody()) : {\r\n                left: 0,\r\n                top: 0\r\n            };\r\n        };\r\n        var getScrollPosition = function (editor) {\r\n            var body = editor.getBody();\r\n            return editor.inline ? {\r\n                left: body.scrollLeft,\r\n                top: body.scrollTop\r\n            } : {\r\n                left: 0,\r\n                top: 0\r\n            };\r\n        };\r\n        var getBodyScroll = function (editor) {\r\n            var body = editor.getBody(), docElm = editor.getDoc().documentElement;\r\n            var inlineScroll = {\r\n                left: body.scrollLeft,\r\n                top: body.scrollTop\r\n            };\r\n            var iframeScroll = {\r\n                left: body.scrollLeft || docElm.scrollLeft,\r\n                top: body.scrollTop || docElm.scrollTop\r\n            };\r\n            return editor.inline ? inlineScroll : iframeScroll;\r\n        };\r\n        var getMousePosition = function (editor, event) {\r\n            if (event.target.ownerDocument !== editor.getDoc()) {\r\n                var iframePosition = getAbsolutePosition(editor.getContentAreaContainer());\r\n                var scrollPosition = getBodyScroll(editor);\r\n                return {\r\n                    left: event.pageX - iframePosition.left + scrollPosition.left,\r\n                    top: event.pageY - iframePosition.top + scrollPosition.top\r\n                };\r\n            }\r\n            return {\r\n                left: event.pageX,\r\n                top: event.pageY\r\n            };\r\n        };\r\n        var calculatePosition = function (bodyPosition, scrollPosition, mousePosition) {\r\n            return {\r\n                pageX: mousePosition.left - bodyPosition.left + scrollPosition.left,\r\n                pageY: mousePosition.top - bodyPosition.top + scrollPosition.top\r\n            };\r\n        };\r\n        var calc = function (editor, event) {\r\n            return calculatePosition(getBodyPosition(editor), getScrollPosition(editor), getMousePosition(editor, event));\r\n        };\r\n        var MousePosition = { calc: calc };\r\n        var isContentEditableFalse$6 = NodeType.isContentEditableFalse, isContentEditableTrue$2 = NodeType.isContentEditableTrue;\r\n        var isDraggable = function (rootElm, elm) {\r\n            return isContentEditableFalse$6(elm) && elm !== rootElm;\r\n        };\r\n        var isValidDropTarget = function (editor, targetElement, dragElement) {\r\n            if (targetElement === dragElement || editor.dom.isChildOf(targetElement, dragElement)) {\r\n                return false;\r\n            }\r\n            return !isContentEditableFalse$6(targetElement);\r\n        };\r\n        var cloneElement = function (elm) {\r\n            var cloneElm = elm.cloneNode(true);\r\n            cloneElm.removeAttribute('data-mce-selected');\r\n            return cloneElm;\r\n        };\r\n        var createGhost = function (editor, elm, width, height) {\r\n            var clonedElm = elm.cloneNode(true);\r\n            editor.dom.setStyles(clonedElm, {\r\n                width: width,\r\n                height: height\r\n            });\r\n            editor.dom.setAttrib(clonedElm, 'data-mce-selected', null);\r\n            var ghostElm = editor.dom.create('div', {\r\n                'class': 'mce-drag-container',\r\n                'data-mce-bogus': 'all',\r\n                'unselectable': 'on',\r\n                'contenteditable': 'false'\r\n            });\r\n            editor.dom.setStyles(ghostElm, {\r\n                position: 'absolute',\r\n                opacity: 0.5,\r\n                overflow: 'hidden',\r\n                border: 0,\r\n                padding: 0,\r\n                margin: 0,\r\n                width: width,\r\n                height: height\r\n            });\r\n            editor.dom.setStyles(clonedElm, {\r\n                margin: 0,\r\n                boxSizing: 'border-box'\r\n            });\r\n            ghostElm.appendChild(clonedElm);\r\n            return ghostElm;\r\n        };\r\n        var appendGhostToBody = function (ghostElm, bodyElm) {\r\n            if (ghostElm.parentNode !== bodyElm) {\r\n                bodyElm.appendChild(ghostElm);\r\n            }\r\n        };\r\n        var moveGhost = function (ghostElm, position, width, height, maxX, maxY) {\r\n            var overflowX = 0, overflowY = 0;\r\n            ghostElm.style.left = position.pageX + 'px';\r\n            ghostElm.style.top = position.pageY + 'px';\r\n            if (position.pageX + width > maxX) {\r\n                overflowX = position.pageX + width - maxX;\r\n            }\r\n            if (position.pageY + height > maxY) {\r\n                overflowY = position.pageY + height - maxY;\r\n            }\r\n            ghostElm.style.width = width - overflowX + 'px';\r\n            ghostElm.style.height = height - overflowY + 'px';\r\n        };\r\n        var removeElement = function (elm) {\r\n            if (elm && elm.parentNode) {\r\n                elm.parentNode.removeChild(elm);\r\n            }\r\n        };\r\n        var isLeftMouseButtonPressed = function (e) {\r\n            return e.button === 0;\r\n        };\r\n        var hasDraggableElement = function (state) {\r\n            return state.element;\r\n        };\r\n        var applyRelPos = function (state, position) {\r\n            return {\r\n                pageX: position.pageX - state.relX,\r\n                pageY: position.pageY + 5\r\n            };\r\n        };\r\n        var start = function (state, editor) {\r\n            return function (e) {\r\n                if (isLeftMouseButtonPressed(e)) {\r\n                    var ceElm = find(editor.dom.getParents(e.target), Predicate.or(isContentEditableFalse$6, isContentEditableTrue$2)).getOr(null);\r\n                    if (isDraggable(editor.getBody(), ceElm)) {\r\n                        var elmPos = editor.dom.getPos(ceElm);\r\n                        var bodyElm = editor.getBody();\r\n                        var docElm = editor.getDoc().documentElement;\r\n                        state.element = ceElm;\r\n                        state.screenX = e.screenX;\r\n                        state.screenY = e.screenY;\r\n                        state.maxX = (editor.inline ? bodyElm.scrollWidth : docElm.offsetWidth) - 2;\r\n                        state.maxY = (editor.inline ? bodyElm.scrollHeight : docElm.offsetHeight) - 2;\r\n                        state.relX = e.pageX - elmPos.x;\r\n                        state.relY = e.pageY - elmPos.y;\r\n                        state.width = ceElm.offsetWidth;\r\n                        state.height = ceElm.offsetHeight;\r\n                        state.ghost = createGhost(editor, ceElm, state.width, state.height);\r\n                    }\r\n                }\r\n            };\r\n        };\r\n        var move = function (state, editor) {\r\n            var throttledPlaceCaretAt = Delay.throttle(function (clientX, clientY) {\r\n                editor._selectionOverrides.hideFakeCaret();\r\n                editor.selection.placeCaretAt(clientX, clientY);\r\n            }, 0);\r\n            return function (e) {\r\n                var movement = Math.max(Math.abs(e.screenX - state.screenX), Math.abs(e.screenY - state.screenY));\r\n                if (hasDraggableElement(state) && !state.dragging && movement > 10) {\r\n                    var args = editor.fire('dragstart', { target: state.element });\r\n                    if (args.isDefaultPrevented()) {\r\n                        return;\r\n                    }\r\n                    state.dragging = true;\r\n                    editor.focus();\r\n                }\r\n                if (state.dragging) {\r\n                    var targetPos = applyRelPos(state, MousePosition.calc(editor, e));\r\n                    appendGhostToBody(state.ghost, editor.getBody());\r\n                    moveGhost(state.ghost, targetPos, state.width, state.height, state.maxX, state.maxY);\r\n                    throttledPlaceCaretAt(e.clientX, e.clientY);\r\n                }\r\n            };\r\n        };\r\n        var getRawTarget = function (selection) {\r\n            var rng = selection.getSel().getRangeAt(0);\r\n            var startContainer = rng.startContainer;\r\n            return startContainer.nodeType === 3 ? startContainer.parentNode : startContainer;\r\n        };\r\n        var drop = function (state, editor) {\r\n            return function (e) {\r\n                if (state.dragging) {\r\n                    if (isValidDropTarget(editor, getRawTarget(editor.selection), state.element)) {\r\n                        var targetClone_1 = cloneElement(state.element);\r\n                        var args = editor.fire('drop', {\r\n                            targetClone: targetClone_1,\r\n                            clientX: e.clientX,\r\n                            clientY: e.clientY\r\n                        });\r\n                        if (!args.isDefaultPrevented()) {\r\n                            targetClone_1 = args.targetClone;\r\n                            editor.undoManager.transact(function () {\r\n                                removeElement(state.element);\r\n                                editor.insertContent(editor.dom.getOuterHTML(targetClone_1));\r\n                                editor._selectionOverrides.hideFakeCaret();\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n                removeDragState(state);\r\n            };\r\n        };\r\n        var stop = function (state, editor) {\r\n            return function () {\r\n                if (state.dragging) {\r\n                    editor.fire('dragend');\r\n                }\r\n                removeDragState(state);\r\n            };\r\n        };\r\n        var removeDragState = function (state) {\r\n            state.dragging = false;\r\n            state.element = null;\r\n            removeElement(state.ghost);\r\n        };\r\n        var bindFakeDragEvents = function (editor) {\r\n            var state = {};\r\n            var pageDom, dragStartHandler, dragHandler, dropHandler, dragEndHandler, rootDocument;\r\n            pageDom = DOMUtils$1.DOM;\r\n            rootDocument = domGlobals.document;\r\n            dragStartHandler = start(state, editor);\r\n            dragHandler = move(state, editor);\r\n            dropHandler = drop(state, editor);\r\n            dragEndHandler = stop(state, editor);\r\n            editor.on('mousedown', dragStartHandler);\r\n            editor.on('mousemove', dragHandler);\r\n            editor.on('mouseup', dropHandler);\r\n            pageDom.bind(rootDocument, 'mousemove', dragHandler);\r\n            pageDom.bind(rootDocument, 'mouseup', dragEndHandler);\r\n            editor.on('remove', function () {\r\n                pageDom.unbind(rootDocument, 'mousemove', dragHandler);\r\n                pageDom.unbind(rootDocument, 'mouseup', dragEndHandler);\r\n            });\r\n        };\r\n        var blockIeDrop = function (editor) {\r\n            editor.on('drop', function (e) {\r\n                var realTarget = typeof e.clientX !== 'undefined' ? editor.getDoc().elementFromPoint(e.clientX, e.clientY) : null;\r\n                if (isContentEditableFalse$6(realTarget) || isContentEditableFalse$6(editor.dom.getContentEditableParent(realTarget))) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n        };\r\n        var init = function (editor) {\r\n            bindFakeDragEvents(editor);\r\n            blockIeDrop(editor);\r\n        };\r\n        var DragDropOverrides = { init: init };\r\n        var getNodeClientRects = function (node) {\r\n            var toArrayWithNode = function (clientRects) {\r\n                return map(clientRects, function (clientRect) {\r\n                    clientRect = clone$1(clientRect);\r\n                    clientRect.node = node;\r\n                    return clientRect;\r\n                });\r\n            };\r\n            if (NodeType.isElement(node)) {\r\n                return toArrayWithNode(node.getClientRects());\r\n            }\r\n            if (NodeType.isText(node)) {\r\n                var rng = node.ownerDocument.createRange();\r\n                rng.setStart(node, 0);\r\n                rng.setEnd(node, node.data.length);\r\n                return toArrayWithNode(rng.getClientRects());\r\n            }\r\n        };\r\n        var getClientRects = function (node) {\r\n            return foldl(node, function (result, node) {\r\n                return result.concat(getNodeClientRects(node));\r\n            }, []);\r\n        };\r\n        var VDirection;\r\n        (function (VDirection) {\r\n            VDirection[VDirection['Up'] = -1] = 'Up';\r\n            VDirection[VDirection['Down'] = 1] = 'Down';\r\n        }(VDirection || (VDirection = {})));\r\n        var findUntil = function (direction, root, predicateFn, node) {\r\n            while (node = findNode(node, direction, isEditableCaretCandidate, root)) {\r\n                if (predicateFn(node)) {\r\n                    return;\r\n                }\r\n            }\r\n        };\r\n        var walkUntil = function (direction, isAboveFn, isBeflowFn, root, predicateFn, caretPosition) {\r\n            var line = 0, node;\r\n            var result = [];\r\n            var targetClientRect;\r\n            var add = function (node) {\r\n                var i, clientRect, clientRects;\r\n                clientRects = getClientRects([node]);\r\n                if (direction === -1) {\r\n                    clientRects = clientRects.reverse();\r\n                }\r\n                for (i = 0; i < clientRects.length; i++) {\r\n                    clientRect = clientRects[i];\r\n                    if (isBeflowFn(clientRect, targetClientRect)) {\r\n                        continue;\r\n                    }\r\n                    if (result.length > 0 && isAboveFn(clientRect, ArrUtils.last(result))) {\r\n                        line++;\r\n                    }\r\n                    clientRect.line = line;\r\n                    if (predicateFn(clientRect)) {\r\n                        return true;\r\n                    }\r\n                    result.push(clientRect);\r\n                }\r\n            };\r\n            targetClientRect = ArrUtils.last(caretPosition.getClientRects());\r\n            if (!targetClientRect) {\r\n                return result;\r\n            }\r\n            node = caretPosition.getNode();\r\n            add(node);\r\n            findUntil(direction, root, add, node);\r\n            return result;\r\n        };\r\n        var aboveLineNumber = function (lineNumber, clientRect) {\r\n            return clientRect.line > lineNumber;\r\n        };\r\n        var isLineNumber = function (lineNumber, clientRect) {\r\n            return clientRect.line === lineNumber;\r\n        };\r\n        var upUntil = curry(walkUntil, VDirection.Up, isAbove, isBelow);\r\n        var downUntil = curry(walkUntil, VDirection.Down, isBelow, isAbove);\r\n        var positionsUntil = function (direction, root, predicateFn, node) {\r\n            var caretWalker = CaretWalker(root);\r\n            var walkFn, isBelowFn, isAboveFn, caretPosition;\r\n            var result = [];\r\n            var line = 0, clientRect, targetClientRect;\r\n            var getClientRect = function (caretPosition) {\r\n                if (direction === 1) {\r\n                    return ArrUtils.last(caretPosition.getClientRects());\r\n                }\r\n                return ArrUtils.last(caretPosition.getClientRects());\r\n            };\r\n            if (direction === 1) {\r\n                walkFn = caretWalker.next;\r\n                isBelowFn = isBelow;\r\n                isAboveFn = isAbove;\r\n                caretPosition = CaretPosition$1.after(node);\r\n            }\r\n            else {\r\n                walkFn = caretWalker.prev;\r\n                isBelowFn = isAbove;\r\n                isAboveFn = isBelow;\r\n                caretPosition = CaretPosition$1.before(node);\r\n            }\r\n            targetClientRect = getClientRect(caretPosition);\r\n            do {\r\n                if (!caretPosition.isVisible()) {\r\n                    continue;\r\n                }\r\n                clientRect = getClientRect(caretPosition);\r\n                if (isAboveFn(clientRect, targetClientRect)) {\r\n                    continue;\r\n                }\r\n                if (result.length > 0 && isBelowFn(clientRect, ArrUtils.last(result))) {\r\n                    line++;\r\n                }\r\n                clientRect = clone$1(clientRect);\r\n                clientRect.position = caretPosition;\r\n                clientRect.line = line;\r\n                if (predicateFn(clientRect)) {\r\n                    return result;\r\n                }\r\n                result.push(clientRect);\r\n            } while (caretPosition = walkFn(caretPosition));\r\n            return result;\r\n        };\r\n        var isAboveLine = function (lineNumber) {\r\n            return function (clientRect) {\r\n                return aboveLineNumber(lineNumber, clientRect);\r\n            };\r\n        };\r\n        var isLine = function (lineNumber) {\r\n            return function (clientRect) {\r\n                return isLineNumber(lineNumber, clientRect);\r\n            };\r\n        };\r\n        var isContentEditableFalse$7 = NodeType.isContentEditableFalse;\r\n        var findNode$1 = findNode;\r\n        var distanceToRectLeft = function (clientRect, clientX) {\r\n            return Math.abs(clientRect.left - clientX);\r\n        };\r\n        var distanceToRectRight = function (clientRect, clientX) {\r\n            return Math.abs(clientRect.right - clientX);\r\n        };\r\n        var isInside = function (clientX, clientRect) {\r\n            return clientX >= clientRect.left && clientX <= clientRect.right;\r\n        };\r\n        var findClosestClientRect = function (clientRects, clientX) {\r\n            return ArrUtils.reduce(clientRects, function (oldClientRect, clientRect) {\r\n                var oldDistance, newDistance;\r\n                oldDistance = Math.min(distanceToRectLeft(oldClientRect, clientX), distanceToRectRight(oldClientRect, clientX));\r\n                newDistance = Math.min(distanceToRectLeft(clientRect, clientX), distanceToRectRight(clientRect, clientX));\r\n                if (isInside(clientX, clientRect)) {\r\n                    return clientRect;\r\n                }\r\n                if (isInside(clientX, oldClientRect)) {\r\n                    return oldClientRect;\r\n                }\r\n                if (newDistance === oldDistance && isContentEditableFalse$7(clientRect.node)) {\r\n                    return clientRect;\r\n                }\r\n                if (newDistance < oldDistance) {\r\n                    return clientRect;\r\n                }\r\n                return oldClientRect;\r\n            });\r\n        };\r\n        var walkUntil$1 = function (direction, root, predicateFn, node) {\r\n            while (node = findNode$1(node, direction, isEditableCaretCandidate, root)) {\r\n                if (predicateFn(node)) {\r\n                    return;\r\n                }\r\n            }\r\n        };\r\n        var findLineNodeRects = function (root, targetNodeRect) {\r\n            var clientRects = [];\r\n            var collect = function (checkPosFn, node) {\r\n                var lineRects;\r\n                lineRects = filter(getClientRects([node]), function (clientRect) {\r\n                    return !checkPosFn(clientRect, targetNodeRect);\r\n                });\r\n                clientRects = clientRects.concat(lineRects);\r\n                return lineRects.length === 0;\r\n            };\r\n            clientRects.push(targetNodeRect);\r\n            walkUntil$1(VDirection.Up, root, curry(collect, isAbove), targetNodeRect.node);\r\n            walkUntil$1(VDirection.Down, root, curry(collect, isBelow), targetNodeRect.node);\r\n            return clientRects;\r\n        };\r\n        var getFakeCaretTargets = function (root) {\r\n            return filter(from$1(root.getElementsByTagName('*')), isFakeCaretTarget);\r\n        };\r\n        var caretInfo = function (clientRect, clientX) {\r\n            return {\r\n                node: clientRect.node,\r\n                before: distanceToRectLeft(clientRect, clientX) < distanceToRectRight(clientRect, clientX)\r\n            };\r\n        };\r\n        var closestCaret = function (root, clientX, clientY) {\r\n            var closestNodeRect;\r\n            var contentEditableFalseNodeRects = getClientRects(getFakeCaretTargets(root));\r\n            var targetNodeRects = filter(contentEditableFalseNodeRects, function (rect) {\r\n                return clientY >= rect.top && clientY <= rect.bottom;\r\n            });\r\n            closestNodeRect = findClosestClientRect(targetNodeRects, clientX);\r\n            if (closestNodeRect) {\r\n                closestNodeRect = findClosestClientRect(findLineNodeRects(root, closestNodeRect), clientX);\r\n                if (closestNodeRect && isFakeCaretTarget(closestNodeRect.node)) {\r\n                    return caretInfo(closestNodeRect, clientX);\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        var isXYWithinRange = function (clientX, clientY, range) {\r\n            if (range.collapsed) {\r\n                return false;\r\n            }\r\n            return foldl(range.getClientRects(), function (state, rect) {\r\n                return state || containsXY(rect, clientX, clientY);\r\n            }, false);\r\n        };\r\n        var RangePoint = { isXYWithinRange: isXYWithinRange };\r\n        var isContentEditableTrue$3 = NodeType.isContentEditableTrue;\r\n        var isContentEditableFalse$8 = NodeType.isContentEditableFalse;\r\n        var showCaret = function (direction, editor, node, before, scrollIntoView) {\r\n            return editor._selectionOverrides.showCaret(direction, node, before, scrollIntoView);\r\n        };\r\n        var getNodeRange = function (node) {\r\n            var rng = node.ownerDocument.createRange();\r\n            rng.selectNode(node);\r\n            return rng;\r\n        };\r\n        var selectNode = function (editor, node) {\r\n            var e = editor.fire('BeforeObjectSelected', { target: node });\r\n            if (e.isDefaultPrevented()) {\r\n                return null;\r\n            }\r\n            return getNodeRange(node);\r\n        };\r\n        var renderCaretAtRange = function (editor, range, scrollIntoView) {\r\n            var normalizedRange = normalizeRange(1, editor.getBody(), range);\r\n            var caretPosition = CaretPosition$1.fromRangeStart(normalizedRange);\r\n            var caretPositionNode = caretPosition.getNode();\r\n            if (isContentEditableFalse$8(caretPositionNode)) {\r\n                return showCaret(1, editor, caretPositionNode, !caretPosition.isAtEnd(), false);\r\n            }\r\n            var caretPositionBeforeNode = caretPosition.getNode(true);\r\n            if (isContentEditableFalse$8(caretPositionBeforeNode)) {\r\n                return showCaret(1, editor, caretPositionBeforeNode, false, false);\r\n            }\r\n            var ceRoot = editor.dom.getParent(caretPosition.getNode(), function (node) {\r\n                return isContentEditableFalse$8(node) || isContentEditableTrue$3(node);\r\n            });\r\n            if (isContentEditableFalse$8(ceRoot)) {\r\n                return showCaret(1, editor, ceRoot, false, scrollIntoView);\r\n            }\r\n            return null;\r\n        };\r\n        var renderRangeCaret = function (editor, range, scrollIntoView) {\r\n            if (!range || !range.collapsed) {\r\n                return range;\r\n            }\r\n            var caretRange = renderCaretAtRange(editor, range, scrollIntoView);\r\n            if (caretRange) {\r\n                return caretRange;\r\n            }\r\n            return range;\r\n        };\r\n        var setup$3 = function (editor) {\r\n            var renderFocusCaret = first(function () {\r\n                if (!editor.removed && editor.getBody().contains(domGlobals.document.activeElement)) {\r\n                    var rng = editor.selection.getRng();\r\n                    if (rng.collapsed) {\r\n                        var caretRange = renderRangeCaret(editor, editor.selection.getRng(), false);\r\n                        editor.selection.setRng(caretRange);\r\n                    }\r\n                }\r\n            }, 0);\r\n            editor.on('focus', function () {\r\n                renderFocusCaret.throttle();\r\n            });\r\n            editor.on('blur', function () {\r\n                renderFocusCaret.cancel();\r\n            });\r\n        };\r\n        var CefFocus = { setup: setup$3 };\r\n        var VK = {\r\n            BACKSPACE: 8,\r\n            DELETE: 46,\r\n            DOWN: 40,\r\n            ENTER: 13,\r\n            LEFT: 37,\r\n            RIGHT: 39,\r\n            SPACEBAR: 32,\r\n            TAB: 9,\r\n            UP: 38,\r\n            END: 35,\r\n            HOME: 36,\r\n            modifierPressed: function (e) {\r\n                return e.shiftKey || e.ctrlKey || e.altKey || this.metaKeyPressed(e);\r\n            },\r\n            metaKeyPressed: function (e) {\r\n                return Env.mac ? e.metaKey : e.ctrlKey && !e.altKey;\r\n            }\r\n        };\r\n        var is$2 = function (expected) {\r\n            return function (actual) {\r\n                return expected === actual;\r\n            };\r\n        };\r\n        var isNbsp = is$2('\\xA0');\r\n        var isWhiteSpace$1 = function (chr) {\r\n            return /^[\\r\\n\\t ]$/.test(chr);\r\n        };\r\n        var isContent = function (chr) {\r\n            return !isWhiteSpace$1(chr) && !isNbsp(chr);\r\n        };\r\n        var isChar = function (forward, predicate, pos) {\r\n            return Option.from(pos.container()).filter(NodeType.isText).exists(function (text) {\r\n                var delta = forward ? 0 : -1;\r\n                return predicate(text.data.charAt(pos.offset() + delta));\r\n            });\r\n        };\r\n        var isBeforeSpace = curry(isChar, true, isWhiteSpace$1);\r\n        var isAfterSpace = curry(isChar, false, isWhiteSpace$1);\r\n        var isEmptyText = function (pos) {\r\n            var container = pos.container();\r\n            return NodeType.isText(container) && container.data.length === 0;\r\n        };\r\n        var matchesElementPosition = function (before, predicate) {\r\n            return function (pos) {\r\n                return Option.from(getChildNodeAtRelativeOffset(before ? 0 : -1, pos)).filter(predicate).isSome();\r\n            };\r\n        };\r\n        var isImageBlock = function (node) {\r\n            return node.nodeName === 'IMG' && get$2(Element.fromDom(node), 'display') === 'block';\r\n        };\r\n        var isCefNode = function (node) {\r\n            return NodeType.isContentEditableFalse(node) && !NodeType.isBogusAll(node);\r\n        };\r\n        var isBeforeImageBlock = matchesElementPosition(true, isImageBlock);\r\n        var isAfterImageBlock = matchesElementPosition(false, isImageBlock);\r\n        var isBeforeTable = matchesElementPosition(true, NodeType.isTable);\r\n        var isAfterTable = matchesElementPosition(false, NodeType.isTable);\r\n        var isBeforeContentEditableFalse = matchesElementPosition(true, isCefNode);\r\n        var isAfterContentEditableFalse = matchesElementPosition(false, isCefNode);\r\n        var isContentEditableTrue$4 = NodeType.isContentEditableTrue;\r\n        var isContentEditableFalse$9 = NodeType.isContentEditableFalse;\r\n        var getContentEditableRoot = function (editor, node) {\r\n            var root = editor.getBody();\r\n            while (node && node !== root) {\r\n                if (isContentEditableTrue$4(node) || isContentEditableFalse$9(node)) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var SelectionOverrides = function (editor) {\r\n            var isBlock = function (node) {\r\n                return editor.dom.isBlock(node);\r\n            };\r\n            var rootNode = editor.getBody();\r\n            var fakeCaret = FakeCaret(editor.getBody(), isBlock, function () {\r\n                return EditorFocus.hasFocus(editor);\r\n            });\r\n            var realSelectionId = 'sel-' + editor.dom.uniqueId();\r\n            var selectedContentEditableNode;\r\n            var isFakeSelectionElement = function (elm) {\r\n                return editor.dom.hasClass(elm, 'mce-offscreen-selection');\r\n            };\r\n            var getRealSelectionElement = function () {\r\n                var container = editor.dom.get(realSelectionId);\r\n                return container ? container.getElementsByTagName('*')[0] : container;\r\n            };\r\n            var setRange = function (range) {\r\n                if (range) {\r\n                    editor.selection.setRng(range);\r\n                }\r\n            };\r\n            var getRange = function () {\r\n                return editor.selection.getRng();\r\n            };\r\n            var showCaret = function (direction, node, before, scrollIntoView) {\r\n                if (scrollIntoView === void 0) {\r\n                    scrollIntoView = true;\r\n                }\r\n                var e;\r\n                e = editor.fire('ShowCaret', {\r\n                    target: node,\r\n                    direction: direction,\r\n                    before: before\r\n                });\r\n                if (e.isDefaultPrevented()) {\r\n                    return null;\r\n                }\r\n                if (scrollIntoView) {\r\n                    editor.selection.scrollIntoView(node, direction === -1);\r\n                }\r\n                return fakeCaret.show(before, node);\r\n            };\r\n            var getNormalizedRangeEndPoint = function (direction, range) {\r\n                range = normalizeRange(direction, rootNode, range);\r\n                if (direction === -1) {\r\n                    return CaretPosition$1.fromRangeStart(range);\r\n                }\r\n                return CaretPosition$1.fromRangeEnd(range);\r\n            };\r\n            var showBlockCaretContainer = function (blockCaretContainer) {\r\n                if (blockCaretContainer.hasAttribute('data-mce-caret')) {\r\n                    showCaretContainerBlock(blockCaretContainer);\r\n                    setRange(getRange());\r\n                    editor.selection.scrollIntoView(blockCaretContainer[0]);\r\n                }\r\n            };\r\n            var registerEvents = function () {\r\n                editor.on('mouseup', function (e) {\r\n                    var range = getRange();\r\n                    if (range.collapsed && EditorView.isXYInContentArea(editor, e.clientX, e.clientY)) {\r\n                        setRange(renderCaretAtRange(editor, range, false));\r\n                    }\r\n                });\r\n                editor.on('click', function (e) {\r\n                    var contentEditableRoot;\r\n                    contentEditableRoot = getContentEditableRoot(editor, e.target);\r\n                    if (contentEditableRoot) {\r\n                        if (isContentEditableFalse$9(contentEditableRoot)) {\r\n                            e.preventDefault();\r\n                            editor.focus();\r\n                        }\r\n                        if (isContentEditableTrue$4(contentEditableRoot)) {\r\n                            if (editor.dom.isChildOf(contentEditableRoot, editor.selection.getNode())) {\r\n                                removeContentEditableSelection();\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                editor.on('blur NewBlock', function () {\r\n                    removeContentEditableSelection();\r\n                });\r\n                editor.on('ResizeWindow FullscreenStateChanged', function () {\r\n                    return fakeCaret.reposition();\r\n                });\r\n                var handleTouchSelect = function (editor) {\r\n                    var moved = false;\r\n                    editor.on('touchstart', function () {\r\n                        moved = false;\r\n                    });\r\n                    editor.on('touchmove', function () {\r\n                        moved = true;\r\n                    });\r\n                    editor.on('touchend', function (e) {\r\n                        var contentEditableRoot = getContentEditableRoot(editor, e.target);\r\n                        if (isContentEditableFalse$9(contentEditableRoot)) {\r\n                            if (!moved) {\r\n                                e.preventDefault();\r\n                                setContentEditableSelection(selectNode(editor, contentEditableRoot));\r\n                            }\r\n                        }\r\n                    });\r\n                };\r\n                var hasNormalCaretPosition = function (elm) {\r\n                    var caretWalker = CaretWalker(elm);\r\n                    if (!elm.firstChild) {\r\n                        return false;\r\n                    }\r\n                    var startPos = CaretPosition$1.before(elm.firstChild);\r\n                    var newPos = caretWalker.next(startPos);\r\n                    return newPos && !isBeforeContentEditableFalse(newPos) && !isAfterContentEditableFalse(newPos);\r\n                };\r\n                var isInSameBlock = function (node1, node2) {\r\n                    var block1 = editor.dom.getParent(node1, editor.dom.isBlock);\r\n                    var block2 = editor.dom.getParent(node2, editor.dom.isBlock);\r\n                    return block1 === block2;\r\n                };\r\n                var hasBetterMouseTarget = function (targetNode, caretNode) {\r\n                    var targetBlock = editor.dom.getParent(targetNode, editor.dom.isBlock);\r\n                    var caretBlock = editor.dom.getParent(caretNode, editor.dom.isBlock);\r\n                    if (targetBlock && editor.dom.isChildOf(targetBlock, caretBlock) && isContentEditableFalse$9(getContentEditableRoot(editor, targetBlock)) === false) {\r\n                        return true;\r\n                    }\r\n                    return targetBlock && !isInSameBlock(targetBlock, caretBlock) && hasNormalCaretPosition(targetBlock);\r\n                };\r\n                handleTouchSelect(editor);\r\n                editor.on('mousedown', function (e) {\r\n                    var contentEditableRoot;\r\n                    var targetElm = e.target;\r\n                    if (targetElm !== rootNode && targetElm.nodeName !== 'HTML' && !editor.dom.isChildOf(targetElm, rootNode)) {\r\n                        return;\r\n                    }\r\n                    if (EditorView.isXYInContentArea(editor, e.clientX, e.clientY) === false) {\r\n                        return;\r\n                    }\r\n                    contentEditableRoot = getContentEditableRoot(editor, targetElm);\r\n                    if (contentEditableRoot) {\r\n                        if (isContentEditableFalse$9(contentEditableRoot)) {\r\n                            e.preventDefault();\r\n                            setContentEditableSelection(selectNode(editor, contentEditableRoot));\r\n                        }\r\n                        else {\r\n                            removeContentEditableSelection();\r\n                            if (!(isContentEditableTrue$4(contentEditableRoot) && e.shiftKey) && !RangePoint.isXYWithinRange(e.clientX, e.clientY, editor.selection.getRng())) {\r\n                                hideFakeCaret();\r\n                                editor.selection.placeCaretAt(e.clientX, e.clientY);\r\n                            }\r\n                        }\r\n                    }\r\n                    else if (isFakeCaretTarget(targetElm) === false) {\r\n                        removeContentEditableSelection();\r\n                        hideFakeCaret();\r\n                        var caretInfo = closestCaret(rootNode, e.clientX, e.clientY);\r\n                        if (caretInfo) {\r\n                            if (!hasBetterMouseTarget(e.target, caretInfo.node)) {\r\n                                e.preventDefault();\r\n                                var range = showCaret(1, caretInfo.node, caretInfo.before, false);\r\n                                editor.getBody().focus();\r\n                                setRange(range);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n                editor.on('keypress', function (e) {\r\n                    if (VK.modifierPressed(e)) {\r\n                        return;\r\n                    }\r\n                    switch (e.keyCode) {\r\n                        default:\r\n                            if (isContentEditableFalse$9(editor.selection.getNode())) {\r\n                                e.preventDefault();\r\n                            }\r\n                            break;\r\n                    }\r\n                });\r\n                editor.on('GetSelectionRange', function (e) {\r\n                    var rng = e.range;\r\n                    if (selectedContentEditableNode) {\r\n                        if (!selectedContentEditableNode.parentNode) {\r\n                            selectedContentEditableNode = null;\r\n                            return;\r\n                        }\r\n                        rng = rng.cloneRange();\r\n                        rng.selectNode(selectedContentEditableNode);\r\n                        e.range = rng;\r\n                    }\r\n                });\r\n                editor.on('SetSelectionRange', function (e) {\r\n                    var rng;\r\n                    rng = setContentEditableSelection(e.range, e.forward);\r\n                    if (rng) {\r\n                        e.range = rng;\r\n                    }\r\n                });\r\n                var isPasteBin = function (node) {\r\n                    return node.id === 'mcepastebin';\r\n                };\r\n                editor.on('AfterSetSelectionRange', function (e) {\r\n                    var rng = e.range;\r\n                    if (!isRangeInCaretContainer(rng) && !isPasteBin(rng.startContainer.parentNode)) {\r\n                        hideFakeCaret();\r\n                    }\r\n                    if (!isFakeSelectionElement(rng.startContainer.parentNode)) {\r\n                        removeContentEditableSelection();\r\n                    }\r\n                });\r\n                editor.on('copy', function (e) {\r\n                    var clipboardData = e.clipboardData;\r\n                    if (!e.isDefaultPrevented() && e.clipboardData && !Env.ie) {\r\n                        var realSelectionElement = getRealSelectionElement();\r\n                        if (realSelectionElement) {\r\n                            e.preventDefault();\r\n                            clipboardData.clearData();\r\n                            clipboardData.setData('text/html', realSelectionElement.outerHTML);\r\n                            clipboardData.setData('text/plain', realSelectionElement.outerText);\r\n                        }\r\n                    }\r\n                });\r\n                DragDropOverrides.init(editor);\r\n                CefFocus.setup(editor);\r\n            };\r\n            var isWithinCaretContainer = function (node) {\r\n                return isCaretContainer(node) || startsWithCaretContainer(node) || endsWithCaretContainer(node);\r\n            };\r\n            var isRangeInCaretContainer = function (rng) {\r\n                return isWithinCaretContainer(rng.startContainer) || isWithinCaretContainer(rng.endContainer);\r\n            };\r\n            var setContentEditableSelection = function (range, forward) {\r\n                var node;\r\n                var $ = editor.$;\r\n                var dom = editor.dom;\r\n                var $realSelectionContainer, sel, startContainer, startOffset, endOffset, e, caretPosition, targetClone, origTargetClone;\r\n                if (!range) {\r\n                    return null;\r\n                }\r\n                if (range.collapsed) {\r\n                    if (!isRangeInCaretContainer(range)) {\r\n                        if (forward === false) {\r\n                            caretPosition = getNormalizedRangeEndPoint(-1, range);\r\n                            if (isFakeCaretTarget(caretPosition.getNode(true))) {\r\n                                return showCaret(-1, caretPosition.getNode(true), false, false);\r\n                            }\r\n                            if (isFakeCaretTarget(caretPosition.getNode())) {\r\n                                return showCaret(-1, caretPosition.getNode(), !caretPosition.isAtEnd(), false);\r\n                            }\r\n                        }\r\n                        else {\r\n                            caretPosition = getNormalizedRangeEndPoint(1, range);\r\n                            if (isFakeCaretTarget(caretPosition.getNode())) {\r\n                                return showCaret(1, caretPosition.getNode(), !caretPosition.isAtEnd(), false);\r\n                            }\r\n                            if (isFakeCaretTarget(caretPosition.getNode(true))) {\r\n                                return showCaret(1, caretPosition.getNode(true), false, false);\r\n                            }\r\n                        }\r\n                    }\r\n                    return null;\r\n                }\r\n                startContainer = range.startContainer;\r\n                startOffset = range.startOffset;\r\n                endOffset = range.endOffset;\r\n                if (startContainer.nodeType === 3 && startOffset === 0 && isContentEditableFalse$9(startContainer.parentNode)) {\r\n                    startContainer = startContainer.parentNode;\r\n                    startOffset = dom.nodeIndex(startContainer);\r\n                    startContainer = startContainer.parentNode;\r\n                }\r\n                if (startContainer.nodeType !== 1) {\r\n                    return null;\r\n                }\r\n                if (endOffset === startOffset + 1) {\r\n                    node = startContainer.childNodes[startOffset];\r\n                }\r\n                if (!isContentEditableFalse$9(node)) {\r\n                    return null;\r\n                }\r\n                targetClone = origTargetClone = node.cloneNode(true);\r\n                e = editor.fire('ObjectSelected', {\r\n                    target: node,\r\n                    targetClone: targetClone\r\n                });\r\n                if (e.isDefaultPrevented()) {\r\n                    return null;\r\n                }\r\n                $realSelectionContainer = descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).fold(function () {\r\n                    return $([]);\r\n                }, function (elm) {\r\n                    return $([elm.dom()]);\r\n                });\r\n                targetClone = e.targetClone;\r\n                if ($realSelectionContainer.length === 0) {\r\n                    $realSelectionContainer = $('<div data-mce-bogus=\"all\" class=\"mce-offscreen-selection\"></div>').attr('id', realSelectionId);\r\n                    $realSelectionContainer.appendTo(editor.getBody());\r\n                }\r\n                range = editor.dom.createRng();\r\n                if (targetClone === origTargetClone && Env.ie) {\r\n                    $realSelectionContainer.empty().append('<p style=\"font-size: 0\" data-mce-bogus=\"all\">\\xA0</p>').append(targetClone);\r\n                    range.setStartAfter($realSelectionContainer[0].firstChild.firstChild);\r\n                    range.setEndAfter(targetClone);\r\n                }\r\n                else {\r\n                    $realSelectionContainer.empty().append('\\xA0').append(targetClone).append('\\xA0');\r\n                    range.setStart($realSelectionContainer[0].firstChild, 1);\r\n                    range.setEnd($realSelectionContainer[0].lastChild, 0);\r\n                }\r\n                $realSelectionContainer.css({ top: dom.getPos(node, editor.getBody()).y });\r\n                $realSelectionContainer[0].focus();\r\n                sel = editor.selection.getSel();\r\n                sel.removeAllRanges();\r\n                sel.addRange(range);\r\n                each(descendants$1(Element.fromDom(editor.getBody()), '*[data-mce-selected]'), function (elm) {\r\n                    remove(elm, 'data-mce-selected');\r\n                });\r\n                node.setAttribute('data-mce-selected', '1');\r\n                selectedContentEditableNode = node;\r\n                hideFakeCaret();\r\n                return range;\r\n            };\r\n            var removeContentEditableSelection = function () {\r\n                if (selectedContentEditableNode) {\r\n                    selectedContentEditableNode.removeAttribute('data-mce-selected');\r\n                    descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).each(remove$1);\r\n                    selectedContentEditableNode = null;\r\n                }\r\n                descendant(Element.fromDom(editor.getBody()), '#' + realSelectionId).each(remove$1);\r\n                selectedContentEditableNode = null;\r\n            };\r\n            var destroy = function () {\r\n                fakeCaret.destroy();\r\n                selectedContentEditableNode = null;\r\n            };\r\n            var hideFakeCaret = function () {\r\n                fakeCaret.hide();\r\n            };\r\n            if (Env.ceFalse) {\r\n                registerEvents();\r\n            }\r\n            return {\r\n                showCaret: showCaret,\r\n                showBlockCaretContainer: showBlockCaretContainer,\r\n                hideFakeCaret: hideFakeCaret,\r\n                destroy: destroy\r\n            };\r\n        };\r\n        var KEEP = 0, INSERT = 1, DELETE = 2;\r\n        var diff = function (left, right) {\r\n            var size = left.length + right.length + 2;\r\n            var vDown = new Array(size);\r\n            var vUp = new Array(size);\r\n            var snake = function (start, end, diag) {\r\n                return {\r\n                    start: start,\r\n                    end: end,\r\n                    diag: diag\r\n                };\r\n            };\r\n            var buildScript = function (start1, end1, start2, end2, script) {\r\n                var middle = getMiddleSnake(start1, end1, start2, end2);\r\n                if (middle === null || middle.start === end1 && middle.diag === end1 - end2 || middle.end === start1 && middle.diag === start1 - start2) {\r\n                    var i = start1;\r\n                    var j = start2;\r\n                    while (i < end1 || j < end2) {\r\n                        if (i < end1 && j < end2 && left[i] === right[j]) {\r\n                            script.push([\r\n                                KEEP,\r\n                                left[i]\r\n                            ]);\r\n                            ++i;\r\n                            ++j;\r\n                        }\r\n                        else {\r\n                            if (end1 - start1 > end2 - start2) {\r\n                                script.push([\r\n                                    DELETE,\r\n                                    left[i]\r\n                                ]);\r\n                                ++i;\r\n                            }\r\n                            else {\r\n                                script.push([\r\n                                    INSERT,\r\n                                    right[j]\r\n                                ]);\r\n                                ++j;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    buildScript(start1, middle.start, start2, middle.start - middle.diag, script);\r\n                    for (var i2 = middle.start; i2 < middle.end; ++i2) {\r\n                        script.push([\r\n                            KEEP,\r\n                            left[i2]\r\n                        ]);\r\n                    }\r\n                    buildScript(middle.end, end1, middle.end - middle.diag, end2, script);\r\n                }\r\n            };\r\n            var buildSnake = function (start, diag, end1, end2) {\r\n                var end = start;\r\n                while (end - diag < end2 && end < end1 && left[end] === right[end - diag]) {\r\n                    ++end;\r\n                }\r\n                return snake(start, end, diag);\r\n            };\r\n            var getMiddleSnake = function (start1, end1, start2, end2) {\r\n                var m = end1 - start1;\r\n                var n = end2 - start2;\r\n                if (m === 0 || n === 0) {\r\n                    return null;\r\n                }\r\n                var delta = m - n;\r\n                var sum = n + m;\r\n                var offset = (sum % 2 === 0 ? sum : sum + 1) / 2;\r\n                vDown[1 + offset] = start1;\r\n                vUp[1 + offset] = end1 + 1;\r\n                var d, k, i, x, y;\r\n                for (d = 0; d <= offset; ++d) {\r\n                    for (k = -d; k <= d; k += 2) {\r\n                        i = k + offset;\r\n                        if (k === -d || k !== d && vDown[i - 1] < vDown[i + 1]) {\r\n                            vDown[i] = vDown[i + 1];\r\n                        }\r\n                        else {\r\n                            vDown[i] = vDown[i - 1] + 1;\r\n                        }\r\n                        x = vDown[i];\r\n                        y = x - start1 + start2 - k;\r\n                        while (x < end1 && y < end2 && left[x] === right[y]) {\r\n                            vDown[i] = ++x;\r\n                            ++y;\r\n                        }\r\n                        if (delta % 2 !== 0 && delta - d <= k && k <= delta + d) {\r\n                            if (vUp[i - delta] <= vDown[i]) {\r\n                                return buildSnake(vUp[i - delta], k + start1 - start2, end1, end2);\r\n                            }\r\n                        }\r\n                    }\r\n                    for (k = delta - d; k <= delta + d; k += 2) {\r\n                        i = k + offset - delta;\r\n                        if (k === delta - d || k !== delta + d && vUp[i + 1] <= vUp[i - 1]) {\r\n                            vUp[i] = vUp[i + 1] - 1;\r\n                        }\r\n                        else {\r\n                            vUp[i] = vUp[i - 1];\r\n                        }\r\n                        x = vUp[i] - 1;\r\n                        y = x - start1 + start2 - k;\r\n                        while (x >= start1 && y >= start2 && left[x] === right[y]) {\r\n                            vUp[i] = x--;\r\n                            y--;\r\n                        }\r\n                        if (delta % 2 === 0 && -d <= k && k <= d) {\r\n                            if (vUp[i] <= vDown[i + delta]) {\r\n                                return buildSnake(vUp[i], k + start1 - start2, end1, end2);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var script = [];\r\n            buildScript(0, left.length, 0, right.length, script);\r\n            return script;\r\n        };\r\n        var Diff = {\r\n            KEEP: KEEP,\r\n            DELETE: DELETE,\r\n            INSERT: INSERT,\r\n            diff: diff\r\n        };\r\n        var getOuterHtml = function (elm) {\r\n            if (NodeType.isElement(elm)) {\r\n                return elm.outerHTML;\r\n            }\r\n            else if (NodeType.isText(elm)) {\r\n                return Entities.encodeRaw(elm.data, false);\r\n            }\r\n            else if (NodeType.isComment(elm)) {\r\n                return '<!--' + elm.data + '-->';\r\n            }\r\n            return '';\r\n        };\r\n        var createFragment$1 = function (html) {\r\n            var frag, node, container;\r\n            container = domGlobals.document.createElement('div');\r\n            frag = domGlobals.document.createDocumentFragment();\r\n            if (html) {\r\n                container.innerHTML = html;\r\n            }\r\n            while (node = container.firstChild) {\r\n                frag.appendChild(node);\r\n            }\r\n            return frag;\r\n        };\r\n        var insertAt = function (elm, html, index) {\r\n            var fragment = createFragment$1(html);\r\n            if (elm.hasChildNodes() && index < elm.childNodes.length) {\r\n                var target = elm.childNodes[index];\r\n                target.parentNode.insertBefore(fragment, target);\r\n            }\r\n            else {\r\n                elm.appendChild(fragment);\r\n            }\r\n        };\r\n        var removeAt = function (elm, index) {\r\n            if (elm.hasChildNodes() && index < elm.childNodes.length) {\r\n                var target = elm.childNodes[index];\r\n                target.parentNode.removeChild(target);\r\n            }\r\n        };\r\n        var applyDiff = function (diff, elm) {\r\n            var index = 0;\r\n            each(diff, function (action) {\r\n                if (action[0] === Diff.KEEP) {\r\n                    index++;\r\n                }\r\n                else if (action[0] === Diff.INSERT) {\r\n                    insertAt(elm, action[1], index);\r\n                    index++;\r\n                }\r\n                else if (action[0] === Diff.DELETE) {\r\n                    removeAt(elm, index);\r\n                }\r\n            });\r\n        };\r\n        var read$1 = function (elm) {\r\n            return filter(map(from$1(elm.childNodes), getOuterHtml), function (item) {\r\n                return item.length > 0;\r\n            });\r\n        };\r\n        var write = function (fragments, elm) {\r\n            var currentFragments = map(from$1(elm.childNodes), getOuterHtml);\r\n            applyDiff(Diff.diff(currentFragments, fragments), elm);\r\n            return elm;\r\n        };\r\n        var Fragments = {\r\n            read: read$1,\r\n            write: write\r\n        };\r\n        var undoLevelDocument = Cell(Option.none());\r\n        var lazyTempDocument = function () {\r\n            return undoLevelDocument.get().getOrThunk(function () {\r\n                var doc = domGlobals.document.implementation.createHTMLDocument('undo');\r\n                undoLevelDocument.set(Option.some(doc));\r\n                return doc;\r\n            });\r\n        };\r\n        var hasIframes = function (html) {\r\n            return html.indexOf('</iframe>') !== -1;\r\n        };\r\n        var createFragmentedLevel = function (fragments) {\r\n            return {\r\n                type: 'fragmented',\r\n                fragments: fragments,\r\n                content: '',\r\n                bookmark: null,\r\n                beforeBookmark: null\r\n            };\r\n        };\r\n        var createCompleteLevel = function (content) {\r\n            return {\r\n                type: 'complete',\r\n                fragments: null,\r\n                content: content,\r\n                bookmark: null,\r\n                beforeBookmark: null\r\n            };\r\n        };\r\n        var createFromEditor = function (editor) {\r\n            var fragments, content, trimmedFragments;\r\n            fragments = Fragments.read(editor.getBody());\r\n            trimmedFragments = bind(fragments, function (html) {\r\n                var trimmed = TrimHtml.trimInternal(editor.serializer, html);\r\n                return trimmed.length > 0 ? [trimmed] : [];\r\n            });\r\n            content = trimmedFragments.join('');\r\n            return hasIframes(content) ? createFragmentedLevel(trimmedFragments) : createCompleteLevel(content);\r\n        };\r\n        var applyToEditor = function (editor, level, before) {\r\n            if (level.type === 'fragmented') {\r\n                Fragments.write(level.fragments, editor.getBody());\r\n            }\r\n            else {\r\n                editor.setContent(level.content, { format: 'raw' });\r\n            }\r\n            editor.selection.moveToBookmark(before ? level.beforeBookmark : level.bookmark);\r\n        };\r\n        var getLevelContent = function (level) {\r\n            return level.type === 'fragmented' ? level.fragments.join('') : level.content;\r\n        };\r\n        var getCleanLevelContent = function (level) {\r\n            var elm = Element.fromTag('body', lazyTempDocument());\r\n            set$1(elm, getLevelContent(level));\r\n            each(descendants$1(elm, '*[data-mce-bogus]'), unwrap);\r\n            return get$4(elm);\r\n        };\r\n        var hasEqualContent = function (level1, level2) {\r\n            return getLevelContent(level1) === getLevelContent(level2);\r\n        };\r\n        var hasEqualCleanedContent = function (level1, level2) {\r\n            return getCleanLevelContent(level1) === getCleanLevelContent(level2);\r\n        };\r\n        var isEq$2 = function (level1, level2) {\r\n            if (!level1 || !level2) {\r\n                return false;\r\n            }\r\n            else if (hasEqualContent(level1, level2)) {\r\n                return true;\r\n            }\r\n            else {\r\n                return hasEqualCleanedContent(level1, level2);\r\n            }\r\n        };\r\n        var Levels = {\r\n            createFragmentedLevel: createFragmentedLevel,\r\n            createCompleteLevel: createCompleteLevel,\r\n            createFromEditor: createFromEditor,\r\n            applyToEditor: applyToEditor,\r\n            isEq: isEq$2\r\n        };\r\n        var UndoManager = function (editor) {\r\n            var self = this, index = 0, data = [], beforeBookmark, isFirstTypedCharacter, locks = 0;\r\n            var isUnlocked = function () {\r\n                return locks === 0;\r\n            };\r\n            var setTyping = function (typing) {\r\n                if (isUnlocked()) {\r\n                    self.typing = typing;\r\n                }\r\n            };\r\n            var setDirty = function (state) {\r\n                editor.setDirty(state);\r\n            };\r\n            var addNonTypingUndoLevel = function (e) {\r\n                setTyping(false);\r\n                self.add({}, e);\r\n            };\r\n            var endTyping = function () {\r\n                if (self.typing) {\r\n                    setTyping(false);\r\n                    self.add();\r\n                }\r\n            };\r\n            editor.on('init', function () {\r\n                self.add();\r\n            });\r\n            editor.on('BeforeExecCommand', function (e) {\r\n                var cmd = e.command;\r\n                if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\r\n                    endTyping();\r\n                    self.beforeChange();\r\n                }\r\n            });\r\n            editor.on('ExecCommand', function (e) {\r\n                var cmd = e.command;\r\n                if (cmd !== 'Undo' && cmd !== 'Redo' && cmd !== 'mceRepaint') {\r\n                    addNonTypingUndoLevel(e);\r\n                }\r\n            });\r\n            editor.on('ObjectResizeStart cut', function () {\r\n                self.beforeChange();\r\n            });\r\n            editor.on('SaveContent ObjectResized blur', addNonTypingUndoLevel);\r\n            editor.on('dragend', addNonTypingUndoLevel);\r\n            editor.on('keyup', function (e) {\r\n                var keyCode = e.keyCode;\r\n                if (e.isDefaultPrevented()) {\r\n                    return;\r\n                }\r\n                if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45 || e.ctrlKey) {\r\n                    addNonTypingUndoLevel();\r\n                    editor.nodeChanged();\r\n                }\r\n                if (keyCode === 46 || keyCode === 8) {\r\n                    editor.nodeChanged();\r\n                }\r\n                if (isFirstTypedCharacter && self.typing && Levels.isEq(Levels.createFromEditor(editor), data[0]) === false) {\r\n                    if (editor.isDirty() === false) {\r\n                        setDirty(true);\r\n                        editor.fire('change', {\r\n                            level: data[0],\r\n                            lastLevel: null\r\n                        });\r\n                    }\r\n                    editor.fire('TypingUndo');\r\n                    isFirstTypedCharacter = false;\r\n                    editor.nodeChanged();\r\n                }\r\n            });\r\n            editor.on('keydown', function (e) {\r\n                var keyCode = e.keyCode;\r\n                if (e.isDefaultPrevented()) {\r\n                    return;\r\n                }\r\n                if (keyCode >= 33 && keyCode <= 36 || keyCode >= 37 && keyCode <= 40 || keyCode === 45) {\r\n                    if (self.typing) {\r\n                        addNonTypingUndoLevel(e);\r\n                    }\r\n                    return;\r\n                }\r\n                var modKey = e.ctrlKey && !e.altKey || e.metaKey;\r\n                if ((keyCode < 16 || keyCode > 20) && keyCode !== 224 && keyCode !== 91 && !self.typing && !modKey) {\r\n                    self.beforeChange();\r\n                    setTyping(true);\r\n                    self.add({}, e);\r\n                    isFirstTypedCharacter = true;\r\n                }\r\n            });\r\n            editor.on('mousedown', function (e) {\r\n                if (self.typing) {\r\n                    addNonTypingUndoLevel(e);\r\n                }\r\n            });\r\n            var isInsertReplacementText = function (event) {\r\n                return event.inputType === 'insertReplacementText';\r\n            };\r\n            var isInsertTextDataNull = function (event) {\r\n                return event.inputType === 'insertText' && event.data === null;\r\n            };\r\n            editor.on('input', function (e) {\r\n                if (e.inputType && (isInsertReplacementText(e) || isInsertTextDataNull(e))) {\r\n                    addNonTypingUndoLevel(e);\r\n                }\r\n            });\r\n            editor.addShortcut('meta+z', '', 'Undo');\r\n            editor.addShortcut('meta+y,meta+shift+z', '', 'Redo');\r\n            editor.on('AddUndo Undo Redo ClearUndos', function (e) {\r\n                if (!e.isDefaultPrevented()) {\r\n                    editor.nodeChanged();\r\n                }\r\n            });\r\n            self = {\r\n                data: data,\r\n                typing: false,\r\n                beforeChange: function () {\r\n                    if (isUnlocked()) {\r\n                        beforeBookmark = GetBookmark.getUndoBookmark(editor.selection);\r\n                    }\r\n                },\r\n                add: function (level, event) {\r\n                    var i;\r\n                    var settings = editor.settings;\r\n                    var lastLevel, currentLevel;\r\n                    currentLevel = Levels.createFromEditor(editor);\r\n                    level = level || {};\r\n                    level = Tools.extend(level, currentLevel);\r\n                    if (isUnlocked() === false || editor.removed) {\r\n                        return null;\r\n                    }\r\n                    lastLevel = data[index];\r\n                    if (editor.fire('BeforeAddUndo', {\r\n                        level: level,\r\n                        lastLevel: lastLevel,\r\n                        originalEvent: event\r\n                    }).isDefaultPrevented()) {\r\n                        return null;\r\n                    }\r\n                    if (lastLevel && Levels.isEq(lastLevel, level)) {\r\n                        return null;\r\n                    }\r\n                    if (data[index]) {\r\n                        data[index].beforeBookmark = beforeBookmark;\r\n                    }\r\n                    if (settings.custom_undo_redo_levels) {\r\n                        if (data.length > settings.custom_undo_redo_levels) {\r\n                            for (i = 0; i < data.length - 1; i++) {\r\n                                data[i] = data[i + 1];\r\n                            }\r\n                            data.length--;\r\n                            index = data.length;\r\n                        }\r\n                    }\r\n                    level.bookmark = GetBookmark.getUndoBookmark(editor.selection);\r\n                    if (index < data.length - 1) {\r\n                        data.length = index + 1;\r\n                    }\r\n                    data.push(level);\r\n                    index = data.length - 1;\r\n                    var args = {\r\n                        level: level,\r\n                        lastLevel: lastLevel,\r\n                        originalEvent: event\r\n                    };\r\n                    editor.fire('AddUndo', args);\r\n                    if (index > 0) {\r\n                        setDirty(true);\r\n                        editor.fire('change', args);\r\n                    }\r\n                    return level;\r\n                },\r\n                undo: function () {\r\n                    var level;\r\n                    if (self.typing) {\r\n                        self.add();\r\n                        self.typing = false;\r\n                        setTyping(false);\r\n                    }\r\n                    if (index > 0) {\r\n                        level = data[--index];\r\n                        Levels.applyToEditor(editor, level, true);\r\n                        setDirty(true);\r\n                        editor.fire('Undo', { level: level });\r\n                    }\r\n                    return level;\r\n                },\r\n                redo: function () {\r\n                    var level;\r\n                    if (index < data.length - 1) {\r\n                        level = data[++index];\r\n                        Levels.applyToEditor(editor, level, false);\r\n                        setDirty(true);\r\n                        editor.fire('Redo', { level: level });\r\n                    }\r\n                    return level;\r\n                },\r\n                clear: function () {\r\n                    data = [];\r\n                    index = 0;\r\n                    self.typing = false;\r\n                    self.data = data;\r\n                    editor.fire('ClearUndos');\r\n                },\r\n                reset: function () {\r\n                    self.clear();\r\n                    self.add();\r\n                },\r\n                hasUndo: function () {\r\n                    return index > 0 || self.typing && data[0] && !Levels.isEq(Levels.createFromEditor(editor), data[0]);\r\n                },\r\n                hasRedo: function () {\r\n                    return index < data.length - 1 && !self.typing;\r\n                },\r\n                transact: function (callback) {\r\n                    endTyping();\r\n                    self.beforeChange();\r\n                    self.ignore(callback);\r\n                    return self.add();\r\n                },\r\n                ignore: function (callback) {\r\n                    try {\r\n                        locks++;\r\n                        callback();\r\n                    }\r\n                    finally {\r\n                        locks--;\r\n                    }\r\n                },\r\n                extra: function (callback1, callback2) {\r\n                    var lastLevel, bookmark;\r\n                    if (self.transact(callback1)) {\r\n                        bookmark = data[index].bookmark;\r\n                        lastLevel = data[index - 1];\r\n                        Levels.applyToEditor(editor, lastLevel, true);\r\n                        if (self.transact(callback2)) {\r\n                            data[index - 1].beforeBookmark = bookmark;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            return self;\r\n        };\r\n        var getLastChildren$1 = function (elm) {\r\n            var children = [];\r\n            var rawNode = elm.dom();\r\n            while (rawNode) {\r\n                children.push(Element.fromDom(rawNode));\r\n                rawNode = rawNode.lastChild;\r\n            }\r\n            return children;\r\n        };\r\n        var removeTrailingBr = function (elm) {\r\n            var allBrs = descendants$1(elm, 'br');\r\n            var brs = filter(getLastChildren$1(elm).slice(-1), isBr$1);\r\n            if (allBrs.length === brs.length) {\r\n                each(brs, remove$1);\r\n            }\r\n        };\r\n        var fillWithPaddingBr = function (elm) {\r\n            empty(elm);\r\n            append(elm, Element.fromHtml('<br data-mce-bogus=\"1\">'));\r\n        };\r\n        var isPaddingContents = function (elm) {\r\n            return isText(elm) ? get$5(elm) === '\\xA0' : isBr$1(elm);\r\n        };\r\n        var isPaddedElement = function (elm) {\r\n            return filter(children(elm), isPaddingContents).length === 1;\r\n        };\r\n        var trimBlockTrailingBr = function (elm) {\r\n            lastChild(elm).each(function (lastChild) {\r\n                prevSibling(lastChild).each(function (lastChildPrevSibling) {\r\n                    if (isBlock(elm) && isBr$1(lastChild) && isBlock(lastChildPrevSibling)) {\r\n                        remove$1(lastChild);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var PaddingBr = {\r\n            removeTrailingBr: removeTrailingBr,\r\n            fillWithPaddingBr: fillWithPaddingBr,\r\n            isPaddedElement: isPaddedElement,\r\n            trimBlockTrailingBr: trimBlockTrailingBr\r\n        };\r\n        var isEq$3 = FormatUtils.isEq;\r\n        var matchesUnInheritedFormatSelector = function (ed, node, name) {\r\n            var formatList = ed.formatter.get(name);\r\n            if (formatList) {\r\n                for (var i = 0; i < formatList.length; i++) {\r\n                    if (formatList[i].inherit === false && ed.dom.is(node, formatList[i].selector)) {\r\n                        return true;\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var matchParents = function (editor, node, name, vars) {\r\n            var root = editor.dom.getRoot();\r\n            if (node === root) {\r\n                return false;\r\n            }\r\n            node = editor.dom.getParent(node, function (node) {\r\n                if (matchesUnInheritedFormatSelector(editor, node, name)) {\r\n                    return true;\r\n                }\r\n                return node.parentNode === root || !!matchNode(editor, node, name, vars, true);\r\n            });\r\n            return matchNode(editor, node, name, vars);\r\n        };\r\n        var matchName = function (dom, node, format) {\r\n            if (isEq$3(node, format.inline)) {\r\n                return true;\r\n            }\r\n            if (isEq$3(node, format.block)) {\r\n                return true;\r\n            }\r\n            if (format.selector) {\r\n                return node.nodeType === 1 && dom.is(node, format.selector);\r\n            }\r\n        };\r\n        var matchItems = function (dom, node, format, itemName, similar, vars) {\r\n            var key, value;\r\n            var items = format[itemName];\r\n            var i;\r\n            if (format.onmatch) {\r\n                return format.onmatch(node, format, itemName);\r\n            }\r\n            if (items) {\r\n                if (typeof items.length === 'undefined') {\r\n                    for (key in items) {\r\n                        if (items.hasOwnProperty(key)) {\r\n                            if (itemName === 'attributes') {\r\n                                value = dom.getAttrib(node, key);\r\n                            }\r\n                            else {\r\n                                value = FormatUtils.getStyle(dom, node, key);\r\n                            }\r\n                            if (similar && !value && !format.exact) {\r\n                                return;\r\n                            }\r\n                            if ((!similar || format.exact) && !isEq$3(value, FormatUtils.normalizeStyleValue(dom, FormatUtils.replaceVars(items[key], vars), key))) {\r\n                                return;\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    for (i = 0; i < items.length; i++) {\r\n                        if (itemName === 'attributes' ? dom.getAttrib(node, items[i]) : FormatUtils.getStyle(dom, node, items[i])) {\r\n                            return format;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return format;\r\n        };\r\n        var matchNode = function (ed, node, name, vars, similar) {\r\n            var formatList = ed.formatter.get(name);\r\n            var format, i, x, classes;\r\n            var dom = ed.dom;\r\n            if (formatList && node) {\r\n                for (i = 0; i < formatList.length; i++) {\r\n                    format = formatList[i];\r\n                    if (matchName(ed.dom, node, format) && matchItems(dom, node, format, 'attributes', similar, vars) && matchItems(dom, node, format, 'styles', similar, vars)) {\r\n                        if (classes = format.classes) {\r\n                            for (x = 0; x < classes.length; x++) {\r\n                                if (!ed.dom.hasClass(node, classes[x])) {\r\n                                    return;\r\n                                }\r\n                            }\r\n                        }\r\n                        return format;\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var match = function (editor, name, vars, node) {\r\n            var startNode;\r\n            if (node) {\r\n                return matchParents(editor, node, name, vars);\r\n            }\r\n            node = editor.selection.getNode();\r\n            if (matchParents(editor, node, name, vars)) {\r\n                return true;\r\n            }\r\n            startNode = editor.selection.getStart();\r\n            if (startNode !== node) {\r\n                if (matchParents(editor, startNode, name, vars)) {\r\n                    return true;\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var matchAll = function (editor, names, vars) {\r\n            var startElement;\r\n            var matchedFormatNames = [];\r\n            var checkedMap = {};\r\n            startElement = editor.selection.getStart();\r\n            editor.dom.getParent(startElement, function (node) {\r\n                var i, name;\r\n                for (i = 0; i < names.length; i++) {\r\n                    name = names[i];\r\n                    if (!checkedMap[name] && matchNode(editor, node, name, vars)) {\r\n                        checkedMap[name] = true;\r\n                        matchedFormatNames.push(name);\r\n                    }\r\n                }\r\n            }, editor.dom.getRoot());\r\n            return matchedFormatNames;\r\n        };\r\n        var canApply = function (editor, name) {\r\n            var formatList = editor.formatter.get(name);\r\n            var startNode, parents, i, x, selector;\r\n            var dom = editor.dom;\r\n            if (formatList) {\r\n                startNode = editor.selection.getStart();\r\n                parents = FormatUtils.getParents(dom, startNode);\r\n                for (x = formatList.length - 1; x >= 0; x--) {\r\n                    selector = formatList[x].selector;\r\n                    if (!selector || formatList[x].defaultBlock) {\r\n                        return true;\r\n                    }\r\n                    for (i = parents.length - 1; i >= 0; i--) {\r\n                        if (dom.is(parents[i], selector)) {\r\n                            return true;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var MatchFormat = {\r\n            matchNode: matchNode,\r\n            matchName: matchName,\r\n            match: match,\r\n            matchAll: matchAll,\r\n            canApply: canApply,\r\n            matchesUnInheritedFormatSelector: matchesUnInheritedFormatSelector\r\n        };\r\n        var splitText = function (node, offset) {\r\n            return node.splitText(offset);\r\n        };\r\n        var split$1 = function (rng) {\r\n            var startContainer = rng.startContainer, startOffset = rng.startOffset, endContainer = rng.endContainer, endOffset = rng.endOffset;\r\n            if (startContainer === endContainer && NodeType.isText(startContainer)) {\r\n                if (startOffset > 0 && startOffset < startContainer.nodeValue.length) {\r\n                    endContainer = splitText(startContainer, startOffset);\r\n                    startContainer = endContainer.previousSibling;\r\n                    if (endOffset > startOffset) {\r\n                        endOffset = endOffset - startOffset;\r\n                        startContainer = endContainer = splitText(endContainer, endOffset).previousSibling;\r\n                        endOffset = endContainer.nodeValue.length;\r\n                        startOffset = 0;\r\n                    }\r\n                    else {\r\n                        endOffset = 0;\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                if (NodeType.isText(startContainer) && startOffset > 0 && startOffset < startContainer.nodeValue.length) {\r\n                    startContainer = splitText(startContainer, startOffset);\r\n                    startOffset = 0;\r\n                }\r\n                if (NodeType.isText(endContainer) && endOffset > 0 && endOffset < endContainer.nodeValue.length) {\r\n                    endContainer = splitText(endContainer, endOffset).previousSibling;\r\n                    endOffset = endContainer.nodeValue.length;\r\n                }\r\n            }\r\n            return {\r\n                startContainer: startContainer,\r\n                startOffset: startOffset,\r\n                endContainer: endContainer,\r\n                endOffset: endOffset\r\n            };\r\n        };\r\n        var isCollapsibleWhitespace = function (c) {\r\n            return ' \\f\\n\\r\\t\\x0B'.indexOf(c) !== -1;\r\n        };\r\n        var normalizeContent = function (content, isStartOfContent, isEndOfContent) {\r\n            var result = foldl(content.split(''), function (acc, c) {\r\n                if (isCollapsibleWhitespace(c) || c === '\\xA0') {\r\n                    if (acc.previousCharIsSpace || acc.str === '' && isStartOfContent || acc.str.length === content.length - 1 && isEndOfContent) {\r\n                        return {\r\n                            previousCharIsSpace: false,\r\n                            str: acc.str + '\\xA0'\r\n                        };\r\n                    }\r\n                    else {\r\n                        return {\r\n                            previousCharIsSpace: true,\r\n                            str: acc.str + ' '\r\n                        };\r\n                    }\r\n                }\r\n                else {\r\n                    return {\r\n                        previousCharIsSpace: false,\r\n                        str: acc.str + c\r\n                    };\r\n                }\r\n            }, {\r\n                previousCharIsSpace: false,\r\n                str: ''\r\n            });\r\n            return result.str;\r\n        };\r\n        var normalize = function (node, offset, count) {\r\n            if (count === 0) {\r\n                return;\r\n            }\r\n            var whitespace = node.data.slice(offset, offset + count);\r\n            var isEndOfContent = offset + count >= node.data.length;\r\n            var isStartOfContent = offset === 0;\r\n            node.replaceData(offset, count, normalizeContent(whitespace, isStartOfContent, isEndOfContent));\r\n        };\r\n        var normalizeWhitespaceAfter = function (node, offset) {\r\n            var content = node.data.slice(offset);\r\n            var whitespaceCount = content.length - lTrim(content).length;\r\n            return normalize(node, offset, whitespaceCount);\r\n        };\r\n        var normalizeWhitespaceBefore = function (node, offset) {\r\n            var content = node.data.slice(0, offset);\r\n            var whitespaceCount = content.length - rTrim(content).length;\r\n            return normalize(node, offset - whitespaceCount, whitespaceCount);\r\n        };\r\n        var mergeTextNodes = function (prevNode, nextNode, normalizeWhitespace) {\r\n            var whitespaceOffset = rTrim(prevNode.data).length;\r\n            prevNode.appendData(nextNode.data);\r\n            remove$1(Element.fromDom(nextNode));\r\n            if (normalizeWhitespace) {\r\n                normalizeWhitespaceAfter(prevNode, whitespaceOffset);\r\n            }\r\n            return prevNode;\r\n        };\r\n        var ancestor$2 = function (scope, selector, isRoot) {\r\n            return ancestor$1(scope, selector, isRoot).isSome();\r\n        };\r\n        var hasWhitespacePreserveParent = function (rootNode, node) {\r\n            var rootElement = Element.fromDom(rootNode);\r\n            var startNode = Element.fromDom(node);\r\n            return ancestor$2(startNode, 'pre,code', curry(eq, rootElement));\r\n        };\r\n        var isWhitespace = function (rootNode, node) {\r\n            return NodeType.isText(node) && /^[ \\t\\r\\n]*$/.test(node.data) && hasWhitespacePreserveParent(rootNode, node) === false;\r\n        };\r\n        var isNamedAnchor = function (node) {\r\n            return NodeType.isElement(node) && node.nodeName === 'A' && node.hasAttribute('name');\r\n        };\r\n        var isContent$1 = function (rootNode, node) {\r\n            return isCaretCandidate(node) && isWhitespace(rootNode, node) === false || isNamedAnchor(node) || isBookmark(node);\r\n        };\r\n        var isBookmark = NodeType.hasAttribute('data-mce-bookmark');\r\n        var isBogus$2 = NodeType.hasAttribute('data-mce-bogus');\r\n        var isBogusAll$1 = NodeType.hasAttributeValue('data-mce-bogus', 'all');\r\n        var isEmptyNode = function (targetNode) {\r\n            var node, brCount = 0;\r\n            if (isContent$1(targetNode, targetNode)) {\r\n                return false;\r\n            }\r\n            else {\r\n                node = targetNode.firstChild;\r\n                if (!node) {\r\n                    return true;\r\n                }\r\n                var walker = new TreeWalker(node, targetNode);\r\n                do {\r\n                    if (isBogusAll$1(node)) {\r\n                        node = walker.next(true);\r\n                        continue;\r\n                    }\r\n                    if (isBogus$2(node)) {\r\n                        node = walker.next();\r\n                        continue;\r\n                    }\r\n                    if (NodeType.isBr(node)) {\r\n                        brCount++;\r\n                        node = walker.next();\r\n                        continue;\r\n                    }\r\n                    if (isContent$1(targetNode, node)) {\r\n                        return false;\r\n                    }\r\n                    node = walker.next();\r\n                } while (node);\r\n                return brCount <= 1;\r\n            }\r\n        };\r\n        var isEmpty$1 = function (elm) {\r\n            return isEmptyNode(elm.dom());\r\n        };\r\n        var Empty = { isEmpty: isEmpty$1 };\r\n        var needsReposition = function (pos, elm) {\r\n            var container = pos.container();\r\n            var offset = pos.offset();\r\n            return CaretPosition$1.isTextPosition(pos) === false && container === elm.parentNode && offset > CaretPosition$1.before(elm).offset();\r\n        };\r\n        var reposition = function (elm, pos) {\r\n            return needsReposition(pos, elm) ? CaretPosition$1(pos.container(), pos.offset() - 1) : pos;\r\n        };\r\n        var beforeOrStartOf = function (node) {\r\n            return NodeType.isText(node) ? CaretPosition$1(node, 0) : CaretPosition$1.before(node);\r\n        };\r\n        var afterOrEndOf = function (node) {\r\n            return NodeType.isText(node) ? CaretPosition$1(node, node.data.length) : CaretPosition$1.after(node);\r\n        };\r\n        var getPreviousSiblingCaretPosition = function (elm) {\r\n            if (isCaretCandidate(elm.previousSibling)) {\r\n                return Option.some(afterOrEndOf(elm.previousSibling));\r\n            }\r\n            else {\r\n                return elm.previousSibling ? CaretFinder.lastPositionIn(elm.previousSibling) : Option.none();\r\n            }\r\n        };\r\n        var getNextSiblingCaretPosition = function (elm) {\r\n            if (isCaretCandidate(elm.nextSibling)) {\r\n                return Option.some(beforeOrStartOf(elm.nextSibling));\r\n            }\r\n            else {\r\n                return elm.nextSibling ? CaretFinder.firstPositionIn(elm.nextSibling) : Option.none();\r\n            }\r\n        };\r\n        var findCaretPositionBackwardsFromElm = function (rootElement, elm) {\r\n            var startPosition = CaretPosition$1.before(elm.previousSibling ? elm.previousSibling : elm.parentNode);\r\n            return CaretFinder.prevPosition(rootElement, startPosition).fold(function () {\r\n                return CaretFinder.nextPosition(rootElement, CaretPosition$1.after(elm));\r\n            }, Option.some);\r\n        };\r\n        var findCaretPositionForwardsFromElm = function (rootElement, elm) {\r\n            return CaretFinder.nextPosition(rootElement, CaretPosition$1.after(elm)).fold(function () {\r\n                return CaretFinder.prevPosition(rootElement, CaretPosition$1.before(elm));\r\n            }, Option.some);\r\n        };\r\n        var findCaretPositionBackwards = function (rootElement, elm) {\r\n            return getPreviousSiblingCaretPosition(elm).orThunk(function () {\r\n                return getNextSiblingCaretPosition(elm);\r\n            }).orThunk(function () {\r\n                return findCaretPositionBackwardsFromElm(rootElement, elm);\r\n            });\r\n        };\r\n        var findCaretPositionForward = function (rootElement, elm) {\r\n            return getNextSiblingCaretPosition(elm).orThunk(function () {\r\n                return getPreviousSiblingCaretPosition(elm);\r\n            }).orThunk(function () {\r\n                return findCaretPositionForwardsFromElm(rootElement, elm);\r\n            });\r\n        };\r\n        var findCaretPosition$1 = function (forward, rootElement, elm) {\r\n            return forward ? findCaretPositionForward(rootElement, elm) : findCaretPositionBackwards(rootElement, elm);\r\n        };\r\n        var findCaretPosOutsideElmAfterDelete = function (forward, rootElement, elm) {\r\n            return findCaretPosition$1(forward, rootElement, elm).map(curry(reposition, elm));\r\n        };\r\n        var setSelection = function (editor, forward, pos) {\r\n            pos.fold(function () {\r\n                editor.focus();\r\n            }, function (pos) {\r\n                editor.selection.setRng(pos.toRange(), forward);\r\n            });\r\n        };\r\n        var eqRawNode = function (rawNode) {\r\n            return function (elm) {\r\n                return elm.dom() === rawNode;\r\n            };\r\n        };\r\n        var isBlock$2 = function (editor, elm) {\r\n            return elm && editor.schema.getBlockElements().hasOwnProperty(name(elm));\r\n        };\r\n        var paddEmptyBlock = function (elm) {\r\n            if (Empty.isEmpty(elm)) {\r\n                var br = Element.fromHtml('<br data-mce-bogus=\"1\">');\r\n                empty(elm);\r\n                append(elm, br);\r\n                return Option.some(CaretPosition$1.before(br.dom()));\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var deleteNormalized = function (elm, afterDeletePosOpt, normalizeWhitespace) {\r\n            var prevTextOpt = prevSibling(elm).filter(function (e) {\r\n                return NodeType.isText(e.dom());\r\n            });\r\n            var nextTextOpt = nextSibling(elm).filter(function (e) {\r\n                return NodeType.isText(e.dom());\r\n            });\r\n            remove$1(elm);\r\n            return liftN([\r\n                prevTextOpt,\r\n                nextTextOpt,\r\n                afterDeletePosOpt\r\n            ], function (prev, next, pos) {\r\n                var prevNode = prev.dom(), nextNode = next.dom();\r\n                var offset = prevNode.data.length;\r\n                mergeTextNodes(prevNode, nextNode, normalizeWhitespace);\r\n                return pos.container() === nextNode ? CaretPosition$1(prevNode, offset) : pos;\r\n            }).orThunk(function () {\r\n                if (normalizeWhitespace) {\r\n                    prevTextOpt.each(function (elm) {\r\n                        return normalizeWhitespaceBefore(elm.dom(), elm.dom().length);\r\n                    });\r\n                    nextTextOpt.each(function (elm) {\r\n                        return normalizeWhitespaceAfter(elm.dom(), 0);\r\n                    });\r\n                }\r\n                return afterDeletePosOpt;\r\n            });\r\n        };\r\n        var isInlineElement = function (editor, element) {\r\n            return has(editor.schema.getTextInlineElements(), name(element));\r\n        };\r\n        var deleteElement = function (editor, forward, elm, moveCaret) {\r\n            if (moveCaret === void 0) {\r\n                moveCaret = true;\r\n            }\r\n            var afterDeletePos = findCaretPosOutsideElmAfterDelete(forward, editor.getBody(), elm.dom());\r\n            var parentBlock = ancestor(elm, curry(isBlock$2, editor), eqRawNode(editor.getBody()));\r\n            var normalizedAfterDeletePos = deleteNormalized(elm, afterDeletePos, isInlineElement(editor, elm));\r\n            if (editor.dom.isEmpty(editor.getBody())) {\r\n                editor.setContent('');\r\n                editor.selection.setCursorLocation();\r\n            }\r\n            else {\r\n                parentBlock.bind(paddEmptyBlock).fold(function () {\r\n                    if (moveCaret) {\r\n                        setSelection(editor, forward, normalizedAfterDeletePos);\r\n                    }\r\n                }, function (paddPos) {\r\n                    if (moveCaret) {\r\n                        setSelection(editor, forward, Option.some(paddPos));\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        var DeleteElement = { deleteElement: deleteElement };\r\n        var ZWSP$1 = Zwsp.ZWSP, CARET_ID$1 = '_mce_caret';\r\n        var importNode = function (ownerDocument, node) {\r\n            return ownerDocument.importNode(node, true);\r\n        };\r\n        var getEmptyCaretContainers = function (node) {\r\n            var nodes = [];\r\n            while (node) {\r\n                if (node.nodeType === 3 && node.nodeValue !== ZWSP$1 || node.childNodes.length > 1) {\r\n                    return [];\r\n                }\r\n                if (node.nodeType === 1) {\r\n                    nodes.push(node);\r\n                }\r\n                node = node.firstChild;\r\n            }\r\n            return nodes;\r\n        };\r\n        var isCaretContainerEmpty = function (node) {\r\n            return getEmptyCaretContainers(node).length > 0;\r\n        };\r\n        var findFirstTextNode = function (node) {\r\n            if (node) {\r\n                var walker = new TreeWalker(node, node);\r\n                for (node = walker.current(); node; node = walker.next()) {\r\n                    if (node.nodeType === 3) {\r\n                        return node;\r\n                    }\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        var createCaretContainer = function (fill) {\r\n            var caretContainer = Element.fromTag('span');\r\n            setAll(caretContainer, {\r\n                'id': CARET_ID$1,\r\n                'data-mce-bogus': '1',\r\n                'data-mce-type': 'format-caret'\r\n            });\r\n            if (fill) {\r\n                append(caretContainer, Element.fromText(ZWSP$1));\r\n            }\r\n            return caretContainer;\r\n        };\r\n        var trimZwspFromCaretContainer = function (caretContainerNode) {\r\n            var textNode = findFirstTextNode(caretContainerNode);\r\n            if (textNode && textNode.nodeValue.charAt(0) === ZWSP$1) {\r\n                textNode.deleteData(0, 1);\r\n            }\r\n            return textNode;\r\n        };\r\n        var removeCaretContainerNode = function (editor, node, moveCaret) {\r\n            if (moveCaret === void 0) {\r\n                moveCaret = true;\r\n            }\r\n            var dom = editor.dom, selection = editor.selection;\r\n            if (isCaretContainerEmpty(node)) {\r\n                DeleteElement.deleteElement(editor, false, Element.fromDom(node), moveCaret);\r\n            }\r\n            else {\r\n                var rng = selection.getRng();\r\n                var block = dom.getParent(node, dom.isBlock);\r\n                var textNode = trimZwspFromCaretContainer(node);\r\n                if (rng.startContainer === textNode && rng.startOffset > 0) {\r\n                    rng.setStart(textNode, rng.startOffset - 1);\r\n                }\r\n                if (rng.endContainer === textNode && rng.endOffset > 0) {\r\n                    rng.setEnd(textNode, rng.endOffset - 1);\r\n                }\r\n                dom.remove(node, true);\r\n                if (block && dom.isEmpty(block)) {\r\n                    PaddingBr.fillWithPaddingBr(Element.fromDom(block));\r\n                }\r\n                selection.setRng(rng);\r\n            }\r\n        };\r\n        var removeCaretContainer = function (editor, node, moveCaret) {\r\n            if (moveCaret === void 0) {\r\n                moveCaret = true;\r\n            }\r\n            var dom = editor.dom, selection = editor.selection;\r\n            if (!node) {\r\n                node = getParentCaretContainer(editor.getBody(), selection.getStart());\r\n                if (!node) {\r\n                    while (node = dom.get(CARET_ID$1)) {\r\n                        removeCaretContainerNode(editor, node, false);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                removeCaretContainerNode(editor, node, moveCaret);\r\n            }\r\n        };\r\n        var insertCaretContainerNode = function (editor, caretContainer, formatNode) {\r\n            var dom = editor.dom, block = dom.getParent(formatNode, curry(FormatUtils.isTextBlock, editor));\r\n            if (block && dom.isEmpty(block)) {\r\n                formatNode.parentNode.replaceChild(caretContainer, formatNode);\r\n            }\r\n            else {\r\n                PaddingBr.removeTrailingBr(Element.fromDom(formatNode));\r\n                if (dom.isEmpty(formatNode)) {\r\n                    formatNode.parentNode.replaceChild(caretContainer, formatNode);\r\n                }\r\n                else {\r\n                    dom.insertAfter(caretContainer, formatNode);\r\n                }\r\n            }\r\n        };\r\n        var appendNode = function (parentNode, node) {\r\n            parentNode.appendChild(node);\r\n            return node;\r\n        };\r\n        var insertFormatNodesIntoCaretContainer = function (formatNodes, caretContainer) {\r\n            var innerMostFormatNode = foldr(formatNodes, function (parentNode, formatNode) {\r\n                return appendNode(parentNode, formatNode.cloneNode(false));\r\n            }, caretContainer);\r\n            return appendNode(innerMostFormatNode, innerMostFormatNode.ownerDocument.createTextNode(ZWSP$1));\r\n        };\r\n        var applyCaretFormat = function (editor, name, vars) {\r\n            var rng, caretContainer, textNode, offset, bookmark, container, text;\r\n            var selection = editor.selection;\r\n            rng = selection.getRng();\r\n            offset = rng.startOffset;\r\n            container = rng.startContainer;\r\n            text = container.nodeValue;\r\n            caretContainer = getParentCaretContainer(editor.getBody(), selection.getStart());\r\n            if (caretContainer) {\r\n                textNode = findFirstTextNode(caretContainer);\r\n            }\r\n            var wordcharRegex = /[^\\s\\u00a0\\u00ad\\u200b\\ufeff]/;\r\n            if (text && offset > 0 && offset < text.length && wordcharRegex.test(text.charAt(offset)) && wordcharRegex.test(text.charAt(offset - 1))) {\r\n                bookmark = selection.getBookmark();\r\n                rng.collapse(true);\r\n                rng = ExpandRange.expandRng(editor, rng, editor.formatter.get(name));\r\n                rng = split$1(rng);\r\n                editor.formatter.apply(name, vars, rng);\r\n                selection.moveToBookmark(bookmark);\r\n            }\r\n            else {\r\n                if (!caretContainer || textNode.nodeValue !== ZWSP$1) {\r\n                    caretContainer = importNode(editor.getDoc(), createCaretContainer(true).dom());\r\n                    textNode = caretContainer.firstChild;\r\n                    rng.insertNode(caretContainer);\r\n                    offset = 1;\r\n                    editor.formatter.apply(name, vars, caretContainer);\r\n                }\r\n                else {\r\n                    editor.formatter.apply(name, vars, caretContainer);\r\n                }\r\n                selection.setCursorLocation(textNode, offset);\r\n            }\r\n        };\r\n        var removeCaretFormat = function (editor, name, vars, similar) {\r\n            var dom = editor.dom, selection = editor.selection;\r\n            var container, offset, bookmark;\r\n            var hasContentAfter, node, formatNode;\r\n            var parents = [], rng = selection.getRng();\r\n            var caretContainer;\r\n            container = rng.startContainer;\r\n            offset = rng.startOffset;\r\n            node = container;\r\n            if (container.nodeType === 3) {\r\n                if (offset !== container.nodeValue.length) {\r\n                    hasContentAfter = true;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            while (node) {\r\n                if (MatchFormat.matchNode(editor, node, name, vars, similar)) {\r\n                    formatNode = node;\r\n                    break;\r\n                }\r\n                if (node.nextSibling) {\r\n                    hasContentAfter = true;\r\n                }\r\n                parents.push(node);\r\n                node = node.parentNode;\r\n            }\r\n            if (!formatNode) {\r\n                return;\r\n            }\r\n            if (hasContentAfter) {\r\n                bookmark = selection.getBookmark();\r\n                rng.collapse(true);\r\n                var expandedRng = ExpandRange.expandRng(editor, rng, editor.formatter.get(name), true);\r\n                expandedRng = split$1(expandedRng);\r\n                editor.formatter.remove(name, vars, expandedRng);\r\n                selection.moveToBookmark(bookmark);\r\n            }\r\n            else {\r\n                caretContainer = getParentCaretContainer(editor.getBody(), formatNode);\r\n                var newCaretContainer = createCaretContainer(false).dom();\r\n                var caretNode = insertFormatNodesIntoCaretContainer(parents, newCaretContainer);\r\n                if (caretContainer) {\r\n                    insertCaretContainerNode(editor, newCaretContainer, caretContainer);\r\n                }\r\n                else {\r\n                    insertCaretContainerNode(editor, newCaretContainer, formatNode);\r\n                }\r\n                removeCaretContainerNode(editor, caretContainer, false);\r\n                selection.setCursorLocation(caretNode, 1);\r\n                if (dom.isEmpty(formatNode)) {\r\n                    dom.remove(formatNode);\r\n                }\r\n            }\r\n        };\r\n        var disableCaretContainer = function (editor, keyCode) {\r\n            var selection = editor.selection, body = editor.getBody();\r\n            removeCaretContainer(editor, null, false);\r\n            if ((keyCode === 8 || keyCode === 46) && selection.isCollapsed() && selection.getStart().innerHTML === ZWSP$1) {\r\n                removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\r\n            }\r\n            if (keyCode === 37 || keyCode === 39) {\r\n                removeCaretContainer(editor, getParentCaretContainer(body, selection.getStart()));\r\n            }\r\n        };\r\n        var setup$4 = function (editor) {\r\n            editor.on('mouseup keydown', function (e) {\r\n                disableCaretContainer(editor, e.keyCode);\r\n            });\r\n        };\r\n        var replaceWithCaretFormat = function (targetNode, formatNodes) {\r\n            var caretContainer = createCaretContainer(false);\r\n            var innerMost = insertFormatNodesIntoCaretContainer(formatNodes, caretContainer.dom());\r\n            before(Element.fromDom(targetNode), caretContainer);\r\n            remove$1(Element.fromDom(targetNode));\r\n            return CaretPosition$1(innerMost, 0);\r\n        };\r\n        var isFormatElement = function (editor, element) {\r\n            var inlineElements = editor.schema.getTextInlineElements();\r\n            return inlineElements.hasOwnProperty(name(element)) && !isCaretNode(element.dom()) && !NodeType.isBogus(element.dom());\r\n        };\r\n        var isEmptyCaretFormatElement = function (element) {\r\n            return isCaretNode(element.dom()) && isCaretContainerEmpty(element.dom());\r\n        };\r\n        var postProcessHooks = {}, filter$3 = ArrUtils.filter, each$9 = ArrUtils.each;\r\n        var addPostProcessHook = function (name, hook) {\r\n            var hooks = postProcessHooks[name];\r\n            if (!hooks) {\r\n                postProcessHooks[name] = hooks = [];\r\n            }\r\n            postProcessHooks[name].push(hook);\r\n        };\r\n        var postProcess = function (name, editor) {\r\n            each$9(postProcessHooks[name], function (hook) {\r\n                hook(editor);\r\n            });\r\n        };\r\n        addPostProcessHook('pre', function (editor) {\r\n            var rng = editor.selection.getRng();\r\n            var isPre, blocks;\r\n            var hasPreSibling = function (pre) {\r\n                return isPre(pre.previousSibling) && ArrUtils.indexOf(blocks, pre.previousSibling) !== -1;\r\n            };\r\n            var joinPre = function (pre1, pre2) {\r\n                DomQuery(pre2).remove();\r\n                DomQuery(pre1).append('<br><br>').append(pre2.childNodes);\r\n            };\r\n            isPre = NodeType.matchNodeNames('pre');\r\n            if (!rng.collapsed) {\r\n                blocks = editor.selection.getSelectedBlocks();\r\n                each$9(filter$3(filter$3(blocks, isPre), hasPreSibling), function (pre) {\r\n                    joinPre(pre.previousSibling, pre);\r\n                });\r\n            }\r\n        });\r\n        var Hooks = { postProcess: postProcess };\r\n        var each$a = Tools.each;\r\n        var ElementUtils = function (dom) {\r\n            this.compare = function (node1, node2) {\r\n                if (node1.nodeName !== node2.nodeName) {\r\n                    return false;\r\n                }\r\n                var getAttribs = function (node) {\r\n                    var attribs = {};\r\n                    each$a(dom.getAttribs(node), function (attr) {\r\n                        var name = attr.nodeName.toLowerCase();\r\n                        if (name.indexOf('_') !== 0 && name !== 'style' && name.indexOf('data-') !== 0) {\r\n                            attribs[name] = dom.getAttrib(node, name);\r\n                        }\r\n                    });\r\n                    return attribs;\r\n                };\r\n                var compareObjects = function (obj1, obj2) {\r\n                    var value, name;\r\n                    for (name in obj1) {\r\n                        if (obj1.hasOwnProperty(name)) {\r\n                            value = obj2[name];\r\n                            if (typeof value === 'undefined') {\r\n                                return false;\r\n                            }\r\n                            if (obj1[name] !== value) {\r\n                                return false;\r\n                            }\r\n                            delete obj2[name];\r\n                        }\r\n                    }\r\n                    for (name in obj2) {\r\n                        if (obj2.hasOwnProperty(name)) {\r\n                            return false;\r\n                        }\r\n                    }\r\n                    return true;\r\n                };\r\n                if (!compareObjects(getAttribs(node1), getAttribs(node2))) {\r\n                    return false;\r\n                }\r\n                if (!compareObjects(dom.parseStyle(dom.getAttrib(node1, 'style')), dom.parseStyle(dom.getAttrib(node2, 'style')))) {\r\n                    return false;\r\n                }\r\n                return !Bookmarks.isBookmarkNode(node1) && !Bookmarks.isBookmarkNode(node2);\r\n            };\r\n        };\r\n        var MCE_ATTR_RE = /^(src|href|style)$/;\r\n        var each$b = Tools.each;\r\n        var isEq$4 = FormatUtils.isEq;\r\n        var isTableCell$2 = function (node) {\r\n            return /^(TH|TD)$/.test(node.nodeName);\r\n        };\r\n        var isChildOfInlineParent = function (dom, node, parent) {\r\n            return dom.isChildOf(node, parent) && node !== parent && !dom.isBlock(parent);\r\n        };\r\n        var getContainer = function (ed, rng, start) {\r\n            var container, offset, lastIdx;\r\n            container = rng[start ? 'startContainer' : 'endContainer'];\r\n            offset = rng[start ? 'startOffset' : 'endOffset'];\r\n            if (NodeType.isElement(container)) {\r\n                lastIdx = container.childNodes.length - 1;\r\n                if (!start && offset) {\r\n                    offset--;\r\n                }\r\n                container = container.childNodes[offset > lastIdx ? lastIdx : offset];\r\n            }\r\n            if (NodeType.isText(container) && start && offset >= container.nodeValue.length) {\r\n                container = new TreeWalker(container, ed.getBody()).next() || container;\r\n            }\r\n            if (NodeType.isText(container) && !start && offset === 0) {\r\n                container = new TreeWalker(container, ed.getBody()).prev() || container;\r\n            }\r\n            return container;\r\n        };\r\n        var wrap$2 = function (dom, node, name, attrs) {\r\n            var wrapper = dom.create(name, attrs);\r\n            node.parentNode.insertBefore(wrapper, node);\r\n            wrapper.appendChild(node);\r\n            return wrapper;\r\n        };\r\n        var wrapWithSiblings = function (dom, node, next, name, attrs) {\r\n            var start = Element.fromDom(node);\r\n            var wrapper = Element.fromDom(dom.create(name, attrs));\r\n            var siblings = next ? nextSiblings(start) : prevSiblings(start);\r\n            append$1(wrapper, siblings);\r\n            if (next) {\r\n                before(start, wrapper);\r\n                prepend(wrapper, start);\r\n            }\r\n            else {\r\n                after(start, wrapper);\r\n                append(wrapper, start);\r\n            }\r\n            return wrapper.dom();\r\n        };\r\n        var matchName$1 = function (dom, node, format) {\r\n            if (isEq$4(node, format.inline)) {\r\n                return true;\r\n            }\r\n            if (isEq$4(node, format.block)) {\r\n                return true;\r\n            }\r\n            if (format.selector) {\r\n                return NodeType.isElement(node) && dom.is(node, format.selector);\r\n            }\r\n        };\r\n        var isColorFormatAndAnchor = function (node, format) {\r\n            return format.links && node.tagName === 'A';\r\n        };\r\n        var find$3 = function (dom, node, next, inc) {\r\n            node = FormatUtils.getNonWhiteSpaceSibling(node, next, inc);\r\n            return !node || (node.nodeName === 'BR' || dom.isBlock(node));\r\n        };\r\n        var removeNode$1 = function (ed, node, format) {\r\n            var parentNode = node.parentNode;\r\n            var rootBlockElm;\r\n            var dom = ed.dom, forcedRootBlock = Settings.getForcedRootBlock(ed);\r\n            if (format.block) {\r\n                if (!forcedRootBlock) {\r\n                    if (dom.isBlock(node) && !dom.isBlock(parentNode)) {\r\n                        if (!find$3(dom, node, false) && !find$3(dom, node.firstChild, true, 1)) {\r\n                            node.insertBefore(dom.create('br'), node.firstChild);\r\n                        }\r\n                        if (!find$3(dom, node, true) && !find$3(dom, node.lastChild, false, 1)) {\r\n                            node.appendChild(dom.create('br'));\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    if (parentNode === dom.getRoot()) {\r\n                        if (!format.list_block || !isEq$4(node, format.list_block)) {\r\n                            each$b(Tools.grep(node.childNodes), function (node) {\r\n                                if (FormatUtils.isValid(ed, forcedRootBlock, node.nodeName.toLowerCase())) {\r\n                                    if (!rootBlockElm) {\r\n                                        rootBlockElm = wrap$2(dom, node, forcedRootBlock);\r\n                                        dom.setAttribs(rootBlockElm, ed.settings.forced_root_block_attrs);\r\n                                    }\r\n                                    else {\r\n                                        rootBlockElm.appendChild(node);\r\n                                    }\r\n                                }\r\n                                else {\r\n                                    rootBlockElm = 0;\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n            if (format.selector && format.inline && !isEq$4(format.inline, node)) {\r\n                return;\r\n            }\r\n            dom.remove(node, 1);\r\n        };\r\n        var removeFormat = function (ed, format, vars, node, compareNode) {\r\n            var i, attrs, stylesModified;\r\n            var dom = ed.dom;\r\n            if (!matchName$1(dom, node, format) && !isColorFormatAndAnchor(node, format)) {\r\n                return false;\r\n            }\r\n            if (format.remove !== 'all') {\r\n                each$b(format.styles, function (value, name) {\r\n                    value = FormatUtils.normalizeStyleValue(dom, FormatUtils.replaceVars(value, vars), name);\r\n                    if (typeof name === 'number') {\r\n                        name = value;\r\n                        compareNode = 0;\r\n                    }\r\n                    if (format.remove_similar || (!compareNode || isEq$4(FormatUtils.getStyle(dom, compareNode, name), value))) {\r\n                        dom.setStyle(node, name, '');\r\n                    }\r\n                    stylesModified = 1;\r\n                });\r\n                if (stylesModified && dom.getAttrib(node, 'style') === '') {\r\n                    node.removeAttribute('style');\r\n                    node.removeAttribute('data-mce-style');\r\n                }\r\n                each$b(format.attributes, function (value, name) {\r\n                    var valueOut;\r\n                    value = FormatUtils.replaceVars(value, vars);\r\n                    if (typeof name === 'number') {\r\n                        name = value;\r\n                        compareNode = 0;\r\n                    }\r\n                    if (!compareNode || isEq$4(dom.getAttrib(compareNode, name), value)) {\r\n                        if (name === 'class') {\r\n                            value = dom.getAttrib(node, name);\r\n                            if (value) {\r\n                                valueOut = '';\r\n                                each$b(value.split(/\\s+/), function (cls) {\r\n                                    if (/mce\\-\\w+/.test(cls)) {\r\n                                        valueOut += (valueOut ? ' ' : '') + cls;\r\n                                    }\r\n                                });\r\n                                if (valueOut) {\r\n                                    dom.setAttrib(node, name, valueOut);\r\n                                    return;\r\n                                }\r\n                            }\r\n                        }\r\n                        if (name === 'class') {\r\n                            node.removeAttribute('className');\r\n                        }\r\n                        if (MCE_ATTR_RE.test(name)) {\r\n                            node.removeAttribute('data-mce-' + name);\r\n                        }\r\n                        node.removeAttribute(name);\r\n                    }\r\n                });\r\n                each$b(format.classes, function (value) {\r\n                    value = FormatUtils.replaceVars(value, vars);\r\n                    if (!compareNode || dom.hasClass(compareNode, value)) {\r\n                        dom.removeClass(node, value);\r\n                    }\r\n                });\r\n                attrs = dom.getAttribs(node);\r\n                for (i = 0; i < attrs.length; i++) {\r\n                    var attrName = attrs[i].nodeName;\r\n                    if (attrName.indexOf('_') !== 0 && attrName.indexOf('data-') !== 0) {\r\n                        return false;\r\n                    }\r\n                }\r\n            }\r\n            if (format.remove !== 'none') {\r\n                removeNode$1(ed, node, format);\r\n                return true;\r\n            }\r\n        };\r\n        var findFormatRoot = function (editor, container, name, vars, similar) {\r\n            var formatRoot;\r\n            each$b(FormatUtils.getParents(editor.dom, container.parentNode).reverse(), function (parent) {\r\n                var format;\r\n                if (!formatRoot && parent.id !== '_start' && parent.id !== '_end') {\r\n                    format = MatchFormat.matchNode(editor, parent, name, vars, similar);\r\n                    if (format && format.split !== false) {\r\n                        formatRoot = parent;\r\n                    }\r\n                }\r\n            });\r\n            return formatRoot;\r\n        };\r\n        var wrapAndSplit = function (editor, formatList, formatRoot, container, target, split, format, vars) {\r\n            var parent, clone, lastClone, firstClone, i, formatRootParent;\r\n            var dom = editor.dom;\r\n            if (formatRoot) {\r\n                formatRootParent = formatRoot.parentNode;\r\n                for (parent = container.parentNode; parent && parent !== formatRootParent; parent = parent.parentNode) {\r\n                    clone = dom.clone(parent, false);\r\n                    for (i = 0; i < formatList.length; i++) {\r\n                        if (removeFormat(editor, formatList[i], vars, clone, clone)) {\r\n                            clone = 0;\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (clone) {\r\n                        if (lastClone) {\r\n                            clone.appendChild(lastClone);\r\n                        }\r\n                        if (!firstClone) {\r\n                            firstClone = clone;\r\n                        }\r\n                        lastClone = clone;\r\n                    }\r\n                }\r\n                if (split && (!format.mixed || !dom.isBlock(formatRoot))) {\r\n                    container = dom.split(formatRoot, container);\r\n                }\r\n                if (lastClone) {\r\n                    target.parentNode.insertBefore(lastClone, target);\r\n                    firstClone.appendChild(target);\r\n                }\r\n            }\r\n            return container;\r\n        };\r\n        var remove$7 = function (ed, name, vars, node, similar) {\r\n            var formatList = ed.formatter.get(name), format = formatList[0];\r\n            var bookmark, rng, contentEditable = true;\r\n            var dom = ed.dom;\r\n            var selection = ed.selection;\r\n            var splitToFormatRoot = function (container) {\r\n                var formatRoot = findFormatRoot(ed, container, name, vars, similar);\r\n                return wrapAndSplit(ed, formatList, formatRoot, container, container, true, format, vars);\r\n            };\r\n            var isRemoveBookmarkNode = function (node) {\r\n                return Bookmarks.isBookmarkNode(node) && NodeType.isElement(node) && (node.id === '_start' || node.id === '_end');\r\n            };\r\n            var process = function (node) {\r\n                var children, i, l, lastContentEditable, hasContentEditableState;\r\n                if (NodeType.isElement(node) && dom.getContentEditable(node)) {\r\n                    lastContentEditable = contentEditable;\r\n                    contentEditable = dom.getContentEditable(node) === 'true';\r\n                    hasContentEditableState = true;\r\n                }\r\n                children = Tools.grep(node.childNodes);\r\n                if (contentEditable && !hasContentEditableState) {\r\n                    for (i = 0, l = formatList.length; i < l; i++) {\r\n                        if (removeFormat(ed, formatList[i], vars, node, node)) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (format.deep) {\r\n                    if (children.length) {\r\n                        for (i = 0, l = children.length; i < l; i++) {\r\n                            process(children[i]);\r\n                        }\r\n                        if (hasContentEditableState) {\r\n                            contentEditable = lastContentEditable;\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var unwrap = function (start) {\r\n                var node = dom.get(start ? '_start' : '_end');\r\n                var out = node[start ? 'firstChild' : 'lastChild'];\r\n                if (isRemoveBookmarkNode(out)) {\r\n                    out = out[start ? 'firstChild' : 'lastChild'];\r\n                }\r\n                if (NodeType.isText(out) && out.data.length === 0) {\r\n                    out = start ? node.previousSibling || node.nextSibling : node.nextSibling || node.previousSibling;\r\n                }\r\n                dom.remove(node, true);\r\n                return out;\r\n            };\r\n            var removeRngStyle = function (rng) {\r\n                var startContainer, endContainer;\r\n                var commonAncestorContainer = rng.commonAncestorContainer;\r\n                rng = ExpandRange.expandRng(ed, rng, formatList, true);\r\n                if (format.split) {\r\n                    rng = split$1(rng);\r\n                    startContainer = getContainer(ed, rng, true);\r\n                    endContainer = getContainer(ed, rng);\r\n                    if (startContainer !== endContainer) {\r\n                        if (/^(TR|TH|TD)$/.test(startContainer.nodeName) && startContainer.firstChild) {\r\n                            if (startContainer.nodeName === 'TR') {\r\n                                startContainer = startContainer.firstChild.firstChild || startContainer;\r\n                            }\r\n                            else {\r\n                                startContainer = startContainer.firstChild || startContainer;\r\n                            }\r\n                        }\r\n                        if (commonAncestorContainer && /^T(HEAD|BODY|FOOT|R)$/.test(commonAncestorContainer.nodeName) && isTableCell$2(endContainer) && endContainer.firstChild) {\r\n                            endContainer = endContainer.firstChild || endContainer;\r\n                        }\r\n                        if (isChildOfInlineParent(dom, startContainer, endContainer)) {\r\n                            var marker = Option.from(startContainer.firstChild).getOr(startContainer);\r\n                            splitToFormatRoot(wrapWithSiblings(dom, marker, true, 'span', {\r\n                                'id': '_start',\r\n                                'data-mce-type': 'bookmark'\r\n                            }));\r\n                            unwrap(true);\r\n                            return;\r\n                        }\r\n                        if (isChildOfInlineParent(dom, endContainer, startContainer)) {\r\n                            var marker = Option.from(endContainer.lastChild).getOr(endContainer);\r\n                            splitToFormatRoot(wrapWithSiblings(dom, marker, false, 'span', {\r\n                                'id': '_end',\r\n                                'data-mce-type': 'bookmark'\r\n                            }));\r\n                            unwrap(false);\r\n                            return;\r\n                        }\r\n                        startContainer = wrap$2(dom, startContainer, 'span', {\r\n                            'id': '_start',\r\n                            'data-mce-type': 'bookmark'\r\n                        });\r\n                        endContainer = wrap$2(dom, endContainer, 'span', {\r\n                            'id': '_end',\r\n                            'data-mce-type': 'bookmark'\r\n                        });\r\n                        splitToFormatRoot(startContainer);\r\n                        splitToFormatRoot(endContainer);\r\n                        startContainer = unwrap(true);\r\n                        endContainer = unwrap();\r\n                    }\r\n                    else {\r\n                        startContainer = endContainer = splitToFormatRoot(startContainer);\r\n                    }\r\n                    rng.startContainer = startContainer.parentNode ? startContainer.parentNode : startContainer;\r\n                    rng.startOffset = dom.nodeIndex(startContainer);\r\n                    rng.endContainer = endContainer.parentNode ? endContainer.parentNode : endContainer;\r\n                    rng.endOffset = dom.nodeIndex(endContainer) + 1;\r\n                }\r\n                RangeWalk.walk(dom, rng, function (nodes) {\r\n                    each$b(nodes, function (node) {\r\n                        process(node);\r\n                        if (NodeType.isElement(node) && ed.dom.getStyle(node, 'text-decoration') === 'underline' && node.parentNode && FormatUtils.getTextDecoration(dom, node.parentNode) === 'underline') {\r\n                            removeFormat(ed, {\r\n                                deep: false,\r\n                                exact: true,\r\n                                inline: 'span',\r\n                                styles: { textDecoration: 'underline' }\r\n                            }, null, node);\r\n                        }\r\n                    });\r\n                });\r\n            };\r\n            if (node) {\r\n                if (node.nodeType) {\r\n                    rng = dom.createRng();\r\n                    rng.setStartBefore(node);\r\n                    rng.setEndAfter(node);\r\n                    removeRngStyle(rng);\r\n                }\r\n                else {\r\n                    removeRngStyle(node);\r\n                }\r\n                return;\r\n            }\r\n            if (dom.getContentEditable(selection.getNode()) === 'false') {\r\n                node = selection.getNode();\r\n                for (var i = 0, l = formatList.length; i < l; i++) {\r\n                    if (formatList[i].ceFalseOverride) {\r\n                        if (removeFormat(ed, formatList[i], vars, node, node)) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            if (!selection.isCollapsed() || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\r\n                bookmark = GetBookmark.getPersistentBookmark(ed.selection, true);\r\n                removeRngStyle(selection.getRng());\r\n                selection.moveToBookmark(bookmark);\r\n                if (format.inline && MatchFormat.match(ed, name, vars, selection.getStart())) {\r\n                    FormatUtils.moveStart(dom, selection, selection.getRng());\r\n                }\r\n                ed.nodeChanged();\r\n            }\r\n            else {\r\n                removeCaretFormat(ed, name, vars, similar);\r\n            }\r\n        };\r\n        var RemoveFormat = {\r\n            removeFormat: removeFormat,\r\n            remove: remove$7\r\n        };\r\n        var each$c = Tools.each;\r\n        var isElementNode = function (node) {\r\n            return node && node.nodeType === 1 && !Bookmarks.isBookmarkNode(node) && !isCaretNode(node) && !NodeType.isBogus(node);\r\n        };\r\n        var findElementSibling = function (node, siblingName) {\r\n            var sibling;\r\n            for (sibling = node; sibling; sibling = sibling[siblingName]) {\r\n                if (sibling.nodeType === 3 && sibling.nodeValue.length !== 0) {\r\n                    return node;\r\n                }\r\n                if (sibling.nodeType === 1 && !Bookmarks.isBookmarkNode(sibling)) {\r\n                    return sibling;\r\n                }\r\n            }\r\n            return node;\r\n        };\r\n        var mergeSiblingsNodes = function (dom, prev, next) {\r\n            var sibling, tmpSibling;\r\n            var elementUtils = new ElementUtils(dom);\r\n            if (prev && next) {\r\n                prev = findElementSibling(prev, 'previousSibling');\r\n                next = findElementSibling(next, 'nextSibling');\r\n                if (elementUtils.compare(prev, next)) {\r\n                    for (sibling = prev.nextSibling; sibling && sibling !== next;) {\r\n                        tmpSibling = sibling;\r\n                        sibling = sibling.nextSibling;\r\n                        prev.appendChild(tmpSibling);\r\n                    }\r\n                    dom.remove(next);\r\n                    Tools.each(Tools.grep(next.childNodes), function (node) {\r\n                        prev.appendChild(node);\r\n                    });\r\n                    return prev;\r\n                }\r\n            }\r\n            return next;\r\n        };\r\n        var processChildElements = function (node, filter, process) {\r\n            each$c(node.childNodes, function (node) {\r\n                if (isElementNode(node)) {\r\n                    if (filter(node)) {\r\n                        process(node);\r\n                    }\r\n                    if (node.hasChildNodes()) {\r\n                        processChildElements(node, filter, process);\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        var hasStyle = function (dom, name) {\r\n            return curry(function (name, node) {\r\n                return !!(node && FormatUtils.getStyle(dom, node, name));\r\n            }, name);\r\n        };\r\n        var applyStyle = function (dom, name, value) {\r\n            return curry(function (name, value, node) {\r\n                dom.setStyle(node, name, value);\r\n                if (node.getAttribute('style') === '') {\r\n                    node.removeAttribute('style');\r\n                }\r\n                unwrapEmptySpan(dom, node);\r\n            }, name, value);\r\n        };\r\n        var unwrapEmptySpan = function (dom, node) {\r\n            if (node.nodeName === 'SPAN' && dom.getAttribs(node).length === 0) {\r\n                dom.remove(node, true);\r\n            }\r\n        };\r\n        var processUnderlineAndColor = function (dom, node) {\r\n            var textDecoration;\r\n            if (node.nodeType === 1 && node.parentNode && node.parentNode.nodeType === 1) {\r\n                textDecoration = FormatUtils.getTextDecoration(dom, node.parentNode);\r\n                if (dom.getStyle(node, 'color') && textDecoration) {\r\n                    dom.setStyle(node, 'text-decoration', textDecoration);\r\n                }\r\n                else if (dom.getStyle(node, 'text-decoration') === textDecoration) {\r\n                    dom.setStyle(node, 'text-decoration', null);\r\n                }\r\n            }\r\n        };\r\n        var mergeUnderlineAndColor = function (dom, format, vars, node) {\r\n            if (format.styles.color || format.styles.textDecoration) {\r\n                Tools.walk(node, curry(processUnderlineAndColor, dom), 'childNodes');\r\n                processUnderlineAndColor(dom, node);\r\n            }\r\n        };\r\n        var mergeBackgroundColorAndFontSize = function (dom, format, vars, node) {\r\n            if (format.styles && format.styles.backgroundColor) {\r\n                processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'backgroundColor', FormatUtils.replaceVars(format.styles.backgroundColor, vars)));\r\n            }\r\n        };\r\n        var mergeSubSup = function (dom, format, vars, node) {\r\n            if (format.inline === 'sub' || format.inline === 'sup') {\r\n                processChildElements(node, hasStyle(dom, 'fontSize'), applyStyle(dom, 'fontSize', ''));\r\n                dom.remove(dom.select(format.inline === 'sup' ? 'sub' : 'sup', node), true);\r\n            }\r\n        };\r\n        var mergeSiblings = function (dom, format, vars, node) {\r\n            if (node && format.merge_siblings !== false) {\r\n                node = mergeSiblingsNodes(dom, FormatUtils.getNonWhiteSpaceSibling(node), node);\r\n                node = mergeSiblingsNodes(dom, node, FormatUtils.getNonWhiteSpaceSibling(node, true));\r\n            }\r\n        };\r\n        var clearChildStyles = function (dom, format, node) {\r\n            if (format.clear_child_styles) {\r\n                var selector = format.links ? '*:not(a)' : '*';\r\n                each$c(dom.select(selector, node), function (node) {\r\n                    if (isElementNode(node)) {\r\n                        each$c(format.styles, function (value, name) {\r\n                            dom.setStyle(node, name, '');\r\n                        });\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        var mergeWithChildren = function (editor, formatList, vars, node) {\r\n            each$c(formatList, function (format) {\r\n                each$c(editor.dom.select(format.inline, node), function (child) {\r\n                    if (!isElementNode(child)) {\r\n                        return;\r\n                    }\r\n                    RemoveFormat.removeFormat(editor, format, vars, child, format.exact ? child : null);\r\n                });\r\n                clearChildStyles(editor.dom, format, node);\r\n            });\r\n        };\r\n        var mergeWithParents = function (editor, format, name, vars, node) {\r\n            if (MatchFormat.matchNode(editor, node.parentNode, name, vars)) {\r\n                if (RemoveFormat.removeFormat(editor, format, vars, node)) {\r\n                    return;\r\n                }\r\n            }\r\n            if (format.merge_with_parents) {\r\n                editor.dom.getParent(node.parentNode, function (parent) {\r\n                    if (MatchFormat.matchNode(editor, parent, name, vars)) {\r\n                        RemoveFormat.removeFormat(editor, format, vars, node);\r\n                        return true;\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        var MergeFormats = {\r\n            mergeWithChildren: mergeWithChildren,\r\n            mergeUnderlineAndColor: mergeUnderlineAndColor,\r\n            mergeBackgroundColorAndFontSize: mergeBackgroundColorAndFontSize,\r\n            mergeSubSup: mergeSubSup,\r\n            mergeSiblings: mergeSiblings,\r\n            mergeWithParents: mergeWithParents\r\n        };\r\n        var createRange$1 = function (sc, so, ec, eo) {\r\n            var rng = domGlobals.document.createRange();\r\n            rng.setStart(sc, so);\r\n            rng.setEnd(ec, eo);\r\n            return rng;\r\n        };\r\n        var normalizeBlockSelectionRange = function (rng) {\r\n            var startPos = CaretPosition$1.fromRangeStart(rng);\r\n            var endPos = CaretPosition$1.fromRangeEnd(rng);\r\n            var rootNode = rng.commonAncestorContainer;\r\n            return CaretFinder.fromPosition(false, rootNode, endPos).map(function (newEndPos) {\r\n                if (!isInSameBlock(startPos, endPos, rootNode) && isInSameBlock(startPos, newEndPos, rootNode)) {\r\n                    return createRange$1(startPos.container(), startPos.offset(), newEndPos.container(), newEndPos.offset());\r\n                }\r\n                else {\r\n                    return rng;\r\n                }\r\n            }).getOr(rng);\r\n        };\r\n        var normalize$1 = function (rng) {\r\n            return rng.collapsed ? rng : normalizeBlockSelectionRange(rng);\r\n        };\r\n        var RangeNormalizer = { normalize: normalize$1 };\r\n        var each$d = Tools.each;\r\n        var isElementNode$1 = function (node) {\r\n            return node && node.nodeType === 1 && !Bookmarks.isBookmarkNode(node) && !isCaretNode(node) && !NodeType.isBogus(node);\r\n        };\r\n        var applyFormat = function (ed, name, vars, node) {\r\n            var formatList = ed.formatter.get(name);\r\n            var format = formatList[0];\r\n            var bookmark, rng;\r\n            var isCollapsed = !node && ed.selection.isCollapsed();\r\n            var dom = ed.dom, selection = ed.selection;\r\n            var setElementFormat = function (elm, fmt) {\r\n                fmt = fmt || format;\r\n                if (elm) {\r\n                    if (fmt.onformat) {\r\n                        fmt.onformat(elm, fmt, vars, node);\r\n                    }\r\n                    each$d(fmt.styles, function (value, name) {\r\n                        dom.setStyle(elm, name, FormatUtils.replaceVars(value, vars));\r\n                    });\r\n                    if (fmt.styles) {\r\n                        var styleVal = dom.getAttrib(elm, 'style');\r\n                        if (styleVal) {\r\n                            elm.setAttribute('data-mce-style', styleVal);\r\n                        }\r\n                    }\r\n                    each$d(fmt.attributes, function (value, name) {\r\n                        dom.setAttrib(elm, name, FormatUtils.replaceVars(value, vars));\r\n                    });\r\n                    each$d(fmt.classes, function (value) {\r\n                        value = FormatUtils.replaceVars(value, vars);\r\n                        if (!dom.hasClass(elm, value)) {\r\n                            dom.addClass(elm, value);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var applyNodeStyle = function (formatList, node) {\r\n                var found = false;\r\n                if (!format.selector) {\r\n                    return false;\r\n                }\r\n                each$d(formatList, function (format) {\r\n                    if ('collapsed' in format && format.collapsed !== isCollapsed) {\r\n                        return;\r\n                    }\r\n                    if (dom.is(node, format.selector) && !isCaretNode(node)) {\r\n                        setElementFormat(node, format);\r\n                        found = true;\r\n                        return false;\r\n                    }\r\n                });\r\n                return found;\r\n            };\r\n            var applyRngStyle = function (dom, rng, bookmark, nodeSpecific) {\r\n                var newWrappers = [];\r\n                var wrapName, wrapElm, contentEditable = true;\r\n                wrapName = format.inline || format.block;\r\n                wrapElm = dom.create(wrapName);\r\n                setElementFormat(wrapElm);\r\n                RangeWalk.walk(dom, rng, function (nodes) {\r\n                    var currentWrapElm;\r\n                    var process = function (node) {\r\n                        var nodeName, parentName, hasContentEditableState, lastContentEditable;\r\n                        lastContentEditable = contentEditable;\r\n                        nodeName = node.nodeName.toLowerCase();\r\n                        parentName = node.parentNode.nodeName.toLowerCase();\r\n                        if (node.nodeType === 1 && dom.getContentEditable(node)) {\r\n                            lastContentEditable = contentEditable;\r\n                            contentEditable = dom.getContentEditable(node) === 'true';\r\n                            hasContentEditableState = true;\r\n                        }\r\n                        if (FormatUtils.isEq(nodeName, 'br')) {\r\n                            currentWrapElm = 0;\r\n                            if (format.block) {\r\n                                dom.remove(node);\r\n                            }\r\n                            return;\r\n                        }\r\n                        if (format.wrapper && MatchFormat.matchNode(ed, node, name, vars)) {\r\n                            currentWrapElm = 0;\r\n                            return;\r\n                        }\r\n                        if (contentEditable && !hasContentEditableState && format.block && !format.wrapper && FormatUtils.isTextBlock(ed, nodeName) && FormatUtils.isValid(ed, parentName, wrapName)) {\r\n                            node = dom.rename(node, wrapName);\r\n                            setElementFormat(node);\r\n                            newWrappers.push(node);\r\n                            currentWrapElm = 0;\r\n                            return;\r\n                        }\r\n                        if (format.selector) {\r\n                            var found = applyNodeStyle(formatList, node);\r\n                            if (!format.inline || found) {\r\n                                currentWrapElm = 0;\r\n                                return;\r\n                            }\r\n                        }\r\n                        if (contentEditable && !hasContentEditableState && FormatUtils.isValid(ed, wrapName, nodeName) && FormatUtils.isValid(ed, parentName, wrapName) && !(!nodeSpecific && node.nodeType === 3 && node.nodeValue.length === 1 && node.nodeValue.charCodeAt(0) === 65279) && !isCaretNode(node) && (!format.inline || !dom.isBlock(node))) {\r\n                            if (!currentWrapElm) {\r\n                                currentWrapElm = dom.clone(wrapElm, false);\r\n                                node.parentNode.insertBefore(currentWrapElm, node);\r\n                                newWrappers.push(currentWrapElm);\r\n                            }\r\n                            currentWrapElm.appendChild(node);\r\n                        }\r\n                        else {\r\n                            currentWrapElm = 0;\r\n                            each$d(Tools.grep(node.childNodes), process);\r\n                            if (hasContentEditableState) {\r\n                                contentEditable = lastContentEditable;\r\n                            }\r\n                            currentWrapElm = 0;\r\n                        }\r\n                    };\r\n                    each$d(nodes, process);\r\n                });\r\n                if (format.links === true) {\r\n                    each$d(newWrappers, function (node) {\r\n                        var process = function (node) {\r\n                            if (node.nodeName === 'A') {\r\n                                setElementFormat(node, format);\r\n                            }\r\n                            each$d(Tools.grep(node.childNodes), process);\r\n                        };\r\n                        process(node);\r\n                    });\r\n                }\r\n                each$d(newWrappers, function (node) {\r\n                    var childCount;\r\n                    var getChildCount = function (node) {\r\n                        var count = 0;\r\n                        each$d(node.childNodes, function (node) {\r\n                            if (!FormatUtils.isWhiteSpaceNode(node) && !Bookmarks.isBookmarkNode(node)) {\r\n                                count++;\r\n                            }\r\n                        });\r\n                        return count;\r\n                    };\r\n                    var getChildElementNode = function (root) {\r\n                        var child = false;\r\n                        each$d(root.childNodes, function (node) {\r\n                            if (isElementNode$1(node)) {\r\n                                child = node;\r\n                                return false;\r\n                            }\r\n                        });\r\n                        return child;\r\n                    };\r\n                    var mergeStyles = function (node) {\r\n                        var child, clone;\r\n                        child = getChildElementNode(node);\r\n                        if (child && !Bookmarks.isBookmarkNode(child) && MatchFormat.matchName(dom, child, format)) {\r\n                            clone = dom.clone(child, false);\r\n                            setElementFormat(clone);\r\n                            dom.replace(clone, node, true);\r\n                            dom.remove(child, 1);\r\n                        }\r\n                        return clone || node;\r\n                    };\r\n                    childCount = getChildCount(node);\r\n                    if ((newWrappers.length > 1 || !dom.isBlock(node)) && childCount === 0) {\r\n                        dom.remove(node, 1);\r\n                        return;\r\n                    }\r\n                    if (format.inline || format.wrapper) {\r\n                        if (!format.exact && childCount === 1) {\r\n                            node = mergeStyles(node);\r\n                        }\r\n                        MergeFormats.mergeWithChildren(ed, formatList, vars, node);\r\n                        MergeFormats.mergeWithParents(ed, format, name, vars, node);\r\n                        MergeFormats.mergeBackgroundColorAndFontSize(dom, format, vars, node);\r\n                        MergeFormats.mergeSubSup(dom, format, vars, node);\r\n                        MergeFormats.mergeSiblings(dom, format, vars, node);\r\n                    }\r\n                });\r\n            };\r\n            if (dom.getContentEditable(selection.getNode()) === 'false') {\r\n                node = selection.getNode();\r\n                for (var i = 0, l = formatList.length; i < l; i++) {\r\n                    if (formatList[i].ceFalseOverride && dom.is(node, formatList[i].selector)) {\r\n                        setElementFormat(node, formatList[i]);\r\n                        return;\r\n                    }\r\n                }\r\n                return;\r\n            }\r\n            if (format) {\r\n                if (node) {\r\n                    if (node.nodeType) {\r\n                        if (!applyNodeStyle(formatList, node)) {\r\n                            rng = dom.createRng();\r\n                            rng.setStartBefore(node);\r\n                            rng.setEndAfter(node);\r\n                            applyRngStyle(dom, ExpandRange.expandRng(ed, rng, formatList), null, true);\r\n                        }\r\n                    }\r\n                    else {\r\n                        applyRngStyle(dom, node, null, true);\r\n                    }\r\n                }\r\n                else {\r\n                    if (!isCollapsed || !format.inline || dom.select('td[data-mce-selected],th[data-mce-selected]').length) {\r\n                        var curSelNode = ed.selection.getNode();\r\n                        if (!ed.settings.forced_root_block && formatList[0].defaultBlock && !dom.getParent(curSelNode, dom.isBlock)) {\r\n                            applyFormat(ed, formatList[0].defaultBlock);\r\n                        }\r\n                        ed.selection.setRng(RangeNormalizer.normalize(ed.selection.getRng()));\r\n                        bookmark = GetBookmark.getPersistentBookmark(ed.selection, true);\r\n                        applyRngStyle(dom, ExpandRange.expandRng(ed, selection.getRng(), formatList), bookmark);\r\n                        if (format.styles) {\r\n                            MergeFormats.mergeUnderlineAndColor(dom, format, vars, curSelNode);\r\n                        }\r\n                        selection.moveToBookmark(bookmark);\r\n                        FormatUtils.moveStart(dom, selection, selection.getRng());\r\n                        ed.nodeChanged();\r\n                    }\r\n                    else {\r\n                        applyCaretFormat(ed, name, vars);\r\n                    }\r\n                }\r\n                Hooks.postProcess(name, ed);\r\n            }\r\n        };\r\n        var ApplyFormat = { applyFormat: applyFormat };\r\n        var setup$5 = function (registeredFormatListeners, editor) {\r\n            var currentFormats = Cell({});\r\n            registeredFormatListeners.set({});\r\n            editor.on('NodeChange', function (e) {\r\n                updateAndFireChangeCallbacks(editor, e.element, currentFormats, registeredFormatListeners.get());\r\n            });\r\n        };\r\n        var updateAndFireChangeCallbacks = function (editor, elm, currentFormats, formatChangeData) {\r\n            var formatsList = keys(currentFormats.get());\r\n            var newFormats = {};\r\n            var matchedFormats = {};\r\n            var parents = filter(FormatUtils.getParents(editor.dom, elm), function (node) {\r\n                return node.nodeType === 1 && !node.getAttribute('data-mce-bogus');\r\n            });\r\n            each$3(formatChangeData, function (data, format) {\r\n                Tools.each(parents, function (node) {\r\n                    if (editor.formatter.matchNode(node, format, {}, data.similar)) {\r\n                        if (formatsList.indexOf(format) === -1) {\r\n                            each(data.callbacks, function (callback) {\r\n                                callback(true, {\r\n                                    node: node,\r\n                                    format: format,\r\n                                    parents: parents\r\n                                });\r\n                            });\r\n                            newFormats[format] = data.callbacks;\r\n                        }\r\n                        matchedFormats[format] = data.callbacks;\r\n                        return false;\r\n                    }\r\n                    if (MatchFormat.matchesUnInheritedFormatSelector(editor, node, format)) {\r\n                        return false;\r\n                    }\r\n                });\r\n            });\r\n            var remainingFormats = filterRemainingFormats(currentFormats.get(), matchedFormats, elm, parents);\r\n            currentFormats.set(__assign({}, newFormats, remainingFormats));\r\n        };\r\n        var filterRemainingFormats = function (currentFormats, matchedFormats, elm, parents) {\r\n            return bifilter(currentFormats, function (callbacks, format) {\r\n                if (!has(matchedFormats, format)) {\r\n                    each(callbacks, function (callback) {\r\n                        callback(false, {\r\n                            node: elm,\r\n                            format: format,\r\n                            parents: parents\r\n                        });\r\n                    });\r\n                    return false;\r\n                }\r\n                else {\r\n                    return true;\r\n                }\r\n            }).t;\r\n        };\r\n        var addListeners = function (registeredFormatListeners, formats, callback, similar) {\r\n            var formatChangeItems = registeredFormatListeners.get();\r\n            each(formats.split(','), function (format) {\r\n                if (!formatChangeItems[format]) {\r\n                    formatChangeItems[format] = {\r\n                        similar: similar,\r\n                        callbacks: []\r\n                    };\r\n                }\r\n                formatChangeItems[format].callbacks.push(callback);\r\n            });\r\n            registeredFormatListeners.set(formatChangeItems);\r\n        };\r\n        var removeListeners = function (registeredFormatListeners, formats, callback) {\r\n            var formatChangeItems = registeredFormatListeners.get();\r\n            each(formats.split(','), function (format) {\r\n                formatChangeItems[format].callbacks = filter(formatChangeItems[format].callbacks, function (c) {\r\n                    return c !== callback;\r\n                });\r\n                if (formatChangeItems[format].callbacks.length === 0) {\r\n                    delete formatChangeItems[format];\r\n                }\r\n            });\r\n            registeredFormatListeners.set(formatChangeItems);\r\n        };\r\n        var formatChanged = function (editor, registeredFormatListeners, formats, callback, similar) {\r\n            if (registeredFormatListeners.get() === null) {\r\n                setup$5(registeredFormatListeners, editor);\r\n            }\r\n            addListeners(registeredFormatListeners, formats, callback, similar);\r\n            return {\r\n                unbind: function () {\r\n                    return removeListeners(registeredFormatListeners, formats, callback);\r\n                }\r\n            };\r\n        };\r\n        var get$6 = function (dom) {\r\n            var formats = {\r\n                valigntop: [{\r\n                        selector: 'td,th',\r\n                        styles: { verticalAlign: 'top' }\r\n                    }],\r\n                valignmiddle: [{\r\n                        selector: 'td,th',\r\n                        styles: { verticalAlign: 'middle' }\r\n                    }],\r\n                valignbottom: [{\r\n                        selector: 'td,th',\r\n                        styles: { verticalAlign: 'bottom' }\r\n                    }],\r\n                alignleft: [\r\n                    {\r\n                        selector: 'figure.image',\r\n                        collapsed: false,\r\n                        classes: 'align-left',\r\n                        ceFalseOverride: true,\r\n                        preview: 'font-family font-size'\r\n                    },\r\n                    {\r\n                        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n                        styles: { textAlign: 'left' },\r\n                        inherit: false,\r\n                        preview: false,\r\n                        defaultBlock: 'div'\r\n                    },\r\n                    {\r\n                        selector: 'img,table',\r\n                        collapsed: false,\r\n                        styles: { float: 'left' },\r\n                        preview: 'font-family font-size'\r\n                    }\r\n                ],\r\n                aligncenter: [\r\n                    {\r\n                        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n                        styles: { textAlign: 'center' },\r\n                        inherit: false,\r\n                        preview: 'font-family font-size',\r\n                        defaultBlock: 'div'\r\n                    },\r\n                    {\r\n                        selector: 'figure.image',\r\n                        collapsed: false,\r\n                        classes: 'align-center',\r\n                        ceFalseOverride: true,\r\n                        preview: 'font-family font-size'\r\n                    },\r\n                    {\r\n                        selector: 'img',\r\n                        collapsed: false,\r\n                        styles: {\r\n                            display: 'block',\r\n                            marginLeft: 'auto',\r\n                            marginRight: 'auto'\r\n                        },\r\n                        preview: false\r\n                    },\r\n                    {\r\n                        selector: 'table',\r\n                        collapsed: false,\r\n                        styles: {\r\n                            marginLeft: 'auto',\r\n                            marginRight: 'auto'\r\n                        },\r\n                        preview: 'font-family font-size'\r\n                    }\r\n                ],\r\n                alignright: [\r\n                    {\r\n                        selector: 'figure.image',\r\n                        collapsed: false,\r\n                        classes: 'align-right',\r\n                        ceFalseOverride: true,\r\n                        preview: 'font-family font-size'\r\n                    },\r\n                    {\r\n                        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n                        styles: { textAlign: 'right' },\r\n                        inherit: false,\r\n                        preview: 'font-family font-size',\r\n                        defaultBlock: 'div'\r\n                    },\r\n                    {\r\n                        selector: 'img,table',\r\n                        collapsed: false,\r\n                        styles: { float: 'right' },\r\n                        preview: 'font-family font-size'\r\n                    }\r\n                ],\r\n                alignjustify: [{\r\n                        selector: 'figure,p,h1,h2,h3,h4,h5,h6,td,th,tr,div,ul,ol,li',\r\n                        styles: { textAlign: 'justify' },\r\n                        inherit: false,\r\n                        defaultBlock: 'div',\r\n                        preview: 'font-family font-size'\r\n                    }],\r\n                bold: [\r\n                    {\r\n                        inline: 'strong',\r\n                        remove: 'all'\r\n                    },\r\n                    {\r\n                        inline: 'span',\r\n                        styles: { fontWeight: 'bold' }\r\n                    },\r\n                    {\r\n                        inline: 'b',\r\n                        remove: 'all'\r\n                    }\r\n                ],\r\n                italic: [\r\n                    {\r\n                        inline: 'em',\r\n                        remove: 'all'\r\n                    },\r\n                    {\r\n                        inline: 'span',\r\n                        styles: { fontStyle: 'italic' }\r\n                    },\r\n                    {\r\n                        inline: 'i',\r\n                        remove: 'all'\r\n                    }\r\n                ],\r\n                underline: [\r\n                    {\r\n                        inline: 'span',\r\n                        styles: { textDecoration: 'underline' },\r\n                        exact: true\r\n                    },\r\n                    {\r\n                        inline: 'u',\r\n                        remove: 'all'\r\n                    }\r\n                ],\r\n                strikethrough: [\r\n                    {\r\n                        inline: 'span',\r\n                        styles: { textDecoration: 'line-through' },\r\n                        exact: true\r\n                    },\r\n                    {\r\n                        inline: 'strike',\r\n                        remove: 'all'\r\n                    }\r\n                ],\r\n                forecolor: {\r\n                    inline: 'span',\r\n                    styles: { color: '%value' },\r\n                    links: true,\r\n                    remove_similar: true,\r\n                    clear_child_styles: true\r\n                },\r\n                hilitecolor: {\r\n                    inline: 'span',\r\n                    styles: { backgroundColor: '%value' },\r\n                    links: true,\r\n                    remove_similar: true,\r\n                    clear_child_styles: true\r\n                },\r\n                fontname: {\r\n                    inline: 'span',\r\n                    toggle: false,\r\n                    styles: { fontFamily: '%value' },\r\n                    clear_child_styles: true\r\n                },\r\n                fontsize: {\r\n                    inline: 'span',\r\n                    toggle: false,\r\n                    styles: { fontSize: '%value' },\r\n                    clear_child_styles: true\r\n                },\r\n                fontsize_class: {\r\n                    inline: 'span',\r\n                    attributes: { class: '%value' }\r\n                },\r\n                blockquote: {\r\n                    block: 'blockquote',\r\n                    wrapper: true,\r\n                    remove: 'all'\r\n                },\r\n                subscript: { inline: 'sub' },\r\n                superscript: { inline: 'sup' },\r\n                code: { inline: 'code' },\r\n                link: {\r\n                    inline: 'a',\r\n                    selector: 'a',\r\n                    remove: 'all',\r\n                    split: true,\r\n                    deep: true,\r\n                    onmatch: function () {\r\n                        return true;\r\n                    },\r\n                    onformat: function (elm, fmt, vars) {\r\n                        Tools.each(vars, function (value, key) {\r\n                            dom.setAttrib(elm, key, value);\r\n                        });\r\n                    }\r\n                },\r\n                removeformat: [\r\n                    {\r\n                        selector: 'b,strong,em,i,font,u,strike,sub,sup,dfn,code,samp,kbd,var,cite,mark,q,del,ins',\r\n                        remove: 'all',\r\n                        split: true,\r\n                        expand: false,\r\n                        block_expand: true,\r\n                        deep: true\r\n                    },\r\n                    {\r\n                        selector: 'span',\r\n                        attributes: [\r\n                            'style',\r\n                            'class'\r\n                        ],\r\n                        remove: 'empty',\r\n                        split: true,\r\n                        expand: false,\r\n                        deep: true\r\n                    },\r\n                    {\r\n                        selector: '*',\r\n                        attributes: [\r\n                            'style',\r\n                            'class'\r\n                        ],\r\n                        split: false,\r\n                        expand: false,\r\n                        deep: true\r\n                    }\r\n                ]\r\n            };\r\n            Tools.each('p h1 h2 h3 h4 h5 h6 div address pre div dt dd samp'.split(/\\s/), function (name) {\r\n                formats[name] = {\r\n                    block: name,\r\n                    remove: 'all'\r\n                };\r\n            });\r\n            return formats;\r\n        };\r\n        var DefaultFormats = { get: get$6 };\r\n        function FormatRegistry(editor) {\r\n            var formats = {};\r\n            var get = function (name) {\r\n                return name ? formats[name] : formats;\r\n            };\r\n            var has$1 = function (name) {\r\n                return has(formats, name);\r\n            };\r\n            var register = function (name, format) {\r\n                if (name) {\r\n                    if (typeof name !== 'string') {\r\n                        Tools.each(name, function (format, name) {\r\n                            register(name, format);\r\n                        });\r\n                    }\r\n                    else {\r\n                        if (!isArray(format)) {\r\n                            format = [format];\r\n                        }\r\n                        Tools.each(format, function (format) {\r\n                            if (typeof format.deep === 'undefined') {\r\n                                format.deep = !format.selector;\r\n                            }\r\n                            if (typeof format.split === 'undefined') {\r\n                                format.split = !format.selector || format.inline;\r\n                            }\r\n                            if (typeof format.remove === 'undefined' && format.selector && !format.inline) {\r\n                                format.remove = 'none';\r\n                            }\r\n                            if (format.selector && format.inline) {\r\n                                format.mixed = true;\r\n                                format.block_expand = true;\r\n                            }\r\n                            if (typeof format.classes === 'string') {\r\n                                format.classes = format.classes.split(/\\s+/);\r\n                            }\r\n                        });\r\n                        formats[name] = format;\r\n                    }\r\n                }\r\n            };\r\n            var unregister = function (name) {\r\n                if (name && formats[name]) {\r\n                    delete formats[name];\r\n                }\r\n                return formats;\r\n            };\r\n            register(DefaultFormats.get(editor.dom));\r\n            register(editor.settings.formats);\r\n            return {\r\n                get: get,\r\n                has: has$1,\r\n                register: register,\r\n                unregister: unregister\r\n            };\r\n        }\r\n        var each$e = Tools.each;\r\n        var dom = DOMUtils$1.DOM;\r\n        var parsedSelectorToHtml = function (ancestry, editor) {\r\n            var elm, item, fragment;\r\n            var schema = editor && editor.schema || Schema({});\r\n            var decorate = function (elm, item) {\r\n                if (item.classes.length) {\r\n                    dom.addClass(elm, item.classes.join(' '));\r\n                }\r\n                dom.setAttribs(elm, item.attrs);\r\n            };\r\n            var createElement = function (sItem) {\r\n                var elm;\r\n                item = typeof sItem === 'string' ? {\r\n                    name: sItem,\r\n                    classes: [],\r\n                    attrs: {}\r\n                } : sItem;\r\n                elm = dom.create(item.name);\r\n                decorate(elm, item);\r\n                return elm;\r\n            };\r\n            var getRequiredParent = function (elm, candidate) {\r\n                var name = typeof elm !== 'string' ? elm.nodeName.toLowerCase() : elm;\r\n                var elmRule = schema.getElementRule(name);\r\n                var parentsRequired = elmRule && elmRule.parentsRequired;\r\n                if (parentsRequired && parentsRequired.length) {\r\n                    return candidate && Tools.inArray(parentsRequired, candidate) !== -1 ? candidate : parentsRequired[0];\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            };\r\n            var wrapInHtml = function (elm, ancestry, siblings) {\r\n                var parent, parentCandidate, parentRequired;\r\n                var ancestor = ancestry.length > 0 && ancestry[0];\r\n                var ancestorName = ancestor && ancestor.name;\r\n                parentRequired = getRequiredParent(elm, ancestorName);\r\n                if (parentRequired) {\r\n                    if (ancestorName === parentRequired) {\r\n                        parentCandidate = ancestry[0];\r\n                        ancestry = ancestry.slice(1);\r\n                    }\r\n                    else {\r\n                        parentCandidate = parentRequired;\r\n                    }\r\n                }\r\n                else if (ancestor) {\r\n                    parentCandidate = ancestry[0];\r\n                    ancestry = ancestry.slice(1);\r\n                }\r\n                else if (!siblings) {\r\n                    return elm;\r\n                }\r\n                if (parentCandidate) {\r\n                    parent = createElement(parentCandidate);\r\n                    parent.appendChild(elm);\r\n                }\r\n                if (siblings) {\r\n                    if (!parent) {\r\n                        parent = dom.create('div');\r\n                        parent.appendChild(elm);\r\n                    }\r\n                    Tools.each(siblings, function (sibling) {\r\n                        var siblingElm = createElement(sibling);\r\n                        parent.insertBefore(siblingElm, elm);\r\n                    });\r\n                }\r\n                return wrapInHtml(parent, ancestry, parentCandidate && parentCandidate.siblings);\r\n            };\r\n            if (ancestry && ancestry.length) {\r\n                item = ancestry[0];\r\n                elm = createElement(item);\r\n                fragment = dom.create('div');\r\n                fragment.appendChild(wrapInHtml(elm, ancestry.slice(1), item.siblings));\r\n                return fragment;\r\n            }\r\n            else {\r\n                return '';\r\n            }\r\n        };\r\n        var selectorToHtml = function (selector, editor) {\r\n            return parsedSelectorToHtml(parseSelector(selector), editor);\r\n        };\r\n        var parseSelectorItem = function (item) {\r\n            var tagName;\r\n            var obj = {\r\n                classes: [],\r\n                attrs: {}\r\n            };\r\n            item = obj.selector = Tools.trim(item);\r\n            if (item !== '*') {\r\n                tagName = item.replace(/(?:([#\\.]|::?)([\\w\\-]+)|(\\[)([^\\]]+)\\]?)/g, function ($0, $1, $2, $3, $4) {\r\n                    switch ($1) {\r\n                        case '#':\r\n                            obj.attrs.id = $2;\r\n                            break;\r\n                        case '.':\r\n                            obj.classes.push($2);\r\n                            break;\r\n                        case ':':\r\n                            if (Tools.inArray('checked disabled enabled read-only required'.split(' '), $2) !== -1) {\r\n                                obj.attrs[$2] = $2;\r\n                            }\r\n                            break;\r\n                    }\r\n                    if ($3 === '[') {\r\n                        var m = $4.match(/([\\w\\-]+)(?:\\=\\\"([^\\\"]+))?/);\r\n                        if (m) {\r\n                            obj.attrs[m[1]] = m[2];\r\n                        }\r\n                    }\r\n                    return '';\r\n                });\r\n            }\r\n            obj.name = tagName || 'div';\r\n            return obj;\r\n        };\r\n        var parseSelector = function (selector) {\r\n            if (!selector || typeof selector !== 'string') {\r\n                return [];\r\n            }\r\n            selector = selector.split(/\\s*,\\s*/)[0];\r\n            selector = selector.replace(/\\s*(~\\+|~|\\+|>)\\s*/g, '$1');\r\n            return Tools.map(selector.split(/(?:>|\\s+(?![^\\[\\]]+\\]))/), function (item) {\r\n                var siblings = Tools.map(item.split(/(?:~\\+|~|\\+)/), parseSelectorItem);\r\n                var obj = siblings.pop();\r\n                if (siblings.length) {\r\n                    obj.siblings = siblings;\r\n                }\r\n                return obj;\r\n            }).reverse();\r\n        };\r\n        var getCssText = function (editor, format) {\r\n            var name, previewFrag, previewElm, items;\r\n            var previewCss = '', parentFontSize, previewStyles;\r\n            previewStyles = editor.settings.preview_styles;\r\n            if (previewStyles === false) {\r\n                return '';\r\n            }\r\n            if (typeof previewStyles !== 'string') {\r\n                previewStyles = 'font-family font-size font-weight font-style text-decoration ' + 'text-transform color background-color border border-radius outline text-shadow';\r\n            }\r\n            var removeVars = function (val) {\r\n                return val.replace(/%(\\w+)/g, '');\r\n            };\r\n            if (typeof format === 'string') {\r\n                format = editor.formatter.get(format);\r\n                if (!format) {\r\n                    return;\r\n                }\r\n                format = format[0];\r\n            }\r\n            if ('preview' in format) {\r\n                previewStyles = format.preview;\r\n                if (previewStyles === false) {\r\n                    return '';\r\n                }\r\n            }\r\n            name = format.block || format.inline || 'span';\r\n            items = parseSelector(format.selector);\r\n            if (items.length) {\r\n                if (!items[0].name) {\r\n                    items[0].name = name;\r\n                }\r\n                name = format.selector;\r\n                previewFrag = parsedSelectorToHtml(items, editor);\r\n            }\r\n            else {\r\n                previewFrag = parsedSelectorToHtml([name], editor);\r\n            }\r\n            previewElm = dom.select(name, previewFrag)[0] || previewFrag.firstChild;\r\n            each$e(format.styles, function (value, name) {\r\n                value = removeVars(value);\r\n                if (value) {\r\n                    dom.setStyle(previewElm, name, value);\r\n                }\r\n            });\r\n            each$e(format.attributes, function (value, name) {\r\n                value = removeVars(value);\r\n                if (value) {\r\n                    dom.setAttrib(previewElm, name, value);\r\n                }\r\n            });\r\n            each$e(format.classes, function (value) {\r\n                value = removeVars(value);\r\n                if (!dom.hasClass(previewElm, value)) {\r\n                    dom.addClass(previewElm, value);\r\n                }\r\n            });\r\n            editor.fire('PreviewFormats');\r\n            dom.setStyles(previewFrag, {\r\n                position: 'absolute',\r\n                left: -65535\r\n            });\r\n            editor.getBody().appendChild(previewFrag);\r\n            parentFontSize = dom.getStyle(editor.getBody(), 'fontSize', true);\r\n            parentFontSize = /px$/.test(parentFontSize) ? parseInt(parentFontSize, 10) : 0;\r\n            each$e(previewStyles.split(' '), function (name) {\r\n                var value = dom.getStyle(previewElm, name, true);\r\n                if (name === 'background-color' && /transparent|rgba\\s*\\([^)]+,\\s*0\\)/.test(value)) {\r\n                    value = dom.getStyle(editor.getBody(), name, true);\r\n                    if (dom.toHex(value).toLowerCase() === '#ffffff') {\r\n                        return;\r\n                    }\r\n                }\r\n                if (name === 'color') {\r\n                    if (dom.toHex(value).toLowerCase() === '#000000') {\r\n                        return;\r\n                    }\r\n                }\r\n                if (name === 'font-size') {\r\n                    if (/em|%$/.test(value)) {\r\n                        if (parentFontSize === 0) {\r\n                            return;\r\n                        }\r\n                        var numValue = parseFloat(value) / (/%$/.test(value) ? 100 : 1);\r\n                        value = numValue * parentFontSize + 'px';\r\n                    }\r\n                }\r\n                if (name === 'border' && value) {\r\n                    previewCss += 'padding:0 2px;';\r\n                }\r\n                previewCss += name + ':' + value + ';';\r\n            });\r\n            editor.fire('AfterPreviewFormats');\r\n            dom.remove(previewFrag);\r\n            return previewCss;\r\n        };\r\n        var Preview = {\r\n            getCssText: getCssText,\r\n            parseSelector: parseSelector,\r\n            selectorToHtml: selectorToHtml\r\n        };\r\n        var toggle$1 = function (editor, formats, name, vars, node) {\r\n            var fmt = formats.get(name);\r\n            if (MatchFormat.match(editor, name, vars, node) && (!('toggle' in fmt[0]) || fmt[0].toggle)) {\r\n                RemoveFormat.remove(editor, name, vars, node);\r\n            }\r\n            else {\r\n                ApplyFormat.applyFormat(editor, name, vars, node);\r\n            }\r\n        };\r\n        var ToggleFormat = { toggle: toggle$1 };\r\n        var setup$6 = function (editor) {\r\n            editor.addShortcut('meta+b', '', 'Bold');\r\n            editor.addShortcut('meta+i', '', 'Italic');\r\n            editor.addShortcut('meta+u', '', 'Underline');\r\n            for (var i = 1; i <= 6; i++) {\r\n                editor.addShortcut('access+' + i, '', [\r\n                    'FormatBlock',\r\n                    false,\r\n                    'h' + i\r\n                ]);\r\n            }\r\n            editor.addShortcut('access+7', '', [\r\n                'FormatBlock',\r\n                false,\r\n                'p'\r\n            ]);\r\n            editor.addShortcut('access+8', '', [\r\n                'FormatBlock',\r\n                false,\r\n                'div'\r\n            ]);\r\n            editor.addShortcut('access+9', '', [\r\n                'FormatBlock',\r\n                false,\r\n                'address'\r\n            ]);\r\n        };\r\n        var FormatShortcuts = { setup: setup$6 };\r\n        var Formatter = function (editor) {\r\n            var formats = FormatRegistry(editor);\r\n            var formatChangeState = Cell(null);\r\n            FormatShortcuts.setup(editor);\r\n            setup$4(editor);\r\n            return {\r\n                get: formats.get,\r\n                has: formats.has,\r\n                register: formats.register,\r\n                unregister: formats.unregister,\r\n                apply: curry(ApplyFormat.applyFormat, editor),\r\n                remove: curry(RemoveFormat.remove, editor),\r\n                toggle: curry(ToggleFormat.toggle, editor, formats),\r\n                match: curry(MatchFormat.match, editor),\r\n                matchAll: curry(MatchFormat.matchAll, editor),\r\n                matchNode: curry(MatchFormat.matchNode, editor),\r\n                canApply: curry(MatchFormat.canApply, editor),\r\n                formatChanged: curry(formatChanged, editor, formatChangeState),\r\n                getCssText: curry(Preview.getCssText, editor)\r\n            };\r\n        };\r\n        var hasOwnProperty$2 = Object.prototype.hasOwnProperty;\r\n        var shallow$1 = function (old, nu) {\r\n            return nu;\r\n        };\r\n        var baseMerge = function (merger) {\r\n            return function () {\r\n                var objects = new Array(arguments.length);\r\n                for (var i = 0; i < objects.length; i++)\r\n                    objects[i] = arguments[i];\r\n                if (objects.length === 0)\r\n                    throw new Error('Can\\'t merge zero objects');\r\n                var ret = {};\r\n                for (var j = 0; j < objects.length; j++) {\r\n                    var curObject = objects[j];\r\n                    for (var key in curObject)\r\n                        if (hasOwnProperty$2.call(curObject, key)) {\r\n                            ret[key] = merger(ret[key], curObject[key]);\r\n                        }\r\n                }\r\n                return ret;\r\n            };\r\n        };\r\n        var merge = baseMerge(shallow$1);\r\n        var register = function (htmlParser, settings, dom) {\r\n            htmlParser.addAttributeFilter('data-mce-tabindex', function (nodes, name) {\r\n                var i = nodes.length, node;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    node.attr('tabindex', node.attr('data-mce-tabindex'));\r\n                    node.attr(name, null);\r\n                }\r\n            });\r\n            htmlParser.addAttributeFilter('src,href,style', function (nodes, name) {\r\n                var i = nodes.length, node, value;\r\n                var internalName = 'data-mce-' + name;\r\n                var urlConverter = settings.url_converter;\r\n                var urlConverterScope = settings.url_converter_scope;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    value = node.attr(internalName);\r\n                    if (value !== undefined) {\r\n                        node.attr(name, value.length > 0 ? value : null);\r\n                        node.attr(internalName, null);\r\n                    }\r\n                    else {\r\n                        value = node.attr(name);\r\n                        if (name === 'style') {\r\n                            value = dom.serializeStyle(dom.parseStyle(value), node.name);\r\n                        }\r\n                        else if (urlConverter) {\r\n                            value = urlConverter.call(urlConverterScope, value, name, node.name);\r\n                        }\r\n                        node.attr(name, value.length > 0 ? value : null);\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addAttributeFilter('class', function (nodes) {\r\n                var i = nodes.length, node, value;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    value = node.attr('class');\r\n                    if (value) {\r\n                        value = node.attr('class').replace(/(?:^|\\s)mce-item-\\w+(?!\\S)/g, '');\r\n                        node.attr('class', value.length > 0 ? value : null);\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addAttributeFilter('data-mce-type', function (nodes, name, args) {\r\n                var i = nodes.length, node;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    if (node.attr('data-mce-type') === 'bookmark' && !args.cleanup) {\r\n                        var hasChildren = Option.from(node.firstChild).exists(function (firstChild) {\r\n                            return !Zwsp.isZwsp(firstChild.value);\r\n                        });\r\n                        if (hasChildren) {\r\n                            node.unwrap();\r\n                        }\r\n                        else {\r\n                            node.remove();\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addNodeFilter('noscript', function (nodes) {\r\n                var i = nodes.length, node;\r\n                while (i--) {\r\n                    node = nodes[i].firstChild;\r\n                    if (node) {\r\n                        node.value = Entities.decode(node.value);\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addNodeFilter('script,style', function (nodes, name) {\r\n                var i = nodes.length, node, value, type;\r\n                var trim = function (value) {\r\n                    return value.replace(/(<!--\\[CDATA\\[|\\]\\]-->)/g, '\\n').replace(/^[\\r\\n]*|[\\r\\n]*$/g, '').replace(/^\\s*((<!--)?(\\s*\\/\\/)?\\s*<!\\[CDATA\\[|(<!--\\s*)?\\/\\*\\s*<!\\[CDATA\\[\\s*\\*\\/|(\\/\\/)?\\s*<!--|\\/\\*\\s*<!--\\s*\\*\\/)\\s*[\\r\\n]*/gi, '').replace(/\\s*(\\/\\*\\s*\\]\\]>\\s*\\*\\/(-->)?|\\s*\\/\\/\\s*\\]\\]>(-->)?|\\/\\/\\s*(-->)?|\\]\\]>|\\/\\*\\s*-->\\s*\\*\\/|\\s*-->\\s*)\\s*$/g, '');\r\n                };\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    value = node.firstChild ? node.firstChild.value : '';\r\n                    if (name === 'script') {\r\n                        type = node.attr('type');\r\n                        if (type) {\r\n                            node.attr('type', type === 'mce-no/type' ? null : type.replace(/^mce\\-/, ''));\r\n                        }\r\n                        if (settings.element_format === 'xhtml' && value.length > 0) {\r\n                            node.firstChild.value = '// <![CDATA[\\n' + trim(value) + '\\n// ]]>';\r\n                        }\r\n                    }\r\n                    else {\r\n                        if (settings.element_format === 'xhtml' && value.length > 0) {\r\n                            node.firstChild.value = '<!--\\n' + trim(value) + '\\n-->';\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addNodeFilter('#comment', function (nodes) {\r\n                var i = nodes.length, node;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    if (node.value.indexOf('[CDATA[') === 0) {\r\n                        node.name = '#cdata';\r\n                        node.type = 4;\r\n                        node.value = node.value.replace(/^\\[CDATA\\[|\\]\\]$/g, '');\r\n                    }\r\n                    else if (node.value.indexOf('mce:protected ') === 0) {\r\n                        node.name = '#text';\r\n                        node.type = 3;\r\n                        node.raw = true;\r\n                        node.value = unescape(node.value).substr(14);\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addNodeFilter('xml:namespace,input', function (nodes, name) {\r\n                var i = nodes.length, node;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    if (node.type === 7) {\r\n                        node.remove();\r\n                    }\r\n                    else if (node.type === 1) {\r\n                        if (name === 'input' && !node.attr('type')) {\r\n                            node.attr('type', 'text');\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            htmlParser.addAttributeFilter('data-mce-type', function (nodes) {\r\n                each(nodes, function (node) {\r\n                    if (node.attr('data-mce-type') === 'format-caret') {\r\n                        if (node.isEmpty(htmlParser.schema.getNonEmptyElements())) {\r\n                            node.remove();\r\n                        }\r\n                        else {\r\n                            node.unwrap();\r\n                        }\r\n                    }\r\n                });\r\n            });\r\n            htmlParser.addAttributeFilter('data-mce-src,data-mce-href,data-mce-style,' + 'data-mce-selected,data-mce-expando,' + 'data-mce-type,data-mce-resize', function (nodes, name) {\r\n                var i = nodes.length;\r\n                while (i--) {\r\n                    nodes[i].attr(name, null);\r\n                }\r\n            });\r\n        };\r\n        var trimTrailingBr = function (rootNode) {\r\n            var brNode1, brNode2;\r\n            var isBr = function (node) {\r\n                return node && node.name === 'br';\r\n            };\r\n            brNode1 = rootNode.lastChild;\r\n            if (isBr(brNode1)) {\r\n                brNode2 = brNode1.prev;\r\n                if (isBr(brNode2)) {\r\n                    brNode1.remove();\r\n                    brNode2.remove();\r\n                }\r\n            }\r\n        };\r\n        var DomSerializerFilters = {\r\n            register: register,\r\n            trimTrailingBr: trimTrailingBr\r\n        };\r\n        var preProcess = function (editor, node, args) {\r\n            var impl, doc, oldDoc;\r\n            var dom = editor.dom;\r\n            node = node.cloneNode(true);\r\n            impl = domGlobals.document.implementation;\r\n            if (impl.createHTMLDocument) {\r\n                doc = impl.createHTMLDocument('');\r\n                Tools.each(node.nodeName === 'BODY' ? node.childNodes : [node], function (node) {\r\n                    doc.body.appendChild(doc.importNode(node, true));\r\n                });\r\n                if (node.nodeName !== 'BODY') {\r\n                    node = doc.body.firstChild;\r\n                }\r\n                else {\r\n                    node = doc.body;\r\n                }\r\n                oldDoc = dom.doc;\r\n                dom.doc = doc;\r\n            }\r\n            Events.firePreProcess(editor, merge(args, { node: node }));\r\n            if (oldDoc) {\r\n                dom.doc = oldDoc;\r\n            }\r\n            return node;\r\n        };\r\n        var shouldFireEvent = function (editor, args) {\r\n            return editor && editor.hasEventListeners('PreProcess') && !args.no_events;\r\n        };\r\n        var process = function (editor, node, args) {\r\n            return shouldFireEvent(editor, args) ? preProcess(editor, node, args) : node;\r\n        };\r\n        var DomSerializerPreProcess = { process: process };\r\n        var removeAttrs = function (node, names) {\r\n            each(names, function (name) {\r\n                node.attr(name, null);\r\n            });\r\n        };\r\n        var addFontToSpansFilter = function (domParser, styles, fontSizes) {\r\n            domParser.addNodeFilter('font', function (nodes) {\r\n                each(nodes, function (node) {\r\n                    var props = styles.parse(node.attr('style'));\r\n                    var color = node.attr('color');\r\n                    var face = node.attr('face');\r\n                    var size = node.attr('size');\r\n                    if (color) {\r\n                        props.color = color;\r\n                    }\r\n                    if (face) {\r\n                        props['font-family'] = face;\r\n                    }\r\n                    if (size) {\r\n                        props['font-size'] = fontSizes[parseInt(node.attr('size'), 10) - 1];\r\n                    }\r\n                    node.name = 'span';\r\n                    node.attr('style', styles.serialize(props));\r\n                    removeAttrs(node, [\r\n                        'color',\r\n                        'face',\r\n                        'size'\r\n                    ]);\r\n                });\r\n            });\r\n        };\r\n        var addStrikeToSpanFilter = function (domParser, styles) {\r\n            domParser.addNodeFilter('strike', function (nodes) {\r\n                each(nodes, function (node) {\r\n                    var props = styles.parse(node.attr('style'));\r\n                    props['text-decoration'] = 'line-through';\r\n                    node.name = 'span';\r\n                    node.attr('style', styles.serialize(props));\r\n                });\r\n            });\r\n        };\r\n        var addFilters = function (domParser, settings) {\r\n            var styles = Styles();\r\n            if (settings.convert_fonts_to_spans) {\r\n                addFontToSpansFilter(domParser, styles, Tools.explode(settings.font_size_legacy_values));\r\n            }\r\n            addStrikeToSpanFilter(domParser, styles);\r\n        };\r\n        var register$1 = function (domParser, settings) {\r\n            if (settings.inline_styles) {\r\n                addFilters(domParser, settings);\r\n            }\r\n        };\r\n        var LegacyFilter = { register: register$1 };\r\n        var paddEmptyNode = function (settings, args, blockElements, node) {\r\n            var brPreferred = settings.padd_empty_with_br || args.insert;\r\n            if (brPreferred && blockElements[node.name]) {\r\n                node.empty().append(new Node$1('br', 1)).shortEnded = true;\r\n            }\r\n            else {\r\n                node.empty().append(new Node$1('#text', 3)).value = '\\xA0';\r\n            }\r\n        };\r\n        var isPaddedWithNbsp = function (node) {\r\n            return hasOnlyChild(node, '#text') && node.firstChild.value === '\\xA0';\r\n        };\r\n        var hasOnlyChild = function (node, name) {\r\n            return node && node.firstChild && node.firstChild === node.lastChild && node.firstChild.name === name;\r\n        };\r\n        var isPadded = function (schema, node) {\r\n            var rule = schema.getElementRule(node.name);\r\n            return rule && rule.paddEmpty;\r\n        };\r\n        var isEmpty$2 = function (schema, nonEmptyElements, whitespaceElements, node) {\r\n            return node.isEmpty(nonEmptyElements, whitespaceElements, function (node) {\r\n                return isPadded(schema, node);\r\n            });\r\n        };\r\n        var isLineBreakNode = function (node, blockElements) {\r\n            return node && (blockElements[node.name] || node.name === 'br');\r\n        };\r\n        var register$2 = function (parser, settings) {\r\n            var schema = parser.schema;\r\n            if (settings.remove_trailing_brs) {\r\n                parser.addNodeFilter('br', function (nodes, _, args) {\r\n                    var i;\r\n                    var l = nodes.length;\r\n                    var node;\r\n                    var blockElements = Tools.extend({}, schema.getBlockElements());\r\n                    var nonEmptyElements = schema.getNonEmptyElements();\r\n                    var parent, lastParent, prev, prevName;\r\n                    var whiteSpaceElements = schema.getNonEmptyElements();\r\n                    var elementRule, textNode;\r\n                    blockElements.body = 1;\r\n                    for (i = 0; i < l; i++) {\r\n                        node = nodes[i];\r\n                        parent = node.parent;\r\n                        if (blockElements[node.parent.name] && node === parent.lastChild) {\r\n                            prev = node.prev;\r\n                            while (prev) {\r\n                                prevName = prev.name;\r\n                                if (prevName !== 'span' || prev.attr('data-mce-type') !== 'bookmark') {\r\n                                    if (prevName !== 'br') {\r\n                                        break;\r\n                                    }\r\n                                    if (prevName === 'br') {\r\n                                        node = null;\r\n                                        break;\r\n                                    }\r\n                                }\r\n                                prev = prev.prev;\r\n                            }\r\n                            if (node) {\r\n                                node.remove();\r\n                                if (isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, parent)) {\r\n                                    elementRule = schema.getElementRule(parent.name);\r\n                                    if (elementRule) {\r\n                                        if (elementRule.removeEmpty) {\r\n                                            parent.remove();\r\n                                        }\r\n                                        else if (elementRule.paddEmpty) {\r\n                                            paddEmptyNode(settings, args, blockElements, parent);\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                        else {\r\n                            lastParent = node;\r\n                            while (parent && parent.firstChild === lastParent && parent.lastChild === lastParent) {\r\n                                lastParent = parent;\r\n                                if (blockElements[parent.name]) {\r\n                                    break;\r\n                                }\r\n                                parent = parent.parent;\r\n                            }\r\n                            if (lastParent === parent && settings.padd_empty_with_br !== true) {\r\n                                textNode = new Node$1('#text', 3);\r\n                                textNode.value = '\\xA0';\r\n                                node.replace(textNode);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            parser.addAttributeFilter('href', function (nodes) {\r\n                var i = nodes.length, node;\r\n                var appendRel = function (rel) {\r\n                    var parts = rel.split(' ').filter(function (p) {\r\n                        return p.length > 0;\r\n                    });\r\n                    return parts.concat(['noopener']).sort().join(' ');\r\n                };\r\n                var addNoOpener = function (rel) {\r\n                    var newRel = rel ? Tools.trim(rel) : '';\r\n                    if (!/\\b(noopener)\\b/g.test(newRel)) {\r\n                        return appendRel(newRel);\r\n                    }\r\n                    else {\r\n                        return newRel;\r\n                    }\r\n                };\r\n                if (!settings.allow_unsafe_link_target) {\r\n                    while (i--) {\r\n                        node = nodes[i];\r\n                        if (node.name === 'a' && node.attr('target') === '_blank') {\r\n                            node.attr('rel', addNoOpener(node.attr('rel')));\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            if (!settings.allow_html_in_named_anchor) {\r\n                parser.addAttributeFilter('id,name', function (nodes) {\r\n                    var i = nodes.length, sibling, prevSibling, parent, node;\r\n                    while (i--) {\r\n                        node = nodes[i];\r\n                        if (node.name === 'a' && node.firstChild && !node.attr('href')) {\r\n                            parent = node.parent;\r\n                            sibling = node.lastChild;\r\n                            do {\r\n                                prevSibling = sibling.prev;\r\n                                parent.insert(sibling, node);\r\n                                sibling = prevSibling;\r\n                            } while (sibling);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            if (settings.fix_list_elements) {\r\n                parser.addNodeFilter('ul,ol', function (nodes) {\r\n                    var i = nodes.length, node, parentNode;\r\n                    while (i--) {\r\n                        node = nodes[i];\r\n                        parentNode = node.parent;\r\n                        if (parentNode.name === 'ul' || parentNode.name === 'ol') {\r\n                            if (node.prev && node.prev.name === 'li') {\r\n                                node.prev.append(node);\r\n                            }\r\n                            else {\r\n                                var li = new Node$1('li', 1);\r\n                                li.attr('style', 'list-style-type: none');\r\n                                node.wrap(li);\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            if (settings.validate && schema.getValidClasses()) {\r\n                parser.addAttributeFilter('class', function (nodes) {\r\n                    var i = nodes.length, node, classList, ci, className, classValue;\r\n                    var validClasses = schema.getValidClasses();\r\n                    var validClassesMap, valid;\r\n                    while (i--) {\r\n                        node = nodes[i];\r\n                        classList = node.attr('class').split(' ');\r\n                        classValue = '';\r\n                        for (ci = 0; ci < classList.length; ci++) {\r\n                            className = classList[ci];\r\n                            valid = false;\r\n                            validClassesMap = validClasses['*'];\r\n                            if (validClassesMap && validClassesMap[className]) {\r\n                                valid = true;\r\n                            }\r\n                            validClassesMap = validClasses[node.name];\r\n                            if (!valid && validClassesMap && validClassesMap[className]) {\r\n                                valid = true;\r\n                            }\r\n                            if (valid) {\r\n                                if (classValue) {\r\n                                    classValue += ' ';\r\n                                }\r\n                                classValue += className;\r\n                            }\r\n                        }\r\n                        if (!classValue.length) {\r\n                            classValue = null;\r\n                        }\r\n                        node.attr('class', classValue);\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        var makeMap$4 = Tools.makeMap, each$f = Tools.each, explode$2 = Tools.explode, extend$2 = Tools.extend;\r\n        var DomParser = function (settings, schema) {\r\n            if (schema === void 0) {\r\n                schema = Schema();\r\n            }\r\n            var nodeFilters = {};\r\n            var attributeFilters = [];\r\n            var matchedNodes = {};\r\n            var matchedAttributes = {};\r\n            settings = settings || {};\r\n            settings.validate = 'validate' in settings ? settings.validate : true;\r\n            settings.root_name = settings.root_name || 'body';\r\n            var fixInvalidChildren = function (nodes) {\r\n                var ni, node, parent, parents, newParent, currentNode, tempNode, childNode, i;\r\n                var nonEmptyElements, whitespaceElements, nonSplitableElements, textBlockElements, specialElements, sibling, nextNode;\r\n                nonSplitableElements = makeMap$4('tr,td,th,tbody,thead,tfoot,table');\r\n                nonEmptyElements = schema.getNonEmptyElements();\r\n                whitespaceElements = schema.getWhiteSpaceElements();\r\n                textBlockElements = schema.getTextBlockElements();\r\n                specialElements = schema.getSpecialElements();\r\n                for (ni = 0; ni < nodes.length; ni++) {\r\n                    node = nodes[ni];\r\n                    if (!node.parent || node.fixed) {\r\n                        continue;\r\n                    }\r\n                    if (textBlockElements[node.name] && node.parent.name === 'li') {\r\n                        sibling = node.next;\r\n                        while (sibling) {\r\n                            if (textBlockElements[sibling.name]) {\r\n                                sibling.name = 'li';\r\n                                sibling.fixed = true;\r\n                                node.parent.insert(sibling, node.parent);\r\n                            }\r\n                            else {\r\n                                break;\r\n                            }\r\n                            sibling = sibling.next;\r\n                        }\r\n                        node.unwrap(node);\r\n                        continue;\r\n                    }\r\n                    parents = [node];\r\n                    for (parent = node.parent; parent && !schema.isValidChild(parent.name, node.name) && !nonSplitableElements[parent.name]; parent = parent.parent) {\r\n                        parents.push(parent);\r\n                    }\r\n                    if (parent && parents.length > 1) {\r\n                        parents.reverse();\r\n                        newParent = currentNode = filterNode(parents[0].clone());\r\n                        for (i = 0; i < parents.length - 1; i++) {\r\n                            if (schema.isValidChild(currentNode.name, parents[i].name)) {\r\n                                tempNode = filterNode(parents[i].clone());\r\n                                currentNode.append(tempNode);\r\n                            }\r\n                            else {\r\n                                tempNode = currentNode;\r\n                            }\r\n                            for (childNode = parents[i].firstChild; childNode && childNode !== parents[i + 1];) {\r\n                                nextNode = childNode.next;\r\n                                tempNode.append(childNode);\r\n                                childNode = nextNode;\r\n                            }\r\n                            currentNode = tempNode;\r\n                        }\r\n                        if (!isEmpty$2(schema, nonEmptyElements, whitespaceElements, newParent)) {\r\n                            parent.insert(newParent, parents[0], true);\r\n                            parent.insert(node, newParent);\r\n                        }\r\n                        else {\r\n                            parent.insert(node, parents[0], true);\r\n                        }\r\n                        parent = parents[0];\r\n                        if (isEmpty$2(schema, nonEmptyElements, whitespaceElements, parent) || hasOnlyChild(parent, 'br')) {\r\n                            parent.empty().remove();\r\n                        }\r\n                    }\r\n                    else if (node.parent) {\r\n                        if (node.name === 'li') {\r\n                            sibling = node.prev;\r\n                            if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\r\n                                sibling.append(node);\r\n                                continue;\r\n                            }\r\n                            sibling = node.next;\r\n                            if (sibling && (sibling.name === 'ul' || sibling.name === 'ul')) {\r\n                                sibling.insert(node, sibling.firstChild, true);\r\n                                continue;\r\n                            }\r\n                            node.wrap(filterNode(new Node$1('ul', 1)));\r\n                            continue;\r\n                        }\r\n                        if (schema.isValidChild(node.parent.name, 'div') && schema.isValidChild('div', node.name)) {\r\n                            node.wrap(filterNode(new Node$1('div', 1)));\r\n                        }\r\n                        else {\r\n                            if (specialElements[node.name]) {\r\n                                node.empty().remove();\r\n                            }\r\n                            else {\r\n                                node.unwrap();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var filterNode = function (node) {\r\n                var i, name, list;\r\n                name = node.name;\r\n                if (name in nodeFilters) {\r\n                    list = matchedNodes[name];\r\n                    if (list) {\r\n                        list.push(node);\r\n                    }\r\n                    else {\r\n                        matchedNodes[name] = [node];\r\n                    }\r\n                }\r\n                i = attributeFilters.length;\r\n                while (i--) {\r\n                    name = attributeFilters[i].name;\r\n                    if (name in node.attributes.map) {\r\n                        list = matchedAttributes[name];\r\n                        if (list) {\r\n                            list.push(node);\r\n                        }\r\n                        else {\r\n                            matchedAttributes[name] = [node];\r\n                        }\r\n                    }\r\n                }\r\n                return node;\r\n            };\r\n            var addNodeFilter = function (name, callback) {\r\n                each$f(explode$2(name), function (name) {\r\n                    var list = nodeFilters[name];\r\n                    if (!list) {\r\n                        nodeFilters[name] = list = [];\r\n                    }\r\n                    list.push(callback);\r\n                });\r\n            };\r\n            var getNodeFilters = function () {\r\n                var out = [];\r\n                for (var name in nodeFilters) {\r\n                    if (nodeFilters.hasOwnProperty(name)) {\r\n                        out.push({\r\n                            name: name,\r\n                            callbacks: nodeFilters[name]\r\n                        });\r\n                    }\r\n                }\r\n                return out;\r\n            };\r\n            var addAttributeFilter = function (name, callback) {\r\n                each$f(explode$2(name), function (name) {\r\n                    var i;\r\n                    for (i = 0; i < attributeFilters.length; i++) {\r\n                        if (attributeFilters[i].name === name) {\r\n                            attributeFilters[i].callbacks.push(callback);\r\n                            return;\r\n                        }\r\n                    }\r\n                    attributeFilters.push({\r\n                        name: name,\r\n                        callbacks: [callback]\r\n                    });\r\n                });\r\n            };\r\n            var getAttributeFilters = function () {\r\n                return [].concat(attributeFilters);\r\n            };\r\n            var parse = function (html, args) {\r\n                var parser, nodes, i, l, fi, fl, list, name;\r\n                var blockElements;\r\n                var invalidChildren = [];\r\n                var isInWhiteSpacePreservedElement;\r\n                var node;\r\n                var getRootBlockName = function (name) {\r\n                    if (name === false) {\r\n                        return '';\r\n                    }\r\n                    else if (name === true) {\r\n                        return 'p';\r\n                    }\r\n                    else {\r\n                        return name;\r\n                    }\r\n                };\r\n                args = args || {};\r\n                matchedNodes = {};\r\n                matchedAttributes = {};\r\n                blockElements = extend$2(makeMap$4('script,style,head,html,body,title,meta,param'), schema.getBlockElements());\r\n                var nonEmptyElements = schema.getNonEmptyElements();\r\n                var children = schema.children;\r\n                var validate = settings.validate;\r\n                var forcedRootBlockName = 'forced_root_block' in args ? args.forced_root_block : settings.forced_root_block;\r\n                var rootBlockName = getRootBlockName(forcedRootBlockName);\r\n                var whiteSpaceElements = schema.getWhiteSpaceElements();\r\n                var startWhiteSpaceRegExp = /^[ \\t\\r\\n]+/;\r\n                var endWhiteSpaceRegExp = /[ \\t\\r\\n]+$/;\r\n                var allWhiteSpaceRegExp = /[ \\t\\r\\n]+/g;\r\n                var isAllWhiteSpaceRegExp = /^[ \\t\\r\\n]+$/;\r\n                isInWhiteSpacePreservedElement = whiteSpaceElements.hasOwnProperty(args.context) || whiteSpaceElements.hasOwnProperty(settings.root_name);\r\n                var addRootBlocks = function () {\r\n                    var node = rootNode.firstChild, next, rootBlockNode;\r\n                    var trim = function (rootBlockNode) {\r\n                        if (rootBlockNode) {\r\n                            node = rootBlockNode.firstChild;\r\n                            if (node && node.type === 3) {\r\n                                node.value = node.value.replace(startWhiteSpaceRegExp, '');\r\n                            }\r\n                            node = rootBlockNode.lastChild;\r\n                            if (node && node.type === 3) {\r\n                                node.value = node.value.replace(endWhiteSpaceRegExp, '');\r\n                            }\r\n                        }\r\n                    };\r\n                    if (!schema.isValidChild(rootNode.name, rootBlockName.toLowerCase())) {\r\n                        return;\r\n                    }\r\n                    while (node) {\r\n                        next = node.next;\r\n                        if (node.type === 3 || node.type === 1 && node.name !== 'p' && !blockElements[node.name] && !node.attr('data-mce-type')) {\r\n                            if (!rootBlockNode) {\r\n                                rootBlockNode = createNode(rootBlockName, 1);\r\n                                rootBlockNode.attr(settings.forced_root_block_attrs);\r\n                                rootNode.insert(rootBlockNode, node);\r\n                                rootBlockNode.append(node);\r\n                            }\r\n                            else {\r\n                                rootBlockNode.append(node);\r\n                            }\r\n                        }\r\n                        else {\r\n                            trim(rootBlockNode);\r\n                            rootBlockNode = null;\r\n                        }\r\n                        node = next;\r\n                    }\r\n                    trim(rootBlockNode);\r\n                };\r\n                var createNode = function (name, type) {\r\n                    var node = new Node$1(name, type);\r\n                    var list;\r\n                    if (name in nodeFilters) {\r\n                        list = matchedNodes[name];\r\n                        if (list) {\r\n                            list.push(node);\r\n                        }\r\n                        else {\r\n                            matchedNodes[name] = [node];\r\n                        }\r\n                    }\r\n                    return node;\r\n                };\r\n                var removeWhitespaceBefore = function (node) {\r\n                    var textNode, textNodeNext, textVal, sibling;\r\n                    var blockElements = schema.getBlockElements();\r\n                    for (textNode = node.prev; textNode && textNode.type === 3;) {\r\n                        textVal = textNode.value.replace(endWhiteSpaceRegExp, '');\r\n                        if (textVal.length > 0) {\r\n                            textNode.value = textVal;\r\n                            return;\r\n                        }\r\n                        textNodeNext = textNode.next;\r\n                        if (textNodeNext) {\r\n                            if (textNodeNext.type === 3 && textNodeNext.value.length) {\r\n                                textNode = textNode.prev;\r\n                                continue;\r\n                            }\r\n                            if (!blockElements[textNodeNext.name] && textNodeNext.name !== 'script' && textNodeNext.name !== 'style') {\r\n                                textNode = textNode.prev;\r\n                                continue;\r\n                            }\r\n                        }\r\n                        sibling = textNode.prev;\r\n                        textNode.remove();\r\n                        textNode = sibling;\r\n                    }\r\n                };\r\n                var cloneAndExcludeBlocks = function (input) {\r\n                    var name;\r\n                    var output = {};\r\n                    for (name in input) {\r\n                        if (name !== 'li' && name !== 'p') {\r\n                            output[name] = input[name];\r\n                        }\r\n                    }\r\n                    return output;\r\n                };\r\n                parser = SaxParser$1({\r\n                    validate: validate,\r\n                    allow_script_urls: settings.allow_script_urls,\r\n                    allow_conditional_comments: settings.allow_conditional_comments,\r\n                    self_closing_elements: cloneAndExcludeBlocks(schema.getSelfClosingElements()),\r\n                    cdata: function (text) {\r\n                        node.append(createNode('#cdata', 4)).value = text;\r\n                    },\r\n                    text: function (text, raw) {\r\n                        var textNode;\r\n                        if (!isInWhiteSpacePreservedElement) {\r\n                            text = text.replace(allWhiteSpaceRegExp, ' ');\r\n                            if (isLineBreakNode(node.lastChild, blockElements)) {\r\n                                text = text.replace(startWhiteSpaceRegExp, '');\r\n                            }\r\n                        }\r\n                        if (text.length !== 0) {\r\n                            textNode = createNode('#text', 3);\r\n                            textNode.raw = !!raw;\r\n                            node.append(textNode).value = text;\r\n                        }\r\n                    },\r\n                    comment: function (text) {\r\n                        node.append(createNode('#comment', 8)).value = text;\r\n                    },\r\n                    pi: function (name, text) {\r\n                        node.append(createNode(name, 7)).value = text;\r\n                        removeWhitespaceBefore(node);\r\n                    },\r\n                    doctype: function (text) {\r\n                        var newNode;\r\n                        newNode = node.append(createNode('#doctype', 10));\r\n                        newNode.value = text;\r\n                        removeWhitespaceBefore(node);\r\n                    },\r\n                    start: function (name, attrs, empty) {\r\n                        var newNode, attrFiltersLen, elementRule, attrName, parent;\r\n                        elementRule = validate ? schema.getElementRule(name) : {};\r\n                        if (elementRule) {\r\n                            newNode = createNode(elementRule.outputName || name, 1);\r\n                            newNode.attributes = attrs;\r\n                            newNode.shortEnded = empty;\r\n                            node.append(newNode);\r\n                            parent = children[node.name];\r\n                            if (parent && children[newNode.name] && !parent[newNode.name]) {\r\n                                invalidChildren.push(newNode);\r\n                            }\r\n                            attrFiltersLen = attributeFilters.length;\r\n                            while (attrFiltersLen--) {\r\n                                attrName = attributeFilters[attrFiltersLen].name;\r\n                                if (attrName in attrs.map) {\r\n                                    list = matchedAttributes[attrName];\r\n                                    if (list) {\r\n                                        list.push(newNode);\r\n                                    }\r\n                                    else {\r\n                                        matchedAttributes[attrName] = [newNode];\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (blockElements[name]) {\r\n                                removeWhitespaceBefore(newNode);\r\n                            }\r\n                            if (!empty) {\r\n                                node = newNode;\r\n                            }\r\n                            if (!isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\r\n                                isInWhiteSpacePreservedElement = true;\r\n                            }\r\n                        }\r\n                    },\r\n                    end: function (name) {\r\n                        var textNode, elementRule, text, sibling, tempNode;\r\n                        elementRule = validate ? schema.getElementRule(name) : {};\r\n                        if (elementRule) {\r\n                            if (blockElements[name]) {\r\n                                if (!isInWhiteSpacePreservedElement) {\r\n                                    textNode = node.firstChild;\r\n                                    if (textNode && textNode.type === 3) {\r\n                                        text = textNode.value.replace(startWhiteSpaceRegExp, '');\r\n                                        if (text.length > 0) {\r\n                                            textNode.value = text;\r\n                                            textNode = textNode.next;\r\n                                        }\r\n                                        else {\r\n                                            sibling = textNode.next;\r\n                                            textNode.remove();\r\n                                            textNode = sibling;\r\n                                            while (textNode && textNode.type === 3) {\r\n                                                text = textNode.value;\r\n                                                sibling = textNode.next;\r\n                                                if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\r\n                                                    textNode.remove();\r\n                                                    textNode = sibling;\r\n                                                }\r\n                                                textNode = sibling;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                    textNode = node.lastChild;\r\n                                    if (textNode && textNode.type === 3) {\r\n                                        text = textNode.value.replace(endWhiteSpaceRegExp, '');\r\n                                        if (text.length > 0) {\r\n                                            textNode.value = text;\r\n                                            textNode = textNode.prev;\r\n                                        }\r\n                                        else {\r\n                                            sibling = textNode.prev;\r\n                                            textNode.remove();\r\n                                            textNode = sibling;\r\n                                            while (textNode && textNode.type === 3) {\r\n                                                text = textNode.value;\r\n                                                sibling = textNode.prev;\r\n                                                if (text.length === 0 || isAllWhiteSpaceRegExp.test(text)) {\r\n                                                    textNode.remove();\r\n                                                    textNode = sibling;\r\n                                                }\r\n                                                textNode = sibling;\r\n                                            }\r\n                                        }\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (isInWhiteSpacePreservedElement && whiteSpaceElements[name]) {\r\n                                isInWhiteSpacePreservedElement = false;\r\n                            }\r\n                            if (elementRule.removeEmpty && isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node)) {\r\n                                if (!node.attr('name') && !node.attr('id')) {\r\n                                    tempNode = node.parent;\r\n                                    if (blockElements[node.name]) {\r\n                                        node.empty().remove();\r\n                                    }\r\n                                    else {\r\n                                        node.unwrap();\r\n                                    }\r\n                                    node = tempNode;\r\n                                    return;\r\n                                }\r\n                            }\r\n                            if (elementRule.paddEmpty && (isPaddedWithNbsp(node) || isEmpty$2(schema, nonEmptyElements, whiteSpaceElements, node))) {\r\n                                paddEmptyNode(settings, args, blockElements, node);\r\n                            }\r\n                            node = node.parent;\r\n                        }\r\n                    }\r\n                }, schema);\r\n                var rootNode = node = new Node$1(args.context || settings.root_name, 11);\r\n                parser.parse(html);\r\n                if (validate && invalidChildren.length) {\r\n                    if (!args.context) {\r\n                        fixInvalidChildren(invalidChildren);\r\n                    }\r\n                    else {\r\n                        args.invalid = true;\r\n                    }\r\n                }\r\n                if (rootBlockName && (rootNode.name === 'body' || args.isRootContent)) {\r\n                    addRootBlocks();\r\n                }\r\n                if (!args.invalid) {\r\n                    for (name in matchedNodes) {\r\n                        if (!matchedNodes.hasOwnProperty(name)) {\r\n                            continue;\r\n                        }\r\n                        list = nodeFilters[name];\r\n                        nodes = matchedNodes[name];\r\n                        fi = nodes.length;\r\n                        while (fi--) {\r\n                            if (!nodes[fi].parent) {\r\n                                nodes.splice(fi, 1);\r\n                            }\r\n                        }\r\n                        for (i = 0, l = list.length; i < l; i++) {\r\n                            list[i](nodes, name, args);\r\n                        }\r\n                    }\r\n                    for (i = 0, l = attributeFilters.length; i < l; i++) {\r\n                        list = attributeFilters[i];\r\n                        if (list.name in matchedAttributes) {\r\n                            nodes = matchedAttributes[list.name];\r\n                            fi = nodes.length;\r\n                            while (fi--) {\r\n                                if (!nodes[fi].parent) {\r\n                                    nodes.splice(fi, 1);\r\n                                }\r\n                            }\r\n                            for (fi = 0, fl = list.callbacks.length; fi < fl; fi++) {\r\n                                list.callbacks[fi](nodes, list.name, args);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                return rootNode;\r\n            };\r\n            var exports = {\r\n                schema: schema,\r\n                addAttributeFilter: addAttributeFilter,\r\n                getAttributeFilters: getAttributeFilters,\r\n                addNodeFilter: addNodeFilter,\r\n                getNodeFilters: getNodeFilters,\r\n                filterNode: filterNode,\r\n                parse: parse\r\n            };\r\n            register$2(exports, settings);\r\n            LegacyFilter.register(exports, settings);\r\n            return exports;\r\n        };\r\n        var addTempAttr = function (htmlParser, tempAttrs, name) {\r\n            if (Tools.inArray(tempAttrs, name) === -1) {\r\n                htmlParser.addAttributeFilter(name, function (nodes, name) {\r\n                    var i = nodes.length;\r\n                    while (i--) {\r\n                        nodes[i].attr(name, null);\r\n                    }\r\n                });\r\n                tempAttrs.push(name);\r\n            }\r\n        };\r\n        var postProcess$1 = function (editor, args, content) {\r\n            if (!args.no_events && editor) {\r\n                var outArgs = Events.firePostProcess(editor, merge(args, { content: content }));\r\n                return outArgs.content;\r\n            }\r\n            else {\r\n                return content;\r\n            }\r\n        };\r\n        var getHtmlFromNode = function (dom, node, args) {\r\n            var html = Zwsp.trim(args.getInner ? node.innerHTML : dom.getOuterHTML(node));\r\n            return args.selection || isWsPreserveElement(Element.fromDom(node)) ? html : Tools.trim(html);\r\n        };\r\n        var parseHtml = function (htmlParser, html, args) {\r\n            var parserArgs = args.selection ? merge({ forced_root_block: false }, args) : args;\r\n            var rootNode = htmlParser.parse(html, parserArgs);\r\n            DomSerializerFilters.trimTrailingBr(rootNode);\r\n            return rootNode;\r\n        };\r\n        var serializeNode = function (settings, schema, node) {\r\n            var htmlSerializer = Serializer(settings, schema);\r\n            return htmlSerializer.serialize(node);\r\n        };\r\n        var toHtml = function (editor, settings, schema, rootNode, args) {\r\n            var content = serializeNode(settings, schema, rootNode);\r\n            return postProcess$1(editor, args, content);\r\n        };\r\n        var DomSerializer = function (settings, editor) {\r\n            var dom, schema, htmlParser;\r\n            var tempAttrs = ['data-mce-selected'];\r\n            dom = editor && editor.dom ? editor.dom : DOMUtils$1.DOM;\r\n            schema = editor && editor.schema ? editor.schema : Schema(settings);\r\n            settings.entity_encoding = settings.entity_encoding || 'named';\r\n            settings.remove_trailing_brs = 'remove_trailing_brs' in settings ? settings.remove_trailing_brs : true;\r\n            htmlParser = DomParser(settings, schema);\r\n            DomSerializerFilters.register(htmlParser, settings, dom);\r\n            var serialize = function (node, parserArgs) {\r\n                var args = merge({ format: 'html' }, parserArgs ? parserArgs : {});\r\n                var targetNode = DomSerializerPreProcess.process(editor, node, args);\r\n                var html = getHtmlFromNode(dom, targetNode, args);\r\n                var rootNode = parseHtml(htmlParser, html, args);\r\n                return args.format === 'tree' ? rootNode : toHtml(editor, settings, schema, rootNode, args);\r\n            };\r\n            return {\r\n                schema: schema,\r\n                addNodeFilter: htmlParser.addNodeFilter,\r\n                addAttributeFilter: htmlParser.addAttributeFilter,\r\n                serialize: serialize,\r\n                addRules: function (rules) {\r\n                    schema.addValidElements(rules);\r\n                },\r\n                setRules: function (rules) {\r\n                    schema.setValidElements(rules);\r\n                },\r\n                addTempAttr: curry(addTempAttr, htmlParser, tempAttrs),\r\n                getTempAttrs: function () {\r\n                    return tempAttrs;\r\n                }\r\n            };\r\n        };\r\n        var Serializer$1 = function (settings, editor) {\r\n            var domSerializer = DomSerializer(settings, editor);\r\n            return {\r\n                schema: domSerializer.schema,\r\n                addNodeFilter: domSerializer.addNodeFilter,\r\n                addAttributeFilter: domSerializer.addAttributeFilter,\r\n                serialize: domSerializer.serialize,\r\n                addRules: domSerializer.addRules,\r\n                setRules: domSerializer.setRules,\r\n                addTempAttr: domSerializer.addTempAttr,\r\n                getTempAttrs: domSerializer.getTempAttrs\r\n            };\r\n        };\r\n        function BookmarkManager(selection) {\r\n            return {\r\n                getBookmark: curry(Bookmarks.getBookmark, selection),\r\n                moveToBookmark: curry(Bookmarks.moveToBookmark, selection)\r\n            };\r\n        }\r\n        (function (BookmarkManager) {\r\n            BookmarkManager.isBookmarkNode = Bookmarks.isBookmarkNode;\r\n        }(BookmarkManager || (BookmarkManager = {})));\r\n        var BookmarkManager$1 = BookmarkManager;\r\n        var isContentEditableFalse$a = NodeType.isContentEditableFalse;\r\n        var isContentEditableTrue$5 = NodeType.isContentEditableTrue;\r\n        var getContentEditableRoot$1 = function (root, node) {\r\n            while (node && node !== root) {\r\n                if (isContentEditableTrue$5(node) || isContentEditableFalse$a(node)) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var ControlSelection = function (selection, editor) {\r\n            var dom = editor.dom, each = Tools.each;\r\n            var selectedElm, selectedElmGhost, resizeHelper, resizeHandles, selectedHandle;\r\n            var startX, startY, selectedElmX, selectedElmY, startW, startH, ratio, resizeStarted;\r\n            var width, height;\r\n            var editableDoc = editor.getDoc(), rootDocument = domGlobals.document;\r\n            var abs = Math.abs, round = Math.round, rootElement = editor.getBody();\r\n            var startScrollWidth, startScrollHeight;\r\n            resizeHandles = {\r\n                nw: [\r\n                    0,\r\n                    0,\r\n                    -1,\r\n                    -1\r\n                ],\r\n                ne: [\r\n                    1,\r\n                    0,\r\n                    1,\r\n                    -1\r\n                ],\r\n                se: [\r\n                    1,\r\n                    1,\r\n                    1,\r\n                    1\r\n                ],\r\n                sw: [\r\n                    0,\r\n                    1,\r\n                    -1,\r\n                    1\r\n                ]\r\n            };\r\n            var isImage = function (elm) {\r\n                return elm && (elm.nodeName === 'IMG' || editor.dom.is(elm, 'figure.image'));\r\n            };\r\n            var isEventOnImageOutsideRange = function (evt, range) {\r\n                return isImage(evt.target) && !RangePoint.isXYWithinRange(evt.clientX, evt.clientY, range);\r\n            };\r\n            var contextMenuSelectImage = function (evt) {\r\n                var target = evt.target;\r\n                if (isEventOnImageOutsideRange(evt, editor.selection.getRng()) && !evt.isDefaultPrevented()) {\r\n                    evt.preventDefault();\r\n                    editor.selection.select(target);\r\n                }\r\n            };\r\n            var getResizeTarget = function (elm) {\r\n                return editor.dom.is(elm, 'figure.image') ? elm.querySelector('img') : elm;\r\n            };\r\n            var isResizable = function (elm) {\r\n                var selector = editor.settings.object_resizing;\r\n                if (selector === false || Env.iOS) {\r\n                    return false;\r\n                }\r\n                if (typeof selector !== 'string') {\r\n                    selector = 'table,img,figure.image,div';\r\n                }\r\n                if (elm.getAttribute('data-mce-resize') === 'false') {\r\n                    return false;\r\n                }\r\n                if (elm === editor.getBody()) {\r\n                    return false;\r\n                }\r\n                return is$1(Element.fromDom(elm), selector);\r\n            };\r\n            var resizeGhostElement = function (e) {\r\n                var deltaX, deltaY, proportional;\r\n                var resizeHelperX, resizeHelperY;\r\n                deltaX = e.screenX - startX;\r\n                deltaY = e.screenY - startY;\r\n                width = deltaX * selectedHandle[2] + startW;\r\n                height = deltaY * selectedHandle[3] + startH;\r\n                width = width < 5 ? 5 : width;\r\n                height = height < 5 ? 5 : height;\r\n                if (isImage(selectedElm) && editor.settings.resize_img_proportional !== false) {\r\n                    proportional = !VK.modifierPressed(e);\r\n                }\r\n                else {\r\n                    proportional = VK.modifierPressed(e) || isImage(selectedElm) && selectedHandle[2] * selectedHandle[3] !== 0;\r\n                }\r\n                if (proportional) {\r\n                    if (abs(deltaX) > abs(deltaY)) {\r\n                        height = round(width * ratio);\r\n                        width = round(height / ratio);\r\n                    }\r\n                    else {\r\n                        width = round(height / ratio);\r\n                        height = round(width * ratio);\r\n                    }\r\n                }\r\n                dom.setStyles(getResizeTarget(selectedElmGhost), {\r\n                    width: width,\r\n                    height: height\r\n                });\r\n                resizeHelperX = selectedHandle.startPos.x + deltaX;\r\n                resizeHelperY = selectedHandle.startPos.y + deltaY;\r\n                resizeHelperX = resizeHelperX > 0 ? resizeHelperX : 0;\r\n                resizeHelperY = resizeHelperY > 0 ? resizeHelperY : 0;\r\n                dom.setStyles(resizeHelper, {\r\n                    left: resizeHelperX,\r\n                    top: resizeHelperY,\r\n                    display: 'block'\r\n                });\r\n                resizeHelper.innerHTML = width + ' &times; ' + height;\r\n                if (selectedHandle[2] < 0 && selectedElmGhost.clientWidth <= width) {\r\n                    dom.setStyle(selectedElmGhost, 'left', selectedElmX + (startW - width));\r\n                }\r\n                if (selectedHandle[3] < 0 && selectedElmGhost.clientHeight <= height) {\r\n                    dom.setStyle(selectedElmGhost, 'top', selectedElmY + (startH - height));\r\n                }\r\n                deltaX = rootElement.scrollWidth - startScrollWidth;\r\n                deltaY = rootElement.scrollHeight - startScrollHeight;\r\n                if (deltaX + deltaY !== 0) {\r\n                    dom.setStyles(resizeHelper, {\r\n                        left: resizeHelperX - deltaX,\r\n                        top: resizeHelperY - deltaY\r\n                    });\r\n                }\r\n                if (!resizeStarted) {\r\n                    Events.fireObjectResizeStart(editor, selectedElm, startW, startH);\r\n                    resizeStarted = true;\r\n                }\r\n            };\r\n            var endGhostResize = function () {\r\n                resizeStarted = false;\r\n                var setSizeProp = function (name, value) {\r\n                    if (value) {\r\n                        if (selectedElm.style[name] || !editor.schema.isValid(selectedElm.nodeName.toLowerCase(), name)) {\r\n                            dom.setStyle(getResizeTarget(selectedElm), name, value);\r\n                        }\r\n                        else {\r\n                            dom.setAttrib(getResizeTarget(selectedElm), name, value);\r\n                        }\r\n                    }\r\n                };\r\n                setSizeProp('width', width);\r\n                setSizeProp('height', height);\r\n                dom.unbind(editableDoc, 'mousemove', resizeGhostElement);\r\n                dom.unbind(editableDoc, 'mouseup', endGhostResize);\r\n                if (rootDocument !== editableDoc) {\r\n                    dom.unbind(rootDocument, 'mousemove', resizeGhostElement);\r\n                    dom.unbind(rootDocument, 'mouseup', endGhostResize);\r\n                }\r\n                dom.remove(selectedElmGhost);\r\n                dom.remove(resizeHelper);\r\n                showResizeRect(selectedElm);\r\n                Events.fireObjectResized(editor, selectedElm, width, height);\r\n                dom.setAttrib(selectedElm, 'style', dom.getAttrib(selectedElm, 'style'));\r\n                editor.nodeChanged();\r\n            };\r\n            var showResizeRect = function (targetElm) {\r\n                var position, targetWidth, targetHeight, e, rect;\r\n                hideResizeRect();\r\n                unbindResizeHandleEvents();\r\n                position = dom.getPos(targetElm, rootElement);\r\n                selectedElmX = position.x;\r\n                selectedElmY = position.y;\r\n                rect = targetElm.getBoundingClientRect();\r\n                targetWidth = rect.width || rect.right - rect.left;\r\n                targetHeight = rect.height || rect.bottom - rect.top;\r\n                if (selectedElm !== targetElm) {\r\n                    selectedElm = targetElm;\r\n                    width = height = 0;\r\n                }\r\n                e = editor.fire('ObjectSelected', { target: targetElm });\r\n                if (isResizable(targetElm) && !e.isDefaultPrevented()) {\r\n                    each(resizeHandles, function (handle, name) {\r\n                        var handleElm;\r\n                        var startDrag = function (e) {\r\n                            startX = e.screenX;\r\n                            startY = e.screenY;\r\n                            startW = getResizeTarget(selectedElm).clientWidth;\r\n                            startH = getResizeTarget(selectedElm).clientHeight;\r\n                            ratio = startH / startW;\r\n                            selectedHandle = handle;\r\n                            handle.startPos = {\r\n                                x: targetWidth * handle[0] + selectedElmX,\r\n                                y: targetHeight * handle[1] + selectedElmY\r\n                            };\r\n                            startScrollWidth = rootElement.scrollWidth;\r\n                            startScrollHeight = rootElement.scrollHeight;\r\n                            selectedElmGhost = selectedElm.cloneNode(true);\r\n                            dom.addClass(selectedElmGhost, 'mce-clonedresizable');\r\n                            dom.setAttrib(selectedElmGhost, 'data-mce-bogus', 'all');\r\n                            selectedElmGhost.contentEditable = false;\r\n                            selectedElmGhost.unSelectabe = true;\r\n                            dom.setStyles(selectedElmGhost, {\r\n                                left: selectedElmX,\r\n                                top: selectedElmY,\r\n                                margin: 0\r\n                            });\r\n                            selectedElmGhost.removeAttribute('data-mce-selected');\r\n                            rootElement.appendChild(selectedElmGhost);\r\n                            dom.bind(editableDoc, 'mousemove', resizeGhostElement);\r\n                            dom.bind(editableDoc, 'mouseup', endGhostResize);\r\n                            if (rootDocument !== editableDoc) {\r\n                                dom.bind(rootDocument, 'mousemove', resizeGhostElement);\r\n                                dom.bind(rootDocument, 'mouseup', endGhostResize);\r\n                            }\r\n                            resizeHelper = dom.add(rootElement, 'div', {\r\n                                'class': 'mce-resize-helper',\r\n                                'data-mce-bogus': 'all'\r\n                            }, startW + ' &times; ' + startH);\r\n                        };\r\n                        handleElm = dom.get('mceResizeHandle' + name);\r\n                        if (handleElm) {\r\n                            dom.remove(handleElm);\r\n                        }\r\n                        handleElm = dom.add(rootElement, 'div', {\r\n                            'id': 'mceResizeHandle' + name,\r\n                            'data-mce-bogus': 'all',\r\n                            'class': 'mce-resizehandle',\r\n                            'unselectable': true,\r\n                            'style': 'cursor:' + name + '-resize; margin:0; padding:0'\r\n                        });\r\n                        if (Env.ie === 11) {\r\n                            handleElm.contentEditable = false;\r\n                        }\r\n                        dom.bind(handleElm, 'mousedown', function (e) {\r\n                            e.stopImmediatePropagation();\r\n                            e.preventDefault();\r\n                            startDrag(e);\r\n                        });\r\n                        handle.elm = handleElm;\r\n                        dom.setStyles(handleElm, {\r\n                            left: targetWidth * handle[0] + selectedElmX - handleElm.offsetWidth / 2,\r\n                            top: targetHeight * handle[1] + selectedElmY - handleElm.offsetHeight / 2\r\n                        });\r\n                    });\r\n                }\r\n                else {\r\n                    hideResizeRect();\r\n                }\r\n                selectedElm.setAttribute('data-mce-selected', '1');\r\n            };\r\n            var hideResizeRect = function () {\r\n                var name, handleElm;\r\n                unbindResizeHandleEvents();\r\n                if (selectedElm) {\r\n                    selectedElm.removeAttribute('data-mce-selected');\r\n                }\r\n                for (name in resizeHandles) {\r\n                    handleElm = dom.get('mceResizeHandle' + name);\r\n                    if (handleElm) {\r\n                        dom.unbind(handleElm);\r\n                        dom.remove(handleElm);\r\n                    }\r\n                }\r\n            };\r\n            var updateResizeRect = function (e) {\r\n                var startElm, controlElm;\r\n                var isChildOrEqual = function (node, parent) {\r\n                    if (node) {\r\n                        do {\r\n                            if (node === parent) {\r\n                                return true;\r\n                            }\r\n                        } while (node = node.parentNode);\r\n                    }\r\n                };\r\n                if (resizeStarted || editor.removed) {\r\n                    return;\r\n                }\r\n                each(dom.select('img[data-mce-selected],hr[data-mce-selected]'), function (img) {\r\n                    img.removeAttribute('data-mce-selected');\r\n                });\r\n                controlElm = e.type === 'mousedown' ? e.target : selection.getNode();\r\n                controlElm = dom.$(controlElm).closest('table,img,figure.image,hr')[0];\r\n                if (isChildOrEqual(controlElm, rootElement)) {\r\n                    disableGeckoResize();\r\n                    startElm = selection.getStart(true);\r\n                    if (isChildOrEqual(startElm, controlElm) && isChildOrEqual(selection.getEnd(true), controlElm)) {\r\n                        showResizeRect(controlElm);\r\n                        return;\r\n                    }\r\n                }\r\n                hideResizeRect();\r\n            };\r\n            var isWithinContentEditableFalse = function (elm) {\r\n                return isContentEditableFalse$a(getContentEditableRoot$1(editor.getBody(), elm));\r\n            };\r\n            var unbindResizeHandleEvents = function () {\r\n                for (var name in resizeHandles) {\r\n                    var handle = resizeHandles[name];\r\n                    if (handle.elm) {\r\n                        dom.unbind(handle.elm);\r\n                        delete handle.elm;\r\n                    }\r\n                }\r\n            };\r\n            var disableGeckoResize = function () {\r\n                try {\r\n                    editor.getDoc().execCommand('enableObjectResizing', false, false);\r\n                }\r\n                catch (ex) {\r\n                }\r\n            };\r\n            editor.on('init', function () {\r\n                disableGeckoResize();\r\n                if (Env.ie && Env.ie >= 11) {\r\n                    editor.on('mousedown click', function (e) {\r\n                        var target = e.target, nodeName = target.nodeName;\r\n                        if (!resizeStarted && /^(TABLE|IMG|HR)$/.test(nodeName) && !isWithinContentEditableFalse(target)) {\r\n                            if (e.button !== 2) {\r\n                                editor.selection.select(target, nodeName === 'TABLE');\r\n                            }\r\n                            if (e.type === 'mousedown') {\r\n                                editor.nodeChanged();\r\n                            }\r\n                        }\r\n                    });\r\n                    editor.dom.bind(rootElement, 'mscontrolselect', function (e) {\r\n                        var delayedSelect = function (node) {\r\n                            Delay.setEditorTimeout(editor, function () {\r\n                                editor.selection.select(node);\r\n                            });\r\n                        };\r\n                        if (isWithinContentEditableFalse(e.target)) {\r\n                            e.preventDefault();\r\n                            delayedSelect(e.target);\r\n                            return;\r\n                        }\r\n                        if (/^(TABLE|IMG|HR)$/.test(e.target.nodeName)) {\r\n                            e.preventDefault();\r\n                            if (e.target.tagName === 'IMG') {\r\n                                delayedSelect(e.target);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                var throttledUpdateResizeRect = Delay.throttle(function (e) {\r\n                    if (!editor.composing) {\r\n                        updateResizeRect(e);\r\n                    }\r\n                });\r\n                editor.on('nodechange ResizeEditor ResizeWindow drop FullscreenStateChanged', throttledUpdateResizeRect);\r\n                editor.on('keyup compositionend', function (e) {\r\n                    if (selectedElm && selectedElm.nodeName === 'TABLE') {\r\n                        throttledUpdateResizeRect(e);\r\n                    }\r\n                });\r\n                editor.on('hide blur', hideResizeRect);\r\n                editor.on('contextmenu', contextMenuSelectImage);\r\n            });\r\n            editor.on('remove', unbindResizeHandleEvents);\r\n            var destroy = function () {\r\n                selectedElm = selectedElmGhost = null;\r\n            };\r\n            return {\r\n                isResizable: isResizable,\r\n                showResizeRect: showResizeRect,\r\n                hideResizeRect: hideResizeRect,\r\n                updateResizeRect: updateResizeRect,\r\n                destroy: destroy\r\n            };\r\n        };\r\n        var getPos$1 = function (elm) {\r\n            var x = 0, y = 0;\r\n            var offsetParent = elm;\r\n            while (offsetParent && offsetParent.nodeType) {\r\n                x += offsetParent.offsetLeft || 0;\r\n                y += offsetParent.offsetTop || 0;\r\n                offsetParent = offsetParent.offsetParent;\r\n            }\r\n            return {\r\n                x: x,\r\n                y: y\r\n            };\r\n        };\r\n        var fireScrollIntoViewEvent = function (editor, elm, alignToTop) {\r\n            var scrollEvent = {\r\n                elm: elm,\r\n                alignToTop: alignToTop\r\n            };\r\n            editor.fire('ScrollIntoView', scrollEvent);\r\n            return scrollEvent.isDefaultPrevented();\r\n        };\r\n        var scrollElementIntoView = function (editor, elm, alignToTop) {\r\n            var y, viewPort;\r\n            var dom = editor.dom;\r\n            var root = dom.getRoot();\r\n            var viewPortY, viewPortH, offsetY = 0;\r\n            if (fireScrollIntoViewEvent(editor, elm, alignToTop)) {\r\n                return;\r\n            }\r\n            if (!NodeType.isElement(elm)) {\r\n                return;\r\n            }\r\n            if (alignToTop === false) {\r\n                offsetY = elm.offsetHeight;\r\n            }\r\n            if (root.nodeName !== 'BODY') {\r\n                var scrollContainer = editor.selection.getScrollContainer();\r\n                if (scrollContainer) {\r\n                    y = getPos$1(elm).y - getPos$1(scrollContainer).y + offsetY;\r\n                    viewPortH = scrollContainer.clientHeight;\r\n                    viewPortY = scrollContainer.scrollTop;\r\n                    if (y < viewPortY || y + 25 > viewPortY + viewPortH) {\r\n                        scrollContainer.scrollTop = y < viewPortY ? y : y - viewPortH + 25;\r\n                    }\r\n                    return;\r\n                }\r\n            }\r\n            viewPort = dom.getViewPort(editor.getWin());\r\n            y = dom.getPos(elm).y + offsetY;\r\n            viewPortY = viewPort.y;\r\n            viewPortH = viewPort.h;\r\n            if (y < viewPort.y || y + 25 > viewPortY + viewPortH) {\r\n                editor.getWin().scrollTo(0, y < viewPortY ? y : y - viewPortH + 25);\r\n            }\r\n        };\r\n        var getViewPortRect = function (editor) {\r\n            if (editor.inline) {\r\n                return editor.getBody().getBoundingClientRect();\r\n            }\r\n            else {\r\n                var win = editor.getWin();\r\n                return {\r\n                    left: 0,\r\n                    right: win.innerWidth,\r\n                    top: 0,\r\n                    bottom: win.innerHeight,\r\n                    width: win.innerWidth,\r\n                    height: win.innerHeight\r\n                };\r\n            }\r\n        };\r\n        var scrollBy = function (editor, dx, dy) {\r\n            if (editor.inline) {\r\n                editor.getBody().scrollLeft += dx;\r\n                editor.getBody().scrollTop += dy;\r\n            }\r\n            else {\r\n                editor.getWin().scrollBy(dx, dy);\r\n            }\r\n        };\r\n        var scrollRangeIntoView = function (editor, rng) {\r\n            head(CaretPosition.fromRangeStart(rng).getClientRects()).each(function (rngRect) {\r\n                var bodyRect = getViewPortRect(editor);\r\n                var overflow = getOverflow(bodyRect, rngRect);\r\n                var margin = 4;\r\n                var dx = overflow.x > 0 ? overflow.x + margin : overflow.x - margin;\r\n                var dy = overflow.y > 0 ? overflow.y + margin : overflow.y - margin;\r\n                scrollBy(editor, overflow.x !== 0 ? dx : 0, overflow.y !== 0 ? dy : 0);\r\n            });\r\n        };\r\n        var ScrollIntoView = {\r\n            scrollElementIntoView: scrollElementIntoView,\r\n            scrollRangeIntoView: scrollRangeIntoView\r\n        };\r\n        var hasCeProperty = function (node) {\r\n            return NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node);\r\n        };\r\n        var findParent = function (node, rootNode, predicate) {\r\n            while (node && node !== rootNode) {\r\n                if (predicate(node)) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var findClosestIeRange = function (clientX, clientY, doc) {\r\n            var element, rng, rects;\r\n            element = doc.elementFromPoint(clientX, clientY);\r\n            rng = doc.body.createTextRange();\r\n            if (!element || element.tagName === 'HTML') {\r\n                element = doc.body;\r\n            }\r\n            rng.moveToElementText(element);\r\n            rects = Tools.toArray(rng.getClientRects());\r\n            rects = rects.sort(function (a, b) {\r\n                a = Math.abs(Math.max(a.top - clientY, a.bottom - clientY));\r\n                b = Math.abs(Math.max(b.top - clientY, b.bottom - clientY));\r\n                return a - b;\r\n            });\r\n            if (rects.length > 0) {\r\n                clientY = (rects[0].bottom + rects[0].top) / 2;\r\n                try {\r\n                    rng.moveToPoint(clientX, clientY);\r\n                    rng.collapse(true);\r\n                    return rng;\r\n                }\r\n                catch (ex) {\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        var moveOutOfContentEditableFalse = function (rng, rootNode) {\r\n            var parentElement = rng && rng.parentElement ? rng.parentElement() : null;\r\n            return NodeType.isContentEditableFalse(findParent(parentElement, rootNode, hasCeProperty)) ? null : rng;\r\n        };\r\n        var fromPoint$1 = function (clientX, clientY, doc) {\r\n            var rng, point;\r\n            var pointDoc = doc;\r\n            if (pointDoc.caretPositionFromPoint) {\r\n                point = pointDoc.caretPositionFromPoint(clientX, clientY);\r\n                if (point) {\r\n                    rng = doc.createRange();\r\n                    rng.setStart(point.offsetNode, point.offset);\r\n                    rng.collapse(true);\r\n                }\r\n            }\r\n            else if (doc.caretRangeFromPoint) {\r\n                rng = doc.caretRangeFromPoint(clientX, clientY);\r\n            }\r\n            else if (pointDoc.body.createTextRange) {\r\n                rng = pointDoc.body.createTextRange();\r\n                try {\r\n                    rng.moveToPoint(clientX, clientY);\r\n                    rng.collapse(true);\r\n                }\r\n                catch (ex) {\r\n                    rng = findClosestIeRange(clientX, clientY, doc);\r\n                }\r\n                return moveOutOfContentEditableFalse(rng, doc.body);\r\n            }\r\n            return rng;\r\n        };\r\n        var CaretRangeFromPoint = { fromPoint: fromPoint$1 };\r\n        var processRanges = function (editor, ranges) {\r\n            return map(ranges, function (range) {\r\n                var evt = editor.fire('GetSelectionRange', { range: range });\r\n                return evt.range !== range ? evt.range : range;\r\n            });\r\n        };\r\n        var EventProcessRanges = { processRanges: processRanges };\r\n        var fromElements = function (elements, scope) {\r\n            var doc = scope || domGlobals.document;\r\n            var fragment = doc.createDocumentFragment();\r\n            each(elements, function (element) {\r\n                fragment.appendChild(element.dom());\r\n            });\r\n            return Element.fromDom(fragment);\r\n        };\r\n        var tableModel = Immutable('element', 'width', 'rows');\r\n        var tableRow = Immutable('element', 'cells');\r\n        var cellPosition = Immutable('x', 'y');\r\n        var getSpan = function (td, key) {\r\n            var value = parseInt(get$1(td, key), 10);\r\n            return isNaN(value) ? 1 : value;\r\n        };\r\n        var fillout = function (table, x, y, tr, td) {\r\n            var rowspan = getSpan(td, 'rowspan');\r\n            var colspan = getSpan(td, 'colspan');\r\n            var rows = table.rows();\r\n            for (var y2 = y; y2 < y + rowspan; y2++) {\r\n                if (!rows[y2]) {\r\n                    rows[y2] = tableRow(deep(tr), []);\r\n                }\r\n                for (var x2 = x; x2 < x + colspan; x2++) {\r\n                    var cells = rows[y2].cells();\r\n                    cells[x2] = y2 === y && x2 === x ? td : shallow(td);\r\n                }\r\n            }\r\n        };\r\n        var cellExists = function (table, x, y) {\r\n            var rows = table.rows();\r\n            var cells = rows[y] ? rows[y].cells() : [];\r\n            return !!cells[x];\r\n        };\r\n        var skipCellsX = function (table, x, y) {\r\n            while (cellExists(table, x, y)) {\r\n                x++;\r\n            }\r\n            return x;\r\n        };\r\n        var getWidth = function (rows) {\r\n            return foldl(rows, function (acc, row) {\r\n                return row.cells().length > acc ? row.cells().length : acc;\r\n            }, 0);\r\n        };\r\n        var findElementPos = function (table, element) {\r\n            var rows = table.rows();\r\n            for (var y = 0; y < rows.length; y++) {\r\n                var cells = rows[y].cells();\r\n                for (var x = 0; x < cells.length; x++) {\r\n                    if (eq(cells[x], element)) {\r\n                        return Option.some(cellPosition(x, y));\r\n                    }\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var extractRows = function (table, sx, sy, ex, ey) {\r\n            var newRows = [];\r\n            var rows = table.rows();\r\n            for (var y = sy; y <= ey; y++) {\r\n                var cells = rows[y].cells();\r\n                var slice = sx < ex ? cells.slice(sx, ex + 1) : cells.slice(ex, sx + 1);\r\n                newRows.push(tableRow(rows[y].element(), slice));\r\n            }\r\n            return newRows;\r\n        };\r\n        var subTable = function (table, startPos, endPos) {\r\n            var sx = startPos.x(), sy = startPos.y();\r\n            var ex = endPos.x(), ey = endPos.y();\r\n            var newRows = sy < ey ? extractRows(table, sx, sy, ex, ey) : extractRows(table, sx, ey, ex, sy);\r\n            return tableModel(table.element(), getWidth(newRows), newRows);\r\n        };\r\n        var createDomTable = function (table, rows) {\r\n            var tableElement = shallow(table.element());\r\n            var tableBody = Element.fromTag('tbody');\r\n            append$1(tableBody, rows);\r\n            append(tableElement, tableBody);\r\n            return tableElement;\r\n        };\r\n        var modelRowsToDomRows = function (table) {\r\n            return map(table.rows(), function (row) {\r\n                var cells = map(row.cells(), function (cell) {\r\n                    var td = deep(cell);\r\n                    remove(td, 'colspan');\r\n                    remove(td, 'rowspan');\r\n                    return td;\r\n                });\r\n                var tr = shallow(row.element());\r\n                append$1(tr, cells);\r\n                return tr;\r\n            });\r\n        };\r\n        var fromDom$1 = function (tableElm) {\r\n            var table = tableModel(shallow(tableElm), 0, []);\r\n            each(descendants$1(tableElm, 'tr'), function (tr, y) {\r\n                each(descendants$1(tr, 'td,th'), function (td, x) {\r\n                    fillout(table, skipCellsX(table, x, y), y, tr, td);\r\n                });\r\n            });\r\n            return tableModel(table.element(), getWidth(table.rows()), table.rows());\r\n        };\r\n        var toDom = function (table) {\r\n            return createDomTable(table, modelRowsToDomRows(table));\r\n        };\r\n        var subsection = function (table, startElement, endElement) {\r\n            return findElementPos(table, startElement).bind(function (startPos) {\r\n                return findElementPos(table, endElement).map(function (endPos) {\r\n                    return subTable(table, startPos, endPos);\r\n                });\r\n            });\r\n        };\r\n        var SimpleTableModel = {\r\n            fromDom: fromDom$1,\r\n            toDom: toDom,\r\n            subsection: subsection\r\n        };\r\n        var getRanges = function (selection) {\r\n            var ranges = [];\r\n            if (selection) {\r\n                for (var i = 0; i < selection.rangeCount; i++) {\r\n                    ranges.push(selection.getRangeAt(i));\r\n                }\r\n            }\r\n            return ranges;\r\n        };\r\n        var getSelectedNodes = function (ranges) {\r\n            return bind(ranges, function (range) {\r\n                var node = getSelectedNode(range);\r\n                return node ? [Element.fromDom(node)] : [];\r\n            });\r\n        };\r\n        var hasMultipleRanges = function (selection) {\r\n            return getRanges(selection).length > 1;\r\n        };\r\n        var MultiRange = {\r\n            getRanges: getRanges,\r\n            getSelectedNodes: getSelectedNodes,\r\n            hasMultipleRanges: hasMultipleRanges\r\n        };\r\n        var getCellsFromRanges = function (ranges) {\r\n            return filter(MultiRange.getSelectedNodes(ranges), isTableCell);\r\n        };\r\n        var getCellsFromElement = function (elm) {\r\n            return descendants$1(elm, 'td[data-mce-selected],th[data-mce-selected]');\r\n        };\r\n        var getCellsFromElementOrRanges = function (ranges, element) {\r\n            var selectedCells = getCellsFromElement(element);\r\n            var rangeCells = getCellsFromRanges(ranges);\r\n            return selectedCells.length > 0 ? selectedCells : rangeCells;\r\n        };\r\n        var getCellsFromEditor = function (editor) {\r\n            return getCellsFromElementOrRanges(MultiRange.getRanges(editor.selection.getSel()), Element.fromDom(editor.getBody()));\r\n        };\r\n        var TableCellSelection = {\r\n            getCellsFromRanges: getCellsFromRanges,\r\n            getCellsFromElement: getCellsFromElement,\r\n            getCellsFromElementOrRanges: getCellsFromElementOrRanges,\r\n            getCellsFromEditor: getCellsFromEditor\r\n        };\r\n        var findParentListContainer = function (parents) {\r\n            return find(parents, function (elm) {\r\n                return name(elm) === 'ul' || name(elm) === 'ol';\r\n            });\r\n        };\r\n        var getFullySelectedListWrappers = function (parents, rng) {\r\n            return find(parents, function (elm) {\r\n                return name(elm) === 'li' && hasAllContentsSelected(elm, rng);\r\n            }).fold(constant([]), function (li) {\r\n                return findParentListContainer(parents).map(function (listCont) {\r\n                    return [\r\n                        Element.fromTag('li'),\r\n                        Element.fromTag(name(listCont))\r\n                    ];\r\n                }).getOr([]);\r\n            });\r\n        };\r\n        var wrap$3 = function (innerElm, elms) {\r\n            var wrapped = foldl(elms, function (acc, elm) {\r\n                append(elm, acc);\r\n                return elm;\r\n            }, innerElm);\r\n            return elms.length > 0 ? fromElements([wrapped]) : wrapped;\r\n        };\r\n        var directListWrappers = function (commonAnchorContainer) {\r\n            if (isListItem(commonAnchorContainer)) {\r\n                return parent(commonAnchorContainer).filter(isList).fold(constant([]), function (listElm) {\r\n                    return [\r\n                        commonAnchorContainer,\r\n                        listElm\r\n                    ];\r\n                });\r\n            }\r\n            else {\r\n                return isList(commonAnchorContainer) ? [commonAnchorContainer] : [];\r\n            }\r\n        };\r\n        var getWrapElements = function (rootNode, rng) {\r\n            var commonAnchorContainer = Element.fromDom(rng.commonAncestorContainer);\r\n            var parents = Parents.parentsAndSelf(commonAnchorContainer, rootNode);\r\n            var wrapElements = filter(parents, function (elm) {\r\n                return isInline(elm) || isHeading(elm);\r\n            });\r\n            var listWrappers = getFullySelectedListWrappers(parents, rng);\r\n            var allWrappers = wrapElements.concat(listWrappers.length ? listWrappers : directListWrappers(commonAnchorContainer));\r\n            return map(allWrappers, shallow);\r\n        };\r\n        var emptyFragment = function () {\r\n            return fromElements([]);\r\n        };\r\n        var getFragmentFromRange = function (rootNode, rng) {\r\n            return wrap$3(Element.fromDom(rng.cloneContents()), getWrapElements(rootNode, rng));\r\n        };\r\n        var getParentTable = function (rootElm, cell) {\r\n            return ancestor$1(cell, 'table', curry(eq, rootElm));\r\n        };\r\n        var getTableFragment = function (rootNode, selectedTableCells) {\r\n            return getParentTable(rootNode, selectedTableCells[0]).bind(function (tableElm) {\r\n                var firstCell = selectedTableCells[0];\r\n                var lastCell = selectedTableCells[selectedTableCells.length - 1];\r\n                var fullTableModel = SimpleTableModel.fromDom(tableElm);\r\n                return SimpleTableModel.subsection(fullTableModel, firstCell, lastCell).map(function (sectionedTableModel) {\r\n                    return fromElements([SimpleTableModel.toDom(sectionedTableModel)]);\r\n                });\r\n            }).getOrThunk(emptyFragment);\r\n        };\r\n        var getSelectionFragment = function (rootNode, ranges) {\r\n            return ranges.length > 0 && ranges[0].collapsed ? emptyFragment() : getFragmentFromRange(rootNode, ranges[0]);\r\n        };\r\n        var read$2 = function (rootNode, ranges) {\r\n            var selectedCells = TableCellSelection.getCellsFromElementOrRanges(ranges, rootNode);\r\n            return selectedCells.length > 0 ? getTableFragment(rootNode, selectedCells) : getSelectionFragment(rootNode, ranges);\r\n        };\r\n        var FragmentReader = { read: read$2 };\r\n        var getTextContent = function (editor) {\r\n            return Option.from(editor.selection.getRng()).map(function (rng) {\r\n                var bin = editor.dom.add(editor.getBody(), 'div', {\r\n                    'data-mce-bogus': 'all',\r\n                    'style': 'overflow: hidden; opacity: 0;'\r\n                }, rng.cloneContents());\r\n                var text = Zwsp.trim(bin.innerText);\r\n                editor.dom.remove(bin);\r\n                return text;\r\n            }).getOr('');\r\n        };\r\n        var getHtmlContent = function (editor, args) {\r\n            var rng = editor.selection.getRng(), tmpElm = editor.dom.create('body');\r\n            var sel = editor.selection.getSel();\r\n            var fragment;\r\n            var ranges = EventProcessRanges.processRanges(editor, MultiRange.getRanges(sel));\r\n            fragment = args.contextual ? FragmentReader.read(Element.fromDom(editor.getBody()), ranges).dom() : rng.cloneContents();\r\n            if (fragment) {\r\n                tmpElm.appendChild(fragment);\r\n            }\r\n            return editor.selection.serializer.serialize(tmpElm, args);\r\n        };\r\n        var getContent$1 = function (editor, args) {\r\n            if (args === void 0) {\r\n                args = {};\r\n            }\r\n            args.get = true;\r\n            args.format = args.format || 'html';\r\n            args.selection = true;\r\n            args = editor.fire('BeforeGetContent', args);\r\n            if (args.isDefaultPrevented()) {\r\n                editor.fire('GetContent', args);\r\n                return args.content;\r\n            }\r\n            if (args.format === 'text') {\r\n                return getTextContent(editor);\r\n            }\r\n            else {\r\n                args.getInner = true;\r\n                var content = getHtmlContent(editor, args);\r\n                if (args.format === 'tree') {\r\n                    return content;\r\n                }\r\n                else {\r\n                    args.content = editor.selection.isCollapsed() ? '' : content;\r\n                    editor.fire('GetContent', args);\r\n                    return args.content;\r\n                }\r\n            }\r\n        };\r\n        var GetSelectionContent = { getContent: getContent$1 };\r\n        var findParent$1 = function (node, rootNode, predicate) {\r\n            while (node && node !== rootNode) {\r\n                if (predicate(node)) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var hasParent = function (node, rootNode, predicate) {\r\n            return findParent$1(node, rootNode, predicate) !== null;\r\n        };\r\n        var hasParentWithName = function (node, rootNode, name) {\r\n            return hasParent(node, rootNode, function (node) {\r\n                return node.nodeName === name;\r\n            });\r\n        };\r\n        var isTable$3 = function (node) {\r\n            return node && node.nodeName === 'TABLE';\r\n        };\r\n        var isTableCell$3 = function (node) {\r\n            return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\r\n        };\r\n        var isCeFalseCaretContainer = function (node, rootNode) {\r\n            return isCaretContainer(node) && hasParent(node, rootNode, isCaretNode) === false;\r\n        };\r\n        var hasBrBeforeAfter = function (dom, node, left) {\r\n            var walker = new TreeWalker(node, dom.getParent(node.parentNode, dom.isBlock) || dom.getRoot());\r\n            while (node = walker[left ? 'prev' : 'next']()) {\r\n                if (NodeType.isBr(node)) {\r\n                    return true;\r\n                }\r\n            }\r\n        };\r\n        var isPrevNode = function (node, name) {\r\n            return node.previousSibling && node.previousSibling.nodeName === name;\r\n        };\r\n        var hasContentEditableFalseParent = function (body, node) {\r\n            while (node && node !== body) {\r\n                if (NodeType.isContentEditableFalse(node)) {\r\n                    return true;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return false;\r\n        };\r\n        var findTextNodeRelative = function (dom, isAfterNode, collapsed, left, startNode) {\r\n            var lastInlineElement;\r\n            var body = dom.getRoot();\r\n            var node;\r\n            var nonEmptyElementsMap = dom.schema.getNonEmptyElements();\r\n            var parentBlockContainer = dom.getParent(startNode.parentNode, dom.isBlock) || body;\r\n            if (left && NodeType.isBr(startNode) && isAfterNode && dom.isEmpty(parentBlockContainer)) {\r\n                return Option.some(CaretPosition(startNode.parentNode, dom.nodeIndex(startNode)));\r\n            }\r\n            var walker = new TreeWalker(startNode, parentBlockContainer);\r\n            while (node = walker[left ? 'prev' : 'next']()) {\r\n                if (dom.getContentEditableParent(node) === 'false' || isCeFalseCaretContainer(node, body)) {\r\n                    return Option.none();\r\n                }\r\n                if (NodeType.isText(node) && node.nodeValue.length > 0) {\r\n                    if (hasParentWithName(node, body, 'A') === false) {\r\n                        return Option.some(CaretPosition(node, left ? node.nodeValue.length : 0));\r\n                    }\r\n                    return Option.none();\r\n                }\r\n                if (dom.isBlock(node) || nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\r\n                    return Option.none();\r\n                }\r\n                lastInlineElement = node;\r\n            }\r\n            if (collapsed && lastInlineElement) {\r\n                return Option.some(CaretPosition(lastInlineElement, 0));\r\n            }\r\n            return Option.none();\r\n        };\r\n        var normalizeEndPoint = function (dom, collapsed, start, rng) {\r\n            var container, offset;\r\n            var body = dom.getRoot();\r\n            var node, nonEmptyElementsMap;\r\n            var directionLeft, isAfterNode, normalized = false;\r\n            container = rng[(start ? 'start' : 'end') + 'Container'];\r\n            offset = rng[(start ? 'start' : 'end') + 'Offset'];\r\n            isAfterNode = NodeType.isElement(container) && offset === container.childNodes.length;\r\n            nonEmptyElementsMap = dom.schema.getNonEmptyElements();\r\n            directionLeft = start;\r\n            if (isCaretContainer(container)) {\r\n                return Option.none();\r\n            }\r\n            if (NodeType.isElement(container) && offset > container.childNodes.length - 1) {\r\n                directionLeft = false;\r\n            }\r\n            if (NodeType.isDocument(container)) {\r\n                container = body;\r\n                offset = 0;\r\n            }\r\n            if (container === body) {\r\n                if (directionLeft) {\r\n                    node = container.childNodes[offset > 0 ? offset - 1 : 0];\r\n                    if (node) {\r\n                        if (isCaretContainer(node)) {\r\n                            return Option.none();\r\n                        }\r\n                        if (nonEmptyElementsMap[node.nodeName] || isTable$3(node)) {\r\n                            return Option.none();\r\n                        }\r\n                    }\r\n                }\r\n                if (container.hasChildNodes()) {\r\n                    offset = Math.min(!directionLeft && offset > 0 ? offset - 1 : offset, container.childNodes.length - 1);\r\n                    container = container.childNodes[offset];\r\n                    offset = NodeType.isText(container) && isAfterNode ? container.data.length : 0;\r\n                    if (!collapsed && container === body.lastChild && isTable$3(container)) {\r\n                        return Option.none();\r\n                    }\r\n                    if (hasContentEditableFalseParent(body, container) || isCaretContainer(container)) {\r\n                        return Option.none();\r\n                    }\r\n                    if (container.hasChildNodes() && isTable$3(container) === false) {\r\n                        node = container;\r\n                        var walker = new TreeWalker(container, body);\r\n                        do {\r\n                            if (NodeType.isContentEditableFalse(node) || isCaretContainer(node)) {\r\n                                normalized = false;\r\n                                break;\r\n                            }\r\n                            if (NodeType.isText(node) && node.nodeValue.length > 0) {\r\n                                offset = directionLeft ? 0 : node.nodeValue.length;\r\n                                container = node;\r\n                                normalized = true;\r\n                                break;\r\n                            }\r\n                            if (nonEmptyElementsMap[node.nodeName.toLowerCase()] && !isTableCell$3(node)) {\r\n                                offset = dom.nodeIndex(node);\r\n                                container = node.parentNode;\r\n                                if (!directionLeft) {\r\n                                    offset++;\r\n                                }\r\n                                normalized = true;\r\n                                break;\r\n                            }\r\n                        } while (node = directionLeft ? walker.next() : walker.prev());\r\n                    }\r\n                }\r\n            }\r\n            if (collapsed) {\r\n                if (NodeType.isText(container) && offset === 0) {\r\n                    findTextNodeRelative(dom, isAfterNode, collapsed, true, container).each(function (pos) {\r\n                        container = pos.container();\r\n                        offset = pos.offset();\r\n                        normalized = true;\r\n                    });\r\n                }\r\n                if (NodeType.isElement(container)) {\r\n                    node = container.childNodes[offset];\r\n                    if (!node) {\r\n                        node = container.childNodes[offset - 1];\r\n                    }\r\n                    if (node && NodeType.isBr(node) && !isPrevNode(node, 'A') && !hasBrBeforeAfter(dom, node, false) && !hasBrBeforeAfter(dom, node, true)) {\r\n                        findTextNodeRelative(dom, isAfterNode, collapsed, true, node).each(function (pos) {\r\n                            container = pos.container();\r\n                            offset = pos.offset();\r\n                            normalized = true;\r\n                        });\r\n                    }\r\n                }\r\n            }\r\n            if (directionLeft && !collapsed && NodeType.isText(container) && offset === container.nodeValue.length) {\r\n                findTextNodeRelative(dom, isAfterNode, collapsed, false, container).each(function (pos) {\r\n                    container = pos.container();\r\n                    offset = pos.offset();\r\n                    normalized = true;\r\n                });\r\n            }\r\n            return normalized ? Option.some(CaretPosition(container, offset)) : Option.none();\r\n        };\r\n        var normalize$2 = function (dom, rng) {\r\n            var collapsed = rng.collapsed, normRng = rng.cloneRange();\r\n            var startPos = CaretPosition.fromRangeStart(rng);\r\n            normalizeEndPoint(dom, collapsed, true, normRng).each(function (pos) {\r\n                if (!collapsed || !CaretPosition.isAbove(startPos, pos)) {\r\n                    normRng.setStart(pos.container(), pos.offset());\r\n                }\r\n            });\r\n            if (!collapsed) {\r\n                normalizeEndPoint(dom, collapsed, false, normRng).each(function (pos) {\r\n                    normRng.setEnd(pos.container(), pos.offset());\r\n                });\r\n            }\r\n            if (collapsed) {\r\n                normRng.collapse(true);\r\n            }\r\n            return RangeCompare.isEq(rng, normRng) ? Option.none() : Option.some(normRng);\r\n        };\r\n        var NormalizeRange = { normalize: normalize$2 };\r\n        var prependData = function (target, data) {\r\n            target.insertData(0, data);\r\n        };\r\n        var removeEmpty = function (text) {\r\n            if (text.dom().length === 0) {\r\n                remove$1(text);\r\n                return Option.none();\r\n            }\r\n            return Option.some(text);\r\n        };\r\n        var rngSetContent = function (rng, fragment) {\r\n            var firstChild = Option.from(fragment.firstChild).map(Element.fromDom);\r\n            var lastChild = Option.from(fragment.lastChild).map(Element.fromDom);\r\n            rng.deleteContents();\r\n            rng.insertNode(fragment);\r\n            var prevText = firstChild.bind(prevSibling).filter(isText).bind(removeEmpty);\r\n            var nextText = lastChild.bind(nextSibling).filter(isText).bind(removeEmpty);\r\n            liftN([\r\n                prevText,\r\n                firstChild.filter(isText)\r\n            ], function (prev, start) {\r\n                prependData(start.dom(), prev.dom().data);\r\n                remove$1(prev);\r\n            });\r\n            liftN([\r\n                nextText,\r\n                lastChild.filter(isText)\r\n            ], function (next, end) {\r\n                var oldLength = end.dom().length;\r\n                end.dom().appendData(next.dom().data);\r\n                rng.setEnd(end.dom(), oldLength);\r\n                remove$1(next);\r\n            });\r\n            rng.collapse(false);\r\n        };\r\n        var setupArgs = function (args, content) {\r\n            args = args || { format: 'html' };\r\n            args.set = true;\r\n            args.selection = true;\r\n            args.content = content;\r\n            return args;\r\n        };\r\n        var setContent$1 = function (editor, content, args) {\r\n            args = setupArgs(args, content);\r\n            if (!args.no_events) {\r\n                args = editor.fire('BeforeSetContent', args);\r\n                if (args.isDefaultPrevented()) {\r\n                    editor.fire('SetContent', args);\r\n                    return;\r\n                }\r\n            }\r\n            var rng = editor.selection.getRng();\r\n            rngSetContent(rng, rng.createContextualFragment(args.content));\r\n            editor.selection.setRng(rng);\r\n            ScrollIntoView.scrollRangeIntoView(editor, rng);\r\n            if (!args.no_events) {\r\n                editor.fire('SetContent', args);\r\n            }\r\n        };\r\n        var SetSelectionContent = { setContent: setContent$1 };\r\n        var getEndpointElement = function (root, rng, start, real, resolve) {\r\n            var container = start ? rng.startContainer : rng.endContainer;\r\n            var offset = start ? rng.startOffset : rng.endOffset;\r\n            return Option.from(container).map(Element.fromDom).map(function (elm) {\r\n                return !real || !rng.collapsed ? child(elm, resolve(elm, offset)).getOr(elm) : elm;\r\n            }).bind(function (elm) {\r\n                return isElement(elm) ? Option.some(elm) : parent(elm);\r\n            }).map(function (elm) {\r\n                return elm.dom();\r\n            }).getOr(root);\r\n        };\r\n        var getStart = function (root, rng, real) {\r\n            return getEndpointElement(root, rng, true, real, function (elm, offset) {\r\n                return Math.min(childNodesCount(elm), offset);\r\n            });\r\n        };\r\n        var getEnd = function (root, rng, real) {\r\n            return getEndpointElement(root, rng, false, real, function (elm, offset) {\r\n                return offset > 0 ? offset - 1 : offset;\r\n            });\r\n        };\r\n        var skipEmptyTextNodes = function (node, forwards) {\r\n            var orig = node;\r\n            while (node && NodeType.isText(node) && node.length === 0) {\r\n                node = forwards ? node.nextSibling : node.previousSibling;\r\n            }\r\n            return node || orig;\r\n        };\r\n        var getNode$1 = function (root, rng) {\r\n            var elm, startContainer, endContainer, startOffset, endOffset;\r\n            if (!rng) {\r\n                return root;\r\n            }\r\n            startContainer = rng.startContainer;\r\n            endContainer = rng.endContainer;\r\n            startOffset = rng.startOffset;\r\n            endOffset = rng.endOffset;\r\n            elm = rng.commonAncestorContainer;\r\n            if (!rng.collapsed) {\r\n                if (startContainer === endContainer) {\r\n                    if (endOffset - startOffset < 2) {\r\n                        if (startContainer.hasChildNodes()) {\r\n                            elm = startContainer.childNodes[startOffset];\r\n                        }\r\n                    }\r\n                }\r\n                if (startContainer.nodeType === 3 && endContainer.nodeType === 3) {\r\n                    if (startContainer.length === startOffset) {\r\n                        startContainer = skipEmptyTextNodes(startContainer.nextSibling, true);\r\n                    }\r\n                    else {\r\n                        startContainer = startContainer.parentNode;\r\n                    }\r\n                    if (endOffset === 0) {\r\n                        endContainer = skipEmptyTextNodes(endContainer.previousSibling, false);\r\n                    }\r\n                    else {\r\n                        endContainer = endContainer.parentNode;\r\n                    }\r\n                    if (startContainer && startContainer === endContainer) {\r\n                        return startContainer;\r\n                    }\r\n                }\r\n            }\r\n            if (elm && elm.nodeType === 3) {\r\n                return elm.parentNode;\r\n            }\r\n            return elm;\r\n        };\r\n        var getSelectedBlocks = function (dom, rng, startElm, endElm) {\r\n            var node, root;\r\n            var selectedBlocks = [];\r\n            root = dom.getRoot();\r\n            startElm = dom.getParent(startElm || getStart(root, rng, rng.collapsed), dom.isBlock);\r\n            endElm = dom.getParent(endElm || getEnd(root, rng, rng.collapsed), dom.isBlock);\r\n            if (startElm && startElm !== root) {\r\n                selectedBlocks.push(startElm);\r\n            }\r\n            if (startElm && endElm && startElm !== endElm) {\r\n                node = startElm;\r\n                var walker = new TreeWalker(startElm, root);\r\n                while ((node = walker.next()) && node !== endElm) {\r\n                    if (dom.isBlock(node)) {\r\n                        selectedBlocks.push(node);\r\n                    }\r\n                }\r\n            }\r\n            if (endElm && startElm !== endElm && endElm !== root) {\r\n                selectedBlocks.push(endElm);\r\n            }\r\n            return selectedBlocks;\r\n        };\r\n        var select$1 = function (dom, node, content) {\r\n            return Option.from(node).map(function (node) {\r\n                var idx = dom.nodeIndex(node);\r\n                var rng = dom.createRng();\r\n                rng.setStart(node.parentNode, idx);\r\n                rng.setEnd(node.parentNode, idx + 1);\r\n                if (content) {\r\n                    moveEndPoint$1(dom, rng, node, true);\r\n                    moveEndPoint$1(dom, rng, node, false);\r\n                }\r\n                return rng;\r\n            });\r\n        };\r\n        var deleteFromCallbackMap = function (callbackMap, selector, callback) {\r\n            if (callbackMap && callbackMap.hasOwnProperty(selector)) {\r\n                var newCallbacks = filter(callbackMap[selector], function (cb) {\r\n                    return cb !== callback;\r\n                });\r\n                if (newCallbacks.length === 0) {\r\n                    delete callbackMap[selector];\r\n                }\r\n                else {\r\n                    callbackMap[selector] = newCallbacks;\r\n                }\r\n            }\r\n        };\r\n        function SelectorChanged(dom, editor) {\r\n            var selectorChangedData, currentSelectors;\r\n            return {\r\n                selectorChangedWithUnbind: function (selector, callback) {\r\n                    if (!selectorChangedData) {\r\n                        selectorChangedData = {};\r\n                        currentSelectors = {};\r\n                        editor.on('NodeChange', function (e) {\r\n                            var node = e.element, parents = dom.getParents(node, null, dom.getRoot()), matchedSelectors = {};\r\n                            Tools.each(selectorChangedData, function (callbacks, selector) {\r\n                                Tools.each(parents, function (node) {\r\n                                    if (dom.is(node, selector)) {\r\n                                        if (!currentSelectors[selector]) {\r\n                                            Tools.each(callbacks, function (callback) {\r\n                                                callback(true, {\r\n                                                    node: node,\r\n                                                    selector: selector,\r\n                                                    parents: parents\r\n                                                });\r\n                                            });\r\n                                            currentSelectors[selector] = callbacks;\r\n                                        }\r\n                                        matchedSelectors[selector] = callbacks;\r\n                                        return false;\r\n                                    }\r\n                                });\r\n                            });\r\n                            Tools.each(currentSelectors, function (callbacks, selector) {\r\n                                if (!matchedSelectors[selector]) {\r\n                                    delete currentSelectors[selector];\r\n                                    Tools.each(callbacks, function (callback) {\r\n                                        callback(false, {\r\n                                            node: node,\r\n                                            selector: selector,\r\n                                            parents: parents\r\n                                        });\r\n                                    });\r\n                                }\r\n                            });\r\n                        });\r\n                    }\r\n                    if (!selectorChangedData[selector]) {\r\n                        selectorChangedData[selector] = [];\r\n                    }\r\n                    selectorChangedData[selector].push(callback);\r\n                    return {\r\n                        unbind: function () {\r\n                            deleteFromCallbackMap(selectorChangedData, selector, callback);\r\n                            deleteFromCallbackMap(currentSelectors, selector, callback);\r\n                        }\r\n                    };\r\n                }\r\n            };\r\n        }\r\n        var isNativeIeSelection = function (rng) {\r\n            return !!rng.select;\r\n        };\r\n        var isAttachedToDom = function (node) {\r\n            return !!(node && node.ownerDocument) && contains$3(Element.fromDom(node.ownerDocument), Element.fromDom(node));\r\n        };\r\n        var isValidRange = function (rng) {\r\n            if (!rng) {\r\n                return false;\r\n            }\r\n            else if (isNativeIeSelection(rng)) {\r\n                return true;\r\n            }\r\n            else {\r\n                return isAttachedToDom(rng.startContainer) && isAttachedToDom(rng.endContainer);\r\n            }\r\n        };\r\n        var Selection = function (dom, win, serializer, editor) {\r\n            var bookmarkManager, controlSelection;\r\n            var selectedRange, explicitRange;\r\n            var selectorChangedWithUnbind = SelectorChanged(dom, editor).selectorChangedWithUnbind;\r\n            var setCursorLocation = function (node, offset) {\r\n                var rng = dom.createRng();\r\n                if (!node) {\r\n                    moveEndPoint$1(dom, rng, editor.getBody(), true);\r\n                    setRng(rng);\r\n                }\r\n                else {\r\n                    rng.setStart(node, offset);\r\n                    rng.setEnd(node, offset);\r\n                    setRng(rng);\r\n                    collapse(false);\r\n                }\r\n            };\r\n            var getContent = function (args) {\r\n                return GetSelectionContent.getContent(editor, args);\r\n            };\r\n            var setContent = function (content, args) {\r\n                return SetSelectionContent.setContent(editor, content, args);\r\n            };\r\n            var getStart$1 = function (real) {\r\n                return getStart(editor.getBody(), getRng(), real);\r\n            };\r\n            var getEnd$1 = function (real) {\r\n                return getEnd(editor.getBody(), getRng(), real);\r\n            };\r\n            var getBookmark = function (type, normalized) {\r\n                return bookmarkManager.getBookmark(type, normalized);\r\n            };\r\n            var moveToBookmark = function (bookmark) {\r\n                return bookmarkManager.moveToBookmark(bookmark);\r\n            };\r\n            var select = function (node, content) {\r\n                select$1(dom, node, content).each(setRng);\r\n                return node;\r\n            };\r\n            var isCollapsed = function () {\r\n                var rng = getRng(), sel = getSel();\r\n                if (!rng || rng.item) {\r\n                    return false;\r\n                }\r\n                if (rng.compareEndPoints) {\r\n                    return rng.compareEndPoints('StartToEnd', rng) === 0;\r\n                }\r\n                return !sel || rng.collapsed;\r\n            };\r\n            var collapse = function (toStart) {\r\n                var rng = getRng();\r\n                rng.collapse(!!toStart);\r\n                setRng(rng);\r\n            };\r\n            var getSel = function () {\r\n                return win.getSelection ? win.getSelection() : win.document.selection;\r\n            };\r\n            var getRng = function () {\r\n                var selection, rng, elm, doc;\r\n                var tryCompareBoundaryPoints = function (how, sourceRange, destinationRange) {\r\n                    try {\r\n                        return sourceRange.compareBoundaryPoints(how, destinationRange);\r\n                    }\r\n                    catch (ex) {\r\n                        return -1;\r\n                    }\r\n                };\r\n                if (!win) {\r\n                    return null;\r\n                }\r\n                doc = win.document;\r\n                if (typeof doc === 'undefined' || doc === null) {\r\n                    return null;\r\n                }\r\n                if (editor.bookmark !== undefined && EditorFocus.hasFocus(editor) === false) {\r\n                    var bookmark = SelectionBookmark.getRng(editor);\r\n                    if (bookmark.isSome()) {\r\n                        return bookmark.map(function (r) {\r\n                            return EventProcessRanges.processRanges(editor, [r])[0];\r\n                        }).getOr(doc.createRange());\r\n                    }\r\n                }\r\n                try {\r\n                    if (selection = getSel()) {\r\n                        if (selection.rangeCount > 0) {\r\n                            rng = selection.getRangeAt(0);\r\n                        }\r\n                        else {\r\n                            rng = selection.createRange ? selection.createRange() : doc.createRange();\r\n                        }\r\n                    }\r\n                }\r\n                catch (ex) {\r\n                }\r\n                rng = EventProcessRanges.processRanges(editor, [rng])[0];\r\n                if (!rng) {\r\n                    rng = doc.createRange ? doc.createRange() : doc.body.createTextRange();\r\n                }\r\n                if (rng.setStart && rng.startContainer.nodeType === 9 && rng.collapsed) {\r\n                    elm = dom.getRoot();\r\n                    rng.setStart(elm, 0);\r\n                    rng.setEnd(elm, 0);\r\n                }\r\n                if (selectedRange && explicitRange) {\r\n                    if (tryCompareBoundaryPoints(rng.START_TO_START, rng, selectedRange) === 0 && tryCompareBoundaryPoints(rng.END_TO_END, rng, selectedRange) === 0) {\r\n                        rng = explicitRange;\r\n                    }\r\n                    else {\r\n                        selectedRange = null;\r\n                        explicitRange = null;\r\n                    }\r\n                }\r\n                return rng;\r\n            };\r\n            var setRng = function (rng, forward) {\r\n                var sel, node, evt;\r\n                if (!isValidRange(rng)) {\r\n                    return;\r\n                }\r\n                var ieRange = isNativeIeSelection(rng) ? rng : null;\r\n                if (ieRange) {\r\n                    explicitRange = null;\r\n                    try {\r\n                        ieRange.select();\r\n                    }\r\n                    catch (ex) {\r\n                    }\r\n                    return;\r\n                }\r\n                sel = getSel();\r\n                evt = editor.fire('SetSelectionRange', {\r\n                    range: rng,\r\n                    forward: forward\r\n                });\r\n                rng = evt.range;\r\n                if (sel) {\r\n                    explicitRange = rng;\r\n                    try {\r\n                        sel.removeAllRanges();\r\n                        sel.addRange(rng);\r\n                    }\r\n                    catch (ex) {\r\n                    }\r\n                    if (forward === false && sel.extend) {\r\n                        sel.collapse(rng.endContainer, rng.endOffset);\r\n                        sel.extend(rng.startContainer, rng.startOffset);\r\n                    }\r\n                    selectedRange = sel.rangeCount > 0 ? sel.getRangeAt(0) : null;\r\n                }\r\n                if (!rng.collapsed && rng.startContainer === rng.endContainer && sel.setBaseAndExtent && !Env.ie) {\r\n                    if (rng.endOffset - rng.startOffset < 2) {\r\n                        if (rng.startContainer.hasChildNodes()) {\r\n                            node = rng.startContainer.childNodes[rng.startOffset];\r\n                            if (node && node.tagName === 'IMG') {\r\n                                sel.setBaseAndExtent(rng.startContainer, rng.startOffset, rng.endContainer, rng.endOffset);\r\n                                if (sel.anchorNode !== rng.startContainer || sel.focusNode !== rng.endContainer) {\r\n                                    sel.setBaseAndExtent(node, 0, node, 1);\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                editor.fire('AfterSetSelectionRange', {\r\n                    range: rng,\r\n                    forward: forward\r\n                });\r\n            };\r\n            var setNode = function (elm) {\r\n                setContent(dom.getOuterHTML(elm));\r\n                return elm;\r\n            };\r\n            var getNode = function () {\r\n                return getNode$1(editor.getBody(), getRng());\r\n            };\r\n            var getSelectedBlocks$1 = function (startElm, endElm) {\r\n                return getSelectedBlocks(dom, getRng(), startElm, endElm);\r\n            };\r\n            var isForward = function () {\r\n                var sel = getSel();\r\n                var anchorRange, focusRange;\r\n                if (!sel || !sel.anchorNode || !sel.focusNode) {\r\n                    return true;\r\n                }\r\n                anchorRange = dom.createRng();\r\n                anchorRange.setStart(sel.anchorNode, sel.anchorOffset);\r\n                anchorRange.collapse(true);\r\n                focusRange = dom.createRng();\r\n                focusRange.setStart(sel.focusNode, sel.focusOffset);\r\n                focusRange.collapse(true);\r\n                return anchorRange.compareBoundaryPoints(anchorRange.START_TO_START, focusRange) <= 0;\r\n            };\r\n            var normalize = function () {\r\n                var rng = getRng();\r\n                var sel = getSel();\r\n                if (!MultiRange.hasMultipleRanges(sel) && hasAnyRanges(editor)) {\r\n                    var normRng = NormalizeRange.normalize(dom, rng);\r\n                    normRng.each(function (normRng) {\r\n                        setRng(normRng, isForward());\r\n                    });\r\n                    return normRng.getOr(rng);\r\n                }\r\n                return rng;\r\n            };\r\n            var selectorChanged = function (selector, callback) {\r\n                selectorChangedWithUnbind(selector, callback);\r\n                return exports;\r\n            };\r\n            var getScrollContainer = function () {\r\n                var scrollContainer;\r\n                var node = dom.getRoot();\r\n                while (node && node.nodeName !== 'BODY') {\r\n                    if (node.scrollHeight > node.clientHeight) {\r\n                        scrollContainer = node;\r\n                        break;\r\n                    }\r\n                    node = node.parentNode;\r\n                }\r\n                return scrollContainer;\r\n            };\r\n            var scrollIntoView = function (elm, alignToTop) {\r\n                return ScrollIntoView.scrollElementIntoView(editor, elm, alignToTop);\r\n            };\r\n            var placeCaretAt = function (clientX, clientY) {\r\n                return setRng(CaretRangeFromPoint.fromPoint(clientX, clientY, editor.getDoc()));\r\n            };\r\n            var getBoundingClientRect = function () {\r\n                var rng = getRng();\r\n                return rng.collapsed ? CaretPosition$1.fromRangeStart(rng).getClientRects()[0] : rng.getBoundingClientRect();\r\n            };\r\n            var destroy = function () {\r\n                win = selectedRange = explicitRange = null;\r\n                controlSelection.destroy();\r\n            };\r\n            var exports = {\r\n                bookmarkManager: null,\r\n                controlSelection: null,\r\n                dom: dom,\r\n                win: win,\r\n                serializer: serializer,\r\n                editor: editor,\r\n                collapse: collapse,\r\n                setCursorLocation: setCursorLocation,\r\n                getContent: getContent,\r\n                setContent: setContent,\r\n                getBookmark: getBookmark,\r\n                moveToBookmark: moveToBookmark,\r\n                select: select,\r\n                isCollapsed: isCollapsed,\r\n                isForward: isForward,\r\n                setNode: setNode,\r\n                getNode: getNode,\r\n                getSel: getSel,\r\n                setRng: setRng,\r\n                getRng: getRng,\r\n                getStart: getStart$1,\r\n                getEnd: getEnd$1,\r\n                getSelectedBlocks: getSelectedBlocks$1,\r\n                normalize: normalize,\r\n                selectorChanged: selectorChanged,\r\n                selectorChangedWithUnbind: selectorChangedWithUnbind,\r\n                getScrollContainer: getScrollContainer,\r\n                scrollIntoView: scrollIntoView,\r\n                placeCaretAt: placeCaretAt,\r\n                getBoundingClientRect: getBoundingClientRect,\r\n                destroy: destroy\r\n            };\r\n            bookmarkManager = BookmarkManager$1(exports);\r\n            controlSelection = ControlSelection(exports, editor);\r\n            exports.bookmarkManager = bookmarkManager;\r\n            exports.controlSelection = controlSelection;\r\n            return exports;\r\n        };\r\n        var isText$8 = NodeType.isText;\r\n        var startsWithCaretContainer$1 = function (node) {\r\n            return isText$8(node) && node.data[0] === Zwsp.ZWSP;\r\n        };\r\n        var endsWithCaretContainer$1 = function (node) {\r\n            return isText$8(node) && node.data[node.data.length - 1] === Zwsp.ZWSP;\r\n        };\r\n        var createZwsp = function (node) {\r\n            return node.ownerDocument.createTextNode(Zwsp.ZWSP);\r\n        };\r\n        var insertBefore = function (node) {\r\n            if (isText$8(node.previousSibling)) {\r\n                if (endsWithCaretContainer$1(node.previousSibling)) {\r\n                    return node.previousSibling;\r\n                }\r\n                else {\r\n                    node.previousSibling.appendData(Zwsp.ZWSP);\r\n                    return node.previousSibling;\r\n                }\r\n            }\r\n            else if (isText$8(node)) {\r\n                if (startsWithCaretContainer$1(node)) {\r\n                    return node;\r\n                }\r\n                else {\r\n                    node.insertData(0, Zwsp.ZWSP);\r\n                    return node;\r\n                }\r\n            }\r\n            else {\r\n                var newNode = createZwsp(node);\r\n                node.parentNode.insertBefore(newNode, node);\r\n                return newNode;\r\n            }\r\n        };\r\n        var insertAfter = function (node) {\r\n            if (isText$8(node.nextSibling)) {\r\n                if (startsWithCaretContainer$1(node.nextSibling)) {\r\n                    return node.nextSibling;\r\n                }\r\n                else {\r\n                    node.nextSibling.insertData(0, Zwsp.ZWSP);\r\n                    return node.nextSibling;\r\n                }\r\n            }\r\n            else if (isText$8(node)) {\r\n                if (endsWithCaretContainer$1(node)) {\r\n                    return node;\r\n                }\r\n                else {\r\n                    node.appendData(Zwsp.ZWSP);\r\n                    return node;\r\n                }\r\n            }\r\n            else {\r\n                var newNode = createZwsp(node);\r\n                if (node.nextSibling) {\r\n                    node.parentNode.insertBefore(newNode, node.nextSibling);\r\n                }\r\n                else {\r\n                    node.parentNode.appendChild(newNode);\r\n                }\r\n                return newNode;\r\n            }\r\n        };\r\n        var insertInline$1 = function (before, node) {\r\n            return before ? insertBefore(node) : insertAfter(node);\r\n        };\r\n        var insertInlineBefore = curry(insertInline$1, true);\r\n        var insertInlineAfter = curry(insertInline$1, false);\r\n        var insertInlinePos = function (pos, before) {\r\n            if (NodeType.isText(pos.container())) {\r\n                return insertInline$1(before, pos.container());\r\n            }\r\n            else {\r\n                return insertInline$1(before, pos.getNode());\r\n            }\r\n        };\r\n        var isPosCaretContainer = function (pos, caret) {\r\n            var caretNode = caret.get();\r\n            return caretNode && pos.container() === caretNode && isCaretContainerInline(caretNode);\r\n        };\r\n        var renderCaret = function (caret, location) {\r\n            return location.fold(function (element) {\r\n                CaretContainerRemove.remove(caret.get());\r\n                var text = insertInlineBefore(element);\r\n                caret.set(text);\r\n                return Option.some(CaretPosition$1(text, text.length - 1));\r\n            }, function (element) {\r\n                return CaretFinder.firstPositionIn(element).map(function (pos) {\r\n                    if (!isPosCaretContainer(pos, caret)) {\r\n                        CaretContainerRemove.remove(caret.get());\r\n                        var text = insertInlinePos(pos, true);\r\n                        caret.set(text);\r\n                        return CaretPosition$1(text, 1);\r\n                    }\r\n                    else {\r\n                        return CaretPosition$1(caret.get(), 1);\r\n                    }\r\n                });\r\n            }, function (element) {\r\n                return CaretFinder.lastPositionIn(element).map(function (pos) {\r\n                    if (!isPosCaretContainer(pos, caret)) {\r\n                        CaretContainerRemove.remove(caret.get());\r\n                        var text = insertInlinePos(pos, false);\r\n                        caret.set(text);\r\n                        return CaretPosition$1(text, text.length - 1);\r\n                    }\r\n                    else {\r\n                        return CaretPosition$1(caret.get(), caret.get().length - 1);\r\n                    }\r\n                });\r\n            }, function (element) {\r\n                CaretContainerRemove.remove(caret.get());\r\n                var text = insertInlineAfter(element);\r\n                caret.set(text);\r\n                return Option.some(CaretPosition$1(text, 1));\r\n            });\r\n        };\r\n        var BoundaryCaret = { renderCaret: renderCaret };\r\n        var strongRtl = /[\\u0591-\\u07FF\\uFB1D-\\uFDFF\\uFE70-\\uFEFC]/;\r\n        var hasStrongRtl = function (text) {\r\n            return strongRtl.test(text);\r\n        };\r\n        var isInlineTarget = function (editor, elm) {\r\n            var selector = getString(editor, 'inline_boundaries_selector').getOr('a[href],code');\r\n            return is$1(Element.fromDom(elm), selector);\r\n        };\r\n        var isRtl$1 = function (element) {\r\n            return DOMUtils$1.DOM.getStyle(element, 'direction', true) === 'rtl' || hasStrongRtl(element.textContent);\r\n        };\r\n        var findInlineParents = function (isInlineTarget, rootNode, pos) {\r\n            return filter(DOMUtils$1.DOM.getParents(pos.container(), '*', rootNode), isInlineTarget);\r\n        };\r\n        var findRootInline = function (isInlineTarget, rootNode, pos) {\r\n            var parents = findInlineParents(isInlineTarget, rootNode, pos);\r\n            return Option.from(parents[parents.length - 1]);\r\n        };\r\n        var hasSameParentBlock = function (rootNode, node1, node2) {\r\n            var block1 = getParentBlock(node1, rootNode);\r\n            var block2 = getParentBlock(node2, rootNode);\r\n            return block1 && block1 === block2;\r\n        };\r\n        var isAtZwsp = function (pos) {\r\n            return isBeforeInline(pos) || isAfterInline(pos);\r\n        };\r\n        var normalizePosition = function (forward, pos) {\r\n            if (!pos) {\r\n                return pos;\r\n            }\r\n            var container = pos.container(), offset = pos.offset();\r\n            if (forward) {\r\n                if (isCaretContainerInline(container)) {\r\n                    if (NodeType.isText(container.nextSibling)) {\r\n                        return CaretPosition$1(container.nextSibling, 0);\r\n                    }\r\n                    else {\r\n                        return CaretPosition$1.after(container);\r\n                    }\r\n                }\r\n                else {\r\n                    return isBeforeInline(pos) ? CaretPosition$1(container, offset + 1) : pos;\r\n                }\r\n            }\r\n            else {\r\n                if (isCaretContainerInline(container)) {\r\n                    if (NodeType.isText(container.previousSibling)) {\r\n                        return CaretPosition$1(container.previousSibling, container.previousSibling.data.length);\r\n                    }\r\n                    else {\r\n                        return CaretPosition$1.before(container);\r\n                    }\r\n                }\r\n                else {\r\n                    return isAfterInline(pos) ? CaretPosition$1(container, offset - 1) : pos;\r\n                }\r\n            }\r\n        };\r\n        var normalizeForwards = curry(normalizePosition, true);\r\n        var normalizeBackwards = curry(normalizePosition, false);\r\n        var InlineUtils = {\r\n            isInlineTarget: isInlineTarget,\r\n            findRootInline: findRootInline,\r\n            isRtl: isRtl$1,\r\n            isAtZwsp: isAtZwsp,\r\n            normalizePosition: normalizePosition,\r\n            normalizeForwards: normalizeForwards,\r\n            normalizeBackwards: normalizeBackwards,\r\n            hasSameParentBlock: hasSameParentBlock\r\n        };\r\n        var evaluateUntil = function (fns, args) {\r\n            for (var i = 0; i < fns.length; i++) {\r\n                var result = fns[i].apply(null, args);\r\n                if (result.isSome()) {\r\n                    return result;\r\n                }\r\n            }\r\n            return Option.none();\r\n        };\r\n        var LazyEvaluator = { evaluateUntil: evaluateUntil };\r\n        var Location = Adt.generate([\r\n            { before: ['element'] },\r\n            { start: ['element'] },\r\n            { end: ['element'] },\r\n            { after: ['element'] }\r\n        ]);\r\n        var rescope = function (rootNode, node) {\r\n            var parentBlock = getParentBlock(node, rootNode);\r\n            return parentBlock ? parentBlock : rootNode;\r\n        };\r\n        var before$3 = function (isInlineTarget, rootNode, pos) {\r\n            var nPos = InlineUtils.normalizeForwards(pos);\r\n            var scope = rescope(rootNode, nPos.container());\r\n            return InlineUtils.findRootInline(isInlineTarget, scope, nPos).fold(function () {\r\n                return CaretFinder.nextPosition(scope, nPos).bind(curry(InlineUtils.findRootInline, isInlineTarget, scope)).map(function (inline) {\r\n                    return Location.before(inline);\r\n                });\r\n            }, Option.none);\r\n        };\r\n        var isNotInsideFormatCaretContainer = function (rootNode, elm) {\r\n            return getParentCaretContainer(rootNode, elm) === null;\r\n        };\r\n        var findInsideRootInline = function (isInlineTarget, rootNode, pos) {\r\n            return InlineUtils.findRootInline(isInlineTarget, rootNode, pos).filter(curry(isNotInsideFormatCaretContainer, rootNode));\r\n        };\r\n        var start$1 = function (isInlineTarget, rootNode, pos) {\r\n            var nPos = InlineUtils.normalizeBackwards(pos);\r\n            return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\r\n                var prevPos = CaretFinder.prevPosition(inline, nPos);\r\n                return prevPos.isNone() ? Option.some(Location.start(inline)) : Option.none();\r\n            });\r\n        };\r\n        var end = function (isInlineTarget, rootNode, pos) {\r\n            var nPos = InlineUtils.normalizeForwards(pos);\r\n            return findInsideRootInline(isInlineTarget, rootNode, nPos).bind(function (inline) {\r\n                var nextPos = CaretFinder.nextPosition(inline, nPos);\r\n                return nextPos.isNone() ? Option.some(Location.end(inline)) : Option.none();\r\n            });\r\n        };\r\n        var after$2 = function (isInlineTarget, rootNode, pos) {\r\n            var nPos = InlineUtils.normalizeBackwards(pos);\r\n            var scope = rescope(rootNode, nPos.container());\r\n            return InlineUtils.findRootInline(isInlineTarget, scope, nPos).fold(function () {\r\n                return CaretFinder.prevPosition(scope, nPos).bind(curry(InlineUtils.findRootInline, isInlineTarget, scope)).map(function (inline) {\r\n                    return Location.after(inline);\r\n                });\r\n            }, Option.none);\r\n        };\r\n        var isValidLocation = function (location) {\r\n            return InlineUtils.isRtl(getElement(location)) === false;\r\n        };\r\n        var readLocation = function (isInlineTarget, rootNode, pos) {\r\n            var location = LazyEvaluator.evaluateUntil([\r\n                before$3,\r\n                start$1,\r\n                end,\r\n                after$2\r\n            ], [\r\n                isInlineTarget,\r\n                rootNode,\r\n                pos\r\n            ]);\r\n            return location.filter(isValidLocation);\r\n        };\r\n        var getElement = function (location) {\r\n            return location.fold(identity, identity, identity, identity);\r\n        };\r\n        var getName = function (location) {\r\n            return location.fold(constant('before'), constant('start'), constant('end'), constant('after'));\r\n        };\r\n        var outside = function (location) {\r\n            return location.fold(Location.before, Location.before, Location.after, Location.after);\r\n        };\r\n        var inside = function (location) {\r\n            return location.fold(Location.start, Location.start, Location.end, Location.end);\r\n        };\r\n        var isEq$5 = function (location1, location2) {\r\n            return getName(location1) === getName(location2) && getElement(location1) === getElement(location2);\r\n        };\r\n        var betweenInlines = function (forward, isInlineTarget, rootNode, from, to, location) {\r\n            return liftN([\r\n                InlineUtils.findRootInline(isInlineTarget, rootNode, from),\r\n                InlineUtils.findRootInline(isInlineTarget, rootNode, to)\r\n            ], function (fromInline, toInline) {\r\n                if (fromInline !== toInline && InlineUtils.hasSameParentBlock(rootNode, fromInline, toInline)) {\r\n                    return Location.after(forward ? fromInline : toInline);\r\n                }\r\n                else {\r\n                    return location;\r\n                }\r\n            }).getOr(location);\r\n        };\r\n        var skipNoMovement = function (fromLocation, toLocation) {\r\n            return fromLocation.fold(constant(true), function (fromLocation) {\r\n                return !isEq$5(fromLocation, toLocation);\r\n            });\r\n        };\r\n        var findLocationTraverse = function (forward, isInlineTarget, rootNode, fromLocation, pos) {\r\n            var from = InlineUtils.normalizePosition(forward, pos);\r\n            var to = CaretFinder.fromPosition(forward, rootNode, from).map(curry(InlineUtils.normalizePosition, forward));\r\n            var location = to.fold(function () {\r\n                return fromLocation.map(outside);\r\n            }, function (to) {\r\n                return readLocation(isInlineTarget, rootNode, to).map(curry(betweenInlines, forward, isInlineTarget, rootNode, from, to)).filter(curry(skipNoMovement, fromLocation));\r\n            });\r\n            return location.filter(isValidLocation);\r\n        };\r\n        var findLocationSimple = function (forward, location) {\r\n            if (forward) {\r\n                return location.fold(compose(Option.some, Location.start), Option.none, compose(Option.some, Location.after), Option.none);\r\n            }\r\n            else {\r\n                return location.fold(Option.none, compose(Option.some, Location.before), Option.none, compose(Option.some, Location.end));\r\n            }\r\n        };\r\n        var findLocation = function (forward, isInlineTarget, rootNode, pos) {\r\n            var from = InlineUtils.normalizePosition(forward, pos);\r\n            var fromLocation = readLocation(isInlineTarget, rootNode, from);\r\n            return readLocation(isInlineTarget, rootNode, from).bind(curry(findLocationSimple, forward)).orThunk(function () {\r\n                return findLocationTraverse(forward, isInlineTarget, rootNode, fromLocation, pos);\r\n            });\r\n        };\r\n        var BoundaryLocation = {\r\n            readLocation: readLocation,\r\n            findLocation: findLocation,\r\n            prevLocation: curry(findLocation, false),\r\n            nextLocation: curry(findLocation, true),\r\n            getElement: getElement,\r\n            outside: outside,\r\n            inside: inside\r\n        };\r\n        var hasSelectionModifyApi = function (editor) {\r\n            return isFunction(editor.selection.getSel().modify);\r\n        };\r\n        var moveRel = function (forward, selection, pos) {\r\n            var delta = forward ? 1 : -1;\r\n            selection.setRng(CaretPosition$1(pos.container(), pos.offset() + delta).toRange());\r\n            selection.getSel().modify('move', forward ? 'forward' : 'backward', 'word');\r\n            return true;\r\n        };\r\n        var moveByWord = function (forward, editor) {\r\n            var rng = editor.selection.getRng();\r\n            var pos = forward ? CaretPosition$1.fromRangeEnd(rng) : CaretPosition$1.fromRangeStart(rng);\r\n            if (!hasSelectionModifyApi(editor)) {\r\n                return false;\r\n            }\r\n            else if (forward && isBeforeInline(pos)) {\r\n                return moveRel(true, editor.selection, pos);\r\n            }\r\n            else if (!forward && isAfterInline(pos)) {\r\n                return moveRel(false, editor.selection, pos);\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var WordSelection = {\r\n            hasSelectionModifyApi: hasSelectionModifyApi,\r\n            moveByWord: moveByWord\r\n        };\r\n        var setCaretPosition = function (editor, pos) {\r\n            var rng = editor.dom.createRng();\r\n            rng.setStart(pos.container(), pos.offset());\r\n            rng.setEnd(pos.container(), pos.offset());\r\n            editor.selection.setRng(rng);\r\n        };\r\n        var isFeatureEnabled = function (editor) {\r\n            return editor.settings.inline_boundaries !== false;\r\n        };\r\n        var setSelected = function (state, elm) {\r\n            if (state) {\r\n                elm.setAttribute('data-mce-selected', 'inline-boundary');\r\n            }\r\n            else {\r\n                elm.removeAttribute('data-mce-selected');\r\n            }\r\n        };\r\n        var renderCaretLocation = function (editor, caret, location) {\r\n            return BoundaryCaret.renderCaret(caret, location).map(function (pos) {\r\n                setCaretPosition(editor, pos);\r\n                return location;\r\n            });\r\n        };\r\n        var findLocation$1 = function (editor, caret, forward) {\r\n            var rootNode = editor.getBody();\r\n            var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\r\n            var location = BoundaryLocation.findLocation(forward, isInlineTarget, rootNode, from);\r\n            return location.bind(function (location) {\r\n                return renderCaretLocation(editor, caret, location);\r\n            });\r\n        };\r\n        var toggleInlines = function (isInlineTarget, dom, elms) {\r\n            var selectedInlines = filter(dom.select('*[data-mce-selected=\"inline-boundary\"]'), isInlineTarget);\r\n            var targetInlines = filter(elms, isInlineTarget);\r\n            each(difference(selectedInlines, targetInlines), curry(setSelected, false));\r\n            each(difference(targetInlines, selectedInlines), curry(setSelected, true));\r\n        };\r\n        var safeRemoveCaretContainer = function (editor, caret) {\r\n            if (editor.selection.isCollapsed() && editor.composing !== true && caret.get()) {\r\n                var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n                if (CaretPosition$1.isTextPosition(pos) && InlineUtils.isAtZwsp(pos) === false) {\r\n                    setCaretPosition(editor, CaretContainerRemove.removeAndReposition(caret.get(), pos));\r\n                    caret.set(null);\r\n                }\r\n            }\r\n        };\r\n        var renderInsideInlineCaret = function (isInlineTarget, editor, caret, elms) {\r\n            if (editor.selection.isCollapsed()) {\r\n                var inlines = filter(elms, isInlineTarget);\r\n                each(inlines, function (inline) {\r\n                    var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n                    BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), pos).bind(function (location) {\r\n                        return renderCaretLocation(editor, caret, location);\r\n                    });\r\n                });\r\n            }\r\n        };\r\n        var move$1 = function (editor, caret, forward) {\r\n            return function () {\r\n                return isFeatureEnabled(editor) ? findLocation$1(editor, caret, forward).isSome() : false;\r\n            };\r\n        };\r\n        var moveWord = function (forward, editor, caret) {\r\n            return function () {\r\n                return isFeatureEnabled(editor) ? WordSelection.moveByWord(forward, editor) : false;\r\n            };\r\n        };\r\n        var setupSelectedState = function (editor) {\r\n            var caret = Cell(null);\r\n            var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\r\n            editor.on('NodeChange', function (e) {\r\n                if (isFeatureEnabled(editor)) {\r\n                    toggleInlines(isInlineTarget, editor.dom, e.parents);\r\n                    safeRemoveCaretContainer(editor, caret);\r\n                    renderInsideInlineCaret(isInlineTarget, editor, caret, e.parents);\r\n                }\r\n            });\r\n            return caret;\r\n        };\r\n        var moveNextWord = curry(moveWord, true);\r\n        var movePrevWord = curry(moveWord, false);\r\n        var BoundarySelection = {\r\n            move: move$1,\r\n            moveNextWord: moveNextWord,\r\n            movePrevWord: movePrevWord,\r\n            setupSelectedState: setupSelectedState,\r\n            setCaretPosition: setCaretPosition\r\n        };\r\n        var BreakType;\r\n        (function (BreakType) {\r\n            BreakType[BreakType['Br'] = 0] = 'Br';\r\n            BreakType[BreakType['Block'] = 1] = 'Block';\r\n            BreakType[BreakType['Wrap'] = 2] = 'Wrap';\r\n            BreakType[BreakType['Eol'] = 3] = 'Eol';\r\n        }(BreakType || (BreakType = {})));\r\n        var flip = function (direction, positions) {\r\n            return direction === HDirection.Backwards ? positions.reverse() : positions;\r\n        };\r\n        var walk$3 = function (direction, caretWalker, pos) {\r\n            return direction === HDirection.Forwards ? caretWalker.next(pos) : caretWalker.prev(pos);\r\n        };\r\n        var getBreakType = function (scope, direction, currentPos, nextPos) {\r\n            if (NodeType.isBr(nextPos.getNode(direction === HDirection.Forwards))) {\r\n                return BreakType.Br;\r\n            }\r\n            else if (isInSameBlock(currentPos, nextPos) === false) {\r\n                return BreakType.Block;\r\n            }\r\n            else {\r\n                return BreakType.Wrap;\r\n            }\r\n        };\r\n        var getPositionsUntil = function (predicate, direction, scope, start) {\r\n            var caretWalker = CaretWalker(scope);\r\n            var currentPos = start, nextPos;\r\n            var positions = [];\r\n            while (currentPos) {\r\n                nextPos = walk$3(direction, caretWalker, currentPos);\r\n                if (!nextPos) {\r\n                    break;\r\n                }\r\n                if (NodeType.isBr(nextPos.getNode(false))) {\r\n                    if (direction === HDirection.Forwards) {\r\n                        return {\r\n                            positions: flip(direction, positions).concat([nextPos]),\r\n                            breakType: BreakType.Br,\r\n                            breakAt: Option.some(nextPos)\r\n                        };\r\n                    }\r\n                    else {\r\n                        return {\r\n                            positions: flip(direction, positions),\r\n                            breakType: BreakType.Br,\r\n                            breakAt: Option.some(nextPos)\r\n                        };\r\n                    }\r\n                }\r\n                if (!nextPos.isVisible()) {\r\n                    currentPos = nextPos;\r\n                    continue;\r\n                }\r\n                if (predicate(currentPos, nextPos)) {\r\n                    var breakType = getBreakType(scope, direction, currentPos, nextPos);\r\n                    return {\r\n                        positions: flip(direction, positions),\r\n                        breakType: breakType,\r\n                        breakAt: Option.some(nextPos)\r\n                    };\r\n                }\r\n                positions.push(nextPos);\r\n                currentPos = nextPos;\r\n            }\r\n            return {\r\n                positions: flip(direction, positions),\r\n                breakType: BreakType.Eol,\r\n                breakAt: Option.none()\r\n            };\r\n        };\r\n        var getAdjacentLinePositions = function (direction, getPositionsUntilBreak, scope, start) {\r\n            return getPositionsUntilBreak(scope, start).breakAt.map(function (pos) {\r\n                var positions = getPositionsUntilBreak(scope, pos).positions;\r\n                return direction === HDirection.Backwards ? positions.concat(pos) : [pos].concat(positions);\r\n            }).getOr([]);\r\n        };\r\n        var findClosestHorizontalPositionFromPoint = function (positions, x) {\r\n            return foldl(positions, function (acc, newPos) {\r\n                return acc.fold(function () {\r\n                    return Option.some(newPos);\r\n                }, function (lastPos) {\r\n                    return liftN([\r\n                        head(lastPos.getClientRects()),\r\n                        head(newPos.getClientRects())\r\n                    ], function (lastRect, newRect) {\r\n                        var lastDist = Math.abs(x - lastRect.left);\r\n                        var newDist = Math.abs(x - newRect.left);\r\n                        return newDist <= lastDist ? newPos : lastPos;\r\n                    }).or(acc);\r\n                });\r\n            }, Option.none());\r\n        };\r\n        var findClosestHorizontalPosition = function (positions, pos) {\r\n            return head(pos.getClientRects()).bind(function (targetRect) {\r\n                return findClosestHorizontalPositionFromPoint(positions, targetRect.left);\r\n            });\r\n        };\r\n        var getPositionsUntilPreviousLine = curry(getPositionsUntil, CaretPosition.isAbove, -1);\r\n        var getPositionsUntilNextLine = curry(getPositionsUntil, CaretPosition.isBelow, 1);\r\n        var isAtFirstLine = function (scope, pos) {\r\n            return getPositionsUntilPreviousLine(scope, pos).breakAt.isNone();\r\n        };\r\n        var isAtLastLine = function (scope, pos) {\r\n            return getPositionsUntilNextLine(scope, pos).breakAt.isNone();\r\n        };\r\n        var getPositionsAbove = curry(getAdjacentLinePositions, -1, getPositionsUntilPreviousLine);\r\n        var getPositionsBelow = curry(getAdjacentLinePositions, 1, getPositionsUntilNextLine);\r\n        var getFirstLinePositions = function (scope) {\r\n            return CaretFinder.firstPositionIn(scope).map(function (pos) {\r\n                return [pos].concat(getPositionsUntilNextLine(scope, pos).positions);\r\n            }).getOr([]);\r\n        };\r\n        var getLastLinePositions = function (scope) {\r\n            return CaretFinder.lastPositionIn(scope).map(function (pos) {\r\n                return getPositionsUntilPreviousLine(scope, pos).positions.concat(pos);\r\n            }).getOr([]);\r\n        };\r\n        var isContentEditableFalse$b = NodeType.isContentEditableFalse;\r\n        var getSelectedNode$1 = getSelectedNode;\r\n        var moveToCeFalseHorizontally = function (direction, editor, getNextPosFn, range) {\r\n            var forwards = direction === HDirection.Forwards;\r\n            var isBeforeContentEditableFalseFn = forwards ? isBeforeContentEditableFalse : isAfterContentEditableFalse;\r\n            if (!range.collapsed) {\r\n                var node = getSelectedNode$1(range);\r\n                if (isContentEditableFalse$b(node)) {\r\n                    return showCaret(direction, editor, node, direction === HDirection.Backwards, true);\r\n                }\r\n            }\r\n            var rangeIsInContainerBlock = isRangeInCaretContainerBlock(range);\r\n            var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\r\n            if (isBeforeContentEditableFalseFn(caretPosition)) {\r\n                return selectNode(editor, caretPosition.getNode(!forwards));\r\n            }\r\n            var nextCaretPosition = InlineUtils.normalizePosition(forwards, getNextPosFn(caretPosition));\r\n            if (!nextCaretPosition) {\r\n                if (rangeIsInContainerBlock) {\r\n                    return range;\r\n                }\r\n                return null;\r\n            }\r\n            if (isBeforeContentEditableFalseFn(nextCaretPosition)) {\r\n                return showCaret(direction, editor, nextCaretPosition.getNode(!forwards), forwards, true);\r\n            }\r\n            var peekCaretPosition = getNextPosFn(nextCaretPosition);\r\n            if (peekCaretPosition && isBeforeContentEditableFalseFn(peekCaretPosition)) {\r\n                if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\r\n                    return showCaret(direction, editor, peekCaretPosition.getNode(!forwards), forwards, true);\r\n                }\r\n            }\r\n            if (rangeIsInContainerBlock) {\r\n                return renderRangeCaret(editor, nextCaretPosition.toRange(), true);\r\n            }\r\n            return null;\r\n        };\r\n        var moveToCeFalseVertically = function (direction, editor, walkerFn, range) {\r\n            var caretPosition, linePositions, nextLinePositions;\r\n            var closestNextLineRect, caretClientRect, clientX;\r\n            var dist1, dist2, contentEditableFalseNode;\r\n            contentEditableFalseNode = getSelectedNode$1(range);\r\n            caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\r\n            linePositions = walkerFn(editor.getBody(), isAboveLine(1), caretPosition);\r\n            nextLinePositions = filter(linePositions, isLine(1));\r\n            caretClientRect = ArrUtils.last(caretPosition.getClientRects());\r\n            if (isBeforeContentEditableFalse(caretPosition) || isBeforeTable(caretPosition)) {\r\n                contentEditableFalseNode = caretPosition.getNode();\r\n            }\r\n            if (isAfterContentEditableFalse(caretPosition) || isAfterTable(caretPosition)) {\r\n                contentEditableFalseNode = caretPosition.getNode(true);\r\n            }\r\n            if (!caretClientRect) {\r\n                return null;\r\n            }\r\n            clientX = caretClientRect.left;\r\n            closestNextLineRect = findClosestClientRect(nextLinePositions, clientX);\r\n            if (closestNextLineRect) {\r\n                if (isContentEditableFalse$b(closestNextLineRect.node)) {\r\n                    dist1 = Math.abs(clientX - closestNextLineRect.left);\r\n                    dist2 = Math.abs(clientX - closestNextLineRect.right);\r\n                    return showCaret(direction, editor, closestNextLineRect.node, dist1 < dist2, true);\r\n                }\r\n            }\r\n            if (contentEditableFalseNode) {\r\n                var caretPositions = positionsUntil(direction, editor.getBody(), isAboveLine(1), contentEditableFalseNode);\r\n                closestNextLineRect = findClosestClientRect(filter(caretPositions, isLine(1)), clientX);\r\n                if (closestNextLineRect) {\r\n                    return renderRangeCaret(editor, closestNextLineRect.position.toRange(), true);\r\n                }\r\n                closestNextLineRect = ArrUtils.last(filter(caretPositions, isLine(0)));\r\n                if (closestNextLineRect) {\r\n                    return renderRangeCaret(editor, closestNextLineRect.position.toRange(), true);\r\n                }\r\n            }\r\n        };\r\n        var createTextBlock = function (editor) {\r\n            var textBlock = editor.dom.create(Settings.getForcedRootBlock(editor));\r\n            if (!Env.ie || Env.ie >= 11) {\r\n                textBlock.innerHTML = '<br data-mce-bogus=\"1\">';\r\n            }\r\n            return textBlock;\r\n        };\r\n        var exitPreBlock = function (editor, direction, range) {\r\n            var pre, caretPos, newBlock;\r\n            var caretWalker = CaretWalker(editor.getBody());\r\n            var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\r\n            var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\r\n            if (range.collapsed && editor.settings.forced_root_block) {\r\n                pre = editor.dom.getParent(range.startContainer, 'PRE');\r\n                if (!pre) {\r\n                    return;\r\n                }\r\n                if (direction === 1) {\r\n                    caretPos = getNextVisualCaretPosition(CaretPosition$1.fromRangeStart(range));\r\n                }\r\n                else {\r\n                    caretPos = getPrevVisualCaretPosition(CaretPosition$1.fromRangeStart(range));\r\n                }\r\n                if (!caretPos) {\r\n                    newBlock = createTextBlock(editor);\r\n                    if (direction === 1) {\r\n                        editor.$(pre).after(newBlock);\r\n                    }\r\n                    else {\r\n                        editor.$(pre).before(newBlock);\r\n                    }\r\n                    editor.selection.select(newBlock, true);\r\n                    editor.selection.collapse();\r\n                }\r\n            }\r\n        };\r\n        var getHorizontalRange = function (editor, forward) {\r\n            var caretWalker = CaretWalker(editor.getBody());\r\n            var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\r\n            var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\r\n            var newRange;\r\n            var direction = forward ? HDirection.Forwards : HDirection.Backwards;\r\n            var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;\r\n            var range = editor.selection.getRng();\r\n            newRange = moveToCeFalseHorizontally(direction, editor, getNextPosFn, range);\r\n            if (newRange) {\r\n                return newRange;\r\n            }\r\n            newRange = exitPreBlock(editor, direction, range);\r\n            if (newRange) {\r\n                return newRange;\r\n            }\r\n            return null;\r\n        };\r\n        var getVerticalRange = function (editor, down) {\r\n            var newRange;\r\n            var direction = down ? 1 : -1;\r\n            var walkerFn = down ? downUntil : upUntil;\r\n            var range = editor.selection.getRng();\r\n            newRange = moveToCeFalseVertically(direction, editor, walkerFn, range);\r\n            if (newRange) {\r\n                return newRange;\r\n            }\r\n            newRange = exitPreBlock(editor, direction, range);\r\n            if (newRange) {\r\n                return newRange;\r\n            }\r\n            return null;\r\n        };\r\n        var moveH = function (editor, forward) {\r\n            return function () {\r\n                var newRng = getHorizontalRange(editor, forward);\r\n                if (newRng) {\r\n                    editor.selection.setRng(newRng);\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            };\r\n        };\r\n        var moveV = function (editor, down) {\r\n            return function () {\r\n                var newRng = getVerticalRange(editor, down);\r\n                if (newRng) {\r\n                    editor.selection.setRng(newRng);\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            };\r\n        };\r\n        var isCefPosition = function (forward) {\r\n            return function (pos) {\r\n                return forward ? isAfterContentEditableFalse(pos) : isBeforeContentEditableFalse(pos);\r\n            };\r\n        };\r\n        var moveToLineEndPoint = function (editor, forward) {\r\n            return function () {\r\n                var from = forward ? CaretPosition$1.fromRangeEnd(editor.selection.getRng()) : CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n                var result = forward ? getPositionsUntilNextLine(editor.getBody(), from) : getPositionsUntilPreviousLine(editor.getBody(), from);\r\n                var to = forward ? last(result.positions) : head(result.positions);\r\n                return to.filter(isCefPosition(forward)).fold(constant(false), function (pos) {\r\n                    editor.selection.setRng(pos.toRange());\r\n                    return true;\r\n                });\r\n            };\r\n        };\r\n        var deflate = function (rect, delta) {\r\n            return {\r\n                left: rect.left - delta,\r\n                top: rect.top - delta,\r\n                right: rect.right + delta * 2,\r\n                bottom: rect.bottom + delta * 2,\r\n                width: rect.width + delta,\r\n                height: rect.height + delta\r\n            };\r\n        };\r\n        var getCorners = function (getYAxisValue, tds) {\r\n            return bind(tds, function (td) {\r\n                var rect = deflate(clone$1(td.getBoundingClientRect()), -1);\r\n                return [\r\n                    {\r\n                        x: rect.left,\r\n                        y: getYAxisValue(rect),\r\n                        cell: td\r\n                    },\r\n                    {\r\n                        x: rect.right,\r\n                        y: getYAxisValue(rect),\r\n                        cell: td\r\n                    }\r\n                ];\r\n            });\r\n        };\r\n        var findClosestCorner = function (corners, x, y) {\r\n            return foldl(corners, function (acc, newCorner) {\r\n                return acc.fold(function () {\r\n                    return Option.some(newCorner);\r\n                }, function (oldCorner) {\r\n                    var oldDist = Math.sqrt(Math.abs(oldCorner.x - x) + Math.abs(oldCorner.y - y));\r\n                    var newDist = Math.sqrt(Math.abs(newCorner.x - x) + Math.abs(newCorner.y - y));\r\n                    return Option.some(newDist < oldDist ? newCorner : oldCorner);\r\n                });\r\n            }, Option.none());\r\n        };\r\n        var getClosestCell = function (getYAxisValue, isTargetCorner, table, x, y) {\r\n            var cells = descendants$1(Element.fromDom(table), 'td,th,caption').map(function (e) {\r\n                return e.dom();\r\n            });\r\n            var corners = filter(getCorners(getYAxisValue, cells), function (corner) {\r\n                return isTargetCorner(corner, y);\r\n            });\r\n            return findClosestCorner(corners, x, y).map(function (corner) {\r\n                return corner.cell;\r\n            });\r\n        };\r\n        var getBottomValue = function (rect) {\r\n            return rect.bottom;\r\n        };\r\n        var getTopValue = function (rect) {\r\n            return rect.top;\r\n        };\r\n        var isAbove$1 = function (corner, y) {\r\n            return corner.y < y;\r\n        };\r\n        var isBelow$1 = function (corner, y) {\r\n            return corner.y > y;\r\n        };\r\n        var getClosestCellAbove = curry(getClosestCell, getBottomValue, isAbove$1);\r\n        var getClosestCellBelow = curry(getClosestCell, getTopValue, isBelow$1);\r\n        var findClosestPositionInAboveCell = function (table, pos) {\r\n            return head(pos.getClientRects()).bind(function (rect) {\r\n                return getClosestCellAbove(table, rect.left, rect.top);\r\n            }).bind(function (cell) {\r\n                return findClosestHorizontalPosition(getLastLinePositions(cell), pos);\r\n            });\r\n        };\r\n        var findClosestPositionInBelowCell = function (table, pos) {\r\n            return last(pos.getClientRects()).bind(function (rect) {\r\n                return getClosestCellBelow(table, rect.left, rect.top);\r\n            }).bind(function (cell) {\r\n                return findClosestHorizontalPosition(getFirstLinePositions(cell), pos);\r\n            });\r\n        };\r\n        var moveToRange = function (editor, rng) {\r\n            editor.selection.setRng(rng);\r\n            ScrollIntoView.scrollRangeIntoView(editor, rng);\r\n        };\r\n        var hasNextBreak = function (getPositionsUntil, scope, lineInfo) {\r\n            return lineInfo.breakAt.map(function (breakPos) {\r\n                return getPositionsUntil(scope, breakPos).breakAt.isSome();\r\n            }).getOr(false);\r\n        };\r\n        var startsWithWrapBreak = function (lineInfo) {\r\n            return lineInfo.breakType === BreakType.Wrap && lineInfo.positions.length === 0;\r\n        };\r\n        var startsWithBrBreak = function (lineInfo) {\r\n            return lineInfo.breakType === BreakType.Br && lineInfo.positions.length === 1;\r\n        };\r\n        var isAtTableCellLine = function (getPositionsUntil, scope, pos) {\r\n            var lineInfo = getPositionsUntil(scope, pos);\r\n            if (startsWithWrapBreak(lineInfo) || !NodeType.isBr(pos.getNode()) && startsWithBrBreak(lineInfo)) {\r\n                return !hasNextBreak(getPositionsUntil, scope, lineInfo);\r\n            }\r\n            else {\r\n                return lineInfo.breakAt.isNone();\r\n            }\r\n        };\r\n        var isAtFirstTableCellLine = curry(isAtTableCellLine, getPositionsUntilPreviousLine);\r\n        var isAtLastTableCellLine = curry(isAtTableCellLine, getPositionsUntilNextLine);\r\n        var isCaretAtStartOrEndOfTable = function (forward, rng, table) {\r\n            var caretPos = CaretPosition$1.fromRangeStart(rng);\r\n            return CaretFinder.positionIn(!forward, table).map(function (pos) {\r\n                return pos.isEqual(caretPos);\r\n            }).getOr(false);\r\n        };\r\n        var navigateHorizontally = function (editor, forward, table, td) {\r\n            var rng = editor.selection.getRng();\r\n            var direction = forward ? 1 : -1;\r\n            if (isFakeCaretTableBrowser() && isCaretAtStartOrEndOfTable(forward, rng, table)) {\r\n                var newRng = showCaret(direction, editor, table, !forward, true);\r\n                moveToRange(editor, newRng);\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        var getClosestAbovePosition = function (root, table, start) {\r\n            return findClosestPositionInAboveCell(table, start).orThunk(function () {\r\n                return head(start.getClientRects()).bind(function (rect) {\r\n                    return findClosestHorizontalPositionFromPoint(getPositionsAbove(root, CaretPosition$1.before(table)), rect.left);\r\n                });\r\n            }).getOr(CaretPosition$1.before(table));\r\n        };\r\n        var getClosestBelowPosition = function (root, table, start) {\r\n            return findClosestPositionInBelowCell(table, start).orThunk(function () {\r\n                return head(start.getClientRects()).bind(function (rect) {\r\n                    return findClosestHorizontalPositionFromPoint(getPositionsBelow(root, CaretPosition$1.after(table)), rect.left);\r\n                });\r\n            }).getOr(CaretPosition$1.after(table));\r\n        };\r\n        var getTable = function (previous, pos) {\r\n            var node = pos.getNode(previous);\r\n            return NodeType.isElement(node) && node.nodeName === 'TABLE' ? Option.some(node) : Option.none();\r\n        };\r\n        var renderBlock = function (down, editor, table, pos) {\r\n            var forcedRootBlock = Settings.getForcedRootBlock(editor);\r\n            if (forcedRootBlock) {\r\n                editor.undoManager.transact(function () {\r\n                    var element = Element.fromTag(forcedRootBlock);\r\n                    setAll(element, Settings.getForcedRootBlockAttrs(editor));\r\n                    append(element, Element.fromTag('br'));\r\n                    if (down) {\r\n                        after(Element.fromDom(table), element);\r\n                    }\r\n                    else {\r\n                        before(Element.fromDom(table), element);\r\n                    }\r\n                    var rng = editor.dom.createRng();\r\n                    rng.setStart(element.dom(), 0);\r\n                    rng.setEnd(element.dom(), 0);\r\n                    moveToRange(editor, rng);\r\n                });\r\n            }\r\n            else {\r\n                moveToRange(editor, pos.toRange());\r\n            }\r\n        };\r\n        var moveCaret = function (editor, down, pos) {\r\n            var table = down ? getTable(true, pos) : getTable(false, pos);\r\n            var last = down === false;\r\n            table.fold(function () {\r\n                return moveToRange(editor, pos.toRange());\r\n            }, function (table) {\r\n                return CaretFinder.positionIn(last, editor.getBody()).filter(function (lastPos) {\r\n                    return lastPos.isEqual(pos);\r\n                }).fold(function () {\r\n                    return moveToRange(editor, pos.toRange());\r\n                }, function (_) {\r\n                    return renderBlock(down, editor, table, pos);\r\n                });\r\n            });\r\n        };\r\n        var navigateVertically = function (editor, down, table, td) {\r\n            var rng = editor.selection.getRng();\r\n            var pos = CaretPosition$1.fromRangeStart(rng);\r\n            var root = editor.getBody();\r\n            if (!down && isAtFirstTableCellLine(td, pos)) {\r\n                var newPos = getClosestAbovePosition(root, table, pos);\r\n                moveCaret(editor, down, newPos);\r\n                return true;\r\n            }\r\n            else if (down && isAtLastTableCellLine(td, pos)) {\r\n                var newPos = getClosestBelowPosition(root, table, pos);\r\n                moveCaret(editor, down, newPos);\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var moveH$1 = function (editor, forward) {\r\n            return function () {\r\n                return Option.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\r\n                    return Option.from(editor.dom.getParent(td, 'table')).map(function (table) {\r\n                        return navigateHorizontally(editor, forward, table, td);\r\n                    });\r\n                }).getOr(false);\r\n            };\r\n        };\r\n        var moveV$1 = function (editor, forward) {\r\n            return function () {\r\n                return Option.from(editor.dom.getParent(editor.selection.getNode(), 'td,th')).bind(function (td) {\r\n                    return Option.from(editor.dom.getParent(td, 'table')).map(function (table) {\r\n                        return navigateVertically(editor, forward, table, td);\r\n                    });\r\n                }).getOr(false);\r\n            };\r\n        };\r\n        var isTarget = function (node) {\r\n            return contains(['figcaption'], name(node));\r\n        };\r\n        var rangeBefore = function (target) {\r\n            var rng = domGlobals.document.createRange();\r\n            rng.setStartBefore(target.dom());\r\n            rng.setEndBefore(target.dom());\r\n            return rng;\r\n        };\r\n        var insertElement = function (root, elm, forward) {\r\n            if (forward) {\r\n                append(root, elm);\r\n            }\r\n            else {\r\n                prepend(root, elm);\r\n            }\r\n        };\r\n        var insertBr = function (root, forward) {\r\n            var br = Element.fromTag('br');\r\n            insertElement(root, br, forward);\r\n            return rangeBefore(br);\r\n        };\r\n        var insertBlock$1 = function (root, forward, blockName, attrs) {\r\n            var block = Element.fromTag(blockName);\r\n            var br = Element.fromTag('br');\r\n            setAll(block, attrs);\r\n            append(block, br);\r\n            insertElement(root, block, forward);\r\n            return rangeBefore(br);\r\n        };\r\n        var insertEmptyLine = function (root, rootBlockName, attrs, forward) {\r\n            if (rootBlockName === '') {\r\n                return insertBr(root, forward);\r\n            }\r\n            else {\r\n                return insertBlock$1(root, forward, rootBlockName, attrs);\r\n            }\r\n        };\r\n        var getClosestTargetBlock = function (pos, root) {\r\n            var isRoot = curry(eq, root);\r\n            return closest(Element.fromDom(pos.container()), isBlock, isRoot).filter(isTarget);\r\n        };\r\n        var isAtFirstOrLastLine = function (root, forward, pos) {\r\n            return forward ? isAtLastLine(root.dom(), pos) : isAtFirstLine(root.dom(), pos);\r\n        };\r\n        var moveCaretToNewEmptyLine = function (editor, forward) {\r\n            var root = Element.fromDom(editor.getBody());\r\n            var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            var rootBlock = Settings.getForcedRootBlock(editor);\r\n            var rootBlockAttrs = Settings.getForcedRootBlockAttrs(editor);\r\n            return getClosestTargetBlock(pos, root).exists(function () {\r\n                if (isAtFirstOrLastLine(root, forward, pos)) {\r\n                    var rng = insertEmptyLine(root, rootBlock, rootBlockAttrs, forward);\r\n                    editor.selection.setRng(rng);\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            });\r\n        };\r\n        var moveV$2 = function (editor, forward) {\r\n            return function () {\r\n                if (editor.selection.isCollapsed()) {\r\n                    return moveCaretToNewEmptyLine(editor, forward);\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            };\r\n        };\r\n        var defaultPatterns = function (patterns) {\r\n            return map(patterns, function (pattern) {\r\n                return merge({\r\n                    shiftKey: false,\r\n                    altKey: false,\r\n                    ctrlKey: false,\r\n                    metaKey: false,\r\n                    keyCode: 0,\r\n                    action: noop\r\n                }, pattern);\r\n            });\r\n        };\r\n        var matchesEvent = function (pattern, evt) {\r\n            return evt.keyCode === pattern.keyCode && evt.shiftKey === pattern.shiftKey && evt.altKey === pattern.altKey && evt.ctrlKey === pattern.ctrlKey && evt.metaKey === pattern.metaKey;\r\n        };\r\n        var match$1 = function (patterns, evt) {\r\n            return bind(defaultPatterns(patterns), function (pattern) {\r\n                return matchesEvent(pattern, evt) ? [pattern] : [];\r\n            });\r\n        };\r\n        var action = function (f) {\r\n            var x = [];\r\n            for (var _i = 1; _i < arguments.length; _i++) {\r\n                x[_i - 1] = arguments[_i];\r\n            }\r\n            var args = Array.prototype.slice.call(arguments, 1);\r\n            return function () {\r\n                return f.apply(null, args);\r\n            };\r\n        };\r\n        var execute = function (patterns, evt) {\r\n            return find(match$1(patterns, evt), function (pattern) {\r\n                return pattern.action();\r\n            });\r\n        };\r\n        var MatchKeys = {\r\n            match: match$1,\r\n            action: action,\r\n            execute: execute\r\n        };\r\n        var executeKeydownOverride = function (editor, caret, evt) {\r\n            var os = PlatformDetection$1.detect().os;\r\n            MatchKeys.execute([\r\n                {\r\n                    keyCode: VK.RIGHT,\r\n                    action: moveH(editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.LEFT,\r\n                    action: moveH(editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.UP,\r\n                    action: moveV(editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DOWN,\r\n                    action: moveV(editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.RIGHT,\r\n                    action: moveH$1(editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.LEFT,\r\n                    action: moveH$1(editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.UP,\r\n                    action: moveV$1(editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DOWN,\r\n                    action: moveV$1(editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.RIGHT,\r\n                    action: BoundarySelection.move(editor, caret, true)\r\n                },\r\n                {\r\n                    keyCode: VK.LEFT,\r\n                    action: BoundarySelection.move(editor, caret, false)\r\n                },\r\n                {\r\n                    keyCode: VK.RIGHT,\r\n                    ctrlKey: !os.isOSX(),\r\n                    altKey: os.isOSX(),\r\n                    action: BoundarySelection.moveNextWord(editor, caret)\r\n                },\r\n                {\r\n                    keyCode: VK.LEFT,\r\n                    ctrlKey: !os.isOSX(),\r\n                    altKey: os.isOSX(),\r\n                    action: BoundarySelection.movePrevWord(editor, caret)\r\n                },\r\n                {\r\n                    keyCode: VK.UP,\r\n                    action: moveV$2(editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DOWN,\r\n                    action: moveV$2(editor, true)\r\n                }\r\n            ], evt).each(function (_) {\r\n                evt.preventDefault();\r\n            });\r\n        };\r\n        var setup$7 = function (editor, caret) {\r\n            editor.on('keydown', function (evt) {\r\n                if (evt.isDefaultPrevented() === false) {\r\n                    executeKeydownOverride(editor, caret, evt);\r\n                }\r\n            });\r\n        };\r\n        var ArrowKeys = { setup: setup$7 };\r\n        var isBeforeRoot = function (rootNode) {\r\n            return function (elm) {\r\n                return eq(rootNode, Element.fromDom(elm.dom().parentNode));\r\n            };\r\n        };\r\n        var getParentBlock$1 = function (rootNode, elm) {\r\n            return contains$3(rootNode, elm) ? closest(elm, function (element) {\r\n                return isTextBlock(element) || isListItem(element);\r\n            }, isBeforeRoot(rootNode)) : Option.none();\r\n        };\r\n        var placeCaretInEmptyBody = function (editor) {\r\n            var body = editor.getBody();\r\n            var node = body.firstChild && editor.dom.isBlock(body.firstChild) ? body.firstChild : body;\r\n            editor.selection.setCursorLocation(node, 0);\r\n        };\r\n        var paddEmptyBody = function (editor) {\r\n            if (editor.dom.isEmpty(editor.getBody())) {\r\n                editor.setContent('');\r\n                placeCaretInEmptyBody(editor);\r\n            }\r\n        };\r\n        var willDeleteLastPositionInElement = function (forward, fromPos, elm) {\r\n            return liftN([\r\n                CaretFinder.firstPositionIn(elm),\r\n                CaretFinder.lastPositionIn(elm)\r\n            ], function (firstPos, lastPos) {\r\n                var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);\r\n                var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);\r\n                var normalizedFromPos = InlineUtils.normalizePosition(false, fromPos);\r\n                if (forward) {\r\n                    return CaretFinder.nextPosition(elm, normalizedFromPos).map(function (nextPos) {\r\n                        return nextPos.isEqual(normalizedLastPos) && fromPos.isEqual(normalizedFirstPos);\r\n                    }).getOr(false);\r\n                }\r\n                else {\r\n                    return CaretFinder.prevPosition(elm, normalizedFromPos).map(function (prevPos) {\r\n                        return prevPos.isEqual(normalizedFirstPos) && fromPos.isEqual(normalizedLastPos);\r\n                    }).getOr(false);\r\n                }\r\n            }).getOr(true);\r\n        };\r\n        var DeleteUtils = {\r\n            getParentBlock: getParentBlock$1,\r\n            paddEmptyBody: paddEmptyBody,\r\n            willDeleteLastPositionInElement: willDeleteLastPositionInElement\r\n        };\r\n        var BlockPosition = Immutable('block', 'position');\r\n        var BlockBoundary = Immutable('from', 'to');\r\n        var getBlockPosition = function (rootNode, pos) {\r\n            var rootElm = Element.fromDom(rootNode);\r\n            var containerElm = Element.fromDom(pos.container());\r\n            return DeleteUtils.getParentBlock(rootElm, containerElm).map(function (block) {\r\n                return BlockPosition(block, pos);\r\n            });\r\n        };\r\n        var isDifferentBlocks = function (blockBoundary) {\r\n            return eq(blockBoundary.from().block(), blockBoundary.to().block()) === false;\r\n        };\r\n        var hasSameParent = function (blockBoundary) {\r\n            return parent(blockBoundary.from().block()).bind(function (parent1) {\r\n                return parent(blockBoundary.to().block()).filter(function (parent2) {\r\n                    return eq(parent1, parent2);\r\n                });\r\n            }).isSome();\r\n        };\r\n        var isEditable = function (blockBoundary) {\r\n            return NodeType.isContentEditableFalse(blockBoundary.from().block()) === false && NodeType.isContentEditableFalse(blockBoundary.to().block()) === false;\r\n        };\r\n        var skipLastBr = function (rootNode, forward, blockPosition) {\r\n            if (NodeType.isBr(blockPosition.position().getNode()) && Empty.isEmpty(blockPosition.block()) === false) {\r\n                return CaretFinder.positionIn(false, blockPosition.block().dom()).bind(function (lastPositionInBlock) {\r\n                    if (lastPositionInBlock.isEqual(blockPosition.position())) {\r\n                        return CaretFinder.fromPosition(forward, rootNode, lastPositionInBlock).bind(function (to) {\r\n                            return getBlockPosition(rootNode, to);\r\n                        });\r\n                    }\r\n                    else {\r\n                        return Option.some(blockPosition);\r\n                    }\r\n                }).getOr(blockPosition);\r\n            }\r\n            else {\r\n                return blockPosition;\r\n            }\r\n        };\r\n        var readFromRange = function (rootNode, forward, rng) {\r\n            var fromBlockPos = getBlockPosition(rootNode, CaretPosition$1.fromRangeStart(rng));\r\n            var toBlockPos = fromBlockPos.bind(function (blockPos) {\r\n                return CaretFinder.fromPosition(forward, rootNode, blockPos.position()).bind(function (to) {\r\n                    return getBlockPosition(rootNode, to).map(function (blockPos) {\r\n                        return skipLastBr(rootNode, forward, blockPos);\r\n                    });\r\n                });\r\n            });\r\n            return liftN([\r\n                fromBlockPos,\r\n                toBlockPos\r\n            ], BlockBoundary).filter(function (blockBoundary) {\r\n                return isDifferentBlocks(blockBoundary) && hasSameParent(blockBoundary) && isEditable(blockBoundary);\r\n            });\r\n        };\r\n        var read$3 = function (rootNode, forward, rng) {\r\n            return rng.collapsed ? readFromRange(rootNode, forward, rng) : Option.none();\r\n        };\r\n        var BlockMergeBoundary = { read: read$3 };\r\n        var getChildrenUntilBlockBoundary = function (block) {\r\n            var children$1 = children(block);\r\n            return findIndex(children$1, isBlock).fold(function () {\r\n                return children$1;\r\n            }, function (index) {\r\n                return children$1.slice(0, index);\r\n            });\r\n        };\r\n        var extractChildren = function (block) {\r\n            var children = getChildrenUntilBlockBoundary(block);\r\n            each(children, remove$1);\r\n            return children;\r\n        };\r\n        var removeEmptyRoot = function (rootNode, block) {\r\n            var parents = Parents.parentsAndSelf(block, rootNode);\r\n            return find(parents.reverse(), Empty.isEmpty).each(remove$1);\r\n        };\r\n        var isEmptyBefore = function (el) {\r\n            return filter(prevSiblings(el), function (el) {\r\n                return !Empty.isEmpty(el);\r\n            }).length === 0;\r\n        };\r\n        var nestedBlockMerge = function (rootNode, fromBlock, toBlock, insertionPoint) {\r\n            if (Empty.isEmpty(toBlock)) {\r\n                PaddingBr.fillWithPaddingBr(toBlock);\r\n                return CaretFinder.firstPositionIn(toBlock.dom());\r\n            }\r\n            if (isEmptyBefore(insertionPoint) && Empty.isEmpty(fromBlock)) {\r\n                before(insertionPoint, Element.fromTag('br'));\r\n            }\r\n            var position = CaretFinder.prevPosition(toBlock.dom(), CaretPosition$1.before(insertionPoint.dom()));\r\n            each(extractChildren(fromBlock), function (child) {\r\n                before(insertionPoint, child);\r\n            });\r\n            removeEmptyRoot(rootNode, fromBlock);\r\n            return position;\r\n        };\r\n        var sidelongBlockMerge = function (rootNode, fromBlock, toBlock) {\r\n            if (Empty.isEmpty(toBlock)) {\r\n                remove$1(toBlock);\r\n                if (Empty.isEmpty(fromBlock)) {\r\n                    PaddingBr.fillWithPaddingBr(fromBlock);\r\n                }\r\n                return CaretFinder.firstPositionIn(fromBlock.dom());\r\n            }\r\n            var position = CaretFinder.lastPositionIn(toBlock.dom());\r\n            each(extractChildren(fromBlock), function (child) {\r\n                append(toBlock, child);\r\n            });\r\n            removeEmptyRoot(rootNode, fromBlock);\r\n            return position;\r\n        };\r\n        var findInsertionPoint = function (toBlock, block) {\r\n            var parentsAndSelf = Parents.parentsAndSelf(block, toBlock);\r\n            return Option.from(parentsAndSelf[parentsAndSelf.length - 1]);\r\n        };\r\n        var getInsertionPoint = function (fromBlock, toBlock) {\r\n            return contains$3(toBlock, fromBlock) ? findInsertionPoint(toBlock, fromBlock) : Option.none();\r\n        };\r\n        var trimBr = function (first, block) {\r\n            CaretFinder.positionIn(first, block.dom()).map(function (position) {\r\n                return position.getNode();\r\n            }).map(Element.fromDom).filter(isBr$1).each(remove$1);\r\n        };\r\n        var mergeBlockInto = function (rootNode, fromBlock, toBlock) {\r\n            trimBr(true, fromBlock);\r\n            trimBr(false, toBlock);\r\n            return getInsertionPoint(fromBlock, toBlock).fold(curry(sidelongBlockMerge, rootNode, fromBlock, toBlock), curry(nestedBlockMerge, rootNode, fromBlock, toBlock));\r\n        };\r\n        var mergeBlocks = function (rootNode, forward, block1, block2) {\r\n            return forward ? mergeBlockInto(rootNode, block2, block1) : mergeBlockInto(rootNode, block1, block2);\r\n        };\r\n        var MergeBlocks = { mergeBlocks: mergeBlocks };\r\n        var backspaceDelete = function (editor, forward) {\r\n            var position;\r\n            var rootNode = Element.fromDom(editor.getBody());\r\n            position = BlockMergeBoundary.read(rootNode.dom(), forward, editor.selection.getRng()).bind(function (blockBoundary) {\r\n                return MergeBlocks.mergeBlocks(rootNode, forward, blockBoundary.from().block(), blockBoundary.to().block());\r\n            });\r\n            position.each(function (pos) {\r\n                editor.selection.setRng(pos.toRange());\r\n            });\r\n            return position.isSome();\r\n        };\r\n        var BlockBoundaryDelete = { backspaceDelete: backspaceDelete };\r\n        var deleteRangeMergeBlocks = function (rootNode, selection) {\r\n            var rng = selection.getRng();\r\n            return liftN([\r\n                DeleteUtils.getParentBlock(rootNode, Element.fromDom(rng.startContainer)),\r\n                DeleteUtils.getParentBlock(rootNode, Element.fromDom(rng.endContainer))\r\n            ], function (block1, block2) {\r\n                if (eq(block1, block2) === false) {\r\n                    rng.deleteContents();\r\n                    MergeBlocks.mergeBlocks(rootNode, true, block1, block2).each(function (pos) {\r\n                        selection.setRng(pos.toRange());\r\n                    });\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            }).getOr(false);\r\n        };\r\n        var isRawNodeInTable = function (root, rawNode) {\r\n            var node = Element.fromDom(rawNode);\r\n            var isRoot = curry(eq, root);\r\n            return ancestor(node, isTableCell, isRoot).isSome();\r\n        };\r\n        var isSelectionInTable = function (root, rng) {\r\n            return isRawNodeInTable(root, rng.startContainer) || isRawNodeInTable(root, rng.endContainer);\r\n        };\r\n        var isEverythingSelected = function (root, rng) {\r\n            var noPrevious = CaretFinder.prevPosition(root.dom(), CaretPosition$1.fromRangeStart(rng)).isNone();\r\n            var noNext = CaretFinder.nextPosition(root.dom(), CaretPosition$1.fromRangeEnd(rng)).isNone();\r\n            return !isSelectionInTable(root, rng) && noPrevious && noNext;\r\n        };\r\n        var emptyEditor = function (editor) {\r\n            editor.setContent('');\r\n            editor.selection.setCursorLocation();\r\n            return true;\r\n        };\r\n        var deleteRange = function (editor) {\r\n            var rootNode = Element.fromDom(editor.getBody());\r\n            var rng = editor.selection.getRng();\r\n            return isEverythingSelected(rootNode, rng) ? emptyEditor(editor) : deleteRangeMergeBlocks(rootNode, editor.selection);\r\n        };\r\n        var backspaceDelete$1 = function (editor, forward) {\r\n            return editor.selection.isCollapsed() ? false : deleteRange(editor);\r\n        };\r\n        var BlockRangeDelete = { backspaceDelete: backspaceDelete$1 };\r\n        var isBr$5 = function (pos) {\r\n            return getElementFromPosition(pos).exists(isBr$1);\r\n        };\r\n        var findBr = function (forward, root, pos) {\r\n            var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\r\n            var scope = head(parentBlocks).getOr(root);\r\n            return CaretFinder.fromPosition(forward, scope.dom(), pos).filter(isBr$5);\r\n        };\r\n        var isBeforeBr = function (root, pos) {\r\n            return getElementFromPosition(pos).exists(isBr$1) || findBr(true, root, pos).isSome();\r\n        };\r\n        var isAfterBr = function (root, pos) {\r\n            return getElementFromPrevPosition(pos).exists(isBr$1) || findBr(false, root, pos).isSome();\r\n        };\r\n        var findPreviousBr = curry(findBr, false);\r\n        var findNextBr = curry(findBr, true);\r\n        var isCompoundElement = function (node) {\r\n            return isTableCell(Element.fromDom(node)) || isListItem(Element.fromDom(node));\r\n        };\r\n        var DeleteAction = Adt.generate([\r\n            { remove: ['element'] },\r\n            { moveToElement: ['element'] },\r\n            { moveToPosition: ['position'] }\r\n        ]);\r\n        var isAtContentEditableBlockCaret = function (forward, from) {\r\n            var elm = from.getNode(forward === false);\r\n            var caretLocation = forward ? 'after' : 'before';\r\n            return NodeType.isElement(elm) && elm.getAttribute('data-mce-caret') === caretLocation;\r\n        };\r\n        var isDeleteFromCefDifferentBlocks = function (root, forward, from, to) {\r\n            var inSameBlock = function (elm) {\r\n                return isInline(Element.fromDom(elm)) && !isInSameBlock(from, to, root);\r\n            };\r\n            return getRelativeCefElm(!forward, from).fold(function () {\r\n                return getRelativeCefElm(forward, to).fold(constant(false), inSameBlock);\r\n            }, inSameBlock);\r\n        };\r\n        var deleteEmptyBlockOrMoveToCef = function (root, forward, from, to) {\r\n            var toCefElm = to.getNode(forward === false);\r\n            return DeleteUtils.getParentBlock(Element.fromDom(root), Element.fromDom(from.getNode())).map(function (blockElm) {\r\n                return Empty.isEmpty(blockElm) ? DeleteAction.remove(blockElm.dom()) : DeleteAction.moveToElement(toCefElm);\r\n            }).orThunk(function () {\r\n                return Option.some(DeleteAction.moveToElement(toCefElm));\r\n            });\r\n        };\r\n        var findCefPosition = function (root, forward, from) {\r\n            return CaretFinder.fromPosition(forward, root, from).bind(function (to) {\r\n                if (isCompoundElement(to.getNode())) {\r\n                    return Option.none();\r\n                }\r\n                else if (isDeleteFromCefDifferentBlocks(root, forward, from, to)) {\r\n                    return Option.none();\r\n                }\r\n                else if (forward && NodeType.isContentEditableFalse(to.getNode())) {\r\n                    return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\r\n                }\r\n                else if (forward === false && NodeType.isContentEditableFalse(to.getNode(true))) {\r\n                    return deleteEmptyBlockOrMoveToCef(root, forward, from, to);\r\n                }\r\n                else if (forward && isAfterContentEditableFalse(from)) {\r\n                    return Option.some(DeleteAction.moveToPosition(to));\r\n                }\r\n                else if (forward === false && isBeforeContentEditableFalse(from)) {\r\n                    return Option.some(DeleteAction.moveToPosition(to));\r\n                }\r\n                else {\r\n                    return Option.none();\r\n                }\r\n            });\r\n        };\r\n        var getContentEditableBlockAction = function (forward, elm) {\r\n            if (forward && NodeType.isContentEditableFalse(elm.nextSibling)) {\r\n                return Option.some(DeleteAction.moveToElement(elm.nextSibling));\r\n            }\r\n            else if (forward === false && NodeType.isContentEditableFalse(elm.previousSibling)) {\r\n                return Option.some(DeleteAction.moveToElement(elm.previousSibling));\r\n            }\r\n            else {\r\n                return Option.none();\r\n            }\r\n        };\r\n        var skipMoveToActionFromInlineCefToContent = function (root, from, deleteAction) {\r\n            return deleteAction.fold(function (elm) {\r\n                return Option.some(DeleteAction.remove(elm));\r\n            }, function (elm) {\r\n                return Option.some(DeleteAction.moveToElement(elm));\r\n            }, function (to) {\r\n                if (isInSameBlock(from, to, root)) {\r\n                    return Option.none();\r\n                }\r\n                else {\r\n                    return Option.some(DeleteAction.moveToPosition(to));\r\n                }\r\n            });\r\n        };\r\n        var getContentEditableAction = function (root, forward, from) {\r\n            if (isAtContentEditableBlockCaret(forward, from)) {\r\n                return getContentEditableBlockAction(forward, from.getNode(forward === false)).fold(function () {\r\n                    return findCefPosition(root, forward, from);\r\n                }, Option.some);\r\n            }\r\n            else {\r\n                return findCefPosition(root, forward, from).bind(function (deleteAction) {\r\n                    return skipMoveToActionFromInlineCefToContent(root, from, deleteAction);\r\n                });\r\n            }\r\n        };\r\n        var read$4 = function (root, forward, rng) {\r\n            var normalizedRange = normalizeRange(forward ? 1 : -1, root, rng);\r\n            var from = CaretPosition$1.fromRangeStart(normalizedRange);\r\n            var rootElement = Element.fromDom(root);\r\n            if (forward === false && isAfterContentEditableFalse(from)) {\r\n                return Option.some(DeleteAction.remove(from.getNode(true)));\r\n            }\r\n            else if (forward && isBeforeContentEditableFalse(from)) {\r\n                return Option.some(DeleteAction.remove(from.getNode()));\r\n            }\r\n            else if (forward === false && isBeforeContentEditableFalse(from) && isAfterBr(rootElement, from)) {\r\n                return findPreviousBr(rootElement, from).map(function (br) {\r\n                    return DeleteAction.remove(br.getNode());\r\n                });\r\n            }\r\n            else if (forward && isAfterContentEditableFalse(from) && isBeforeBr(rootElement, from)) {\r\n                return findNextBr(rootElement, from).map(function (br) {\r\n                    return DeleteAction.remove(br.getNode());\r\n                });\r\n            }\r\n            else {\r\n                return getContentEditableAction(root, forward, from);\r\n            }\r\n        };\r\n        var deleteElement$1 = function (editor, forward) {\r\n            return function (element) {\r\n                editor._selectionOverrides.hideFakeCaret();\r\n                DeleteElement.deleteElement(editor, forward, Element.fromDom(element));\r\n                return true;\r\n            };\r\n        };\r\n        var moveToElement = function (editor, forward) {\r\n            return function (element) {\r\n                var pos = forward ? CaretPosition$1.before(element) : CaretPosition$1.after(element);\r\n                editor.selection.setRng(pos.toRange());\r\n                return true;\r\n            };\r\n        };\r\n        var moveToPosition = function (editor) {\r\n            return function (pos) {\r\n                editor.selection.setRng(pos.toRange());\r\n                return true;\r\n            };\r\n        };\r\n        var backspaceDeleteCaret = function (editor, forward) {\r\n            var result = read$4(editor.getBody(), forward, editor.selection.getRng()).map(function (deleteAction) {\r\n                return deleteAction.fold(deleteElement$1(editor, forward), moveToElement(editor, forward), moveToPosition(editor));\r\n            });\r\n            return result.getOr(false);\r\n        };\r\n        var deleteOffscreenSelection = function (rootElement) {\r\n            each(descendants$1(rootElement, '.mce-offscreen-selection'), remove$1);\r\n        };\r\n        var backspaceDeleteRange = function (editor, forward) {\r\n            var selectedElement = editor.selection.getNode();\r\n            if (NodeType.isContentEditableFalse(selectedElement)) {\r\n                deleteOffscreenSelection(Element.fromDom(editor.getBody()));\r\n                DeleteElement.deleteElement(editor, forward, Element.fromDom(editor.selection.getNode()));\r\n                DeleteUtils.paddEmptyBody(editor);\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var getContentEditableRoot$2 = function (root, node) {\r\n            while (node && node !== root) {\r\n                if (NodeType.isContentEditableTrue(node) || NodeType.isContentEditableFalse(node)) {\r\n                    return node;\r\n                }\r\n                node = node.parentNode;\r\n            }\r\n            return null;\r\n        };\r\n        var paddEmptyElement = function (editor) {\r\n            var br;\r\n            var ceRoot = getContentEditableRoot$2(editor.getBody(), editor.selection.getNode());\r\n            if (NodeType.isContentEditableTrue(ceRoot) && editor.dom.isBlock(ceRoot) && editor.dom.isEmpty(ceRoot)) {\r\n                br = editor.dom.create('br', { 'data-mce-bogus': '1' });\r\n                editor.dom.setHTML(ceRoot, '');\r\n                ceRoot.appendChild(br);\r\n                editor.selection.setRng(CaretPosition$1.before(br).toRange());\r\n            }\r\n            return true;\r\n        };\r\n        var backspaceDelete$2 = function (editor, forward) {\r\n            if (editor.selection.isCollapsed()) {\r\n                return backspaceDeleteCaret(editor, forward);\r\n            }\r\n            else {\r\n                return backspaceDeleteRange(editor, forward);\r\n            }\r\n        };\r\n        var CefDelete = {\r\n            backspaceDelete: backspaceDelete$2,\r\n            paddEmptyElement: paddEmptyElement\r\n        };\r\n        var trimEmptyTextNode$1 = function (dom, node) {\r\n            if (NodeType.isText(node) && node.data.length === 0) {\r\n                dom.remove(node);\r\n            }\r\n        };\r\n        var deleteContentAndShowCaret = function (editor, range, node, direction, forward, peekCaretPosition) {\r\n            var caretRange = showCaret(direction, editor, peekCaretPosition.getNode(!forward), forward, true);\r\n            if (range.collapsed) {\r\n                var deleteRange = range.cloneRange();\r\n                if (forward) {\r\n                    deleteRange.setEnd(caretRange.startContainer, caretRange.startOffset);\r\n                }\r\n                else {\r\n                    deleteRange.setStart(caretRange.endContainer, caretRange.endOffset);\r\n                }\r\n                deleteRange.deleteContents();\r\n            }\r\n            else {\r\n                range.deleteContents();\r\n            }\r\n            editor.selection.setRng(caretRange);\r\n            trimEmptyTextNode$1(editor.dom, node);\r\n            return true;\r\n        };\r\n        var deleteCefBoundaryText = function (editor, forward) {\r\n            var range = editor.selection.getRng();\r\n            if (!NodeType.isText(range.commonAncestorContainer)) {\r\n                return false;\r\n            }\r\n            var direction = forward ? HDirection.Forwards : HDirection.Backwards;\r\n            var caretWalker = CaretWalker(editor.getBody());\r\n            var getNextVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.next);\r\n            var getPrevVisualCaretPosition = curry(getVisualCaretPosition, caretWalker.prev);\r\n            var getNextPosFn = forward ? getNextVisualCaretPosition : getPrevVisualCaretPosition;\r\n            var isBeforeContentEditableFalseFn = forward ? isBeforeContentEditableFalse : isAfterContentEditableFalse;\r\n            var caretPosition = getNormalizedRangeEndPoint(direction, editor.getBody(), range);\r\n            var nextCaretPosition = InlineUtils.normalizePosition(forward, getNextPosFn(caretPosition));\r\n            if (!nextCaretPosition) {\r\n                return false;\r\n            }\r\n            else if (isBeforeContentEditableFalseFn(nextCaretPosition)) {\r\n                return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, nextCaretPosition);\r\n            }\r\n            var peekCaretPosition = getNextPosFn(nextCaretPosition);\r\n            if (peekCaretPosition && isBeforeContentEditableFalseFn(peekCaretPosition)) {\r\n                if (isMoveInsideSameBlock(nextCaretPosition, peekCaretPosition)) {\r\n                    return deleteContentAndShowCaret(editor, range, caretPosition.getNode(), direction, forward, peekCaretPosition);\r\n                }\r\n            }\r\n            return false;\r\n        };\r\n        var backspaceDelete$3 = function (editor, forward) {\r\n            return deleteCefBoundaryText(editor, forward);\r\n        };\r\n        var CefBoundaryDelete = { backspaceDelete: backspaceDelete$3 };\r\n        var isFeatureEnabled$1 = function (editor) {\r\n            return editor.settings.inline_boundaries !== false;\r\n        };\r\n        var rangeFromPositions = function (from, to) {\r\n            var range = domGlobals.document.createRange();\r\n            range.setStart(from.container(), from.offset());\r\n            range.setEnd(to.container(), to.offset());\r\n            return range;\r\n        };\r\n        var hasOnlyTwoOrLessPositionsLeft = function (elm) {\r\n            return liftN([\r\n                CaretFinder.firstPositionIn(elm),\r\n                CaretFinder.lastPositionIn(elm)\r\n            ], function (firstPos, lastPos) {\r\n                var normalizedFirstPos = InlineUtils.normalizePosition(true, firstPos);\r\n                var normalizedLastPos = InlineUtils.normalizePosition(false, lastPos);\r\n                return CaretFinder.nextPosition(elm, normalizedFirstPos).map(function (pos) {\r\n                    return pos.isEqual(normalizedLastPos);\r\n                }).getOr(true);\r\n            }).getOr(true);\r\n        };\r\n        var setCaretLocation = function (editor, caret) {\r\n            return function (location) {\r\n                return BoundaryCaret.renderCaret(caret, location).map(function (pos) {\r\n                    BoundarySelection.setCaretPosition(editor, pos);\r\n                    return true;\r\n                }).getOr(false);\r\n            };\r\n        };\r\n        var deleteFromTo = function (editor, caret, from, to) {\r\n            var rootNode = editor.getBody();\r\n            var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\r\n            editor.undoManager.ignore(function () {\r\n                editor.selection.setRng(rangeFromPositions(from, to));\r\n                editor.execCommand('Delete');\r\n                BoundaryLocation.readLocation(isInlineTarget, rootNode, CaretPosition$1.fromRangeStart(editor.selection.getRng())).map(BoundaryLocation.inside).map(setCaretLocation(editor, caret));\r\n            });\r\n            editor.nodeChanged();\r\n        };\r\n        var rescope$1 = function (rootNode, node) {\r\n            var parentBlock = getParentBlock(node, rootNode);\r\n            return parentBlock ? parentBlock : rootNode;\r\n        };\r\n        var backspaceDeleteCollapsed = function (editor, caret, forward, from) {\r\n            var rootNode = rescope$1(editor.getBody(), from.container());\r\n            var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\r\n            var fromLocation = BoundaryLocation.readLocation(isInlineTarget, rootNode, from);\r\n            return fromLocation.bind(function (location) {\r\n                if (forward) {\r\n                    return location.fold(constant(Option.some(BoundaryLocation.inside(location))), Option.none, constant(Option.some(BoundaryLocation.outside(location))), Option.none);\r\n                }\r\n                else {\r\n                    return location.fold(Option.none, constant(Option.some(BoundaryLocation.outside(location))), Option.none, constant(Option.some(BoundaryLocation.inside(location))));\r\n                }\r\n            }).map(setCaretLocation(editor, caret)).getOrThunk(function () {\r\n                var toPosition = CaretFinder.navigate(forward, rootNode, from);\r\n                var toLocation = toPosition.bind(function (pos) {\r\n                    return BoundaryLocation.readLocation(isInlineTarget, rootNode, pos);\r\n                });\r\n                if (fromLocation.isSome() && toLocation.isSome()) {\r\n                    return InlineUtils.findRootInline(isInlineTarget, rootNode, from).map(function (elm) {\r\n                        if (hasOnlyTwoOrLessPositionsLeft(elm)) {\r\n                            DeleteElement.deleteElement(editor, forward, Element.fromDom(elm));\r\n                            return true;\r\n                        }\r\n                        else {\r\n                            return false;\r\n                        }\r\n                    }).getOr(false);\r\n                }\r\n                else {\r\n                    return toLocation.bind(function (_) {\r\n                        return toPosition.map(function (to) {\r\n                            if (forward) {\r\n                                deleteFromTo(editor, caret, from, to);\r\n                            }\r\n                            else {\r\n                                deleteFromTo(editor, caret, to, from);\r\n                            }\r\n                            return true;\r\n                        });\r\n                    }).getOr(false);\r\n                }\r\n            });\r\n        };\r\n        var backspaceDelete$4 = function (editor, caret, forward) {\r\n            if (editor.selection.isCollapsed() && isFeatureEnabled$1(editor)) {\r\n                var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n                return backspaceDeleteCollapsed(editor, caret, forward, from);\r\n            }\r\n            return false;\r\n        };\r\n        var BoundaryDelete = { backspaceDelete: backspaceDelete$4 };\r\n        var getParentInlines = function (rootElm, startElm) {\r\n            var parents = Parents.parentsAndSelf(startElm, rootElm);\r\n            return findIndex(parents, isBlock).fold(constant(parents), function (index) {\r\n                return parents.slice(0, index);\r\n            });\r\n        };\r\n        var hasOnlyOneChild = function (elm) {\r\n            return children(elm).length === 1;\r\n        };\r\n        var deleteLastPosition = function (forward, editor, target, parentInlines) {\r\n            var isFormatElement$1 = curry(isFormatElement, editor);\r\n            var formatNodes = map(filter(parentInlines, isFormatElement$1), function (elm) {\r\n                return elm.dom();\r\n            });\r\n            if (formatNodes.length === 0) {\r\n                DeleteElement.deleteElement(editor, forward, target);\r\n            }\r\n            else {\r\n                var pos = replaceWithCaretFormat(target.dom(), formatNodes);\r\n                editor.selection.setRng(pos.toRange());\r\n            }\r\n        };\r\n        var deleteCaret = function (editor, forward) {\r\n            var rootElm = Element.fromDom(editor.getBody());\r\n            var startElm = Element.fromDom(editor.selection.getStart());\r\n            var parentInlines = filter(getParentInlines(rootElm, startElm), hasOnlyOneChild);\r\n            return last(parentInlines).map(function (target) {\r\n                var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n                if (DeleteUtils.willDeleteLastPositionInElement(forward, fromPos, target.dom()) && !isEmptyCaretFormatElement(target)) {\r\n                    deleteLastPosition(forward, editor, target, parentInlines);\r\n                    return true;\r\n                }\r\n                else {\r\n                    return false;\r\n                }\r\n            }).getOr(false);\r\n        };\r\n        var backspaceDelete$5 = function (editor, forward) {\r\n            return editor.selection.isCollapsed() ? deleteCaret(editor, forward) : false;\r\n        };\r\n        var InlineFormatDelete = { backspaceDelete: backspaceDelete$5 };\r\n        var tableCellRng = Immutable('start', 'end');\r\n        var tableSelection = Immutable('rng', 'table', 'cells');\r\n        var deleteAction = Adt.generate([\r\n            { removeTable: ['element'] },\r\n            { emptyCells: ['cells'] }\r\n        ]);\r\n        var isRootFromElement = function (root) {\r\n            return curry(eq, root);\r\n        };\r\n        var getClosestCell$1 = function (container, isRoot) {\r\n            return closest$1(Element.fromDom(container), 'td,th', isRoot);\r\n        };\r\n        var getClosestTable = function (cell, isRoot) {\r\n            return ancestor$1(cell, 'table', isRoot);\r\n        };\r\n        var isExpandedCellRng = function (cellRng) {\r\n            return eq(cellRng.start(), cellRng.end()) === false;\r\n        };\r\n        var getTableFromCellRng = function (cellRng, isRoot) {\r\n            return getClosestTable(cellRng.start(), isRoot).bind(function (startParentTable) {\r\n                return getClosestTable(cellRng.end(), isRoot).bind(function (endParentTable) {\r\n                    return eq(startParentTable, endParentTable) ? Option.some(startParentTable) : Option.none();\r\n                });\r\n            });\r\n        };\r\n        var getTableCells = function (table) {\r\n            return descendants$1(table, 'td,th');\r\n        };\r\n        var getCellRangeFromStartTable = function (cellRng, isRoot) {\r\n            return getClosestTable(cellRng.start(), isRoot).bind(function (table) {\r\n                return last(getTableCells(table)).map(function (endCell) {\r\n                    return tableCellRng(cellRng.start(), endCell);\r\n                });\r\n            });\r\n        };\r\n        var partialSelection = function (isRoot, rng) {\r\n            var startCell = getClosestCell$1(rng.startContainer, isRoot);\r\n            var endCell = getClosestCell$1(rng.endContainer, isRoot);\r\n            return rng.collapsed ? Option.none() : liftN([\r\n                startCell,\r\n                endCell\r\n            ], tableCellRng).fold(function () {\r\n                return startCell.fold(function () {\r\n                    return endCell.bind(function (endCell) {\r\n                        return getClosestTable(endCell, isRoot).bind(function (table) {\r\n                            return head(getTableCells(table)).map(function (startCell) {\r\n                                return tableCellRng(startCell, endCell);\r\n                            });\r\n                        });\r\n                    });\r\n                }, function (startCell) {\r\n                    return getClosestTable(startCell, isRoot).bind(function (table) {\r\n                        return last(getTableCells(table)).map(function (endCell) {\r\n                            return tableCellRng(startCell, endCell);\r\n                        });\r\n                    });\r\n                });\r\n            }, function (cellRng) {\r\n                return isWithinSameTable(isRoot, cellRng) ? Option.none() : getCellRangeFromStartTable(cellRng, isRoot);\r\n            });\r\n        };\r\n        var isWithinSameTable = function (isRoot, cellRng) {\r\n            return getTableFromCellRng(cellRng, isRoot).isSome();\r\n        };\r\n        var getCellRng = function (rng, isRoot) {\r\n            var startCell = getClosestCell$1(rng.startContainer, isRoot);\r\n            var endCell = getClosestCell$1(rng.endContainer, isRoot);\r\n            return liftN([\r\n                startCell,\r\n                endCell\r\n            ], tableCellRng).filter(isExpandedCellRng).filter(function (cellRng) {\r\n                return isWithinSameTable(isRoot, cellRng);\r\n            }).orThunk(function () {\r\n                return partialSelection(isRoot, rng);\r\n            });\r\n        };\r\n        var getTableSelectionFromCellRng = function (cellRng, isRoot) {\r\n            return getTableFromCellRng(cellRng, isRoot).map(function (table) {\r\n                return tableSelection(cellRng, table, getTableCells(table));\r\n            });\r\n        };\r\n        var getTableSelectionFromRng = function (root, rng) {\r\n            var isRoot = isRootFromElement(root);\r\n            return getCellRng(rng, isRoot).bind(function (cellRng) {\r\n                return getTableSelectionFromCellRng(cellRng, isRoot);\r\n            });\r\n        };\r\n        var getCellIndex = function (cells, cell) {\r\n            return findIndex(cells, function (x) {\r\n                return eq(x, cell);\r\n            });\r\n        };\r\n        var getSelectedCells = function (tableSelection) {\r\n            return liftN([\r\n                getCellIndex(tableSelection.cells(), tableSelection.rng().start()),\r\n                getCellIndex(tableSelection.cells(), tableSelection.rng().end())\r\n            ], function (startIndex, endIndex) {\r\n                return tableSelection.cells().slice(startIndex, endIndex + 1);\r\n            });\r\n        };\r\n        var getAction = function (tableSelection) {\r\n            return getSelectedCells(tableSelection).map(function (selected) {\r\n                var cells = tableSelection.cells();\r\n                return selected.length === cells.length ? deleteAction.removeTable(tableSelection.table()) : deleteAction.emptyCells(selected);\r\n            });\r\n        };\r\n        var getActionFromCells = function (cells) {\r\n            return deleteAction.emptyCells(cells);\r\n        };\r\n        var getActionFromRange = function (root, rng) {\r\n            return getTableSelectionFromRng(root, rng).bind(getAction);\r\n        };\r\n        var TableDeleteAction = {\r\n            getActionFromRange: getActionFromRange,\r\n            getActionFromCells: getActionFromCells\r\n        };\r\n        var emptyCells = function (editor, cells) {\r\n            each(cells, PaddingBr.fillWithPaddingBr);\r\n            editor.selection.setCursorLocation(cells[0].dom(), 0);\r\n            return true;\r\n        };\r\n        var deleteTableElement = function (editor, table) {\r\n            DeleteElement.deleteElement(editor, false, table);\r\n            return true;\r\n        };\r\n        var deleteCellRange = function (editor, rootElm, rng) {\r\n            return TableDeleteAction.getActionFromRange(rootElm, rng).map(function (action) {\r\n                return action.fold(curry(deleteTableElement, editor), curry(emptyCells, editor));\r\n            });\r\n        };\r\n        var deleteCaptionRange = function (editor, caption) {\r\n            return emptyElement(editor, caption);\r\n        };\r\n        var deleteTableRange = function (editor, rootElm, rng, startElm) {\r\n            return getParentCaption(rootElm, startElm).fold(function () {\r\n                return deleteCellRange(editor, rootElm, rng);\r\n            }, function (caption) {\r\n                return deleteCaptionRange(editor, caption);\r\n            }).getOr(false);\r\n        };\r\n        var deleteRange$1 = function (editor, startElm) {\r\n            var rootNode = Element.fromDom(editor.getBody());\r\n            var rng = editor.selection.getRng();\r\n            var selectedCells = TableCellSelection.getCellsFromEditor(editor);\r\n            return selectedCells.length !== 0 ? emptyCells(editor, selectedCells) : deleteTableRange(editor, rootNode, rng, startElm);\r\n        };\r\n        var getParentCell = function (rootElm, elm) {\r\n            return find(Parents.parentsAndSelf(elm, rootElm), isTableCell);\r\n        };\r\n        var getParentCaption = function (rootElm, elm) {\r\n            return find(Parents.parentsAndSelf(elm, rootElm), function (elm) {\r\n                return name(elm) === 'caption';\r\n            });\r\n        };\r\n        var deleteBetweenCells = function (editor, rootElm, forward, fromCell, from) {\r\n            return CaretFinder.navigate(forward, editor.getBody(), from).bind(function (to) {\r\n                return getParentCell(rootElm, Element.fromDom(to.getNode())).map(function (toCell) {\r\n                    return eq(toCell, fromCell) === false;\r\n                });\r\n            });\r\n        };\r\n        var emptyElement = function (editor, elm) {\r\n            PaddingBr.fillWithPaddingBr(elm);\r\n            editor.selection.setCursorLocation(elm.dom(), 0);\r\n            return Option.some(true);\r\n        };\r\n        var isDeleteOfLastCharPos = function (fromCaption, forward, from, to) {\r\n            return CaretFinder.firstPositionIn(fromCaption.dom()).bind(function (first) {\r\n                return CaretFinder.lastPositionIn(fromCaption.dom()).map(function (last) {\r\n                    return forward ? from.isEqual(first) && to.isEqual(last) : from.isEqual(last) && to.isEqual(first);\r\n                });\r\n            }).getOr(true);\r\n        };\r\n        var emptyCaretCaption = function (editor, elm) {\r\n            return emptyElement(editor, elm);\r\n        };\r\n        var validateCaretCaption = function (rootElm, fromCaption, to) {\r\n            return getParentCaption(rootElm, Element.fromDom(to.getNode())).map(function (toCaption) {\r\n                return eq(toCaption, fromCaption) === false;\r\n            });\r\n        };\r\n        var deleteCaretInsideCaption = function (editor, rootElm, forward, fromCaption, from) {\r\n            return CaretFinder.navigate(forward, editor.getBody(), from).bind(function (to) {\r\n                return isDeleteOfLastCharPos(fromCaption, forward, from, to) ? emptyCaretCaption(editor, fromCaption) : validateCaretCaption(rootElm, fromCaption, to);\r\n            }).or(Option.some(true));\r\n        };\r\n        var deleteCaretCells = function (editor, forward, rootElm, startElm) {\r\n            var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            return getParentCell(rootElm, startElm).bind(function (fromCell) {\r\n                return Empty.isEmpty(fromCell) ? emptyElement(editor, fromCell) : deleteBetweenCells(editor, rootElm, forward, fromCell, from);\r\n            }).getOr(false);\r\n        };\r\n        var deleteCaretCaption = function (editor, forward, rootElm, fromCaption) {\r\n            var from = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            return Empty.isEmpty(fromCaption) ? emptyElement(editor, fromCaption) : deleteCaretInsideCaption(editor, rootElm, forward, fromCaption, from);\r\n        };\r\n        var isNearTable = function (forward, pos) {\r\n            return forward ? isBeforeTable(pos) : isAfterTable(pos);\r\n        };\r\n        var isBeforeOrAfterTable = function (editor, forward) {\r\n            var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            return isNearTable(forward, fromPos) || CaretFinder.fromPosition(forward, editor.getBody(), fromPos).map(function (pos) {\r\n                return isNearTable(forward, pos);\r\n            }).getOr(false);\r\n        };\r\n        var deleteCaret$1 = function (editor, forward, startElm) {\r\n            var rootElm = Element.fromDom(editor.getBody());\r\n            return getParentCaption(rootElm, startElm).fold(function () {\r\n                return deleteCaretCells(editor, forward, rootElm, startElm) || isBeforeOrAfterTable(editor, forward);\r\n            }, function (fromCaption) {\r\n                return deleteCaretCaption(editor, forward, rootElm, fromCaption).getOr(false);\r\n            });\r\n        };\r\n        var backspaceDelete$6 = function (editor, forward) {\r\n            var startElm = Element.fromDom(editor.selection.getStart(true));\r\n            var cells = TableCellSelection.getCellsFromEditor(editor);\r\n            return editor.selection.isCollapsed() && cells.length === 0 ? deleteCaret$1(editor, forward, startElm) : deleteRange$1(editor, startElm);\r\n        };\r\n        var TableDelete = { backspaceDelete: backspaceDelete$6 };\r\n        var deleteCaret$2 = function (editor, forward) {\r\n            var fromPos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            return CaretFinder.fromPosition(forward, editor.getBody(), fromPos).filter(function (pos) {\r\n                return forward ? isBeforeImageBlock(pos) : isAfterImageBlock(pos);\r\n            }).bind(function (pos) {\r\n                return Option.from(getChildNodeAtRelativeOffset(forward ? 0 : -1, pos));\r\n            }).map(function (elm) {\r\n                editor.selection.select(elm);\r\n                return true;\r\n            }).getOr(false);\r\n        };\r\n        var backspaceDelete$7 = function (editor, forward) {\r\n            return editor.selection.isCollapsed() ? deleteCaret$2(editor, forward) : false;\r\n        };\r\n        var PageBreakDelete = { backspaceDelete: backspaceDelete$7 };\r\n        var executeKeydownOverride$1 = function (editor, caret, evt) {\r\n            MatchKeys.execute([\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(CefDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(CefDelete.backspaceDelete, editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(CefBoundaryDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(CefBoundaryDelete.backspaceDelete, editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(BoundaryDelete.backspaceDelete, editor, caret, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(BoundaryDelete.backspaceDelete, editor, caret, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(TableDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(TableDelete.backspaceDelete, editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(PageBreakDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(PageBreakDelete.backspaceDelete, editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(BlockRangeDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(BlockRangeDelete.backspaceDelete, editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(BlockBoundaryDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(BlockBoundaryDelete.backspaceDelete, editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(InlineFormatDelete.backspaceDelete, editor, false)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(InlineFormatDelete.backspaceDelete, editor, true)\r\n                }\r\n            ], evt).each(function (_) {\r\n                evt.preventDefault();\r\n            });\r\n        };\r\n        var executeKeyupOverride = function (editor, evt) {\r\n            MatchKeys.execute([\r\n                {\r\n                    keyCode: VK.BACKSPACE,\r\n                    action: MatchKeys.action(CefDelete.paddEmptyElement, editor)\r\n                },\r\n                {\r\n                    keyCode: VK.DELETE,\r\n                    action: MatchKeys.action(CefDelete.paddEmptyElement, editor)\r\n                }\r\n            ], evt);\r\n        };\r\n        var setup$8 = function (editor, caret) {\r\n            editor.on('keydown', function (evt) {\r\n                if (evt.isDefaultPrevented() === false) {\r\n                    executeKeydownOverride$1(editor, caret, evt);\r\n                }\r\n            });\r\n            editor.on('keyup', function (evt) {\r\n                if (evt.isDefaultPrevented() === false) {\r\n                    executeKeyupOverride(editor, evt);\r\n                }\r\n            });\r\n        };\r\n        var DeleteBackspaceKeys = { setup: setup$8 };\r\n        var firstNonWhiteSpaceNodeSibling = function (node) {\r\n            while (node) {\r\n                if (node.nodeType === 1 || node.nodeType === 3 && node.data && /[\\r\\n\\s]/.test(node.data)) {\r\n                    return node;\r\n                }\r\n                node = node.nextSibling;\r\n            }\r\n        };\r\n        var moveToCaretPosition = function (editor, root) {\r\n            var node, rng, lastNode = root;\r\n            var dom = editor.dom;\r\n            var moveCaretBeforeOnEnterElementsMap = editor.schema.getMoveCaretBeforeOnEnterElements();\r\n            if (!root) {\r\n                return;\r\n            }\r\n            if (/^(LI|DT|DD)$/.test(root.nodeName)) {\r\n                var firstChild = firstNonWhiteSpaceNodeSibling(root.firstChild);\r\n                if (firstChild && /^(UL|OL|DL)$/.test(firstChild.nodeName)) {\r\n                    root.insertBefore(dom.doc.createTextNode('\\xA0'), root.firstChild);\r\n                }\r\n            }\r\n            rng = dom.createRng();\r\n            root.normalize();\r\n            if (root.hasChildNodes()) {\r\n                var walker = new TreeWalker(root, root);\r\n                while (node = walker.current()) {\r\n                    if (NodeType.isText(node)) {\r\n                        rng.setStart(node, 0);\r\n                        rng.setEnd(node, 0);\r\n                        break;\r\n                    }\r\n                    if (moveCaretBeforeOnEnterElementsMap[node.nodeName.toLowerCase()]) {\r\n                        rng.setStartBefore(node);\r\n                        rng.setEndBefore(node);\r\n                        break;\r\n                    }\r\n                    lastNode = node;\r\n                    node = walker.next();\r\n                }\r\n                if (!node) {\r\n                    rng.setStart(lastNode, 0);\r\n                    rng.setEnd(lastNode, 0);\r\n                }\r\n            }\r\n            else {\r\n                if (NodeType.isBr(root)) {\r\n                    if (root.nextSibling && dom.isBlock(root.nextSibling)) {\r\n                        rng.setStartBefore(root);\r\n                        rng.setEndBefore(root);\r\n                    }\r\n                    else {\r\n                        rng.setStartAfter(root);\r\n                        rng.setEndAfter(root);\r\n                    }\r\n                }\r\n                else {\r\n                    rng.setStart(root, 0);\r\n                    rng.setEnd(root, 0);\r\n                }\r\n            }\r\n            editor.selection.setRng(rng);\r\n            editor.selection.scrollIntoView(root);\r\n        };\r\n        var getEditableRoot = function (dom, node) {\r\n            var root = dom.getRoot();\r\n            var parent, editableRoot;\r\n            parent = node;\r\n            while (parent !== root && dom.getContentEditable(parent) !== 'false') {\r\n                if (dom.getContentEditable(parent) === 'true') {\r\n                    editableRoot = parent;\r\n                }\r\n                parent = parent.parentNode;\r\n            }\r\n            return parent !== root ? editableRoot : root;\r\n        };\r\n        var getParentBlock$2 = function (editor) {\r\n            return Option.from(editor.dom.getParent(editor.selection.getStart(true), editor.dom.isBlock));\r\n        };\r\n        var getParentBlockName = function (editor) {\r\n            return getParentBlock$2(editor).fold(constant(''), function (parentBlock) {\r\n                return parentBlock.nodeName.toUpperCase();\r\n            });\r\n        };\r\n        var isListItemParentBlock = function (editor) {\r\n            return getParentBlock$2(editor).filter(function (elm) {\r\n                return isListItem(Element.fromDom(elm));\r\n            }).isSome();\r\n        };\r\n        var NewLineUtils = {\r\n            moveToCaretPosition: moveToCaretPosition,\r\n            getEditableRoot: getEditableRoot,\r\n            getParentBlock: getParentBlock$2,\r\n            getParentBlockName: getParentBlockName,\r\n            isListItemParentBlock: isListItemParentBlock\r\n        };\r\n        var hasFirstChild = function (elm, name) {\r\n            return elm.firstChild && elm.firstChild.nodeName === name;\r\n        };\r\n        var hasParent$1 = function (elm, parentName) {\r\n            return elm && elm.parentNode && elm.parentNode.nodeName === parentName;\r\n        };\r\n        var isListBlock = function (elm) {\r\n            return elm && /^(OL|UL|LI)$/.test(elm.nodeName);\r\n        };\r\n        var isNestedList = function (elm) {\r\n            return isListBlock(elm) && isListBlock(elm.parentNode);\r\n        };\r\n        var getContainerBlock = function (containerBlock) {\r\n            var containerBlockParent = containerBlock.parentNode;\r\n            if (/^(LI|DT|DD)$/.test(containerBlockParent.nodeName)) {\r\n                return containerBlockParent;\r\n            }\r\n            return containerBlock;\r\n        };\r\n        var isFirstOrLastLi = function (containerBlock, parentBlock, first) {\r\n            var node = containerBlock[first ? 'firstChild' : 'lastChild'];\r\n            while (node) {\r\n                if (NodeType.isElement(node)) {\r\n                    break;\r\n                }\r\n                node = node[first ? 'nextSibling' : 'previousSibling'];\r\n            }\r\n            return node === parentBlock;\r\n        };\r\n        var insert = function (editor, createNewBlock, containerBlock, parentBlock, newBlockName) {\r\n            var dom = editor.dom;\r\n            var rng = editor.selection.getRng();\r\n            if (containerBlock === editor.getBody()) {\r\n                return;\r\n            }\r\n            if (isNestedList(containerBlock)) {\r\n                newBlockName = 'LI';\r\n            }\r\n            var newBlock = newBlockName ? createNewBlock(newBlockName) : dom.create('BR');\r\n            if (isFirstOrLastLi(containerBlock, parentBlock, true) && isFirstOrLastLi(containerBlock, parentBlock, false)) {\r\n                if (hasParent$1(containerBlock, 'LI')) {\r\n                    dom.insertAfter(newBlock, getContainerBlock(containerBlock));\r\n                }\r\n                else {\r\n                    dom.replace(newBlock, containerBlock);\r\n                }\r\n            }\r\n            else if (isFirstOrLastLi(containerBlock, parentBlock, true)) {\r\n                if (hasParent$1(containerBlock, 'LI')) {\r\n                    dom.insertAfter(newBlock, getContainerBlock(containerBlock));\r\n                    newBlock.appendChild(dom.doc.createTextNode(' '));\r\n                    newBlock.appendChild(containerBlock);\r\n                }\r\n                else {\r\n                    containerBlock.parentNode.insertBefore(newBlock, containerBlock);\r\n                }\r\n            }\r\n            else if (isFirstOrLastLi(containerBlock, parentBlock, false)) {\r\n                dom.insertAfter(newBlock, getContainerBlock(containerBlock));\r\n            }\r\n            else {\r\n                containerBlock = getContainerBlock(containerBlock);\r\n                var tmpRng = rng.cloneRange();\r\n                tmpRng.setStartAfter(parentBlock);\r\n                tmpRng.setEndAfter(containerBlock);\r\n                var fragment = tmpRng.extractContents();\r\n                if (newBlockName === 'LI' && hasFirstChild(fragment, 'LI')) {\r\n                    newBlock = fragment.firstChild;\r\n                    dom.insertAfter(fragment, containerBlock);\r\n                }\r\n                else {\r\n                    dom.insertAfter(fragment, containerBlock);\r\n                    dom.insertAfter(newBlock, containerBlock);\r\n                }\r\n            }\r\n            dom.remove(parentBlock);\r\n            NewLineUtils.moveToCaretPosition(editor, newBlock);\r\n        };\r\n        var InsertLi = { insert: insert };\r\n        var trimZwsp = function (fragment) {\r\n            each(descendants(Element.fromDom(fragment), isText), function (text) {\r\n                var rawNode = text.dom();\r\n                rawNode.nodeValue = Zwsp.trim(rawNode.nodeValue);\r\n            });\r\n        };\r\n        var isEmptyAnchor = function (dom, elm) {\r\n            return elm && elm.nodeName === 'A' && dom.isEmpty(elm);\r\n        };\r\n        var isTableCell$4 = function (node) {\r\n            return node && /^(TD|TH|CAPTION)$/.test(node.nodeName);\r\n        };\r\n        var emptyBlock = function (elm) {\r\n            elm.innerHTML = '<br data-mce-bogus=\"1\">';\r\n        };\r\n        var containerAndSiblingName = function (container, nodeName) {\r\n            return container.nodeName === nodeName || container.previousSibling && container.previousSibling.nodeName === nodeName;\r\n        };\r\n        var canSplitBlock = function (dom, node) {\r\n            return node && dom.isBlock(node) && !/^(TD|TH|CAPTION|FORM)$/.test(node.nodeName) && !/^(fixed|absolute)/i.test(node.style.position) && dom.getContentEditable(node) !== 'true';\r\n        };\r\n        var trimInlineElementsOnLeftSideOfBlock = function (dom, nonEmptyElementsMap, block) {\r\n            var node = block;\r\n            var firstChilds = [];\r\n            var i;\r\n            if (!node) {\r\n                return;\r\n            }\r\n            while (node = node.firstChild) {\r\n                if (dom.isBlock(node)) {\r\n                    return;\r\n                }\r\n                if (NodeType.isElement(node) && !nonEmptyElementsMap[node.nodeName.toLowerCase()]) {\r\n                    firstChilds.push(node);\r\n                }\r\n            }\r\n            i = firstChilds.length;\r\n            while (i--) {\r\n                node = firstChilds[i];\r\n                if (!node.hasChildNodes() || node.firstChild === node.lastChild && node.firstChild.nodeValue === '') {\r\n                    dom.remove(node);\r\n                }\r\n                else {\r\n                    if (isEmptyAnchor(dom, node)) {\r\n                        dom.remove(node);\r\n                    }\r\n                }\r\n            }\r\n        };\r\n        var normalizeZwspOffset = function (start, container, offset) {\r\n            if (NodeType.isText(container) === false) {\r\n                return offset;\r\n            }\r\n            else if (start) {\r\n                return offset === 1 && container.data.charAt(offset - 1) === Zwsp.ZWSP ? 0 : offset;\r\n            }\r\n            else {\r\n                return offset === container.data.length - 1 && container.data.charAt(offset) === Zwsp.ZWSP ? container.data.length : offset;\r\n            }\r\n        };\r\n        var includeZwspInRange = function (rng) {\r\n            var newRng = rng.cloneRange();\r\n            newRng.setStart(rng.startContainer, normalizeZwspOffset(true, rng.startContainer, rng.startOffset));\r\n            newRng.setEnd(rng.endContainer, normalizeZwspOffset(false, rng.endContainer, rng.endOffset));\r\n            return newRng;\r\n        };\r\n        var trimLeadingLineBreaks = function (node) {\r\n            do {\r\n                if (NodeType.isText(node)) {\r\n                    node.nodeValue = node.nodeValue.replace(/^[\\r\\n]+/, '');\r\n                }\r\n                node = node.firstChild;\r\n            } while (node);\r\n        };\r\n        var getEditableRoot$1 = function (dom, node) {\r\n            var root = dom.getRoot();\r\n            var parent, editableRoot;\r\n            parent = node;\r\n            while (parent !== root && dom.getContentEditable(parent) !== 'false') {\r\n                if (dom.getContentEditable(parent) === 'true') {\r\n                    editableRoot = parent;\r\n                }\r\n                parent = parent.parentNode;\r\n            }\r\n            return parent !== root ? editableRoot : root;\r\n        };\r\n        var setForcedBlockAttrs = function (editor, node) {\r\n            var forcedRootBlockName = Settings.getForcedRootBlock(editor);\r\n            if (forcedRootBlockName && forcedRootBlockName.toLowerCase() === node.tagName.toLowerCase()) {\r\n                editor.dom.setAttribs(node, Settings.getForcedRootBlockAttrs(editor));\r\n            }\r\n        };\r\n        var wrapSelfAndSiblingsInDefaultBlock = function (editor, newBlockName, rng, container, offset) {\r\n            var newBlock, parentBlock, startNode, node, next, rootBlockName;\r\n            var blockName = newBlockName || 'P';\r\n            var dom = editor.dom, editableRoot = getEditableRoot$1(dom, container);\r\n            parentBlock = dom.getParent(container, dom.isBlock);\r\n            if (!parentBlock || !canSplitBlock(dom, parentBlock)) {\r\n                parentBlock = parentBlock || editableRoot;\r\n                if (parentBlock === editor.getBody() || isTableCell$4(parentBlock)) {\r\n                    rootBlockName = parentBlock.nodeName.toLowerCase();\r\n                }\r\n                else {\r\n                    rootBlockName = parentBlock.parentNode.nodeName.toLowerCase();\r\n                }\r\n                if (!parentBlock.hasChildNodes()) {\r\n                    newBlock = dom.create(blockName);\r\n                    setForcedBlockAttrs(editor, newBlock);\r\n                    parentBlock.appendChild(newBlock);\r\n                    rng.setStart(newBlock, 0);\r\n                    rng.setEnd(newBlock, 0);\r\n                    return newBlock;\r\n                }\r\n                node = container;\r\n                while (node.parentNode !== parentBlock) {\r\n                    node = node.parentNode;\r\n                }\r\n                while (node && !dom.isBlock(node)) {\r\n                    startNode = node;\r\n                    node = node.previousSibling;\r\n                }\r\n                if (startNode && editor.schema.isValidChild(rootBlockName, blockName.toLowerCase())) {\r\n                    newBlock = dom.create(blockName);\r\n                    setForcedBlockAttrs(editor, newBlock);\r\n                    startNode.parentNode.insertBefore(newBlock, startNode);\r\n                    node = startNode;\r\n                    while (node && !dom.isBlock(node)) {\r\n                        next = node.nextSibling;\r\n                        newBlock.appendChild(node);\r\n                        node = next;\r\n                    }\r\n                    rng.setStart(container, offset);\r\n                    rng.setEnd(container, offset);\r\n                }\r\n            }\r\n            return container;\r\n        };\r\n        var addBrToBlockIfNeeded = function (dom, block) {\r\n            var lastChild;\r\n            block.normalize();\r\n            lastChild = block.lastChild;\r\n            if (!lastChild || /^(left|right)$/gi.test(dom.getStyle(lastChild, 'float', true))) {\r\n                dom.add(block, 'br');\r\n            }\r\n        };\r\n        var insert$1 = function (editor, evt) {\r\n            var tmpRng, editableRoot, container, offset, parentBlock, shiftKey;\r\n            var newBlock, fragment, containerBlock, parentBlockName, containerBlockName, newBlockName, isAfterLastNodeInContainer;\r\n            var dom = editor.dom;\r\n            var schema = editor.schema, nonEmptyElementsMap = schema.getNonEmptyElements();\r\n            var rng = editor.selection.getRng();\r\n            var createNewBlock = function (name) {\r\n                var node = container, block, clonedNode, caretNode;\r\n                var textInlineElements = schema.getTextInlineElements();\r\n                if (name || parentBlockName === 'TABLE' || parentBlockName === 'HR') {\r\n                    block = dom.create(name || newBlockName);\r\n                    setForcedBlockAttrs(editor, block);\r\n                }\r\n                else {\r\n                    block = parentBlock.cloneNode(false);\r\n                }\r\n                caretNode = block;\r\n                if (Settings.shouldKeepStyles(editor) === false) {\r\n                    dom.setAttrib(block, 'style', null);\r\n                    dom.setAttrib(block, 'class', null);\r\n                }\r\n                else {\r\n                    do {\r\n                        if (textInlineElements[node.nodeName]) {\r\n                            if (isCaretNode(node) || Bookmarks.isBookmarkNode(node)) {\r\n                                continue;\r\n                            }\r\n                            clonedNode = node.cloneNode(false);\r\n                            dom.setAttrib(clonedNode, 'id', '');\r\n                            if (block.hasChildNodes()) {\r\n                                clonedNode.appendChild(block.firstChild);\r\n                                block.appendChild(clonedNode);\r\n                            }\r\n                            else {\r\n                                caretNode = clonedNode;\r\n                                block.appendChild(clonedNode);\r\n                            }\r\n                        }\r\n                    } while ((node = node.parentNode) && node !== editableRoot);\r\n                }\r\n                emptyBlock(caretNode);\r\n                return block;\r\n            };\r\n            var isCaretAtStartOrEndOfBlock = function (start) {\r\n                var node, name;\r\n                var normalizedOffset = normalizeZwspOffset(start, container, offset);\r\n                if (NodeType.isText(container) && (start ? normalizedOffset > 0 : normalizedOffset < container.nodeValue.length)) {\r\n                    return false;\r\n                }\r\n                if (container.parentNode === parentBlock && isAfterLastNodeInContainer && !start) {\r\n                    return true;\r\n                }\r\n                if (start && NodeType.isElement(container) && container === parentBlock.firstChild) {\r\n                    return true;\r\n                }\r\n                if (containerAndSiblingName(container, 'TABLE') || containerAndSiblingName(container, 'HR')) {\r\n                    return isAfterLastNodeInContainer && !start || !isAfterLastNodeInContainer && start;\r\n                }\r\n                var walker = new TreeWalker(container, parentBlock);\r\n                if (NodeType.isText(container)) {\r\n                    if (start && normalizedOffset === 0) {\r\n                        walker.prev();\r\n                    }\r\n                    else if (!start && normalizedOffset === container.nodeValue.length) {\r\n                        walker.next();\r\n                    }\r\n                }\r\n                while (node = walker.current()) {\r\n                    if (NodeType.isElement(node)) {\r\n                        if (!node.getAttribute('data-mce-bogus')) {\r\n                            name = node.nodeName.toLowerCase();\r\n                            if (nonEmptyElementsMap[name] && name !== 'br') {\r\n                                return false;\r\n                            }\r\n                        }\r\n                    }\r\n                    else if (NodeType.isText(node) && !/^[ \\t\\r\\n]*$/.test(node.nodeValue)) {\r\n                        return false;\r\n                    }\r\n                    if (start) {\r\n                        walker.prev();\r\n                    }\r\n                    else {\r\n                        walker.next();\r\n                    }\r\n                }\r\n                return true;\r\n            };\r\n            var insertNewBlockAfter = function () {\r\n                if (/^(H[1-6]|PRE|FIGURE)$/.test(parentBlockName) && containerBlockName !== 'HGROUP') {\r\n                    newBlock = createNewBlock(newBlockName);\r\n                }\r\n                else {\r\n                    newBlock = createNewBlock();\r\n                }\r\n                if (Settings.shouldEndContainerOnEmptyBlock(editor) && canSplitBlock(dom, containerBlock) && dom.isEmpty(parentBlock)) {\r\n                    newBlock = dom.split(containerBlock, parentBlock);\r\n                }\r\n                else {\r\n                    dom.insertAfter(newBlock, parentBlock);\r\n                }\r\n                NewLineUtils.moveToCaretPosition(editor, newBlock);\r\n            };\r\n            NormalizeRange.normalize(dom, rng).each(function (normRng) {\r\n                rng.setStart(normRng.startContainer, normRng.startOffset);\r\n                rng.setEnd(normRng.endContainer, normRng.endOffset);\r\n            });\r\n            container = rng.startContainer;\r\n            offset = rng.startOffset;\r\n            newBlockName = Settings.getForcedRootBlock(editor);\r\n            shiftKey = !!(evt && evt.shiftKey);\r\n            var ctrlKey = !!(evt && evt.ctrlKey);\r\n            if (NodeType.isElement(container) && container.hasChildNodes()) {\r\n                isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\r\n                container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\r\n                if (isAfterLastNodeInContainer && NodeType.isText(container)) {\r\n                    offset = container.nodeValue.length;\r\n                }\r\n                else {\r\n                    offset = 0;\r\n                }\r\n            }\r\n            editableRoot = getEditableRoot$1(dom, container);\r\n            if (!editableRoot) {\r\n                return;\r\n            }\r\n            if (newBlockName && !shiftKey || !newBlockName && shiftKey) {\r\n                container = wrapSelfAndSiblingsInDefaultBlock(editor, newBlockName, rng, container, offset);\r\n            }\r\n            parentBlock = dom.getParent(container, dom.isBlock);\r\n            containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\r\n            parentBlockName = parentBlock ? parentBlock.nodeName.toUpperCase() : '';\r\n            containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\r\n            if (containerBlockName === 'LI' && !ctrlKey) {\r\n                parentBlock = containerBlock;\r\n                containerBlock = containerBlock.parentNode;\r\n                parentBlockName = containerBlockName;\r\n            }\r\n            if (/^(LI|DT|DD)$/.test(parentBlockName)) {\r\n                if (dom.isEmpty(parentBlock)) {\r\n                    InsertLi.insert(editor, createNewBlock, containerBlock, parentBlock, newBlockName);\r\n                    return;\r\n                }\r\n            }\r\n            if (newBlockName && parentBlock === editor.getBody()) {\r\n                return;\r\n            }\r\n            newBlockName = newBlockName || 'P';\r\n            if (isCaretContainerBlock(parentBlock)) {\r\n                newBlock = showCaretContainerBlock(parentBlock);\r\n                if (dom.isEmpty(parentBlock)) {\r\n                    emptyBlock(parentBlock);\r\n                }\r\n                NewLineUtils.moveToCaretPosition(editor, newBlock);\r\n            }\r\n            else if (isCaretAtStartOrEndOfBlock()) {\r\n                insertNewBlockAfter();\r\n            }\r\n            else if (isCaretAtStartOrEndOfBlock(true)) {\r\n                newBlock = parentBlock.parentNode.insertBefore(createNewBlock(), parentBlock);\r\n                NewLineUtils.moveToCaretPosition(editor, containerAndSiblingName(parentBlock, 'HR') ? newBlock : parentBlock);\r\n            }\r\n            else {\r\n                tmpRng = includeZwspInRange(rng).cloneRange();\r\n                tmpRng.setEndAfter(parentBlock);\r\n                fragment = tmpRng.extractContents();\r\n                trimZwsp(fragment);\r\n                trimLeadingLineBreaks(fragment);\r\n                newBlock = fragment.firstChild;\r\n                dom.insertAfter(fragment, parentBlock);\r\n                trimInlineElementsOnLeftSideOfBlock(dom, nonEmptyElementsMap, newBlock);\r\n                addBrToBlockIfNeeded(dom, parentBlock);\r\n                if (dom.isEmpty(parentBlock)) {\r\n                    emptyBlock(parentBlock);\r\n                }\r\n                newBlock.normalize();\r\n                if (dom.isEmpty(newBlock)) {\r\n                    dom.remove(newBlock);\r\n                    insertNewBlockAfter();\r\n                }\r\n                else {\r\n                    NewLineUtils.moveToCaretPosition(editor, newBlock);\r\n                }\r\n            }\r\n            dom.setAttrib(newBlock, 'id', '');\r\n            editor.fire('NewBlock', { newBlock: newBlock });\r\n        };\r\n        var InsertBlock = { insert: insert$1 };\r\n        var hasRightSideContent = function (schema, container, parentBlock) {\r\n            var walker = new TreeWalker(container, parentBlock);\r\n            var node;\r\n            var nonEmptyElementsMap = schema.getNonEmptyElements();\r\n            while (node = walker.next()) {\r\n                if (nonEmptyElementsMap[node.nodeName.toLowerCase()] || node.length > 0) {\r\n                    return true;\r\n                }\r\n            }\r\n        };\r\n        var scrollToBr = function (dom, selection, brElm) {\r\n            var marker = dom.create('span', {}, '&nbsp;');\r\n            brElm.parentNode.insertBefore(marker, brElm);\r\n            selection.scrollIntoView(marker);\r\n            dom.remove(marker);\r\n        };\r\n        var moveSelectionToBr = function (dom, selection, brElm, extraBr) {\r\n            var rng = dom.createRng();\r\n            if (!extraBr) {\r\n                rng.setStartAfter(brElm);\r\n                rng.setEndAfter(brElm);\r\n            }\r\n            else {\r\n                rng.setStartBefore(brElm);\r\n                rng.setEndBefore(brElm);\r\n            }\r\n            selection.setRng(rng);\r\n        };\r\n        var insertBrAtCaret = function (editor, evt) {\r\n            var selection = editor.selection;\r\n            var dom = editor.dom;\r\n            var rng = selection.getRng();\r\n            var brElm;\r\n            var extraBr;\r\n            NormalizeRange.normalize(dom, rng).each(function (normRng) {\r\n                rng.setStart(normRng.startContainer, normRng.startOffset);\r\n                rng.setEnd(normRng.endContainer, normRng.endOffset);\r\n            });\r\n            var offset = rng.startOffset;\r\n            var container = rng.startContainer;\r\n            if (container.nodeType === 1 && container.hasChildNodes()) {\r\n                var isAfterLastNodeInContainer = offset > container.childNodes.length - 1;\r\n                container = container.childNodes[Math.min(offset, container.childNodes.length - 1)] || container;\r\n                if (isAfterLastNodeInContainer && container.nodeType === 3) {\r\n                    offset = container.nodeValue.length;\r\n                }\r\n                else {\r\n                    offset = 0;\r\n                }\r\n            }\r\n            var parentBlock = dom.getParent(container, dom.isBlock);\r\n            var containerBlock = parentBlock ? dom.getParent(parentBlock.parentNode, dom.isBlock) : null;\r\n            var containerBlockName = containerBlock ? containerBlock.nodeName.toUpperCase() : '';\r\n            var isControlKey = !!(evt && evt.ctrlKey);\r\n            if (containerBlockName === 'LI' && !isControlKey) {\r\n                parentBlock = containerBlock;\r\n            }\r\n            if (container && container.nodeType === 3 && offset >= container.nodeValue.length) {\r\n                if (!hasRightSideContent(editor.schema, container, parentBlock)) {\r\n                    brElm = dom.create('br');\r\n                    rng.insertNode(brElm);\r\n                    rng.setStartAfter(brElm);\r\n                    rng.setEndAfter(brElm);\r\n                    extraBr = true;\r\n                }\r\n            }\r\n            brElm = dom.create('br');\r\n            rangeInsertNode(dom, rng, brElm);\r\n            scrollToBr(dom, selection, brElm);\r\n            moveSelectionToBr(dom, selection, brElm, extraBr);\r\n            editor.undoManager.add();\r\n        };\r\n        var insertBrBefore = function (editor, inline) {\r\n            var br = Element.fromTag('br');\r\n            before(Element.fromDom(inline), br);\r\n            editor.undoManager.add();\r\n        };\r\n        var insertBrAfter = function (editor, inline) {\r\n            if (!hasBrAfter(editor.getBody(), inline)) {\r\n                after(Element.fromDom(inline), Element.fromTag('br'));\r\n            }\r\n            var br = Element.fromTag('br');\r\n            after(Element.fromDom(inline), br);\r\n            scrollToBr(editor.dom, editor.selection, br.dom());\r\n            moveSelectionToBr(editor.dom, editor.selection, br.dom(), false);\r\n            editor.undoManager.add();\r\n        };\r\n        var isBeforeBr$1 = function (pos) {\r\n            return NodeType.isBr(pos.getNode());\r\n        };\r\n        var hasBrAfter = function (rootNode, startNode) {\r\n            if (isBeforeBr$1(CaretPosition$1.after(startNode))) {\r\n                return true;\r\n            }\r\n            else {\r\n                return CaretFinder.nextPosition(rootNode, CaretPosition$1.after(startNode)).map(function (pos) {\r\n                    return NodeType.isBr(pos.getNode());\r\n                }).getOr(false);\r\n            }\r\n        };\r\n        var isAnchorLink = function (elm) {\r\n            return elm && elm.nodeName === 'A' && 'href' in elm;\r\n        };\r\n        var isInsideAnchor = function (location) {\r\n            return location.fold(constant(false), isAnchorLink, isAnchorLink, constant(false));\r\n        };\r\n        var readInlineAnchorLocation = function (editor) {\r\n            var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\r\n            var position = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            return BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), position).filter(isInsideAnchor);\r\n        };\r\n        var insertBrOutsideAnchor = function (editor, location) {\r\n            location.fold(noop, curry(insertBrBefore, editor), curry(insertBrAfter, editor), noop);\r\n        };\r\n        var insert$2 = function (editor, evt) {\r\n            var anchorLocation = readInlineAnchorLocation(editor);\r\n            if (anchorLocation.isSome()) {\r\n                anchorLocation.each(curry(insertBrOutsideAnchor, editor));\r\n            }\r\n            else {\r\n                insertBrAtCaret(editor, evt);\r\n            }\r\n        };\r\n        var InsertBr = { insert: insert$2 };\r\n        var matchesSelector = function (editor, selector) {\r\n            return NewLineUtils.getParentBlock(editor).filter(function (parentBlock) {\r\n                return selector.length > 0 && is$1(Element.fromDom(parentBlock), selector);\r\n            }).isSome();\r\n        };\r\n        var shouldInsertBr = function (editor) {\r\n            return matchesSelector(editor, Settings.getBrNewLineSelector(editor));\r\n        };\r\n        var shouldBlockNewLine = function (editor) {\r\n            return matchesSelector(editor, Settings.getNoNewLineSelector(editor));\r\n        };\r\n        var ContextSelectors = {\r\n            shouldInsertBr: shouldInsertBr,\r\n            shouldBlockNewLine: shouldBlockNewLine\r\n        };\r\n        var newLineAction = Adt.generate([\r\n            { br: [] },\r\n            { block: [] },\r\n            { none: [] }\r\n        ]);\r\n        var shouldBlockNewLine$1 = function (editor, shiftKey) {\r\n            return ContextSelectors.shouldBlockNewLine(editor);\r\n        };\r\n        var isBrMode = function (requiredState) {\r\n            return function (editor, shiftKey) {\r\n                var brMode = Settings.getForcedRootBlock(editor) === '';\r\n                return brMode === requiredState;\r\n            };\r\n        };\r\n        var inListBlock = function (requiredState) {\r\n            return function (editor, shiftKey) {\r\n                return NewLineUtils.isListItemParentBlock(editor) === requiredState;\r\n            };\r\n        };\r\n        var inBlock = function (blockName, requiredState) {\r\n            return function (editor, shiftKey) {\r\n                var state = NewLineUtils.getParentBlockName(editor) === blockName.toUpperCase();\r\n                return state === requiredState;\r\n            };\r\n        };\r\n        var inPreBlock = function (requiredState) {\r\n            return inBlock('pre', requiredState);\r\n        };\r\n        var inSummaryBlock = function () {\r\n            return inBlock('summary', true);\r\n        };\r\n        var shouldPutBrInPre$1 = function (requiredState) {\r\n            return function (editor, shiftKey) {\r\n                return Settings.shouldPutBrInPre(editor) === requiredState;\r\n            };\r\n        };\r\n        var inBrContext = function (editor, shiftKey) {\r\n            return ContextSelectors.shouldInsertBr(editor);\r\n        };\r\n        var hasShiftKey = function (editor, shiftKey) {\r\n            return shiftKey;\r\n        };\r\n        var canInsertIntoEditableRoot = function (editor) {\r\n            var forcedRootBlock = Settings.getForcedRootBlock(editor);\r\n            var rootEditable = NewLineUtils.getEditableRoot(editor.dom, editor.selection.getStart());\r\n            return rootEditable && editor.schema.isValidChild(rootEditable.nodeName, forcedRootBlock ? forcedRootBlock : 'P');\r\n        };\r\n        var match$2 = function (predicates, action) {\r\n            return function (editor, shiftKey) {\r\n                var isMatch = foldl(predicates, function (res, p) {\r\n                    return res && p(editor, shiftKey);\r\n                }, true);\r\n                return isMatch ? Option.some(action) : Option.none();\r\n            };\r\n        };\r\n        var getAction$1 = function (editor, evt) {\r\n            return LazyEvaluator.evaluateUntil([\r\n                match$2([shouldBlockNewLine$1], newLineAction.none()),\r\n                match$2([inSummaryBlock()], newLineAction.br()),\r\n                match$2([\r\n                    inPreBlock(true),\r\n                    shouldPutBrInPre$1(false),\r\n                    hasShiftKey\r\n                ], newLineAction.br()),\r\n                match$2([\r\n                    inPreBlock(true),\r\n                    shouldPutBrInPre$1(false)\r\n                ], newLineAction.block()),\r\n                match$2([\r\n                    inPreBlock(true),\r\n                    shouldPutBrInPre$1(true),\r\n                    hasShiftKey\r\n                ], newLineAction.block()),\r\n                match$2([\r\n                    inPreBlock(true),\r\n                    shouldPutBrInPre$1(true)\r\n                ], newLineAction.br()),\r\n                match$2([\r\n                    inListBlock(true),\r\n                    hasShiftKey\r\n                ], newLineAction.br()),\r\n                match$2([inListBlock(true)], newLineAction.block()),\r\n                match$2([\r\n                    isBrMode(true),\r\n                    hasShiftKey,\r\n                    canInsertIntoEditableRoot\r\n                ], newLineAction.block()),\r\n                match$2([isBrMode(true)], newLineAction.br()),\r\n                match$2([inBrContext], newLineAction.br()),\r\n                match$2([\r\n                    isBrMode(false),\r\n                    hasShiftKey\r\n                ], newLineAction.br()),\r\n                match$2([canInsertIntoEditableRoot], newLineAction.block())\r\n            ], [\r\n                editor,\r\n                !!(evt && evt.shiftKey)\r\n            ]).getOr(newLineAction.none());\r\n        };\r\n        var NewLineAction = { getAction: getAction$1 };\r\n        var insert$3 = function (editor, evt) {\r\n            NewLineAction.getAction(editor, evt).fold(function () {\r\n                InsertBr.insert(editor, evt);\r\n            }, function () {\r\n                InsertBlock.insert(editor, evt);\r\n            }, noop);\r\n        };\r\n        var InsertNewLine = { insert: insert$3 };\r\n        var endTypingLevel = function (undoManager) {\r\n            if (undoManager.typing) {\r\n                undoManager.typing = false;\r\n                undoManager.add();\r\n            }\r\n        };\r\n        var handleEnterKeyEvent = function (editor, event) {\r\n            if (event.isDefaultPrevented()) {\r\n                return;\r\n            }\r\n            event.preventDefault();\r\n            endTypingLevel(editor.undoManager);\r\n            editor.undoManager.transact(function () {\r\n                if (editor.selection.isCollapsed() === false) {\r\n                    editor.execCommand('Delete');\r\n                }\r\n                InsertNewLine.insert(editor, event);\r\n            });\r\n        };\r\n        var setup$9 = function (editor) {\r\n            editor.on('keydown', function (event) {\r\n                if (event.keyCode === VK.ENTER) {\r\n                    handleEnterKeyEvent(editor, event);\r\n                }\r\n            });\r\n        };\r\n        var EnterKey = { setup: setup$9 };\r\n        var insertTextAtPosition = function (text, pos) {\r\n            var container = pos.container();\r\n            var offset = pos.offset();\r\n            if (NodeType.isText(container)) {\r\n                container.insertData(offset, text);\r\n                return Option.some(CaretPosition(container, offset + text.length));\r\n            }\r\n            else {\r\n                return getElementFromPosition(pos).map(function (elm) {\r\n                    var textNode = Element.fromText(text);\r\n                    if (pos.isAtEnd()) {\r\n                        after(elm, textNode);\r\n                    }\r\n                    else {\r\n                        before(elm, textNode);\r\n                    }\r\n                    return CaretPosition(textNode.dom(), text.length);\r\n                });\r\n            }\r\n        };\r\n        var insertNbspAtPosition = curry(insertTextAtPosition, '\\xA0');\r\n        var insertSpaceAtPosition = curry(insertTextAtPosition, ' ');\r\n        var navigateIgnoreEmptyTextNodes = function (forward, root, from) {\r\n            return CaretFinder.navigateIgnore(forward, root, from, isEmptyText);\r\n        };\r\n        var isAtBlockBoundary = function (forward, root, pos) {\r\n            var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\r\n            return head(parentBlocks).fold(function () {\r\n                return navigateIgnoreEmptyTextNodes(forward, root.dom(), pos).forall(function (newPos) {\r\n                    return isInSameBlock(newPos, pos, root.dom()) === false;\r\n                });\r\n            }, function (parent) {\r\n                return navigateIgnoreEmptyTextNodes(forward, parent.dom(), pos).isNone();\r\n            });\r\n        };\r\n        var isAtStartOfBlock = curry(isAtBlockBoundary, false);\r\n        var isAtEndOfBlock = curry(isAtBlockBoundary, true);\r\n        var nbsp = '\\xA0';\r\n        var isInMiddleOfText = function (pos) {\r\n            return CaretPosition.isTextPosition(pos) && !pos.isAtStart() && !pos.isAtEnd();\r\n        };\r\n        var getClosestBlock = function (root, pos) {\r\n            var parentBlocks = filter(Parents.parentsAndSelf(Element.fromDom(pos.container()), root), isBlock);\r\n            return head(parentBlocks).getOr(root);\r\n        };\r\n        var hasSpaceBefore = function (root, pos) {\r\n            if (isInMiddleOfText(pos)) {\r\n                return isAfterSpace(pos);\r\n            }\r\n            else {\r\n                return isAfterSpace(pos) || CaretFinder.prevPosition(getClosestBlock(root, pos).dom(), pos).exists(isAfterSpace);\r\n            }\r\n        };\r\n        var hasSpaceAfter = function (root, pos) {\r\n            if (isInMiddleOfText(pos)) {\r\n                return isBeforeSpace(pos);\r\n            }\r\n            else {\r\n                return isBeforeSpace(pos) || CaretFinder.nextPosition(getClosestBlock(root, pos).dom(), pos).exists(isBeforeSpace);\r\n            }\r\n        };\r\n        var isPreValue = function (value) {\r\n            return contains([\r\n                'pre',\r\n                'pre-wrap'\r\n            ], value);\r\n        };\r\n        var isInPre = function (pos) {\r\n            return getElementFromPosition(pos).bind(function (elm) {\r\n                return closest(elm, isElement);\r\n            }).exists(function (elm) {\r\n                return isPreValue(get$2(elm, 'white-space'));\r\n            });\r\n        };\r\n        var isAtBeginningOfBody = function (root, pos) {\r\n            return CaretFinder.prevPosition(root.dom(), pos).isNone();\r\n        };\r\n        var isAtEndOfBody = function (root, pos) {\r\n            return CaretFinder.nextPosition(root.dom(), pos).isNone();\r\n        };\r\n        var isAtLineBoundary = function (root, pos) {\r\n            return isAtBeginningOfBody(root, pos) || isAtEndOfBody(root, pos) || isAtStartOfBlock(root, pos) || isAtEndOfBlock(root, pos) || isAfterBr(root, pos) || isBeforeBr(root, pos);\r\n        };\r\n        var needsToHaveNbsp = function (root, pos) {\r\n            if (isInPre(pos)) {\r\n                return false;\r\n            }\r\n            else {\r\n                return isAtLineBoundary(root, pos) || hasSpaceBefore(root, pos) || hasSpaceAfter(root, pos);\r\n            }\r\n        };\r\n        var needsToBeNbspLeft = function (root, pos) {\r\n            if (isInPre(pos)) {\r\n                return false;\r\n            }\r\n            else {\r\n                return isAtStartOfBlock(root, pos) || isAfterBr(root, pos) || hasSpaceBefore(root, pos);\r\n            }\r\n        };\r\n        var leanRight = function (pos) {\r\n            var container = pos.container();\r\n            var offset = pos.offset();\r\n            if (NodeType.isText(container) && offset < container.data.length) {\r\n                return CaretPosition(container, offset + 1);\r\n            }\r\n            else {\r\n                return pos;\r\n            }\r\n        };\r\n        var needsToBeNbspRight = function (root, pos) {\r\n            var afterPos = leanRight(pos);\r\n            if (isInPre(afterPos)) {\r\n                return false;\r\n            }\r\n            else {\r\n                return isAtEndOfBlock(root, afterPos) || isBeforeBr(root, afterPos) || hasSpaceAfter(root, afterPos);\r\n            }\r\n        };\r\n        var needsToBeNbsp = function (root, pos) {\r\n            return needsToBeNbspLeft(root, pos) || needsToBeNbspRight(root, pos);\r\n        };\r\n        var isNbspAt = function (text, offset) {\r\n            return isNbsp(text.charAt(offset));\r\n        };\r\n        var hasNbsp = function (pos) {\r\n            var container = pos.container();\r\n            return NodeType.isText(container) && contains$2(container.data, nbsp);\r\n        };\r\n        var normalizeNbspMiddle = function (text) {\r\n            return map(text.split(''), function (chr, i, chars) {\r\n                if (isNbsp(chr) && i > 0 && i < chars.length - 1 && isContent(chars[i - 1]) && isContent(chars[i + 1])) {\r\n                    return ' ';\r\n                }\r\n                else {\r\n                    return chr;\r\n                }\r\n            }).join('');\r\n        };\r\n        var normalizeNbspAtStart = function (root, node) {\r\n            var text = node.data;\r\n            var firstPos = CaretPosition(node, 0);\r\n            if (isNbspAt(text, 0) && !needsToBeNbsp(root, firstPos)) {\r\n                node.data = ' ' + text.slice(1);\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var normalizeNbspInMiddleOfTextNode = function (node) {\r\n            var text = node.data;\r\n            var newText = normalizeNbspMiddle(text);\r\n            if (newText !== text) {\r\n                node.data = newText;\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var normalizeNbspAtEnd = function (root, node) {\r\n            var text = node.data;\r\n            var lastPos = CaretPosition(node, text.length - 1);\r\n            if (isNbspAt(text, text.length - 1) && !needsToBeNbsp(root, lastPos)) {\r\n                node.data = text.slice(0, -1) + ' ';\r\n                return true;\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var normalizeNbsps = function (root, pos) {\r\n            return Option.some(pos).filter(hasNbsp).bind(function (pos) {\r\n                var container = pos.container();\r\n                var normalized = normalizeNbspAtStart(root, container) || normalizeNbspInMiddleOfTextNode(container) || normalizeNbspAtEnd(root, container);\r\n                return normalized ? Option.some(pos) : Option.none();\r\n            });\r\n        };\r\n        var normalizeNbspsInEditor = function (editor) {\r\n            var root = Element.fromDom(editor.getBody());\r\n            if (editor.selection.isCollapsed()) {\r\n                normalizeNbsps(root, CaretPosition.fromRangeStart(editor.selection.getRng())).each(function (pos) {\r\n                    editor.selection.setRng(pos.toRange());\r\n                });\r\n            }\r\n        };\r\n        var locationToCaretPosition = function (root) {\r\n            return function (location) {\r\n                return location.fold(function (element) {\r\n                    return CaretFinder.prevPosition(root.dom(), CaretPosition$1.before(element));\r\n                }, function (element) {\r\n                    return CaretFinder.firstPositionIn(element);\r\n                }, function (element) {\r\n                    return CaretFinder.lastPositionIn(element);\r\n                }, function (element) {\r\n                    return CaretFinder.nextPosition(root.dom(), CaretPosition$1.after(element));\r\n                });\r\n            };\r\n        };\r\n        var insertInlineBoundarySpaceOrNbsp = function (root, pos) {\r\n            return function (checkPos) {\r\n                return needsToHaveNbsp(root, checkPos) ? insertNbspAtPosition(pos) : insertSpaceAtPosition(pos);\r\n            };\r\n        };\r\n        var setSelection$1 = function (editor) {\r\n            return function (pos) {\r\n                editor.selection.setRng(pos.toRange());\r\n                editor.nodeChanged();\r\n                return true;\r\n            };\r\n        };\r\n        var insertSpaceOrNbspAtSelection = function (editor) {\r\n            var pos = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n            var root = Element.fromDom(editor.getBody());\r\n            if (editor.selection.isCollapsed()) {\r\n                var isInlineTarget = curry(InlineUtils.isInlineTarget, editor);\r\n                var caretPosition = CaretPosition$1.fromRangeStart(editor.selection.getRng());\r\n                return BoundaryLocation.readLocation(isInlineTarget, editor.getBody(), caretPosition).bind(locationToCaretPosition(root)).bind(insertInlineBoundarySpaceOrNbsp(root, pos)).exists(setSelection$1(editor));\r\n            }\r\n            else {\r\n                return false;\r\n            }\r\n        };\r\n        var executeKeydownOverride$2 = function (editor, evt) {\r\n            MatchKeys.execute([{\r\n                    keyCode: VK.SPACEBAR,\r\n                    action: MatchKeys.action(insertSpaceOrNbspAtSelection, editor)\r\n                }], evt).each(function (_) {\r\n                evt.preventDefault();\r\n            });\r\n        };\r\n        var setup$a = function (editor) {\r\n            editor.on('keydown', function (evt) {\r\n                if (evt.isDefaultPrevented() === false) {\r\n                    executeKeydownOverride$2(editor, evt);\r\n                }\r\n            });\r\n        };\r\n        var SpaceKey = { setup: setup$a };\r\n        var findBlockCaretContainer = function (editor) {\r\n            return descendant(Element.fromDom(editor.getBody()), '*[data-mce-caret]').fold(constant(null), function (elm) {\r\n                return elm.dom();\r\n            });\r\n        };\r\n        var removeIeControlRect = function (editor) {\r\n            editor.selection.setRng(editor.selection.getRng());\r\n        };\r\n        var showBlockCaretContainer = function (editor, blockCaretContainer) {\r\n            if (blockCaretContainer.hasAttribute('data-mce-caret')) {\r\n                showCaretContainerBlock(blockCaretContainer);\r\n                removeIeControlRect(editor);\r\n                editor.selection.scrollIntoView(blockCaretContainer);\r\n            }\r\n        };\r\n        var handleBlockContainer = function (editor, e) {\r\n            var blockCaretContainer = findBlockCaretContainer(editor);\r\n            if (!blockCaretContainer) {\r\n                return;\r\n            }\r\n            if (e.type === 'compositionstart') {\r\n                e.preventDefault();\r\n                e.stopPropagation();\r\n                showBlockCaretContainer(editor, blockCaretContainer);\r\n                return;\r\n            }\r\n            if (hasContent(blockCaretContainer)) {\r\n                showBlockCaretContainer(editor, blockCaretContainer);\r\n                editor.undoManager.add();\r\n            }\r\n        };\r\n        var setup$b = function (editor) {\r\n            editor.on('keyup compositionstart', curry(handleBlockContainer, editor));\r\n        };\r\n        var CaretContainerInput = { setup: setup$b };\r\n        var browser$4 = PlatformDetection$1.detect().browser;\r\n        var setupIeInput = function (editor) {\r\n            var keypressThrotter = first(function () {\r\n                if (!editor.composing) {\r\n                    normalizeNbspsInEditor(editor);\r\n                }\r\n            }, 0);\r\n            if (browser$4.isIE()) {\r\n                editor.on('keypress', function (e) {\r\n                    keypressThrotter.throttle();\r\n                });\r\n                editor.on('remove', function (e) {\r\n                    keypressThrotter.cancel();\r\n                });\r\n            }\r\n        };\r\n        var setup$c = function (editor) {\r\n            setupIeInput(editor);\r\n            editor.on('input', function (e) {\r\n                if (e.isComposing === false) {\r\n                    normalizeNbspsInEditor(editor);\r\n                }\r\n            });\r\n        };\r\n        var executeKeydownOverride$3 = function (editor, evt) {\r\n            MatchKeys.execute([\r\n                {\r\n                    keyCode: VK.END,\r\n                    action: moveToLineEndPoint(editor, true)\r\n                },\r\n                {\r\n                    keyCode: VK.HOME,\r\n                    action: moveToLineEndPoint(editor, false)\r\n                }\r\n            ], evt).each(function (_) {\r\n                evt.preventDefault();\r\n            });\r\n        };\r\n        var setup$d = function (editor) {\r\n            editor.on('keydown', function (evt) {\r\n                if (evt.isDefaultPrevented() === false) {\r\n                    executeKeydownOverride$3(editor, evt);\r\n                }\r\n            });\r\n        };\r\n        var HomeEndKeys = { setup: setup$d };\r\n        var setup$e = function (editor) {\r\n            var caret = BoundarySelection.setupSelectedState(editor);\r\n            CaretContainerInput.setup(editor);\r\n            ArrowKeys.setup(editor, caret);\r\n            DeleteBackspaceKeys.setup(editor, caret);\r\n            EnterKey.setup(editor);\r\n            SpaceKey.setup(editor);\r\n            setup$c(editor);\r\n            HomeEndKeys.setup(editor);\r\n        };\r\n        var KeyboardOverrides = { setup: setup$e };\r\n        var Quirks = function (editor) {\r\n            var each = Tools.each;\r\n            var BACKSPACE = VK.BACKSPACE, DELETE = VK.DELETE, dom = editor.dom, selection = editor.selection, settings = editor.settings, parser = editor.parser;\r\n            var isGecko = Env.gecko, isIE = Env.ie, isWebKit = Env.webkit;\r\n            var mceInternalUrlPrefix = 'data:text/mce-internal,';\r\n            var mceInternalDataType = isIE ? 'Text' : 'URL';\r\n            var setEditorCommandState = function (cmd, state) {\r\n                try {\r\n                    editor.getDoc().execCommand(cmd, false, state);\r\n                }\r\n                catch (ex) {\r\n                }\r\n            };\r\n            var isDefaultPrevented = function (e) {\r\n                return e.isDefaultPrevented();\r\n            };\r\n            var setMceInternalContent = function (e) {\r\n                var selectionHtml, internalContent;\r\n                if (e.dataTransfer) {\r\n                    if (editor.selection.isCollapsed() && e.target.tagName === 'IMG') {\r\n                        selection.select(e.target);\r\n                    }\r\n                    selectionHtml = editor.selection.getContent();\r\n                    if (selectionHtml.length > 0) {\r\n                        internalContent = mceInternalUrlPrefix + escape(editor.id) + ',' + escape(selectionHtml);\r\n                        e.dataTransfer.setData(mceInternalDataType, internalContent);\r\n                    }\r\n                }\r\n            };\r\n            var getMceInternalContent = function (e) {\r\n                var internalContent;\r\n                if (e.dataTransfer) {\r\n                    internalContent = e.dataTransfer.getData(mceInternalDataType);\r\n                    if (internalContent && internalContent.indexOf(mceInternalUrlPrefix) >= 0) {\r\n                        internalContent = internalContent.substr(mceInternalUrlPrefix.length).split(',');\r\n                        return {\r\n                            id: unescape(internalContent[0]),\r\n                            html: unescape(internalContent[1])\r\n                        };\r\n                    }\r\n                }\r\n                return null;\r\n            };\r\n            var insertClipboardContents = function (content, internal) {\r\n                if (editor.queryCommandSupported('mceInsertClipboardContent')) {\r\n                    editor.execCommand('mceInsertClipboardContent', false, {\r\n                        content: content,\r\n                        internal: internal\r\n                    });\r\n                }\r\n                else {\r\n                    editor.execCommand('mceInsertContent', false, content);\r\n                }\r\n            };\r\n            var emptyEditorWhenDeleting = function () {\r\n                var serializeRng = function (rng) {\r\n                    var body = dom.create('body');\r\n                    var contents = rng.cloneContents();\r\n                    body.appendChild(contents);\r\n                    return selection.serializer.serialize(body, { format: 'html' });\r\n                };\r\n                var allContentsSelected = function (rng) {\r\n                    var selection = serializeRng(rng);\r\n                    var allRng = dom.createRng();\r\n                    allRng.selectNode(editor.getBody());\r\n                    var allSelection = serializeRng(allRng);\r\n                    return selection === allSelection;\r\n                };\r\n                editor.on('keydown', function (e) {\r\n                    var keyCode = e.keyCode;\r\n                    var isCollapsed, body;\r\n                    if (!isDefaultPrevented(e) && (keyCode === DELETE || keyCode === BACKSPACE)) {\r\n                        isCollapsed = editor.selection.isCollapsed();\r\n                        body = editor.getBody();\r\n                        if (isCollapsed && !dom.isEmpty(body)) {\r\n                            return;\r\n                        }\r\n                        if (!isCollapsed && !allContentsSelected(editor.selection.getRng())) {\r\n                            return;\r\n                        }\r\n                        e.preventDefault();\r\n                        editor.setContent('');\r\n                        if (body.firstChild && dom.isBlock(body.firstChild)) {\r\n                            editor.selection.setCursorLocation(body.firstChild, 0);\r\n                        }\r\n                        else {\r\n                            editor.selection.setCursorLocation(body, 0);\r\n                        }\r\n                        editor.nodeChanged();\r\n                    }\r\n                });\r\n            };\r\n            var selectAll = function () {\r\n                editor.shortcuts.add('meta+a', null, 'SelectAll');\r\n            };\r\n            var inputMethodFocus = function () {\r\n                if (!editor.inline) {\r\n                    dom.bind(editor.getDoc(), 'mousedown mouseup', function (e) {\r\n                        var rng;\r\n                        if (e.target === editor.getDoc().documentElement) {\r\n                            rng = selection.getRng();\r\n                            editor.getBody().focus();\r\n                            if (e.type === 'mousedown') {\r\n                                if (isCaretContainer(rng.startContainer)) {\r\n                                    return;\r\n                                }\r\n                                selection.placeCaretAt(e.clientX, e.clientY);\r\n                            }\r\n                            else {\r\n                                selection.setRng(rng);\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var removeHrOnBackspace = function () {\r\n                editor.on('keydown', function (e) {\r\n                    if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\r\n                        if (!editor.getBody().getElementsByTagName('hr').length) {\r\n                            return;\r\n                        }\r\n                        if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\r\n                            var node = selection.getNode();\r\n                            var previousSibling = node.previousSibling;\r\n                            if (node.nodeName === 'HR') {\r\n                                dom.remove(node);\r\n                                e.preventDefault();\r\n                                return;\r\n                            }\r\n                            if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'hr') {\r\n                                dom.remove(previousSibling);\r\n                                e.preventDefault();\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n            var focusBody = function () {\r\n                if (!domGlobals.Range.prototype.getClientRects) {\r\n                    editor.on('mousedown', function (e) {\r\n                        if (!isDefaultPrevented(e) && e.target.nodeName === 'HTML') {\r\n                            var body_1 = editor.getBody();\r\n                            body_1.blur();\r\n                            Delay.setEditorTimeout(editor, function () {\r\n                                body_1.focus();\r\n                            });\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var selectControlElements = function () {\r\n                editor.on('click', function (e) {\r\n                    var target = e.target;\r\n                    if (/^(IMG|HR)$/.test(target.nodeName) && dom.getContentEditableParent(target) !== 'false') {\r\n                        e.preventDefault();\r\n                        editor.selection.select(target);\r\n                        editor.nodeChanged();\r\n                    }\r\n                    if (target.nodeName === 'A' && dom.hasClass(target, 'mce-item-anchor')) {\r\n                        e.preventDefault();\r\n                        selection.select(target);\r\n                    }\r\n                });\r\n            };\r\n            var removeStylesWhenDeletingAcrossBlockElements = function () {\r\n                var getAttributeApplyFunction = function () {\r\n                    var template = dom.getAttribs(selection.getStart().cloneNode(false));\r\n                    return function () {\r\n                        var target = selection.getStart();\r\n                        if (target !== editor.getBody()) {\r\n                            dom.setAttrib(target, 'style', null);\r\n                            each(template, function (attr) {\r\n                                target.setAttributeNode(attr.cloneNode(true));\r\n                            });\r\n                        }\r\n                    };\r\n                };\r\n                var isSelectionAcrossElements = function () {\r\n                    return !selection.isCollapsed() && dom.getParent(selection.getStart(), dom.isBlock) !== dom.getParent(selection.getEnd(), dom.isBlock);\r\n                };\r\n                editor.on('keypress', function (e) {\r\n                    var applyAttributes;\r\n                    if (!isDefaultPrevented(e) && (e.keyCode === 8 || e.keyCode === 46) && isSelectionAcrossElements()) {\r\n                        applyAttributes = getAttributeApplyFunction();\r\n                        editor.getDoc().execCommand('delete', false, null);\r\n                        applyAttributes();\r\n                        e.preventDefault();\r\n                        return false;\r\n                    }\r\n                });\r\n                dom.bind(editor.getDoc(), 'cut', function (e) {\r\n                    var applyAttributes;\r\n                    if (!isDefaultPrevented(e) && isSelectionAcrossElements()) {\r\n                        applyAttributes = getAttributeApplyFunction();\r\n                        Delay.setEditorTimeout(editor, function () {\r\n                            applyAttributes();\r\n                        });\r\n                    }\r\n                });\r\n            };\r\n            var disableBackspaceIntoATable = function () {\r\n                editor.on('keydown', function (e) {\r\n                    if (!isDefaultPrevented(e) && e.keyCode === BACKSPACE) {\r\n                        if (selection.isCollapsed() && selection.getRng().startOffset === 0) {\r\n                            var previousSibling = selection.getNode().previousSibling;\r\n                            if (previousSibling && previousSibling.nodeName && previousSibling.nodeName.toLowerCase() === 'table') {\r\n                                e.preventDefault();\r\n                                return false;\r\n                            }\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n            var removeBlockQuoteOnBackSpace = function () {\r\n                editor.on('keydown', function (e) {\r\n                    var rng, container, offset, root, parent;\r\n                    if (isDefaultPrevented(e) || e.keyCode !== VK.BACKSPACE) {\r\n                        return;\r\n                    }\r\n                    rng = selection.getRng();\r\n                    container = rng.startContainer;\r\n                    offset = rng.startOffset;\r\n                    root = dom.getRoot();\r\n                    parent = container;\r\n                    if (!rng.collapsed || offset !== 0) {\r\n                        return;\r\n                    }\r\n                    while (parent && parent.parentNode && parent.parentNode.firstChild === parent && parent.parentNode !== root) {\r\n                        parent = parent.parentNode;\r\n                    }\r\n                    if (parent.tagName === 'BLOCKQUOTE') {\r\n                        editor.formatter.toggle('blockquote', null, parent);\r\n                        rng = dom.createRng();\r\n                        rng.setStart(container, 0);\r\n                        rng.setEnd(container, 0);\r\n                        selection.setRng(rng);\r\n                    }\r\n                });\r\n            };\r\n            var setGeckoEditingOptions = function () {\r\n                var setOpts = function () {\r\n                    setEditorCommandState('StyleWithCSS', false);\r\n                    setEditorCommandState('enableInlineTableEditing', false);\r\n                    if (!settings.object_resizing) {\r\n                        setEditorCommandState('enableObjectResizing', false);\r\n                    }\r\n                };\r\n                if (!settings.readonly) {\r\n                    editor.on('BeforeExecCommand mousedown', setOpts);\r\n                }\r\n            };\r\n            var addBrAfterLastLinks = function () {\r\n                var fixLinks = function () {\r\n                    each(dom.select('a'), function (node) {\r\n                        var parentNode = node.parentNode;\r\n                        var root = dom.getRoot();\r\n                        if (parentNode.lastChild === node) {\r\n                            while (parentNode && !dom.isBlock(parentNode)) {\r\n                                if (parentNode.parentNode.lastChild !== parentNode || parentNode === root) {\r\n                                    return;\r\n                                }\r\n                                parentNode = parentNode.parentNode;\r\n                            }\r\n                            dom.add(parentNode, 'br', { 'data-mce-bogus': 1 });\r\n                        }\r\n                    });\r\n                };\r\n                editor.on('SetContent ExecCommand', function (e) {\r\n                    if (e.type === 'setcontent' || e.command === 'mceInsertLink') {\r\n                        fixLinks();\r\n                    }\r\n                });\r\n            };\r\n            var setDefaultBlockType = function () {\r\n                if (settings.forced_root_block) {\r\n                    editor.on('init', function () {\r\n                        setEditorCommandState('DefaultParagraphSeparator', Settings.getForcedRootBlock(editor));\r\n                    });\r\n                }\r\n            };\r\n            var normalizeSelection = function () {\r\n                editor.on('keyup focusin mouseup', function (e) {\r\n                    if (!VK.modifierPressed(e)) {\r\n                        selection.normalize();\r\n                    }\r\n                }, true);\r\n            };\r\n            var showBrokenImageIcon = function () {\r\n                editor.contentStyles.push('img:-moz-broken {' + '-moz-force-broken-image-icon:1;' + 'min-width:24px;' + 'min-height:24px' + '}');\r\n            };\r\n            var restoreFocusOnKeyDown = function () {\r\n                if (!editor.inline) {\r\n                    editor.on('keydown', function () {\r\n                        if (domGlobals.document.activeElement === domGlobals.document.body) {\r\n                            editor.getWin().focus();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var bodyHeight = function () {\r\n                if (!editor.inline) {\r\n                    editor.contentStyles.push('body {min-height: 150px}');\r\n                    editor.on('click', function (e) {\r\n                        var rng;\r\n                        if (e.target.nodeName === 'HTML') {\r\n                            if (Env.ie > 11) {\r\n                                editor.getBody().focus();\r\n                                return;\r\n                            }\r\n                            rng = editor.selection.getRng();\r\n                            editor.getBody().focus();\r\n                            editor.selection.setRng(rng);\r\n                            editor.selection.normalize();\r\n                            editor.nodeChanged();\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var blockCmdArrowNavigation = function () {\r\n                if (Env.mac) {\r\n                    editor.on('keydown', function (e) {\r\n                        if (VK.metaKeyPressed(e) && !e.shiftKey && (e.keyCode === 37 || e.keyCode === 39)) {\r\n                            e.preventDefault();\r\n                            var selection_1 = editor.selection.getSel();\r\n                            selection_1.modify('move', e.keyCode === 37 ? 'backward' : 'forward', 'lineboundary');\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n            var disableAutoUrlDetect = function () {\r\n                setEditorCommandState('AutoUrlDetect', false);\r\n            };\r\n            var tapLinksAndImages = function () {\r\n                editor.on('click', function (e) {\r\n                    var elm = e.target;\r\n                    do {\r\n                        if (elm.tagName === 'A') {\r\n                            e.preventDefault();\r\n                            return;\r\n                        }\r\n                    } while (elm = elm.parentNode);\r\n                });\r\n                editor.contentStyles.push('.mce-content-body {-webkit-touch-callout: none}');\r\n            };\r\n            var blockFormSubmitInsideEditor = function () {\r\n                editor.on('init', function () {\r\n                    editor.dom.bind(editor.getBody(), 'submit', function (e) {\r\n                        e.preventDefault();\r\n                    });\r\n                });\r\n            };\r\n            var removeAppleInterchangeBrs = function () {\r\n                parser.addNodeFilter('br', function (nodes) {\r\n                    var i = nodes.length;\r\n                    while (i--) {\r\n                        if (nodes[i].attr('class') === 'Apple-interchange-newline') {\r\n                            nodes[i].remove();\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n            var ieInternalDragAndDrop = function () {\r\n                editor.on('dragstart', function (e) {\r\n                    setMceInternalContent(e);\r\n                });\r\n                editor.on('drop', function (e) {\r\n                    if (!isDefaultPrevented(e)) {\r\n                        var internalContent = getMceInternalContent(e);\r\n                        if (internalContent && internalContent.id !== editor.id) {\r\n                            e.preventDefault();\r\n                            var rng = CaretRangeFromPoint.fromPoint(e.x, e.y, editor.getDoc());\r\n                            selection.setRng(rng);\r\n                            insertClipboardContents(internalContent.html, true);\r\n                        }\r\n                    }\r\n                });\r\n            };\r\n            var refreshContentEditable = function () {\r\n            };\r\n            var isHidden = function () {\r\n                var sel;\r\n                if (!isGecko || editor.removed) {\r\n                    return false;\r\n                }\r\n                sel = editor.selection.getSel();\r\n                return !sel || !sel.rangeCount || sel.rangeCount === 0;\r\n            };\r\n            removeBlockQuoteOnBackSpace();\r\n            emptyEditorWhenDeleting();\r\n            if (!Env.windowsPhone) {\r\n                normalizeSelection();\r\n            }\r\n            if (isWebKit) {\r\n                inputMethodFocus();\r\n                selectControlElements();\r\n                setDefaultBlockType();\r\n                blockFormSubmitInsideEditor();\r\n                disableBackspaceIntoATable();\r\n                removeAppleInterchangeBrs();\r\n                if (Env.iOS) {\r\n                    restoreFocusOnKeyDown();\r\n                    bodyHeight();\r\n                    tapLinksAndImages();\r\n                }\r\n                else {\r\n                    selectAll();\r\n                }\r\n            }\r\n            if (Env.ie >= 11) {\r\n                bodyHeight();\r\n                disableBackspaceIntoATable();\r\n            }\r\n            if (Env.ie) {\r\n                selectAll();\r\n                disableAutoUrlDetect();\r\n                ieInternalDragAndDrop();\r\n            }\r\n            if (isGecko) {\r\n                removeHrOnBackspace();\r\n                focusBody();\r\n                removeStylesWhenDeletingAcrossBlockElements();\r\n                setGeckoEditingOptions();\r\n                addBrAfterLastLinks();\r\n                showBrokenImageIcon();\r\n                blockCmdArrowNavigation();\r\n                disableBackspaceIntoATable();\r\n            }\r\n            return {\r\n                refreshContentEditable: refreshContentEditable,\r\n                isHidden: isHidden\r\n            };\r\n        };\r\n        var isTextBlockNode = function (node) {\r\n            return NodeType.isElement(node) && isTextBlock(Element.fromDom(node));\r\n        };\r\n        var normalizeSelection$1 = function (editor) {\r\n            var rng = editor.selection.getRng();\r\n            var startPos = CaretPosition.fromRangeStart(rng);\r\n            var endPos = CaretPosition.fromRangeEnd(rng);\r\n            if (CaretPosition.isElementPosition(startPos)) {\r\n                var container = startPos.container();\r\n                if (isTextBlockNode(container)) {\r\n                    CaretFinder.firstPositionIn(container).each(function (pos) {\r\n                        return rng.setStart(pos.container(), pos.offset());\r\n                    });\r\n                }\r\n            }\r\n            if (CaretPosition.isElementPosition(endPos)) {\r\n                var container = startPos.container();\r\n                if (isTextBlockNode(container)) {\r\n                    CaretFinder.lastPositionIn(container).each(function (pos) {\r\n                        return rng.setEnd(pos.container(), pos.offset());\r\n                    });\r\n                }\r\n            }\r\n            editor.selection.setRng(RangeNormalizer.normalize(rng));\r\n        };\r\n        var setup$f = function (editor) {\r\n            editor.on('click', function (e) {\r\n                if (e.detail >= 3) {\r\n                    normalizeSelection$1(editor);\r\n                }\r\n            });\r\n        };\r\n        var preventSummaryToggle = function (editor) {\r\n            editor.on('click', function (e) {\r\n                if (editor.dom.getParent(e.target, 'details')) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n        };\r\n        var filterDetails = function (editor) {\r\n            editor.parser.addNodeFilter('details', function (elms) {\r\n                each(elms, function (details) {\r\n                    details.attr('data-mce-open', details.attr('open'));\r\n                    details.attr('open', 'open');\r\n                });\r\n            });\r\n            editor.serializer.addNodeFilter('details', function (elms) {\r\n                each(elms, function (details) {\r\n                    var open = details.attr('data-mce-open');\r\n                    details.attr('open', isString(open) ? open : null);\r\n                    details.attr('data-mce-open', null);\r\n                });\r\n            });\r\n        };\r\n        var setup$g = function (editor) {\r\n            preventSummaryToggle(editor);\r\n            filterDetails(editor);\r\n        };\r\n        var DOM$2 = DOMUtils$1.DOM;\r\n        var appendStyle = function (editor, text) {\r\n            var head = Element.fromDom(editor.getDoc().head);\r\n            var tag = Element.fromTag('style');\r\n            set(tag, 'type', 'text/css');\r\n            append(tag, Element.fromText(text));\r\n            append(head, tag);\r\n        };\r\n        var createParser = function (editor) {\r\n            var parser = DomParser(editor.settings, editor.schema);\r\n            parser.addAttributeFilter('src,href,style,tabindex', function (nodes, name) {\r\n                var i = nodes.length, node;\r\n                var dom = editor.dom;\r\n                var value, internalName;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    value = node.attr(name);\r\n                    internalName = 'data-mce-' + name;\r\n                    if (!node.attr(internalName)) {\r\n                        if (value.indexOf('data:') === 0 || value.indexOf('blob:') === 0) {\r\n                            continue;\r\n                        }\r\n                        if (name === 'style') {\r\n                            value = dom.serializeStyle(dom.parseStyle(value), node.name);\r\n                            if (!value.length) {\r\n                                value = null;\r\n                            }\r\n                            node.attr(internalName, value);\r\n                            node.attr(name, value);\r\n                        }\r\n                        else if (name === 'tabindex') {\r\n                            node.attr(internalName, value);\r\n                            node.attr(name, null);\r\n                        }\r\n                        else {\r\n                            node.attr(internalName, editor.convertURL(value, name, node.name));\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n            parser.addNodeFilter('script', function (nodes) {\r\n                var i = nodes.length, node, type;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    type = node.attr('type') || 'no/type';\r\n                    if (type.indexOf('mce-') !== 0) {\r\n                        node.attr('type', 'mce-' + type);\r\n                    }\r\n                }\r\n            });\r\n            parser.addNodeFilter('#cdata', function (nodes) {\r\n                var i = nodes.length, node;\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    node.type = 8;\r\n                    node.name = '#comment';\r\n                    node.value = '[CDATA[' + node.value + ']]';\r\n                }\r\n            });\r\n            parser.addNodeFilter('p,h1,h2,h3,h4,h5,h6,div', function (nodes) {\r\n                var i = nodes.length, node;\r\n                var nonEmptyElements = editor.schema.getNonEmptyElements();\r\n                while (i--) {\r\n                    node = nodes[i];\r\n                    if (node.isEmpty(nonEmptyElements) && node.getAll('br').length === 0) {\r\n                        node.append(new Node$1('br', 1)).shortEnded = true;\r\n                    }\r\n                }\r\n            });\r\n            return parser;\r\n        };\r\n        var autoFocus = function (editor) {\r\n            if (editor.settings.auto_focus) {\r\n                Delay.setEditorTimeout(editor, function () {\r\n                    var focusEditor;\r\n                    if (editor.settings.auto_focus === true) {\r\n                        focusEditor = editor;\r\n                    }\r\n                    else {\r\n                        focusEditor = editor.editorManager.get(editor.settings.auto_focus);\r\n                    }\r\n                    if (!focusEditor.destroyed) {\r\n                        focusEditor.focus();\r\n                    }\r\n                }, 100);\r\n            }\r\n        };\r\n        var initEditor = function (editor) {\r\n            editor.bindPendingEventDelegates();\r\n            editor.initialized = true;\r\n            editor.fire('init');\r\n            editor.focus(true);\r\n            editor.nodeChanged({ initial: true });\r\n            editor.execCallback('init_instance_callback', editor);\r\n            autoFocus(editor);\r\n        };\r\n        var getStyleSheetLoader = function (editor) {\r\n            return editor.inline ? DOM$2.styleSheetLoader : editor.dom.styleSheetLoader;\r\n        };\r\n        var initContentBody = function (editor, skipWrite) {\r\n            var settings = editor.settings;\r\n            var targetElm = editor.getElement();\r\n            var doc = editor.getDoc(), body, contentCssText;\r\n            if (!settings.inline) {\r\n                editor.getElement().style.visibility = editor.orgVisibility;\r\n            }\r\n            if (!skipWrite && !editor.inline) {\r\n                doc.open();\r\n                doc.write(editor.iframeHTML);\r\n                doc.close();\r\n            }\r\n            if (editor.inline) {\r\n                editor.on('remove', function () {\r\n                    var bodyEl = this.getBody();\r\n                    DOM$2.removeClass(bodyEl, 'mce-content-body');\r\n                    DOM$2.removeClass(bodyEl, 'mce-edit-focus');\r\n                    DOM$2.setAttrib(bodyEl, 'contentEditable', null);\r\n                });\r\n                DOM$2.addClass(targetElm, 'mce-content-body');\r\n                editor.contentDocument = doc = domGlobals.document;\r\n                editor.contentWindow = domGlobals.window;\r\n                editor.bodyElement = targetElm;\r\n                editor.contentAreaContainer = targetElm;\r\n                settings.root_name = targetElm.nodeName.toLowerCase();\r\n            }\r\n            body = editor.getBody();\r\n            body.disabled = true;\r\n            editor.readonly = settings.readonly;\r\n            if (!editor.readonly) {\r\n                if (editor.inline && DOM$2.getStyle(body, 'position', true) === 'static') {\r\n                    body.style.position = 'relative';\r\n                }\r\n                body.contentEditable = editor.getParam('content_editable_state', true);\r\n            }\r\n            body.disabled = false;\r\n            editor.editorUpload = EditorUpload(editor);\r\n            editor.schema = Schema(settings);\r\n            editor.dom = DOMUtils$1(doc, {\r\n                keep_values: true,\r\n                url_converter: editor.convertURL,\r\n                url_converter_scope: editor,\r\n                hex_colors: settings.force_hex_style_colors,\r\n                update_styles: true,\r\n                root_element: editor.inline ? editor.getBody() : null,\r\n                collect: function () {\r\n                    return editor.inline;\r\n                },\r\n                schema: editor.schema,\r\n                contentCssCors: Settings.shouldUseContentCssCors(editor),\r\n                onSetAttrib: function (e) {\r\n                    editor.fire('SetAttrib', e);\r\n                }\r\n            });\r\n            editor.parser = createParser(editor);\r\n            editor.serializer = Serializer$1(settings, editor);\r\n            editor.selection = Selection(editor.dom, editor.getWin(), editor.serializer, editor);\r\n            editor.annotator = Annotator(editor);\r\n            editor.formatter = Formatter(editor);\r\n            editor.undoManager = UndoManager(editor);\r\n            editor._nodeChangeDispatcher = new NodeChange(editor);\r\n            editor._selectionOverrides = SelectionOverrides(editor);\r\n            setup$g(editor);\r\n            setup$f(editor);\r\n            KeyboardOverrides.setup(editor);\r\n            ForceBlocks.setup(editor);\r\n            editor.fire('PreInit');\r\n            if (!settings.browser_spellcheck && !settings.gecko_spellcheck) {\r\n                doc.body.spellcheck = false;\r\n                DOM$2.setAttrib(body, 'spellcheck', 'false');\r\n            }\r\n            editor.quirks = Quirks(editor);\r\n            editor.fire('PostRender');\r\n            var directionality = Settings.getDirectionality(editor);\r\n            if (directionality !== undefined) {\r\n                body.dir = directionality;\r\n            }\r\n            if (settings.protect) {\r\n                editor.on('BeforeSetContent', function (e) {\r\n                    Tools.each(settings.protect, function (pattern) {\r\n                        e.content = e.content.replace(pattern, function (str) {\r\n                            return '<!--mce:protected ' + escape(str) + '-->';\r\n                        });\r\n                    });\r\n                });\r\n            }\r\n            editor.on('SetContent', function () {\r\n                editor.addVisual(editor.getBody());\r\n            });\r\n            editor.load({\r\n                initial: true,\r\n                format: 'html'\r\n            });\r\n            editor.startContent = editor.getContent({ format: 'raw' });\r\n            editor.on('compositionstart compositionend', function (e) {\r\n                editor.composing = e.type === 'compositionstart';\r\n            });\r\n            if (editor.contentStyles.length > 0) {\r\n                contentCssText = '';\r\n                Tools.each(editor.contentStyles, function (style) {\r\n                    contentCssText += style + '\\r\\n';\r\n                });\r\n                editor.dom.addStyle(contentCssText);\r\n            }\r\n            getStyleSheetLoader(editor).loadAll(editor.contentCSS, function (_) {\r\n                initEditor(editor);\r\n            }, function (urls) {\r\n                initEditor(editor);\r\n            });\r\n            if (settings.content_style) {\r\n                appendStyle(editor, settings.content_style);\r\n            }\r\n        };\r\n        var InitContentBody = { initContentBody: initContentBody };\r\n        var DOM$3 = DOMUtils$1.DOM;\r\n        var relaxDomain = function (editor, ifr) {\r\n            if (domGlobals.document.domain !== domGlobals.window.location.hostname && Env.ie && Env.ie < 12) {\r\n                var bodyUuid = Uuid.uuid('mce');\r\n                editor[bodyUuid] = function () {\r\n                    InitContentBody.initContentBody(editor);\r\n                };\r\n                var domainRelaxUrl = 'javascript:(function(){' + 'document.open();document.domain=\"' + domGlobals.document.domain + '\";' + 'var ed = window.parent.tinymce.get(\"' + editor.id + '\");document.write(ed.iframeHTML);' + 'document.close();ed.' + bodyUuid + '(true);})()';\r\n                DOM$3.setAttrib(ifr, 'src', domainRelaxUrl);\r\n                return true;\r\n            }\r\n            return false;\r\n        };\r\n        var createIframeElement = function (id, title, height, customAttrs) {\r\n            var iframe = Element.fromTag('iframe');\r\n            setAll(iframe, customAttrs);\r\n            setAll(iframe, {\r\n                id: id + '_ifr',\r\n                frameBorder: '0',\r\n                allowTransparency: 'true',\r\n                title: title\r\n            });\r\n            add$3(iframe, 'tox-edit-area__iframe');\r\n            return iframe;\r\n        };\r\n        var getIframeHtml = function (editor) {\r\n            var bodyId, bodyClass, iframeHTML;\r\n            iframeHTML = Settings.getDocType(editor) + '<html><head>';\r\n            if (Settings.getDocumentBaseUrl(editor) !== editor.documentBaseUrl) {\r\n                iframeHTML += '<base href=\"' + editor.documentBaseURI.getURI() + '\" />';\r\n            }\r\n            iframeHTML += '<meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />';\r\n            bodyId = Settings.getBodyId(editor);\r\n            bodyClass = Settings.getBodyClass(editor);\r\n            if (Settings.getContentSecurityPolicy(editor)) {\r\n                iframeHTML += '<meta http-equiv=\"Content-Security-Policy\" content=\"' + Settings.getContentSecurityPolicy(editor) + '\" />';\r\n            }\r\n            iframeHTML += '</head><body id=\"' + bodyId + '\" class=\"mce-content-body ' + bodyClass + '\" data-id=\"' + editor.id + '\"><br></body></html>';\r\n            return iframeHTML;\r\n        };\r\n        var createIframe = function (editor, o) {\r\n            var title = editor.editorManager.translate('Rich Text Area. Press ALT-0 for help.');\r\n            var ifr = createIframeElement(editor.id, title, o.height, Settings.getIframeAttrs(editor)).dom();\r\n            ifr.onload = function () {\r\n                ifr.onload = null;\r\n                editor.fire('load');\r\n            };\r\n            var isDomainRelaxed = relaxDomain(editor, ifr);\r\n            editor.contentAreaContainer = o.iframeContainer;\r\n            editor.iframeElement = ifr;\r\n            editor.iframeHTML = getIframeHtml(editor);\r\n            DOM$3.add(o.iframeContainer, ifr);\r\n            return isDomainRelaxed;\r\n        };\r\n        var init$1 = function (editor, boxInfo) {\r\n            var isDomainRelaxed = createIframe(editor, boxInfo);\r\n            if (boxInfo.editorContainer) {\r\n                DOM$3.get(boxInfo.editorContainer).style.display = editor.orgDisplay;\r\n                editor.hidden = DOM$3.isHidden(boxInfo.editorContainer);\r\n            }\r\n            editor.getElement().style.display = 'none';\r\n            DOM$3.setAttrib(editor.id, 'aria-hidden', 'true');\r\n            if (!isDomainRelaxed) {\r\n                InitContentBody.initContentBody(editor);\r\n            }\r\n        };\r\n        var InitIframe = { init: init$1 };\r\n        var isContentCssSkinName = function (url) {\r\n            return /^[a-z0-9\\-]+$/i.test(url);\r\n        };\r\n        var getContentCssUrls = function (editor) {\r\n            var contentCss = Settings.getContentCss(editor);\r\n            var skinUrl = editor.editorManager.baseURL + '/skins/content';\r\n            var suffix = editor.editorManager.suffix;\r\n            var contentCssFile = 'content' + suffix + '.css';\r\n            var inline = editor.inline === true;\r\n            return map(contentCss, function (url) {\r\n                if (isContentCssSkinName(url) && !inline) {\r\n                    return skinUrl + '/' + url + '/' + contentCssFile;\r\n                }\r\n                else {\r\n                    return editor.documentBaseURI.toAbsolute(url);\r\n                }\r\n            });\r\n        };\r\n        var appendContentCssFromSettings = function (editor) {\r\n            editor.contentCSS = editor.contentCSS.concat(getContentCssUrls(editor));\r\n        };\r\n        var DOM$4 = DOMUtils$1.DOM;\r\n        var initPlugin = function (editor, initializedPlugins, plugin) {\r\n            var Plugin = PluginManager.get(plugin);\r\n            var pluginUrl = PluginManager.urls[plugin] || editor.documentBaseUrl.replace(/\\/$/, '');\r\n            plugin = Tools.trim(plugin);\r\n            if (Plugin && Tools.inArray(initializedPlugins, plugin) === -1) {\r\n                Tools.each(PluginManager.dependencies(plugin), function (dep) {\r\n                    initPlugin(editor, initializedPlugins, dep);\r\n                });\r\n                if (editor.plugins[plugin]) {\r\n                    return;\r\n                }\r\n                try {\r\n                    var pluginInstance = new Plugin(editor, pluginUrl, editor.$);\r\n                    editor.plugins[plugin] = pluginInstance;\r\n                    if (pluginInstance.init) {\r\n                        pluginInstance.init(editor, pluginUrl);\r\n                        initializedPlugins.push(plugin);\r\n                    }\r\n                }\r\n                catch (e) {\r\n                    ErrorReporter.pluginInitError(editor, plugin, e);\r\n                }\r\n            }\r\n        };\r\n        var trimLegacyPrefix = function (name) {\r\n            return name.replace(/^\\-/, '');\r\n        };\r\n        var initPlugins = function (editor) {\r\n            var initializedPlugins = [];\r\n            Tools.each(editor.settings.plugins.split(/[ ,]/), function (name) {\r\n                initPlugin(editor, initializedPlugins, trimLegacyPrefix(name));\r\n            });\r\n        };\r\n        var initIcons = function (editor) {\r\n            var iconPackName = Tools.trim(editor.settings.icons);\r\n            var currentIcons = editor.ui.registry.getAll().icons;\r\n            var defaultIcons = getAll();\r\n            var loadIcons = __assign({}, defaultIcons, IconManager.get(iconPackName).icons);\r\n            each$3(loadIcons, function (svgData, icon) {\r\n                if (!has(currentIcons, icon)) {\r\n                    editor.ui.registry.addIcon(icon, svgData);\r\n                }\r\n            });\r\n        };\r\n        var initTheme = function (editor) {\r\n            var theme = editor.settings.theme;\r\n            if (isString(theme)) {\r\n                editor.settings.theme = trimLegacyPrefix(theme);\r\n                var Theme = ThemeManager.get(theme);\r\n                editor.theme = new Theme(editor, ThemeManager.urls[theme]);\r\n                if (editor.theme.init) {\r\n                    editor.theme.init(editor, ThemeManager.urls[theme] || editor.documentBaseUrl.replace(/\\/$/, ''), editor.$);\r\n                }\r\n            }\r\n            else {\r\n                editor.theme = {};\r\n            }\r\n        };\r\n        var renderFromLoadedTheme = function (editor) {\r\n            return editor.theme.renderUI();\r\n        };\r\n        var renderFromThemeFunc = function (editor) {\r\n            var elm = editor.getElement();\r\n            var theme = editor.settings.theme;\r\n            var info = theme(editor, elm);\r\n            if (info.editorContainer.nodeType) {\r\n                info.editorContainer.id = info.editorContainer.id || editor.id + '_parent';\r\n            }\r\n            if (info.iframeContainer && info.iframeContainer.nodeType) {\r\n                info.iframeContainer.id = info.iframeContainer.id || editor.id + '_iframecontainer';\r\n            }\r\n            info.height = info.iframeHeight ? info.iframeHeight : elm.offsetHeight;\r\n            return info;\r\n        };\r\n        var createThemeFalseResult = function (element) {\r\n            return {\r\n                editorContainer: element,\r\n                iframeContainer: element\r\n            };\r\n        };\r\n        var renderThemeFalseIframe = function (targetElement) {\r\n            var iframeContainer = DOM$4.create('div');\r\n            DOM$4.insertAfter(iframeContainer, targetElement);\r\n            return createThemeFalseResult(iframeContainer);\r\n        };\r\n        var renderThemeFalse = function (editor) {\r\n            var targetElement = editor.getElement();\r\n            return editor.inline ? createThemeFalseResult(null) : renderThemeFalseIframe(targetElement);\r\n        };\r\n        var renderThemeUi = function (editor) {\r\n            var elm = editor.getElement();\r\n            editor.orgDisplay = elm.style.display;\r\n            if (isString(editor.settings.theme)) {\r\n                return renderFromLoadedTheme(editor);\r\n            }\r\n            else if (isFunction(editor.settings.theme)) {\r\n                return renderFromThemeFunc(editor);\r\n            }\r\n            else {\r\n                return renderThemeFalse(editor);\r\n            }\r\n        };\r\n        var init$2 = function (editor) {\r\n            editor.fire('ScriptsLoaded');\r\n            initIcons(editor);\r\n            initTheme(editor);\r\n            initPlugins(editor);\r\n            var boxInfo = renderThemeUi(editor);\r\n            editor.editorContainer = boxInfo.editorContainer ? boxInfo.editorContainer : null;\r\n            appendContentCssFromSettings(editor);\r\n            if (editor.inline) {\r\n                return InitContentBody.initContentBody(editor);\r\n            }\r\n            else {\r\n                return InitIframe.init(editor, boxInfo);\r\n            }\r\n        };\r\n        var Init = { init: init$2 };\r\n        var DOM$5 = DOMUtils$1.DOM;\r\n        var hasSkipLoadPrefix = function (name) {\r\n            return name.charAt(0) === '-';\r\n        };\r\n        var loadLanguage = function (scriptLoader, editor) {\r\n            var languageCode = Settings.getLanguageCode(editor);\r\n            var languageUrl = Settings.getLanguageUrl(editor);\r\n            if (I18n.hasCode(languageCode) === false && languageCode !== 'en') {\r\n                var url_1 = languageUrl !== '' ? languageUrl : editor.editorManager.baseURL + '/langs/' + languageCode + '.js';\r\n                scriptLoader.add(url_1, noop, undefined, function () {\r\n                    ErrorReporter.languageLoadError(url_1, languageCode);\r\n                });\r\n            }\r\n        };\r\n        var loadTheme = function (scriptLoader, editor, suffix, callback) {\r\n            var settings = editor.settings, theme = settings.theme;\r\n            if (isString(theme)) {\r\n                if (!hasSkipLoadPrefix(theme) && !ThemeManager.urls.hasOwnProperty(theme)) {\r\n                    var themeUrl = settings.theme_url;\r\n                    if (themeUrl) {\r\n                        ThemeManager.load(theme, editor.documentBaseURI.toAbsolute(themeUrl));\r\n                    }\r\n                    else {\r\n                        ThemeManager.load(theme, 'themes/' + theme + '/theme' + suffix + '.js');\r\n                    }\r\n                }\r\n                scriptLoader.loadQueue(function () {\r\n                    ThemeManager.waitFor(theme, callback);\r\n                });\r\n            }\r\n            else {\r\n                callback();\r\n            }\r\n        };\r\n        var getIconsUrlMetaFromUrl = function (editor) {\r\n            return Option.from(Settings.getIconsUrl(editor)).filter(function (url) {\r\n                return url.length > 0;\r\n            }).map(function (url) {\r\n                return {\r\n                    url: url,\r\n                    name: Option.none()\r\n                };\r\n            });\r\n        };\r\n        var getIconsUrlMetaFromName = function (editor) {\r\n            return Option.from(Settings.getIconPackName(editor)).filter(function (name) {\r\n                return name.length > 0 && !IconManager.has(name);\r\n            }).map(function (name) {\r\n                return {\r\n                    url: editor.editorManager.baseURL + '/icons/' + name + '/icons.js',\r\n                    name: Option.some(name)\r\n                };\r\n            });\r\n        };\r\n        var loadIcons = function (scriptLoader, editor) {\r\n            getIconsUrlMetaFromUrl(editor).orThunk(function () {\r\n                return getIconsUrlMetaFromName(editor);\r\n            }).each(function (urlMeta) {\r\n                scriptLoader.add(urlMeta.url, noop, undefined, function () {\r\n                    ErrorReporter.iconsLoadError(urlMeta.url, urlMeta.name.getOrUndefined());\r\n                });\r\n            });\r\n        };\r\n        var loadPlugins = function (settings, suffix) {\r\n            if (isArray(settings.plugins)) {\r\n                settings.plugins = settings.plugins.join(' ');\r\n            }\r\n            Tools.each(settings.external_plugins, function (url, name) {\r\n                PluginManager.load(name, url, noop, undefined, function () {\r\n                    ErrorReporter.pluginLoadError(name, url);\r\n                });\r\n                settings.plugins += ' ' + name;\r\n            });\r\n            Tools.each(settings.plugins.split(/[ ,]/), function (plugin) {\r\n                plugin = Tools.trim(plugin);\r\n                if (plugin && !PluginManager.urls[plugin]) {\r\n                    if (hasSkipLoadPrefix(plugin)) {\r\n                        plugin = plugin.substr(1, plugin.length);\r\n                        var dependencies = PluginManager.dependencies(plugin);\r\n                        Tools.each(dependencies, function (dep) {\r\n                            var defaultSettings = {\r\n                                prefix: 'plugins/',\r\n                                resource: dep,\r\n                                suffix: '/plugin' + suffix + '.js'\r\n                            };\r\n                            dep = PluginManager.createUrl(defaultSettings, dep);\r\n                            PluginManager.load(dep.resource, dep, noop, undefined, function () {\r\n                                ErrorReporter.pluginLoadError(dep.prefix + dep.resource + dep.suffix, dep.resource);\r\n                            });\r\n                        });\r\n                    }\r\n                    else {\r\n                        var url_2 = {\r\n                            prefix: 'plugins/',\r\n                            resource: plugin,\r\n                            suffix: '/plugin' + suffix + '.js'\r\n                        };\r\n                        PluginManager.load(plugin, url_2, noop, undefined, function () {\r\n                            ErrorReporter.pluginLoadError(url_2.prefix + url_2.resource + url_2.suffix, plugin);\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        };\r\n        var loadScripts = function (editor, suffix) {\r\n            var scriptLoader = ScriptLoader.ScriptLoader;\r\n            loadTheme(scriptLoader, editor, suffix, function () {\r\n                loadLanguage(scriptLoader, editor);\r\n                loadIcons(scriptLoader, editor);\r\n                loadPlugins(editor.settings, suffix);\r\n                scriptLoader.loadQueue(function () {\r\n                    if (!editor.removed) {\r\n                        Init.init(editor);\r\n                    }\r\n                }, editor, function () {\r\n                    if (!editor.removed) {\r\n                        Init.init(editor);\r\n                    }\r\n                });\r\n            });\r\n        };\r\n        var render = function (editor) {\r\n            var settings = editor.settings, id = editor.id;\r\n            I18n.setCode(Settings.getLanguageCode(editor));\r\n            var readyHandler = function () {\r\n                DOM$5.unbind(domGlobals.window, 'ready', readyHandler);\r\n                editor.render();\r\n            };\r\n            if (!EventUtils.Event.domLoaded) {\r\n                DOM$5.bind(domGlobals.window, 'ready', readyHandler);\r\n                return;\r\n            }\r\n            if (!editor.getElement()) {\r\n                return;\r\n            }\r\n            if (!Env.contentEditable) {\r\n                return;\r\n            }\r\n            if (!settings.inline) {\r\n                editor.orgVisibility = editor.getElement().style.visibility;\r\n                editor.getElement().style.visibility = 'hidden';\r\n            }\r\n            else {\r\n                editor.inline = true;\r\n            }\r\n            var form = editor.getElement().form || DOM$5.getParent(id, 'form');\r\n            if (form) {\r\n                editor.formElement = form;\r\n                if (settings.hidden_input && !/TEXTAREA|INPUT/i.test(editor.getElement().nodeName)) {\r\n                    DOM$5.insertAfter(DOM$5.create('input', {\r\n                        type: 'hidden',\r\n                        name: id\r\n                    }), id);\r\n                    editor.hasHiddenInput = true;\r\n                }\r\n                editor.formEventDelegate = function (e) {\r\n                    editor.fire(e.type, e);\r\n                };\r\n                DOM$5.bind(form, 'submit reset', editor.formEventDelegate);\r\n                editor.on('reset', function () {\r\n                    editor.resetContent();\r\n                });\r\n                if (settings.submit_patch && !form.submit.nodeType && !form.submit.length && !form._mceOldSubmit) {\r\n                    form._mceOldSubmit = form.submit;\r\n                    form.submit = function () {\r\n                        editor.editorManager.triggerSave();\r\n                        editor.setDirty(false);\r\n                        return form._mceOldSubmit(form);\r\n                    };\r\n                }\r\n            }\r\n            editor.windowManager = WindowManager(editor);\r\n            editor.notificationManager = NotificationManager(editor);\r\n            if (settings.encoding === 'xml') {\r\n                editor.on('GetContent', function (e) {\r\n                    if (e.save) {\r\n                        e.content = DOM$5.encode(e.content);\r\n                    }\r\n                });\r\n            }\r\n            if (settings.add_form_submit_trigger) {\r\n                editor.on('submit', function () {\r\n                    if (editor.initialized) {\r\n                        editor.save();\r\n                    }\r\n                });\r\n            }\r\n            if (settings.add_unload_trigger) {\r\n                editor._beforeUnload = function () {\r\n                    if (editor.initialized && !editor.destroyed && !editor.isHidden()) {\r\n                        editor.save({\r\n                            format: 'raw',\r\n                            no_events: true,\r\n                            set_dirty: false\r\n                        });\r\n                    }\r\n                };\r\n                editor.editorManager.on('BeforeUnload', editor._beforeUnload);\r\n            }\r\n            editor.editorManager.add(editor);\r\n            loadScripts(editor, editor.suffix);\r\n        };\r\n        var Render = { render: render };\r\n        var internalContentEditableAttr = 'data-mce-contenteditable';\r\n        var toggleClass = function (elm, cls, state) {\r\n            if (has$2(elm, cls) && state === false) {\r\n                remove$4(elm, cls);\r\n            }\r\n            else if (state) {\r\n                add$3(elm, cls);\r\n            }\r\n        };\r\n        var setEditorCommandState = function (editor, cmd, state) {\r\n            try {\r\n                editor.getDoc().execCommand(cmd, false, state);\r\n            }\r\n            catch (ex) {\r\n            }\r\n        };\r\n        var setContentEditable = function (elm, state) {\r\n            elm.dom().contentEditable = state ? 'true' : 'false';\r\n        };\r\n        var switchOffContentEditableTrue = function (elm) {\r\n            each(descendants$1(elm, '*[contenteditable=\"true\"]'), function (elm) {\r\n                set(elm, internalContentEditableAttr, 'true');\r\n                setContentEditable(elm, false);\r\n            });\r\n        };\r\n        var switchOnContentEditableTrue = function (elm) {\r\n            each(descendants$1(elm, '*[' + internalContentEditableAttr + '=\"true\"]'), function (elm) {\r\n                remove(elm, internalContentEditableAttr);\r\n                setContentEditable(elm, true);\r\n            });\r\n        };\r\n        var removeFakeSelection = function (editor) {\r\n            Option.from(editor.selection.getNode()).each(function (elm) {\r\n                elm.removeAttribute('data-mce-selected');\r\n            });\r\n        };\r\n        var restoreFakeSelection = function (editor) {\r\n            editor.selection.setRng(editor.selection.getRng());\r\n        };\r\n        var toggleReadOnly = function (editor, state) {\r\n            var body = Element.fromDom(editor.getBody());\r\n            toggleClass(body, 'mce-content-readonly', state);\r\n            if (state) {\r\n                editor.selection.controlSelection.hideResizeRect();\r\n                editor._selectionOverrides.hideFakeCaret();\r\n                removeFakeSelection(editor);\r\n                editor.readonly = true;\r\n                setContentEditable(body, false);\r\n                switchOffContentEditableTrue(body);\r\n            }\r\n            else {\r\n                editor.readonly = false;\r\n                setContentEditable(body, true);\r\n                switchOnContentEditableTrue(body);\r\n                setEditorCommandState(editor, 'StyleWithCSS', false);\r\n                setEditorCommandState(editor, 'enableInlineTableEditing', false);\r\n                setEditorCommandState(editor, 'enableObjectResizing', false);\r\n                editor.focus();\r\n                restoreFakeSelection(editor);\r\n                editor.nodeChanged();\r\n            }\r\n        };\r\n        var isReadOnly = function (editor) {\r\n            return editor.readonly === true;\r\n        };\r\n        var registerFilters = function (editor) {\r\n            editor.parser.addAttributeFilter('contenteditable', function (nodes) {\r\n                if (isReadOnly(editor)) {\r\n                    each(nodes, function (node) {\r\n                        node.attr(internalContentEditableAttr, node.attr('contenteditable'));\r\n                        node.attr('contenteditable', 'false');\r\n                    });\r\n                }\r\n            });\r\n            editor.serializer.addAttributeFilter(internalContentEditableAttr, function (nodes) {\r\n                if (isReadOnly(editor)) {\r\n                    each(nodes, function (node) {\r\n                        node.attr('contenteditable', node.attr(internalContentEditableAttr));\r\n                    });\r\n                }\r\n            });\r\n            editor.serializer.addTempAttr(internalContentEditableAttr);\r\n        };\r\n        var registerReadOnlyContentFilters = function (editor) {\r\n            if (editor.serializer) {\r\n                registerFilters(editor);\r\n            }\r\n            else {\r\n                editor.on('PreInit', function () {\r\n                    registerFilters(editor);\r\n                });\r\n            }\r\n        };\r\n        var preventReadOnlyEvents = function (e) {\r\n            var target = e.target;\r\n            if (e.type === 'click' && target.tagName === 'A') {\r\n                e.preventDefault();\r\n            }\r\n        };\r\n        var registerReadOnlySelectionBlockers = function (editor) {\r\n            editor.on('ShowCaret', function (e) {\r\n                if (isReadOnly(editor)) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n            editor.on('ObjectSelected', function (e) {\r\n                if (isReadOnly(editor)) {\r\n                    e.preventDefault();\r\n                }\r\n            });\r\n        };\r\n        var defaultModes = [\r\n            'design',\r\n            'readonly'\r\n        ];\r\n        var switchToMode = function (editor, activeMode, availableModes, mode) {\r\n            var oldMode = availableModes[activeMode.get()];\r\n            var newMode = availableModes[mode];\r\n            try {\r\n                newMode.activate();\r\n            }\r\n            catch (e) {\r\n                domGlobals.console.error('problem while activating editor mode ' + mode + ':', e);\r\n                return;\r\n            }\r\n            oldMode.deactivate();\r\n            if (oldMode.editorReadOnly !== newMode.editorReadOnly) {\r\n                toggleReadOnly(editor, newMode.editorReadOnly);\r\n            }\r\n            activeMode.set(mode);\r\n            Events.fireSwitchMode(editor, mode);\r\n        };\r\n        var setMode = function (editor, availableModes, activeMode, mode) {\r\n            if (mode === activeMode.get()) {\r\n                return;\r\n            }\r\n            else if (!has(availableModes, mode)) {\r\n                throw new Error('Editor mode \\'' + mode + '\\' is invalid');\r\n            }\r\n            if (editor.initialized) {\r\n                switchToMode(editor, activeMode, availableModes, mode);\r\n            }\r\n            else {\r\n                editor.on('init', function () {\r\n                    return switchToMode(editor, activeMode, availableModes, mode);\r\n                });\r\n            }\r\n        };\r\n        var registerMode = function (availableModes, mode, api) {\r\n            var _a;\r\n            if (contains(defaultModes, mode)) {\r\n                throw new Error('Cannot override default mode ' + mode);\r\n            }\r\n            return __assign({}, availableModes, (_a = {}, _a[mode] = __assign({}, api, {\r\n                deactivate: function () {\r\n                    try {\r\n                        api.deactivate();\r\n                    }\r\n                    catch (e) {\r\n                        domGlobals.console.error('problem while deactivating editor mode ' + mode + ':');\r\n                        domGlobals.console.error(e);\r\n                    }\r\n                }\r\n            }), _a));\r\n        };\r\n        var create$3 = function (editor) {\r\n            var activeMode = Cell('design');\r\n            var availableModes = Cell({\r\n                design: {\r\n                    activate: noop,\r\n                    deactivate: noop,\r\n                    editorReadOnly: false\r\n                },\r\n                readonly: {\r\n                    activate: noop,\r\n                    deactivate: noop,\r\n                    editorReadOnly: true\r\n                }\r\n            });\r\n            registerReadOnlyContentFilters(editor);\r\n            registerReadOnlySelectionBlockers(editor);\r\n            return {\r\n                isReadOnly: function () {\r\n                    return isReadOnly(editor);\r\n                },\r\n                set: function (mode) {\r\n                    return setMode(editor, availableModes.get(), activeMode, mode);\r\n                },\r\n                get: function () {\r\n                    return activeMode.get();\r\n                },\r\n                register: function (mode, api) {\r\n                    availableModes.set(registerMode(availableModes.get(), mode, api));\r\n                }\r\n            };\r\n        };\r\n        var hasOnlyOneChild$1 = function (node) {\r\n            return node.firstChild && node.firstChild === node.lastChild;\r\n        };\r\n        var isPaddingNode = function (node) {\r\n            return node.name === 'br' || node.value === '\\xA0';\r\n        };\r\n        var isPaddedEmptyBlock = function (schema, node) {\r\n            var blockElements = schema.getBlockElements();\r\n            return blockElements[node.name] && hasOnlyOneChild$1(node) && isPaddingNode(node.firstChild);\r\n        };\r\n        var isEmptyFragmentElement = function (schema, node) {\r\n            var nonEmptyElements = schema.getNonEmptyElements();\r\n            return node && (node.isEmpty(nonEmptyElements) || isPaddedEmptyBlock(schema, node));\r\n        };\r\n        var isListFragment = function (schema, fragment) {\r\n            var firstChild = fragment.firstChild;\r\n            var lastChild = fragment.lastChild;\r\n            if (firstChild && firstChild.name === 'meta') {\r\n                firstChild = firstChild.next;\r\n            }\r\n            if (lastChild && lastChild.attr('id') === 'mce_marker') {\r\n                lastChild = lastChild.prev;\r\n            }\r\n            if (isEmptyFragmentElement(schema, lastChild)) {\r\n                lastChild = lastChild.prev;\r\n            }\r\n            if (!firstChild || firstChild !== lastChild) {\r\n                return false;\r\n            }\r\n            return firstChild.name === 'ul' || firstChild.name === 'ol';\r\n        };\r\n        var cleanupDomFragment = function (domFragment) {\r\n            var firstChild = domFragment.firstChild;\r\n            var lastChild = domFragment.lastChild;\r\n            if (firstChild && firstChild.nodeName === 'META') {\r\n                firstChild.parentNode.removeChild(firstChild);\r\n            }\r\n            if (lastChild && lastChild.id === 'mce_marker') {\r\n                lastChild.parentNode.removeChild(lastChild);\r\n            }\r\n            return domFragment;\r\n        };\r\n        var toDomFragment = function (dom, serializer, fragment) {\r\n            var html = serializer.serialize(fragment);\r\n            var domFragment = dom.createFragment(html);\r\n            return cleanupDomFragment(domFragment);\r\n        };\r\n        var listItems$1 = function (elm) {\r\n            return Tools.grep(elm.childNodes, function (child) {\r\n                return child.nodeName === 'LI';\r\n            });\r\n        };\r\n        var isPadding = function (node) {\r\n            return node.data === '\\xA0' || NodeType.isBr(node);\r\n        };\r\n        var isListItemPadded = function (node) {\r\n            return node && node.firstChild && node.firstChild === node.lastChild && isPadding(node.firstChild);\r\n        };\r\n        var isEmptyOrPadded = function (elm) {\r\n            return !elm.firstChild || isListItemPadded(elm);\r\n        };\r\n        var trimListItems = function (elms) {\r\n            return elms.length > 0 && isEmptyOrPadded(elms[elms.length - 1]) ? elms.slice(0, -1) : elms;\r\n        };\r\n        var getParentLi = function (dom, node) {\r\n            var parentBlock = dom.getParent(node, dom.isBlock);\r\n            return parentBlock && parentBlock.nodeName === 'LI' ? parentBlock : null;\r\n        };\r\n        var isParentBlockLi = function (dom, node) {\r\n            return !!getParentLi(dom, node);\r\n        };\r\n        var getSplit = function (parentNode, rng) {\r\n            var beforeRng = rng.cloneRange();\r\n            var afterRng = rng.cloneRange();\r\n            beforeRng.setStartBefore(parentNode);\r\n            afterRng.setEndAfter(parentNode);\r\n            return [\r\n                beforeRng.cloneContents(),\r\n                afterRng.cloneContents()\r\n            ];\r\n        };\r\n        var findFirstIn = function (node, rootNode) {\r\n            var caretPos = CaretPosition$1.before(node);\r\n            var caretWalker = CaretWalker(rootNode);\r\n            var newCaretPos = caretWalker.next(caretPos);\r\n            return newCaretPos ? newCaretPos.toRange() : null;\r\n        };\r\n        var findLastOf = function (node, rootNode) {\r\n            var caretPos = CaretPosition$1.after(node);\r\n            var caretWalker = CaretWalker(rootNode);\r\n            var newCaretPos = caretWalker.prev(caretPos);\r\n            return newCaretPos ? newCaretPos.toRange() : null;\r\n        };\r\n        var insertMiddle = function (target, elms, rootNode, rng) {\r\n            var parts = getSplit(target, rng);\r\n            var parentElm = target.parentNode;\r\n            parentElm.insertBefore(parts[0], target);\r\n            Tools.each(elms, function (li) {\r\n                parentElm.insertBefore(li, target);\r\n            });\r\n            parentElm.insertBefore(parts[1], target);\r\n            parentElm.removeChild(target);\r\n            return findLastOf(elms[elms.length - 1], rootNode);\r\n        };\r\n        var insertBefore$1 = function (target, elms, rootNode) {\r\n            var parentElm = target.parentNode;\r\n            Tools.each(elms, function (elm) {\r\n                parentElm.insertBefore(elm, target);\r\n            });\r\n            return findFirstIn(target, rootNode);\r\n        };\r\n        var insertAfter$1 = function (target, elms, rootNode, dom) {\r\n            dom.insertAfter(elms.reverse(), target);\r\n            return findLastOf(elms[0], rootNode);\r\n        };\r\n        var insertAtCaret = function (serializer, dom, rng, fragment) {\r\n            var domFragment = toDomFragment(dom, serializer, fragment);\r\n            var liTarget = getParentLi(dom, rng.startContainer);\r\n            var liElms = trimListItems(listItems$1(domFragment.firstChild));\r\n            var BEGINNING = 1, END = 2;\r\n            var rootNode = dom.getRoot();\r\n            var isAt = function (location) {\r\n                var caretPos = CaretPosition$1.fromRangeStart(rng);\r\n                var caretWalker = CaretWalker(dom.getRoot());\r\n                var newPos = location === BEGINNING ? caretWalker.prev(caretPos) : caretWalker.next(caretPos);\r\n                return newPos ? getParentLi(dom, newPos.getNode()) !== liTarget : true;\r\n            };\r\n            if (isAt(BEGINNING)) {\r\n                return insertBefore$1(liTarget, liElms, rootNode);\r\n            }\r\n            else if (isAt(END)) {\r\n                return insertAfter$1(liTarget, liElms, rootNode, dom);\r\n            }\r\n            return insertMiddle(liTarget, liElms, rootNode, rng);\r\n        };\r\n        var InsertList = {\r\n            isListFragment: isListFragment,\r\n            insertAtCaret: insertAtCaret,\r\n            isParentBlockLi: isParentBlockLi,\r\n            trimListItems: trimListItems,\r\n            listItems: listItems$1\r\n        };\r\n        var isAfterNbsp = function (container, offset) {\r\n            return NodeType.isText(container) && container.nodeValue[offset - 1] === '\\xA0';\r\n        };\r\n        var trimOrPadLeftRight = function (rng, html) {\r\n            var container, offset;\r\n            container = rng.startContainer;\r\n            offset = rng.startOffset;\r\n            var hasSiblingText = function (siblingName) {\r\n                return container[siblingName] && container[siblingName].nodeType === 3;\r\n            };\r\n            if (container.nodeType === 3) {\r\n                if (offset > 0) {\r\n                    html = html.replace(/^&nbsp;/, ' ');\r\n                }\r\n                else if (!hasSiblingText('previousSibling')) {\r\n                    html = html.replace(/^ /, '&nbsp;');\r\n                }\r\n                if (offset < container.length) {\r\n                    html = html.replace(/&nbsp;(<br>|)$/, ' ');\r\n                }\r\n                else if (!hasSiblingText('nextSibling')) {\r\n                    html = html.replace(/(&nbsp;| )(<br>|)$/, '&nbsp;');\r\n                }\r\n            }\r\n            return html;\r\n        };\r\n        var trimNbspAfterDeleteAndPadValue = function (rng, value) {\r\n            var container, offset;\r\n            container = rng.startContainer;\r\n            offset = rng.startOffset;\r\n            if (container.nodeType === 3 && rng.collapsed) {\r\n                if (container.data[offset] === '\\xA0') {\r\n                    container.deleteData(offset, 1);\r\n                    if (!/[\\u00a0| ]$/.test(value)) {\r\n                        value += ' ';\r\n                    }\r\n                }\r\n                else if (container.data[offset - 1] === '\\xA0') {\r\n                    container.deleteData(offset - 1, 1);\r\n                    if (!/[\\u00a0| ]$/.test(value)) {\r\n                        value = ' ' + value;\r\n                    }\r\n                }\r\n            }\r\n            return value;\r\n        };\r\n        var isTableCell$5 = NodeType.matchNodeNames('td th');\r\n        var selectionSetContent = function (editor, content) {\r\n            var rng = editor.selection.getRng();\r\n            var container = rng.startContainer;\r\n            var offset = rng.startOffset;\r\n            if (rng.collapsed && isAfterNbsp(container, offset) && NodeType.isText(container)) {\r\n                container.insertData(offset - 1, ' ');\r\n                container.deleteData(offset, 1);\r\n                rng.setStart(container, offset);\r\n                rng.setEnd(container, offset);\r\n                editor.selection.setRng(rng);\r\n            }\r\n            editor.selection.setContent(content);\r\n        };\r\n        var validInsertion = function (editor, value, parentNode) {\r\n            if (parentNode.getAttribute('data-mce-bogus') === 'all') {\r\n                parentNode.parentNode.insertBefore(editor.dom.createFragment(value), parentNode);\r\n            }\r\n            else {\r\n                var node = parentNode.firstChild;\r\n                var node2 = parentNode.lastChild;\r\n                if (!node || node === node2 && node.nodeName === 'BR') {\r\n                    editor.dom.setHTML(parentNode, value);\r\n                }\r\n                else {\r\n                    selectionSetContent(editor, value);\r\n                }\r\n            }\r\n        };\r\n        var trimBrsFromTableCell = function (dom, elm) {\r\n            Option.from(dom.getParent(elm, 'td,th')).map(Element.fromDom).each(PaddingBr.trimBlockTrailingBr);\r\n        };\r\n        var reduceInlineTextElements = function (editor, merge) {\r\n            var textInlineElements = editor.schema.getTextInlineElements();\r\n            var dom = editor.dom;\r\n            if (merge) {\r\n                var root_1 = editor.getBody(), elementUtils_1 = new ElementUtils(dom);\r\n                Tools.each(dom.select('*[data-mce-fragment]'), function (node) {\r\n                    for (var testNode = node.parentNode; testNode && testNode !== root_1; testNode = testNode.parentNode) {\r\n                        if (textInlineElements[node.nodeName.toLowerCase()] && elementUtils_1.compare(testNode, node)) {\r\n                            dom.remove(node, true);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n        };\r\n        var markFragmentElements = function (fragment) {\r\n            var node = fragment;\r\n            while (node = node.walk()) {\r\n                if (node.type === 1) {\r\n                    node.attr('data-mce-fragment', '1');\r\n                }\r\n            }\r\n        };\r\n        var umarkFragmentElements = function (elm) {\r\n            Tools.each(elm.getElementsByTagName('*'), function (elm) {\r\n                elm.removeAttribute('data-mce-fragment');\r\n            });\r\n        };\r\n        var isPartOfFragment = function (node) {\r\n            return !!node.getAttribute('data-mce-fragment');\r\n        };\r\n        var canHaveChildren = function (editor, node) {\r\n            return node && !editor.schema.getShortEndedElements()[node.nodeName];\r\n        };\r\n        var moveSelectionToMarker = function (editor, marker) {\r\n            var parentEditableFalseElm, parentBlock, nextRng;\r\n            var dom = editor.dom, selection = editor.selection;\r\n            var node, node2;\r\n            var getContentEditableFalseParent = function (node) {\r\n                var root = editor.getBody();\r\n                for (; node && node !== root; node = node.parentNode) {\r\n                    if (editor.dom.getContentEditable(node) === 'false') {\r\n                        return node;\r\n                    }\r\n                }\r\n                return null;\r\n            };\r\n            if (!marker) {\r\n                return;\r\n            }\r\n            editor.selection.scrollIntoView(marker);\r\n            parentEditableFalseElm = getContentEditableFalseParent(marker);\r\n            if (parentEditableFalseElm) {\r\n                dom.remove(marker);\r\n                selection.select(parentEditableFalseElm);\r\n                return;\r\n            }\r\n            var rng = dom.createRng();\r\n            node = marker.previousSibling;\r\n            if (node && node.nodeType === 3) {\r\n                rng.setStart(node, node.nodeValue.length);\r\n                if (!Env.ie) {\r\n                    node2 = marker.nextSibling;\r\n                    if (node2 && node2.nodeType === 3) {\r\n                        node.appendData(node2.data);\r\n                        node2.parentNode.removeChild(node2);\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                rng.setStartBefore(marker);\r\n                rng.setEndBefore(marker);\r\n            }\r\n            var findNextCaretRng = function (rng) {\r\n                var caretPos = CaretPosition$1.fromRangeStart(rng);\r\n                var caretWalker = CaretWalker(editor.getBody());\r\n                caretPos = caretWalker.next(caretPos);\r\n                if (caretPos) {\r\n                    return caretPos.toRange();\r\n                }\r\n            };\r\n            parentBlock = dom.getParent(marker, dom.isBlock);\r\n            dom.remove(marker);\r\n            if (parentBlock && dom.isEmpty(parentBlock)) {\r\n                editor.$(parentBlock).empty();\r\n                rng.setStart(parentBlock, 0);\r\n                rng.setEnd(parentBlock, 0);\r\n                if (!isTableCell$5(parentBlock) && !isPartOfFragment(parentBlock) && (nextRng = findNextCaretRng(rng))) {\r\n                    rng = nextRng;\r\n                    dom.remove(parentBlock);\r\n                }\r\n                else {\r\n                    dom.add(parentBlock, dom.create('br', { 'data-mce-bogus': '1' }));\r\n                }\r\n            }\r\n            selection.setRng(rng);\r\n        };\r\n        var insertHtmlAtCaret = function (editor, value, details) {\r\n            var parser, serializer, parentNode, rootNode, fragment, args;\r\n            var marker, rng, node, bookmarkHtml, merge;\r\n            var selection = editor.selection, dom = editor.dom;\r\n            if (/^ | $/.test(value)) {\r\n                value = trimOrPadLeftRight(selection.getRng(), value);\r\n            }\r\n            parser = editor.parser;\r\n            merge = details.merge;\r\n            serializer = Serializer({ validate: editor.settings.validate }, editor.schema);\r\n            bookmarkHtml = '<span id=\"mce_marker\" data-mce-type=\"bookmark\">&#xFEFF;&#x200B;</span>';\r\n            args = {\r\n                content: value,\r\n                format: 'html',\r\n                selection: true,\r\n                paste: details.paste\r\n            };\r\n            args = editor.fire('BeforeSetContent', args);\r\n            if (args.isDefaultPrevented()) {\r\n                editor.fire('SetContent', {\r\n                    content: args.content,\r\n                    format: 'html',\r\n                    selection: true,\r\n                    paste: details.paste\r\n                });\r\n                return;\r\n            }\r\n            value = args.content;\r\n            if (value.indexOf('{$caret}') === -1) {\r\n                value += '{$caret}';\r\n            }\r\n            value = value.replace(/\\{\\$caret\\}/, bookmarkHtml);\r\n            rng = selection.getRng();\r\n            var caretElement = rng.startContainer || (rng.parentElement ? rng.parentElement() : null);\r\n            var body = editor.getBody();\r\n            if (caretElement === body && selection.isCollapsed()) {\r\n                if (dom.isBlock(body.firstChild) && canHaveChildren(editor, body.firstChild) && dom.isEmpty(body.firstChild)) {\r\n                    rng = dom.createRng();\r\n                    rng.setStart(body.firstChild, 0);\r\n                    rng.setEnd(body.firstChild, 0);\r\n                    selection.setRng(rng);\r\n                }\r\n            }\r\n            if (!selection.isCollapsed()) {\r\n                editor.selection.setRng(RangeNormalizer.normalize(editor.selection.getRng()));\r\n                editor.getDoc().execCommand('Delete', false, null);\r\n                value = trimNbspAfterDeleteAndPadValue(editor.selection.getRng(), value);\r\n            }\r\n            parentNode = selection.getNode();\r\n            var parserArgs = {\r\n                context: parentNode.nodeName.toLowerCase(),\r\n                data: details.data,\r\n                insert: true\r\n            };\r\n            fragment = parser.parse(value, parserArgs);\r\n            if (details.paste === true && InsertList.isListFragment(editor.schema, fragment) && InsertList.isParentBlockLi(dom, parentNode)) {\r\n                rng = InsertList.insertAtCaret(serializer, dom, editor.selection.getRng(), fragment);\r\n                editor.selection.setRng(rng);\r\n                editor.fire('SetContent', args);\r\n                return;\r\n            }\r\n            markFragmentElements(fragment);\r\n            node = fragment.lastChild;\r\n            if (node.attr('id') === 'mce_marker') {\r\n                marker = node;\r\n                for (node = node.prev; node; node = node.walk(true)) {\r\n                    if (node.type === 3 || !dom.isBlock(node.name)) {\r\n                        if (editor.schema.isValidChild(node.parent.name, 'span')) {\r\n                            node.parent.insert(marker, node, node.name === 'br');\r\n                        }\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n            editor._selectionOverrides.showBlockCaretContainer(parentNode);\r\n            if (!parserArgs.invalid) {\r\n                value = serializer.serialize(fragment);\r\n                validInsertion(editor, value, parentNode);\r\n            }\r\n            else {\r\n                selectionSetContent(editor, bookmarkHtml);\r\n                parentNode = selection.getNode();\r\n                rootNode = editor.getBody();\r\n                if (parentNode.nodeType === 9) {\r\n                    parentNode = node = rootNode;\r\n                }\r\n                else {\r\n                    node = parentNode;\r\n                }\r\n                while (node !== rootNode) {\r\n                    parentNode = node;\r\n                    node = node.parentNode;\r\n                }\r\n                value = parentNode === rootNode ? rootNode.innerHTML : dom.getOuterHTML(parentNode);\r\n                value = serializer.serialize(parser.parse(value.replace(/<span (id=\"mce_marker\"|id=mce_marker).+?<\\/span>/i, function () {\r\n                    return serializer.serialize(fragment);\r\n                })));\r\n                if (parentNode === rootNode) {\r\n                    dom.setHTML(rootNode, value);\r\n                }\r\n                else {\r\n                    dom.setOuterHTML(parentNode, value);\r\n                }\r\n            }\r\n            reduceInlineTextElements(editor, merge);\r\n            moveSelectionToMarker(editor, dom.get('mce_marker'));\r\n            umarkFragmentElements(editor.getBody());\r\n            trimBrsFromTableCell(editor.dom, editor.selection.getStart());\r\n            editor.fire('SetContent', args);\r\n            editor.addVisual();\r\n        };\r\n        var processValue = function (value) {\r\n            var details;\r\n            if (typeof value !== 'string') {\r\n                details = Tools.extend({\r\n                    paste: value.paste,\r\n                    data: { paste: value.paste }\r\n                }, value);\r\n                return {\r\n                    content: value.content,\r\n                    details: details\r\n                };\r\n            }\r\n            return {\r\n                content: value,\r\n                details: {}\r\n            };\r\n        };\r\n        var insertAtCaret$1 = function (editor, value) {\r\n            var result = processValue(value);\r\n            insertHtmlAtCaret(editor, result.content, result.details);\r\n        };\r\n        var InsertContent = { insertAtCaret: insertAtCaret$1 };\r\n        var nativeCommand = function (editor, command) {\r\n            editor.getDoc().execCommand(command, false, null);\r\n        };\r\n        var deleteCommand = function (editor) {\r\n            if (CefDelete.backspaceDelete(editor, false)) {\r\n                return;\r\n            }\r\n            else if (CefBoundaryDelete.backspaceDelete(editor, false)) {\r\n                return;\r\n            }\r\n            else if (BoundaryDelete.backspaceDelete(editor, false)) {\r\n                return;\r\n            }\r\n            else if (BlockBoundaryDelete.backspaceDelete(editor, false)) {\r\n                return;\r\n            }\r\n            else if (TableDelete.backspaceDelete(editor)) {\r\n                return;\r\n            }\r\n            else if (BlockRangeDelete.backspaceDelete(editor, false)) {\r\n                return;\r\n            }\r\n            else if (InlineFormatDelete.backspaceDelete(editor, false)) {\r\n                return;\r\n            }\r\n            else {\r\n                nativeCommand(editor, 'Delete');\r\n                DeleteUtils.paddEmptyBody(editor);\r\n            }\r\n        };\r\n        var forwardDeleteCommand = function (editor) {\r\n            if (CefDelete.backspaceDelete(editor, true)) {\r\n                return;\r\n            }\r\n            else if (CefBoundaryDelete.backspaceDelete(editor, true)) {\r\n                return;\r\n            }\r\n            else if (BoundaryDelete.backspaceDelete(editor, true)) {\r\n                return;\r\n            }\r\n            else if (BlockBoundaryDelete.backspaceDelete(editor, true)) {\r\n                return;\r\n            }\r\n            else if (TableDelete.backspaceDelete(editor)) {\r\n                return;\r\n            }\r\n            else if (BlockRangeDelete.backspaceDelete(editor, true)) {\r\n                return;\r\n            }\r\n            else if (InlineFormatDelete.backspaceDelete(editor, true)) {\r\n                return;\r\n            }\r\n            else {\r\n                nativeCommand(editor, 'ForwardDelete');\r\n            }\r\n        };\r\n        var DeleteCommands = {\r\n            deleteCommand: deleteCommand,\r\n            forwardDeleteCommand: forwardDeleteCommand\r\n        };\r\n        var getSpecifiedFontProp = function (propName, rootElm, elm) {\r\n            var getProperty = function (elm) {\r\n                return getRaw(elm, propName);\r\n            };\r\n            var isRoot = function (elm) {\r\n                return eq(Element.fromDom(rootElm), elm);\r\n            };\r\n            return closest(Element.fromDom(elm), function (elm) {\r\n                return getProperty(elm).isSome();\r\n            }, isRoot).bind(getProperty);\r\n        };\r\n        var round$1 = function (number, precision) {\r\n            var factor = Math.pow(10, precision);\r\n            return Math.round(number * factor) / factor;\r\n        };\r\n        var toPt = function (fontSize, precision) {\r\n            if (/[0-9.]+px$/.test(fontSize)) {\r\n                return round$1(parseInt(fontSize, 10) * 72 / 96, precision || 0) + 'pt';\r\n            }\r\n            return fontSize;\r\n        };\r\n        var normalizeFontFamily = function (fontFamily) {\r\n            return fontFamily.replace(/[\\'\\\"\\\\]/g, '').replace(/,\\s+/g, ',');\r\n        };\r\n        var getComputedFontProp = function (propName, elm) {\r\n            return Option.from(DOMUtils$1.DOM.getStyle(elm, propName, true));\r\n        };\r\n        var getFontProp = function (propName) {\r\n            return function (rootElm, elm) {\r\n                return Option.from(elm).map(Element.fromDom).filter(isElement).bind(function (element) {\r\n                    return getSpecifiedFontProp(propName, rootElm, element.dom()).or(getComputedFontProp(propName, element.dom()));\r\n                }).getOr('');\r\n            };\r\n        };\r\n        var FontInfo = {\r\n            getFontSize: getFontProp('font-size'),\r\n            getFontFamily: compose(normalizeFontFamily, getFontProp('font-family')),\r\n            toPt: toPt\r\n        };\r\n        var findFirstCaretElement = function (editor) {\r\n            return CaretFinder.firstPositionIn(editor.getBody()).map(function (caret) {\r\n                var container = caret.container();\r\n                return NodeType.isText(container) ? container.parentNode : container;\r\n            });\r\n        };\r\n        var isRangeAtStartOfNode = function (rng, root) {\r\n            return rng.startContainer === root && rng.startOffset === 0;\r\n        };\r\n        var getCaretElement = function (editor) {\r\n            return Option.from(editor.selection.getRng()).bind(function (rng) {\r\n                var root = editor.getBody();\r\n                return isRangeAtStartOfNode(rng, root) ? Option.none() : Option.from(editor.selection.getStart(true));\r\n            });\r\n        };\r\n        var fromFontSizeNumber = function (editor, value) {\r\n            if (/^[0-9\\.]+$/.test(value)) {\r\n                var fontSizeNumber = parseInt(value, 10);\r\n                if (fontSizeNumber >= 1 && fontSizeNumber <= 7) {\r\n                    var fontSizes = Settings.getFontStyleValues(editor);\r\n                    var fontClasses = Settings.getFontSizeClasses(editor);\r\n                    if (fontClasses) {\r\n                        return fontClasses[fontSizeNumber - 1] || value;\r\n                    }\r\n                    else {\r\n                        return fontSizes[fontSizeNumber - 1] || value;\r\n                    }\r\n                }\r\n                else {\r\n                    return value;\r\n                }\r\n            }\r\n            else {\r\n                return value;\r\n            }\r\n        };\r\n        var fontNameAction = function (editor, value) {\r\n            editor.formatter.toggle('fontname', { value: fromFontSizeNumber(editor, value) });\r\n            editor.nodeChanged();\r\n        };\r\n        var fontNameQuery = function (editor) {\r\n            return getCaretElement(editor).fold(function () {\r\n                return findFirstCaretElement(editor).map(function (caretElement) {\r\n                    return FontInfo.getFontFamily(editor.getBody(), caretElement);\r\n                }).getOr('');\r\n            }, function (caretElement) {\r\n                return FontInfo.getFontFamily(editor.getBody(), caretElement);\r\n            });\r\n        };\r\n        var fontSizeAction = function (editor, value) {\r\n            editor.formatter.toggle('fontsize', { value: fromFontSizeNumber(editor, value) });\r\n            editor.nodeChanged();\r\n        };\r\n        var fontSizeQuery = function (editor) {\r\n            return getCaretElement(editor).fold(function () {\r\n                return findFirstCaretElement(editor).map(function (caretElement) {\r\n                    return FontInfo.getFontSize(editor.getBody(), caretElement);\r\n                }).getOr('');\r\n            }, function (caretElement) {\r\n                return FontInfo.getFontSize(editor.getBody(), caretElement);\r\n            });\r\n        };\r\n        var isEditable$1 = function (target) {\r\n            return closest(target, function (elm) {\r\n                return NodeType.isContentEditableTrue(elm.dom()) || NodeType.isContentEditableFalse(elm.dom());\r\n            }).exists(function (elm) {\r\n                return NodeType.isContentEditableTrue(elm.dom());\r\n            });\r\n        };\r\n        var parseIndentValue = function (value) {\r\n            var number = parseInt(value, 10);\r\n            return isNaN(number) ? 0 : number;\r\n        };\r\n        var getIndentStyleName = function (useMargin, element) {\r\n            var indentStyleName = useMargin || isTable$1(element) ? 'margin' : 'padding';\r\n            var suffix = get$2(element, 'direction') === 'rtl' ? '-right' : '-left';\r\n            return indentStyleName + suffix;\r\n        };\r\n        var indentElement = function (dom, command, useMargin, value, unit, element) {\r\n            var indentStyleName = getIndentStyleName(useMargin, Element.fromDom(element));\r\n            if (command === 'outdent') {\r\n                var styleValue = Math.max(0, parseIndentValue(element.style[indentStyleName]) - value);\r\n                dom.setStyle(element, indentStyleName, styleValue ? styleValue + unit : '');\r\n            }\r\n            else {\r\n                var styleValue = parseIndentValue(element.style[indentStyleName]) + value + unit;\r\n                dom.setStyle(element, indentStyleName, styleValue);\r\n            }\r\n        };\r\n        var validateBlocks = function (editor, blocks) {\r\n            return forall(blocks, function (block) {\r\n                var indentStyleName = getIndentStyleName(Settings.shouldIndentUseMargin(editor), block);\r\n                var intentValue = getRaw(block, indentStyleName).map(parseIndentValue).getOr(0);\r\n                var contentEditable = editor.dom.getContentEditable(block.dom());\r\n                return contentEditable !== 'false' && intentValue > 0;\r\n            });\r\n        };\r\n        var canOutdent = function (editor) {\r\n            var blocks = getBlocksToIndent(editor);\r\n            return editor.readonly !== true && (blocks.length > 1 || validateBlocks(editor, blocks));\r\n        };\r\n        var isListComponent = function (el) {\r\n            return isList(el) || isListItem(el);\r\n        };\r\n        var parentIsListComponent = function (el) {\r\n            return parent(el).map(isListComponent).getOr(false);\r\n        };\r\n        var getBlocksToIndent = function (editor) {\r\n            return filter(map(editor.selection.getSelectedBlocks(), Element.fromDom), function (el) {\r\n                return !isListComponent(el) && !parentIsListComponent(el) && isEditable$1(el);\r\n            });\r\n        };\r\n        var handle = function (editor, command) {\r\n            var dom = editor.dom, selection = editor.selection, formatter = editor.formatter;\r\n            var indentation = Settings.getIndentation(editor);\r\n            var indentUnit = /[a-z%]+$/i.exec(indentation)[0];\r\n            var indentValue = parseInt(indentation, 10);\r\n            var useMargin = Settings.shouldIndentUseMargin(editor);\r\n            var forcedRootBlock = Settings.getForcedRootBlock(editor);\r\n            if (!editor.queryCommandState('InsertUnorderedList') && !editor.queryCommandState('InsertOrderedList')) {\r\n                if (forcedRootBlock === '' && !dom.getParent(selection.getNode(), dom.isBlock)) {\r\n                    formatter.apply('div');\r\n                }\r\n            }\r\n            each(getBlocksToIndent(editor), function (block) {\r\n                indentElement(dom, command, useMargin, indentValue, indentUnit, block.dom());\r\n            });\r\n        };\r\n        var each$g = Tools.each;\r\n        var map$3 = Tools.map, inArray$2 = Tools.inArray;\r\n        var EditorCommands = function () {\r\n            function EditorCommands(editor) {\r\n                this.commands = {\r\n                    state: {},\r\n                    exec: {},\r\n                    value: {}\r\n                };\r\n                this.editor = editor;\r\n                this.setupCommands(editor);\r\n            }\r\n            EditorCommands.prototype.execCommand = function (command, ui, value, args) {\r\n                var func, customCommand, state = false;\r\n                var self = this;\r\n                if (self.editor.removed) {\r\n                    return;\r\n                }\r\n                if (!/^(mceAddUndoLevel|mceEndUndoLevel|mceBeginUndoLevel|mceRepaint)$/.test(command) && (!args || !args.skip_focus)) {\r\n                    self.editor.focus();\r\n                }\r\n                else {\r\n                    SelectionBookmark.restore(self.editor);\r\n                }\r\n                args = self.editor.fire('BeforeExecCommand', {\r\n                    command: command,\r\n                    ui: ui,\r\n                    value: value\r\n                });\r\n                if (args.isDefaultPrevented()) {\r\n                    return false;\r\n                }\r\n                customCommand = command.toLowerCase();\r\n                if (func = self.commands.exec[customCommand]) {\r\n                    func(customCommand, ui, value);\r\n                    self.editor.fire('ExecCommand', {\r\n                        command: command,\r\n                        ui: ui,\r\n                        value: value\r\n                    });\r\n                    return true;\r\n                }\r\n                each$g(this.editor.plugins, function (p) {\r\n                    if (p.execCommand && p.execCommand(command, ui, value)) {\r\n                        self.editor.fire('ExecCommand', {\r\n                            command: command,\r\n                            ui: ui,\r\n                            value: value\r\n                        });\r\n                        state = true;\r\n                        return false;\r\n                    }\r\n                });\r\n                if (state) {\r\n                    return state;\r\n                }\r\n                if (self.editor.theme && self.editor.theme.execCommand && self.editor.theme.execCommand(command, ui, value)) {\r\n                    self.editor.fire('ExecCommand', {\r\n                        command: command,\r\n                        ui: ui,\r\n                        value: value\r\n                    });\r\n                    return true;\r\n                }\r\n                try {\r\n                    state = self.editor.getDoc().execCommand(command, ui, value);\r\n                }\r\n                catch (ex) {\r\n                }\r\n                if (state) {\r\n                    self.editor.fire('ExecCommand', {\r\n                        command: command,\r\n                        ui: ui,\r\n                        value: value\r\n                    });\r\n                    return true;\r\n                }\r\n                return false;\r\n            };\r\n            EditorCommands.prototype.queryCommandState = function (command) {\r\n                var func;\r\n                if (this.editor.quirks.isHidden() || this.editor.removed) {\r\n                    return;\r\n                }\r\n                command = command.toLowerCase();\r\n                if (func = this.commands.state[command]) {\r\n                    return func(command);\r\n                }\r\n                try {\r\n                    return this.editor.getDoc().queryCommandState(command);\r\n                }\r\n                catch (ex) {\r\n                }\r\n                return false;\r\n            };\r\n            EditorCommands.prototype.queryCommandValue = function (command) {\r\n                var func;\r\n                if (this.editor.quirks.isHidden() || this.editor.removed) {\r\n                    return;\r\n                }\r\n                command = command.toLowerCase();\r\n                if (func = this.commands.value[command]) {\r\n                    return func(command);\r\n                }\r\n                try {\r\n                    return this.editor.getDoc().queryCommandValue(command);\r\n                }\r\n                catch (ex) {\r\n                }\r\n            };\r\n            EditorCommands.prototype.addCommands = function (commandList, type) {\r\n                var self = this;\r\n                type = type || 'exec';\r\n                each$g(commandList, function (callback, command) {\r\n                    each$g(command.toLowerCase().split(','), function (command) {\r\n                        self.commands[type][command] = callback;\r\n                    });\r\n                });\r\n            };\r\n            EditorCommands.prototype.addCommand = function (command, callback, scope) {\r\n                var _this = this;\r\n                command = command.toLowerCase();\r\n                this.commands.exec[command] = function (command, ui, value, args) {\r\n                    return callback.call(scope || _this.editor, ui, value, args);\r\n                };\r\n            };\r\n            EditorCommands.prototype.queryCommandSupported = function (command) {\r\n                command = command.toLowerCase();\r\n                if (this.commands.exec[command]) {\r\n                    return true;\r\n                }\r\n                try {\r\n                    return this.editor.getDoc().queryCommandSupported(command);\r\n                }\r\n                catch (ex) {\r\n                }\r\n                return false;\r\n            };\r\n            EditorCommands.prototype.addQueryStateHandler = function (command, callback, scope) {\r\n                var _this = this;\r\n                command = command.toLowerCase();\r\n                this.commands.state[command] = function () {\r\n                    return callback.call(scope || _this.editor);\r\n                };\r\n            };\r\n            EditorCommands.prototype.addQueryValueHandler = function (command, callback, scope) {\r\n                var _this = this;\r\n                command = command.toLowerCase();\r\n                this.commands.value[command] = function () {\r\n                    return callback.call(scope || _this.editor);\r\n                };\r\n            };\r\n            EditorCommands.prototype.hasCustomCommand = function (command) {\r\n                command = command.toLowerCase();\r\n                return !!this.commands.exec[command];\r\n            };\r\n            EditorCommands.prototype.execNativeCommand = function (command, ui, value) {\r\n                if (ui === undefined) {\r\n                    ui = false;\r\n                }\r\n                if (value === undefined) {\r\n                    value = null;\r\n                }\r\n                return this.editor.getDoc().execCommand(command, ui, value);\r\n            };\r\n            EditorCommands.prototype.isFormatMatch = function (name) {\r\n                return this.editor.formatter.match(name);\r\n            };\r\n            EditorCommands.prototype.toggleFormat = function (name, value) {\r\n                this.editor.formatter.toggle(name, value ? { value: value } : undefined);\r\n                this.editor.nodeChanged();\r\n            };\r\n            EditorCommands.prototype.storeSelection = function (type) {\r\n                this.selectionBookmark = this.editor.selection.getBookmark(type);\r\n            };\r\n            EditorCommands.prototype.restoreSelection = function () {\r\n                this.editor.selection.moveToBookmark(this.selectionBookmark);\r\n            };\r\n            EditorCommands.prototype.setupCommands = function (editor) {\r\n                var self = this;\r\n                this.addCommands({\r\n                    'mceResetDesignMode,mceBeginUndoLevel': function () {\r\n                    },\r\n                    'mceEndUndoLevel,mceAddUndoLevel': function () {\r\n                        editor.undoManager.add();\r\n                    },\r\n                    'Cut,Copy,Paste': function (command) {\r\n                        var doc = editor.getDoc();\r\n                        var failed;\r\n                        try {\r\n                            self.execNativeCommand(command);\r\n                        }\r\n                        catch (ex) {\r\n                            failed = true;\r\n                        }\r\n                        if (command === 'paste' && !doc.queryCommandEnabled(command)) {\r\n                            failed = true;\r\n                        }\r\n                        if (failed || !doc.queryCommandSupported(command)) {\r\n                            var msg = editor.translate('Your browser doesn\\'t support direct access to the clipboard. ' + 'Please use the Ctrl+X/C/V keyboard shortcuts instead.');\r\n                            if (Env.mac) {\r\n                                msg = msg.replace(/Ctrl\\+/g, '\\u2318+');\r\n                            }\r\n                            editor.notificationManager.open({\r\n                                text: msg,\r\n                                type: 'error'\r\n                            });\r\n                        }\r\n                    },\r\n                    'unlink': function () {\r\n                        if (editor.selection.isCollapsed()) {\r\n                            var elm = editor.dom.getParent(editor.selection.getStart(), 'a');\r\n                            if (elm) {\r\n                                editor.dom.remove(elm, true);\r\n                            }\r\n                            return;\r\n                        }\r\n                        editor.formatter.remove('link');\r\n                    },\r\n                    'JustifyLeft,JustifyCenter,JustifyRight,JustifyFull,JustifyNone': function (command) {\r\n                        var align = command.substring(7);\r\n                        if (align === 'full') {\r\n                            align = 'justify';\r\n                        }\r\n                        each$g('left,center,right,justify'.split(','), function (name) {\r\n                            if (align !== name) {\r\n                                editor.formatter.remove('align' + name);\r\n                            }\r\n                        });\r\n                        if (align !== 'none') {\r\n                            self.toggleFormat('align' + align);\r\n                        }\r\n                    },\r\n                    'InsertUnorderedList,InsertOrderedList': function (command) {\r\n                        var listElm, listParent;\r\n                        self.execNativeCommand(command);\r\n                        listElm = editor.dom.getParent(editor.selection.getNode(), 'ol,ul');\r\n                        if (listElm) {\r\n                            listParent = listElm.parentNode;\r\n                            if (/^(H[1-6]|P|ADDRESS|PRE)$/.test(listParent.nodeName)) {\r\n                                self.storeSelection();\r\n                                editor.dom.split(listParent, listElm);\r\n                                self.restoreSelection();\r\n                            }\r\n                        }\r\n                    },\r\n                    'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\r\n                        self.toggleFormat(command);\r\n                    },\r\n                    'ForeColor,HiliteColor': function (command, ui, value) {\r\n                        self.toggleFormat(command, value);\r\n                    },\r\n                    'FontName': function (command, ui, value) {\r\n                        fontNameAction(editor, value);\r\n                    },\r\n                    'FontSize': function (command, ui, value) {\r\n                        fontSizeAction(editor, value);\r\n                    },\r\n                    'RemoveFormat': function (command) {\r\n                        editor.formatter.remove(command);\r\n                    },\r\n                    'mceBlockQuote': function () {\r\n                        self.toggleFormat('blockquote');\r\n                    },\r\n                    'FormatBlock': function (command, ui, value) {\r\n                        return self.toggleFormat(value || 'p');\r\n                    },\r\n                    'mceCleanup': function () {\r\n                        var bookmark = editor.selection.getBookmark();\r\n                        editor.setContent(editor.getContent());\r\n                        editor.selection.moveToBookmark(bookmark);\r\n                    },\r\n                    'mceRemoveNode': function (command, ui, value) {\r\n                        var node = value || editor.selection.getNode();\r\n                        if (node !== editor.getBody()) {\r\n                            self.storeSelection();\r\n                            editor.dom.remove(node, true);\r\n                            self.restoreSelection();\r\n                        }\r\n                    },\r\n                    'mceSelectNodeDepth': function (command, ui, value) {\r\n                        var counter = 0;\r\n                        editor.dom.getParent(editor.selection.getNode(), function (node) {\r\n                            if (node.nodeType === 1 && counter++ === value) {\r\n                                editor.selection.select(node);\r\n                                return false;\r\n                            }\r\n                        }, editor.getBody());\r\n                    },\r\n                    'mceSelectNode': function (command, ui, value) {\r\n                        editor.selection.select(value);\r\n                    },\r\n                    'mceInsertContent': function (command, ui, value) {\r\n                        InsertContent.insertAtCaret(editor, value);\r\n                    },\r\n                    'mceInsertRawHTML': function (command, ui, value) {\r\n                        editor.selection.setContent('tiny_mce_marker');\r\n                        var content = editor.getContent();\r\n                        editor.setContent(content.replace(/tiny_mce_marker/g, function () {\r\n                            return value;\r\n                        }));\r\n                    },\r\n                    'mceInsertNewLine': function (command, ui, value) {\r\n                        InsertNewLine.insert(editor, value);\r\n                    },\r\n                    'mceToggleFormat': function (command, ui, value) {\r\n                        self.toggleFormat(value);\r\n                    },\r\n                    'mceSetContent': function (command, ui, value) {\r\n                        editor.setContent(value);\r\n                    },\r\n                    'Indent,Outdent': function (command) {\r\n                        handle(editor, command);\r\n                    },\r\n                    'mceRepaint': function () {\r\n                    },\r\n                    'InsertHorizontalRule': function () {\r\n                        editor.execCommand('mceInsertContent', false, '<hr />');\r\n                    },\r\n                    'mceToggleVisualAid': function () {\r\n                        editor.hasVisual = !editor.hasVisual;\r\n                        editor.addVisual();\r\n                    },\r\n                    'mceReplaceContent': function (command, ui, value) {\r\n                        editor.execCommand('mceInsertContent', false, value.replace(/\\{\\$selection\\}/g, editor.selection.getContent({ format: 'text' })));\r\n                    },\r\n                    'mceInsertLink': function (command, ui, value) {\r\n                        var anchor;\r\n                        if (typeof value === 'string') {\r\n                            value = { href: value };\r\n                        }\r\n                        anchor = editor.dom.getParent(editor.selection.getNode(), 'a');\r\n                        value.href = value.href.replace(/ /g, '%20');\r\n                        if (!anchor || !value.href) {\r\n                            editor.formatter.remove('link');\r\n                        }\r\n                        if (value.href) {\r\n                            editor.formatter.apply('link', value, anchor);\r\n                        }\r\n                    },\r\n                    'selectAll': function () {\r\n                        var editingHost = editor.dom.getParent(editor.selection.getStart(), NodeType.isContentEditableTrue);\r\n                        if (editingHost) {\r\n                            var rng = editor.dom.createRng();\r\n                            rng.selectNodeContents(editingHost);\r\n                            editor.selection.setRng(rng);\r\n                        }\r\n                    },\r\n                    'delete': function () {\r\n                        DeleteCommands.deleteCommand(editor);\r\n                    },\r\n                    'forwardDelete': function () {\r\n                        DeleteCommands.forwardDeleteCommand(editor);\r\n                    },\r\n                    'mceNewDocument': function () {\r\n                        editor.setContent('');\r\n                    },\r\n                    'InsertLineBreak': function (command, ui, value) {\r\n                        InsertBr.insert(editor, value);\r\n                        return true;\r\n                    }\r\n                });\r\n                var alignStates = function (name) {\r\n                    return function () {\r\n                        var nodes = editor.selection.isCollapsed() ? [editor.dom.getParent(editor.selection.getNode(), editor.dom.isBlock)] : editor.selection.getSelectedBlocks();\r\n                        var matches = map$3(nodes, function (node) {\r\n                            return !!editor.formatter.matchNode(node, name);\r\n                        });\r\n                        return inArray$2(matches, true) !== -1;\r\n                    };\r\n                };\r\n                self.addCommands({\r\n                    'JustifyLeft': alignStates('alignleft'),\r\n                    'JustifyCenter': alignStates('aligncenter'),\r\n                    'JustifyRight': alignStates('alignright'),\r\n                    'JustifyFull': alignStates('alignjustify'),\r\n                    'Bold,Italic,Underline,Strikethrough,Superscript,Subscript': function (command) {\r\n                        return self.isFormatMatch(command);\r\n                    },\r\n                    'mceBlockQuote': function () {\r\n                        return self.isFormatMatch('blockquote');\r\n                    },\r\n                    'Outdent': function () {\r\n                        return canOutdent(editor);\r\n                    },\r\n                    'InsertUnorderedList,InsertOrderedList': function (command) {\r\n                        var list = editor.dom.getParent(editor.selection.getNode(), 'ul,ol');\r\n                        return list && (command === 'insertunorderedlist' && list.tagName === 'UL' || command === 'insertorderedlist' && list.tagName === 'OL');\r\n                    }\r\n                }, 'state');\r\n                self.addCommands({\r\n                    Undo: function () {\r\n                        editor.undoManager.undo();\r\n                    },\r\n                    Redo: function () {\r\n                        editor.undoManager.redo();\r\n                    }\r\n                });\r\n                self.addQueryValueHandler('FontName', function () {\r\n                    return fontNameQuery(editor);\r\n                }, this);\r\n                self.addQueryValueHandler('FontSize', function () {\r\n                    return fontSizeQuery(editor);\r\n                }, this);\r\n            };\r\n            return EditorCommands;\r\n        }();\r\n        var nativeEvents = Tools.makeMap('focus blur focusin focusout click dblclick mousedown mouseup mousemove mouseover beforepaste paste cut copy selectionchange ' + 'mouseout mouseenter mouseleave wheel keydown keypress keyup input contextmenu dragstart dragend dragover ' + 'draggesture dragdrop drop drag submit ' + 'compositionstart compositionend compositionupdate touchstart touchmove touchend', ' ');\r\n        var returnFalse$1 = function () {\r\n            return false;\r\n        };\r\n        var returnTrue$1 = function () {\r\n            return true;\r\n        };\r\n        var EventDispatcher = function () {\r\n            function EventDispatcher(settings) {\r\n                this.bindings = {};\r\n                this.settings = settings || {};\r\n                this.scope = this.settings.scope || this;\r\n                this.toggleEvent = this.settings.toggleEvent || returnFalse$1;\r\n            }\r\n            EventDispatcher.isNative = function (name) {\r\n                return !!nativeEvents[name.toLowerCase()];\r\n            };\r\n            EventDispatcher.prototype.fire = function (name, args) {\r\n                var handlers, i, l, callback;\r\n                name = name.toLowerCase();\r\n                args = args || {};\r\n                args.type = name;\r\n                if (!args.target) {\r\n                    args.target = this.scope;\r\n                }\r\n                if (!args.preventDefault) {\r\n                    args.preventDefault = function () {\r\n                        args.isDefaultPrevented = returnTrue$1;\r\n                    };\r\n                    args.stopPropagation = function () {\r\n                        args.isPropagationStopped = returnTrue$1;\r\n                    };\r\n                    args.stopImmediatePropagation = function () {\r\n                        args.isImmediatePropagationStopped = returnTrue$1;\r\n                    };\r\n                    args.isDefaultPrevented = returnFalse$1;\r\n                    args.isPropagationStopped = returnFalse$1;\r\n                    args.isImmediatePropagationStopped = returnFalse$1;\r\n                }\r\n                if (this.settings.beforeFire) {\r\n                    this.settings.beforeFire(args);\r\n                }\r\n                handlers = this.bindings[name];\r\n                if (handlers) {\r\n                    for (i = 0, l = handlers.length; i < l; i++) {\r\n                        callback = handlers[i];\r\n                        if (callback.once) {\r\n                            this.off(name, callback.func);\r\n                        }\r\n                        if (args.isImmediatePropagationStopped()) {\r\n                            args.stopPropagation();\r\n                            return args;\r\n                        }\r\n                        if (callback.func.call(this.scope, args) === false) {\r\n                            args.preventDefault();\r\n                            return args;\r\n                        }\r\n                    }\r\n                }\r\n                return args;\r\n            };\r\n            EventDispatcher.prototype.on = function (name, callback, prepend, extra) {\r\n                var handlers, names, i;\r\n                if (callback === false) {\r\n                    callback = returnFalse$1;\r\n                }\r\n                if (callback) {\r\n                    var wrappedCallback = { func: callback };\r\n                    if (extra) {\r\n                        Tools.extend(wrappedCallback, extra);\r\n                    }\r\n                    names = name.toLowerCase().split(' ');\r\n                    i = names.length;\r\n                    while (i--) {\r\n                        name = names[i];\r\n                        handlers = this.bindings[name];\r\n                        if (!handlers) {\r\n                            handlers = this.bindings[name] = [];\r\n                            this.toggleEvent(name, true);\r\n                        }\r\n                        if (prepend) {\r\n                            handlers.unshift(wrappedCallback);\r\n                        }\r\n                        else {\r\n                            handlers.push(wrappedCallback);\r\n                        }\r\n                    }\r\n                }\r\n                return this;\r\n            };\r\n            EventDispatcher.prototype.off = function (name, callback) {\r\n                var i, handlers, bindingName, names, hi;\r\n                if (name) {\r\n                    names = name.toLowerCase().split(' ');\r\n                    i = names.length;\r\n                    while (i--) {\r\n                        name = names[i];\r\n                        handlers = this.bindings[name];\r\n                        if (!name) {\r\n                            for (bindingName in this.bindings) {\r\n                                this.toggleEvent(bindingName, false);\r\n                                delete this.bindings[bindingName];\r\n                            }\r\n                            return this;\r\n                        }\r\n                        if (handlers) {\r\n                            if (!callback) {\r\n                                handlers.length = 0;\r\n                            }\r\n                            else {\r\n                                hi = handlers.length;\r\n                                while (hi--) {\r\n                                    if (handlers[hi].func === callback) {\r\n                                        handlers = handlers.slice(0, hi).concat(handlers.slice(hi + 1));\r\n                                        this.bindings[name] = handlers;\r\n                                    }\r\n                                }\r\n                            }\r\n                            if (!handlers.length) {\r\n                                this.toggleEvent(name, false);\r\n                                delete this.bindings[name];\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n                else {\r\n                    for (name in this.bindings) {\r\n                        this.toggleEvent(name, false);\r\n                    }\r\n                    this.bindings = {};\r\n                }\r\n                return this;\r\n            };\r\n            EventDispatcher.prototype.once = function (name, callback, prepend) {\r\n                return this.on(name, callback, prepend, { once: true });\r\n            };\r\n            EventDispatcher.prototype.has = function (name) {\r\n                name = name.toLowerCase();\r\n                return !(!this.bindings[name] || this.bindings[name].length === 0);\r\n            };\r\n            return EventDispatcher;\r\n        }();\r\n        var getEventDispatcher = function (obj) {\r\n            if (!obj._eventDispatcher) {\r\n                obj._eventDispatcher = new EventDispatcher({\r\n                    scope: obj,\r\n                    toggleEvent: function (name, state) {\r\n                        if (EventDispatcher.isNative(name) && obj.toggleNativeEvent) {\r\n                            obj.toggleNativeEvent(name, state);\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            return obj._eventDispatcher;\r\n        };\r\n        var Observable = {\r\n            fire: function (name, args, bubble) {\r\n                var self = this;\r\n                if (self.removed && name !== 'remove' && name !== 'detach') {\r\n                    return args;\r\n                }\r\n                var dispatcherArgs = getEventDispatcher(self).fire(name, args);\r\n                if (bubble !== false && self.parent) {\r\n                    var parent = self.parent();\r\n                    while (parent && !dispatcherArgs.isPropagationStopped()) {\r\n                        parent.fire(name, dispatcherArgs, false);\r\n                        parent = parent.parent();\r\n                    }\r\n                }\r\n                return dispatcherArgs;\r\n            },\r\n            on: function (name, callback, prepend) {\r\n                return getEventDispatcher(this).on(name, callback, prepend);\r\n            },\r\n            off: function (name, callback) {\r\n                return getEventDispatcher(this).off(name, callback);\r\n            },\r\n            once: function (name, callback) {\r\n                return getEventDispatcher(this).once(name, callback);\r\n            },\r\n            hasEventListeners: function (name) {\r\n                return getEventDispatcher(this).has(name);\r\n            }\r\n        };\r\n        var DOM$6 = DOMUtils$1.DOM;\r\n        var customEventRootDelegates;\r\n        var getEventTarget = function (editor, eventName) {\r\n            if (eventName === 'selectionchange') {\r\n                return editor.getDoc();\r\n            }\r\n            if (!editor.inline && /^mouse|touch|click|contextmenu|drop|dragover|dragend/.test(eventName)) {\r\n                return editor.getDoc().documentElement;\r\n            }\r\n            if (editor.settings.event_root) {\r\n                if (!editor.eventRoot) {\r\n                    editor.eventRoot = DOM$6.select(editor.settings.event_root)[0];\r\n                }\r\n                return editor.eventRoot;\r\n            }\r\n            return editor.getBody();\r\n        };\r\n        var isListening = function (editor) {\r\n            return !editor.hidden && !isReadOnly(editor);\r\n        };\r\n        var fireEvent = function (editor, eventName, e) {\r\n            if (isListening(editor)) {\r\n                editor.fire(eventName, e);\r\n            }\r\n            else if (isReadOnly(editor)) {\r\n                preventReadOnlyEvents(e);\r\n            }\r\n        };\r\n        var bindEventDelegate = function (editor, eventName) {\r\n            var eventRootElm, delegate;\r\n            if (!editor.delegates) {\r\n                editor.delegates = {};\r\n            }\r\n            if (editor.delegates[eventName] || editor.removed) {\r\n                return;\r\n            }\r\n            eventRootElm = getEventTarget(editor, eventName);\r\n            if (editor.settings.event_root) {\r\n                if (!customEventRootDelegates) {\r\n                    customEventRootDelegates = {};\r\n                    editor.editorManager.on('removeEditor', function () {\r\n                        var name;\r\n                        if (!editor.editorManager.activeEditor) {\r\n                            if (customEventRootDelegates) {\r\n                                for (name in customEventRootDelegates) {\r\n                                    editor.dom.unbind(getEventTarget(editor, name));\r\n                                }\r\n                                customEventRootDelegates = null;\r\n                            }\r\n                        }\r\n                    });\r\n                }\r\n                if (customEventRootDelegates[eventName]) {\r\n                    return;\r\n                }\r\n                delegate = function (e) {\r\n                    var target = e.target;\r\n                    var editors = editor.editorManager.get();\r\n                    var i = editors.length;\r\n                    while (i--) {\r\n                        var body = editors[i].getBody();\r\n                        if (body === target || DOM$6.isChildOf(target, body)) {\r\n                            fireEvent(editors[i], eventName, e);\r\n                        }\r\n                    }\r\n                };\r\n                customEventRootDelegates[eventName] = delegate;\r\n                DOM$6.bind(eventRootElm, eventName, delegate);\r\n            }\r\n            else {\r\n                delegate = function (e) {\r\n                    fireEvent(editor, eventName, e);\r\n                };\r\n                DOM$6.bind(eventRootElm, eventName, delegate);\r\n                editor.delegates[eventName] = delegate;\r\n            }\r\n        };\r\n        var EditorObservable = __assign({}, Observable, {\r\n            bindPendingEventDelegates: function () {\r\n                var self = this;\r\n                Tools.each(self._pendingNativeEvents, function (name) {\r\n                    bindEventDelegate(self, name);\r\n                });\r\n            },\r\n            toggleNativeEvent: function (name, state) {\r\n                var self = this;\r\n                if (name === 'focus' || name === 'blur') {\r\n                    return;\r\n                }\r\n                if (state) {\r\n                    if (self.initialized) {\r\n                        bindEventDelegate(self, name);\r\n                    }\r\n                    else {\r\n                        if (!self._pendingNativeEvents) {\r\n                            self._pendingNativeEvents = [name];\r\n                        }\r\n                        else {\r\n                            self._pendingNativeEvents.push(name);\r\n                        }\r\n                    }\r\n                }\r\n                else if (self.initialized) {\r\n                    self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\r\n                    delete self.delegates[name];\r\n                }\r\n            },\r\n            unbindAllNativeEvents: function () {\r\n                var self = this;\r\n                var body = self.getBody();\r\n                var dom = self.dom;\r\n                var name;\r\n                if (self.delegates) {\r\n                    for (name in self.delegates) {\r\n                        self.dom.unbind(getEventTarget(self, name), name, self.delegates[name]);\r\n                    }\r\n                    delete self.delegates;\r\n                }\r\n                if (!self.inline && body && dom) {\r\n                    body.onload = null;\r\n                    dom.unbind(self.getWin());\r\n                    dom.unbind(self.getDoc());\r\n                }\r\n                if (dom) {\r\n                    dom.unbind(body);\r\n                    dom.unbind(self.getContainer());\r\n                }\r\n            }\r\n        });\r\n        var each$h = Tools.each, explode$3 = Tools.explode;\r\n        var keyCodeLookup = {\r\n            f1: 112,\r\n            f2: 113,\r\n            f3: 114,\r\n            f4: 115,\r\n            f5: 116,\r\n            f6: 117,\r\n            f7: 118,\r\n            f8: 119,\r\n            f9: 120,\r\n            f10: 121,\r\n            f11: 122,\r\n            f12: 123\r\n        };\r\n        var modifierNames = Tools.makeMap('alt,ctrl,shift,meta,access');\r\n        var Shortcuts = function () {\r\n            function Shortcuts(editor) {\r\n                this.shortcuts = {};\r\n                this.pendingPatterns = [];\r\n                this.editor = editor;\r\n                var self = this;\r\n                editor.on('keyup keypress keydown', function (e) {\r\n                    if ((self.hasModifier(e) || self.isFunctionKey(e)) && !e.isDefaultPrevented()) {\r\n                        each$h(self.shortcuts, function (shortcut) {\r\n                            if (self.matchShortcut(e, shortcut)) {\r\n                                self.pendingPatterns = shortcut.subpatterns.slice(0);\r\n                                if (e.type === 'keydown') {\r\n                                    self.executeShortcutAction(shortcut);\r\n                                }\r\n                                return true;\r\n                            }\r\n                        });\r\n                        if (self.matchShortcut(e, self.pendingPatterns[0])) {\r\n                            if (self.pendingPatterns.length === 1) {\r\n                                if (e.type === 'keydown') {\r\n                                    self.executeShortcutAction(self.pendingPatterns[0]);\r\n                                }\r\n                            }\r\n                            self.pendingPatterns.shift();\r\n                        }\r\n                    }\r\n                });\r\n            }\r\n            Shortcuts.prototype.add = function (pattern, desc, cmdFunc, scope) {\r\n                var self = this;\r\n                var cmd;\r\n                cmd = cmdFunc;\r\n                if (typeof cmdFunc === 'string') {\r\n                    cmdFunc = function () {\r\n                        self.editor.execCommand(cmd, false, null);\r\n                    };\r\n                }\r\n                else if (Tools.isArray(cmd)) {\r\n                    cmdFunc = function () {\r\n                        self.editor.execCommand(cmd[0], cmd[1], cmd[2]);\r\n                    };\r\n                }\r\n                each$h(explode$3(Tools.trim(pattern.toLowerCase())), function (pattern) {\r\n                    var shortcut = self.createShortcut(pattern, desc, cmdFunc, scope);\r\n                    self.shortcuts[shortcut.id] = shortcut;\r\n                });\r\n                return true;\r\n            };\r\n            Shortcuts.prototype.remove = function (pattern) {\r\n                var shortcut = this.createShortcut(pattern);\r\n                if (this.shortcuts[shortcut.id]) {\r\n                    delete this.shortcuts[shortcut.id];\r\n                    return true;\r\n                }\r\n                return false;\r\n            };\r\n            Shortcuts.prototype.parseShortcut = function (pattern) {\r\n                var id, key;\r\n                var shortcut = {};\r\n                each$h(explode$3(pattern, '+'), function (value) {\r\n                    if (value in modifierNames) {\r\n                        shortcut[value] = true;\r\n                    }\r\n                    else {\r\n                        if (/^[0-9]{2,}$/.test(value)) {\r\n                            shortcut.keyCode = parseInt(value, 10);\r\n                        }\r\n                        else {\r\n                            shortcut.charCode = value.charCodeAt(0);\r\n                            shortcut.keyCode = keyCodeLookup[value] || value.toUpperCase().charCodeAt(0);\r\n                        }\r\n                    }\r\n                });\r\n                id = [shortcut.keyCode];\r\n                for (key in modifierNames) {\r\n                    if (shortcut[key]) {\r\n                        id.push(key);\r\n                    }\r\n                    else {\r\n                        shortcut[key] = false;\r\n                    }\r\n                }\r\n                shortcut.id = id.join(',');\r\n                if (shortcut.access) {\r\n                    shortcut.alt = true;\r\n                    if (Env.mac) {\r\n                        shortcut.ctrl = true;\r\n                    }\r\n                    else {\r\n                        shortcut.shift = true;\r\n                    }\r\n                }\r\n                if (shortcut.meta) {\r\n                    if (Env.mac) {\r\n                        shortcut.meta = true;\r\n                    }\r\n                    else {\r\n                        shortcut.ctrl = true;\r\n                        shortcut.meta = false;\r\n                    }\r\n                }\r\n                return shortcut;\r\n            };\r\n            Shortcuts.prototype.createShortcut = function (pattern, desc, cmdFunc, scope) {\r\n                var shortcuts;\r\n                shortcuts = Tools.map(explode$3(pattern, '>'), this.parseShortcut);\r\n                shortcuts[shortcuts.length - 1] = Tools.extend(shortcuts[shortcuts.length - 1], {\r\n                    func: cmdFunc,\r\n                    scope: scope || this.editor\r\n                });\r\n                return Tools.extend(shortcuts[0], {\r\n                    desc: this.editor.translate(desc),\r\n                    subpatterns: shortcuts.slice(1)\r\n                });\r\n            };\r\n            Shortcuts.prototype.hasModifier = function (e) {\r\n                return e.altKey || e.ctrlKey || e.metaKey;\r\n            };\r\n            Shortcuts.prototype.isFunctionKey = function (e) {\r\n                return e.type === 'keydown' && e.keyCode >= 112 && e.keyCode <= 123;\r\n            };\r\n            Shortcuts.prototype.matchShortcut = function (e, shortcut) {\r\n                if (!shortcut) {\r\n                    return false;\r\n                }\r\n                if (shortcut.ctrl !== e.ctrlKey || shortcut.meta !== e.metaKey) {\r\n                    return false;\r\n                }\r\n                if (shortcut.alt !== e.altKey || shortcut.shift !== e.shiftKey) {\r\n                    return false;\r\n                }\r\n                if (e.keyCode === shortcut.keyCode || e.charCode && e.charCode === shortcut.charCode) {\r\n                    e.preventDefault();\r\n                    return true;\r\n                }\r\n                return false;\r\n            };\r\n            Shortcuts.prototype.executeShortcutAction = function (shortcut) {\r\n                return shortcut.func ? shortcut.func.call(shortcut.scope) : null;\r\n            };\r\n            return Shortcuts;\r\n        }();\r\n        var each$i = Tools.each, trim$4 = Tools.trim;\r\n        var queryParts = 'source protocol authority userInfo user password host port relative path directory file query anchor'.split(' ');\r\n        var DEFAULT_PORTS = {\r\n            ftp: 21,\r\n            http: 80,\r\n            https: 443,\r\n            mailto: 25\r\n        };\r\n        var URI = function () {\r\n            function URI(url, settings) {\r\n                url = trim$4(url);\r\n                this.settings = settings || {};\r\n                var baseUri = this.settings.base_uri;\r\n                var self = this;\r\n                if (/^([\\w\\-]+):([^\\/]{2})/i.test(url) || /^\\s*#/.test(url)) {\r\n                    self.source = url;\r\n                    return;\r\n                }\r\n                var isProtocolRelative = url.indexOf('//') === 0;\r\n                if (url.indexOf('/') === 0 && !isProtocolRelative) {\r\n                    url = (baseUri ? baseUri.protocol || 'http' : 'http') + '://mce_host' + url;\r\n                }\r\n                if (!/^[\\w\\-]*:?\\/\\//.test(url)) {\r\n                    var baseUrl = this.settings.base_uri ? this.settings.base_uri.path : new URI(domGlobals.document.location.href).directory;\r\n                    if (this.settings.base_uri.protocol == '') {\r\n                        url = '//mce_host' + self.toAbsPath(baseUrl, url);\r\n                    }\r\n                    else {\r\n                        var match = /([^#?]*)([#?]?.*)/.exec(url);\r\n                        url = (baseUri && baseUri.protocol || 'http') + '://mce_host' + self.toAbsPath(baseUrl, match[1]) + match[2];\r\n                    }\r\n                }\r\n                url = url.replace(/@@/g, '(mce_at)');\r\n                var urlMatch = /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@\\/]*):?([^:@\\/]*))?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(url);\r\n                each$i(queryParts, function (v, i) {\r\n                    var part = urlMatch[i];\r\n                    if (part) {\r\n                        part = part.replace(/\\(mce_at\\)/g, '@@');\r\n                    }\r\n                    self[v] = part;\r\n                });\r\n                if (baseUri) {\r\n                    if (!self.protocol) {\r\n                        self.protocol = baseUri.protocol;\r\n                    }\r\n                    if (!self.userInfo) {\r\n                        self.userInfo = baseUri.userInfo;\r\n                    }\r\n                    if (!self.port && self.host === 'mce_host') {\r\n                        self.port = baseUri.port;\r\n                    }\r\n                    if (!self.host || self.host === 'mce_host') {\r\n                        self.host = baseUri.host;\r\n                    }\r\n                    self.source = '';\r\n                }\r\n                if (isProtocolRelative) {\r\n                    self.protocol = '';\r\n                }\r\n            }\r\n            URI.parseDataUri = function (uri) {\r\n                var type;\r\n                var uriComponents = decodeURIComponent(uri).split(',');\r\n                var matches = /data:([^;]+)/.exec(uriComponents[0]);\r\n                if (matches) {\r\n                    type = matches[1];\r\n                }\r\n                return {\r\n                    type: type,\r\n                    data: uriComponents[1]\r\n                };\r\n            };\r\n            URI.getDocumentBaseUrl = function (loc) {\r\n                var baseUrl;\r\n                if (loc.protocol.indexOf('http') !== 0 && loc.protocol !== 'file:') {\r\n                    baseUrl = loc.href;\r\n                }\r\n                else {\r\n                    baseUrl = loc.protocol + '//' + loc.host + loc.pathname;\r\n                }\r\n                if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(baseUrl)) {\r\n                    baseUrl = baseUrl.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\r\n                    if (!/[\\/\\\\]$/.test(baseUrl)) {\r\n                        baseUrl += '/';\r\n                    }\r\n                }\r\n                return baseUrl;\r\n            };\r\n            URI.prototype.setPath = function (path) {\r\n                var pathMatch = /^(.*?)\\/?(\\w+)?$/.exec(path);\r\n                this.path = pathMatch[0];\r\n                this.directory = pathMatch[1];\r\n                this.file = pathMatch[2];\r\n                this.source = '';\r\n                this.getURI();\r\n            };\r\n            URI.prototype.toRelative = function (uri) {\r\n                var output;\r\n                if (uri === './') {\r\n                    return uri;\r\n                }\r\n                var relativeUri = new URI(uri, { base_uri: this });\r\n                if (relativeUri.host !== 'mce_host' && this.host !== relativeUri.host && relativeUri.host || this.port !== relativeUri.port || this.protocol !== relativeUri.protocol && relativeUri.protocol !== '') {\r\n                    return relativeUri.getURI();\r\n                }\r\n                var tu = this.getURI(), uu = relativeUri.getURI();\r\n                if (tu === uu || tu.charAt(tu.length - 1) === '/' && tu.substr(0, tu.length - 1) === uu) {\r\n                    return tu;\r\n                }\r\n                output = this.toRelPath(this.path, relativeUri.path);\r\n                if (relativeUri.query) {\r\n                    output += '?' + relativeUri.query;\r\n                }\r\n                if (relativeUri.anchor) {\r\n                    output += '#' + relativeUri.anchor;\r\n                }\r\n                return output;\r\n            };\r\n            URI.prototype.toAbsolute = function (uri, noHost) {\r\n                var absoluteUri = new URI(uri, { base_uri: this });\r\n                return absoluteUri.getURI(noHost && this.isSameOrigin(absoluteUri));\r\n            };\r\n            URI.prototype.isSameOrigin = function (uri) {\r\n                if (this.host == uri.host && this.protocol == uri.protocol) {\r\n                    if (this.port == uri.port) {\r\n                        return true;\r\n                    }\r\n                    var defaultPort = DEFAULT_PORTS[this.protocol];\r\n                    if (defaultPort && (this.port || defaultPort) == (uri.port || defaultPort)) {\r\n                        return true;\r\n                    }\r\n                }\r\n                return false;\r\n            };\r\n            URI.prototype.toRelPath = function (base, path) {\r\n                var items, breakPoint = 0, out = '', i, l;\r\n                var normalizedBase = base.substring(0, base.lastIndexOf('/')).split('/');\r\n                items = path.split('/');\r\n                if (normalizedBase.length >= items.length) {\r\n                    for (i = 0, l = normalizedBase.length; i < l; i++) {\r\n                        if (i >= items.length || normalizedBase[i] !== items[i]) {\r\n                            breakPoint = i + 1;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (normalizedBase.length < items.length) {\r\n                    for (i = 0, l = items.length; i < l; i++) {\r\n                        if (i >= normalizedBase.length || normalizedBase[i] !== items[i]) {\r\n                            breakPoint = i + 1;\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n                if (breakPoint === 1) {\r\n                    return path;\r\n                }\r\n                for (i = 0, l = normalizedBase.length - (breakPoint - 1); i < l; i++) {\r\n                    out += '../';\r\n                }\r\n                for (i = breakPoint - 1, l = items.length; i < l; i++) {\r\n                    if (i !== breakPoint - 1) {\r\n                        out += '/' + items[i];\r\n                    }\r\n                    else {\r\n                        out += items[i];\r\n                    }\r\n                }\r\n                return out;\r\n            };\r\n            URI.prototype.toAbsPath = function (base, path) {\r\n                var i, nb = 0, o = [], tr, outPath;\r\n                tr = /\\/$/.test(path) ? '/' : '';\r\n                var normalizedBase = base.split('/');\r\n                var normalizedPath = path.split('/');\r\n                each$i(normalizedBase, function (k) {\r\n                    if (k) {\r\n                        o.push(k);\r\n                    }\r\n                });\r\n                normalizedBase = o;\r\n                for (i = normalizedPath.length - 1, o = []; i >= 0; i--) {\r\n                    if (normalizedPath[i].length === 0 || normalizedPath[i] === '.') {\r\n                        continue;\r\n                    }\r\n                    if (normalizedPath[i] === '..') {\r\n                        nb++;\r\n                        continue;\r\n                    }\r\n                    if (nb > 0) {\r\n                        nb--;\r\n                        continue;\r\n                    }\r\n                    o.push(normalizedPath[i]);\r\n                }\r\n                i = normalizedBase.length - nb;\r\n                if (i <= 0) {\r\n                    outPath = o.reverse().join('/');\r\n                }\r\n                else {\r\n                    outPath = normalizedBase.slice(0, i).join('/') + '/' + o.reverse().join('/');\r\n                }\r\n                if (outPath.indexOf('/') !== 0) {\r\n                    outPath = '/' + outPath;\r\n                }\r\n                if (tr && outPath.lastIndexOf('/') !== outPath.length - 1) {\r\n                    outPath += tr;\r\n                }\r\n                return outPath;\r\n            };\r\n            URI.prototype.getURI = function (noProtoHost) {\r\n                if (noProtoHost === void 0) {\r\n                    noProtoHost = false;\r\n                }\r\n                var s;\r\n                if (!this.source || noProtoHost) {\r\n                    s = '';\r\n                    if (!noProtoHost) {\r\n                        if (this.protocol) {\r\n                            s += this.protocol + '://';\r\n                        }\r\n                        else {\r\n                            s += '//';\r\n                        }\r\n                        if (this.userInfo) {\r\n                            s += this.userInfo + '@';\r\n                        }\r\n                        if (this.host) {\r\n                            s += this.host;\r\n                        }\r\n                        if (this.port) {\r\n                            s += ':' + this.port;\r\n                        }\r\n                    }\r\n                    if (this.path) {\r\n                        s += this.path;\r\n                    }\r\n                    if (this.query) {\r\n                        s += '?' + this.query;\r\n                    }\r\n                    if (this.anchor) {\r\n                        s += '#' + this.anchor;\r\n                    }\r\n                    this.source = s;\r\n                }\r\n                return this.source;\r\n            };\r\n            return URI;\r\n        }();\r\n        var create$4 = function () {\r\n            var buttons = {};\r\n            var menuItems = {};\r\n            var popups = {};\r\n            var icons = {};\r\n            var contextMenus = {};\r\n            var contextToolbars = {};\r\n            var sidebars = {};\r\n            var add = function (collection, type) {\r\n                return function (name, spec) {\r\n                    return collection[name.toLowerCase()] = merge({ type: type }, spec);\r\n                };\r\n            };\r\n            var addIcon = function (name, svgData) {\r\n                return icons[name.toLowerCase()] = svgData;\r\n            };\r\n            return {\r\n                addButton: add(buttons, 'button'),\r\n                addToggleButton: add(buttons, 'togglebutton'),\r\n                addMenuButton: add(buttons, 'menubutton'),\r\n                addSplitButton: add(buttons, 'splitbutton'),\r\n                addMenuItem: add(menuItems, 'menuitem'),\r\n                addNestedMenuItem: add(menuItems, 'nestedmenuitem'),\r\n                addToggleMenuItem: add(menuItems, 'togglemenuitem'),\r\n                addAutocompleter: add(popups, 'autocompleter'),\r\n                addContextMenu: add(contextMenus, 'contextmenu'),\r\n                addContextToolbar: add(contextToolbars, 'contexttoolbar'),\r\n                addContextForm: add(contextToolbars, 'contextform'),\r\n                addSidebar: add(sidebars, 'sidebar'),\r\n                addIcon: addIcon,\r\n                getAll: function () {\r\n                    return {\r\n                        buttons: buttons,\r\n                        menuItems: menuItems,\r\n                        icons: icons,\r\n                        popups: popups,\r\n                        contextMenus: contextMenus,\r\n                        contextToolbars: contextToolbars,\r\n                        sidebars: sidebars\r\n                    };\r\n                }\r\n            };\r\n        };\r\n        var registry = function () {\r\n            var bridge = create$4();\r\n            return {\r\n                addAutocompleter: bridge.addAutocompleter,\r\n                addButton: bridge.addButton,\r\n                addContextForm: bridge.addContextForm,\r\n                addContextMenu: bridge.addContextMenu,\r\n                addContextToolbar: bridge.addContextToolbar,\r\n                addIcon: bridge.addIcon,\r\n                addMenuButton: bridge.addMenuButton,\r\n                addMenuItem: bridge.addMenuItem,\r\n                addNestedMenuItem: bridge.addNestedMenuItem,\r\n                addSidebar: bridge.addSidebar,\r\n                addSplitButton: bridge.addSplitButton,\r\n                addToggleButton: bridge.addToggleButton,\r\n                addToggleMenuItem: bridge.addToggleMenuItem,\r\n                getAll: bridge.getAll\r\n            };\r\n        };\r\n        var DOM$7 = DOMUtils$1.DOM;\r\n        var extend$3 = Tools.extend, each$j = Tools.each;\r\n        var resolve$4 = Tools.resolve;\r\n        var ie$2 = Env.ie;\r\n        var Editor = function () {\r\n            function Editor(id, settings, editorManager) {\r\n                var _this = this;\r\n                this.plugins = {};\r\n                this.contentCSS = [];\r\n                this.contentStyles = [];\r\n                this.loadedCSS = {};\r\n                this.isNotDirty = false;\r\n                this.editorManager = editorManager;\r\n                this.documentBaseUrl = editorManager.documentBaseURL;\r\n                this.baseUri = editorManager.baseURI;\r\n                extend$3(this, EditorObservable);\r\n                this.settings = getEditorSettings(this, id, this.documentBaseUrl, editorManager.defaultSettings, settings);\r\n                AddOnManager$1.languageLoad = this.settings.language_load;\r\n                AddOnManager$1.baseURL = editorManager.baseURL;\r\n                this.id = id;\r\n                this.setDirty(false);\r\n                this.documentBaseURI = new URI(this.settings.document_base_url, { base_uri: this.baseUri });\r\n                this.baseURI = this.baseUri;\r\n                this.inline = this.settings.inline;\r\n                this.suffix = editorManager.suffix;\r\n                this.shortcuts = new Shortcuts(this);\r\n                this.editorCommands = new EditorCommands(this);\r\n                if (this.settings.cache_suffix) {\r\n                    Env.cacheSuffix = this.settings.cache_suffix.replace(/^[\\?\\&]+/, '');\r\n                }\r\n                this.ui = { registry: registry() };\r\n                var self = this;\r\n                var modeInstance = create$3(self);\r\n                this.mode = modeInstance;\r\n                this.setMode = modeInstance.set;\r\n                editorManager.fire('SetupEditor', { editor: this });\r\n                this.execCallback('setup', this);\r\n                this.$ = DomQuery.overrideDefaults(function () {\r\n                    return {\r\n                        context: _this.inline ? _this.getBody() : _this.getDoc(),\r\n                        element: _this.getBody()\r\n                    };\r\n                });\r\n            }\r\n            Editor.prototype.render = function () {\r\n                Render.render(this);\r\n            };\r\n            Editor.prototype.focus = function (skipFocus) {\r\n                EditorFocus.focus(this, skipFocus);\r\n            };\r\n            Editor.prototype.hasFocus = function () {\r\n                return EditorFocus.hasFocus(this);\r\n            };\r\n            Editor.prototype.execCallback = function (name) {\r\n                var x = [];\r\n                for (var _i = 1; _i < arguments.length; _i++) {\r\n                    x[_i - 1] = arguments[_i];\r\n                }\r\n                var self = this;\r\n                var callback = self.settings[name], scope;\r\n                if (!callback) {\r\n                    return;\r\n                }\r\n                if (self.callbackLookup && (scope = self.callbackLookup[name])) {\r\n                    callback = scope.func;\r\n                    scope = scope.scope;\r\n                }\r\n                if (typeof callback === 'string') {\r\n                    scope = callback.replace(/\\.\\w+$/, '');\r\n                    scope = scope ? resolve$4(scope) : 0;\r\n                    callback = resolve$4(callback);\r\n                    self.callbackLookup = self.callbackLookup || {};\r\n                    self.callbackLookup[name] = {\r\n                        func: callback,\r\n                        scope: scope\r\n                    };\r\n                }\r\n                return callback.apply(scope || self, Array.prototype.slice.call(arguments, 1));\r\n            };\r\n            Editor.prototype.translate = function (text) {\r\n                return I18n.translate(text);\r\n            };\r\n            Editor.prototype.getParam = function (name, defaultVal, type) {\r\n                return getParam(this, name, defaultVal, type);\r\n            };\r\n            Editor.prototype.nodeChanged = function (args) {\r\n                this._nodeChangeDispatcher.nodeChanged(args);\r\n            };\r\n            Editor.prototype.addCommand = function (name, callback, scope) {\r\n                this.editorCommands.addCommand(name, callback, scope);\r\n            };\r\n            Editor.prototype.addQueryStateHandler = function (name, callback, scope) {\r\n                this.editorCommands.addQueryStateHandler(name, callback, scope);\r\n            };\r\n            Editor.prototype.addQueryValueHandler = function (name, callback, scope) {\r\n                this.editorCommands.addQueryValueHandler(name, callback, scope);\r\n            };\r\n            Editor.prototype.addShortcut = function (pattern, desc, cmdFunc, scope) {\r\n                this.shortcuts.add(pattern, desc, cmdFunc, scope);\r\n            };\r\n            Editor.prototype.execCommand = function (cmd, ui, value, args) {\r\n                return this.editorCommands.execCommand(cmd, ui, value, args);\r\n            };\r\n            Editor.prototype.queryCommandState = function (cmd) {\r\n                return this.editorCommands.queryCommandState(cmd);\r\n            };\r\n            Editor.prototype.queryCommandValue = function (cmd) {\r\n                return this.editorCommands.queryCommandValue(cmd);\r\n            };\r\n            Editor.prototype.queryCommandSupported = function (cmd) {\r\n                return this.editorCommands.queryCommandSupported(cmd);\r\n            };\r\n            Editor.prototype.show = function () {\r\n                var self = this;\r\n                if (self.hidden) {\r\n                    self.hidden = false;\r\n                    if (self.inline) {\r\n                        self.getBody().contentEditable = 'true';\r\n                    }\r\n                    else {\r\n                        DOM$7.show(self.getContainer());\r\n                        DOM$7.hide(self.id);\r\n                    }\r\n                    self.load();\r\n                    self.fire('show');\r\n                }\r\n            };\r\n            Editor.prototype.hide = function () {\r\n                var self = this, doc = self.getDoc();\r\n                if (!self.hidden) {\r\n                    if (ie$2 && doc && !self.inline) {\r\n                        doc.execCommand('SelectAll');\r\n                    }\r\n                    self.save();\r\n                    if (self.inline) {\r\n                        self.getBody().contentEditable = 'false';\r\n                        if (self === self.editorManager.focusedEditor) {\r\n                            self.editorManager.focusedEditor = null;\r\n                        }\r\n                    }\r\n                    else {\r\n                        DOM$7.hide(self.getContainer());\r\n                        DOM$7.setStyle(self.id, 'display', self.orgDisplay);\r\n                    }\r\n                    self.hidden = true;\r\n                    self.fire('hide');\r\n                }\r\n            };\r\n            Editor.prototype.isHidden = function () {\r\n                return !!this.hidden;\r\n            };\r\n            Editor.prototype.setProgressState = function (state, time) {\r\n                this.fire('ProgressState', {\r\n                    state: state,\r\n                    time: time\r\n                });\r\n            };\r\n            Editor.prototype.load = function (args) {\r\n                var self = this;\r\n                var elm = self.getElement(), html;\r\n                if (self.removed) {\r\n                    return '';\r\n                }\r\n                if (elm) {\r\n                    args = args || {};\r\n                    args.load = true;\r\n                    var value = elm.value;\r\n                    html = self.setContent(value !== undefined ? value : elm.innerHTML, args);\r\n                    args.element = elm;\r\n                    if (!args.no_events) {\r\n                        self.fire('LoadContent', args);\r\n                    }\r\n                    args.element = elm = null;\r\n                    return html;\r\n                }\r\n            };\r\n            Editor.prototype.save = function (args) {\r\n                var self = this;\r\n                var elm = self.getElement(), html, form;\r\n                if (!elm || !self.initialized || self.removed) {\r\n                    return;\r\n                }\r\n                args = args || {};\r\n                args.save = true;\r\n                args.element = elm;\r\n                html = args.content = self.getContent(args);\r\n                if (!args.no_events) {\r\n                    self.fire('SaveContent', args);\r\n                }\r\n                if (args.format === 'raw') {\r\n                    self.fire('RawSaveContent', args);\r\n                }\r\n                html = args.content;\r\n                if (!/TEXTAREA|INPUT/i.test(elm.nodeName)) {\r\n                    if (args.is_removing || !self.inline) {\r\n                        elm.innerHTML = html;\r\n                    }\r\n                    if (form = DOM$7.getParent(self.id, 'form')) {\r\n                        each$j(form.elements, function (elm) {\r\n                            if (elm.name === self.id) {\r\n                                elm.value = html;\r\n                                return false;\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                else {\r\n                    elm.value = html;\r\n                }\r\n                args.element = elm = null;\r\n                if (args.set_dirty !== false) {\r\n                    self.setDirty(false);\r\n                }\r\n                return html;\r\n            };\r\n            Editor.prototype.setContent = function (content, args) {\r\n                return setContent(this, content, args);\r\n            };\r\n            Editor.prototype.getContent = function (args) {\r\n                return getContent(this, args);\r\n            };\r\n            Editor.prototype.insertContent = function (content, args) {\r\n                if (args) {\r\n                    content = extend$3({ content: content }, args);\r\n                }\r\n                this.execCommand('mceInsertContent', false, content);\r\n            };\r\n            Editor.prototype.resetContent = function (initialContent) {\r\n                if (initialContent === undefined) {\r\n                    setContent(this, this.startContent, { format: 'raw' });\r\n                }\r\n                else {\r\n                    setContent(this, initialContent);\r\n                }\r\n                this.undoManager.reset();\r\n                this.setDirty(false);\r\n                this.nodeChanged();\r\n            };\r\n            Editor.prototype.isDirty = function () {\r\n                return !this.isNotDirty;\r\n            };\r\n            Editor.prototype.setDirty = function (state) {\r\n                var oldState = !this.isNotDirty;\r\n                this.isNotDirty = !state;\r\n                if (state && state !== oldState) {\r\n                    this.fire('dirty');\r\n                }\r\n            };\r\n            Editor.prototype.getContainer = function () {\r\n                var self = this;\r\n                if (!self.container) {\r\n                    self.container = DOM$7.get(self.editorContainer || self.id + '_parent');\r\n                }\r\n                return self.container;\r\n            };\r\n            Editor.prototype.getContentAreaContainer = function () {\r\n                return this.contentAreaContainer;\r\n            };\r\n            Editor.prototype.getElement = function () {\r\n                if (!this.targetElm) {\r\n                    this.targetElm = DOM$7.get(this.id);\r\n                }\r\n                return this.targetElm;\r\n            };\r\n            Editor.prototype.getWin = function () {\r\n                var self = this;\r\n                var elm;\r\n                if (!self.contentWindow) {\r\n                    elm = self.iframeElement;\r\n                    if (elm) {\r\n                        self.contentWindow = elm.contentWindow;\r\n                    }\r\n                }\r\n                return self.contentWindow;\r\n            };\r\n            Editor.prototype.getDoc = function () {\r\n                var self = this;\r\n                var win;\r\n                if (!self.contentDocument) {\r\n                    win = self.getWin();\r\n                    if (win) {\r\n                        self.contentDocument = win.document;\r\n                    }\r\n                }\r\n                return self.contentDocument;\r\n            };\r\n            Editor.prototype.getBody = function () {\r\n                var doc = this.getDoc();\r\n                return this.bodyElement || (doc ? doc.body : null);\r\n            };\r\n            Editor.prototype.convertURL = function (url, name, elm) {\r\n                var self = this, settings = self.settings;\r\n                if (settings.urlconverter_callback) {\r\n                    return self.execCallback('urlconverter_callback', url, elm, true, name);\r\n                }\r\n                if (!settings.convert_urls || elm && elm.nodeName === 'LINK' || url.indexOf('file:') === 0 || url.length === 0) {\r\n                    return url;\r\n                }\r\n                if (settings.relative_urls) {\r\n                    return self.documentBaseURI.toRelative(url);\r\n                }\r\n                url = self.documentBaseURI.toAbsolute(url, settings.remove_script_host);\r\n                return url;\r\n            };\r\n            Editor.prototype.addVisual = function (elm) {\r\n                var self = this;\r\n                var settings = self.settings;\r\n                var dom = self.dom;\r\n                var cls;\r\n                elm = elm || self.getBody();\r\n                if (self.hasVisual === undefined) {\r\n                    self.hasVisual = settings.visual;\r\n                }\r\n                each$j(dom.select('table,a', elm), function (elm) {\r\n                    var value;\r\n                    switch (elm.nodeName) {\r\n                        case 'TABLE':\r\n                            cls = settings.visual_table_class || 'mce-item-table';\r\n                            value = dom.getAttrib(elm, 'border');\r\n                            if ((!value || value === '0') && self.hasVisual) {\r\n                                dom.addClass(elm, cls);\r\n                            }\r\n                            else {\r\n                                dom.removeClass(elm, cls);\r\n                            }\r\n                            return;\r\n                        case 'A':\r\n                            if (!dom.getAttrib(elm, 'href')) {\r\n                                value = dom.getAttrib(elm, 'name') || elm.id;\r\n                                cls = settings.visual_anchor_class || 'mce-item-anchor';\r\n                                if (value && self.hasVisual) {\r\n                                    dom.addClass(elm, cls);\r\n                                }\r\n                                else {\r\n                                    dom.removeClass(elm, cls);\r\n                                }\r\n                            }\r\n                            return;\r\n                    }\r\n                });\r\n                self.fire('VisualAid', {\r\n                    element: elm,\r\n                    hasVisual: self.hasVisual\r\n                });\r\n            };\r\n            Editor.prototype.remove = function () {\r\n                remove$6(this);\r\n            };\r\n            Editor.prototype.destroy = function (automatic) {\r\n                destroy(this, automatic);\r\n            };\r\n            Editor.prototype.uploadImages = function (callback) {\r\n                return this.editorUpload.uploadImages(callback);\r\n            };\r\n            Editor.prototype._scanForImages = function () {\r\n                return this.editorUpload.scanForImages();\r\n            };\r\n            Editor.prototype.addButton = function () {\r\n                throw new Error('editor.addButton has been removed in tinymce 5x, use editor.ui.registry.addButton or editor.ui.registry.addToggleButton or editor.ui.registry.addSplitButton instead');\r\n            };\r\n            Editor.prototype.addSidebar = function () {\r\n                throw new Error('editor.addSidebar has been removed in tinymce 5x, use editor.ui.registry.addSidebar instead');\r\n            };\r\n            Editor.prototype.addMenuItem = function () {\r\n                throw new Error('editor.addMenuItem has been removed in tinymce 5x, use editor.ui.registry.addMenuItem instead');\r\n            };\r\n            Editor.prototype.addContextToolbar = function () {\r\n                throw new Error('editor.addContextToolbar has been removed in tinymce 5x, use editor.ui.registry.addContextToolbar instead');\r\n            };\r\n            return Editor;\r\n        }();\r\n        var isEditorUIElement = function (elm) {\r\n            return elm.className.toString().indexOf('tox-') !== -1 || elm.className.toString().indexOf('mce-') !== -1;\r\n        };\r\n        var FocusManager = { isEditorUIElement: isEditorUIElement };\r\n        var isManualNodeChange = function (e) {\r\n            return e.type === 'nodechange' && e.selectionChange;\r\n        };\r\n        var registerPageMouseUp = function (editor, throttledStore) {\r\n            var mouseUpPage = function () {\r\n                throttledStore.throttle();\r\n            };\r\n            DOMUtils$1.DOM.bind(domGlobals.document, 'mouseup', mouseUpPage);\r\n            editor.on('remove', function () {\r\n                DOMUtils$1.DOM.unbind(domGlobals.document, 'mouseup', mouseUpPage);\r\n            });\r\n        };\r\n        var registerFocusOut = function (editor) {\r\n            editor.on('focusout', function () {\r\n                SelectionBookmark.store(editor);\r\n            });\r\n        };\r\n        var registerMouseUp = function (editor, throttledStore) {\r\n            editor.on('mouseup touchend', function (e) {\r\n                throttledStore.throttle();\r\n            });\r\n        };\r\n        var registerEditorEvents = function (editor, throttledStore) {\r\n            var browser = PlatformDetection$1.detect().browser;\r\n            if (browser.isIE()) {\r\n                registerFocusOut(editor);\r\n            }\r\n            else {\r\n                registerMouseUp(editor, throttledStore);\r\n            }\r\n            editor.on('keyup NodeChange', function (e) {\r\n                if (!isManualNodeChange(e)) {\r\n                    SelectionBookmark.store(editor);\r\n                }\r\n            });\r\n        };\r\n        var register$3 = function (editor) {\r\n            var throttledStore = first(function () {\r\n                SelectionBookmark.store(editor);\r\n            }, 0);\r\n            if (editor.inline) {\r\n                registerPageMouseUp(editor, throttledStore);\r\n            }\r\n            editor.on('init', function () {\r\n                registerEditorEvents(editor, throttledStore);\r\n            });\r\n            editor.on('remove', function () {\r\n                throttledStore.cancel();\r\n            });\r\n        };\r\n        var SelectionRestore = { register: register$3 };\r\n        var documentFocusInHandler;\r\n        var DOM$8 = DOMUtils$1.DOM;\r\n        var isEditorUIElement$1 = function (elm) {\r\n            return FocusManager.isEditorUIElement(elm);\r\n        };\r\n        var isUIElement = function (editor, elm) {\r\n            var customSelector = editor ? editor.settings.custom_ui_selector : '';\r\n            var parent = DOM$8.getParent(elm, function (elm) {\r\n                return isEditorUIElement$1(elm) || (customSelector ? editor.dom.is(elm, customSelector) : false);\r\n            });\r\n            return parent !== null;\r\n        };\r\n        var getActiveElement = function () {\r\n            try {\r\n                return domGlobals.document.activeElement;\r\n            }\r\n            catch (ex) {\r\n                return domGlobals.document.body;\r\n            }\r\n        };\r\n        var registerEvents = function (editorManager, e) {\r\n            var editor = e.editor;\r\n            SelectionRestore.register(editor);\r\n            editor.on('focusin', function () {\r\n                var self = this;\r\n                var focusedEditor = editorManager.focusedEditor;\r\n                if (focusedEditor !== self) {\r\n                    if (focusedEditor) {\r\n                        focusedEditor.fire('blur', { focusedEditor: self });\r\n                    }\r\n                    editorManager.setActive(self);\r\n                    editorManager.focusedEditor = self;\r\n                    self.fire('focus', { blurredEditor: focusedEditor });\r\n                    self.focus(true);\r\n                }\r\n            });\r\n            editor.on('focusout', function () {\r\n                var self = this;\r\n                Delay.setEditorTimeout(self, function () {\r\n                    var focusedEditor = editorManager.focusedEditor;\r\n                    if (!isUIElement(self, getActiveElement()) && focusedEditor === self) {\r\n                        self.fire('blur', { focusedEditor: null });\r\n                        editorManager.focusedEditor = null;\r\n                    }\r\n                });\r\n            });\r\n            if (!documentFocusInHandler) {\r\n                documentFocusInHandler = function (e) {\r\n                    var activeEditor = editorManager.activeEditor;\r\n                    var target;\r\n                    target = e.target;\r\n                    if (activeEditor && target.ownerDocument === domGlobals.document) {\r\n                        if (target !== domGlobals.document.body && !isUIElement(activeEditor, target) && editorManager.focusedEditor === activeEditor) {\r\n                            activeEditor.fire('blur', { focusedEditor: null });\r\n                            editorManager.focusedEditor = null;\r\n                        }\r\n                    }\r\n                };\r\n                DOM$8.bind(domGlobals.document, 'focusin', documentFocusInHandler);\r\n            }\r\n        };\r\n        var unregisterDocumentEvents = function (editorManager, e) {\r\n            if (editorManager.focusedEditor === e.editor) {\r\n                editorManager.focusedEditor = null;\r\n            }\r\n            if (!editorManager.activeEditor) {\r\n                DOM$8.unbind(domGlobals.document, 'focusin', documentFocusInHandler);\r\n                documentFocusInHandler = null;\r\n            }\r\n        };\r\n        var setup$h = function (editorManager) {\r\n            editorManager.on('AddEditor', curry(registerEvents, editorManager));\r\n            editorManager.on('RemoveEditor', curry(unregisterDocumentEvents, editorManager));\r\n        };\r\n        var FocusController = {\r\n            setup: setup$h,\r\n            isEditorUIElement: isEditorUIElement$1,\r\n            isUIElement: isUIElement\r\n        };\r\n        var DOM$9 = DOMUtils$1.DOM;\r\n        var explode$4 = Tools.explode, each$k = Tools.each, extend$4 = Tools.extend;\r\n        var instanceCounter = 0, beforeUnloadDelegate, boundGlobalEvents = false;\r\n        var legacyEditors = [];\r\n        var editors = [];\r\n        var isValidLegacyKey = function (id) {\r\n            return id !== 'length';\r\n        };\r\n        var globalEventDelegate = function (e) {\r\n            var type = e.type;\r\n            each$k(EditorManager.get(), function (editor) {\r\n                switch (type) {\r\n                    case 'scroll':\r\n                        editor.fire('ScrollWindow', e);\r\n                        break;\r\n                    case 'resize':\r\n                        editor.fire('ResizeWindow', e);\r\n                        break;\r\n                }\r\n            });\r\n        };\r\n        var toggleGlobalEvents = function (state) {\r\n            if (state !== boundGlobalEvents) {\r\n                if (state) {\r\n                    DomQuery(window).on('resize scroll', globalEventDelegate);\r\n                }\r\n                else {\r\n                    DomQuery(window).off('resize scroll', globalEventDelegate);\r\n                }\r\n                boundGlobalEvents = state;\r\n            }\r\n        };\r\n        var removeEditorFromList = function (targetEditor) {\r\n            var oldEditors = editors;\r\n            delete legacyEditors[targetEditor.id];\r\n            for (var i = 0; i < legacyEditors.length; i++) {\r\n                if (legacyEditors[i] === targetEditor) {\r\n                    legacyEditors.splice(i, 1);\r\n                    break;\r\n                }\r\n            }\r\n            editors = filter(editors, function (editor) {\r\n                return targetEditor !== editor;\r\n            });\r\n            if (EditorManager.activeEditor === targetEditor) {\r\n                EditorManager.activeEditor = editors.length > 0 ? editors[0] : null;\r\n            }\r\n            if (EditorManager.focusedEditor === targetEditor) {\r\n                EditorManager.focusedEditor = null;\r\n            }\r\n            return oldEditors.length !== editors.length;\r\n        };\r\n        var purgeDestroyedEditor = function (editor) {\r\n            if (editor && editor.initialized && !(editor.getContainer() || editor.getBody()).parentNode) {\r\n                removeEditorFromList(editor);\r\n                editor.unbindAllNativeEvents();\r\n                editor.destroy(true);\r\n                editor.removed = true;\r\n                editor = null;\r\n            }\r\n            return editor;\r\n        };\r\n        var EditorManager = __assign({}, Observable, {\r\n            _beforeUnloadHandler: null,\r\n            baseURI: null,\r\n            baseURL: null,\r\n            defaultSettings: {},\r\n            documentBaseURL: null,\r\n            suffix: null,\r\n            $: DomQuery,\r\n            majorVersion: '5',\r\n            minorVersion: '0.6',\r\n            releaseDate: '2019-05-22',\r\n            editors: legacyEditors,\r\n            i18n: I18n,\r\n            activeEditor: null,\r\n            focusedEditor: null,\r\n            settings: {},\r\n            setup: function () {\r\n                var self = this;\r\n                var baseURL, documentBaseURL, suffix = '', preInit, src;\r\n                documentBaseURL = URI.getDocumentBaseUrl(domGlobals.document.location);\r\n                if (/^[^:]+:\\/\\/\\/?[^\\/]+\\//.test(documentBaseURL)) {\r\n                    documentBaseURL = documentBaseURL.replace(/[\\?#].*$/, '').replace(/[\\/\\\\][^\\/]+$/, '');\r\n                    if (!/[\\/\\\\]$/.test(documentBaseURL)) {\r\n                        documentBaseURL += '/';\r\n                    }\r\n                }\r\n                preInit = window.tinymce || window.tinyMCEPreInit;\r\n                if (preInit) {\r\n                    baseURL = preInit.base || preInit.baseURL;\r\n                    suffix = preInit.suffix;\r\n                }\r\n                else {\r\n                    var scripts = domGlobals.document.getElementsByTagName('script');\r\n                    for (var i = 0; i < scripts.length; i++) {\r\n                        src = scripts[i].src;\r\n                        var srcScript = src.substring(src.lastIndexOf('/'));\r\n                        if (/tinymce(\\.full|\\.jquery|)(\\.min|\\.dev|)\\.js/.test(src)) {\r\n                            if (srcScript.indexOf('.min') !== -1) {\r\n                                suffix = '.min';\r\n                            }\r\n                            baseURL = src.substring(0, src.lastIndexOf('/'));\r\n                            break;\r\n                        }\r\n                    }\r\n                    if (!baseURL && domGlobals.document.currentScript) {\r\n                        src = domGlobals.document.currentScript.src;\r\n                        if (src.indexOf('.min') !== -1) {\r\n                            suffix = '.min';\r\n                        }\r\n                        baseURL = src.substring(0, src.lastIndexOf('/'));\r\n                    }\r\n                }\r\n                self.baseURL = new URI(documentBaseURL).toAbsolute(baseURL);\r\n                self.documentBaseURL = documentBaseURL;\r\n                self.baseURI = new URI(self.baseURL);\r\n                self.suffix = suffix;\r\n                FocusController.setup(self);\r\n            },\r\n            overrideDefaults: function (defaultSettings) {\r\n                var baseUrl, suffix;\r\n                baseUrl = defaultSettings.base_url;\r\n                if (baseUrl) {\r\n                    this.baseURL = new URI(this.documentBaseURL).toAbsolute(baseUrl.replace(/\\/+$/, ''));\r\n                    this.baseURI = new URI(this.baseURL);\r\n                }\r\n                suffix = defaultSettings.suffix;\r\n                if (defaultSettings.suffix) {\r\n                    this.suffix = suffix;\r\n                }\r\n                this.defaultSettings = defaultSettings;\r\n                var pluginBaseUrls = defaultSettings.plugin_base_urls;\r\n                for (var name in pluginBaseUrls) {\r\n                    AddOnManager$1.PluginManager.urls[name] = pluginBaseUrls[name];\r\n                }\r\n            },\r\n            init: function (settings) {\r\n                var self = this;\r\n                var result, invalidInlineTargets;\r\n                invalidInlineTargets = Tools.makeMap('area base basefont br col frame hr img input isindex link meta param embed source wbr track ' + 'colgroup option table tbody tfoot thead tr th td script noscript style textarea video audio iframe object menu', ' ');\r\n                var isInvalidInlineTarget = function (settings, elm) {\r\n                    return settings.inline && elm.tagName.toLowerCase() in invalidInlineTargets;\r\n                };\r\n                var createId = function (elm) {\r\n                    var id = elm.id;\r\n                    if (!id) {\r\n                        id = elm.name;\r\n                        if (id && !DOM$9.get(id)) {\r\n                            id = elm.name;\r\n                        }\r\n                        else {\r\n                            id = DOM$9.uniqueId();\r\n                        }\r\n                        elm.setAttribute('id', id);\r\n                    }\r\n                    return id;\r\n                };\r\n                var execCallback = function (name) {\r\n                    var callback = settings[name];\r\n                    if (!callback) {\r\n                        return;\r\n                    }\r\n                    return callback.apply(self, Array.prototype.slice.call(arguments, 2));\r\n                };\r\n                var hasClass = function (elm, className) {\r\n                    return className.constructor === RegExp ? className.test(elm.className) : DOM$9.hasClass(elm, className);\r\n                };\r\n                var findTargets = function (settings) {\r\n                    var l, targets = [];\r\n                    if (Env.ie && Env.ie < 11) {\r\n                        ErrorReporter.initError('TinyMCE does not support the browser you are using. For a list of supported' + ' browsers please see: https://www.tinymce.com/docs/get-started/system-requirements/');\r\n                        return [];\r\n                    }\r\n                    if (settings.types) {\r\n                        each$k(settings.types, function (type) {\r\n                            targets = targets.concat(DOM$9.select(type.selector));\r\n                        });\r\n                        return targets;\r\n                    }\r\n                    else if (settings.selector) {\r\n                        return DOM$9.select(settings.selector);\r\n                    }\r\n                    else if (settings.target) {\r\n                        return [settings.target];\r\n                    }\r\n                    switch (settings.mode) {\r\n                        case 'exact':\r\n                            l = settings.elements || '';\r\n                            if (l.length > 0) {\r\n                                each$k(explode$4(l), function (id) {\r\n                                    var elm;\r\n                                    if (elm = DOM$9.get(id)) {\r\n                                        targets.push(elm);\r\n                                    }\r\n                                    else {\r\n                                        each$k(domGlobals.document.forms, function (f) {\r\n                                            each$k(f.elements, function (e) {\r\n                                                if (e.name === id) {\r\n                                                    id = 'mce_editor_' + instanceCounter++;\r\n                                                    DOM$9.setAttrib(e, 'id', id);\r\n                                                    targets.push(e);\r\n                                                }\r\n                                            });\r\n                                        });\r\n                                    }\r\n                                });\r\n                            }\r\n                            break;\r\n                        case 'textareas':\r\n                        case 'specific_textareas':\r\n                            each$k(DOM$9.select('textarea'), function (elm) {\r\n                                if (settings.editor_deselector && hasClass(elm, settings.editor_deselector)) {\r\n                                    return;\r\n                                }\r\n                                if (!settings.editor_selector || hasClass(elm, settings.editor_selector)) {\r\n                                    targets.push(elm);\r\n                                }\r\n                            });\r\n                            break;\r\n                    }\r\n                    return targets;\r\n                };\r\n                var provideResults = function (editors) {\r\n                    result = editors;\r\n                };\r\n                var initEditors = function () {\r\n                    var initCount = 0;\r\n                    var editors = [];\r\n                    var targets;\r\n                    var createEditor = function (id, settings, targetElm) {\r\n                        var editor = new Editor(id, settings, self);\r\n                        editors.push(editor);\r\n                        editor.on('init', function () {\r\n                            if (++initCount === targets.length) {\r\n                                provideResults(editors);\r\n                            }\r\n                        });\r\n                        editor.targetElm = editor.targetElm || targetElm;\r\n                        editor.render();\r\n                    };\r\n                    DOM$9.unbind(window, 'ready', initEditors);\r\n                    execCallback('onpageload');\r\n                    targets = DomQuery.unique(findTargets(settings));\r\n                    if (settings.types) {\r\n                        each$k(settings.types, function (type) {\r\n                            Tools.each(targets, function (elm) {\r\n                                if (DOM$9.is(elm, type.selector)) {\r\n                                    createEditor(createId(elm), extend$4({}, settings, type), elm);\r\n                                    return false;\r\n                                }\r\n                                return true;\r\n                            });\r\n                        });\r\n                        return;\r\n                    }\r\n                    Tools.each(targets, function (elm) {\r\n                        purgeDestroyedEditor(self.get(elm.id));\r\n                    });\r\n                    targets = Tools.grep(targets, function (elm) {\r\n                        return !self.get(elm.id);\r\n                    });\r\n                    if (targets.length === 0) {\r\n                        provideResults([]);\r\n                    }\r\n                    else {\r\n                        each$k(targets, function (elm) {\r\n                            if (isInvalidInlineTarget(settings, elm)) {\r\n                                ErrorReporter.initError('Could not initialize inline editor on invalid inline target element', elm);\r\n                            }\r\n                            else {\r\n                                createEditor(createId(elm), settings, elm);\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n                self.settings = settings;\r\n                DOM$9.bind(window, 'ready', initEditors);\r\n                return new promiseObj(function (resolve) {\r\n                    if (result) {\r\n                        resolve(result);\r\n                    }\r\n                    else {\r\n                        provideResults = function (editors) {\r\n                            resolve(editors);\r\n                        };\r\n                    }\r\n                });\r\n            },\r\n            get: function (id) {\r\n                if (arguments.length === 0) {\r\n                    return editors.slice(0);\r\n                }\r\n                else if (isString(id)) {\r\n                    return find(editors, function (editor) {\r\n                        return editor.id === id;\r\n                    }).getOr(null);\r\n                }\r\n                else if (isNumber(id)) {\r\n                    return editors[id] ? editors[id] : null;\r\n                }\r\n                else {\r\n                    return null;\r\n                }\r\n            },\r\n            add: function (editor) {\r\n                var self = this;\r\n                var existingEditor;\r\n                existingEditor = legacyEditors[editor.id];\r\n                if (existingEditor === editor) {\r\n                    return editor;\r\n                }\r\n                if (self.get(editor.id) === null) {\r\n                    if (isValidLegacyKey(editor.id)) {\r\n                        legacyEditors[editor.id] = editor;\r\n                    }\r\n                    legacyEditors.push(editor);\r\n                    editors.push(editor);\r\n                }\r\n                toggleGlobalEvents(true);\r\n                self.activeEditor = editor;\r\n                self.fire('AddEditor', { editor: editor });\r\n                if (!beforeUnloadDelegate) {\r\n                    beforeUnloadDelegate = function () {\r\n                        self.fire('BeforeUnload');\r\n                    };\r\n                    DOM$9.bind(window, 'beforeunload', beforeUnloadDelegate);\r\n                }\r\n                return editor;\r\n            },\r\n            createEditor: function (id, settings) {\r\n                return this.add(new Editor(id, settings, this));\r\n            },\r\n            remove: function (selector) {\r\n                var self = this;\r\n                var i, editor;\r\n                if (!selector) {\r\n                    for (i = editors.length - 1; i >= 0; i--) {\r\n                        self.remove(editors[i]);\r\n                    }\r\n                    return;\r\n                }\r\n                if (isString(selector)) {\r\n                    each$k(DOM$9.select(selector), function (elm) {\r\n                        editor = self.get(elm.id);\r\n                        if (editor) {\r\n                            self.remove(editor);\r\n                        }\r\n                    });\r\n                    return;\r\n                }\r\n                editor = selector;\r\n                if (isNull(self.get(editor.id))) {\r\n                    return null;\r\n                }\r\n                if (removeEditorFromList(editor)) {\r\n                    self.fire('RemoveEditor', { editor: editor });\r\n                }\r\n                if (editors.length === 0) {\r\n                    DOM$9.unbind(window, 'beforeunload', beforeUnloadDelegate);\r\n                }\r\n                editor.remove();\r\n                toggleGlobalEvents(editors.length > 0);\r\n                return editor;\r\n            },\r\n            execCommand: function (cmd, ui, value) {\r\n                var self = this, editor = self.get(value);\r\n                switch (cmd) {\r\n                    case 'mceAddEditor':\r\n                        if (!self.get(value)) {\r\n                            new Editor(value, self.settings, self).render();\r\n                        }\r\n                        return true;\r\n                    case 'mceRemoveEditor':\r\n                        if (editor) {\r\n                            editor.remove();\r\n                        }\r\n                        return true;\r\n                    case 'mceToggleEditor':\r\n                        if (!editor) {\r\n                            self.execCommand('mceAddEditor', 0, value);\r\n                            return true;\r\n                        }\r\n                        if (editor.isHidden()) {\r\n                            editor.show();\r\n                        }\r\n                        else {\r\n                            editor.hide();\r\n                        }\r\n                        return true;\r\n                }\r\n                if (self.activeEditor) {\r\n                    return self.activeEditor.execCommand(cmd, ui, value);\r\n                }\r\n                return false;\r\n            },\r\n            triggerSave: function () {\r\n                each$k(editors, function (editor) {\r\n                    editor.save();\r\n                });\r\n            },\r\n            addI18n: function (code, items) {\r\n                I18n.add(code, items);\r\n            },\r\n            translate: function (text) {\r\n                return I18n.translate(text);\r\n            },\r\n            setActive: function (editor) {\r\n                var activeEditor = this.activeEditor;\r\n                if (this.activeEditor !== editor) {\r\n                    if (activeEditor) {\r\n                        activeEditor.fire('deactivate', { relatedTarget: editor });\r\n                    }\r\n                    editor.fire('activate', { relatedTarget: activeEditor });\r\n                }\r\n                this.activeEditor = editor;\r\n            }\r\n        });\r\n        EditorManager.setup();\r\n        function RangeUtils(dom) {\r\n            var walk = function (rng, callback) {\r\n                return RangeWalk.walk(dom, rng, callback);\r\n            };\r\n            var split = split$1;\r\n            var normalize = function (rng) {\r\n                return NormalizeRange.normalize(dom, rng).fold(constant(false), function (normalizedRng) {\r\n                    rng.setStart(normalizedRng.startContainer, normalizedRng.startOffset);\r\n                    rng.setEnd(normalizedRng.endContainer, normalizedRng.endOffset);\r\n                    return true;\r\n                });\r\n            };\r\n            return {\r\n                walk: walk,\r\n                split: split,\r\n                normalize: normalize\r\n            };\r\n        }\r\n        (function (RangeUtils) {\r\n            RangeUtils.compareRanges = RangeCompare.isEq;\r\n            RangeUtils.getCaretRangeFromPoint = CaretRangeFromPoint.fromPoint;\r\n            RangeUtils.getSelectedNode = getSelectedNode;\r\n            RangeUtils.getNode = getNode;\r\n        }(RangeUtils || (RangeUtils = {})));\r\n        var RangeUtils$1 = RangeUtils;\r\n        var min = Math.min, max = Math.max, round$2 = Math.round;\r\n        var relativePosition = function (rect, targetRect, rel) {\r\n            var x, y, w, h, targetW, targetH;\r\n            x = targetRect.x;\r\n            y = targetRect.y;\r\n            w = rect.w;\r\n            h = rect.h;\r\n            targetW = targetRect.w;\r\n            targetH = targetRect.h;\r\n            rel = (rel || '').split('');\r\n            if (rel[0] === 'b') {\r\n                y += targetH;\r\n            }\r\n            if (rel[1] === 'r') {\r\n                x += targetW;\r\n            }\r\n            if (rel[0] === 'c') {\r\n                y += round$2(targetH / 2);\r\n            }\r\n            if (rel[1] === 'c') {\r\n                x += round$2(targetW / 2);\r\n            }\r\n            if (rel[3] === 'b') {\r\n                y -= h;\r\n            }\r\n            if (rel[4] === 'r') {\r\n                x -= w;\r\n            }\r\n            if (rel[3] === 'c') {\r\n                y -= round$2(h / 2);\r\n            }\r\n            if (rel[4] === 'c') {\r\n                x -= round$2(w / 2);\r\n            }\r\n            return create$5(x, y, w, h);\r\n        };\r\n        var findBestRelativePosition = function (rect, targetRect, constrainRect, rels) {\r\n            var pos, i;\r\n            for (i = 0; i < rels.length; i++) {\r\n                pos = relativePosition(rect, targetRect, rels[i]);\r\n                if (pos.x >= constrainRect.x && pos.x + pos.w <= constrainRect.w + constrainRect.x && pos.y >= constrainRect.y && pos.y + pos.h <= constrainRect.h + constrainRect.y) {\r\n                    return rels[i];\r\n                }\r\n            }\r\n            return null;\r\n        };\r\n        var inflate = function (rect, w, h) {\r\n            return create$5(rect.x - w, rect.y - h, rect.w + w * 2, rect.h + h * 2);\r\n        };\r\n        var intersect = function (rect, cropRect) {\r\n            var x1, y1, x2, y2;\r\n            x1 = max(rect.x, cropRect.x);\r\n            y1 = max(rect.y, cropRect.y);\r\n            x2 = min(rect.x + rect.w, cropRect.x + cropRect.w);\r\n            y2 = min(rect.y + rect.h, cropRect.y + cropRect.h);\r\n            if (x2 - x1 < 0 || y2 - y1 < 0) {\r\n                return null;\r\n            }\r\n            return create$5(x1, y1, x2 - x1, y2 - y1);\r\n        };\r\n        var clamp$1 = function (rect, clampRect, fixedSize) {\r\n            var underflowX1, underflowY1, overflowX2, overflowY2, x1, y1, x2, y2, cx2, cy2;\r\n            x1 = rect.x;\r\n            y1 = rect.y;\r\n            x2 = rect.x + rect.w;\r\n            y2 = rect.y + rect.h;\r\n            cx2 = clampRect.x + clampRect.w;\r\n            cy2 = clampRect.y + clampRect.h;\r\n            underflowX1 = max(0, clampRect.x - x1);\r\n            underflowY1 = max(0, clampRect.y - y1);\r\n            overflowX2 = max(0, x2 - cx2);\r\n            overflowY2 = max(0, y2 - cy2);\r\n            x1 += underflowX1;\r\n            y1 += underflowY1;\r\n            if (fixedSize) {\r\n                x2 += underflowX1;\r\n                y2 += underflowY1;\r\n                x1 -= overflowX2;\r\n                y1 -= overflowY2;\r\n            }\r\n            x2 -= overflowX2;\r\n            y2 -= overflowY2;\r\n            return create$5(x1, y1, x2 - x1, y2 - y1);\r\n        };\r\n        var create$5 = function (x, y, w, h) {\r\n            return {\r\n                x: x,\r\n                y: y,\r\n                w: w,\r\n                h: h\r\n            };\r\n        };\r\n        var fromClientRect = function (clientRect) {\r\n            return create$5(clientRect.left, clientRect.top, clientRect.width, clientRect.height);\r\n        };\r\n        var Rect = {\r\n            inflate: inflate,\r\n            relativePosition: relativePosition,\r\n            findBestRelativePosition: findBestRelativePosition,\r\n            intersect: intersect,\r\n            clamp: clamp$1,\r\n            create: create$5,\r\n            fromClientRect: fromClientRect\r\n        };\r\n        var each$l = Tools.each, extend$5 = Tools.extend;\r\n        var extendClass, initializing;\r\n        var Class = function () {\r\n        };\r\n        Class.extend = extendClass = function (prop) {\r\n            var self = this;\r\n            var _super = self.prototype;\r\n            var prototype, name, member;\r\n            var Class = function () {\r\n                var i, mixins, mixin;\r\n                var self = this;\r\n                if (!initializing) {\r\n                    if (self.init) {\r\n                        self.init.apply(self, arguments);\r\n                    }\r\n                    mixins = self.Mixins;\r\n                    if (mixins) {\r\n                        i = mixins.length;\r\n                        while (i--) {\r\n                            mixin = mixins[i];\r\n                            if (mixin.init) {\r\n                                mixin.init.apply(self, arguments);\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            };\r\n            var dummy = function () {\r\n                return this;\r\n            };\r\n            var createMethod = function (name, fn) {\r\n                return function () {\r\n                    var self = this;\r\n                    var tmp = self._super;\r\n                    var ret;\r\n                    self._super = _super[name];\r\n                    ret = fn.apply(self, arguments);\r\n                    self._super = tmp;\r\n                    return ret;\r\n                };\r\n            };\r\n            initializing = true;\r\n            prototype = new self();\r\n            initializing = false;\r\n            if (prop.Mixins) {\r\n                each$l(prop.Mixins, function (mixin) {\r\n                    for (var name_1 in mixin) {\r\n                        if (name_1 !== 'init') {\r\n                            prop[name_1] = mixin[name_1];\r\n                        }\r\n                    }\r\n                });\r\n                if (_super.Mixins) {\r\n                    prop.Mixins = _super.Mixins.concat(prop.Mixins);\r\n                }\r\n            }\r\n            if (prop.Methods) {\r\n                each$l(prop.Methods.split(','), function (name) {\r\n                    prop[name] = dummy;\r\n                });\r\n            }\r\n            if (prop.Properties) {\r\n                each$l(prop.Properties.split(','), function (name) {\r\n                    var fieldName = '_' + name;\r\n                    prop[name] = function (value) {\r\n                        var self = this;\r\n                        if (value !== undefined) {\r\n                            self[fieldName] = value;\r\n                            return self;\r\n                        }\r\n                        return self[fieldName];\r\n                    };\r\n                });\r\n            }\r\n            if (prop.Statics) {\r\n                each$l(prop.Statics, function (func, name) {\r\n                    Class[name] = func;\r\n                });\r\n            }\r\n            if (prop.Defaults && _super.Defaults) {\r\n                prop.Defaults = extend$5({}, _super.Defaults, prop.Defaults);\r\n            }\r\n            for (name in prop) {\r\n                member = prop[name];\r\n                if (typeof member === 'function' && _super[name]) {\r\n                    prototype[name] = createMethod(name, member);\r\n                }\r\n                else {\r\n                    prototype[name] = member;\r\n                }\r\n            }\r\n            Class.prototype = prototype;\r\n            Class.constructor = Class;\r\n            Class.extend = extendClass;\r\n            return Class;\r\n        };\r\n        var min$1 = Math.min, max$1 = Math.max, round$3 = Math.round;\r\n        var Color = function (value) {\r\n            var self = {};\r\n            var r = 0, g = 0, b = 0;\r\n            var rgb2hsv = function (r, g, b) {\r\n                var h, s, v, d, minRGB, maxRGB;\r\n                h = 0;\r\n                s = 0;\r\n                v = 0;\r\n                r = r / 255;\r\n                g = g / 255;\r\n                b = b / 255;\r\n                minRGB = min$1(r, min$1(g, b));\r\n                maxRGB = max$1(r, max$1(g, b));\r\n                if (minRGB === maxRGB) {\r\n                    v = minRGB;\r\n                    return {\r\n                        h: 0,\r\n                        s: 0,\r\n                        v: v * 100\r\n                    };\r\n                }\r\n                d = r === minRGB ? g - b : b === minRGB ? r - g : b - r;\r\n                h = r === minRGB ? 3 : b === minRGB ? 1 : 5;\r\n                h = 60 * (h - d / (maxRGB - minRGB));\r\n                s = (maxRGB - minRGB) / maxRGB;\r\n                v = maxRGB;\r\n                return {\r\n                    h: round$3(h),\r\n                    s: round$3(s * 100),\r\n                    v: round$3(v * 100)\r\n                };\r\n            };\r\n            var hsvToRgb = function (hue, saturation, brightness) {\r\n                var side, chroma, x, match;\r\n                hue = (parseInt(hue, 10) || 0) % 360;\r\n                saturation = parseInt(saturation, 10) / 100;\r\n                brightness = parseInt(brightness, 10) / 100;\r\n                saturation = max$1(0, min$1(saturation, 1));\r\n                brightness = max$1(0, min$1(brightness, 1));\r\n                if (saturation === 0) {\r\n                    r = g = b = round$3(255 * brightness);\r\n                    return;\r\n                }\r\n                side = hue / 60;\r\n                chroma = brightness * saturation;\r\n                x = chroma * (1 - Math.abs(side % 2 - 1));\r\n                match = brightness - chroma;\r\n                switch (Math.floor(side)) {\r\n                    case 0:\r\n                        r = chroma;\r\n                        g = x;\r\n                        b = 0;\r\n                        break;\r\n                    case 1:\r\n                        r = x;\r\n                        g = chroma;\r\n                        b = 0;\r\n                        break;\r\n                    case 2:\r\n                        r = 0;\r\n                        g = chroma;\r\n                        b = x;\r\n                        break;\r\n                    case 3:\r\n                        r = 0;\r\n                        g = x;\r\n                        b = chroma;\r\n                        break;\r\n                    case 4:\r\n                        r = x;\r\n                        g = 0;\r\n                        b = chroma;\r\n                        break;\r\n                    case 5:\r\n                        r = chroma;\r\n                        g = 0;\r\n                        b = x;\r\n                        break;\r\n                    default:\r\n                        r = g = b = 0;\r\n                }\r\n                r = round$3(255 * (r + match));\r\n                g = round$3(255 * (g + match));\r\n                b = round$3(255 * (b + match));\r\n            };\r\n            var toHex = function () {\r\n                var hex = function (val) {\r\n                    val = parseInt(val, 10).toString(16);\r\n                    return val.length > 1 ? val : '0' + val;\r\n                };\r\n                return '#' + hex(r) + hex(g) + hex(b);\r\n            };\r\n            var toRgb = function () {\r\n                return {\r\n                    r: r,\r\n                    g: g,\r\n                    b: b\r\n                };\r\n            };\r\n            var toHsv = function () {\r\n                return rgb2hsv(r, g, b);\r\n            };\r\n            var parse = function (value) {\r\n                var matches;\r\n                if (typeof value === 'object') {\r\n                    if ('r' in value) {\r\n                        r = value.r;\r\n                        g = value.g;\r\n                        b = value.b;\r\n                    }\r\n                    else if ('v' in value) {\r\n                        hsvToRgb(value.h, value.s, value.v);\r\n                    }\r\n                }\r\n                else {\r\n                    if (matches = /rgb\\s*\\(\\s*([0-9]+)\\s*,\\s*([0-9]+)\\s*,\\s*([0-9]+)[^\\)]*\\)/gi.exec(value)) {\r\n                        r = parseInt(matches[1], 10);\r\n                        g = parseInt(matches[2], 10);\r\n                        b = parseInt(matches[3], 10);\r\n                    }\r\n                    else if (matches = /#([0-F]{2})([0-F]{2})([0-F]{2})/gi.exec(value)) {\r\n                        r = parseInt(matches[1], 16);\r\n                        g = parseInt(matches[2], 16);\r\n                        b = parseInt(matches[3], 16);\r\n                    }\r\n                    else if (matches = /#([0-F])([0-F])([0-F])/gi.exec(value)) {\r\n                        r = parseInt(matches[1] + matches[1], 16);\r\n                        g = parseInt(matches[2] + matches[2], 16);\r\n                        b = parseInt(matches[3] + matches[3], 16);\r\n                    }\r\n                }\r\n                r = r < 0 ? 0 : r > 255 ? 255 : r;\r\n                g = g < 0 ? 0 : g > 255 ? 255 : g;\r\n                b = b < 0 ? 0 : b > 255 ? 255 : b;\r\n                return self;\r\n            };\r\n            if (value) {\r\n                parse(value);\r\n            }\r\n            self.toRgb = toRgb;\r\n            self.toHsv = toHsv;\r\n            self.toHex = toHex;\r\n            self.parse = parse;\r\n            return self;\r\n        };\r\n        var serialize = function (obj) {\r\n            var data = JSON.stringify(obj);\r\n            if (!isString(data)) {\r\n                return data;\r\n            }\r\n            return data.replace(/[\\u0080-\\uFFFF]/g, function (match) {\r\n                var hexCode = match.charCodeAt(0).toString(16);\r\n                return '\\\\u' + '0000'.substring(hexCode.length) + hexCode;\r\n            });\r\n        };\r\n        var JSONUtils = {\r\n            serialize: serialize,\r\n            parse: function (text) {\r\n                try {\r\n                    return JSON.parse(text);\r\n                }\r\n                catch (ex) {\r\n                }\r\n            }\r\n        };\r\n        var JSONP = {\r\n            callbacks: {},\r\n            count: 0,\r\n            send: function (settings) {\r\n                var self = this, dom = DOMUtils$1.DOM, count = settings.count !== undefined ? settings.count : self.count;\r\n                var id = 'tinymce_jsonp_' + count;\r\n                self.callbacks[count] = function (json) {\r\n                    dom.remove(id);\r\n                    delete self.callbacks[count];\r\n                    settings.callback(json);\r\n                };\r\n                dom.add(dom.doc.body, 'script', {\r\n                    id: id,\r\n                    src: settings.url,\r\n                    type: 'text/javascript'\r\n                });\r\n                self.count++;\r\n            }\r\n        };\r\n        var XHR = __assign({}, Observable, {\r\n            send: function (settings) {\r\n                var xhr, count = 0;\r\n                var ready = function () {\r\n                    if (!settings.async || xhr.readyState === 4 || count++ > 10000) {\r\n                        if (settings.success && count < 10000 && xhr.status === 200) {\r\n                            settings.success.call(settings.success_scope, '' + xhr.responseText, xhr, settings);\r\n                        }\r\n                        else if (settings.error) {\r\n                            settings.error.call(settings.error_scope, count > 10000 ? 'TIMED_OUT' : 'GENERAL', xhr, settings);\r\n                        }\r\n                        xhr = null;\r\n                    }\r\n                    else {\r\n                        Delay.setTimeout(ready, 10);\r\n                    }\r\n                };\r\n                settings.scope = settings.scope || this;\r\n                settings.success_scope = settings.success_scope || settings.scope;\r\n                settings.error_scope = settings.error_scope || settings.scope;\r\n                settings.async = settings.async !== false;\r\n                settings.data = settings.data || '';\r\n                XHR.fire('beforeInitialize', { settings: settings });\r\n                xhr = XMLHttpRequest();\r\n                if (xhr) {\r\n                    if (xhr.overrideMimeType) {\r\n                        xhr.overrideMimeType(settings.content_type);\r\n                    }\r\n                    xhr.open(settings.type || (settings.data ? 'POST' : 'GET'), settings.url, settings.async);\r\n                    if (settings.crossDomain) {\r\n                        xhr.withCredentials = true;\r\n                    }\r\n                    if (settings.content_type) {\r\n                        xhr.setRequestHeader('Content-Type', settings.content_type);\r\n                    }\r\n                    if (settings.requestheaders) {\r\n                        Tools.each(settings.requestheaders, function (header) {\r\n                            xhr.setRequestHeader(header.key, header.value);\r\n                        });\r\n                    }\r\n                    xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\r\n                    xhr = XHR.fire('beforeSend', {\r\n                        xhr: xhr,\r\n                        settings: settings\r\n                    }).xhr;\r\n                    xhr.send(settings.data);\r\n                    if (!settings.async) {\r\n                        return ready();\r\n                    }\r\n                    Delay.setTimeout(ready, 10);\r\n                }\r\n            }\r\n        });\r\n        var extend$6 = Tools.extend;\r\n        var JSONRequest = function () {\r\n            function JSONRequest(settings) {\r\n                this.settings = extend$6({}, settings);\r\n                this.count = 0;\r\n            }\r\n            JSONRequest.sendRPC = function (o) {\r\n                return new JSONRequest().send(o);\r\n            };\r\n            JSONRequest.prototype.send = function (args) {\r\n                var ecb = args.error, scb = args.success;\r\n                var xhrArgs = extend$6(this.settings, args);\r\n                xhrArgs.success = function (c, x) {\r\n                    c = JSONUtils.parse(c);\r\n                    if (typeof c === 'undefined') {\r\n                        c = { error: 'JSON Parse error.' };\r\n                    }\r\n                    if (c.error) {\r\n                        ecb.call(xhrArgs.error_scope || xhrArgs.scope, c.error, x);\r\n                    }\r\n                    else {\r\n                        scb.call(xhrArgs.success_scope || xhrArgs.scope, c.result);\r\n                    }\r\n                };\r\n                xhrArgs.error = function (ty, x) {\r\n                    if (ecb) {\r\n                        ecb.call(xhrArgs.error_scope || xhrArgs.scope, ty, x);\r\n                    }\r\n                };\r\n                xhrArgs.data = JSONUtils.serialize({\r\n                    id: args.id || 'c' + this.count++,\r\n                    method: args.method,\r\n                    params: args.params\r\n                });\r\n                xhrArgs.content_type = 'application/json';\r\n                XHR.send(xhrArgs);\r\n            };\r\n            return JSONRequest;\r\n        }();\r\n        var create$6 = function () {\r\n            return function () {\r\n                var data = {};\r\n                var keys = [];\r\n                var storage = {\r\n                    getItem: function (key) {\r\n                        var item = data[key];\r\n                        return item ? item : null;\r\n                    },\r\n                    setItem: function (key, value) {\r\n                        keys.push(key);\r\n                        data[key] = String(value);\r\n                    },\r\n                    key: function (index) {\r\n                        return keys[index];\r\n                    },\r\n                    removeItem: function (key) {\r\n                        keys = keys.filter(function (k) {\r\n                            return k === key;\r\n                        });\r\n                        delete data[key];\r\n                    },\r\n                    clear: function () {\r\n                        keys = [];\r\n                        data = {};\r\n                    },\r\n                    length: 0\r\n                };\r\n                Object.defineProperty(storage, 'length', {\r\n                    get: function () {\r\n                        return keys.length;\r\n                    },\r\n                    configurable: false,\r\n                    enumerable: false\r\n                });\r\n                return storage;\r\n            }();\r\n        };\r\n        var localStorage;\r\n        try {\r\n            localStorage = domGlobals.window.localStorage;\r\n        }\r\n        catch (e) {\r\n            localStorage = create$6();\r\n        }\r\n        var LocalStorage = localStorage;\r\n        var publicApi = {\r\n            geom: { Rect: Rect },\r\n            util: {\r\n                Promise: promiseObj,\r\n                Delay: Delay,\r\n                Tools: Tools,\r\n                VK: VK,\r\n                URI: URI,\r\n                Class: Class,\r\n                EventDispatcher: EventDispatcher,\r\n                Observable: Observable,\r\n                I18n: I18n,\r\n                XHR: XHR,\r\n                JSON: JSONUtils,\r\n                JSONRequest: JSONRequest,\r\n                JSONP: JSONP,\r\n                LocalStorage: LocalStorage,\r\n                Color: Color\r\n            },\r\n            dom: {\r\n                EventUtils: EventUtils,\r\n                Sizzle: Sizzle,\r\n                DomQuery: DomQuery,\r\n                TreeWalker: TreeWalker,\r\n                DOMUtils: DOMUtils$1,\r\n                ScriptLoader: ScriptLoader,\r\n                RangeUtils: RangeUtils$1,\r\n                Serializer: Serializer$1,\r\n                ControlSelection: ControlSelection,\r\n                BookmarkManager: BookmarkManager$1,\r\n                Selection: Selection,\r\n                Event: EventUtils.Event\r\n            },\r\n            html: {\r\n                Styles: Styles,\r\n                Entities: Entities,\r\n                Node: Node$1,\r\n                Schema: Schema,\r\n                SaxParser: SaxParser$1,\r\n                DomParser: DomParser,\r\n                Writer: Writer,\r\n                Serializer: Serializer\r\n            },\r\n            Env: Env,\r\n            AddOnManager: AddOnManager$1,\r\n            Annotator: Annotator,\r\n            Formatter: Formatter,\r\n            UndoManager: UndoManager,\r\n            EditorCommands: EditorCommands,\r\n            WindowManager: WindowManager,\r\n            NotificationManager: NotificationManager,\r\n            EditorObservable: EditorObservable,\r\n            Shortcuts: Shortcuts,\r\n            Editor: Editor,\r\n            FocusManager: FocusManager,\r\n            EditorManager: EditorManager,\r\n            DOM: DOMUtils$1.DOM,\r\n            ScriptLoader: ScriptLoader.ScriptLoader,\r\n            PluginManager: AddOnManager$1.PluginManager,\r\n            ThemeManager: AddOnManager$1.ThemeManager,\r\n            IconManager: IconManager,\r\n            trim: Tools.trim,\r\n            isArray: Tools.isArray,\r\n            is: Tools.is,\r\n            toArray: Tools.toArray,\r\n            makeMap: Tools.makeMap,\r\n            each: Tools.each,\r\n            map: Tools.map,\r\n            grep: Tools.grep,\r\n            inArray: Tools.inArray,\r\n            extend: Tools.extend,\r\n            create: Tools.create,\r\n            walk: Tools.walk,\r\n            createNS: Tools.createNS,\r\n            resolve: Tools.resolve,\r\n            explode: Tools.explode,\r\n            _addCacheSuffix: Tools._addCacheSuffix,\r\n            isOpera: Env.opera,\r\n            isWebKit: Env.webkit,\r\n            isIE: Env.ie,\r\n            isGecko: Env.gecko,\r\n            isMac: Env.mac\r\n        };\r\n        var tinymce = Tools.extend(EditorManager, publicApi);\r\n        var exportToModuleLoaders = function (tinymce) {\r\n            if (true) {\r\n                try {\r\n                    module.exports = tinymce;\r\n                }\r\n                catch (_) {\r\n                }\r\n            }\r\n        };\r\n        var exportToWindowGlobal = function (tinymce) {\r\n            window.tinymce = tinymce;\r\n            window.tinyMCE = tinymce;\r\n        };\r\n        exportToWindowGlobal(tinymce);\r\n        exportToModuleLoaders(tinymce);\r\n    }(window));\r\n})();\r\n\n\n//# sourceURL=webpack:///./node_modules/tinymce/tinymce.js?");

/***/ }),

/***/ "./node_modules/webpack/buildin/global.js":
/*!***********************************!*\
  !*** (webpack)/buildin/global.js ***!
  \***********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar g;\r\ng = (function () {\r\n    return this;\r\n})();\r\ntry {\r\n    g = g || new Function(\"return this\")();\r\n}\r\ncatch (e) {\r\n    if (typeof window === \"object\")\r\n        g = window;\r\n}\r\nmodule.exports = g;\r\n\n\n//# sourceURL=webpack:///(webpack)/buildin/global.js?");

/***/ }),

/***/ "./src/api/updateOperation.ts":
/*!************************************!*\
  !*** ./src/api/updateOperation.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nexports.default = (operationLogs) => __awaiter(this, void 0, void 0, function* () {\r\n    let pageId = utils_1.getPageId();\r\n    yield outsideInterfaces_1.Update(JSON.stringify({\r\n        pageId: pageId,\r\n        updates: operationLogs\r\n    }));\r\n});\r\n\n\n//# sourceURL=webpack:///./src/api/updateOperation.ts?");

/***/ }),

/***/ "./src/assets/icons/baocun.svg":
/*!*************************************!*\
  !*** ./src/assets/icons/baocun.svg ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzhhOGE4YSIgZD0iTTkyNS4yNDggMzU2LjkyOGwtMjU4LjE3Ni0yNTguMTc2YTY0IDY0IDAgMCAwLTQ1LjI0OC0xOC43NTJIMTQ0YTY0IDY0IDAgMCAwLTY0IDY0djczNmE2NCA2NCAwIDAgMCA2NCA2NGg3MzZhNjQgNjQgMCAwIDAgNjQtNjRWNDAyLjE3NmE2NCA2NCAwIDAgMC0xOC43NTItNDUuMjQ4ek0yODggMTQ0aDE5MlYyNTZIMjg4VjE0NHogbTQ0OCA3MzZIMjg4VjczNmg0NDh2MTQ0eiBtMTQ0IDBIODAwVjcwNGEzMiAzMiAwIDAgMC0zMi0zMkgyNTZhMzIgMzIgMCAwIDAtMzIgMzJ2MTc2SDE0NHYtNzM2SDIyNFYyODhhMzIgMzIgMCAwIDAgMzIgMzJoMjU2YTMyIDMyIDAgMCAwIDMyLTMyVjE0NGg3Ny44MjRsMjU4LjE3NiAyNTguMTc2Vjg4MHoiIC8+PC9zdmc+\"\n\n//# sourceURL=webpack:///./src/assets/icons/baocun.svg?");

/***/ }),

/***/ "./src/assets/icons/baocun_enable.svg":
/*!********************************************!*\
  !*** ./src/assets/icons/baocun_enable.svg ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzFmYjVmNiIgZD0iTTkyNS4yNDggMzU2LjkyOGwtMjU4LjE3Ni0yNTguMTc2YTY0IDY0IDAgMCAwLTQ1LjI0OC0xOC43NTJIMTQ0YTY0IDY0IDAgMCAwLTY0IDY0djczNmE2NCA2NCAwIDAgMCA2NCA2NGg3MzZhNjQgNjQgMCAwIDAgNjQtNjRWNDAyLjE3NmE2NCA2NCAwIDAgMC0xOC43NTItNDUuMjQ4ek0yODggMTQ0aDE5MlYyNTZIMjg4VjE0NHogbTQ0OCA3MzZIMjg4VjczNmg0NDh2MTQ0eiBtMTQ0IDBIODAwVjcwNGEzMiAzMiAwIDAgMC0zMi0zMkgyNTZhMzIgMzIgMCAwIDAtMzIgMzJ2MTc2SDE0NHYtNzM2SDIyNFYyODhhMzIgMzIgMCAwIDAgMzIgMzJoMjU2YTMyIDMyIDAgMCAwIDMyLTMyVjE0NGg3Ny44MjRsMjU4LjE3NiAyNTguMTc2Vjg4MHoiIC8+PC9zdmc+\"\n\n//# sourceURL=webpack:///./src/assets/icons/baocun_enable.svg?");

/***/ }),

/***/ "./src/assets/icons/charulianjie.svg":
/*!*******************************************!*\
  !*** ./src/assets/icons/charulianjie.svg ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzFmYjVmNiIgZD0iTTkxMC40OTYgMjEzLjUzNkM4MDQuMTYgODIuMjA4IDYxMS40ODggNjEuOTUyIDQ4MC4xMjggMTY4LjMybC0xMDAuNzY4IDgxLjYgNTAuMzM2IDYyLjE3NiAxMDAuNzY4LTgxLjZhMjI1Ljk4NCAyMjUuOTg0IDAgMSAxIDI4NC40NDggMzUxLjI2NGwtMTA3Ljk2OCA4Ny40MjQgNTAuMzM2IDYyLjE3NiAxMDcuOTY4LTg3LjQyNGEzMDUuOTg0IDMwNS45ODQgMCAwIDAgNDUuMjQ4LTQzMC40ek01MTYuMzUyIDgyMy41NTJhMjI1Ljk4NCAyMjUuOTg0IDAgMSAxLTI4NC40NDgtMzUxLjI2NGwxMTAuOTc2LTg5Ljg1Ni01MC4zMzYtNjIuMTc2LTExMC45NzYgODkuODU2QzUwLjI0IDUxNi40NDggMjkuOTg0IDcwOS4xNTIgMTM2LjMyIDg0MC40OGMxMDYuMzM2IDEzMS4zMjggMjk5LjA0IDE1MS41ODQgNDMwLjM2OCA0NS4yNDhsMTA1LjEyLTg1LjEyLTUwLjMzNi02Mi4xNzYtMTA1LjEyIDg1LjEyek02NzYuMTYgMzUzLjI4bDUxLjIzMiA2MS40NC0zNDMuNTUyIDI4Ni4zMDQtNTEuMi02MS40NHoiIC8+PC9zdmc+\"\n\n//# sourceURL=webpack:///./src/assets/icons/charulianjie.svg?");

/***/ }),

/***/ "./src/assets/icons/drag-move--fill.svg":
/*!**********************************************!*\
  !*** ./src/assets/icons/drag-move--fill.svg ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzhhOGE4YSIgZD0iTTc2OCA0NjkuMzMzMzMzVjM0MS4zMzMzMzNsMTcwLjY2NjY2NyAxNzAuNjY2NjY3LTE3MC42NjY2NjcgMTcwLjY2NjY2N3YtMTI4aC0yMTMuMzMzMzMzdjIxMy4zMzMzMzNoMTI4bC0xNzAuNjY2NjY3IDE3MC42NjY2NjctMTcwLjY2NjY2Ny0xNzAuNjY2NjY3aDEyOHYtMjEzLjMzMzMzM0gyNTZ2MTI4bC0xNzAuNjY2NjY3LTE3MC42NjY2NjcgMTcwLjY2NjY2Ny0xNzAuNjY2NjY3djEyOGgyMTMuMzMzMzMzVjI1NkgzNDEuMzMzMzMzbDE3MC42NjY2NjctMTcwLjY2NjY2NyAxNzAuNjY2NjY3IDE3MC42NjY2NjdoLTEyOHYyMTMuMzMzMzMzeiIgLz48L3N2Zz4=\"\n\n//# sourceURL=webpack:///./src/assets/icons/drag-move--fill.svg?");

/***/ }),

/***/ "./src/assets/icons/fangda.svg":
/*!*************************************!*\
  !*** ./src/assets/icons/fangda.svg ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTk1MS44OTg4NjkgMTgyLjI3OTQ4N2MwIDAuNzk4MTc5LTAuMTk1NDUxIDEuNTQ0MTY5LTAuMjM3NDA3IDIuMzMzMTM4bDAgMzA0LjkwMDIyMmMwIDI0LjcxNjkzOC0xOS43NTc5OTYgNDQuNzUxMjI3LTQ0LjEzMTEwMyA0NC43NTEyMjctMjQuMzczMTA3IDAtNDQuMTMxMTAzLTIwLjAzNTMxMi00NC4xMzExMDMtNDQuNzQ5MThMODYzLjM5OTI1NSAyODguOTYxMjA0IDQ1NS43MjYzNDYgNjk3LjEyOTM5NGMtMTcuNDI2OTA1IDE3LjQ0OTQxNy00NS42ODE0MTIgMTcuNDQ5NDE3LTYzLjEwNjI3IDAtMTcuNDI2OTA1LTE3LjQ0NjM0Ny0xNy40MjY5MDUtNDUuNzM2NjcxIDAtNjMuMTgzMDE4bDQwNy4xMDkwNjgtNDA3LjYwNTM3Mkw2MDAuNDIxODQyIDIyNi4zNDEwMDVjLTI0Ljc1Mzc3NyAwLTQ0LjgxOTc4OC0xOS43MjUyNS00NC44MTk3ODgtNDQuMDYxNTE4IDAtMjQuMzMyMTc1IDIwLjA2ODA1OC00NC4wNTg0NDggNDQuODE5Nzg4LTQ0LjA1ODQ0OGwzMDEuMTY4MjI0IDBjMTAuNTAyMTkyLTEuMjEzNjQxIDIxLjI5OTA5NSAxLjE3ODg0OSAzMC4zNTk0NDggNy40MjQwODZDOTQzLjk3MTMxNSAxNTMuNTQ4MTE4IDk1MS44OTg4NjkgMTY2Ljk5NjQwOCA5NTEuODk4ODY5IDE4Mi4yNzk0ODd6TTQyMy45MzgzNjIgMjI2LjM4NTAwN2wwIDAuMDAyMDQ3LTIxOS44OTgyNjkgMGMtMjQuMjkwMjE5IDAtNDMuOTc5NjU0IDIwLjM3ODEyLTQzLjk3OTY1NCA0NC42NjgzMzlsMCA0ODMuMDg3NTA3YzAgMjQuMjkwMjE5IDE5LjY4OTQzNSA0My45Nzc2MDcgNDMuOTc5NjU0IDQzLjk3NzYwN2w2MTUuNzEzMTA3IDBjMjQuMjkwMjE5IDAgNDMuOTc5NjU0LTE5LjY4NzM4OCA0My45Nzk2NTQtNDMuOTc3NjA3bDAtODcuOTYxMzU0IDAuMDA0MDkzIDBjMC0yNC4yODgxNzMgMTkuNjg3Mzg4LTQzLjk3NzYwNyA0My45Nzc2MDctNDMuOTc3NjA3czQzLjk4MTcgMTkuNjg5NDM1IDQzLjk4MTcgNDMuOTc3NjA3YzAgMC4wMTEyNTYtMC4wMDQwOTMgMC4wMjE0ODktMC4wMDQwOTMgMC4wMzA2OTlsMCAxMDkuOTE4NDM1YzAgNjAuNzI3MDgzLTQ5LjIyNDA5OCAxMDkuOTUzMjI4LTEwOS45NDkxMzQgMTA5Ljk1MzIyOGwtNjU5LjY5NDgwNyAwYy02MC43MjI5OSAwLTEwOS45NDcwODgtNDkuMjI2MTQ1LTEwOS45NDcwODgtMTA5Ljk1MzIyOEw3Mi4xMDExMzEgMjQ4LjM3ODkyN2MwLTYwLjcyNTAzNiA0OS4yMjQwOTgtMTA5Ljk1MTE4MSAxMDkuOTQ3MDg4LTEwOS45NTExODFsMjQxLjg3NDc5MyAwYzAuMDA0MDkzIDAgMC4wMTEyNTYtMC4wMDIwNDcgMC4wMTUzNS0wLjAwMjA0NyAyNC4yOTAyMTkgMCA0My45Nzk2NTQgMTkuNjg5NDM1IDQzLjk3OTY1NCA0My45Nzk2NTRTNDQ4LjIyODU4MSAyMjYuMzg1MDA3IDQyMy45MzgzNjIgMjI2LjM4NTAwN3oiIC8+PC9zdmc+\"\n\n//# sourceURL=webpack:///./src/assets/icons/fangda.svg?");

/***/ }),

/***/ "./src/assets/icons/guanbi-gray.svg":
/*!******************************************!*\
  !*** ./src/assets/icons/guanbi-gray.svg ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwcHgiIGhlaWdodD0iMjAuMDBweCIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPjxwYXRoIGZpbGw9IiNjY2MiIGQ9Ik01ODcuNzMyODQ1IDUxMS43MDUyODhsMC41NjM4NDIgMC41NjM4NDItNzUuNjA5MDI1IDc1LjUwNzcxOC0wLjUxMjY3Ni0wLjUxMjY3NkwxNzEuODMxNTMgOTI3LjYwMzUzM2MtMjAuOTA5MjE2IDIwLjkxMjI4NS01NC43NzQ1MTEgMjAuOTQ3MDc4LTc1LjYzODcwMSAwLjA4Mjg4OC0yMC44NjYyMzctMjAuODY2MjM3LTIwLjgyOTM5OC01NC43MzI1NTUgMC4wNzk4MTgtNzUuNjQxNzcxbDM0MC4zMzkzNjItMzQwLjMzOTM2Mkw5Ni44NjMwOTUgMTcxLjk1MzMwNGMtMjAuOTA5MjE2LTIwLjkwOTIxNi0yMC45NDcwNzgtNTQuNzc0NTExLTAuMDc5ODE4LTc1LjYzODcwMSAyMC44NjQxOS0yMC44NjYyMzcgNTQuNzI5NDg1LTIwLjgyOTM5OCA3NS42Mzg3MDEgMC4wNzk4MThMNTEyLjE3Mzk2MiA0MzYuMTQ2NDA1IDg1MS41NzU5NzUgOTYuNzQyMzQ1YzIwLjkxMjI4NS0yMC45MDkyMTYgNTQuNzc0NTExLTIwLjk0NzA3OCA3NS42NDE3NzEtMC4wNzk4MTggMjAuODY0MTkgMjAuODY0MTkgMjAuODI5Mzk4IDU0LjcyOTQ4NS0wLjA3OTgxOCA3NS42Mzg3MDFMNTg3LjczMjg0NSA1MTEuNzA1Mjg4ek02NTguOTU0OTU3IDYwMC42Njk0ODJjMTIuMjI3NDg2IDEuMTE5NDk3IDIyLjk1Nzg3NSA2LjQyNDMxNiAzMS4zMDYwMDcgMTQuMTc5OTU0bDAuMzEwMDYyLTAuMzA2OTkyIDIzNy4xNTUzMDUgMjM3LjE1NjMyOGMyMC45MDkyMTYgMjAuOTEyMjg1IDIwLjk0NDAwOCA1NC43NzQ1MTEgMC4wNzk4MTggNzUuNjQxNzcxLTIwLjg2NjIzNyAyMC44NjQxOS01NC43Mjk0ODUgMjAuODI5Mzk4LTc1LjY0MTc3MS0wLjA3OTgxOEw2MTQuOTU5OTUzIDY5MC4wNTAxNjJsMC4wMzQ3OTItMC4wMzQ3OTJjLTkuOTEwNzIxLTEwLjcyODM0Mi0xNS41NTMyMzEtMjUuMzE5NjY1LTE0LjExNTQ4Ni00MS4wMTIwNjZDNjAzLjU2ODUwOSA2MTkuNjIwMDkgNjI5LjU2OTY5NiA1OTcuOTc5MjEgNjU4Ljk1NDk1NyA2MDAuNjY5NDgyeiIgLz48L3N2Zz4=\"\n\n//# sourceURL=webpack:///./src/assets/icons/guanbi-gray.svg?");

/***/ }),

/***/ "./src/assets/icons/guanbi.svg":
/*!*************************************!*\
  !*** ./src/assets/icons/guanbi.svg ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iI2ZmZmZmZiIgZD0iTTU4Ny43MzI4NDUgNTExLjcwNTI4OGwwLjU2Mzg0MiAwLjU2Mzg0Mi03NS42MDkwMjUgNzUuNTA3NzE4LTAuNTEyNjc2LTAuNTEyNjc2TDE3MS44MzE1MyA5MjcuNjAzNTMzYy0yMC45MDkyMTYgMjAuOTEyMjg1LTU0Ljc3NDUxMSAyMC45NDcwNzgtNzUuNjM4NzAxIDAuMDgyODg4LTIwLjg2NjIzNy0yMC44NjYyMzctMjAuODI5Mzk4LTU0LjczMjU1NSAwLjA3OTgxOC03NS42NDE3NzFsMzQwLjMzOTM2Mi0zNDAuMzM5MzYyTDk2Ljg2MzA5NSAxNzEuOTUzMzA0Yy0yMC45MDkyMTYtMjAuOTA5MjE2LTIwLjk0NzA3OC01NC43NzQ1MTEtMC4wNzk4MTgtNzUuNjM4NzAxIDIwLjg2NDE5LTIwLjg2NjIzNyA1NC43Mjk0ODUtMjAuODI5Mzk4IDc1LjYzODcwMSAwLjA3OTgxOEw1MTIuMTczOTYyIDQzNi4xNDY0MDUgODUxLjU3NTk3NSA5Ni43NDIzNDVjMjAuOTEyMjg1LTIwLjkwOTIxNiA1NC43NzQ1MTEtMjAuOTQ3MDc4IDc1LjY0MTc3MS0wLjA3OTgxOCAyMC44NjQxOSAyMC44NjQxOSAyMC44MjkzOTggNTQuNzI5NDg1LTAuMDc5ODE4IDc1LjYzODcwMUw1ODcuNzMyODQ1IDUxMS43MDUyODh6TTY1OC45NTQ5NTcgNjAwLjY2OTQ4MmMxMi4yMjc0ODYgMS4xMTk0OTcgMjIuOTU3ODc1IDYuNDI0MzE2IDMxLjMwNjAwNyAxNC4xNzk5NTRsMC4zMTAwNjItMC4zMDY5OTIgMjM3LjE1NTMwNSAyMzcuMTU2MzI4YzIwLjkwOTIxNiAyMC45MTIyODUgMjAuOTQ0MDA4IDU0Ljc3NDUxMSAwLjA3OTgxOCA3NS42NDE3NzEtMjAuODY2MjM3IDIwLjg2NDE5LTU0LjcyOTQ4NSAyMC44MjkzOTgtNzUuNjQxNzcxLTAuMDc5ODE4TDYxNC45NTk5NTMgNjkwLjA1MDE2MmwwLjAzNDc5Mi0wLjAzNDc5MmMtOS45MTA3MjEtMTAuNzI4MzQyLTE1LjU1MzIzMS0yNS4zMTk2NjUtMTQuMTE1NDg2LTQxLjAxMjA2NkM2MDMuNTY4NTA5IDYxOS42MjAwOSA2MjkuNTY5Njk2IDU5Ny45NzkyMSA2NTguOTU0OTU3IDYwMC42Njk0ODJ6IiAvPjwvc3ZnPg==\"\n\n//# sourceURL=webpack:///./src/assets/icons/guanbi.svg?");

/***/ }),

/***/ "./src/assets/icons/shangyibu.svg":
/*!****************************************!*\
  !*** ./src/assets/icons/shangyibu.svg ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzhhOGE4YSIgZD0iTTk5NS42NDggNDU5LjI5NkM2ODQuNDQ4IDI4MS41NjggNDA2LjA4IDMxOC42NTYgMTcxLjIzMiA1NjcuOTA0TDMyIDQxNnYzODRoMzUybC0xNjAuNzM2LTE3NS4zMjhjMjExLjE2OC0yMjcuMDcyIDQ1Mi4xOTItMjU5Ljc3NiA3MzQuMzA0LTk4LjY4OGEzOC40IDM4LjQgMCAwIDAgMzguMDgtNjYuNjg4eiIgLz48L3N2Zz4=\"\n\n//# sourceURL=webpack:///./src/assets/icons/shangyibu.svg?");

/***/ }),

/***/ "./src/assets/icons/shangyibu_enable.svg":
/*!***********************************************!*\
  !*** ./src/assets/icons/shangyibu_enable.svg ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzFmYjVmNiIgZD0iTTk5NS42NDggNDU5LjI5NkM2ODQuNDQ4IDI4MS41NjggNDA2LjA4IDMxOC42NTYgMTcxLjIzMiA1NjcuOTA0TDMyIDQxNnYzODRoMzUybC0xNjAuNzM2LTE3NS4zMjhjMjExLjE2OC0yMjcuMDcyIDQ1Mi4xOTItMjU5Ljc3NiA3MzQuMzA0LTk4LjY4OGEzOC40IDM4LjQgMCAwIDAgMzguMDgtNjYuNjg4eiIgLz48L3N2Zz4=\"\n\n//# sourceURL=webpack:///./src/assets/icons/shangyibu_enable.svg?");

/***/ }),

/***/ "./src/assets/icons/xiayibu.svg":
/*!**************************************!*\
  !*** ./src/assets/icons/xiayibu.svg ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzhhOGE4YSIgZD0iTTg2MC45OTIgNTU4LjkxMkM2MjcuOTA0IDMxNy41MzYgMzUyLjM4NCAyODMuNjQ4IDQ0LjggNDU5LjI5NmEzOC40IDM4LjQgMCAxIDAgMzguMDggNjYuNjg4YzI3OC40MzItMTU5LjAwOCA1MTYuODk2LTEyOS40MDggNzI2LjA4IDg5LjY5Nkw2NDAgODAwaDM1MlY0MTZsLTEzMS4wMDggMTQyLjkxMnoiIC8+PC9zdmc+\"\n\n//# sourceURL=webpack:///./src/assets/icons/xiayibu.svg?");

/***/ }),

/***/ "./src/assets/icons/xiayibu_enable.svg":
/*!*********************************************!*\
  !*** ./src/assets/icons/xiayibu_enable.svg ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzFmYjVmNiIgZD0iTTg2MC45OTIgNTU4LjkxMkM2MjcuOTA0IDMxNy41MzYgMzUyLjM4NCAyODMuNjQ4IDQ0LjggNDU5LjI5NmEzOC40IDM4LjQgMCAxIDAgMzguMDggNjYuNjg4YzI3OC40MzItMTU5LjAwOCA1MTYuODk2LTEyOS40MDggNzI2LjA4IDg5LjY5Nkw2NDAgODAwaDM1MlY0MTZsLTEzMS4wMDggMTQyLjkxMnoiIC8+PC9zdmc+\"\n\n//# sourceURL=webpack:///./src/assets/icons/xiayibu_enable.svg?");

/***/ }),

/***/ "./src/assets/icons/xingzhuang-tupian.svg":
/*!************************************************!*\
  !*** ./src/assets/icons/xingzhuang-tupian.svg ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyBjbGFzcz0iaWNvbiIgd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMC4wMHB4IiB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZmlsbD0iIzFmYjVmNiIgZD0iTTkyOCA4OTZIOTZhMzIgMzIgMCAwIDEtMzItMzJWMTYwYTMyIDMyIDAgMCAxIDMyLTMyaDgzMmEzMiAzMiAwIDAgMSAzMiAzMnYxMTYuODY0YTMyIDMyIDAgMSAxLTY0IDBWMTkySDEyOHY2NDBoNzY4VjQ2OC41NDRsLTIwNi4zMzYgMjQ0LjczNmEzMS45NjggMzEuOTY4IDAgMCAxLTQ0Ljg5NiA0bC0xOTYuMDY0LTE2Mi43NTItMTk0LjY1NiAxODAuMjI0YTMxLjkzNiAzMS45MzYgMCAxIDEtNDMuNDU2LTQ2Ljk0NGwyMTUuMjMyLTE5OS4yOTZhMzIuMDMyIDMyLjAzMiAwIDAgMSA0Mi4xNzYtMS4xNTJsMTkzLjIxNiAxNjAuMzg0IDI0Mi4zMzYtMjg3LjQ1NmEzMi4xMjggMzIuMTI4IDAgMCAxIDM1LjQyNC05LjQ0YzEyLjYwOCA0LjYwOCAyMS4wMjQgMTYuNjQgMjEuMDI0IDMwLjA4Vjg2NGEzMiAzMiAwIDAgMS0zMiAzMnpNMzA0IDQ4MEMyNDIuMjQgNDgwIDE5MiA0MjkuNzYgMTkyIDM2OFMyNDIuMjQgMjU2IDMwNCAyNTYgNDE2IDMwNi4yNCA0MTYgMzY4IDM2NS43NiA0ODAgMzA0IDQ4MHogbTAtMTYwYy0yNi40NjQgMC00OCAyMS41MzYtNDggNDhTMjc3LjUzNiA0MTYgMzA0IDQxNnM0OC0yMS41MzYgNDgtNDgtMjEuNTM2LTQ4LTQ4LTQ4eiIgLz48L3N2Zz4=\"\n\n//# sourceURL=webpack:///./src/assets/icons/xingzhuang-tupian.svg?");

/***/ }),

/***/ "./src/assets/img/transparent.png":
/*!****************************************!*\
  !*** ./src/assets/img/transparent.png ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports) {

eval("module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMCAIAAADZF8uwAAAAGUlEQVQYV2M4gwH+YwCGIasIUwhT25BVBADtzYNYrHvv4gAAAABJRU5ErkJggg==\"\n\n//# sourceURL=webpack:///./src/assets/img/transparent.png?");

/***/ }),

/***/ "./src/assets/kb-style.css":
/*!*********************************!*\
  !*** ./src/assets/kb-style.css ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

eval("\nvar content = __webpack_require__(/*! !../../node_modules/css-loader/dist/cjs.js!./kb-style.css */ \"./node_modules/css-loader/dist/cjs.js!./src/assets/kb-style.css\");\n\nif(typeof content === 'string') content = [[module.i, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = __webpack_require__(/*! ../../node_modules/style-loader/lib/addStyles.js */ \"./node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(false) {}\n\n//# sourceURL=webpack:///./src/assets/kb-style.css?");

/***/ }),

/***/ "./src/common/Position.ts":
/*!********************************!*\
  !*** ./src/common/Position.ts ***!
  \********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.updatePositon = (positon, el) => {\r\n    const { top, left, height, width, bottom, right } = positon;\r\n    if (top != undefined)\r\n        el.style.top = top + \"px\";\r\n    if (left != undefined)\r\n        el.style.left = left + \"px\";\r\n    if (bottom != undefined)\r\n        el.style.bottom = bottom + \"px\";\r\n    if (right != undefined)\r\n        el.style.right = right + \"px\";\r\n    if (width != undefined)\r\n        el.style.width = width + \"px\";\r\n    if (height != undefined)\r\n        el.style.height = height + \"px\";\r\n};\r\n\n\n//# sourceURL=webpack:///./src/common/Position.ts?");

/***/ }),

/***/ "./src/common/constants.ts":
/*!*********************************!*\
  !*** ./src/common/constants.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.EDITOR_SHADE_COLOR = \"rgba(0,0,0,0.5)\";\r\nexports.STANDARD_Z_INDEX = 10000000;\r\nexports.HOVER_BORDER_WIDTH = 2;\r\nexports.HOVER_BORDER_COLOR = \"#1fb5f6a3\";\r\nexports.SELECTED_BORDER_WIDTH = 1;\r\nexports.SELECTED_BORDER_COLOR = \"red\";\r\nexports.HOVER_BORDER_SKIP = \"__HOVER_BORDER_SKIP\";\r\nexports.KOOBOO_ID = \"kooboo-id\";\r\nexports.KOOBOO_DIRTY = \"kooboo-dirty\";\r\nexports.KOOBOO_GUID = \"kooboo-guid\";\r\nexports.EMPTY_COMMENT = \"<!--empty-->\";\r\nexports.OBJECT_TYPE = {\r\n    content: \"content\",\r\n    contentrepeater: \"contentrepeater\",\r\n    htmlblock: \"htmlblock\",\r\n    Label: \"Label\",\r\n    view: \"view\",\r\n    menu: \"menu\",\r\n    page: \"page\",\r\n    style: \"style\",\r\n    dom: \"dom\",\r\n    attribute: \"attribute\",\r\n    layout: \"layout\",\r\n    form: \"form\",\r\n    Url: \"Url\"\r\n};\r\nexports.EDITOR_TYPE = {\r\n    dom: \"dom\",\r\n    htmlblock: \"htmlblock\",\r\n    label: \"label\",\r\n    content: \"content\",\r\n    attribute: \"attribute\",\r\n    style: \"style\",\r\n    converter: \"converter\"\r\n};\r\n\n\n//# sourceURL=webpack:///./src/common/constants.ts?");

/***/ }),

/***/ "./src/common/context.ts":
/*!*******************************!*\
  !*** ./src/common/context.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Manager_1 = __webpack_require__(/*! @/operation/Manager */ \"./src/operation/Manager.ts\");\r\nconst SelectedDomEvent_1 = __webpack_require__(/*! @/events/SelectedDomEvent */ \"./src/events/SelectedDomEvent.ts\");\r\nconst HoverDomEvent_1 = __webpack_require__(/*! @/events/HoverDomEvent */ \"./src/events/HoverDomEvent.ts\");\r\nconst EditableEvent_1 = __webpack_require__(/*! @/events/EditableEvent */ \"./src/events/EditableEvent.ts\");\r\nconst TinymceEvent_1 = __webpack_require__(/*! @/events/TinymceEvent */ \"./src/events/TinymceEvent.ts\");\r\nconst OperationEvent_1 = __webpack_require__(/*! @/events/OperationEvent */ \"./src/events/OperationEvent.ts\");\r\nconst CloseEditingEvent_1 = __webpack_require__(/*! @/events/CloseEditingEvent */ \"./src/events/CloseEditingEvent.ts\");\r\nconst utils_1 = __webpack_require__(/*! ./utils */ \"./src/common/utils.ts\");\r\nclass Context {\r\n    constructor() {\r\n        this._editing = false;\r\n        this.operationManager = new Manager_1.operationManager();\r\n        this.container = utils_1.createContainer();\r\n        this.floatMenuClosing = false;\r\n        this.domChangeEvent = new SelectedDomEvent_1.SelectedDomEvent();\r\n        this.editableEvent = new EditableEvent_1.EditableEvent();\r\n        this.tinymceInputEvent = new TinymceEvent_1.TinymceInputEvent();\r\n        this.operationEvent = new OperationEvent_1.OperationEvent();\r\n        this.hoverDomEvent = new HoverDomEvent_1.HoverDomEvent();\r\n        this.closeEditingEvent = new CloseEditingEvent_1.CloseEditingEvent();\r\n    }\r\n    set editing(value) {\r\n        this._editing = value;\r\n        this.editableEvent.emit(value);\r\n    }\r\n    get editing() {\r\n        return this._editing;\r\n    }\r\n}\r\nexports.default = new Context();\r\n\n\n//# sourceURL=webpack:///./src/common/context.ts?");

/***/ }),

/***/ "./src/common/lang.ts":
/*!****************************!*\
  !*** ./src/common/lang.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nlet kbLang = localStorage.getItem(\"lang\");\r\nif (!kbLang)\r\n    kbLang = \"en\";\r\nexports.lang = kbLang;\r\nconst en = {\r\n    MENU: \"Menu\",\r\n    EDIT: \"Edit\",\r\n    COPY: \"Copy\",\r\n    DELETE: \"Delete\",\r\n    EDIT_IMAGE: \"Edit image\",\r\n    EDIT_LINK: \"Edit link\",\r\n    EDIT_IMAGES: \"Edit images\",\r\n    EDIT_LINKS: \"Edit links\",\r\n    ENTER_LINK: \"Enter link\",\r\n    EDIT_HTML_BLOCK: \"Edit html block\",\r\n    CONVERT: \"Convert to\",\r\n    CONVERTTOHTMLBLOCK: \"Html block\",\r\n    CONVERTTOVIEW: \"View\",\r\n    OK: \"Ok\",\r\n    CANCEL: \"Cancel\",\r\n    PAGE_LINK: \"Page link\",\r\n    OUT_LINK: \" Out link\",\r\n    EDIT_REPEAT: \"Edit repeat item\",\r\n    EDIT_MENU: \"Edit menu\",\r\n    EDIT_STYLE: \"Edit style\",\r\n    ALT: \"Alt\",\r\n    TITLE: \"Title\",\r\n    WIDTH: \"Width\",\r\n    HEIGHT: \"Height\",\r\n    PLEASE_EDIT_AFTER_SAVE: \"Please edit after save\",\r\n    COPY_REPEAT: \"Copy repeat item\",\r\n    DELETE_REPEAR: \"Delete repeat item\",\r\n    REPLACE_TO_IMG: \"Replace to image\",\r\n    REPLACE_TO_TEXT: \"Replace to Text\",\r\n    MOVE: \"Move\",\r\n    PREVIOUS: \"Undo\",\r\n    NEXT: \"Redo\",\r\n    SAVE: \"Save\",\r\n    CONTENT_IMAGES: \"Content images\",\r\n    STYLE_IMAGES: \"Style images\",\r\n    DOM_IMAGES: \"DOM images\",\r\n    CONTENT_LINKS: \"Content links\",\r\n    DOM_LINKS: \"DOM links\",\r\n    BACKGROUND_IMAGE: \"Background image\",\r\n    COLOR: \"Color\",\r\n    BACKGROUND_COLOR: \"Background color\",\r\n    FONT: \"Font\",\r\n    FONT_SIZE: \"Font size\",\r\n    FONT_WEIGHT: \"Font weight\",\r\n    FONT_FAMILY: \"Font family\",\r\n    SIZE: \"Size\",\r\n    CLICK: \"Click\",\r\n    EDIT_FORM: \"Edit form\",\r\n    EXPAND_SELECTION: \"Expand selection\",\r\n    GLOBAL_UPDATE: \"Global Update\",\r\n    EDIT_COLOR: \"Edit color\"\r\n};\r\nconst zh = {\r\n    MENU: \"菜单\",\r\n    EDIT: \"编辑\",\r\n    COPY: \"复制这块\",\r\n    DELETE: \"删除\",\r\n    EDIT_IMAGE: \"编辑图片\",\r\n    EDIT_LINK: \"编辑链接\",\r\n    EDIT_IMAGES: \"编辑图片\",\r\n    EDIT_LINKS: \"编辑链接\",\r\n    ENTER_LINK: \"跳转链接\",\r\n    EDIT_HTML_BLOCK: \"编辑HTML代码块\",\r\n    CONVERT: \"转换为\",\r\n    CONVERTTOHTMLBLOCK: \"Html 代码块\",\r\n    CONVERTTOVIEW: \"视图\",\r\n    CANCEL: \"取消\",\r\n    OK: \"确定\",\r\n    PAGE_LINK: \"页面链接\",\r\n    OUT_LINK: \"外部链接\",\r\n    EDIT_REPEAT: \"编辑项目\",\r\n    EDIT_MENU: \"编辑菜单\",\r\n    EDIT_STYLE: \"编辑样式\",\r\n    ALT: \"替代文本\",\r\n    HEIGHT: \"高度\",\r\n    TITLE: \"标题\",\r\n    WIDTH: \"宽度\",\r\n    PLEASE_EDIT_AFTER_SAVE: \"请保存后再编辑\",\r\n    COPY_REPEAT: \"复制项目\",\r\n    DELETE_REPEAR: \"删除项目\",\r\n    REPLACE_TO_IMG: \"替换为图片\",\r\n    REPLACE_TO_TEXT: \"替换为文字\",\r\n    MOVE: \"移动\",\r\n    NEXT: \"下一步\",\r\n    PREVIOUS: \"上一步\",\r\n    SAVE: \"保存\",\r\n    CONTENT_IMAGES: \"内容图片\",\r\n    STYLE_IMAGES: \"样式图片\",\r\n    DOM_IMAGES: \"DOM 图片\",\r\n    CONTENT_LINKS: \"内容链接\",\r\n    DOM_LINKS: \"DOM 链接\",\r\n    BACKGROUND_COLOR: \"背景颜色\",\r\n    BACKGROUND_IMAGE: \"背景图片\",\r\n    COLOR: \"颜色\",\r\n    FONT: \"字体\",\r\n    FONT_FAMILY: \"字体风格\",\r\n    FONT_SIZE: \"字体大小\",\r\n    FONT_WEIGHT: \"字体重量\",\r\n    SIZE: \"大小\",\r\n    CLICK: \"点击\",\r\n    EDIT_FORM: \"编辑表单\",\r\n    EXPAND_SELECTION: \"扩大选区\",\r\n    GLOBAL_UPDATE: \"全局更新\",\r\n    EDIT_COLOR: \"编辑颜色\"\r\n};\r\nvar langPackages = { en, zh };\r\nexports.TEXT = langPackages[exports.lang];\r\n\n\n//# sourceURL=webpack:///./src/common/lang.ts?");

/***/ }),

/***/ "./src/common/utils.ts":
/*!*****************************!*\
  !*** ./src/common/utils.ts ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! ./context */ \"./src/common/context.ts\"));\r\nconst SelectedDomEvent_1 = __webpack_require__(/*! @/events/SelectedDomEvent */ \"./src/events/SelectedDomEvent.ts\");\r\nconst constants_1 = __webpack_require__(/*! ./constants */ \"./src/common/constants.ts\");\r\n__webpack_require__(/*! @webcomponents/shadydom */ \"./node_modules/@webcomponents/shadydom/shadydom.min.js\");\r\nfunction delay(time) {\r\n    return new Promise(rs => {\r\n        setTimeout(rs, time);\r\n    });\r\n}\r\nexports.delay = delay;\r\nfunction setElementClick() {\r\n    for (const i of utils_1.getAllElement(document.body, true)) {\r\n        if (i instanceof HTMLElement) {\r\n            if (utils_1.isLink(i)) {\r\n                let a = i.cloneNode(true);\r\n                a._a = i;\r\n                i.parentElement.replaceChild(a, i);\r\n            }\r\n            holdUpClick(i);\r\n        }\r\n    }\r\n}\r\nexports.setElementClick = setElementClick;\r\nfunction holdUpClick(el) {\r\n    el.onclick = e => {\r\n        if (e.isTrusted) {\r\n            e.stopPropagation();\r\n            e.preventDefault();\r\n        }\r\n        if (context_1.default.editing || utils_1.isInEditorContainer(e))\r\n            return;\r\n        let element = context_1.default.lastHoverDomEventArgs.closeElement;\r\n        var args = new SelectedDomEvent_1.SelectedDomEventArgs(element);\r\n        context_1.default.lastMouseEventArg = e;\r\n        context_1.default.domChangeEvent.emit(args);\r\n    };\r\n}\r\nexports.holdUpClick = holdUpClick;\r\nfunction createContainer() {\r\n    let el = document.createElement(\"div\");\r\n    el.style.cssText = \"all:unset !important\";\r\n    el.style.fontSize = \"16px\";\r\n    document.documentElement.appendChild(el);\r\n    let shadow = el.attachShadow({ mode: \"open\" });\r\n    let root = document.createElement(\"div\");\r\n    root.id = constants_1.HOVER_BORDER_SKIP;\r\n    shadow.appendChild(root);\r\n    return root;\r\n}\r\nexports.createContainer = createContainer;\r\n\n\n//# sourceURL=webpack:///./src/common/utils.ts?");

/***/ }),

/***/ "./src/components/actionBar/ImageButton.ts":
/*!*************************************************!*\
  !*** ./src/components/actionBar/ImageButton.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst button_1 = __webpack_require__(/*! ./button */ \"./src/components/actionBar/button.ts\");\r\nconst xingzhuang_tupian_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/xingzhuang-tupian.svg */ \"./src/assets/icons/xingzhuang-tupian.svg\"));\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst globalImageEditor_1 = __webpack_require__(/*! ../globalImageEditor */ \"./src/components/globalImageEditor/index.ts\");\r\nfunction createImageButton() {\r\n    var btn = button_1.createButton(xingzhuang_tupian_svg_1.default, lang_1.TEXT.EDIT_IMAGES);\r\n    btn.onclick = globalImageEditor_1.createGlobalImageEditor;\r\n    return btn;\r\n}\r\nexports.createImageButton = createImageButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/ImageButton.ts?");

/***/ }),

/***/ "./src/components/actionBar/Notice.ts":
/*!********************************************!*\
  !*** ./src/components/actionBar/Notice.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createNotice() {\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_action_bar_notice\");\r\n    let notice = el;\r\n    notice.setCount = (count) => {\r\n        notice.innerHTML = count + \"\";\r\n        notice.style.visibility = count > 0 ? \"visible\" : \"hidden\";\r\n    };\r\n    return notice;\r\n}\r\nexports.createNotice = createNotice;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/Notice.ts?");

/***/ }),

/***/ "./src/components/actionBar/button.ts":
/*!********************************************!*\
  !*** ./src/components/actionBar/button.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createButton(icon, title) {\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_action_bar_btn\");\r\n    el.title = title;\r\n    el.style.backgroundImage = `url(${icon})`;\r\n    let btn = el;\r\n    btn.changeIcon = e => (el.style.backgroundImage = `url(${e})`);\r\n    return btn;\r\n}\r\nexports.createButton = createButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/button.ts?");

/***/ }),

/***/ "./src/components/actionBar/container.ts":
/*!***********************************************!*\
  !*** ./src/components/actionBar/container.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createContainer() {\r\n    let container = element_1.createDiv();\r\n    container.style.position = \"fixed\";\r\n    container.style.width = \"60px\";\r\n    container.style.top = \"60px\";\r\n    container.style.right = \"60px\";\r\n    container.style.zIndex = constants_1.STANDARD_Z_INDEX + \"\";\r\n    context_1.default.editableEvent.addEventListener(e => {\r\n        container.style.display = e ? \"none\" : \"block\";\r\n    });\r\n    return container;\r\n}\r\nexports.createContainer = createContainer;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/container.ts?");

/***/ }),

/***/ "./src/components/actionBar/index.ts":
/*!*******************************************!*\
  !*** ./src/components/actionBar/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst container_1 = __webpack_require__(/*! ./container */ \"./src/components/actionBar/container.ts\");\r\nconst moveButton_1 = __webpack_require__(/*! ./moveButton */ \"./src/components/actionBar/moveButton.ts\");\r\nconst previousButton_1 = __webpack_require__(/*! ./previousButton */ \"./src/components/actionBar/previousButton.ts\");\r\nconst nextButton_1 = __webpack_require__(/*! ./nextButton */ \"./src/components/actionBar/nextButton.ts\");\r\nconst saveButton_1 = __webpack_require__(/*! ./saveButton */ \"./src/components/actionBar/saveButton.ts\");\r\nconst ImageButton_1 = __webpack_require__(/*! ./ImageButton */ \"./src/components/actionBar/ImageButton.ts\");\r\nconst linkButton_1 = __webpack_require__(/*! ./linkButton */ \"./src/components/actionBar/linkButton.ts\");\r\nfunction createActionBar() {\r\n    let container = container_1.createContainer();\r\n    container.appendChild(moveButton_1.createMoveButton(container));\r\n    container.appendChild(ImageButton_1.createImageButton());\r\n    container.appendChild(linkButton_1.createLinkButton());\r\n    container.appendChild(previousButton_1.createPreviousButton());\r\n    container.appendChild(nextButton_1.createNextButton());\r\n    container.appendChild(saveButton_1.createSaveButton());\r\n    return container;\r\n}\r\nexports.createActionBar = createActionBar;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/index.ts?");

/***/ }),

/***/ "./src/components/actionBar/linkButton.ts":
/*!************************************************!*\
  !*** ./src/components/actionBar/linkButton.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst button_1 = __webpack_require__(/*! ./button */ \"./src/components/actionBar/button.ts\");\r\nconst charulianjie_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/charulianjie.svg */ \"./src/assets/icons/charulianjie.svg\"));\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst globalLinkEditor_1 = __webpack_require__(/*! ../globalLinkEditor */ \"./src/components/globalLinkEditor/index.ts\");\r\nfunction createLinkButton() {\r\n    var btn = button_1.createButton(charulianjie_svg_1.default, lang_1.TEXT.EDIT_LINKS);\r\n    btn.onclick = globalLinkEditor_1.createGlobalLinkEditor;\r\n    return btn;\r\n}\r\nexports.createLinkButton = createLinkButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/linkButton.ts?");

/***/ }),

/***/ "./src/components/actionBar/moveButton.ts":
/*!************************************************!*\
  !*** ./src/components/actionBar/moveButton.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst button_1 = __webpack_require__(/*! ./button */ \"./src/components/actionBar/button.ts\");\r\nconst drag_move__fill_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/drag-move--fill.svg */ \"./src/assets/icons/drag-move--fill.svg\"));\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nfunction createMoveButton(container) {\r\n    var btn = button_1.createButton(drag_move__fill_svg_1.default, lang_1.TEXT.MOVE);\r\n    btn.draggable = true;\r\n    btn.style.cursor = \"move\";\r\n    btn.ondrag = e => {\r\n        if (e.x == 0 || e.y == 0)\r\n            return;\r\n        container.style.top = e.y - 25 + \"px\";\r\n        container.style.left = e.x - 25 + \"px\";\r\n    };\r\n    return btn;\r\n}\r\nexports.createMoveButton = createMoveButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/moveButton.ts?");

/***/ }),

/***/ "./src/components/actionBar/nextButton.ts":
/*!************************************************!*\
  !*** ./src/components/actionBar/nextButton.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst button_1 = __webpack_require__(/*! ./button */ \"./src/components/actionBar/button.ts\");\r\nconst xiayibu_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/xiayibu.svg */ \"./src/assets/icons/xiayibu.svg\"));\r\nconst xiayibu_enable_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/xiayibu_enable.svg */ \"./src/assets/icons/xiayibu_enable.svg\"));\r\nconst Notice_1 = __webpack_require__(/*! ./Notice */ \"./src/components/actionBar/Notice.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nfunction createNextButton() {\r\n    var nextBtn = button_1.createButton(xiayibu_svg_1.default, lang_1.TEXT.NEXT);\r\n    nextBtn.onclick = () => context_1.default.operationManager.next();\r\n    var nextNotice = Notice_1.createNotice();\r\n    nextBtn.appendChild(nextNotice);\r\n    context_1.default.operationEvent.addEventListener(e => {\r\n        nextNotice.setCount(e.backupOperationCount);\r\n        nextBtn.changeIcon(e.backupOperationCount > 0 ? xiayibu_enable_svg_1.default : xiayibu_svg_1.default);\r\n    });\r\n    return nextBtn;\r\n}\r\nexports.createNextButton = createNextButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/nextButton.ts?");

/***/ }),

/***/ "./src/components/actionBar/previousButton.ts":
/*!****************************************************!*\
  !*** ./src/components/actionBar/previousButton.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst button_1 = __webpack_require__(/*! ./button */ \"./src/components/actionBar/button.ts\");\r\nconst shangyibu_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/shangyibu.svg */ \"./src/assets/icons/shangyibu.svg\"));\r\nconst shangyibu_enable_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/shangyibu_enable.svg */ \"./src/assets/icons/shangyibu_enable.svg\"));\r\nconst Notice_1 = __webpack_require__(/*! ./Notice */ \"./src/components/actionBar/Notice.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nfunction createPreviousButton() {\r\n    var preBtn = button_1.createButton(shangyibu_svg_1.default, lang_1.TEXT.PREVIOUS);\r\n    preBtn.onclick = () => context_1.default.operationManager.previous();\r\n    var preNotice = Notice_1.createNotice();\r\n    preBtn.appendChild(preNotice);\r\n    context_1.default.operationEvent.addEventListener(e => {\r\n        preNotice.setCount(e.operationCount);\r\n        preBtn.changeIcon(e.operationCount > 0 ? shangyibu_enable_svg_1.default : shangyibu_svg_1.default);\r\n    });\r\n    return preBtn;\r\n}\r\nexports.createPreviousButton = createPreviousButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/previousButton.ts?");

/***/ }),

/***/ "./src/components/actionBar/saveButton.ts":
/*!************************************************!*\
  !*** ./src/components/actionBar/saveButton.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst baocun_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/baocun.svg */ \"./src/assets/icons/baocun.svg\"));\r\nconst baocun_enable_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/baocun_enable.svg */ \"./src/assets/icons/baocun_enable.svg\"));\r\nconst button_1 = __webpack_require__(/*! ./button */ \"./src/components/actionBar/button.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst updateOperation_1 = __importDefault(__webpack_require__(/*! @/api/updateOperation */ \"./src/api/updateOperation.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nfunction createSaveButton() {\r\n    var saveBtn = button_1.createButton(baocun_svg_1.default, lang_1.TEXT.SAVE);\r\n    context_1.default.operationEvent.addEventListener(e => {\r\n        saveBtn.changeIcon(e.operationCount > 0 ? baocun_enable_svg_1.default : baocun_svg_1.default);\r\n    });\r\n    saveBtn.onclick = () => __awaiter(this, void 0, void 0, function* () {\r\n        let logs = [];\r\n        for (const iterator of context_1.default.operationManager.previousRecords) {\r\n            logs.push(...iterator.logs);\r\n        }\r\n        if (logs.length == 0)\r\n            return;\r\n        try {\r\n            console.log(logs);\r\n            yield updateOperation_1.default(logs);\r\n            utils_1.reload();\r\n        }\r\n        catch (error) {\r\n            alert(\"save error!\");\r\n        }\r\n    });\r\n    return saveBtn;\r\n}\r\nexports.createSaveButton = createSaveButton;\r\n\n\n//# sourceURL=webpack:///./src/components/actionBar/saveButton.ts?");

/***/ }),

/***/ "./src/components/colorEditor/colorEditItem.ts":
/*!*****************************************************!*\
  !*** ./src/components/colorEditor/colorEditItem.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst StyleLog_1 = __webpack_require__(/*! @/operation/recordLogs/StyleLog */ \"./src/operation/recordLogs/StyleLog.ts\");\r\nconst colorPicker_1 = __webpack_require__(/*! ../common/colorPicker */ \"./src/components/common/colorPicker.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nfunction createColorEditItem(colorGroup, el, comment, koobooId) {\r\n    let container = element_1.createDiv();\r\n    container.style.display = \"flex\";\r\n    container.style.alignItems = \"center\";\r\n    container.style.height = \"38px\";\r\n    let colorTextSpan = document.createElement(\"span\");\r\n    colorTextSpan.style.width = \"160px\";\r\n    let inlineCssLog;\r\n    let classCssLog;\r\n    let firstCssColor = colorGroup.cssColors[0];\r\n    let isGlobalUpdate = !firstCssColor.inline;\r\n    let inlineCssColor = colorGroup.cssColors.find(f => f.inline);\r\n    let classCssColor = colorGroup.cssColors.find(f => !f.inline);\r\n    let updateColor = inlineCssColor || firstCssColor;\r\n    colorTextSpan.innerText = firstCssColor.prop.getColor(firstCssColor.value);\r\n    let picker = colorPicker_1.createColorPicker(colorGroup.prop + colorGroup.pseudo, firstCssColor.prop.getColor(firstCssColor.value), s => {\r\n        colorTextSpan.innerText = toInt(s);\r\n        if (isGlobalUpdate) {\r\n            if (!classCssColor)\r\n                return;\r\n            let value = updateClassCss(classCssColor, s);\r\n            classCssLog = StyleLog_1.StyleLog.createCssUpdate(value, classCssColor.prop.prop, classCssColor.rawSelector, classCssColor.koobooId, classCssColor.url, !!classCssColor.newImportant);\r\n        }\r\n        else {\r\n            let value = updateInlineCss(updateColor, s, el);\r\n            inlineCssLog = StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, value, updateColor.prop.prop, koobooId);\r\n        }\r\n    });\r\n    picker.style.width = \"200px\";\r\n    picker.style.justifyContent = \"flex-end\";\r\n    container.appendChild(picker);\r\n    container.appendChild(colorTextSpan);\r\n    const onChecked = (checked) => {\r\n        if (!classCssColor)\r\n            return;\r\n        if (checked) {\r\n            let value = el.style.getPropertyValue(updateColor.prop.prop);\r\n            value = updateColor.prop.getColor(value);\r\n            updateClassCss(classCssColor, value);\r\n            el.style.removeProperty(updateColor.prop.prop);\r\n            inlineCssLog = StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, \"\", updateColor.prop.prop, koobooId);\r\n            classCssLog = StyleLog_1.StyleLog.createCssUpdate(value, classCssColor.prop.prop, classCssColor.rawSelector, classCssColor.koobooId, classCssColor.url, !!classCssColor.newImportant);\r\n            isGlobalUpdate = true;\r\n        }\r\n        else {\r\n            let important = classCssColor.cssStyleRule.style.getPropertyPriority(classCssColor.prop.prop);\r\n            let value = classCssColor.cssStyleRule.style.getPropertyValue(classCssColor.prop.prop);\r\n            value = classCssColor.prop.getColor(value);\r\n            value = updateColor.prop.replaceColor(updateColor.value, value);\r\n            el.style.setProperty(updateColor.prop.prop, value, important);\r\n            classCssColor.cssStyleRule.style.setProperty(classCssColor.prop.prop, classCssColor.value, classCssColor.important ? \"important\" : \"\");\r\n            classCssColor.newValue = undefined;\r\n            classCssColor.newImportant = undefined;\r\n            classCssLog = undefined;\r\n            inlineCssLog = StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, value, updateColor.prop.prop, koobooId);\r\n            isGlobalUpdate = false;\r\n        }\r\n    };\r\n    let { checkbox } = element_1.createCheckboxInput(lang_1.TEXT.GLOBAL_UPDATE, !firstCssColor.inline, onChecked);\r\n    if (!classCssColor || colorGroup.pseudo) {\r\n        checkbox.style.display = \"none\";\r\n    }\r\n    container.appendChild(checkbox);\r\n    const getLogs = () => {\r\n        let logs = [];\r\n        if (inlineCssLog)\r\n            logs.push(inlineCssLog);\r\n        if (classCssLog)\r\n            logs.push(classCssLog);\r\n        return logs;\r\n    };\r\n    return {\r\n        item: container,\r\n        getLogs\r\n    };\r\n}\r\nexports.createColorEditItem = createColorEditItem;\r\nfunction updateClassCss(classCssColor, color) {\r\n    let important = classCssColor.cssStyleRule.style.getPropertyPriority(classCssColor.prop.prop);\r\n    let value = classCssColor.prop.replaceColor(classCssColor.value, color);\r\n    classCssColor.cssStyleRule.style.setProperty(classCssColor.prop.prop, value, important);\r\n    classCssColor.newValue = value;\r\n    classCssColor.newImportant = important;\r\n    return value;\r\n}\r\nfunction updateInlineCss(inlineCssColor, color, el) {\r\n    let value = el.style.getPropertyValue(inlineCssColor.prop.prop);\r\n    let important = el.style.getPropertyPriority(inlineCssColor.prop.prop);\r\n    value = inlineCssColor.prop.replaceColor(value, color);\r\n    el.style.setProperty(inlineCssColor.prop.prop, value, important);\r\n    return value;\r\n}\r\nfunction toInt(color) {\r\n    return color.replace(/\\..*?,/g, \",\");\r\n}\r\n\n\n//# sourceURL=webpack:///./src/components/colorEditor/colorEditItem.ts?");

/***/ }),

/***/ "./src/components/colorEditor/index.ts":
/*!*********************************************!*\
  !*** ./src/components/colorEditor/index.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! ../modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst style_1 = __webpack_require__(/*! @/dom/style */ \"./src/dom/style.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst CssUnit_1 = __webpack_require__(/*! @/operation/recordUnits/CssUnit */ \"./src/operation/recordUnits/CssUnit.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst colorEditItem_1 = __webpack_require__(/*! ./colorEditItem */ \"./src/components/colorEditor/colorEditItem.ts\");\r\nfunction createColorEditor(el, comment, koobooId) {\r\n    var startStyle = el.getAttribute(\"style\");\r\n    var groups = style_1.getMatchedColorGroups(el);\r\n    let container = element_1.createDiv();\r\n    let logGetters = [];\r\n    for (const i of groups) {\r\n        let { item, getLogs } = colorEditItem_1.createColorEditItem(i, el, comment, koobooId);\r\n        logGetters.push(getLogs);\r\n        container.appendChild(item);\r\n    }\r\n    const getUnits = () => [new attributeUnit_1.AttributeUnit(startStyle || \"\", \"style\"), new CssUnit_1.CssUnit(\"\", groups)];\r\n    let { modal, close, setCancelHandler, setOkHandler } = modal_1.createModal(lang_1.TEXT.EDIT_COLOR, container, \"600px\");\r\n    setCancelHandler(() => {\r\n        getUnits().map(m => m.undo(el));\r\n        close();\r\n    });\r\n    setOkHandler(() => {\r\n        let guid = utils_1.setGuid(el);\r\n        let logs = [];\r\n        for (const i of logGetters) {\r\n            logs.push(...i());\r\n        }\r\n        let operation = new Record_1.operationRecord(getUnits(), logs, guid);\r\n        context_1.default.operationManager.add(operation);\r\n        close();\r\n    });\r\n    context_1.default.container.appendChild(modal);\r\n}\r\nexports.createColorEditor = createColorEditor;\r\n\n\n//# sourceURL=webpack:///./src/components/colorEditor/index.ts?");

/***/ }),

/***/ "./src/components/common/colorPicker.ts":
/*!**********************************************!*\
  !*** ./src/components/common/colorPicker.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst color_string_1 = __importDefault(__webpack_require__(/*! color-string */ \"./node_modules/color-string/index.js\"));\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst pickr_1 = __importDefault(__webpack_require__(/*! @simonwep/pickr */ \"./node_modules/@simonwep/pickr/dist/pickr.min.js\"));\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createColorPicker(text, old, onsave) {\r\n    old = color_string_1.default.to.hex(color_string_1.default.get(old).value);\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_color_picker\");\r\n    let label = element_1.createDiv();\r\n    label.innerText = text;\r\n    el.appendChild(label);\r\n    let picker = element_1.createDiv();\r\n    el.appendChild(picker);\r\n    setTimeout(() => {\r\n        const pickr = new pickr_1.default({\r\n            el: picker,\r\n            theme: \"nano\",\r\n            default: old,\r\n            components: {\r\n                preview: true,\r\n                opacity: true,\r\n                hue: true,\r\n                interaction: {\r\n                    cancel: true,\r\n                    save: true\r\n                }\r\n            },\r\n            strings: {\r\n                save: lang_1.TEXT.OK,\r\n                cancel: lang_1.TEXT.CANCEL\r\n            }\r\n        });\r\n        pickr.on(\"init\", (e) => {\r\n            let app = e._root.app;\r\n            let button = e._root.button;\r\n            app.style.zIndex = constants_1.STANDARD_Z_INDEX + 5 + \"\";\r\n            context_1.default.container.appendChild(app);\r\n            button.style.border = \"1px solid #ccc\";\r\n        });\r\n        pickr.on(\"save\", (e) => {\r\n            let c = e.toRGBA();\r\n            onsave(`rgba(${c[0]},${c[1]},${c[2]},${c[3]})`);\r\n        });\r\n    });\r\n    return el;\r\n}\r\nexports.createColorPicker = createColorPicker;\r\n\n\n//# sourceURL=webpack:///./src/components/common/colorPicker.ts?");

/***/ }),

/***/ "./src/components/common/imagePreview.ts":
/*!***********************************************!*\
  !*** ./src/components/common/imagePreview.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst transparent_png_1 = __importDefault(__webpack_require__(/*! @/assets/img/transparent.png */ \"./src/assets/img/transparent.png\"));\r\nfunction createImagePreview(showDeleteBtn = false, onDelete) {\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_image_preview\");\r\n    el.style.backgroundImage = `url(${transparent_png_1.default})`;\r\n    let preview = element_1.createDiv();\r\n    el.appendChild(preview);\r\n    let button = element_1.createButton(lang_1.TEXT.DELETE);\r\n    button.style.visibility = showDeleteBtn ? \"visible\" : \"hidden\";\r\n    el.appendChild(button);\r\n    button.onclick = e => {\r\n        preview.style.backgroundImage = \"\";\r\n        if (onDelete)\r\n            onDelete();\r\n        e.stopPropagation();\r\n    };\r\n    const setImage = (src) => {\r\n        if (src.indexOf(\"url(\") > -1)\r\n            preview.style.backgroundImage = src;\r\n        else\r\n            preview.style.backgroundImage = `url('${src}')`;\r\n    };\r\n    return {\r\n        imagePreview: el,\r\n        setImage\r\n    };\r\n}\r\nexports.createImagePreview = createImagePreview;\r\n\n\n//# sourceURL=webpack:///./src/components/common/imagePreview.ts?");

/***/ }),

/***/ "./src/components/common/tabs.ts":
/*!***************************************!*\
  !*** ./src/components/common/tabs.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst border = \"2px solid rgb(32, 122, 183)\";\r\nfunction createTabs(options) {\r\n    let el = element_1.createDiv();\r\n    let bar = element_1.createDiv();\r\n    bar.style.marginBottom = \"15px\";\r\n    let body = element_1.createDiv();\r\n    options.forEach(i => {\r\n        let tab = createTab(i.title);\r\n        tab.style.width = 100 / options.length + \"%\";\r\n        tab.style.borderBottom = i.selected ? border : \"'\";\r\n        i.panel.style.display = i.selected ? \"block\" : \"none\";\r\n        tab.onclick = () => {\r\n            switchTab(bar, tab);\r\n            switchPanel(body, i.panel);\r\n            options.forEach(o => (o.selected = o == i));\r\n        };\r\n        bar.appendChild(tab);\r\n        body.appendChild(i.panel);\r\n    });\r\n    el.appendChild(bar);\r\n    el.appendChild(body);\r\n    return el;\r\n}\r\nexports.createTabs = createTabs;\r\nfunction switchTab(bar, tab) {\r\n    for (let j = 0; j < bar.children.length; j++) {\r\n        let element = bar.children.item(j);\r\n        element.style.borderBottom = element == tab ? border : \"\";\r\n    }\r\n}\r\nfunction switchPanel(body, panel) {\r\n    for (let k = 0; k < body.children.length; k++) {\r\n        let element = body.children.item(k);\r\n        element.style.display = element == panel ? \"block\" : \"none\";\r\n    }\r\n}\r\nfunction createTab(label) {\r\n    let el = element_1.createDiv();\r\n    el.style.height = \"32px\";\r\n    el.style.textAlign = \"center\";\r\n    el.innerText = label;\r\n    el.style.display = \"inline-block\";\r\n    el.style.fontSize = \"15px\";\r\n    el.style.cursor = \"pointer\";\r\n    return el;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/components/common/tabs.ts?");

/***/ }),

/***/ "./src/components/editorShade/block.ts":
/*!*********************************************!*\
  !*** ./src/components/editorShade/block.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst Position_1 = __webpack_require__(/*! @/common/Position */ \"./src/common/Position.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nexports.createBlock = () => {\r\n    const el = element_1.createDiv();\r\n    applyStyle(el.style);\r\n    el.onclick = e => e.stopPropagation();\r\n    const update = (position) => Position_1.updatePositon(position, el);\r\n    return { el, update };\r\n};\r\nconst applyStyle = (css) => {\r\n    css.position = \"fixed\";\r\n    css.display = \"block\";\r\n    css.backgroundColor = constants_1.EDITOR_SHADE_COLOR;\r\n    css.zIndex = constants_1.STANDARD_Z_INDEX + \"\";\r\n    css.cursor = \"not-allowed\";\r\n};\r\n\n\n//# sourceURL=webpack:///./src/components/editorShade/block.ts?");

/***/ }),

/***/ "./src/components/editorShade/index.ts":
/*!*********************************************!*\
  !*** ./src/components/editorShade/index.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst shade_1 = __webpack_require__(/*! ./shade */ \"./src/components/editorShade/shade.ts\");\r\nfunction createEditorShade() {\r\n    let { el, hidden, updatePosition } = shade_1.createShade();\r\n    context_1.default.editableEvent.addEventListener(display => {\r\n        if (!context_1.default.lastSelectedDomEventArgs)\r\n            return;\r\n        if (display) {\r\n            updatePosition(context_1.default.lastSelectedDomEventArgs.element);\r\n        }\r\n        else {\r\n            hidden();\r\n        }\r\n    });\r\n    context_1.default.tinymceInputEvent.addEventListener(() => {\r\n        if (!context_1.default.lastSelectedDomEventArgs)\r\n            return;\r\n        updatePosition(context_1.default.lastSelectedDomEventArgs.element);\r\n    });\r\n    document.addEventListener(\"scroll\", () => {\r\n        if (context_1.default.editing) {\r\n            updatePosition(context_1.default.lastSelectedDomEventArgs.element);\r\n        }\r\n    });\r\n    return el;\r\n}\r\nexports.createEditorShade = createEditorShade;\r\n\n\n//# sourceURL=webpack:///./src/components/editorShade/index.ts?");

/***/ }),

/***/ "./src/components/editorShade/shade.ts":
/*!*********************************************!*\
  !*** ./src/components/editorShade/shade.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst block_1 = __webpack_require__(/*! ./block */ \"./src/components/editorShade/block.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst guanbi_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/guanbi.svg */ \"./src/assets/icons/guanbi.svg\"));\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nexports.createShade = () => {\r\n    const blocks = [block_1.createBlock(), block_1.createBlock(), block_1.createBlock(), block_1.createBlock()];\r\n    const el = element_1.createDiv();\r\n    blocks.forEach(i => el.appendChild(i.el));\r\n    let closeBtn = createCloseBtn();\r\n    el.appendChild(closeBtn);\r\n    const updatePosition = (referenceEl) => {\r\n        el.style.display = \"block\";\r\n        closeBtn.style.display = \"block\";\r\n        let [top, right, bottom, left] = blocks;\r\n        let referenceRect = referenceEl.getBoundingClientRect();\r\n        top.update({\r\n            top: 0,\r\n            left: referenceRect.left,\r\n            width: referenceRect.width,\r\n            height: referenceRect.top < 0 ? 0 : referenceRect.top\r\n        });\r\n        right.update({\r\n            top: 0,\r\n            right: 0,\r\n            left: referenceRect.left + referenceRect.width,\r\n            bottom: 0\r\n        });\r\n        bottom.update({\r\n            top: referenceRect.bottom < 0 ? 0 : referenceRect.bottom,\r\n            left: referenceRect.left,\r\n            width: referenceRect.width,\r\n            bottom: 0\r\n        });\r\n        left.update({\r\n            top: 0,\r\n            left: 0,\r\n            width: referenceRect.left,\r\n            bottom: 0\r\n        });\r\n    };\r\n    const hidden = () => {\r\n        el.style.display = \"none\";\r\n        closeBtn.style.display = \"none\";\r\n    };\r\n    return {\r\n        el,\r\n        updatePosition,\r\n        hidden\r\n    };\r\n};\r\nfunction createCloseBtn() {\r\n    let btn = element_1.createDiv();\r\n    btn.classList.add(\"kb_web_editor_shade_close_btn\");\r\n    btn.style.backgroundImage = `url(${guanbi_svg_1.default})`;\r\n    btn.style.zIndex = constants_1.STANDARD_Z_INDEX + \"\";\r\n    btn.onclick = () => context_1.default.closeEditingEvent.emit();\r\n    return btn;\r\n}\r\n\n\n//# sourceURL=webpack:///./src/components/editorShade/shade.ts?");

/***/ }),

/***/ "./src/components/elementNav/index.ts":
/*!********************************************!*\
  !*** ./src/components/elementNav/index.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst navBar_1 = __webpack_require__(/*! ./navBar */ \"./src/components/elementNav/navBar.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nfunction createElementNav() {\r\n    const { el, update } = navBar_1.createNavBar();\r\n    context_1.default.domChangeEvent.addEventListener(e => {\r\n        let elements = utils_1.getParentElements(e.element);\r\n        update(elements);\r\n    });\r\n    context_1.default.editableEvent.addEventListener(e => {\r\n        if (e)\r\n            el.style.display = \"none\";\r\n    });\r\n    return el;\r\n}\r\nexports.createElementNav = createElementNav;\r\n\n\n//# sourceURL=webpack:///./src/components/elementNav/index.ts?");

/***/ }),

/***/ "./src/components/elementNav/navBar.ts":
/*!*********************************************!*\
  !*** ./src/components/elementNav/navBar.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst events_1 = __webpack_require__(/*! @/dom/events */ \"./src/dom/events.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nfunction createNavBar() {\r\n    const el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_element_nav_bar\");\r\n    el.style.zIndex = constants_1.STANDARD_Z_INDEX + \"\";\r\n    el.draggable = true;\r\n    let temp;\r\n    el.ondragstart = (e) => {\r\n        let rect = el.getBoundingClientRect();\r\n        temp = { x: rect.left + rect.width - e.x, y: e.y - rect.top };\r\n    };\r\n    el.ondrag = e => {\r\n        if (e.x == 0 || e.y == 0)\r\n            return;\r\n        el.style.right = document.documentElement.clientWidth - e.x - temp.x + \"px\";\r\n        el.style.top = e.y - temp.y + \"px\";\r\n    };\r\n    const update = (elements) => {\r\n        el.innerHTML = \"\";\r\n        el.style.display = \"inline-block\";\r\n        for (const i of elements) {\r\n            let item = element_1.createDiv();\r\n            if (i.tagName != \"HTML\") {\r\n                item.onclick = e => {\r\n                    context_1.default.lastMouseEventArg = e;\r\n                    events_1.emitSelectedEvent();\r\n                    e.stopPropagation();\r\n                };\r\n                item.onmouseover = e => {\r\n                    events_1.emitHoverEvent(i);\r\n                    e.stopPropagation();\r\n                };\r\n            }\r\n            item.innerText = i.tagName;\r\n            el.appendChild(item);\r\n            if (i != elements[elements.length - 1])\r\n                el.appendChild(document.createTextNode(\"<\"));\r\n        }\r\n    };\r\n    return { el, update };\r\n}\r\nexports.createNavBar = createNavBar;\r\n\n\n//# sourceURL=webpack:///./src/components/elementNav/navBar.ts?");

/***/ }),

/***/ "./src/components/floatMenu/index.ts":
/*!*******************************************!*\
  !*** ./src/components/floatMenu/index.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/common/utils */ \"./src/common/utils.ts\");\r\nconst menu_1 = __webpack_require__(/*! ./menu */ \"./src/components/floatMenu/menu.ts\");\r\nfunction createFloatMenu() {\r\n    const { container, hidden, update } = menu_1.createMenu();\r\n    container.onmouseenter = () => (context_1.default.floatMenuClosing = false);\r\n    context_1.default.domChangeEvent.addEventListener(e => {\r\n        if (!context_1.default.lastMouseEventArg.isTrusted)\r\n            return;\r\n        context_1.default.floatMenuClosing = false;\r\n        update(context_1.default.lastMouseEventArg.pageX, context_1.default.lastMouseEventArg.pageY);\r\n    });\r\n    context_1.default.hoverDomEvent.addEventListener(() => __awaiter(this, void 0, void 0, function* () {\r\n        context_1.default.floatMenuClosing = true;\r\n        yield utils_1.delay(200);\r\n        if (context_1.default.floatMenuClosing)\r\n            hidden();\r\n    }));\r\n    return container;\r\n}\r\nexports.createFloatMenu = createFloatMenu;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/index.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/BaseMenuItem.ts":
/*!********************************************************!*\
  !*** ./src/components/floatMenu/items/BaseMenuItem.ts ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nclass BaseMenuItem {\r\n    constructor(parentMenu) {\r\n        this.parentMenu = parentMenu;\r\n    }\r\n    createItem(text) {\r\n        let el = element_1.createDiv();\r\n        el.classList.add(\"kb_web_editor_menu_item\");\r\n        el.append(text);\r\n        let warn;\r\n        const setVisiable = (visiable) => {\r\n            el.style.display = visiable ? \"block\" : \"none\";\r\n        };\r\n        const setReadonly = (readonly) => {\r\n            if (!warn)\r\n                warn = this.createWarn();\r\n            if (readonly) {\r\n                el.style.color = \"#ccc\";\r\n                el.style.pointerEvents = \"none\";\r\n                el.appendChild(warn);\r\n            }\r\n            else {\r\n                el.style.removeProperty(\"color\");\r\n                el.style.removeProperty(\"pointer-events\");\r\n                if (el.contains(warn))\r\n                    el.removeChild(warn);\r\n            }\r\n        };\r\n        return {\r\n            el,\r\n            setVisiable,\r\n            setReadonly\r\n        };\r\n    }\r\n    createWarn() {\r\n        let el = element_1.createDiv();\r\n        el.innerText = \"!\";\r\n        el.style.display = \"inline-block\";\r\n        el.style.width = \"18px\";\r\n        el.style.height = \"18px\";\r\n        el.style.color = \"#fff\";\r\n        el.style.backgroundColor = \"rgba(252, 56, 56, 0.74)\";\r\n        el.style.textAlign = \"center\";\r\n        el.style.fontSize = \"15px\";\r\n        el.style.fontWeight = \"600\";\r\n        el.style.lineHeight = \"18px\";\r\n        el.style.borderRadius = \"9px\";\r\n        el.style.cssFloat = \"right\";\r\n        el.style.pointerEvents = \"painted\";\r\n        el.title = lang_1.TEXT.PLEASE_EDIT_AFTER_SAVE;\r\n        el.onclick = e => {\r\n            e.stopPropagation();\r\n        };\r\n        return el;\r\n    }\r\n}\r\nexports.default = BaseMenuItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/BaseMenuItem.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/click.ts":
/*!*************************************************!*\
  !*** ./src/components/floatMenu/items/click.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass ClickItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.CLICK);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n    }\r\n    click() {\r\n        let element = context_1.default.lastHoverDomEventArgs.element;\r\n        this.parentMenu.hidden();\r\n        if (element._a)\r\n            element._a.click();\r\n        else\r\n            element.click();\r\n    }\r\n}\r\nexports.default = ClickItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/click.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/copy.ts":
/*!************************************************!*\
  !*** ./src/components/floatMenu/items/copy.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst CopyUnit_1 = __webpack_require__(/*! @/operation/recordUnits/CopyUnit */ \"./src/operation/recordUnits/CopyUnit.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass CopyItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.COPY);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_2.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_1.getRelatedRepeatComment(args.element))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        let { koobooId, parent } = utils_1.getCleanParent(args.element);\r\n        if (!parent && !koobooId)\r\n            return this.setVisiable(false);\r\n        if (utils_3.isBody(args.element))\r\n            return this.setVisiable(false);\r\n        if (parent && utils_1.isDynamicContent(parent))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let { koobooId, parent } = utils_1.getCleanParent(args.element);\r\n        let cloneElement = args.element.cloneNode(true);\r\n        let guid = utils_1.setGuid(cloneElement, outsideInterfaces_1.newGuid());\r\n        args.element.parentElement.insertBefore(cloneElement, args.element.nextSibling);\r\n        utils_1.markDirty(parent);\r\n        let value = utils_1.clearKoobooInfo(parent.innerHTML);\r\n        let units = [new CopyUnit_1.CopyUnit(utils_1.getGuidComment(guid))];\r\n        let comment = utils_2.getEditComment(comments);\r\n        let log = DomLog_1.DomLog.createUpdate(comment.nameorid, value, koobooId, comment.objecttype);\r\n        let operation = new Record_1.operationRecord(units, [log], guid);\r\n        context_1.default.operationManager.add(operation);\r\n    }\r\n}\r\nexports.default = CopyItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/copy.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/copyRepeat.ts":
/*!******************************************************!*\
  !*** ./src/components/floatMenu/items/copyRepeat.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst CopyRepeatUnit_1 = __webpack_require__(/*! @/operation/recordUnits/CopyRepeatUnit */ \"./src/operation/recordUnits/CopyRepeatUnit.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass CopyRepeatItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.COPY_REPEAT);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_1.isBody(args.element))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let { nodes } = utils_3.getWrapDom(args.element, constants_1.OBJECT_TYPE.contentrepeater);\r\n        if (!nodes || nodes.length == 0)\r\n            return;\r\n        let anchor = nodes[nodes.length - 1];\r\n        let parent = anchor.parentNode;\r\n        let guid = outsideInterfaces_1.newGuid() + \"_name\";\r\n        let oldGuid = utils_2.getRepeatComment(comments).nameorid;\r\n        for (const node of nodes.reverse()) {\r\n            let insertNode = node.cloneNode(true);\r\n            utils_2.changeNameOrId(insertNode, guid, oldGuid);\r\n            parent.insertBefore(insertNode, anchor.nextSibling);\r\n        }\r\n        let comment = utils_2.getRepeatComment(comments);\r\n        let units = [new CopyRepeatUnit_1.CopyRepeatUnit(utils_3.getGuidComment(guid))];\r\n        let logs = [ContentLog_1.ContentLog.createCopy(guid, comment.nameorid)];\r\n        let operation = new Record_1.operationRecord(units, logs, guid);\r\n        context_1.default.operationManager.add(operation);\r\n    }\r\n}\r\nexports.default = CopyRepeatItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/copyRepeat.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/delete.ts":
/*!**************************************************!*\
  !*** ./src/components/floatMenu/items/delete.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst DeleteUnit_1 = __webpack_require__(/*! @/operation/recordUnits/DeleteUnit */ \"./src/operation/recordUnits/DeleteUnit.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst utils_3 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass DeleteItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.DELETE);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        let { parent } = utils_1.getCleanParent(args.element);\r\n        if (!args.koobooId)\r\n            return this.setVisiable(false);\r\n        let comment = utils_3.getViewComment(comments);\r\n        if (!comment)\r\n            return this.setVisiable(false);\r\n        if (utils_3.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_1.getRelatedRepeatComment(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_1.isDirty(args.element) && parent && utils_1.isDynamicContent(parent))\r\n            return this.setVisiable(false);\r\n        if (utils_2.isBody(args.element))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let { koobooId, parent } = utils_1.getCleanParent(args.element);\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let comment = utils_3.getViewComment(comments);\r\n        let guid = utils_1.setGuid(args.element);\r\n        let guidComment = utils_1.getGuidComment(guid);\r\n        let startContent = args.element.outerHTML;\r\n        let parentElement = args.element.parentElement;\r\n        let temp = element_1.createDiv();\r\n        args.element.parentNode.replaceChild(temp, args.element);\r\n        temp.outerHTML = guidComment;\r\n        let log;\r\n        if (utils_1.isDirty(args.element) && parent) {\r\n            utils_1.markDirty(parent);\r\n            log = DomLog_1.DomLog.createUpdate(comment.nameorid, utils_1.clearKoobooInfo(parent.innerHTML), koobooId, comment.objecttype);\r\n        }\r\n        else {\r\n            if (parentElement)\r\n                utils_1.markDirty(parentElement);\r\n            log = DomLog_1.DomLog.createDelete(comment.nameorid, args.koobooId, comment.objecttype);\r\n        }\r\n        let operation = new Record_1.operationRecord([new DeleteUnit_1.DeleteUnit(startContent)], [log], guid);\r\n        context_1.default.operationManager.add(operation);\r\n    }\r\n}\r\nexports.default = DeleteItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/delete.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/deleteHtmlBlock.ts":
/*!***********************************************************!*\
  !*** ./src/components/floatMenu/items/deleteHtmlBlock.ts ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst DeleteUnit_1 = __webpack_require__(/*! @/operation/recordUnits/DeleteUnit */ \"./src/operation/recordUnits/DeleteUnit.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst HtmlblockLog_1 = __webpack_require__(/*! @/operation/recordLogs/HtmlblockLog */ \"./src/operation/recordLogs/HtmlblockLog.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass DeleteHtmlBlockItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.DELETE);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        if (!utils_2.getHtmlBlockComment(comments))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let guid = utils_1.setGuid(args.element);\r\n        let guidComment = utils_1.getGuidComment(guid);\r\n        let startContent = args.element.outerHTML;\r\n        let { nodes } = utils_1.getWrapDom(args.element, constants_1.OBJECT_TYPE.htmlblock);\r\n        let temp = element_1.createDiv();\r\n        args.element.parentNode.replaceChild(temp, args.element);\r\n        temp.outerHTML = guidComment;\r\n        let log;\r\n        let htmlblockComment = utils_2.getHtmlBlockComment(comments);\r\n        nodes = nodes.filter(f => f != args.element);\r\n        if (nodes.some(s => s instanceof HTMLElement)) {\r\n            let temp = element_1.createDiv();\r\n            nodes.forEach(i => temp.appendChild(i.cloneNode(true)));\r\n            log = HtmlblockLog_1.HtmlblockLog.createUpdate(htmlblockComment.nameorid, utils_1.clearKoobooInfo(temp.innerHTML));\r\n        }\r\n        else {\r\n            log = HtmlblockLog_1.HtmlblockLog.createDelete(htmlblockComment.nameorid);\r\n        }\r\n        let operation = new Record_1.operationRecord([new DeleteUnit_1.DeleteUnit(startContent)], [log], guid);\r\n        context_1.default.operationManager.add(operation);\r\n    }\r\n}\r\nexports.default = DeleteHtmlBlockItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/deleteHtmlBlock.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/deleteRepeat.ts":
/*!********************************************************!*\
  !*** ./src/components/floatMenu/items/deleteRepeat.ts ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst DeleteRepeatUnit_1 = __webpack_require__(/*! @/operation/recordUnits/DeleteRepeatUnit */ \"./src/operation/recordUnits/DeleteRepeatUnit.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass DeleteRepeatItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.DELETE_REPEAR);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_1.isBody(args.element))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let { nodes, startNode } = utils_3.getWrapDom(args.element, constants_1.OBJECT_TYPE.contentrepeater);\r\n        if (!nodes || nodes.length == 0 || !startNode)\r\n            return;\r\n        let comment = new KoobooComment_1.KoobooComment(startNode);\r\n        let guid = comment.nameorid;\r\n        let guidComment = utils_3.getGuidComment(guid);\r\n        let temp = element_1.createDiv();\r\n        startNode.parentNode.insertBefore(temp, startNode);\r\n        nodes.forEach(i => temp.appendChild(i));\r\n        let oldValue = temp.innerHTML;\r\n        temp.outerHTML = guidComment;\r\n        let units = [new DeleteRepeatUnit_1.DeleteRepeatUnit(oldValue)];\r\n        let logs = [ContentLog_1.ContentLog.createDelete(guid)];\r\n        let operation = new Record_1.operationRecord(units, logs, guid);\r\n        context_1.default.operationManager.add(operation);\r\n    }\r\n}\r\nexports.default = DeleteRepeatItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/deleteRepeat.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/edit.ts":
/*!************************************************!*\
  !*** ./src/components/floatMenu/items/edit.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst richEditor_1 = __webpack_require__(/*! @/components/richEditor */ \"./src/components/richEditor/index.ts\");\r\nconst utils_3 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst InnerHtmlUnit_1 = __webpack_require__(/*! @/operation/recordUnits/InnerHtmlUnit */ \"./src/operation/recordUnits/InnerHtmlUnit.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst LabelLog_1 = __webpack_require__(/*! @/operation/recordLogs/LabelLog */ \"./src/operation/recordLogs/LabelLog.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_2.isBody(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_3.getMenuComment(comments))\r\n            return this.setVisiable(false);\r\n        if (!utils_3.getEditComment(comments))\r\n            return this.setVisiable(false);\r\n        if (!args.koobooId)\r\n            return this.setVisiable(false);\r\n        var reExcept = /^(img|button|input|textarea|hr|area|canvas|meter|progress|select|tr|td|tbody|thead|tfoot|th|table)$/i;\r\n        let el = args.element;\r\n        if (reExcept.test(el.tagName))\r\n            return this.setVisiable(false);\r\n        if (utils_1.isDynamicContent(args.element))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let { element, koobooId } = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let startContent = element.innerHTML;\r\n        const onSave = () => {\r\n            if (utils_3.clearContent(startContent) == utils_3.clearContent(element.innerHTML))\r\n                return;\r\n            let { koobooId: parentKoobooId, parent } = utils_1.getCleanParent(element);\r\n            let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n            let dirtyEl = parent && utils_1.isDirty(element) ? parent : element;\r\n            utils_1.markDirty(dirtyEl);\r\n            koobooId = parentKoobooId && utils_1.isDirty(element) ? parentKoobooId : koobooId;\r\n            let guid = utils_1.setGuid(element);\r\n            let units = [new InnerHtmlUnit_1.InnerHtmlUnit(startContent)];\r\n            let comment = utils_3.getEditComment(comments);\r\n            let log;\r\n            if (comment.objecttype == constants_1.OBJECT_TYPE.content) {\r\n                log = ContentLog_1.ContentLog.createUpdate(comment.nameorid, comment.fieldname, utils_1.clearKoobooInfo(element.innerHTML));\r\n            }\r\n            else if (comment.objecttype == constants_1.OBJECT_TYPE.Label) {\r\n                log = LabelLog_1.LabelLog.createUpdate(comment.bindingvalue, utils_1.clearKoobooInfo(element.innerHTML));\r\n            }\r\n            else {\r\n                log = DomLog_1.DomLog.createUpdate(comment.nameorid, utils_1.clearKoobooInfo(dirtyEl.innerHTML), koobooId, comment.objecttype);\r\n            }\r\n            let operation = new Record_1.operationRecord(units, [log], guid);\r\n            context_1.default.operationManager.add(operation);\r\n        };\r\n        const onCancel = () => {\r\n            element.innerHTML = startContent;\r\n        };\r\n        richEditor_1.setInlineEditor({ selector: element, onSave, onCancel });\r\n    }\r\n}\r\nexports.default = EditItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/edit.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editColor.ts":
/*!*****************************************************!*\
  !*** ./src/components/floatMenu/items/editColor.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst utils_1 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst colorEditor_1 = __webpack_require__(/*! @/components/colorEditor */ \"./src/components/colorEditor/index.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nclass EditColorItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable, setReadonly } = this.createItem(lang_1.TEXT.EDIT_COLOR);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n        this.setReadonly = setReadonly;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.setReadonly(utils_2.isDirty(args.element));\r\n        if (!utils_1.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        if (!args.koobooId)\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n            colorEditor_1.createColorEditor(args.element, utils_1.getViewComment(comments), args.koobooId);\r\n            this.parentMenu.hidden();\r\n        });\r\n    }\r\n}\r\nexports.default = EditColorItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editColor.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editHtmlBlock.ts":
/*!*********************************************************!*\
  !*** ./src/components/floatMenu/items/editHtmlBlock.ts ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditHtmlBlockItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable, setReadonly } = this.createItem(lang_1.TEXT.EDIT_HTML_BLOCK);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n        this.setReadonly = setReadonly;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        if (!utils_1.getHtmlBlockComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_1.hasOperation(context_1.default.operationManager)) {\r\n            this.setReadonly();\r\n        }\r\n    }\r\n    click() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            this.parentMenu.hidden();\r\n            let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n            let comment = utils_1.getHtmlBlockComment(comments);\r\n            let nameorid = comment.nameorid;\r\n            yield outsideInterfaces_1.editHtmlBlock(nameorid);\r\n        });\r\n    }\r\n}\r\nexports.default = EditHtmlBlockItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editHtmlBlock.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editImage.ts":
/*!*****************************************************!*\
  !*** ./src/components/floatMenu/items/editImage.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditImageItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT_IMAGE);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (!utils_1.isImg(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_2.getAttributeComment(comments))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_3.isDynamicContent(args.element))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let el = args.element;\r\n        let { koobooId, parent } = utils_3.getCleanParent(args.element);\r\n        if (utils_3.isDirty(args.element) && parent) {\r\n            utils_2.updateDomImage(el, parent, koobooId, utils_2.getViewComment(comments));\r\n        }\r\n        else {\r\n            utils_2.updateAttributeImage(el, args.koobooId, utils_2.getEditComment(comments));\r\n        }\r\n    }\r\n}\r\nexports.default = EditImageItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editImage.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editLink.ts":
/*!****************************************************!*\
  !*** ./src/components/floatMenu/items/editLink.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditLinkItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT_LINK);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_3.getAttributeComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_3.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_3.getUrlComment(comments))\r\n            return this.setVisiable(true);\r\n        if (!utils_2.isLink(args.element))\r\n            return this.setVisiable(false);\r\n        if (!utils_3.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_1.isDynamicContent(args.element))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let urlComment = utils_3.getUrlComment(comments);\r\n        let viewComment = utils_3.getViewComment(comments);\r\n        let { koobooId, parent } = utils_1.getCleanParent(args.element);\r\n        if (utils_1.isDirty(args.element) && parent) {\r\n            utils_3.updateDomLink(parent, koobooId, args.element, viewComment);\r\n        }\r\n        else if (urlComment) {\r\n            utils_3.updateUrlLink(args.element, args.koobooId, urlComment, viewComment);\r\n        }\r\n        else {\r\n            utils_3.updateAttributeLink(args.element, args.koobooId, viewComment);\r\n        }\r\n    }\r\n}\r\nexports.default = EditLinkItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editLink.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editMenu.ts":
/*!****************************************************!*\
  !*** ./src/components/floatMenu/items/editMenu.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditMenuItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable, setReadonly } = this.createItem(lang_1.TEXT.EDIT_MENU);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        if (!utils_1.getMenuComment(comments))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let comment = utils_1.getMenuComment(comments);\r\n        var { startNode, endNode } = utils_2.getWrapDom(args.element, constants_1.OBJECT_TYPE.menu);\r\n        if (!startNode || !endNode)\r\n            return;\r\n        outsideInterfaces_1.editMenu(comment.nameorid, c => {\r\n            let temp = element_1.createDiv();\r\n            while (true) {\r\n                if (startNode.nextSibling == endNode) {\r\n                    startNode.parentElement.insertBefore(temp, endNode);\r\n                    break;\r\n                }\r\n                startNode.parentElement.removeChild(startNode.nextSibling);\r\n            }\r\n            temp.outerHTML = c;\r\n        });\r\n    }\r\n}\r\nexports.default = EditMenuItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editMenu.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editRepeat.ts":
/*!******************************************************!*\
  !*** ./src/components/floatMenu/items/editRepeat.ts ***!
  \******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditRepeatItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable, setReadonly } = this.createItem(lang_1.TEXT.EDIT_REPEAT);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n        this.setReadonly = setReadonly;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (!utils_1.getRepeatComment(comments) && !utils_3.getRelatedRepeatComment(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_1.hasOperation(context_1.default.operationManager))\r\n            return this.setReadonly();\r\n    }\r\n    click() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            this.parentMenu.hidden();\r\n            let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n            let comment = utils_1.getRepeatComment(comments);\r\n            if (!comment)\r\n                comment = utils_3.getRelatedRepeatComment(args.element);\r\n            yield outsideInterfaces_1.editRepeat(comment.nameorid, comment.folderid);\r\n            utils_2.reload();\r\n        });\r\n    }\r\n}\r\nexports.default = EditRepeatItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editRepeat.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editRepeatImage.ts":
/*!***********************************************************!*\
  !*** ./src/components/floatMenu/items/editRepeatImage.ts ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditRepeatImageItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT_IMAGE);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (!utils_1.isImg(args.element))\r\n            return this.setVisiable(false);\r\n        let comment = utils_2.getAttributeComment(comments, \"src\");\r\n        if (!comment || !comment.fieldname)\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let comment = utils_2.getAttributeComment(comments, \"src\");\r\n        let img = args.element;\r\n        let startContent = img.getAttribute(\"src\");\r\n        outsideInterfaces_1.pickImg(path => {\r\n            img.src = path;\r\n            let guid = utils_3.setGuid(img);\r\n            let value = img.getAttribute(\"src\");\r\n            let unit = new attributeUnit_1.AttributeUnit(startContent, \"src\");\r\n            let log = ContentLog_1.ContentLog.createUpdate(comment.nameorid, comment.fieldname, value);\r\n            let record = new Record_1.operationRecord([unit], [log], guid);\r\n            context_1.default.operationManager.add(record);\r\n        });\r\n    }\r\n}\r\nexports.default = EditRepeatImageItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editRepeatImage.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editRepeatLink.ts":
/*!**********************************************************!*\
  !*** ./src/components/floatMenu/items/editRepeatLink.ts ***!
  \**********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditRepeatLinkItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT_LINK);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (!utils_1.isLink(args.element))\r\n            return this.setVisiable(false);\r\n        let comment = utils_2.getAttributeComment(comments, \"href\");\r\n        if (!comment || !comment.fieldname)\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n        let comment = utils_2.getAttributeComment(comments, \"href\");\r\n        utils_2.updateAttributeLink(args.element, args.koobooId, comment);\r\n    }\r\n}\r\nexports.default = EditRepeatLinkItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editRepeatLink.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/editStyle.ts":
/*!*****************************************************!*\
  !*** ./src/components/floatMenu/items/editStyle.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst styleEditor_1 = __webpack_require__(/*! @/components/styleEditor */ \"./src/components/styleEditor/index.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst StyleLog_1 = __webpack_require__(/*! @/operation/recordLogs/StyleLog */ \"./src/operation/recordLogs/StyleLog.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EditStyleItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT_STYLE);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_3.isImg(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_2.getMenuComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_2.getHtmlBlockComment(comments))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        if (!args.koobooId)\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            this.parentMenu.hidden();\r\n            let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n            let { koobooId, parent } = utils_1.getCleanParent(args.element);\r\n            const startContent = args.element.getAttribute(\"style\");\r\n            let comment = utils_2.getViewComment(comments);\r\n            try {\r\n                let beforeStyle = JSON.parse(JSON.stringify(getComputedStyle(args.element)));\r\n                let { imageInBackground } = utils_3.getBackgroundImage(args.element);\r\n                let { colorInBackground } = utils_3.getBackgroundColor(args.element);\r\n                yield styleEditor_1.createStyleEditor(args.element);\r\n                let afterStyle = getComputedStyle(args.element);\r\n                let guid = utils_1.setGuid(args.element);\r\n                let unit = new attributeUnit_1.AttributeUnit(startContent, \"style\");\r\n                let logs = [];\r\n                if (utils_1.isDirty(args.element)) {\r\n                    logs.push(DomLog_1.DomLog.createUpdate(comment.nameorid, utils_1.clearKoobooInfo(parent.innerHTML), koobooId, comment.objecttype));\r\n                }\r\n                else {\r\n                    const tryAddLog = (before, after, name) => {\r\n                        if (before != after) {\r\n                            logs.push(StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, after.replace(/\"/g, \"'\"), name, args.koobooId));\r\n                        }\r\n                    };\r\n                    if (imageInBackground) {\r\n                        tryAddLog(beforeStyle.background, afterStyle.background, \"background\");\r\n                    }\r\n                    else {\r\n                        tryAddLog(beforeStyle.backgroundImage, afterStyle.backgroundImage, \"background-image\");\r\n                    }\r\n                    if (colorInBackground) {\r\n                        tryAddLog(beforeStyle.background, afterStyle.background, \"background\");\r\n                    }\r\n                    else {\r\n                        tryAddLog(beforeStyle.backgroundColor, afterStyle.backgroundColor, \"background-color\");\r\n                    }\r\n                    tryAddLog(beforeStyle.color, afterStyle.color, \"color\");\r\n                    tryAddLog(beforeStyle.width, afterStyle.width, \"width\");\r\n                    tryAddLog(beforeStyle.height, afterStyle.height, \"height\");\r\n                    tryAddLog(beforeStyle.font, afterStyle.font, \"font\");\r\n                }\r\n                if (logs.length == 0)\r\n                    return;\r\n                let record = new Record_1.operationRecord([unit], logs, guid);\r\n                context_1.default.operationManager.add(record);\r\n            }\r\n            catch (error) {\r\n                args.element.setAttribute(\"style\", startContent);\r\n            }\r\n        });\r\n    }\r\n}\r\nexports.default = EditStyleItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/editStyle.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/enterLink.ts":
/*!*****************************************************!*\
  !*** ./src/components/floatMenu/items/enterLink.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst query_string_1 = __importDefault(__webpack_require__(/*! query-string */ \"./node_modules/query-string/index.js\"));\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass EnterLinkItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.ENTER_LINK);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastHoverDomEventArgs;\r\n        if (!utils_1.canJump(args.element))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let url = context_1.default.lastHoverDomEventArgs.element.getAttribute(\"href\");\r\n        this.parentMenu.hidden();\r\n        let pageId = utils_2.getPageId();\r\n        let parsed = query_string_1.default.parse(parent.location.search);\r\n        let query = {\r\n            SiteId: parsed[\"SiteId\"],\r\n            accessToken: parsed[\"accessToken\"],\r\n            pageId: pageId,\r\n            pageUrl: url\r\n        };\r\n        parent.location.href = parent.location.origin + parent.location.pathname + \"?\" + query_string_1.default.stringify(query);\r\n    }\r\n}\r\nexports.default = EnterLinkItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/enterLink.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/inlineEditHtmlBlock.ts":
/*!***************************************************************!*\
  !*** ./src/components/floatMenu/items/inlineEditHtmlBlock.ts ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst richEditor_1 = __webpack_require__(/*! @/components/richEditor */ \"./src/components/richEditor/index.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst InnerHtmlUnit_1 = __webpack_require__(/*! @/operation/recordUnits/InnerHtmlUnit */ \"./src/operation/recordUnits/InnerHtmlUnit.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst HtmlblockLog_1 = __webpack_require__(/*! @/operation/recordLogs/HtmlblockLog */ \"./src/operation/recordLogs/HtmlblockLog.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass InlineEditHtmlBlockItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.EDIT);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        if (!utils_2.getHtmlBlockComment(comments))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        let { element } = context_1.default.lastSelectedDomEventArgs;\r\n        this.parentMenu.hidden();\r\n        let startContent = element.innerHTML;\r\n        const onSave = () => {\r\n            if (utils_2.clearContent(startContent) == utils_2.clearContent(element.innerHTML))\r\n                return;\r\n            let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n            utils_1.markDirty(element);\r\n            let guid = utils_1.setGuid(element);\r\n            let unit = new InnerHtmlUnit_1.InnerHtmlUnit(startContent);\r\n            let htmlBlockcomment = utils_2.getHtmlBlockComment(comments);\r\n            let { nodes } = utils_1.getWrapDom(element, constants_1.OBJECT_TYPE.htmlblock);\r\n            let temp = element_1.createDiv();\r\n            nodes.forEach(i => temp.appendChild(i.cloneNode(true)));\r\n            let log = HtmlblockLog_1.HtmlblockLog.createUpdate(htmlBlockcomment.nameorid, utils_1.clearKoobooInfo(temp.innerHTML));\r\n            let operation = new Record_1.operationRecord([unit], [log], guid);\r\n            context_1.default.operationManager.add(operation);\r\n        };\r\n        const onCancel = () => {\r\n            element.innerHTML = startContent;\r\n        };\r\n        richEditor_1.setInlineEditor({ selector: element, onSave, onCancel });\r\n    }\r\n}\r\nexports.default = InlineEditHtmlBlockItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/inlineEditHtmlBlock.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/replaceToImg.ts":
/*!********************************************************!*\
  !*** ./src/components/floatMenu/items/replaceToImg.ts ***!
  \********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst imagePicker_1 = __webpack_require__(/*! @/components/imagePicker */ \"./src/components/imagePicker/index.ts\");\r\nconst InnerHtmlUnit_1 = __webpack_require__(/*! @/operation/recordUnits/InnerHtmlUnit */ \"./src/operation/recordUnits/InnerHtmlUnit.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass ReplaceToImgItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.REPLACE_TO_IMG);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_2.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_3.getRelatedRepeatComment(args.element))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_1.isInTable(args.element))\r\n            return this.setVisiable(false);\r\n        let { koobooId, parent } = utils_3.getCleanParent(args.element);\r\n        if (!parent && !koobooId)\r\n            return this.setVisiable(false);\r\n        if (utils_1.isImg(args.element))\r\n            return this.setVisiable(false);\r\n        if (parent && utils_3.isDynamicContent(parent))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            this.parentMenu.hidden();\r\n            let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n            let { koobooId, parent } = utils_3.getCleanParent(args.element);\r\n            utils_3.setGuid(parent);\r\n            let startContent = parent.innerHTML;\r\n            try {\r\n                let style = JSON.parse(JSON.stringify(getComputedStyle(args.element)));\r\n                let img = element_1.createImg();\r\n                img.setAttribute(constants_1.KOOBOO_ID, args.koobooId);\r\n                args.element.parentElement.replaceChild(img, args.element);\r\n                img.style.width = style.width;\r\n                img.style.height = style.height;\r\n                img.style.display = style.display;\r\n                yield imagePicker_1.createImagePicker(img);\r\n                utils_3.markDirty(parent);\r\n                let guid = utils_3.setGuid(parent);\r\n                let value = utils_3.clearKoobooInfo(parent.innerHTML);\r\n                let comment = utils_2.getViewComment(comments);\r\n                let unit = new InnerHtmlUnit_1.InnerHtmlUnit(startContent);\r\n                let log = DomLog_1.DomLog.createUpdate(comment.nameorid, value, koobooId, comment.objecttype);\r\n                let record = new Record_1.operationRecord([unit], [log], guid);\r\n                context_1.default.operationManager.add(record);\r\n            }\r\n            catch (error) {\r\n                parent.innerHTML = startContent;\r\n            }\r\n        });\r\n    }\r\n}\r\nexports.default = ReplaceToImgItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/replaceToImg.ts?");

/***/ }),

/***/ "./src/components/floatMenu/items/replaceToText.ts":
/*!*********************************************************!*\
  !*** ./src/components/floatMenu/items/replaceToText.ts ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst richEditor_1 = __webpack_require__(/*! @/components/richEditor */ \"./src/components/richEditor/index.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst events_1 = __webpack_require__(/*! @/dom/events */ \"./src/dom/events.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst InnerHtmlUnit_1 = __webpack_require__(/*! @/operation/recordUnits/InnerHtmlUnit */ \"./src/operation/recordUnits/InnerHtmlUnit.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst BaseMenuItem_1 = __importDefault(__webpack_require__(/*! ./BaseMenuItem */ \"./src/components/floatMenu/items/BaseMenuItem.ts\"));\r\nclass ReplaceToTextItem extends BaseMenuItem_1.default {\r\n    constructor(parentMenu) {\r\n        super(parentMenu);\r\n        const { el, setVisiable } = this.createItem(lang_1.TEXT.REPLACE_TO_TEXT);\r\n        this.el = el;\r\n        this.el.addEventListener(\"click\", this.click.bind(this));\r\n        this.setVisiable = setVisiable;\r\n    }\r\n    update(comments) {\r\n        this.setVisiable(true);\r\n        let args = context_1.default.lastSelectedDomEventArgs;\r\n        if (utils_2.getRepeatComment(comments))\r\n            return this.setVisiable(false);\r\n        if (utils_3.getRelatedRepeatComment(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_1.isInTable(args.element))\r\n            return this.setVisiable(false);\r\n        if (!utils_2.getViewComment(comments))\r\n            return this.setVisiable(false);\r\n        let { koobooId, parent } = utils_3.getCleanParent(args.element);\r\n        if (!parent || !koobooId)\r\n            return this.setVisiable(false);\r\n        if (!utils_1.isImg(args.element))\r\n            return this.setVisiable(false);\r\n        if (utils_3.isDynamicContent(parent))\r\n            return this.setVisiable(false);\r\n    }\r\n    click() {\r\n        return __awaiter(this, void 0, void 0, function* () {\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            let { parent, koobooId } = utils_3.getCleanParent(args.element);\r\n            let startContent = parent.innerHTML;\r\n            let text = element_1.createP();\r\n            let style = getComputedStyle(args.element);\r\n            text.setAttribute(constants_1.KOOBOO_ID, args.koobooId);\r\n            text.setAttribute(constants_1.KOOBOO_DIRTY, \"\");\r\n            text.style.width = style.width;\r\n            text.style.height = style.height;\r\n            text.style.display = \"block\";\r\n            args.element.parentElement.replaceChild(text, args.element);\r\n            events_1.emitHoverEvent(text);\r\n            events_1.emitSelectedEvent();\r\n            const onSave = () => {\r\n                if (utils_2.clearContent(startContent) == utils_2.clearContent(text.innerHTML))\r\n                    return;\r\n                let guid = utils_3.setGuid(parent);\r\n                let comments = KoobooComment_1.KoobooComment.getComments(parent);\r\n                let comment = utils_2.getEditComment(comments);\r\n                let unit = new InnerHtmlUnit_1.InnerHtmlUnit(startContent);\r\n                let log = DomLog_1.DomLog.createUpdate(comment.nameorid, utils_3.clearKoobooInfo(parent.innerHTML), koobooId, comment.objecttype);\r\n                let operation = new Record_1.operationRecord([unit], [log], guid);\r\n                context_1.default.operationManager.add(operation);\r\n            };\r\n            const onCancel = () => {\r\n                parent.innerHTML = startContent;\r\n            };\r\n            yield richEditor_1.setInlineEditor({ selector: text, onSave, onCancel });\r\n            this.parentMenu.hidden();\r\n        });\r\n    }\r\n}\r\nexports.default = ReplaceToTextItem;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/items/replaceToText.ts?");

/***/ }),

/***/ "./src/components/floatMenu/menu.ts":
/*!******************************************!*\
  !*** ./src/components/floatMenu/menu.ts ***!
  \******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst copy_1 = __importDefault(__webpack_require__(/*! ./items/copy */ \"./src/components/floatMenu/items/copy.ts\"));\r\nconst delete_1 = __importDefault(__webpack_require__(/*! ./items/delete */ \"./src/components/floatMenu/items/delete.ts\"));\r\nconst edit_1 = __importDefault(__webpack_require__(/*! ./items/edit */ \"./src/components/floatMenu/items/edit.ts\"));\r\nconst editImage_1 = __importDefault(__webpack_require__(/*! ./items/editImage */ \"./src/components/floatMenu/items/editImage.ts\"));\r\nconst editLink_1 = __importDefault(__webpack_require__(/*! ./items/editLink */ \"./src/components/floatMenu/items/editLink.ts\"));\r\nconst enterLink_1 = __importDefault(__webpack_require__(/*! ./items/enterLink */ \"./src/components/floatMenu/items/enterLink.ts\"));\r\nconst editHtmlBlock_1 = __importDefault(__webpack_require__(/*! ./items/editHtmlBlock */ \"./src/components/floatMenu/items/editHtmlBlock.ts\"));\r\nconst editRepeat_1 = __importDefault(__webpack_require__(/*! ./items/editRepeat */ \"./src/components/floatMenu/items/editRepeat.ts\"));\r\nconst editMenu_1 = __importDefault(__webpack_require__(/*! ./items/editMenu */ \"./src/components/floatMenu/items/editMenu.ts\"));\r\nconst editStyle_1 = __importDefault(__webpack_require__(/*! ./items/editStyle */ \"./src/components/floatMenu/items/editStyle.ts\"));\r\nconst copyRepeat_1 = __importDefault(__webpack_require__(/*! ./items/copyRepeat */ \"./src/components/floatMenu/items/copyRepeat.ts\"));\r\nconst deleteRepeat_1 = __importDefault(__webpack_require__(/*! ./items/deleteRepeat */ \"./src/components/floatMenu/items/deleteRepeat.ts\"));\r\nconst replaceToImg_1 = __importDefault(__webpack_require__(/*! ./items/replaceToImg */ \"./src/components/floatMenu/items/replaceToImg.ts\"));\r\nconst replaceToText_1 = __importDefault(__webpack_require__(/*! ./items/replaceToText */ \"./src/components/floatMenu/items/replaceToText.ts\"));\r\nconst editRepeatImage_1 = __importDefault(__webpack_require__(/*! ./items/editRepeatImage */ \"./src/components/floatMenu/items/editRepeatImage.ts\"));\r\nconst editRepeatLink_1 = __importDefault(__webpack_require__(/*! ./items/editRepeatLink */ \"./src/components/floatMenu/items/editRepeatLink.ts\"));\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst click_1 = __importDefault(__webpack_require__(/*! ./items/click */ \"./src/components/floatMenu/items/click.ts\"));\r\nconst deleteHtmlBlock_1 = __importDefault(__webpack_require__(/*! ./items/deleteHtmlBlock */ \"./src/components/floatMenu/items/deleteHtmlBlock.ts\"));\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst inlineEditHtmlBlock_1 = __importDefault(__webpack_require__(/*! ./items/inlineEditHtmlBlock */ \"./src/components/floatMenu/items/inlineEditHtmlBlock.ts\"));\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst events_1 = __webpack_require__(/*! @/dom/events */ \"./src/dom/events.ts\");\r\nconst guanbi_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/guanbi.svg */ \"./src/assets/icons/guanbi.svg\"));\r\nconst fangda_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/fangda.svg */ \"./src/assets/icons/fangda.svg\"));\r\nconst editColor_1 = __importDefault(__webpack_require__(/*! ./items/editColor */ \"./src/components/floatMenu/items/editColor.ts\"));\r\nfunction createMenu() {\r\n    let menu = new Menu();\r\n    menu.addItem(new edit_1.default(menu));\r\n    menu.addItem(new copy_1.default(menu));\r\n    menu.addItem(new delete_1.default(menu));\r\n    menu.addItem(new editImage_1.default(menu));\r\n    menu.addItem(new editLink_1.default(menu));\r\n    menu.addItem(new enterLink_1.default(menu));\r\n    menu.addItem(new editHtmlBlock_1.default(menu));\r\n    menu.addItem(new editRepeat_1.default(menu));\r\n    menu.addItem(new copyRepeat_1.default(menu));\r\n    menu.addItem(new deleteRepeat_1.default(menu));\r\n    menu.addItem(new editMenu_1.default(menu));\r\n    menu.addItem(new editStyle_1.default(menu));\r\n    menu.addItem(new replaceToImg_1.default(menu));\r\n    menu.addItem(new replaceToText_1.default(menu));\r\n    menu.addItem(new editRepeatImage_1.default(menu));\r\n    menu.addItem(new editRepeatLink_1.default(menu));\r\n    menu.addItem(new click_1.default(menu));\r\n    menu.addItem(new deleteHtmlBlock_1.default(menu));\r\n    menu.addItem(new inlineEditHtmlBlock_1.default(menu));\r\n    menu.addItem(new editColor_1.default(menu));\r\n    return menu;\r\n}\r\nexports.createMenu = createMenu;\r\nclass Menu {\r\n    constructor() {\r\n        this.items = [];\r\n        this.update = (x, y) => {\r\n            let pageHeight = utils_1.getMaxHeight();\r\n            let pagewidth = utils_1.getMaxWidth();\r\n            this.container.style.display = \"block\";\r\n            this.container.style.overflow = \"visible\";\r\n            let args = context_1.default.lastSelectedDomEventArgs;\r\n            let comments = KoobooComment_1.KoobooComment.getComments(args.element);\r\n            let elements = utils_1.getParentElements(args.element);\r\n            let canExpand = elements.findIndex(f => f instanceof HTMLBodyElement) != 0;\r\n            this.setExpandBtnVisiable(canExpand);\r\n            for (const i of this.items) {\r\n                i.update(comments);\r\n            }\r\n            this.updatePosition(x, y, pageHeight, pagewidth);\r\n        };\r\n        this.hidden = () => {\r\n            this.container.style.display = \"none\";\r\n        };\r\n        const { container, setExpandBtnVisiable, updatePosition } = this.createContainer();\r\n        for (const i of this.items) {\r\n            container.appendChild(i.el);\r\n        }\r\n        this.container = container;\r\n        this.setExpandBtnVisiable = setExpandBtnVisiable;\r\n        this.updatePosition = updatePosition;\r\n    }\r\n    addItem(item) {\r\n        this.container.appendChild(item.el);\r\n        this.items.push(item);\r\n    }\r\n    createContainer() {\r\n        let el = element_1.createDiv();\r\n        el.classList.add(\"kb_web_editor_menu\");\r\n        el.style.zIndex = constants_1.STANDARD_Z_INDEX + 1 + \"\";\r\n        let { setExpandBtnVisiable, title } = this.createTitle();\r\n        el.append(title);\r\n        const updatePosition = (x, y, pageHeight, pageWidth) => {\r\n            let rect = el.getBoundingClientRect();\r\n            let scrollLeft = utils_1.getScrollLeft();\r\n            let scrollTop = utils_1.getScrollTop();\r\n            let limitWidth = window.innerWidth + scrollLeft;\r\n            let limitHeight = window.innerHeight + scrollTop;\r\n            if (x + rect.width > limitWidth) {\r\n                x = x - rect.width + 3;\r\n            }\r\n            if (y + rect.height > limitHeight) {\r\n                y = y - rect.height + 3;\r\n                context_1.default.lastMouseEventArg = {\r\n                    isTrusted: true,\r\n                    pageX: x,\r\n                    pageY: y\r\n                };\r\n            }\r\n            el.style.top = y + \"px\";\r\n            el.style.left = x + \"px\";\r\n        };\r\n        return {\r\n            container: el,\r\n            updatePosition,\r\n            setExpandBtnVisiable\r\n        };\r\n    }\r\n    createTitle() {\r\n        const el = element_1.createDiv();\r\n        el.classList.add(\"kb_web_editor_menu_title\");\r\n        el.appendChild(document.createTextNode(lang_1.TEXT.MENU));\r\n        el.appendChild(this.createCloseButton());\r\n        let expandButton = this.createExpandButton();\r\n        el.appendChild(expandButton);\r\n        const setExpandBtnVisiable = (visiable) => {\r\n            expandButton.style.display = visiable ? \"block\" : \"none\";\r\n        };\r\n        return { title: el, setExpandBtnVisiable };\r\n    }\r\n    createCloseButton() {\r\n        const el = element_1.createDiv();\r\n        el.style.backgroundImage = `url(${guanbi_svg_1.default})`;\r\n        el.onclick = () => this.hidden();\r\n        return el;\r\n    }\r\n    createExpandButton() {\r\n        const el = element_1.createDiv();\r\n        el.style.backgroundImage = `url(${fangda_svg_1.default})`;\r\n        el.title = lang_1.TEXT.EXPAND_SELECTION;\r\n        el.onclick = () => {\r\n            if (context_1.default.editing)\r\n                return;\r\n            let el = context_1.default.lastHoverDomEventArgs.closeElement;\r\n            if (!el || !el.parentElement)\r\n                return;\r\n            events_1.emitHoverEvent(el.parentElement);\r\n            events_1.emitSelectedEvent();\r\n        };\r\n        return el;\r\n    }\r\n}\r\nexports.Menu = Menu;\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/menu.ts?");

/***/ }),

/***/ "./src/components/floatMenu/utils.ts":
/*!*******************************************!*\
  !*** ./src/components/floatMenu/utils.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst imagePicker_1 = __webpack_require__(/*! ../imagePicker */ \"./src/components/imagePicker/index.ts\");\r\nconst DomLog_1 = __webpack_require__(/*! @/operation/recordLogs/DomLog */ \"./src/operation/recordLogs/DomLog.ts\");\r\nconst InnerHtmlUnit_1 = __webpack_require__(/*! @/operation/recordUnits/InnerHtmlUnit */ \"./src/operation/recordUnits/InnerHtmlUnit.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst StyleUnit_1 = __webpack_require__(/*! @/operation/recordUnits/StyleUnit */ \"./src/operation/recordUnits/StyleUnit.ts\");\r\nconst StyleLog_1 = __webpack_require__(/*! @/operation/recordLogs/StyleLog */ \"./src/operation/recordLogs/StyleLog.ts\");\r\nconst linkPicker_1 = __webpack_require__(/*! ../linkPicker */ \"./src/components/linkPicker/index.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction getEditComment(comments) {\r\n    const editTypes = [constants_1.OBJECT_TYPE.view, constants_1.OBJECT_TYPE.page, constants_1.OBJECT_TYPE.layout, constants_1.OBJECT_TYPE.content, constants_1.OBJECT_TYPE.Label];\r\n    for (const i of comments) {\r\n        if (i.objecttype && editTypes.some(s => s == i.objecttype))\r\n            return i;\r\n    }\r\n}\r\nexports.getEditComment = getEditComment;\r\nfunction getViewComment(comments) {\r\n    const editTypes = [constants_1.OBJECT_TYPE.view, constants_1.OBJECT_TYPE.page, constants_1.OBJECT_TYPE.layout];\r\n    for (const i of comments) {\r\n        if (i.objecttype && editTypes.some(s => s == i.objecttype))\r\n            return i;\r\n    }\r\n}\r\nexports.getViewComment = getViewComment;\r\nfunction getAttributeComment(comments, name = \"\") {\r\n    for (const i of comments) {\r\n        if (i.objecttype && i.objecttype == constants_1.OBJECT_TYPE.attribute && (!name || i.attributename == name)) {\r\n            return i;\r\n        }\r\n    }\r\n}\r\nexports.getAttributeComment = getAttributeComment;\r\nfunction getObjectType(comments, type) {\r\n    for (const i of comments) {\r\n        if (i.objecttype && i.objecttype.toLowerCase() == type.toLowerCase())\r\n            return i;\r\n    }\r\n}\r\nfunction hasOperation(operationManager) {\r\n    return operationManager.previousRecords.length > 0 || operationManager.nextRecords.length > 0;\r\n}\r\nexports.hasOperation = hasOperation;\r\nexports.getMenuComment = (comments) => getObjectType(comments, constants_1.OBJECT_TYPE.menu);\r\nexports.getFormComment = (comments) => getObjectType(comments, constants_1.OBJECT_TYPE.form);\r\nexports.getHtmlBlockComment = (comments) => getObjectType(comments, constants_1.OBJECT_TYPE.htmlblock);\r\nexports.getRepeatComment = (comments) => getObjectType(comments, constants_1.OBJECT_TYPE.contentrepeater);\r\nexports.getUrlComment = (comments) => getObjectType(comments, constants_1.OBJECT_TYPE.Url);\r\nfunction changeNameOrId(node, guid, oldGuid) {\r\n    if (KoobooComment_1.KoobooComment.isComment(node) && node.nodeValue.indexOf(oldGuid) > -1) {\r\n        node.nodeValue = node.nodeValue.replace(/--nameorid='.{36,50}?'/, `--nameorid='${guid}'`);\r\n    }\r\n    if (node instanceof HTMLElement) {\r\n        for (const iterator of utils_1.getAllNode(node)) {\r\n            changeNameOrId(iterator, guid, oldGuid);\r\n        }\r\n    }\r\n}\r\nexports.changeNameOrId = changeNameOrId;\r\nfunction updateDomImage(element, closeParent, parentKoobooId, comment) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        utils_2.setGuid(closeParent);\r\n        let startContent = element.cloneNode(true);\r\n        try {\r\n            yield imagePicker_1.createImagePicker(element);\r\n            if (startContent.outerHTML == element.outerHTML)\r\n                return;\r\n            utils_2.markDirty(closeParent);\r\n            let guid = utils_2.setGuid(closeParent);\r\n            let value = utils_2.clearKoobooInfo(closeParent.innerHTML);\r\n            let oldSrc = startContent.getAttribute(\"src\");\r\n            let unit = new attributeUnit_1.AttributeUnit(oldSrc, \"src\");\r\n            let log = DomLog_1.DomLog.createUpdate(comment.nameorid, value, parentKoobooId, comment.objecttype);\r\n            let record = new Record_1.operationRecord([unit], [log], guid);\r\n            context_1.default.operationManager.add(record);\r\n            return element.getAttribute(\"src\");\r\n        }\r\n        catch (error) {\r\n            element.setAttribute(\"src\", startContent.getAttribute(\"src\"));\r\n            element.setAttribute(\"style\", startContent.getAttribute(\"style\"));\r\n            element.title = startContent.title;\r\n            element.alt = startContent.alt;\r\n        }\r\n    });\r\n}\r\nexports.updateDomImage = updateDomImage;\r\nfunction updateAttributeImage(element, koobooId, comment) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let startContent = element.cloneNode(true);\r\n        let temp = element_1.createDiv();\r\n        temp.appendChild(startContent);\r\n        try {\r\n            yield imagePicker_1.createImagePicker(element);\r\n            if (startContent.outerHTML == element.outerHTML)\r\n                return;\r\n            let guid = utils_2.setGuid(element);\r\n            let oldSrc = startContent.getAttribute(\"src\");\r\n            let units = [\r\n                new attributeUnit_1.AttributeUnit(startContent.title, \"title\"),\r\n                new attributeUnit_1.AttributeUnit(startContent.alt, \"alt\"),\r\n                new attributeUnit_1.AttributeUnit(oldSrc, \"src\"),\r\n                new StyleUnit_1.StyleUnit(startContent.style.width, \"width\"),\r\n                new StyleUnit_1.StyleUnit(startContent.style.height, \"height\")\r\n            ];\r\n            let newSrc = element.getAttribute(\"src\");\r\n            let logs = [\r\n                DomLog_1.DomLog.createUpdate(comment.nameorid, element.title, koobooId, comment.objecttype, \"title\"),\r\n                DomLog_1.DomLog.createUpdate(comment.nameorid, element.alt, koobooId, comment.objecttype, \"alt\"),\r\n                DomLog_1.DomLog.createUpdate(comment.nameorid, newSrc, koobooId, comment.objecttype, \"src\"),\r\n                StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, element.style.width, \"width\", koobooId),\r\n                StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, element.style.height, \"height\", koobooId)\r\n            ];\r\n            let record = new Record_1.operationRecord(units, logs, guid);\r\n            context_1.default.operationManager.add(record);\r\n            return newSrc;\r\n        }\r\n        catch (error) {\r\n            element.setAttribute(\"src\", startContent.getAttribute(\"src\"));\r\n            element.setAttribute(\"style\", startContent.getAttribute(\"style\"));\r\n            element.title = startContent.title;\r\n            element.alt = startContent.alt;\r\n        }\r\n    });\r\n}\r\nexports.updateAttributeImage = updateAttributeImage;\r\nfunction updateDomLink(closeParent, parentKoobooId, element, comment) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        utils_2.setGuid(closeParent);\r\n        let startContent = closeParent.innerHTML;\r\n        let href = element.getAttribute(\"href\");\r\n        try {\r\n            let url = yield linkPicker_1.createLinkPicker(href);\r\n            element.setAttribute(\"href\", url);\r\n            let guid = utils_2.setGuid(closeParent);\r\n            let value = utils_2.clearKoobooInfo(closeParent.innerHTML);\r\n            let unit = new InnerHtmlUnit_1.InnerHtmlUnit(startContent);\r\n            let log = DomLog_1.DomLog.createUpdate(comment.nameorid, value, parentKoobooId, comment.objecttype);\r\n            let record = new Record_1.operationRecord([unit], [log], guid);\r\n            context_1.default.operationManager.add(record);\r\n            return url;\r\n        }\r\n        catch (error) {\r\n            closeParent.innerHTML = startContent;\r\n        }\r\n    });\r\n}\r\nexports.updateDomLink = updateDomLink;\r\nfunction updateAttributeLink(element, koobooId, comment) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        utils_2.setGuid(element);\r\n        let startContent = element.getAttribute(\"href\");\r\n        try {\r\n            let url = yield linkPicker_1.createLinkPicker(startContent);\r\n            element.setAttribute(\"href\", url);\r\n            let guid = utils_2.setGuid(element);\r\n            let unit = new attributeUnit_1.AttributeUnit(startContent, \"href\");\r\n            let log;\r\n            if (isViewComment(comment)) {\r\n                log = DomLog_1.DomLog.createUpdate(comment.nameorid, url, koobooId, comment.objecttype, \"href\");\r\n            }\r\n            else {\r\n                log = ContentLog_1.ContentLog.createUpdate(comment.nameorid, comment.fieldname, url);\r\n            }\r\n            let record = new Record_1.operationRecord([unit], [log], guid);\r\n            context_1.default.operationManager.add(record);\r\n            return url;\r\n        }\r\n        catch (error) {\r\n            element.setAttribute(\"href\", startContent);\r\n        }\r\n    });\r\n}\r\nexports.updateAttributeLink = updateAttributeLink;\r\nfunction updateUrlLink(element, koobooId, urlComment, viewComment) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        utils_2.setGuid(element);\r\n        let startContent = element.getAttribute(\"href\");\r\n        try {\r\n            let url = yield linkPicker_1.createLinkPicker(startContent);\r\n            element.setAttribute(\"href\", url);\r\n            let guid = utils_2.setGuid(element);\r\n            let unit = new attributeUnit_1.AttributeUnit(startContent, \"href\");\r\n            let log = DomLog_1.DomLog.createUpdate(viewComment.nameorid, url, koobooId, viewComment.objecttype, urlComment.attributename);\r\n            let record = new Record_1.operationRecord([unit], [log], guid);\r\n            context_1.default.operationManager.add(record);\r\n            return url;\r\n        }\r\n        catch (error) {\r\n            element.setAttribute(\"href\", startContent);\r\n        }\r\n    });\r\n}\r\nexports.updateUrlLink = updateUrlLink;\r\nfunction getFirstComment(comments) {\r\n    for (const iterator of comments) {\r\n        if (iterator.objecttype == constants_1.OBJECT_TYPE.Url)\r\n            continue;\r\n        return iterator;\r\n    }\r\n}\r\nexports.getFirstComment = getFirstComment;\r\nfunction isViewComment(comment) {\r\n    const types = [constants_1.OBJECT_TYPE.view, constants_1.OBJECT_TYPE.page, constants_1.OBJECT_TYPE.layout];\r\n    return types.some(s => s == comment.objecttype);\r\n}\r\nexports.isViewComment = isViewComment;\r\nfunction isEditComment(comment) {\r\n    const types = [constants_1.OBJECT_TYPE.view, constants_1.OBJECT_TYPE.page, constants_1.OBJECT_TYPE.layout, constants_1.OBJECT_TYPE.content, constants_1.OBJECT_TYPE.Label, constants_1.OBJECT_TYPE.attribute];\r\n    return types.some(s => s == comment.objecttype);\r\n}\r\nexports.isEditComment = isEditComment;\r\nfunction isRepeatComment(comment) {\r\n    return comment.objecttype == constants_1.OBJECT_TYPE.contentrepeater;\r\n}\r\nexports.isRepeatComment = isRepeatComment;\r\nexports.clearContent = (c) => utils_2.clearKoobooInfo(c).replace(/\\s/g, \"\");\r\n\n\n//# sourceURL=webpack:///./src/components/floatMenu/utils.ts?");

/***/ }),

/***/ "./src/components/globalImageEditor/contentImagePanel.ts":
/*!***************************************************************!*\
  !*** ./src/components/globalImageEditor/contentImagePanel.ts ***!
  \***************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! ./utils */ \"./src/components/globalImageEditor/utils.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst utils_4 = __webpack_require__(/*! ../floatMenu/utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst imagePreview_1 = __webpack_require__(/*! ../common/imagePreview */ \"./src/components/common/imagePreview.ts\");\r\nfunction createContentImagePanel() {\r\n    let contiainer = element_1.createDiv();\r\n    for (const element of utils_1.getAllElement(document.body)) {\r\n        if (element instanceof HTMLImageElement) {\r\n            let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n            let comment = utils_4.getAttributeComment(comments, \"src\");\r\n            if (!comment || !comment.fieldname)\r\n                continue;\r\n            let { imagePreview, setImage } = imagePreview_1.createImagePreview(false, () => (element.src = \"\"));\r\n            utils_3.setImagePreview(imagePreview, element);\r\n            setImage(element.src);\r\n            imagePreview.onclick = () => {\r\n                let startContent = element.src;\r\n                outsideInterfaces_1.pickImg(path => {\r\n                    element.src = path;\r\n                    setImage(path);\r\n                    let guid = utils_2.setGuid(element);\r\n                    let value = element.src;\r\n                    let unit = new attributeUnit_1.AttributeUnit(startContent, \"src\");\r\n                    let log = ContentLog_1.ContentLog.createUpdate(comment.nameorid, comment.fieldname, value);\r\n                    let record = new Record_1.operationRecord([unit], [log], guid);\r\n                    context_1.default.operationManager.add(record);\r\n                });\r\n            };\r\n            contiainer.appendChild(imagePreview);\r\n        }\r\n    }\r\n    return contiainer;\r\n}\r\nexports.createContentImagePanel = createContentImagePanel;\r\n\n\n//# sourceURL=webpack:///./src/components/globalImageEditor/contentImagePanel.ts?");

/***/ }),

/***/ "./src/components/globalImageEditor/domImagePanel.ts":
/*!***********************************************************!*\
  !*** ./src/components/globalImageEditor/domImagePanel.ts ***!
  \***********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../floatMenu/utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! ./utils */ \"./src/components/globalImageEditor/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst utils_4 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst imagePreview_1 = __webpack_require__(/*! ../common/imagePreview */ \"./src/components/common/imagePreview.ts\");\r\nfunction createDomImagePanel() {\r\n    let contiainer = element_1.createDiv();\r\n    for (const element of utils_1.getAllElement(document.body)) {\r\n        if (element instanceof HTMLImageElement) {\r\n            let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n            let koobooId = element.getAttribute(constants_1.KOOBOO_ID);\r\n            if (utils_2.getAttributeComment(comments))\r\n                continue;\r\n            let comment = utils_2.getViewComment(comments);\r\n            if (!koobooId)\r\n                continue;\r\n            let { imagePreview, setImage } = imagePreview_1.createImagePreview(false, () => (element.src = \"\"));\r\n            utils_3.setImagePreview(imagePreview, element);\r\n            setImage(element.src);\r\n            imagePreview.onclick = () => __awaiter(this, void 0, void 0, function* () {\r\n                let src;\r\n                let { koobooId: parentKoobooId, parent } = utils_4.getCleanParent(element);\r\n                if (utils_4.isDirty(element) && parent) {\r\n                    src = yield utils_2.updateDomImage(element, parent, parentKoobooId, comment);\r\n                }\r\n                else {\r\n                    src = yield utils_2.updateAttributeImage(element, koobooId, comment);\r\n                }\r\n                if (src != undefined)\r\n                    setImage(src);\r\n            });\r\n            contiainer.appendChild(imagePreview);\r\n        }\r\n    }\r\n    return contiainer;\r\n}\r\nexports.createDomImagePanel = createDomImagePanel;\r\n\n\n//# sourceURL=webpack:///./src/components/globalImageEditor/domImagePanel.ts?");

/***/ }),

/***/ "./src/components/globalImageEditor/index.ts":
/*!***************************************************!*\
  !*** ./src/components/globalImageEditor/index.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! ../modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst tabs_1 = __webpack_require__(/*! ../common/tabs */ \"./src/components/common/tabs.ts\");\r\nconst contentImagePanel_1 = __webpack_require__(/*! ./contentImagePanel */ \"./src/components/globalImageEditor/contentImagePanel.ts\");\r\nconst styleImagePanel_1 = __webpack_require__(/*! ./styleImagePanel */ \"./src/components/globalImageEditor/styleImagePanel.ts\");\r\nconst domImagePanel_1 = __webpack_require__(/*! ./domImagePanel */ \"./src/components/globalImageEditor/domImagePanel.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createGlobalImageEditor() {\r\n    const options = [\r\n        {\r\n            title: lang_1.TEXT.DOM_IMAGES,\r\n            selected: true,\r\n            panel: domImagePanel_1.createDomImagePanel()\r\n        },\r\n        {\r\n            title: lang_1.TEXT.CONTENT_IMAGES,\r\n            panel: contentImagePanel_1.createContentImagePanel()\r\n        },\r\n        {\r\n            title: lang_1.TEXT.STYLE_IMAGES,\r\n            panel: styleImagePanel_1.createStyleImagePanel()\r\n        }\r\n    ];\r\n    let tabs = tabs_1.createTabs(options);\r\n    const { modal, hideCancel } = modal_1.createModal(lang_1.TEXT.EDIT_IMAGES, tabs, \"600px\", \"500px\");\r\n    hideCancel();\r\n    context_1.default.container.appendChild(modal);\r\n}\r\nexports.createGlobalImageEditor = createGlobalImageEditor;\r\n\n\n//# sourceURL=webpack:///./src/components/globalImageEditor/index.ts?");

/***/ }),

/***/ "./src/components/globalImageEditor/styleImagePanel.ts":
/*!*************************************************************!*\
  !*** ./src/components/globalImageEditor/styleImagePanel.ts ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! ../floatMenu/utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst utils_4 = __webpack_require__(/*! ./utils */ \"./src/components/globalImageEditor/utils.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst StyleLog_1 = __webpack_require__(/*! @/operation/recordLogs/StyleLog */ \"./src/operation/recordLogs/StyleLog.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst imagePreview_1 = __webpack_require__(/*! ../common/imagePreview */ \"./src/components/common/imagePreview.ts\");\r\nconst Background_1 = __webpack_require__(/*! @/dom/Background */ \"./src/dom/Background.ts\");\r\nfunction createStyleImagePanel() {\r\n    let contiainer = element_1.createDiv();\r\n    for (const element of utils_1.getAllElement(document.body)) {\r\n        if (!(element instanceof HTMLElement))\r\n            continue;\r\n        let { image, imageInBackground } = utils_1.getBackgroundImage(element);\r\n        if (!image || image == \"none\")\r\n            continue;\r\n        let koobooId = element.getAttribute(constants_1.KOOBOO_ID);\r\n        let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n        let comment = utils_3.getViewComment(comments);\r\n        if (!comment || !koobooId)\r\n            continue;\r\n        let { imagePreview, setImage } = imagePreview_1.createImagePreview(false, () => utils_1.clearBackgroundImage(element, imageInBackground));\r\n        utils_4.setImagePreview(imagePreview, element);\r\n        if (image)\r\n            setImage(image);\r\n        imagePreview.onclick = () => {\r\n            let startContent = element.getAttribute(\"style\");\r\n            outsideInterfaces_1.pickImg(path => {\r\n                if (imageInBackground) {\r\n                    let background = new Background_1.Background(element.style.background);\r\n                    background.image = `url('${path}')`;\r\n                    element.style.background = background.toString();\r\n                }\r\n                else {\r\n                    element.style.backgroundImage = `url('${path}')`;\r\n                }\r\n                setImage(path);\r\n                let guid = utils_2.setGuid(element);\r\n                let unit = new attributeUnit_1.AttributeUnit(startContent, \"style\");\r\n                let log;\r\n                if (imageInBackground) {\r\n                    let value = element.style.background.replace(/\"/g, \"'\");\r\n                    log = StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, value, \"background\", koobooId);\r\n                }\r\n                else {\r\n                    let value = element.style.backgroundImage.replace(/\"/g, \"'\");\r\n                    log = StyleLog_1.StyleLog.createUpdate(comment.nameorid, comment.objecttype, value, \"background-image\", koobooId);\r\n                }\r\n                let record = new Record_1.operationRecord([unit], [log], guid);\r\n                context_1.default.operationManager.add(record);\r\n            });\r\n        };\r\n        contiainer.appendChild(imagePreview);\r\n    }\r\n    return contiainer;\r\n}\r\nexports.createStyleImagePanel = createStyleImagePanel;\r\n\n\n//# sourceURL=webpack:///./src/components/globalImageEditor/styleImagePanel.ts?");

/***/ }),

/***/ "./src/components/globalImageEditor/utils.ts":
/*!***************************************************!*\
  !*** ./src/components/globalImageEditor/utils.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst events_1 = __webpack_require__(/*! @/dom/events */ \"./src/dom/events.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction setImagePreview(preview, el) {\r\n    preview.style.width = \"150px\";\r\n    preview.style.height = \"150px\";\r\n    preview.style.display = \"inline-block\";\r\n    preview.style.margin = \"15px\";\r\n    preview.onmouseover = () => {\r\n        context_1.default.lastMouseEventArg = new MouseEvent(\"\");\r\n        el.scrollIntoView();\r\n        events_1.emitHoverEvent(el);\r\n        events_1.emitSelectedEvent();\r\n    };\r\n}\r\nexports.setImagePreview = setImagePreview;\r\n\n\n//# sourceURL=webpack:///./src/components/globalImageEditor/utils.ts?");

/***/ }),

/***/ "./src/components/globalLinkEditor/contentLinkPanel.ts":
/*!*************************************************************!*\
  !*** ./src/components/globalLinkEditor/contentLinkPanel.ts ***!
  \*************************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! ./utils */ \"./src/components/globalLinkEditor/utils.ts\");\r\nconst linkPicker_1 = __webpack_require__(/*! ../linkPicker */ \"./src/components/linkPicker/index.ts\");\r\nconst attributeUnit_1 = __webpack_require__(/*! @/operation/recordUnits/attributeUnit */ \"./src/operation/recordUnits/attributeUnit.ts\");\r\nconst ContentLog_1 = __webpack_require__(/*! @/operation/recordLogs/ContentLog */ \"./src/operation/recordLogs/ContentLog.ts\");\r\nconst Record_1 = __webpack_require__(/*! @/operation/Record */ \"./src/operation/Record.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst utils_4 = __webpack_require__(/*! ../floatMenu/utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createContentLinkPanel() {\r\n    let contiainer = element_1.createDiv();\r\n    for (const element of utils_1.getAllElement(document.body)) {\r\n        if (element instanceof HTMLElement && utils_1.isLink(element)) {\r\n            let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n            let comment = utils_4.getAttributeComment(comments, \"href\");\r\n            if (!comment || !comment.fieldname || comment.attributename != \"href\")\r\n                continue;\r\n            let { item, setLabel } = utils_3.createLinkItem(element, () => __awaiter(this, void 0, void 0, function* () {\r\n                let startContent = element.getAttribute(\"href\");\r\n                try {\r\n                    let newValue = yield linkPicker_1.createLinkPicker(startContent);\r\n                    element.setAttribute(\"href\", newValue);\r\n                    let guid = utils_2.setGuid(element);\r\n                    let value = element.getAttribute(\"href\");\r\n                    let unit = new attributeUnit_1.AttributeUnit(startContent, \"href\");\r\n                    let log = ContentLog_1.ContentLog.createUpdate(comment.nameorid, comment.fieldname, value);\r\n                    let record = new Record_1.operationRecord([unit], [log], guid);\r\n                    context_1.default.operationManager.add(record);\r\n                    setLabel(newValue);\r\n                }\r\n                catch (error) {\r\n                    element.setAttribute(\"href\", startContent);\r\n                }\r\n            }));\r\n            contiainer.appendChild(item);\r\n        }\r\n    }\r\n    if (contiainer.children.length > 0) {\r\n        let el = contiainer.children.item(contiainer.children.length - 1);\r\n        el.style.borderBottom = \"none\";\r\n    }\r\n    return contiainer;\r\n}\r\nexports.createContentLinkPanel = createContentLinkPanel;\r\n\n\n//# sourceURL=webpack:///./src/components/globalLinkEditor/contentLinkPanel.ts?");

/***/ }),

/***/ "./src/components/globalLinkEditor/domLinkPanel.ts":
/*!*********************************************************!*\
  !*** ./src/components/globalLinkEditor/domLinkPanel.ts ***!
  \*********************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ./utils */ \"./src/components/globalLinkEditor/utils.ts\");\r\nconst utils_3 = __webpack_require__(/*! ../floatMenu/utils */ \"./src/components/floatMenu/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! @/kooboo/KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst utils_4 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createDomLinkPanel() {\r\n    let contiainer = element_1.createDiv();\r\n    for (const element of utils_1.getAllElement(document.body)) {\r\n        if (element instanceof HTMLElement && utils_1.isLink(element)) {\r\n            let comments = KoobooComment_1.KoobooComment.getComments(element);\r\n            let koobooId = element.getAttribute(constants_1.KOOBOO_ID);\r\n            if (!koobooId)\r\n                continue;\r\n            if (utils_3.getMenuComment(comments))\r\n                continue;\r\n            if (utils_3.getFormComment(comments))\r\n                continue;\r\n            if (utils_3.getHtmlBlockComment(comments))\r\n                continue;\r\n            if (utils_3.getAttributeComment(comments))\r\n                continue;\r\n            let urlComment = utils_3.getUrlComment(comments);\r\n            let viewComment = utils_3.getViewComment(comments);\r\n            let { item, setLabel } = utils_2.createLinkItem(element, () => __awaiter(this, void 0, void 0, function* () {\r\n                let url;\r\n                let { koobooId: parentKoobooId, parent } = utils_4.getCleanParent(element);\r\n                if (utils_4.isDirty(element) && parent) {\r\n                    url = yield utils_3.updateDomLink(parent, parentKoobooId, element, viewComment);\r\n                }\r\n                else if (urlComment) {\r\n                    url = yield utils_3.updateUrlLink(element, koobooId, urlComment, viewComment);\r\n                }\r\n                else {\r\n                    url = yield utils_3.updateAttributeLink(element, koobooId, viewComment);\r\n                }\r\n                if (url != undefined)\r\n                    setLabel(url);\r\n            }));\r\n            contiainer.appendChild(item);\r\n        }\r\n    }\r\n    if (contiainer.children.length > 0) {\r\n        let el = contiainer.children.item(contiainer.children.length - 1);\r\n        el.style.borderBottom = \"none\";\r\n    }\r\n    return contiainer;\r\n}\r\nexports.createDomLinkPanel = createDomLinkPanel;\r\n\n\n//# sourceURL=webpack:///./src/components/globalLinkEditor/domLinkPanel.ts?");

/***/ }),

/***/ "./src/components/globalLinkEditor/index.ts":
/*!**************************************************!*\
  !*** ./src/components/globalLinkEditor/index.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! ../modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst tabs_1 = __webpack_require__(/*! ../common/tabs */ \"./src/components/common/tabs.ts\");\r\nconst domLinkPanel_1 = __webpack_require__(/*! ./domLinkPanel */ \"./src/components/globalLinkEditor/domLinkPanel.ts\");\r\nconst contentLinkPanel_1 = __webpack_require__(/*! ./contentLinkPanel */ \"./src/components/globalLinkEditor/contentLinkPanel.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createGlobalLinkEditor() {\r\n    const options = [\r\n        {\r\n            title: lang_1.TEXT.DOM_LINKS,\r\n            selected: true,\r\n            panel: domLinkPanel_1.createDomLinkPanel()\r\n        },\r\n        {\r\n            title: lang_1.TEXT.CONTENT_LINKS,\r\n            panel: contentLinkPanel_1.createContentLinkPanel()\r\n        }\r\n    ];\r\n    let tabs = tabs_1.createTabs(options);\r\n    const { modal, hideCancel } = modal_1.createModal(lang_1.TEXT.EDIT_LINKS, tabs, \"500px\", \"500px\");\r\n    hideCancel();\r\n    context_1.default.container.appendChild(modal);\r\n}\r\nexports.createGlobalLinkEditor = createGlobalLinkEditor;\r\n\n\n//# sourceURL=webpack:///./src/components/globalLinkEditor/index.ts?");

/***/ }),

/***/ "./src/components/globalLinkEditor/utils.ts":
/*!**************************************************!*\
  !*** ./src/components/globalLinkEditor/utils.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst events_1 = __webpack_require__(/*! @/dom/events */ \"./src/dom/events.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createLinkItem(el, onEdit) {\r\n    let item = element_1.createDiv();\r\n    item.classList.add(\"kb_web_editor_global_link_editor_item\");\r\n    item.onmouseover = () => {\r\n        context_1.default.lastMouseEventArg = new MouseEvent(\"\");\r\n        el.scrollIntoView();\r\n        events_1.emitHoverEvent(el);\r\n        events_1.emitSelectedEvent();\r\n    };\r\n    let label = element_1.createDiv();\r\n    label.innerText = el.getAttribute(\"href\");\r\n    let button = element_1.createButton(lang_1.TEXT.EDIT);\r\n    button.onclick = onEdit;\r\n    item.appendChild(label);\r\n    item.appendChild(button);\r\n    return {\r\n        item,\r\n        setLabel: (s) => (label.innerText = s)\r\n    };\r\n}\r\nexports.createLinkItem = createLinkItem;\r\n\n\n//# sourceURL=webpack:///./src/components/globalLinkEditor/utils.ts?");

/***/ }),

/***/ "./src/components/imagePicker/index.ts":
/*!*********************************************!*\
  !*** ./src/components/imagePicker/index.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! ../modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst imagePreview_1 = __webpack_require__(/*! ../common/imagePreview */ \"./src/components/common/imagePreview.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createImagePicker(img) {\r\n    let container = element_1.createDiv();\r\n    let { imagePreview, setImage } = imagePreview_1.createImagePreview();\r\n    imagePreview.style.margin = \"8px auto 16px auto\";\r\n    let style = JSON.parse(JSON.stringify(getComputedStyle(img)));\r\n    style.width = style.width == \"0px\" ? \"auto\" : style.width;\r\n    style.height = style.height == \"0px\" ? \"auto\" : style.height;\r\n    setImage(img.src);\r\n    imagePreview.onclick = () => {\r\n        outsideInterfaces_1.pickImg(path => {\r\n            setImage(path);\r\n            img.src = path;\r\n            img.style.width = style.width;\r\n            img.style.height = style.height;\r\n        });\r\n    };\r\n    container.appendChild(imagePreview);\r\n    let alt = element_1.createLabelInput(lang_1.TEXT.ALT);\r\n    alt.setContent(img.alt);\r\n    container.appendChild(alt.input);\r\n    alt.setInputHandler(e => {\r\n        if (e.target instanceof HTMLInputElement) {\r\n            img.alt = e.target.value;\r\n        }\r\n    });\r\n    let title = element_1.createLabelInput(lang_1.TEXT.TITLE);\r\n    title.setContent(img.title);\r\n    container.appendChild(title.input);\r\n    title.setInputHandler(e => {\r\n        if (e.target instanceof HTMLInputElement) {\r\n            img.title = e.target.value;\r\n        }\r\n    });\r\n    let width = element_1.createLabelInput(lang_1.TEXT.WIDTH);\r\n    width.input.style.width = \"50%\";\r\n    width.setInputHandler(e => {\r\n        if (e.target instanceof HTMLInputElement) {\r\n            img.style.width = e.target.value;\r\n            style.width = e.target.value;\r\n        }\r\n    });\r\n    width.setContent(style.width);\r\n    container.appendChild(width.input);\r\n    let height = element_1.createLabelInput(lang_1.TEXT.HEIGHT);\r\n    height.input.style.width = \"50%\";\r\n    height.setInputHandler(e => {\r\n        if (e.target instanceof HTMLInputElement) {\r\n            img.style.height = e.target.value;\r\n            style.height = e.target.value;\r\n        }\r\n    });\r\n    height.setContent(style.height);\r\n    container.appendChild(height.input);\r\n    const { modal, setOkHandler, setCancelHandler, close } = modal_1.createModal(lang_1.TEXT.EDIT_IMAGE, container, \"450px\");\r\n    context_1.default.container.appendChild(modal);\r\n    return new Promise((rs, rj) => {\r\n        setOkHandler(() => {\r\n            rs();\r\n            close();\r\n        });\r\n        setCancelHandler(() => {\r\n            rj();\r\n            close();\r\n        });\r\n    });\r\n}\r\nexports.createImagePicker = createImagePicker;\r\n\n\n//# sourceURL=webpack:///./src/components/imagePicker/index.ts?");

/***/ }),

/***/ "./src/components/linkPicker/index.ts":
/*!********************************************!*\
  !*** ./src/components/linkPicker/index.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! ../modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst tabs_1 = __webpack_require__(/*! ../common/tabs */ \"./src/components/common/tabs.ts\");\r\nconst outLinkPanel_1 = __webpack_require__(/*! ./outLinkPanel */ \"./src/components/linkPicker/outLinkPanel.ts\");\r\nconst pageLinkPanel_1 = __webpack_require__(/*! ./pageLinkPanel */ \"./src/components/linkPicker/pageLinkPanel.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createLinkPicker(oldValue) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let el = element_1.createDiv();\r\n        const { pageLinkPanel, getContent: getPageLinkContent } = yield pageLinkPanel_1.createPageLinkPanel(oldValue);\r\n        const { outLinkPanel, getContent: getOutLinkContent, setContent } = outLinkPanel_1.createOutLinkPanel();\r\n        const options = [\r\n            {\r\n                title: lang_1.TEXT.PAGE_LINK,\r\n                panel: pageLinkPanel,\r\n                selected: !!getPageLinkContent(),\r\n                getContent: getPageLinkContent\r\n            },\r\n            {\r\n                title: lang_1.TEXT.OUT_LINK,\r\n                selected: !getPageLinkContent(),\r\n                panel: outLinkPanel,\r\n                getContent: getOutLinkContent\r\n            }\r\n        ];\r\n        setContent(oldValue);\r\n        el.appendChild(tabs_1.createTabs(options));\r\n        let { modal, setOkHandler, close } = modal_1.createModal(lang_1.TEXT.EDIT_LINK, el, \"400px\", \"500px\");\r\n        context_1.default.container.appendChild(modal);\r\n        return new Promise((rs, rj) => {\r\n            setOkHandler(() => __awaiter(this, void 0, void 0, function* () {\r\n                let result = \"\";\r\n                let option = options.find(f => f.selected);\r\n                if (option)\r\n                    result = option.getContent();\r\n                if (result && result != oldValue)\r\n                    rs(result);\r\n                else\r\n                    rj();\r\n                close();\r\n            }));\r\n        });\r\n    });\r\n}\r\nexports.createLinkPicker = createLinkPicker;\r\n\n\n//# sourceURL=webpack:///./src/components/linkPicker/index.ts?");

/***/ }),

/***/ "./src/components/linkPicker/outLinkPanel.ts":
/*!***************************************************!*\
  !*** ./src/components/linkPicker/outLinkPanel.ts ***!
  \***************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createOutLinkPanel() {\r\n    let el = element_1.createInput();\r\n    el.style.width = \"100%\";\r\n    el.placeholder = \"http://\";\r\n    return {\r\n        outLinkPanel: el,\r\n        setContent: (content) => (el.value = content),\r\n        getContent: () => el.value\r\n    };\r\n}\r\nexports.createOutLinkPanel = createOutLinkPanel;\r\n\n\n//# sourceURL=webpack:///./src/components/linkPicker/outLinkPanel.ts?");

/***/ }),

/***/ "./src/components/linkPicker/pageLinkPanel.ts":
/*!****************************************************!*\
  !*** ./src/components/linkPicker/pageLinkPanel.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createPageLinkPanel(oldValue) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let urls = yield outsideInterfaces_1.getPageUrls();\r\n        let el = element_1.createDiv();\r\n        let selectedItem;\r\n        let radios = urls.map(m => element_1.createRadioInput(m));\r\n        radios.forEach(i => {\r\n            i.radio.onclick = () => {\r\n                radios.filter(f => f != i).forEach(f => f.setChecked(false));\r\n                i.setChecked(true);\r\n                selectedItem = i.getContent();\r\n            };\r\n            if (i.getContent() == oldValue) {\r\n                i.setChecked(true);\r\n                selectedItem = oldValue;\r\n            }\r\n            el.appendChild(i.radio);\r\n        });\r\n        if (radios.length > 0)\r\n            radios[radios.length - 1].radio.style.borderBottom = \"none\";\r\n        return {\r\n            pageLinkPanel: el,\r\n            getContent: () => selectedItem\r\n        };\r\n    });\r\n}\r\nexports.createPageLinkPanel = createPageLinkPanel;\r\n\n\n//# sourceURL=webpack:///./src/components/linkPicker/pageLinkPanel.ts?");

/***/ }),

/***/ "./src/components/modal/body.ts":
/*!**************************************!*\
  !*** ./src/components/modal/body.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createBody(height) {\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_modal_body\");\r\n    if (height != undefined)\r\n        el.style.maxHeight = height;\r\n    let result = [\r\n        el,\r\n        c => {\r\n            if (c instanceof HTMLElement) {\r\n                el.appendChild(c);\r\n            }\r\n            else {\r\n                el.innerHTML = c;\r\n            }\r\n        }\r\n    ];\r\n    return result;\r\n}\r\nexports.createBody = createBody;\r\n\n\n//# sourceURL=webpack:///./src/components/modal/body.ts?");

/***/ }),

/***/ "./src/components/modal/container.ts":
/*!*******************************************!*\
  !*** ./src/components/modal/container.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createContainer(width) {\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_modal\");\r\n    el.style.zIndex = constants_1.STANDARD_Z_INDEX + 5 + \"\";\r\n    let win = element_1.createDiv();\r\n    win.classList.add(\"kb_web_editor_modal_window\");\r\n    if (width != undefined)\r\n        win.style.width = width;\r\n    el.appendChild(win);\r\n    return {\r\n        shade: el,\r\n        win\r\n    };\r\n}\r\nexports.createContainer = createContainer;\r\n\n\n//# sourceURL=webpack:///./src/components/modal/container.ts?");

/***/ }),

/***/ "./src/components/modal/footer.ts":
/*!****************************************!*\
  !*** ./src/components/modal/footer.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createFooter() {\r\n    let el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_modal_footer\");\r\n    let ok = element_1.createPrimaryButton(lang_1.TEXT.OK);\r\n    let cancel = element_1.createButton(lang_1.TEXT.CANCEL);\r\n    el.appendChild(ok);\r\n    el.appendChild(cancel);\r\n    return { footer: el, ok, cancel };\r\n}\r\nexports.createFooter = createFooter;\r\n\n\n//# sourceURL=webpack:///./src/components/modal/footer.ts?");

/***/ }),

/***/ "./src/components/modal/header.ts":
/*!****************************************!*\
  !*** ./src/components/modal/header.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst guanbi_gray_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/guanbi-gray.svg */ \"./src/assets/icons/guanbi-gray.svg\"));\r\nfunction createHeader(title, parent) {\r\n    var el = element_1.createDiv();\r\n    el.classList.add(\"kb_web_editor_modal_header\");\r\n    el.appendChild(document.createTextNode(title));\r\n    let closeBtn = element_1.createDiv();\r\n    closeBtn.style.backgroundImage = `url(${guanbi_gray_svg_1.default})`;\r\n    el.appendChild(closeBtn);\r\n    el.draggable = true;\r\n    let temp;\r\n    el.ondragstart = (e) => {\r\n        let rect = parent.getBoundingClientRect();\r\n        temp = { x: e.x - rect.left, y: e.y - rect.top };\r\n    };\r\n    el.ondrag = e => {\r\n        if (e.x == 0 || e.y == 0)\r\n            return;\r\n        parent.style.marginLeft = e.x - temp.x + \"px\";\r\n        parent.style.marginTop = e.y - temp.y + \"px\";\r\n    };\r\n    return { header: el, close: closeBtn };\r\n}\r\nexports.createHeader = createHeader;\r\n\n\n//# sourceURL=webpack:///./src/components/modal/header.ts?");

/***/ }),

/***/ "./src/components/modal/index.ts":
/*!***************************************!*\
  !*** ./src/components/modal/index.ts ***!
  \***************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst container_1 = __webpack_require__(/*! ./container */ \"./src/components/modal/container.ts\");\r\nconst header_1 = __webpack_require__(/*! ./header */ \"./src/components/modal/header.ts\");\r\nconst footer_1 = __webpack_require__(/*! ./footer */ \"./src/components/modal/footer.ts\");\r\nconst body_1 = __webpack_require__(/*! ./body */ \"./src/components/modal/body.ts\");\r\nfunction createModal(title, content, width, height) {\r\n    let { shade, win } = container_1.createContainer(width);\r\n    const [body, setBodyContent] = body_1.createBody(height);\r\n    const { footer, ok, cancel } = footer_1.createFooter();\r\n    const { header, close } = header_1.createHeader(title, win);\r\n    setBodyContent(content);\r\n    const recovery = () => {\r\n        shade.parentElement.removeChild(shade);\r\n    };\r\n    ok.onclick = recovery;\r\n    cancel.onclick = recovery;\r\n    close.onclick = recovery;\r\n    win.appendChild(header);\r\n    win.appendChild(body);\r\n    win.appendChild(footer);\r\n    return {\r\n        modal: shade,\r\n        setOkHandler: (h) => (ok.onclick = h),\r\n        setCancelHandler: (h) => {\r\n            cancel.onclick = h;\r\n            close.onclick = h;\r\n        },\r\n        close: recovery,\r\n        hideCancel: () => (cancel.hidden = true)\r\n    };\r\n}\r\nexports.createModal = createModal;\r\n\n\n//# sourceURL=webpack:///./src/components/modal/index.ts?");

/***/ }),

/***/ "./src/components/richEditor/index.ts":
/*!********************************************!*\
  !*** ./src/components/richEditor/index.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst tinymce_1 = __webpack_require__(/*! tinymce */ \"./node_modules/tinymce/tinymce.js\");\r\n__webpack_require__(/*! tinymce/themes/silver */ \"./node_modules/tinymce/themes/silver/index.js\");\r\n__webpack_require__(/*! tinymce/plugins/save */ \"./node_modules/tinymce/plugins/save/index.js\");\r\n__webpack_require__(/*! tinymce/plugins/link */ \"./node_modules/tinymce/plugins/link/index.js\");\r\n__webpack_require__(/*! tinymce/plugins/image */ \"./node_modules/tinymce/plugins/image/index.js\");\r\nconst settings_1 = __webpack_require__(/*! ./settings */ \"./src/components/richEditor/settings.ts\");\r\nfunction createEditor(settings) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let selector = settings.target;\r\n        tinymce_1.init(settings);\r\n        if (selector instanceof HTMLElement)\r\n            selector.focus();\r\n    });\r\n}\r\nfunction setInlineEditor(args) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let settings = settings_1.createSettings(args);\r\n        createEditor(settings);\r\n    });\r\n}\r\nexports.setInlineEditor = setInlineEditor;\r\n\n\n//# sourceURL=webpack:///./src/components/richEditor/index.ts?");

/***/ }),

/***/ "./src/components/richEditor/settings.ts":
/*!***********************************************!*\
  !*** ./src/components/richEditor/settings.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst context_1 = __importDefault(__webpack_require__(/*! ../../common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! ./utils */ \"./src/components/richEditor/utils.ts\");\r\nconst linkPicker_1 = __webpack_require__(/*! ../linkPicker */ \"./src/components/linkPicker/index.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nfunction createSettings(args) {\r\n    const { selector, onSave, onCancel } = args;\r\n    const settings = {\r\n        target: selector,\r\n        inline: true,\r\n        hidden_input: false,\r\n        skin_url: `${location.origin}\\\\_Admin\\\\Styles\\\\kooboo-web-editor\\\\tinymce\\\\ui\\\\oxide`,\r\n        menubar: false,\r\n        element_format: \"html\",\r\n        allow_script_urls: true,\r\n        style_formats_merge: false,\r\n        style_formats_autohide: false,\r\n        allow_conditional_comments: true,\r\n        allow_html_in_named_anchor: true,\r\n        allow_unsafe_link_target: true,\r\n        convert_fonts_to_spans: false,\r\n        remove_trailing_brs: true,\r\n        browser_spellcheck: false,\r\n        forced_root_block: \"\",\r\n        visual_anchor_class: \"no-anchor\",\r\n        valid_elements: \"*[*]\",\r\n        valid_children: \"*[*]\",\r\n        valid_styles: \"width,height,color,font-size,font-family,background,background-color,background-image,font-weight,font-style,text-decoration,float,margin,margin-top,margin-right,margin-bottom,margin-left,display,text-align\",\r\n        plugins: [\"save\", \"link\", \"image\"],\r\n        toolbar: utils_1.getToolbar(selector),\r\n        init_instance_callback: utils_1.initInstanceCallback,\r\n        setup(editor) {\r\n            editor.on(\"Blur\", utils_1.onBlur);\r\n            editor.once(\"SetContent\", utils_1.onSetContent);\r\n            editor.on(\"Remove\", utils_1.onRemove);\r\n            editor.on(\"Change\", () => context_1.default.tinymceInputEvent.emit());\r\n            editor.on(\"KeyUp\", () => context_1.default.tinymceInputEvent.emit());\r\n            editor.on(\"KeyDown\", utils_1.onKeyDown);\r\n            editor.on(\"BeforeSetContent\", utils_1.onBeforeSetContent);\r\n        },\r\n        file_picker_callback(callback, value, meta) {\r\n            return __awaiter(this, void 0, void 0, function* () {\r\n                if (meta.filetype == \"image\") {\r\n                    outsideInterfaces_1.pickImg(path => {\r\n                        callback(path, {});\r\n                    });\r\n                }\r\n                else {\r\n                    try {\r\n                        let newValue = yield linkPicker_1.createLinkPicker(value);\r\n                        callback(newValue, {});\r\n                    }\r\n                    catch (error) { }\r\n                }\r\n            });\r\n        }\r\n    };\r\n    selector._position = selector.style.position;\r\n    utils_1.setLang(settings);\r\n    settings.save_enablewhendirty = false;\r\n    settings.save_onsavecallback = (e) => utils_1.savePluginCallback(e, onSave);\r\n    settings.save_oncancelcallback = (e) => utils_1.savePluginCallback(e, onCancel);\r\n    return settings;\r\n}\r\nexports.createSettings = createSettings;\r\n\n\n//# sourceURL=webpack:///./src/components/richEditor/settings.ts?");

/***/ }),

/***/ "./src/components/richEditor/utils.ts":
/*!********************************************!*\
  !*** ./src/components/richEditor/utils.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! ../../common/constants */ \"./src/common/constants.ts\");\r\nconst lang_1 = __webpack_require__(/*! ../../common/lang */ \"./src/common/lang.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! ../../common/context */ \"./src/common/context.ts\"));\r\nconst utils_1 = __webpack_require__(/*! ../../dom/utils */ \"./src/dom/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! ../../common/utils */ \"./src/common/utils.ts\");\r\nconst drag_move__fill_svg_1 = __importDefault(__webpack_require__(/*! @/assets/icons/drag-move--fill.svg */ \"./src/assets/icons/drag-move--fill.svg\"));\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction impoveEditorUI(editor) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        editor.focus(false);\r\n        let container = editor.getContainer();\r\n        if (container instanceof HTMLElement) {\r\n            container.style.zIndex = constants_1.STANDARD_Z_INDEX + 1 + \"\";\r\n            container.style.width = \"auto\";\r\n            yield utils_2.delay(100);\r\n            if (container.nextElementSibling instanceof HTMLElement) {\r\n                container.nextElementSibling.style.zIndex = constants_1.STANDARD_Z_INDEX + 2 + \"\";\r\n            }\r\n            let toolbar = container.getElementsByClassName(\"tox-toolbar\").item(0);\r\n            var moveBtn = element_1.createDiv();\r\n            moveBtn.draggable = true;\r\n            moveBtn.style.cursor = \"move\";\r\n            moveBtn.style.backgroundImage = `url(${drag_move__fill_svg_1.default})`;\r\n            moveBtn.style.backgroundPosition = `center`;\r\n            moveBtn.style.backgroundRepeat = `no-repeat`;\r\n            moveBtn.style.backgroundSize = `contain`;\r\n            moveBtn.style.height = \"26px\";\r\n            moveBtn.style.width = \"26px\";\r\n            moveBtn.style.margin = \"6px 0 6px 6px\";\r\n            toolbar.insertBefore(moveBtn, toolbar.children.item(0));\r\n            container.draggable = true;\r\n            const correctPositon = () => {\r\n                let rect = container.getBoundingClientRect();\r\n                if (rect.left < 0)\r\n                    container.style.left = \"0px\";\r\n                if (rect.top < 0)\r\n                    container.style.top = \"0px\";\r\n            };\r\n            correctPositon();\r\n            editor.on(\"MouseDown\", correctPositon);\r\n            editor.on(\"MouseUp\", correctPositon);\r\n            editor.on(\"KeyUp\", correctPositon);\r\n            container.ondrag = e => {\r\n                if (!(container instanceof HTMLElement))\r\n                    return;\r\n                container.style.position = \"fixed\";\r\n                if (e.x == 0 || e.y == 0)\r\n                    return;\r\n                container.style.top = e.y - 15 + \"px\";\r\n                container.style.left = e.x - 15 + \"px\";\r\n            };\r\n        }\r\n    });\r\n}\r\nexports.impoveEditorUI = impoveEditorUI;\r\nfunction setLang(settings) {\r\n    if (lang_1.lang == \"zh\") {\r\n        settings.language = \"zh_CN\";\r\n        settings.language_url = `${location.origin}\\\\_Admin\\\\Scripts\\\\kooboo-web-editor\\\\${settings.language}.js`;\r\n    }\r\n}\r\nexports.setLang = setLang;\r\nfunction onBlur() {\r\n    return false;\r\n}\r\nexports.onBlur = onBlur;\r\nfunction onSetContent(e) {\r\n    var targetElm = e.target.targetElm;\r\n    targetElm.style.position = targetElm._position;\r\n    for (const element of utils_1.getAllElement(targetElm, true)) {\r\n        if (element.innerHTML.indexOf(constants_1.EMPTY_COMMENT) == -1 && !utils_1.isTextArea(element)) {\r\n            element.innerHTML += constants_1.EMPTY_COMMENT;\r\n        }\r\n    }\r\n}\r\nexports.onSetContent = onSetContent;\r\nfunction onRemove(e) {\r\n    let element = e.target.getElement();\r\n    if (element instanceof HTMLElement) {\r\n        setTimeout(() => {\r\n            if (element.id.startsWith(\"mce_\"))\r\n                element.removeAttribute(\"id\");\r\n            if (element.getAttribute(\"style\") == \"\")\r\n                element.removeAttribute(\"style\");\r\n            for (const i of utils_1.getAllElement(document.body)) {\r\n                if (i.classList.contains(\"mce-item-table\")) {\r\n                    i.classList.remove(\"mce-item-table\");\r\n                }\r\n            }\r\n        });\r\n    }\r\n    context_1.default.editing = false;\r\n}\r\nexports.onRemove = onRemove;\r\nfunction onKeyDown(e) {\r\n    var targetElm = e.target;\r\n    if (e.code == \"Backspace\") {\r\n        let content = targetElm.innerHTML;\r\n        if (content.indexOf(constants_1.EMPTY_COMMENT) == -1 && !utils_1.isTextArea(targetElm))\r\n            targetElm.innerHTML += constants_1.EMPTY_COMMENT;\r\n    }\r\n    if (e.code == \"Backspace\" && targetElm.innerHTML == constants_1.EMPTY_COMMENT)\r\n        return false;\r\n}\r\nexports.onKeyDown = onKeyDown;\r\nfunction onBeforeSetContent(e) {\r\n    var targetElm = e.target.targetElm;\r\n    if (targetElm.tagName.toLowerCase() == \"li\") {\r\n        if (targetElm.children.length == 0) {\r\n            e.content = targetElm.textContent;\r\n        }\r\n        else if (e.content === 0) {\r\n            e.content = targetElm.innerHTML;\r\n        }\r\n    }\r\n    e.format = \"raw\";\r\n}\r\nexports.onBeforeSetContent = onBeforeSetContent;\r\nfunction getToolbar(el) {\r\n    let items = \"save cancel | undo redo | bold italic underline | forecolor backcolor | fontselect fontsizeselect | image \";\r\n    if (el.tagName.toLowerCase() != \"a\") {\r\n        items += \"| link unlink\";\r\n    }\r\n    return items;\r\n}\r\nexports.getToolbar = getToolbar;\r\nfunction initInstanceCallback(e) {\r\n    context_1.default.editing = true;\r\n    impoveEditorUI(e);\r\n    context_1.default.closeEditingEvent.addEventListener(() => {\r\n        e.execCommand(\"mcecancel\");\r\n        context_1.default.closeEditingEvent.handlers = [];\r\n    });\r\n}\r\nexports.initInstanceCallback = initInstanceCallback;\r\nfunction savePluginCallback(e, callBack) {\r\n    e.save = () => \"\";\r\n    e.remove();\r\n    callBack();\r\n}\r\nexports.savePluginCallback = savePluginCallback;\r\n\n\n//# sourceURL=webpack:///./src/components/richEditor/utils.ts?");

/***/ }),

/***/ "./src/components/selectorBorder/index.ts":
/*!************************************************!*\
  !*** ./src/components/selectorBorder/index.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst rect_1 = __webpack_require__(/*! ./rect */ \"./src/components/selectorBorder/rect.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nfunction createHoverBorder() {\r\n    const rect = rect_1.createRect(constants_1.HOVER_BORDER_WIDTH, constants_1.HOVER_BORDER_COLOR);\r\n    context_1.default.hoverDomEvent.addEventListener(e => {\r\n        if (!e.closeElement || context_1.default.editing) {\r\n            rect.hidden();\r\n            return;\r\n        }\r\n        rect.updatePosition(e.closeElement);\r\n    });\r\n    context_1.default.editableEvent.addEventListener(e => {\r\n        if (e)\r\n            rect.hidden();\r\n    });\r\n    return rect.el;\r\n}\r\nexports.createHoverBorder = createHoverBorder;\r\nfunction createSelectedBorder() {\r\n    const rect = rect_1.createRect(constants_1.SELECTED_BORDER_WIDTH, constants_1.SELECTED_BORDER_COLOR);\r\n    context_1.default.domChangeEvent.addEventListener(e => {\r\n        if (!e.element || context_1.default.editing) {\r\n            rect.hidden();\r\n            return;\r\n        }\r\n        rect.updatePosition(e.element);\r\n    });\r\n    context_1.default.editableEvent.addEventListener(e => {\r\n        if (e)\r\n            rect.hidden();\r\n    });\r\n    return rect.el;\r\n}\r\nexports.createSelectedBorder = createSelectedBorder;\r\n\n\n//# sourceURL=webpack:///./src/components/selectorBorder/index.ts?");

/***/ }),

/***/ "./src/components/selectorBorder/line.ts":
/*!***********************************************!*\
  !*** ./src/components/selectorBorder/line.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! ../../common/constants */ \"./src/common/constants.ts\");\r\nconst Position_1 = __webpack_require__(/*! @/common/Position */ \"./src/common/Position.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nexports.createLine = (width, color) => {\r\n    let el = element_1.createDiv();\r\n    el.style.position = \"absolute\";\r\n    el.style.display = \"block\";\r\n    el.style.pointerEvents = \"none\";\r\n    el.style.backgroundColor = color;\r\n    el.style.width = width + \"px\";\r\n    el.style.height = width + \"px\";\r\n    el.style.zIndex = constants_1.STANDARD_Z_INDEX - 2 + \"\";\r\n    const update = (position) => Position_1.updatePositon(position, el);\r\n    return { el, update };\r\n};\r\n\n\n//# sourceURL=webpack:///./src/components/selectorBorder/line.ts?");

/***/ }),

/***/ "./src/components/selectorBorder/rect.ts":
/*!***********************************************!*\
  !*** ./src/components/selectorBorder/rect.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst line_1 = __webpack_require__(/*! ./line */ \"./src/components/selectorBorder/line.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nexports.createRect = (width, color) => {\r\n    const lines = [line_1.createLine(width, color), line_1.createLine(width, color), line_1.createLine(width, color), line_1.createLine(width, color)];\r\n    const el = element_1.createDiv();\r\n    lines.forEach(i => el.appendChild(i.el));\r\n    const updatePosition = (referenceEl) => {\r\n        el.style.display = \"block\";\r\n        let [top, right, bottom, left] = lines;\r\n        let referenceRect = referenceEl.getBoundingClientRect();\r\n        let htmlRect = document.documentElement.getBoundingClientRect();\r\n        top.update({\r\n            top: referenceRect.top - htmlRect.top,\r\n            left: referenceRect.left - htmlRect.left + width,\r\n            width: referenceEl.offsetWidth - width * 2\r\n        });\r\n        right.update({\r\n            top: referenceRect.top - htmlRect.top,\r\n            left: referenceRect.left - htmlRect.left - width + referenceEl.offsetWidth,\r\n            height: referenceEl.offsetHeight\r\n        });\r\n        bottom.update({\r\n            top: referenceRect.top - htmlRect.top + referenceEl.offsetHeight - width,\r\n            left: referenceRect.left - htmlRect.left + width,\r\n            width: referenceEl.offsetWidth - width * 2\r\n        });\r\n        left.update({\r\n            top: referenceRect.top - htmlRect.top,\r\n            left: referenceRect.left - htmlRect.left,\r\n            height: referenceEl.offsetHeight\r\n        });\r\n    };\r\n    const hidden = () => {\r\n        el.style.display = \"none\";\r\n    };\r\n    return {\r\n        el,\r\n        updatePosition,\r\n        hidden\r\n    };\r\n};\r\n\n\n//# sourceURL=webpack:///./src/components/selectorBorder/rect.ts?");

/***/ }),

/***/ "./src/components/styleEditor/index.ts":
/*!*********************************************!*\
  !*** ./src/components/styleEditor/index.ts ***!
  \*********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! ../modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst spliter_1 = __webpack_require__(/*! ./spliter */ \"./src/components/styleEditor/spliter.ts\");\r\nconst colorPicker_1 = __webpack_require__(/*! ../common/colorPicker */ \"./src/components/common/colorPicker.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! @/kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst imagePreview_1 = __webpack_require__(/*! ../common/imagePreview */ \"./src/components/common/imagePreview.ts\");\r\nconst Background_1 = __webpack_require__(/*! @/dom/Background */ \"./src/dom/Background.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nfunction createStyleEditor(el) {\r\n    const container = element_1.createDiv();\r\n    addImg(container, el);\r\n    addColor(container, el);\r\n    addSize(container, el);\r\n    addFont(container, el);\r\n    const { modal, setOkHandler, setCancelHandler, close } = modal_1.createModal(lang_1.TEXT.EDIT_STYLE, container, \"450px\");\r\n    context_1.default.container.appendChild(modal);\r\n    return new Promise((rs, rj) => {\r\n        setOkHandler(() => {\r\n            rs();\r\n            close();\r\n        });\r\n        setCancelHandler(() => {\r\n            rj();\r\n            close();\r\n        });\r\n    });\r\n}\r\nexports.createStyleEditor = createStyleEditor;\r\nfunction addImg(container, el) {\r\n    const spliter = spliter_1.createSpliter(lang_1.TEXT.BACKGROUND_IMAGE);\r\n    spliter.style.margin = \"0 0 15px 0\";\r\n    container.appendChild(spliter);\r\n    let { image, imageInBackground } = utils_1.getBackgroundImage(el);\r\n    const { imagePreview, setImage } = imagePreview_1.createImagePreview(true, () => utils_1.clearBackgroundImage(el, imageInBackground));\r\n    imagePreview.style.marginLeft = \"auto\";\r\n    imagePreview.style.marginRight = \"auto\";\r\n    imagePreview.style.marginBottom = \"15px\";\r\n    container.appendChild(imagePreview);\r\n    if (image)\r\n        setImage(image);\r\n    imagePreview.onclick = () => {\r\n        outsideInterfaces_1.pickImg(path => {\r\n            if (imageInBackground) {\r\n                let background = new Background_1.Background(el.style.background);\r\n                background.image = `url('${path}')`;\r\n                el.style.background = background.toString();\r\n            }\r\n            else {\r\n                el.style.backgroundImage = `url('${path}')`;\r\n            }\r\n            setImage(path);\r\n        });\r\n    };\r\n}\r\nfunction addColor(container, el) {\r\n    container.appendChild(spliter_1.createSpliter(lang_1.TEXT.COLOR));\r\n    let style = getComputedStyle(el);\r\n    let bgPicker = colorPicker_1.createColorPicker(lang_1.TEXT.BACKGROUND_COLOR, style.backgroundColor, e => (el.style.backgroundColor = e));\r\n    container.appendChild(bgPicker);\r\n    let frontPicker = colorPicker_1.createColorPicker(lang_1.TEXT.COLOR, style.color, e => (el.style.color = e));\r\n    container.appendChild(frontPicker);\r\n}\r\nfunction addFont(container, el) {\r\n    container.appendChild(spliter_1.createSpliter(lang_1.TEXT.FONT));\r\n    let style = getComputedStyle(el);\r\n    let size = element_1.createLabelInput(lang_1.TEXT.FONT_SIZE, 90);\r\n    size.input.style.width = \"50%\";\r\n    size.setContent(style.fontSize);\r\n    size.setInputHandler(content => {\r\n        el.style.fontSize = content.target.value;\r\n    });\r\n    container.appendChild(size.input);\r\n    let weight = element_1.createLabelInput(lang_1.TEXT.FONT_WEIGHT, 90);\r\n    weight.input.style.width = \"50%\";\r\n    weight.setContent(style.fontWeight);\r\n    weight.setInputHandler(content => {\r\n        el.style.fontWeight = content.target.value;\r\n    });\r\n    container.appendChild(weight.input);\r\n    let family = element_1.createLabelInput(lang_1.TEXT.FONT_FAMILY, 90);\r\n    family.setContent(style.fontFamily);\r\n    family.setInputHandler(content => {\r\n        el.style.fontFamily = content.target.value;\r\n    });\r\n    container.appendChild(family.input);\r\n}\r\nfunction addSize(container, el) {\r\n    container.appendChild(spliter_1.createSpliter(lang_1.TEXT.SIZE));\r\n    let style = getComputedStyle(el);\r\n    let width = element_1.createLabelInput(lang_1.TEXT.WIDTH, 90);\r\n    width.input.style.width = \"50%\";\r\n    width.setContent(style.width);\r\n    width.setInputHandler(content => {\r\n        el.style.width = content.target.value;\r\n    });\r\n    container.appendChild(width.input);\r\n    let height = element_1.createLabelInput(lang_1.TEXT.HEIGHT, 90);\r\n    height.input.style.width = \"50%\";\r\n    height.setContent(style.height);\r\n    height.setInputHandler(content => {\r\n        el.style.height = content.target.value;\r\n    });\r\n    container.appendChild(height.input);\r\n}\r\n\n\n//# sourceURL=webpack:///./src/components/styleEditor/index.ts?");

/***/ }),

/***/ "./src/components/styleEditor/spliter.ts":
/*!***********************************************!*\
  !*** ./src/components/styleEditor/spliter.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nfunction createSpliter(text) {\r\n    let el = element_1.createDiv();\r\n    el.innerText = text;\r\n    el.style.padding = \"3px 5px\";\r\n    el.style.margin = \"5px 0\";\r\n    el.style.borderBottom = \"1px solid #eee\";\r\n    return el;\r\n}\r\nexports.createSpliter = createSpliter;\r\n\n\n//# sourceURL=webpack:///./src/components/styleEditor/spliter.ts?");

/***/ }),

/***/ "./src/dom/Background.ts":
/*!*******************************!*\
  !*** ./src/dom/Background.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass Background {\r\n    constructor(value) {\r\n        this.value = value;\r\n        let temp = document.createElement(\"div\");\r\n        temp.style.background = value;\r\n        this.image = temp.style.backgroundImage;\r\n        this.color = temp.style.backgroundColor;\r\n        this.position = temp.style.backgroundPosition;\r\n        this.size = temp.style.backgroundSize;\r\n        this.repeat = temp.style.backgroundRepeat;\r\n        this.origin = temp.style.backgroundOrigin;\r\n        this.clip = temp.style.backgroundClip;\r\n        this.attachment = temp.style.backgroundAttachment;\r\n    }\r\n    toString() {\r\n        let result = \"\";\r\n        if (this.color && this.color != \"initial\")\r\n            result += `${this.color} `;\r\n        if (this.image && this.image != \"initial\")\r\n            result += `${this.image} `;\r\n        if (this.position && this.position != \"initial\")\r\n            result += `${this.position} `;\r\n        if (this.size && this.size != \"initial\")\r\n            result += `${this.size} `;\r\n        if (this.repeat && this.repeat != \"initial\")\r\n            result += `${this.repeat} `;\r\n        if (this.origin && this.origin != \"initial\")\r\n            result += `${this.origin} `;\r\n        if (this.clip && this.clip != \"initial\")\r\n            result += `${this.clip} `;\r\n        if (this.attachment && this.attachment != \"initial\")\r\n            result += `${this.attachment} `;\r\n        return result;\r\n    }\r\n}\r\nexports.Background = Background;\r\n\n\n//# sourceURL=webpack:///./src/dom/Background.ts?");

/***/ }),

/***/ "./src/dom/Border.ts":
/*!***************************!*\
  !*** ./src/dom/Border.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass Border {\r\n    constructor(value) {\r\n        this.value = value;\r\n        let temp = document.createElement(\"div\");\r\n        temp.style.border = value;\r\n        this.width = temp.style.borderWidth;\r\n        this.style = temp.style.borderStyle;\r\n        this.color = temp.style.borderColor;\r\n    }\r\n    toString() {\r\n        let result = \"\";\r\n        if (this.width && this.width != \"initial\")\r\n            result += `${this.width} `;\r\n        if (this.style && this.style != \"initial\")\r\n            result += `${this.style} `;\r\n        if (this.color && this.color != \"initial\")\r\n            result += `${this.color} `;\r\n        return result;\r\n    }\r\n}\r\nexports.Border = Border;\r\n\n\n//# sourceURL=webpack:///./src/dom/Border.ts?");

/***/ }),

/***/ "./src/dom/BoxShadow.ts":
/*!******************************!*\
  !*** ./src/dom/BoxShadow.ts ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass BoxShadow {\r\n    constructor(value) {\r\n        this.value = value;\r\n        this.hShadow = \"0px\";\r\n        this.vShadow = \"0px\";\r\n        this.blur = \"0px\";\r\n        this.spread = \"0px\";\r\n        this.color = \"#fff0\";\r\n        this.inset = null;\r\n        value = value.replace(\";\", \"\");\r\n        if (value.indexOf(\"inset\") > -1) {\r\n            value = value.replace(\"inset\", \"\");\r\n            this.inset = \"inset\";\r\n        }\r\n        value = value.replace(/\\s+/, \" \");\r\n        let values = value.trim().split(\" \");\r\n        if (values.length < 3 || values.length > 5) {\r\n            return;\r\n        }\r\n        if (values.length == 3) {\r\n            this.hShadow = values[0];\r\n            this.vShadow = values[1];\r\n            this.color = values[2];\r\n        }\r\n        if (values.length == 4) {\r\n            this.hShadow = values[0];\r\n            this.vShadow = values[1];\r\n            this.blur = values[2];\r\n            this.color = values[3];\r\n        }\r\n        if (values.length == 5) {\r\n            this.hShadow = values[0];\r\n            this.vShadow = values[1];\r\n            this.blur = values[2];\r\n            this.spread = values[3];\r\n            this.color = values[4];\r\n        }\r\n    }\r\n    toString() {\r\n        let result = `${this.hShadow} ${this.vShadow} ${this.blur} ${this.spread} ${this.color} ${this.inset || \"\"}`;\r\n        return result;\r\n    }\r\n}\r\nexports.BoxShadow = BoxShadow;\r\n\n\n//# sourceURL=webpack:///./src/dom/BoxShadow.ts?");

/***/ }),

/***/ "./src/dom/Outline.ts":
/*!****************************!*\
  !*** ./src/dom/Outline.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass Outline {\r\n    constructor(value) {\r\n        this.value = value;\r\n        let temp = document.createElement(\"div\");\r\n        temp.style.border = value;\r\n        this.width = temp.style.borderWidth;\r\n        this.style = temp.style.borderStyle;\r\n        this.color = temp.style.borderColor;\r\n    }\r\n    toString() {\r\n        let result = \"\";\r\n        if (this.width && this.width != \"initial\")\r\n            result += `${this.width} `;\r\n        if (this.style && this.style != \"initial\")\r\n            result += `${this.style} `;\r\n        if (this.color && this.color != \"initial\")\r\n            result += `${this.color} `;\r\n        return result;\r\n    }\r\n}\r\nexports.Outline = Outline;\r\n\n\n//# sourceURL=webpack:///./src/dom/Outline.ts?");

/***/ }),

/***/ "./src/dom/TextShadow.ts":
/*!*******************************!*\
  !*** ./src/dom/TextShadow.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass TextShadow {\r\n    constructor(value) {\r\n        this.value = value;\r\n        this.hShadow = \"0px\";\r\n        this.vShadow = \"0px\";\r\n        this.blur = \"0px\";\r\n        this.color = \"#fff0\";\r\n        value = value.replace(\";\", \"\");\r\n        value = value.replace(/\\s+/, \" \");\r\n        let values = value.trim().split(\" \");\r\n        if (values.length < 3 || values.length > 4) {\r\n            return;\r\n        }\r\n        if (values.length == 3) {\r\n            this.hShadow = values[0];\r\n            this.vShadow = values[1];\r\n            this.color = values[2];\r\n        }\r\n        if (values.length == 4) {\r\n            this.hShadow = values[0];\r\n            this.vShadow = values[1];\r\n            this.blur = values[2];\r\n            this.color = values[3];\r\n        }\r\n    }\r\n    toString() {\r\n        let result = `${this.hShadow} ${this.vShadow} ${this.blur} ${this.color}`;\r\n        return result;\r\n    }\r\n}\r\nexports.TextShadow = TextShadow;\r\n\n\n//# sourceURL=webpack:///./src/dom/TextShadow.ts?");

/***/ }),

/***/ "./src/dom/colorEnum.ts":
/*!******************************!*\
  !*** ./src/dom/colorEnum.ts ***!
  \******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.colorEnum = {\r\n    black: [0, 0, 0],\r\n    navy: [0, 0, 128],\r\n    darkblue: [0, 0, 139],\r\n    mediumblue: [0, 0, 205],\r\n    blue: [0, 0, 255],\r\n    darkgreen: [0, 100, 0],\r\n    green: [0, 128, 0],\r\n    teal: [0, 128, 128],\r\n    darkcyan: [0, 139, 139],\r\n    deepskyblue: [0, 191, 255],\r\n    darkturquoise: [0, 206, 209],\r\n    mediumspringgreen: [0, 250, 154],\r\n    lime: [0, 255, 0],\r\n    springgreen: [0, 255, 127],\r\n    aqua: [0, 255, 255],\r\n    cyan: [0, 255, 255],\r\n    midnightblue: [25, 25, 112],\r\n    dodgerblue: [30, 144, 255],\r\n    lightseagreen: [32, 178, 170],\r\n    forestgreen: [34, 139, 34],\r\n    seagreen: [46, 139, 87],\r\n    darkslategray: [47, 79, 79],\r\n    limegreen: [50, 205, 50],\r\n    mediumseagreen: [60, 179, 113],\r\n    turquoise: [64, 224, 208],\r\n    royalblue: [65, 105, 225],\r\n    steelblue: [70, 130, 180],\r\n    darkslateblue: [72, 61, 139],\r\n    mediumturquoise: [72, 209, 204],\r\n    indigo: [75, 0, 130],\r\n    darkolivegreen: [85, 107, 47],\r\n    cadetblue: [95, 158, 160],\r\n    cornflowerblue: [100, 149, 237],\r\n    rebeccapurple: [102, 51, 153],\r\n    mediumaquamarine: [102, 205, 170],\r\n    dimgray: [105, 105, 105],\r\n    slateblue: [106, 90, 205],\r\n    olivedrab: [107, 142, 35],\r\n    slategray: [112, 128, 144],\r\n    lightslategray: [119, 136, 153],\r\n    mediumslateblue: [123, 104, 238],\r\n    lawngreen: [124, 252, 0],\r\n    chartreuse: [127, 255, 0],\r\n    aquamarine: [127, 255, 212],\r\n    maroon: [128, 0, 0],\r\n    purple: [128, 0, 128],\r\n    olive: [128, 128, 0],\r\n    gray: [128, 128, 128],\r\n    skyblue: [135, 206, 235],\r\n    lightskyblue: [135, 206, 250],\r\n    blueviolet: [138, 43, 226],\r\n    darkred: [139, 0, 0],\r\n    darkmagenta: [139, 0, 139],\r\n    saddlebrown: [139, 69, 19],\r\n    darkseagreen: [143, 188, 143],\r\n    lightgreen: [144, 238, 144],\r\n    mediumpurple: [147, 112, 219],\r\n    darkviolet: [148, 0, 211],\r\n    palegreen: [152, 251, 152],\r\n    darkorchid: [153, 50, 204],\r\n    yellowgreen: [154, 205, 50],\r\n    sienna: [160, 82, 45],\r\n    brown: [165, 42, 42],\r\n    darkgray: [169, 169, 169],\r\n    lightblue: [173, 216, 230],\r\n    greenyellow: [173, 255, 47],\r\n    paleturquoise: [175, 238, 238],\r\n    lightsteelblue: [176, 196, 222],\r\n    powderblue: [176, 224, 230],\r\n    firebrick: [178, 34, 34],\r\n    darkgoldenrod: [184, 134, 11],\r\n    mediumorchid: [186, 85, 211],\r\n    rosybrown: [188, 143, 143],\r\n    darkkhaki: [189, 183, 107],\r\n    silver: [192, 192, 192],\r\n    mediumvioletred: [199, 21, 133],\r\n    indianred: [205, 92, 92],\r\n    peru: [205, 133, 63],\r\n    chocolate: [210, 105, 30],\r\n    tan: [210, 180, 140],\r\n    lightgray: [211, 211, 211],\r\n    thistle: [216, 191, 216],\r\n    orchid: [218, 112, 214],\r\n    goldenrod: [218, 165, 32],\r\n    palevioletred: [219, 112, 147],\r\n    crimson: [220, 20, 60],\r\n    gainsboro: [220, 220, 220],\r\n    plum: [221, 160, 221],\r\n    burlywood: [222, 184, 135],\r\n    lightcyan: [224, 255, 255],\r\n    lavender: [230, 230, 250],\r\n    darksalmon: [233, 150, 122],\r\n    violet: [238, 130, 238],\r\n    palegoldenrod: [238, 232, 170],\r\n    lightcoral: [240, 128, 128],\r\n    khaki: [240, 230, 140],\r\n    aliceblue: [240, 248, 255],\r\n    honeydew: [240, 255, 240],\r\n    azure: [240, 255, 255],\r\n    sandybrown: [244, 164, 96],\r\n    wheat: [245, 222, 179],\r\n    beige: [245, 245, 220],\r\n    whitesmoke: [245, 245, 245],\r\n    mintcream: [245, 255, 250],\r\n    ghostwhite: [248, 248, 255],\r\n    salmon: [250, 128, 114],\r\n    antiquewhite: [250, 235, 215],\r\n    linen: [250, 240, 230],\r\n    lightgoldenrodyellow: [250, 250, 210],\r\n    oldlace: [253, 245, 230],\r\n    red: [255, 0, 0],\r\n    fuchsia: [255, 0, 255],\r\n    magenta: [255, 0, 255],\r\n    deeppink: [255, 20, 147],\r\n    orangered: [255, 69, 0],\r\n    tomato: [255, 99, 71],\r\n    hotpink: [255, 105, 180],\r\n    coral: [255, 127, 80],\r\n    darkorange: [255, 140, 0],\r\n    lightsalmon: [255, 160, 122],\r\n    orange: [255, 165, 0],\r\n    lightpink: [255, 182, 193],\r\n    pink: [255, 192, 203],\r\n    gold: [255, 215, 0],\r\n    peachpuff: [255, 218, 185],\r\n    navajowhite: [255, 222, 173],\r\n    moccasin: [255, 228, 181],\r\n    bisque: [255, 228, 196],\r\n    mistyrose: [255, 228, 225],\r\n    blanchedalmond: [255, 235, 205],\r\n    papayawhip: [255, 239, 213],\r\n    lavenderblush: [255, 240, 245],\r\n    seashell: [255, 245, 238],\r\n    cornsilk: [255, 248, 220],\r\n    lemonchiffon: [255, 250, 205],\r\n    floralwhite: [255, 250, 240],\r\n    snow: [255, 250, 250],\r\n    yellow: [255, 255, 0],\r\n    lightyellow: [255, 255, 224],\r\n    ivory: [255, 255, 240],\r\n    white: [255, 255, 255],\r\n    transparent: [0, 0, 0, 0]\r\n};\r\n\n\n//# sourceURL=webpack:///./src/dom/colorEnum.ts?");

/***/ }),

/***/ "./src/dom/colorProps.ts":
/*!*******************************!*\
  !*** ./src/dom/colorProps.ts ***!
  \*******************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Background_1 = __webpack_require__(/*! ./Background */ \"./src/dom/Background.ts\");\r\nconst BoxShadow_1 = __webpack_require__(/*! ./BoxShadow */ \"./src/dom/BoxShadow.ts\");\r\nconst Border_1 = __webpack_require__(/*! ./Border */ \"./src/dom/Border.ts\");\r\nconst Outline_1 = __webpack_require__(/*! ./Outline */ \"./src/dom/Outline.ts\");\r\nconst TextShadow_1 = __webpack_require__(/*! ./TextShadow */ \"./src/dom/TextShadow.ts\");\r\nexports.colorProps = [\r\n    {\r\n        prop: \"color\",\r\n        isChild: false,\r\n        parent: \"color\",\r\n        replaceColor: (o, n) => n,\r\n        getColor: o => o\r\n    },\r\n    {\r\n        prop: \"background-color\",\r\n        isChild: true,\r\n        parent: \"background\",\r\n        replaceColor: (o, n) => n,\r\n        getColor: o => o\r\n    },\r\n    {\r\n        prop: \"background\",\r\n        isChild: false,\r\n        parent: \"background\",\r\n        replaceColor: (o, n) => {\r\n            let obj = new Background_1.Background(o);\r\n            obj.color = n;\r\n            return obj.toString();\r\n        },\r\n        getColor: o => new Background_1.Background(o).color\r\n    },\r\n    {\r\n        prop: \"box-shadow\",\r\n        isChild: false,\r\n        parent: \"box-shadow\",\r\n        replaceColor: (o, n) => {\r\n            let obj = new BoxShadow_1.BoxShadow(o);\r\n            obj.color = n;\r\n            return obj.toString();\r\n        },\r\n        getColor: o => new BoxShadow_1.BoxShadow(o).color\r\n    },\r\n    {\r\n        prop: \"text-shadow\",\r\n        isChild: false,\r\n        parent: \"text-shadow\",\r\n        replaceColor: (o, n) => {\r\n            let obj = new TextShadow_1.TextShadow(o);\r\n            obj.color = n;\r\n            return obj.toString();\r\n        },\r\n        getColor: o => new TextShadow_1.TextShadow(o).color\r\n    },\r\n    {\r\n        prop: \"border\",\r\n        isChild: false,\r\n        parent: \"border\",\r\n        replaceColor: (o, n) => {\r\n            let obj = new Border_1.Border(o);\r\n            obj.color = n;\r\n            return obj.toString();\r\n        },\r\n        getColor: o => new Border_1.Border(o).color\r\n    },\r\n    {\r\n        prop: \"boder-color\",\r\n        isChild: true,\r\n        parent: \"border\",\r\n        replaceColor: (o, n) => n,\r\n        getColor: o => o\r\n    },\r\n    {\r\n        prop: \"outline\",\r\n        isChild: false,\r\n        parent: \"outline\",\r\n        replaceColor: (o, n) => {\r\n            let obj = new Outline_1.Outline(o);\r\n            obj.color = n;\r\n            return obj.toString();\r\n        },\r\n        getColor: o => new Outline_1.Outline(o).color\r\n    },\r\n    {\r\n        prop: \"outline-color\",\r\n        isChild: false,\r\n        parent: \"outline\",\r\n        replaceColor: (o, n) => n,\r\n        getColor: o => o\r\n    }\r\n];\r\n\n\n//# sourceURL=webpack:///./src/dom/colorProps.ts?");

/***/ }),

/***/ "./src/dom/element.ts":
/*!****************************!*\
  !*** ./src/dom/element.ts ***!
  \****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nfunction createElement(options) {\r\n    let { tagName, className, innerText } = options;\r\n    let el = document.createElement(tagName);\r\n    if (className)\r\n        el.classList.add(className);\r\n    if (innerText)\r\n        el.innerText = innerText;\r\n    return el;\r\n}\r\nexports.createButton = (text) => createElement({ tagName: \"div\", className: \"kb_web_editor_btn\", innerText: text });\r\nexports.createDiv = () => createElement({ tagName: \"div\", className: \"kb_web_editor_div\" });\r\nexports.createInput = () => createElement({ tagName: \"input\", className: \"kb_web_editor_input\" });\r\nexports.createIframe = () => createElement({ tagName: \"iframe\", className: \"kb_web_editor_iframe\" });\r\nexports.createImg = () => createElement({ tagName: \"img\" });\r\nexports.createP = () => createElement({ tagName: \"p\" });\r\nfunction createPrimaryButton(text) {\r\n    let el = exports.createButton(text);\r\n    el.classList.add(\"kb_web_editor_btn_primary\");\r\n    return el;\r\n}\r\nexports.createPrimaryButton = createPrimaryButton;\r\nfunction createLabelInput(text, labelWidth) {\r\n    let el = exports.createDiv();\r\n    el.classList.add(\"kb_web_editor_label_input\");\r\n    let label = exports.createDiv();\r\n    label.innerText = text;\r\n    let inputContainer = exports.createDiv();\r\n    let input = exports.createInput();\r\n    inputContainer.appendChild(input);\r\n    if (labelWidth != undefined)\r\n        label.style.width = labelWidth + \"px\";\r\n    if (labelWidth != undefined)\r\n        inputContainer.style.left = labelWidth + 5 + \"px\";\r\n    el.appendChild(label);\r\n    el.appendChild(inputContainer);\r\n    return {\r\n        input: el,\r\n        getContent: () => input.value,\r\n        setContent: (c) => (input.value = c),\r\n        setInputHandler: (h) => (input.oninput = h)\r\n    };\r\n}\r\nexports.createLabelInput = createLabelInput;\r\nfunction createRadioInput(label) {\r\n    let el = exports.createDiv();\r\n    el.classList.add(\"kb_web_editor_radio_input\");\r\n    let radio = exports.createInput();\r\n    radio.type = \"radio\";\r\n    el.appendChild(radio);\r\n    let text = exports.createDiv();\r\n    text.innerText = label;\r\n    el.appendChild(text);\r\n    return {\r\n        radio: el,\r\n        setChecked: (checked) => (radio.checked = checked),\r\n        getContent: () => label\r\n    };\r\n}\r\nexports.createRadioInput = createRadioInput;\r\nfunction createCheckboxInput(label, checked, onChecked) {\r\n    let el = exports.createDiv();\r\n    el.classList.add(\"kb_web_editor_checkobx_input\");\r\n    let checkbox = exports.createInput();\r\n    checkbox.type = \"checkbox\";\r\n    checkbox.oninput = () => onChecked(checkbox.checked);\r\n    el.appendChild(checkbox);\r\n    let text = exports.createDiv();\r\n    text.innerText = label;\r\n    checkbox.checked = checked;\r\n    el.appendChild(text);\r\n    return {\r\n        checkbox: el,\r\n        setChecked: (checked) => (checkbox.checked = checked)\r\n    };\r\n}\r\nexports.createCheckboxInput = createCheckboxInput;\r\n\n\n//# sourceURL=webpack:///./src/dom/element.ts?");

/***/ }),

/***/ "./src/dom/events.ts":
/*!***************************!*\
  !*** ./src/dom/events.ts ***!
  \***************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! ./utils */ \"./src/dom/utils.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst utils_2 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst HoverDomEvent_1 = __webpack_require__(/*! @/events/HoverDomEvent */ \"./src/events/HoverDomEvent.ts\");\r\nconst SelectedDomEvent_1 = __webpack_require__(/*! @/events/SelectedDomEvent */ \"./src/events/SelectedDomEvent.ts\");\r\nfunction hover(e) {\r\n    e.stopPropagation();\r\n    let args = context_1.default.lastHoverDomEventArgs;\r\n    if (utils_1.isInEditorContainer(e) || context_1.default.editing)\r\n        return;\r\n    let el = e.target;\r\n    if (args && args.element == el)\r\n        return;\r\n    let closeElement = utils_2.getCloseElement(el);\r\n    if (closeElement == null)\r\n        return;\r\n    args = new HoverDomEvent_1.HoverDomEventArgs(el, closeElement);\r\n    context_1.default.lastMouseEventArg = e;\r\n    context_1.default.hoverDomEvent.emit(args);\r\n}\r\nfunction listenHover() {\r\n    document.body.addEventListener(\"mouseover\", hover);\r\n    const mouseenter = (e) => {\r\n        hover(e);\r\n        document.body.removeEventListener(\"mousemove\", mouseenter);\r\n    };\r\n    document.body.addEventListener(\"mousemove\", mouseenter);\r\n}\r\nexports.listenHover = listenHover;\r\nfunction emitHoverEvent(el) {\r\n    let closeElement = utils_2.getCloseElement(el);\r\n    if (closeElement == null)\r\n        return;\r\n    context_1.default.hoverDomEvent.emit(new HoverDomEvent_1.HoverDomEventArgs(el, closeElement));\r\n}\r\nexports.emitHoverEvent = emitHoverEvent;\r\nfunction emitSelectedEvent() {\r\n    let element = context_1.default.lastHoverDomEventArgs.closeElement;\r\n    var args = new SelectedDomEvent_1.SelectedDomEventArgs(element);\r\n    context_1.default.domChangeEvent.emit(args);\r\n}\r\nexports.emitSelectedEvent = emitSelectedEvent;\r\n\n\n//# sourceURL=webpack:///./src/dom/events.ts?");

/***/ }),

/***/ "./src/dom/style.ts":
/*!**************************!*\
  !*** ./src/dom/style.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst colorProps_1 = __webpack_require__(/*! ./colorProps */ \"./src/dom/colorProps.ts\");\r\nconst stylePriority_1 = __webpack_require__(/*! ./stylePriority */ \"./src/dom/stylePriority.ts\");\r\nconst colorEnum_1 = __webpack_require__(/*! ./colorEnum */ \"./src/dom/colorEnum.ts\");\r\nconst pseudoes = [\"visited\", \"hover\", \"active\", \"focus\"];\r\nfunction* getStyles() {\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n        yield document.styleSheets.item(i);\r\n    }\r\n}\r\nfunction* getRules(style) {\r\n    for (let i = 0; i < style.rules.length; i++) {\r\n        yield style.rules.item(i);\r\n    }\r\n}\r\nfunction* getCssRules() {\r\n    let styleSequence = 0;\r\n    for (const style of getStyles()) {\r\n        if (!style || !(style instanceof CSSStyleSheet) || !(style.ownerNode instanceof HTMLElement))\r\n            continue;\r\n        let koobooId = style.ownerNode.getAttribute(constants_1.KOOBOO_ID);\r\n        let href = style.ownerNode.getAttribute(\"href\");\r\n        if (!koobooId)\r\n            continue;\r\n        if (href && href.startsWith(\"http\"))\r\n            continue;\r\n        for (const rule of getRules(style)) {\r\n            if (!rule || !(rule instanceof CSSStyleRule))\r\n                continue;\r\n            yield {\r\n                styleSequence: ++styleSequence,\r\n                koobooId,\r\n                url: href,\r\n                rule\r\n            };\r\n        }\r\n    }\r\n}\r\nexports.getCssRules = getCssRules;\r\nfunction getMatchedColorGroups(el) {\r\n    let groups = [];\r\n    let colors = getMatchedColors(el);\r\n    for (const i of colors) {\r\n        let item = groups.find(f => f.prop == i.prop.parent && f.pseudo == i.pseudo);\r\n        if (item) {\r\n            item.cssColors.push(i);\r\n        }\r\n        else {\r\n            groups.push({\r\n                prop: i.prop.parent,\r\n                cssColors: [i],\r\n                pseudo: i.pseudo\r\n            });\r\n        }\r\n    }\r\n    for (const i of groups) {\r\n        i.cssColors = stylePriority_1.sortStylePriority(i.cssColors).reverse();\r\n    }\r\n    let style = getComputedStyle(el);\r\n    addDefaultColor(groups, \"color\", style.color);\r\n    addDefaultColor(groups, \"background-color\", style.backgroundColor);\r\n    return groups;\r\n}\r\nexports.getMatchedColorGroups = getMatchedColorGroups;\r\nfunction getMatchedColors(el) {\r\n    let matchedColors = [];\r\n    addInlineMatchedColors(el, matchedColors);\r\n    addStyleMatchedColors(el, matchedColors);\r\n    return matchedColors;\r\n}\r\nexports.getMatchedColors = getMatchedColors;\r\nfunction addInlineMatchedColors(el, matchedColors) {\r\n    let inlineColors = getCssColors(el.style);\r\n    for (const i of inlineColors) {\r\n        matchedColors.push({\r\n            prop: i.prop,\r\n            styleSequence: Number.MAX_VALUE / 2,\r\n            important: i.important,\r\n            inline: true,\r\n            koobooId: \"\",\r\n            rawSelector: \"\",\r\n            targetSelector: \"\",\r\n            url: \"\",\r\n            value: i.value,\r\n            pseudo: \"\",\r\n            cssStyleRule: null\r\n        });\r\n    }\r\n}\r\nfunction addStyleMatchedColors(el, matchedColors) {\r\n    for (const i of getCssRules()) {\r\n        let matched = matchSelector(el, i.rule.selectorText);\r\n        if (!matched)\r\n            continue;\r\n        let colors = getCssColors(i.rule.style);\r\n        if (!colors)\r\n            continue;\r\n        for (const color of colors) {\r\n            matchedColors.push({\r\n                prop: color.prop,\r\n                styleSequence: i.styleSequence,\r\n                important: color.important,\r\n                inline: false,\r\n                koobooId: i.koobooId,\r\n                rawSelector: i.rule.selectorText,\r\n                targetSelector: matched.selector,\r\n                url: i.url,\r\n                value: color.value,\r\n                pseudo: matched.pseudo,\r\n                cssStyleRule: i.rule\r\n            });\r\n        }\r\n    }\r\n}\r\nfunction getCssColors(style) {\r\n    let colors = [];\r\n    for (const i of colorProps_1.colorProps) {\r\n        let value = style.getPropertyValue(i.prop);\r\n        if (!value)\r\n            continue;\r\n        let color = i.getColor(value);\r\n        if (!isColor(color))\r\n            continue;\r\n        colors.push({\r\n            prop: i,\r\n            value,\r\n            important: !!style.getPropertyPriority(i.prop)\r\n        });\r\n    }\r\n    return colors;\r\n}\r\nfunction isColor(color) {\r\n    color = color.trim().toLowerCase();\r\n    if (color.startsWith(\"#\"))\r\n        return true;\r\n    if (color.startsWith(\"rgb\"))\r\n        return true;\r\n    for (const key in colorEnum_1.colorEnum) {\r\n        if (key == color)\r\n            return true;\r\n    }\r\n}\r\nfunction splitPseudo(selector) {\r\n    for (const i of pseudoes) {\r\n        let pseudo = selector.match(`:+${i}\\s*$`);\r\n        if (!pseudo)\r\n            continue;\r\n        return {\r\n            pseudo: pseudo[0],\r\n            selector: selector.replace(pseudo[0], \"\")\r\n        };\r\n    }\r\n}\r\nfunction matchSelector(el, selector) {\r\n    var selectors = selector.split(\",\");\r\n    for (const i of selectors) {\r\n        let splited = splitPseudo(i);\r\n        if (splited && el.matches(splited.selector)) {\r\n            return {\r\n                selector: i,\r\n                pseudo: splited.pseudo\r\n            };\r\n        }\r\n        else if (el.matches(i)) {\r\n            return {\r\n                selector: i,\r\n                pseudo: \"\"\r\n            };\r\n        }\r\n    }\r\n}\r\nfunction addDefaultColor(groups, prop, value) {\r\n    let colorProp = colorProps_1.colorProps.find(f => f.prop == prop);\r\n    if (!groups.some(e => e.prop == colorProp.parent && !e.pseudo)) {\r\n        groups.push({\r\n            pseudo: \"\",\r\n            prop: colorProp.parent,\r\n            cssColors: [\r\n                {\r\n                    inline: true,\r\n                    prop: colorProp,\r\n                    cssStyleRule: null,\r\n                    important: false,\r\n                    koobooId: \"\",\r\n                    pseudo: \"\",\r\n                    rawSelector: \"\",\r\n                    styleSequence: 0,\r\n                    targetSelector: \"\",\r\n                    url: \"\",\r\n                    value: value\r\n                }\r\n            ]\r\n        });\r\n    }\r\n}\r\n\n\n//# sourceURL=webpack:///./src/dom/style.ts?");

/***/ }),

/***/ "./src/dom/stylePriority.ts":
/*!**********************************!*\
  !*** ./src/dom/stylePriority.ts ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nexports.getStylePriority = function (styleSelector) {\r\n    const TOKEN_ID = /(#[\\w-]+)/g;\r\n    const TOKEN_CLASS = /(\\.[\\w-]+)/g;\r\n    const TOKEN_ATTR = /(\\[[^[\\]]+])/g;\r\n    const TOKEN_PSEUDO_CLASS = /(:[\\w-]+)/g;\r\n    const TOKEN_PSEUDO_ELEM = /(::[\\w-]+)/g;\r\n    const TOKEN_ELEM = /([\\w-]+)/g;\r\n    const PSEUDO_ELEMS = [\"first-letter\", \"last-letter\", \"first-line\", \"last-line\", \"first-child\", \"last-child\", \"before\", \"after\"];\r\n    const SYMBOL_B = \"\\x02\";\r\n    const SYMBOL_C = \"\\x03\";\r\n    const SYMBOL_D = \"\\x04\";\r\n    let important = styleSelector.important ? 1 : 0;\r\n    let inline = styleSelector.inline ? 1 : 0;\r\n    let styleSequence = styleSelector.styleSequence || 0;\r\n    let priority = [important, inline, 0, 0, 0, styleSequence];\r\n    let selector = styleSelector.targetSelector;\r\n    selector = selector.replace(/(::?)([\\w-]+)/g, function (total, left, elem) {\r\n        if (PSEUDO_ELEMS.indexOf(elem) >= 0) {\r\n            if (left === \":\") {\r\n                return \"::\" + elem;\r\n            }\r\n            else {\r\n                return total;\r\n            }\r\n        }\r\n        else {\r\n            return total;\r\n        }\r\n    });\r\n    selector = selector\r\n        .replace(TOKEN_ATTR, SYMBOL_C)\r\n        .replace(TOKEN_PSEUDO_ELEM, SYMBOL_D)\r\n        .replace(TOKEN_PSEUDO_CLASS, SYMBOL_C)\r\n        .replace(TOKEN_ID, SYMBOL_B)\r\n        .replace(TOKEN_CLASS, SYMBOL_C)\r\n        .replace(TOKEN_ELEM, SYMBOL_D);\r\n    selector = selector.replace(/[\\2\\3\\4]/g, function (symbol) {\r\n        var idx = symbol.charCodeAt(0);\r\n        priority[idx]++;\r\n        return \"<\" + idx + \">\";\r\n    });\r\n    return priority;\r\n};\r\nexports.compareStylePriority = function (a, b) {\r\n    for (var i = 0; i < a.length; i++) {\r\n        if (a[i] !== b[i]) {\r\n            return a[i] - b[i];\r\n        }\r\n    }\r\n    return 0;\r\n};\r\nexports.sortStylePriority = function (styleSelectorList) {\r\n    styleSelectorList.sort((a, b) => {\r\n        let priorityA = exports.getStylePriority(a);\r\n        let priorityB = exports.getStylePriority(b);\r\n        return exports.compareStylePriority(priorityA, priorityB);\r\n    });\r\n    return styleSelectorList;\r\n};\r\n\n\n//# sourceURL=webpack:///./src/dom/stylePriority.ts?");

/***/ }),

/***/ "./src/dom/utils.ts":
/*!**************************!*\
  !*** ./src/dom/utils.ts ***!
  \**************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! ../common/constants */ \"./src/common/constants.ts\");\r\nconst Background_1 = __webpack_require__(/*! ./Background */ \"./src/dom/Background.ts\");\r\nfunction getScrollTop() {\r\n    return document.documentElement.scrollTop;\r\n}\r\nexports.getScrollTop = getScrollTop;\r\nfunction getScrollLeft() {\r\n    return document.documentElement.scrollLeft;\r\n}\r\nexports.getScrollLeft = getScrollLeft;\r\nfunction getMaxHeight() {\r\n    var body = document.body, html = document.documentElement;\r\n    return Math.max(body.scrollHeight, body.offsetHeight, html.clientHeight, html.scrollHeight, html.offsetHeight);\r\n}\r\nexports.getMaxHeight = getMaxHeight;\r\nfunction getMaxWidth() {\r\n    var body = document.body, html = document.documentElement;\r\n    return Math.max(body.scrollWidth, body.offsetWidth, html.clientWidth, html.scrollWidth, html.offsetWidth);\r\n}\r\nexports.getMaxWidth = getMaxWidth;\r\nfunction isInEditorContainer(e) {\r\n    return getParentElements(e.target).some(s => {\r\n        if (s instanceof HTMLElement)\r\n            return s.id == constants_1.HOVER_BORDER_SKIP;\r\n        return false;\r\n    });\r\n}\r\nexports.isInEditorContainer = isInEditorContainer;\r\nfunction* getAllElement(parentEl, containSelf = false) {\r\n    if (containSelf)\r\n        yield parentEl;\r\n    function* getChildren(el) {\r\n        if (el instanceof HTMLElement && el.id == constants_1.HOVER_BORDER_SKIP)\r\n            return;\r\n        for (let i = 0; i < el.children.length; i++) {\r\n            const item = el.children[i];\r\n            yield item;\r\n            yield* getChildren(item);\r\n        }\r\n    }\r\n    yield* getChildren(parentEl);\r\n}\r\nexports.getAllElement = getAllElement;\r\nfunction* getAllNode(parentNode, containSelf = false) {\r\n    if (containSelf)\r\n        yield parentNode;\r\n    function* getChildren(node) {\r\n        if (node instanceof HTMLElement && node.id == constants_1.HOVER_BORDER_SKIP)\r\n            return;\r\n        for (let i = 0; i < node.childNodes.length; i++) {\r\n            const item = node.childNodes[i];\r\n            yield item;\r\n            yield* getChildren(item);\r\n        }\r\n    }\r\n    yield* getChildren(parentNode);\r\n}\r\nexports.getAllNode = getAllNode;\r\nfunction isBody(el) {\r\n    return el.tagName.toLowerCase() == \"body\";\r\n}\r\nexports.isBody = isBody;\r\nfunction isImg(el) {\r\n    return el.tagName.toLowerCase() == \"img\";\r\n}\r\nexports.isImg = isImg;\r\nfunction isLink(el) {\r\n    return el.tagName.toLowerCase() == \"a\";\r\n}\r\nexports.isLink = isLink;\r\nfunction isTextArea(el) {\r\n    return el instanceof HTMLTextAreaElement;\r\n}\r\nexports.isTextArea = isTextArea;\r\nfunction isForm(el) {\r\n    return el instanceof HTMLFormElement;\r\n}\r\nexports.isForm = isForm;\r\nfunction canJump(el) {\r\n    const prefixs = [\"mailto:\", \"tel:\", \"sms:\", \"market\", \"geopoint:\"];\r\n    let href = el.getAttribute(\"href\");\r\n    if (!href) {\r\n        return false;\r\n    }\r\n    let includePrefixs;\r\n    prefixs.map(prefix => {\r\n        if (href.trim().startsWith(prefix))\r\n            includePrefixs = true;\r\n    });\r\n    let isExtralLick;\r\n    if (el.tagName.toLowerCase() == \"a\" && href && !href.startsWith(\"#\") && !href.startsWith(\"http\"))\r\n        isExtralLick = true;\r\n    if (includePrefixs)\r\n        return false;\r\n    if (isExtralLick)\r\n        return true;\r\n    return false;\r\n}\r\nexports.canJump = canJump;\r\nfunction reload() {\r\n    parent.location.reload();\r\n}\r\nexports.reload = reload;\r\nfunction* previousNodes(node, containSelf = false, includeParent = false) {\r\n    if (containSelf)\r\n        yield node;\r\n    while (true) {\r\n        if (node.previousSibling) {\r\n            node = node.previousSibling;\r\n        }\r\n        else if (includeParent && node.parentNode) {\r\n            node = node.parentNode;\r\n        }\r\n        else\r\n            break;\r\n        yield node;\r\n    }\r\n}\r\nexports.previousNodes = previousNodes;\r\nfunction* nextNodes(node, containSelf = false, includeParent = false) {\r\n    if (containSelf)\r\n        yield node;\r\n    while (true) {\r\n        if (node.nextSibling) {\r\n            node = node.nextSibling;\r\n        }\r\n        else if (includeParent && node.parentNode) {\r\n            node = node.parentNode;\r\n        }\r\n        else\r\n            break;\r\n        yield node;\r\n    }\r\n}\r\nexports.nextNodes = nextNodes;\r\nfunction getParentElements(el, includeSelf = true) {\r\n    let elements = [];\r\n    if (includeSelf)\r\n        elements.push(el);\r\n    while (el) {\r\n        el = el.parentElement;\r\n        if (el)\r\n            elements.push(el);\r\n    }\r\n    return elements;\r\n}\r\nexports.getParentElements = getParentElements;\r\nfunction getBackgroundImage(el) {\r\n    let image = undefined;\r\n    let imageInBackground = false;\r\n    if (el.style.background) {\r\n        let background = new Background_1.Background(el.style.background);\r\n        image = background.image;\r\n    }\r\n    if (image) {\r\n        imageInBackground = true;\r\n    }\r\n    else {\r\n        image = el.style.backgroundImage;\r\n    }\r\n    if (!image) {\r\n        image = getComputedStyle(el).backgroundImage;\r\n    }\r\n    return { image, imageInBackground };\r\n}\r\nexports.getBackgroundImage = getBackgroundImage;\r\nfunction clearBackgroundImage(el, imageInBackground) {\r\n    if (imageInBackground) {\r\n        let background = new Background_1.Background(el.style.background);\r\n        background.image = \"url(none)\";\r\n        el.style.background = background.toString();\r\n    }\r\n    else {\r\n        el.style.backgroundImage = \"none\";\r\n    }\r\n}\r\nexports.clearBackgroundImage = clearBackgroundImage;\r\nfunction getBackgroundColor(el) {\r\n    let color = undefined;\r\n    let colorInBackground = false;\r\n    if (el.style.background) {\r\n        let background = new Background_1.Background(el.style.background);\r\n        color = background.color;\r\n    }\r\n    if (color) {\r\n        colorInBackground = true;\r\n    }\r\n    else {\r\n        color = el.style.backgroundColor;\r\n    }\r\n    if (!color) {\r\n        color = getComputedStyle(el).backgroundColor;\r\n    }\r\n    return { color, colorInBackground };\r\n}\r\nexports.getBackgroundColor = getBackgroundColor;\r\nfunction isInTable(el) {\r\n    var reExcept = /^(thead|tbody|tfoot|th|tr|td)$/i;\r\n    return reExcept.test(el.tagName);\r\n}\r\nexports.isInTable = isInTable;\r\n\n\n//# sourceURL=webpack:///./src/dom/utils.ts?");

/***/ }),

/***/ "./src/events/BaseEvent.ts":
/*!*********************************!*\
  !*** ./src/events/BaseEvent.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass BaseEvent {\r\n    constructor() {\r\n        this.handlers = [];\r\n    }\r\n    addEventListener(handler) {\r\n        this.handlers.push(handler);\r\n    }\r\n    emit(e) {\r\n        this.handlers.forEach(i => i(e));\r\n    }\r\n}\r\nexports.BaseEvent = BaseEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/BaseEvent.ts?");

/***/ }),

/***/ "./src/events/CloseEditingEvent.ts":
/*!*****************************************!*\
  !*** ./src/events/CloseEditingEvent.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst BaseEvent_1 = __webpack_require__(/*! ./BaseEvent */ \"./src/events/BaseEvent.ts\");\r\nclass CloseEditingEvent extends BaseEvent_1.BaseEvent {\r\n}\r\nexports.CloseEditingEvent = CloseEditingEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/CloseEditingEvent.ts?");

/***/ }),

/***/ "./src/events/EditableEvent.ts":
/*!*************************************!*\
  !*** ./src/events/EditableEvent.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst BaseEvent_1 = __webpack_require__(/*! ./BaseEvent */ \"./src/events/BaseEvent.ts\");\r\nclass EditableEvent extends BaseEvent_1.BaseEvent {\r\n}\r\nexports.EditableEvent = EditableEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/EditableEvent.ts?");

/***/ }),

/***/ "./src/events/HoverDomEvent.ts":
/*!*************************************!*\
  !*** ./src/events/HoverDomEvent.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst BaseEvent_1 = __webpack_require__(/*! ./BaseEvent */ \"./src/events/BaseEvent.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! ../common/context */ \"./src/common/context.ts\"));\r\nclass HoverDomEventArgs {\r\n    constructor(element, closeElement) {\r\n        this.element = element;\r\n        this.closeElement = closeElement;\r\n    }\r\n}\r\nexports.HoverDomEventArgs = HoverDomEventArgs;\r\nclass HoverDomEvent extends BaseEvent_1.BaseEvent {\r\n    emit(arg) {\r\n        context_1.default.lastHoverDomEventArgs = arg;\r\n        super.emit(arg);\r\n    }\r\n}\r\nexports.HoverDomEvent = HoverDomEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/HoverDomEvent.ts?");

/***/ }),

/***/ "./src/events/OperationEvent.ts":
/*!**************************************!*\
  !*** ./src/events/OperationEvent.ts ***!
  \**************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst BaseEvent_1 = __webpack_require__(/*! ./BaseEvent */ \"./src/events/BaseEvent.ts\");\r\nclass OperationEventArgs {\r\n    constructor(operationCount, backupOperationCount) {\r\n        this.operationCount = 0;\r\n        this.backupOperationCount = 0;\r\n        this.operationCount = operationCount;\r\n        this.backupOperationCount = backupOperationCount;\r\n    }\r\n    get canSave() {\r\n        return this.operationCount > 0;\r\n    }\r\n}\r\nexports.OperationEventArgs = OperationEventArgs;\r\nclass OperationEvent extends BaseEvent_1.BaseEvent {\r\n}\r\nexports.OperationEvent = OperationEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/OperationEvent.ts?");

/***/ }),

/***/ "./src/events/SelectedDomEvent.ts":
/*!****************************************!*\
  !*** ./src/events/SelectedDomEvent.ts ***!
  \****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst BaseEvent_1 = __webpack_require__(/*! ./BaseEvent */ \"./src/events/BaseEvent.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! ../common/context */ \"./src/common/context.ts\"));\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nclass SelectedDomEventArgs {\r\n    constructor(element) {\r\n        this.element = element;\r\n    }\r\n    get koobooId() {\r\n        return this.element.getAttribute(constants_1.KOOBOO_ID);\r\n    }\r\n}\r\nexports.SelectedDomEventArgs = SelectedDomEventArgs;\r\nclass SelectedDomEvent extends BaseEvent_1.BaseEvent {\r\n    emit(args) {\r\n        context_1.default.lastSelectedDomEventArgs = args;\r\n        super.emit(args);\r\n    }\r\n}\r\nexports.SelectedDomEvent = SelectedDomEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/SelectedDomEvent.ts?");

/***/ }),

/***/ "./src/events/TinymceEvent.ts":
/*!************************************!*\
  !*** ./src/events/TinymceEvent.ts ***!
  \************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst BaseEvent_1 = __webpack_require__(/*! ./BaseEvent */ \"./src/events/BaseEvent.ts\");\r\nclass TinymceInputEvent extends BaseEvent_1.BaseEvent {\r\n}\r\nexports.TinymceInputEvent = TinymceInputEvent;\r\n\n\n//# sourceURL=webpack:///./src/events/TinymceEvent.ts?");

/***/ }),

/***/ "./src/index.ts":
/*!**********************!*\
  !*** ./src/index.ts ***!
  \**********************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\n__webpack_require__(/*! ./assets/kb-style.css */ \"./src/assets/kb-style.css\");\r\n__webpack_require__(/*! @simonwep/pickr/dist/themes/nano.min.css */ \"./node_modules/@simonwep/pickr/dist/themes/nano.min.css\");\r\nconst actionBar_1 = __webpack_require__(/*! ./components/actionBar */ \"./src/components/actionBar/index.ts\");\r\nconst floatMenu_1 = __webpack_require__(/*! ./components/floatMenu */ \"./src/components/floatMenu/index.ts\");\r\nconst selectorBorder_1 = __webpack_require__(/*! ./components/selectorBorder */ \"./src/components/selectorBorder/index.ts\");\r\nconst editorShade_1 = __webpack_require__(/*! ./components/editorShade */ \"./src/components/editorShade/index.ts\");\r\nconst events_1 = __webpack_require__(/*! ./dom/events */ \"./src/dom/events.ts\");\r\nconst utils_1 = __webpack_require__(/*! ./common/utils */ \"./src/common/utils.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! ./kooboo/outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nconst elementNav_1 = __webpack_require__(/*! ./components/elementNav */ \"./src/components/elementNav/index.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! ./common/context */ \"./src/common/context.ts\"));\r\noutsideInterfaces_1.shareStyle();\r\nevents_1.listenHover();\r\nutils_1.setElementClick();\r\ncontext_1.default.container.appendChild(selectorBorder_1.createHoverBorder());\r\ncontext_1.default.container.appendChild(selectorBorder_1.createSelectedBorder());\r\ncontext_1.default.container.appendChild(floatMenu_1.createFloatMenu());\r\ncontext_1.default.container.appendChild(editorShade_1.createEditorShade());\r\ncontext_1.default.container.appendChild(actionBar_1.createActionBar());\r\ncontext_1.default.container.appendChild(elementNav_1.createElementNav());\r\nif (document.body)\r\n    events_1.emitHoverEvent(document.body);\r\n\n\n//# sourceURL=webpack:///./src/index.ts?");

/***/ }),

/***/ "./src/kooboo/KoobooComment.ts":
/*!*************************************!*\
  !*** ./src/kooboo/KoobooComment.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! ./utils */ \"./src/kooboo/utils.ts\");\r\nconst utils_2 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nclass KoobooComment {\r\n    constructor(comment) {\r\n        let str = \"\";\r\n        if (comment instanceof Node) {\r\n            str = comment.nodeValue;\r\n        }\r\n        else if (comment) {\r\n            str = comment;\r\n        }\r\n        if (comment) {\r\n            this._infos = str.split(\"--\").map(m => m.replace(/'/g, \"\"));\r\n        }\r\n    }\r\n    get objecttype() {\r\n        return this.getValue(\"objecttype\");\r\n    }\r\n    get nameorid() {\r\n        return this.getValue(\"nameorid\");\r\n    }\r\n    get folderid() {\r\n        return this.getValue(\"folderid\");\r\n    }\r\n    get bindingvalue() {\r\n        return this.getValue(\"bindingvalue\");\r\n    }\r\n    get boundary() {\r\n        return this.getValue(\"boundary\");\r\n    }\r\n    get fieldname() {\r\n        let result = this.getValue(\"fieldname\");\r\n        if (!result && this.bindingvalue && this.bindingvalue.indexOf(\".\") > -1) {\r\n            result = this.bindingvalue.split(\".\").pop();\r\n            result = result.replace(\"}\", \"\");\r\n        }\r\n        return result;\r\n    }\r\n    get koobooid() {\r\n        return this.getValue(\"koobooid\");\r\n    }\r\n    get attributename() {\r\n        return this.getValue(\"attributename\");\r\n    }\r\n    get end() {\r\n        return Boolean(this.getValue(\"end\"));\r\n    }\r\n    getValue(key) {\r\n        var item = this._infos.find(f => f.startsWith(key));\r\n        if (item && item.indexOf(\"=\") != -1) {\r\n            return item.split(\"=\")[1];\r\n        }\r\n    }\r\n    static isComment(node) {\r\n        return node.nodeType == Node.COMMENT_NODE && node.nodeValue && node.nodeValue.startsWith(\"#kooboo\");\r\n    }\r\n    static isEndComment(node) {\r\n        return this.isComment(node) && node.nodeValue.indexOf(\"--end\") > -1;\r\n    }\r\n    static isGuidComment(node) {\r\n        return this.isComment(node) && node.nodeValue.indexOf(constants_1.KOOBOO_GUID) > -1;\r\n    }\r\n    static getComments(el) {\r\n        let self = el;\r\n        let comments = this.getSingleWrapComment(el);\r\n        let comment;\r\n        while (el) {\r\n            comment = utils_1.previousComment(el);\r\n            while (comment) {\r\n                if (this.isEndComment(comment) || this.isGuidComment(comment))\r\n                    break;\r\n                if (!utils_1.isSingleCommentWrap(comment) && this.isInWrap(comment, self)) {\r\n                    comments.push(comment);\r\n                }\r\n                comment = utils_1.previousComment(comment);\r\n            }\r\n            el = el.previousElementSibling ? el.previousElementSibling : el.parentElement;\r\n        }\r\n        return comments.map(m => new KoobooComment(m));\r\n    }\r\n    static getSingleWrapComment(el) {\r\n        let comments = [];\r\n        let comment;\r\n        comment = utils_1.previousComment(el);\r\n        while (comment && utils_1.isSingleCommentWrap(comment)) {\r\n            comments.push(comment);\r\n            comment = utils_1.previousComment(comment);\r\n        }\r\n        return comments;\r\n    }\r\n    static isInWrap(comment, self) {\r\n        let koobooComment = new KoobooComment(comment);\r\n        let { nodes } = utils_1.getWrapDom(comment, koobooComment.objecttype);\r\n        return nodes.some(s => {\r\n            for (const i of utils_2.getAllNode(s, true)) {\r\n                if (i == self)\r\n                    return true;\r\n            }\r\n        });\r\n    }\r\n}\r\nexports.KoobooComment = KoobooComment;\r\n\n\n//# sourceURL=webpack:///./src/kooboo/KoobooComment.ts?");

/***/ }),

/***/ "./src/kooboo/outsideInterfaces.ts":
/*!*****************************************!*\
  !*** ./src/kooboo/outsideInterfaces.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\r\n    return new (P || (P = Promise))(function (resolve, reject) {\r\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\r\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\r\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\r\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\r\n    });\r\n};\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst modal_1 = __webpack_require__(/*! @/components/modal */ \"./src/components/modal/index.ts\");\r\nconst lang_1 = __webpack_require__(/*! @/common/lang */ \"./src/common/lang.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nconst Kooboo = document.Kooboo;\r\nconst mediaDialogData = document.mediaDialogData;\r\nconst gl = document.__gl;\r\nconst parentBody = document.parentBody;\r\nfunction pickImg(callBack) {\r\n    Kooboo.Media.getList().then(function (res) {\r\n        if (res.success) {\r\n            res.model[\"show\"] = true;\r\n            res.model[\"onAdd\"] = (selected) => {\r\n                callBack(selected.url);\r\n            };\r\n        }\r\n        mediaDialogData(res.model);\r\n    });\r\n}\r\nexports.pickImg = pickImg;\r\nfunction editHtmlBlock(nameOrId) {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        let url = Kooboo.Route.Get(Kooboo.Route.HtmlBlock.DialogPage, {\r\n            nameOrId: nameOrId\r\n        });\r\n        let iframe = element_1.createIframe();\r\n        iframe.src = url;\r\n        iframe.style.height = \"600px\";\r\n        const { modal, setOkHandler, close } = modal_1.createModal(lang_1.TEXT.EDIT_HTML_BLOCK, iframe.outerHTML);\r\n        parentBody.appendChild(modal);\r\n        return new Promise(rs => {\r\n            setOkHandler(() => __awaiter(this, void 0, void 0, function* () {\r\n                gl.saveHtmlblockFinish = (content) => {\r\n                    rs(content);\r\n                    close();\r\n                };\r\n                gl.saveHtmlblock();\r\n            }));\r\n        });\r\n    });\r\n}\r\nexports.editHtmlBlock = editHtmlBlock;\r\nfunction editRepeat(nameOrId, folderId) {\r\n    let url = Kooboo.Route.Get(Kooboo.Route.TextContent.DialogPage, {\r\n        id: nameOrId,\r\n        folder: folderId\r\n    });\r\n    let iframe = element_1.createIframe();\r\n    iframe.src = url;\r\n    iframe.style.height = \"600px\";\r\n    const { modal, setOkHandler, close } = modal_1.createModal(lang_1.TEXT.EDIT_REPEAT, iframe.outerHTML);\r\n    parentBody.appendChild(modal);\r\n    return new Promise(rs => {\r\n        setOkHandler(() => {\r\n            gl.saveContentFinish = (content) => {\r\n                rs(content);\r\n                close();\r\n            };\r\n            gl.saveContent();\r\n        });\r\n    });\r\n}\r\nexports.editRepeat = editRepeat;\r\nfunction editMenu(nameOrId, callback) {\r\n    var url = Kooboo.Route.Get(Kooboo.Route.Menu.DialogPage, {\r\n        nameOrId: nameOrId\r\n    });\r\n    let iframe = element_1.createIframe();\r\n    iframe.src = url;\r\n    iframe.style.height = \"600px\";\r\n    const { modal, hideCancel } = modal_1.createModal(lang_1.TEXT.EDIT_MENU, iframe.outerHTML);\r\n    hideCancel();\r\n    gl.saveMenuFinish = callback;\r\n    parentBody.appendChild(modal);\r\n}\r\nexports.editMenu = editMenu;\r\nfunction getPageUrls() {\r\n    return __awaiter(this, void 0, void 0, function* () {\r\n        return new Promise((rs, rj) => {\r\n            Kooboo.Link.SyncAll().then((data) => {\r\n                rs(data.model.pages.map((m) => m.url));\r\n            });\r\n        });\r\n    });\r\n}\r\nexports.getPageUrls = getPageUrls;\r\nfunction newGuid() {\r\n    return Kooboo.Guid.NewGuid();\r\n}\r\nexports.newGuid = newGuid;\r\nfunction shareStyle() {\r\n    let keywords = [\"/*! Pickr\", \"/* kb_web_editor */\"];\r\n    for (let i = 0; i < document.styleSheets.length; i++) {\r\n        let style = document.styleSheets.item(i);\r\n        if (!(style.ownerNode instanceof HTMLElement))\r\n            return;\r\n        if (keywords.some(s => style.ownerNode.innerHTML.startsWith(s))) {\r\n            parentBody.appendChild(style.ownerNode.cloneNode(true));\r\n            context_1.default.container.appendChild(style.ownerNode.cloneNode(true));\r\n        }\r\n    }\r\n}\r\nexports.shareStyle = shareStyle;\r\nfunction Update(data) {\r\n    return new Promise((rs, rj) => {\r\n        Kooboo.Editor.Update(data).then(rs);\r\n    });\r\n}\r\nexports.Update = Update;\r\n\n\n//# sourceURL=webpack:///./src/kooboo/outsideInterfaces.ts?");

/***/ }),

/***/ "./src/kooboo/utils.ts":
/*!*****************************!*\
  !*** ./src/kooboo/utils.ts ***!
  \*****************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! ../dom/utils */ \"./src/dom/utils.ts\");\r\nconst KoobooComment_1 = __webpack_require__(/*! ./KoobooComment */ \"./src/kooboo/KoobooComment.ts\");\r\nconst constants_1 = __webpack_require__(/*! ../common/constants */ \"./src/common/constants.ts\");\r\nconst outsideInterfaces_1 = __webpack_require__(/*! ./outsideInterfaces */ \"./src/kooboo/outsideInterfaces.ts\");\r\nfunction clearKoobooInfo(domString) {\r\n    const exp = RegExp(`(${constants_1.KOOBOO_ID}=\".*?\")|(${constants_1.KOOBOO_DIRTY}(=\"\")?)|(${constants_1.KOOBOO_GUID}=\".*?\")|(<!--#?kooboo.*?-->)|(<!--empty-->)`, \"g\");\r\n    return domString.replace(exp, \"\");\r\n}\r\nexports.clearKoobooInfo = clearKoobooInfo;\r\nfunction getCloseElement(el) {\r\n    let node = el;\r\n    let closeElement = null;\r\n    let parentElement = null;\r\n    while (true) {\r\n        if (!node)\r\n            break;\r\n        if (node instanceof HTMLElement && parentElement != node.parentElement) {\r\n            closeElement = node;\r\n            if (node.hasAttribute(constants_1.KOOBOO_ID))\r\n                break;\r\n        }\r\n        if (KoobooComment_1.KoobooComment.isComment(node))\r\n            break;\r\n        parentElement = node.parentElement;\r\n        node = node.previousSibling ? node.previousSibling : node.parentElement;\r\n    }\r\n    return closeElement;\r\n}\r\nexports.getCloseElement = getCloseElement;\r\nfunction markDirty(el, self = false) {\r\n    for (const i of utils_1.getAllElement(el, self)) {\r\n        i.setAttribute(constants_1.KOOBOO_DIRTY, \"\");\r\n    }\r\n}\r\nexports.markDirty = markDirty;\r\nfunction isDirty(el) {\r\n    return el.hasAttribute(constants_1.KOOBOO_DIRTY);\r\n}\r\nexports.isDirty = isDirty;\r\nfunction setGuid(el, relpase = \"\") {\r\n    let guid = el.getAttribute(constants_1.KOOBOO_GUID);\r\n    if (relpase)\r\n        guid = relpase;\r\n    else if (!guid)\r\n        guid = outsideInterfaces_1.newGuid();\r\n    el.setAttribute(constants_1.KOOBOO_GUID, guid);\r\n    return guid;\r\n}\r\nexports.setGuid = setGuid;\r\nfunction getGuidComment(guid) {\r\n    return `<!--${constants_1.KOOBOO_GUID} ${guid}-->`;\r\n}\r\nexports.getGuidComment = getGuidComment;\r\nfunction isDynamicContent(el) {\r\n    for (const k in constants_1.OBJECT_TYPE) {\r\n        if (k == constants_1.OBJECT_TYPE.Url)\r\n            continue;\r\n        if (k == constants_1.OBJECT_TYPE.form)\r\n            continue;\r\n        if (constants_1.OBJECT_TYPE.hasOwnProperty(k)) {\r\n            const i = constants_1.OBJECT_TYPE[k];\r\n            if (el.innerHTML.indexOf(`objecttype='${i}'`) > -1)\r\n                return true;\r\n        }\r\n    }\r\n    return false;\r\n}\r\nexports.isDynamicContent = isDynamicContent;\r\nfunction getPageId() {\r\n    let pageid;\r\n    for (const i of utils_1.getAllNode(document)) {\r\n        if (KoobooComment_1.KoobooComment.isComment(i)) {\r\n            let comment = new KoobooComment_1.KoobooComment(i.nodeValue);\r\n            if (comment.objecttype == constants_1.OBJECT_TYPE.page) {\r\n                pageid = comment.nameorid;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    return pageid;\r\n}\r\nexports.getPageId = getPageId;\r\nfunction getWrapDom(el, objectType) {\r\n    let startNode;\r\n    let boundary;\r\n    let endNode;\r\n    let nodes = [];\r\n    for (const node of utils_1.previousNodes(el, true, true)) {\r\n        if (KoobooComment_1.KoobooComment.isComment(node)) {\r\n            let comment = new KoobooComment_1.KoobooComment(node);\r\n            if (comment.objecttype == objectType && !comment.end) {\r\n                startNode = node;\r\n                boundary = comment.boundary;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n    if (startNode) {\r\n        let isSingle = isSingleCommentWrap(startNode);\r\n        for (const node of utils_1.nextNodes(startNode, true, false)) {\r\n            nodes.push(node);\r\n            if (isSingle && node instanceof HTMLElement) {\r\n                endNode = node;\r\n                break;\r\n            }\r\n            if (KoobooComment_1.KoobooComment.isComment(node)) {\r\n                let comment = new KoobooComment_1.KoobooComment(node);\r\n                if (comment.objecttype == objectType && comment.end && comment.boundary == boundary) {\r\n                    endNode = node;\r\n                    break;\r\n                }\r\n            }\r\n        }\r\n    }\r\n    return {\r\n        nodes,\r\n        startNode,\r\n        endNode\r\n    };\r\n}\r\nexports.getWrapDom = getWrapDom;\r\nfunction isSingleCommentWrap(node) {\r\n    let singleCommentWrap = [constants_1.OBJECT_TYPE.attribute, constants_1.OBJECT_TYPE.content, constants_1.OBJECT_TYPE.Label, constants_1.OBJECT_TYPE.style, constants_1.OBJECT_TYPE.Url];\r\n    let comment = new KoobooComment_1.KoobooComment(node);\r\n    return singleCommentWrap.some(s => s == comment.objecttype);\r\n}\r\nexports.isSingleCommentWrap = isSingleCommentWrap;\r\nfunction getCleanParent(el) {\r\n    let isParentFlag = false;\r\n    while (true) {\r\n        let comment = previousComment(el);\r\n        let dirty = el.hasAttribute(constants_1.KOOBOO_DIRTY);\r\n        let koobooId = el.getAttribute(constants_1.KOOBOO_ID);\r\n        if (!dirty && isParentFlag && koobooId) {\r\n            return {\r\n                parent: el,\r\n                koobooId: koobooId\r\n            };\r\n        }\r\n        else if (!el.parentElement || utils_1.isBody(el.parentElement) || (comment && !isSingleCommentWrap(comment))) {\r\n            return { parent: null, koobooId: null };\r\n        }\r\n        else {\r\n            el = el.parentElement;\r\n            isParentFlag = true;\r\n        }\r\n    }\r\n}\r\nexports.getCleanParent = getCleanParent;\r\nfunction previousComment(node) {\r\n    for (const i of utils_1.previousNodes(node)) {\r\n        if (i instanceof Comment && KoobooComment_1.KoobooComment.isComment(i)) {\r\n            if (KoobooComment_1.KoobooComment.isEndComment(i))\r\n                break;\r\n            return i;\r\n        }\r\n        if (i instanceof HTMLElement)\r\n            break;\r\n    }\r\n}\r\nexports.previousComment = previousComment;\r\nfunction getRelatedRepeatComment(el) {\r\n    let comment = previousComment(el);\r\n    if (!comment || !KoobooComment_1.KoobooComment.isComment(comment) || !isSingleCommentWrap(comment))\r\n        return;\r\n    let koobooComment = new KoobooComment_1.KoobooComment(comment);\r\n    if (koobooComment.end)\r\n        return;\r\n    for (const i of utils_1.getAllNode(document.body)) {\r\n        if (i instanceof Comment && KoobooComment_1.KoobooComment.isComment(i) && !KoobooComment_1.KoobooComment.isEndComment(i)) {\r\n            let c = new KoobooComment_1.KoobooComment(i);\r\n            if (c.objecttype == constants_1.OBJECT_TYPE.contentrepeater && c.nameorid == koobooComment.nameorid) {\r\n                return c;\r\n            }\r\n        }\r\n    }\r\n}\r\nexports.getRelatedRepeatComment = getRelatedRepeatComment;\r\n\n\n//# sourceURL=webpack:///./src/kooboo/utils.ts?");

/***/ }),

/***/ "./src/operation/ActionType.ts":
/*!*************************************!*\
  !*** ./src/operation/ActionType.ts ***!
  \*************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar ActionType;\r\n(function (ActionType) {\r\n    ActionType[\"add\"] = \"add\";\r\n    ActionType[\"update\"] = \"update\";\r\n    ActionType[\"delete\"] = \"delete\";\r\n    ActionType[\"copy\"] = \"copy\";\r\n})(ActionType = exports.ActionType || (exports.ActionType = {}));\r\n\n\n//# sourceURL=webpack:///./src/operation/ActionType.ts?");

/***/ }),

/***/ "./src/operation/Manager.ts":
/*!**********************************!*\
  !*** ./src/operation/Manager.ts ***!
  \**********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nvar __importDefault = (this && this.__importDefault) || function (mod) {\r\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\r\n};\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst OperationEvent_1 = __webpack_require__(/*! @/events/OperationEvent */ \"./src/events/OperationEvent.ts\");\r\nconst context_1 = __importDefault(__webpack_require__(/*! @/common/context */ \"./src/common/context.ts\"));\r\nclass operationManager {\r\n    constructor() {\r\n        this.previousRecords = [];\r\n        this.nextRecords = [];\r\n        this.idCounter = 0;\r\n    }\r\n    previous() {\r\n        let operation = this.previousRecords.pop();\r\n        if (operation) {\r\n            operation.undo();\r\n            this.nextRecords.push(operation);\r\n            this.emit();\r\n        }\r\n    }\r\n    next() {\r\n        let operation = this.nextRecords.pop();\r\n        if (operation) {\r\n            operation.redo();\r\n            this.previousRecords.push(operation);\r\n            this.emit();\r\n        }\r\n    }\r\n    add(operation) {\r\n        operation.id = ++this.idCounter;\r\n        this.previousRecords.push(operation);\r\n        this.nextRecords.splice(0, this.nextRecords.length);\r\n        this.emit();\r\n        return operation.id;\r\n    }\r\n    remove(id) {\r\n        let item = this.previousRecords.find(f => f.id == id);\r\n        if (!item)\r\n            return;\r\n        item.undo();\r\n        let index = this.previousRecords.indexOf(item);\r\n        this.previousRecords.splice(index, 1);\r\n        this.emit();\r\n    }\r\n    emit() {\r\n        let args = new OperationEvent_1.OperationEventArgs(this.previousRecords.length, this.nextRecords.length);\r\n        context_1.default.operationEvent.emit(args);\r\n    }\r\n}\r\nexports.operationManager = operationManager;\r\n\n\n//# sourceURL=webpack:///./src/operation/Manager.ts?");

/***/ }),

/***/ "./src/operation/Record.ts":
/*!*********************************!*\
  !*** ./src/operation/Record.ts ***!
  \*********************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst utils_1 = __webpack_require__(/*! @/dom/utils */ \"./src/dom/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nclass operationRecord {\r\n    constructor(units, logs, guid) {\r\n        this.units = units;\r\n        this.logs = logs;\r\n        this.guid = guid;\r\n    }\r\n    undo() {\r\n        let node = this.getOperationNode(this.guid);\r\n        if (!node)\r\n            return;\r\n        for (const unit of this.units) {\r\n            unit.undo(node);\r\n        }\r\n    }\r\n    redo() {\r\n        let node = this.getOperationNode(this.guid);\r\n        if (!node)\r\n            return;\r\n        for (const unit of this.units) {\r\n            unit.redo(node);\r\n        }\r\n    }\r\n    getOperationNode(guid) {\r\n        for (const node of utils_1.getAllNode(document.body)) {\r\n            if (node instanceof HTMLElement) {\r\n                let attr = node.getAttribute(constants_1.KOOBOO_GUID);\r\n                if (attr && attr == guid)\r\n                    return node;\r\n            }\r\n            if (node.nodeType == Node.COMMENT_NODE && node.nodeValue && node.nodeValue.indexOf(guid) > -1) {\r\n                return node;\r\n            }\r\n        }\r\n    }\r\n}\r\nexports.operationRecord = operationRecord;\r\n\n\n//# sourceURL=webpack:///./src/operation/Record.ts?");

/***/ }),

/***/ "./src/operation/recordLogs/ContentLog.ts":
/*!************************************************!*\
  !*** ./src/operation/recordLogs/ContentLog.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst ActionType_1 = __webpack_require__(/*! ../ActionType */ \"./src/operation/ActionType.ts\");\r\nconst Log_1 = __webpack_require__(/*! ./Log */ \"./src/operation/recordLogs/Log.ts\");\r\nclass ContentLog extends Log_1.Log {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.editorType = constants_1.EDITOR_TYPE.content;\r\n    }\r\n    static createCopy(nameOrId, orgNameOrId) {\r\n        let log = new ContentLog();\r\n        log.action = ActionType_1.ActionType.copy;\r\n        log.nameOrId = nameOrId;\r\n        log.orgNameOrId = orgNameOrId;\r\n        return log;\r\n    }\r\n    static createDelete(nameOrId) {\r\n        let log = new ContentLog();\r\n        log.action = ActionType_1.ActionType.delete;\r\n        log.nameOrId = nameOrId;\r\n        return log;\r\n    }\r\n    static createUpdate(nameOrId, fieldName, value) {\r\n        let log = new ContentLog();\r\n        log.action = ActionType_1.ActionType.update;\r\n        log.nameOrId = nameOrId;\r\n        log.fieldName = fieldName;\r\n        log.value = value;\r\n        return log;\r\n    }\r\n}\r\nexports.ContentLog = ContentLog;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordLogs/ContentLog.ts?");

/***/ }),

/***/ "./src/operation/recordLogs/DomLog.ts":
/*!********************************************!*\
  !*** ./src/operation/recordLogs/DomLog.ts ***!
  \********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst ActionType_1 = __webpack_require__(/*! ../ActionType */ \"./src/operation/ActionType.ts\");\r\nconst Log_1 = __webpack_require__(/*! ./Log */ \"./src/operation/recordLogs/Log.ts\");\r\nclass DomLog extends Log_1.Log {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.editorType = constants_1.EDITOR_TYPE.dom;\r\n    }\r\n    static createUpdate(nameOrId, value, koobooId, objectType, attributeName = \"\") {\r\n        let log = new DomLog();\r\n        log.action = ActionType_1.ActionType.update;\r\n        log.nameOrId = nameOrId;\r\n        log.value = value;\r\n        log.koobooId = koobooId;\r\n        log.objectType = objectType;\r\n        if (attributeName)\r\n            log.attributeName = attributeName;\r\n        return log;\r\n    }\r\n    static createDelete(nameOrId, koobooId, objectType) {\r\n        let log = new DomLog();\r\n        log.action = ActionType_1.ActionType.delete;\r\n        log.nameOrId = nameOrId;\r\n        log.koobooId = koobooId;\r\n        log.objectType = objectType;\r\n        return log;\r\n    }\r\n}\r\nexports.DomLog = DomLog;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordLogs/DomLog.ts?");

/***/ }),

/***/ "./src/operation/recordLogs/HtmlblockLog.ts":
/*!**************************************************!*\
  !*** ./src/operation/recordLogs/HtmlblockLog.ts ***!
  \**************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst ActionType_1 = __webpack_require__(/*! ../ActionType */ \"./src/operation/ActionType.ts\");\r\nconst Log_1 = __webpack_require__(/*! ./Log */ \"./src/operation/recordLogs/Log.ts\");\r\nclass HtmlblockLog extends Log_1.Log {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.objectType = constants_1.OBJECT_TYPE.htmlblock;\r\n        this.editorType = constants_1.EDITOR_TYPE.htmlblock;\r\n    }\r\n    static createDelete(nameOrId) {\r\n        let log = new HtmlblockLog();\r\n        log.action = ActionType_1.ActionType.delete;\r\n        log.nameOrId = nameOrId;\r\n        return log;\r\n    }\r\n    static createUpdate(nameOrId, value) {\r\n        let log = new HtmlblockLog();\r\n        log.action = ActionType_1.ActionType.update;\r\n        log.nameOrId = nameOrId;\r\n        log.value = value;\r\n        return log;\r\n    }\r\n}\r\nexports.HtmlblockLog = HtmlblockLog;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordLogs/HtmlblockLog.ts?");

/***/ }),

/***/ "./src/operation/recordLogs/LabelLog.ts":
/*!**********************************************!*\
  !*** ./src/operation/recordLogs/LabelLog.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst ActionType_1 = __webpack_require__(/*! ../ActionType */ \"./src/operation/ActionType.ts\");\r\nconst Log_1 = __webpack_require__(/*! ./Log */ \"./src/operation/recordLogs/Log.ts\");\r\nclass LabelLog extends Log_1.Log {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.objectType = constants_1.OBJECT_TYPE.Label;\r\n        this.editorType = constants_1.EDITOR_TYPE.label;\r\n    }\r\n    static createDelete(nameOrId) {\r\n        let log = new LabelLog();\r\n        log.action = ActionType_1.ActionType.delete;\r\n        log.nameOrId = nameOrId;\r\n        return log;\r\n    }\r\n    static createUpdate(nameOrId, value) {\r\n        let log = new LabelLog();\r\n        log.action = ActionType_1.ActionType.update;\r\n        log.nameOrId = nameOrId;\r\n        log.value = value;\r\n        return log;\r\n    }\r\n}\r\nexports.LabelLog = LabelLog;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordLogs/LabelLog.ts?");

/***/ }),

/***/ "./src/operation/recordLogs/Log.ts":
/*!*****************************************!*\
  !*** ./src/operation/recordLogs/Log.ts ***!
  \*****************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nclass Log {\r\n}\r\nexports.Log = Log;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordLogs/Log.ts?");

/***/ }),

/***/ "./src/operation/recordLogs/StyleLog.ts":
/*!**********************************************!*\
  !*** ./src/operation/recordLogs/StyleLog.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst ActionType_1 = __webpack_require__(/*! ../ActionType */ \"./src/operation/ActionType.ts\");\r\nconst Log_1 = __webpack_require__(/*! ./Log */ \"./src/operation/recordLogs/Log.ts\");\r\nclass StyleLog extends Log_1.Log {\r\n    constructor() {\r\n        super(...arguments);\r\n        this.editorType = constants_1.EDITOR_TYPE.style;\r\n    }\r\n    static createUpdate(nameOrId, objectType, value, property, koobooId) {\r\n        let log = new StyleLog();\r\n        log.action = ActionType_1.ActionType.update;\r\n        log.nameOrId = nameOrId;\r\n        log.value = value;\r\n        log.objectType = objectType;\r\n        log.property = property;\r\n        log.KoobooId = koobooId;\r\n        return log;\r\n    }\r\n    static createCssUpdate(value, property, selector, styleTagKoobooId, url, important) {\r\n        let log = new StyleLog();\r\n        log.action = ActionType_1.ActionType.update;\r\n        log.value = value;\r\n        log.property = property;\r\n        log.styleTagKoobooId = styleTagKoobooId;\r\n        log.styleSheetUrl = url;\r\n        log.selector = selector;\r\n        log.important = important;\r\n        return log;\r\n    }\r\n}\r\nexports.StyleLog = StyleLog;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordLogs/StyleLog.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/CopyRepeatUnit.ts":
/*!*****************************************************!*\
  !*** ./src/operation/recordUnits/CopyRepeatUnit.ts ***!
  \*****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nclass CopyRepeatUnit extends Unit_1.Unit {\r\n    undo(node) {\r\n        let temp = element_1.createDiv();\r\n        let { nodes, startNode } = utils_1.getWrapDom(node, constants_1.OBJECT_TYPE.contentrepeater);\r\n        startNode.parentNode.insertBefore(temp, startNode);\r\n        nodes.forEach(i => temp.appendChild(i));\r\n        this.newValue = temp.innerHTML;\r\n        temp.outerHTML = this.oldValue;\r\n    }\r\n    redo(node) {\r\n        let temp = element_1.createDiv();\r\n        node.parentNode.replaceChild(temp, node);\r\n        temp.outerHTML = this.newValue;\r\n    }\r\n}\r\nexports.CopyRepeatUnit = CopyRepeatUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/CopyRepeatUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/CopyUnit.ts":
/*!***********************************************!*\
  !*** ./src/operation/recordUnits/CopyUnit.ts ***!
  \***********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nclass CopyUnit extends Unit_1.Unit {\r\n    undo(node) {\r\n        let el = node;\r\n        this.newValue = el.outerHTML;\r\n        el.outerHTML = this.oldValue;\r\n    }\r\n    redo(node) {\r\n        let temp = element_1.createDiv();\r\n        node.parentNode.replaceChild(temp, node);\r\n        temp.outerHTML = this.newValue;\r\n    }\r\n}\r\nexports.CopyUnit = CopyUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/CopyUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/CssUnit.ts":
/*!**********************************************!*\
  !*** ./src/operation/recordUnits/CssUnit.ts ***!
  \**********************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nclass CssUnit extends Unit_1.Unit {\r\n    constructor(oldValue, groups) {\r\n        super(oldValue);\r\n        this.oldValue = oldValue;\r\n        this.groups = groups;\r\n    }\r\n    undo(node) {\r\n        for (const group of this.groups) {\r\n            for (const color of group.cssColors) {\r\n                if (color.inline)\r\n                    continue;\r\n                color.cssStyleRule.style.setProperty(color.prop.prop, color.value, color.important ? \"important\" : \"\");\r\n            }\r\n        }\r\n    }\r\n    redo(node) {\r\n        for (const group of this.groups) {\r\n            for (const color of group.cssColors) {\r\n                if (color.inline || !color.newValue || color.newImportant === undefined)\r\n                    continue;\r\n                color.cssStyleRule.style.setProperty(color.prop.prop, color.newValue, color.newImportant ? \"important\" : \"\");\r\n            }\r\n        }\r\n    }\r\n}\r\nexports.CssUnit = CssUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/CssUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/DeleteRepeatUnit.ts":
/*!*******************************************************!*\
  !*** ./src/operation/recordUnits/DeleteRepeatUnit.ts ***!
  \*******************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nconst utils_1 = __webpack_require__(/*! @/kooboo/utils */ \"./src/kooboo/utils.ts\");\r\nconst constants_1 = __webpack_require__(/*! @/common/constants */ \"./src/common/constants.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nclass DeleteRepeatUnit extends Unit_1.Unit {\r\n    undo(node) {\r\n        this.newValue = `<!--${node.nodeValue}-->`;\r\n        let temp = element_1.createDiv();\r\n        node.parentNode.replaceChild(temp, node);\r\n        temp.outerHTML = this.oldValue;\r\n    }\r\n    redo(node) {\r\n        let temp = element_1.createDiv();\r\n        let { nodes, startNode } = utils_1.getWrapDom(node, constants_1.OBJECT_TYPE.contentrepeater);\r\n        startNode.parentNode.insertBefore(temp, startNode);\r\n        nodes.forEach(i => temp.appendChild(i));\r\n        this.oldValue = temp.innerHTML;\r\n        temp.outerHTML = this.newValue;\r\n    }\r\n}\r\nexports.DeleteRepeatUnit = DeleteRepeatUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/DeleteRepeatUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/DeleteUnit.ts":
/*!*************************************************!*\
  !*** ./src/operation/recordUnits/DeleteUnit.ts ***!
  \*************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nconst element_1 = __webpack_require__(/*! @/dom/element */ \"./src/dom/element.ts\");\r\nclass DeleteUnit extends Unit_1.Unit {\r\n    undo(node) {\r\n        this.newValue = `<!--${node.nodeValue}-->`;\r\n        let temp = element_1.createDiv();\r\n        node.parentNode.replaceChild(temp, node);\r\n        temp.outerHTML = this.oldValue;\r\n    }\r\n    redo(node) {\r\n        let el = node;\r\n        el.outerHTML = this.newValue;\r\n    }\r\n}\r\nexports.DeleteUnit = DeleteUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/DeleteUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/InnerHtmlUnit.ts":
/*!****************************************************!*\
  !*** ./src/operation/recordUnits/InnerHtmlUnit.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nclass InnerHtmlUnit extends Unit_1.Unit {\r\n    undo(node) {\r\n        let el = node;\r\n        this.newValue = el.innerHTML;\r\n        el.innerHTML = this.oldValue;\r\n    }\r\n    redo(node) {\r\n        let el = node;\r\n        this.oldValue = el.innerHTML;\r\n        el.innerHTML = this.newValue;\r\n    }\r\n}\r\nexports.InnerHtmlUnit = InnerHtmlUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/InnerHtmlUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/StyleUnit.ts":
/*!************************************************!*\
  !*** ./src/operation/recordUnits/StyleUnit.ts ***!
  \************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nclass StyleUnit extends Unit_1.Unit {\r\n    constructor(oldValue, prop) {\r\n        super(oldValue);\r\n        this.oldValue = oldValue;\r\n        this.prop = prop;\r\n    }\r\n    undo(node) {\r\n        let el = node;\r\n        this.newValue = el.style[this.prop];\r\n        el.style[this.prop] = this.oldValue;\r\n    }\r\n    redo(node) {\r\n        let el = node;\r\n        this.oldValue = el.style[this.prop];\r\n        el.style[this.prop] = this.newValue;\r\n    }\r\n}\r\nexports.StyleUnit = StyleUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/StyleUnit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/Unit.ts":
/*!*******************************************!*\
  !*** ./src/operation/recordUnits/Unit.ts ***!
  \*******************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nvar Type;\r\n(function (Type) {\r\n    Type[Type[\"innerHtml\"] = 0] = \"innerHtml\";\r\n    Type[Type[\"copy\"] = 1] = \"copy\";\r\n})(Type = exports.Type || (exports.Type = {}));\r\nclass Unit {\r\n    constructor(oldValue) {\r\n        this.oldValue = oldValue;\r\n    }\r\n}\r\nexports.Unit = Unit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/Unit.ts?");

/***/ }),

/***/ "./src/operation/recordUnits/attributeUnit.ts":
/*!****************************************************!*\
  !*** ./src/operation/recordUnits/attributeUnit.ts ***!
  \****************************************************/
/*! no static exports found */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
eval("\r\nObject.defineProperty(exports, \"__esModule\", { value: true });\r\nconst Unit_1 = __webpack_require__(/*! ./Unit */ \"./src/operation/recordUnits/Unit.ts\");\r\nclass AttributeUnit extends Unit_1.Unit {\r\n    constructor(oldValue, attribute) {\r\n        super(oldValue);\r\n        this.oldValue = oldValue;\r\n        this.attribute = attribute;\r\n    }\r\n    undo(node) {\r\n        let el = node;\r\n        this.newValue = el.getAttribute(this.attribute);\r\n        el.setAttribute(this.attribute, this.oldValue);\r\n    }\r\n    redo(node) {\r\n        let el = node;\r\n        this.oldValue = el.getAttribute(this.attribute);\r\n        el.setAttribute(this.attribute, this.newValue);\r\n    }\r\n}\r\nexports.AttributeUnit = AttributeUnit;\r\n\n\n//# sourceURL=webpack:///./src/operation/recordUnits/attributeUnit.ts?");

/***/ })

/******/ });